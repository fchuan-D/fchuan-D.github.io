<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>12.30æœ‰æ„Ÿ</title>
    <url>/2021/12/30/12-30%E6%9C%89%E6%84%9F/</url>
    <content><![CDATA[<p><em><strong>æ˜å¤©å°±æ˜¯12.31ï¼Œå‡†å¤‡è·¨å¹´å’¯ï¼ï¼</strong></em></p>
]]></content>
      <categories>
        <category>æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>ä¸€äº›é—²è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>2021â†’2022</title>
    <url>/2022/01/01/2022/</url>
    <content><![CDATA[<p><em><strong>æ–°å¹´ä¼Šå§‹</strong></em></p>
<p>ä¸çŸ¥é“è¯´äº›å•¥å¥½ï¼Œ é‚£å°±ç¥å¤§å®¶æ–°å¹´å¿«ä¹ã€èº«ä½“å¥åº·ã€å‰ç¥¥å¦‚æ„ã€ä¸‡äº‹èƒœæ„ï¼<br><del>å¸Œæœ›å¤§å®¶ä¼™å„¿èƒ½åœ¨è¯„è®ºåŒºç•™ä¸‹å¯¹æ–°å¹´çš„æœŸè®¸å’Œæ„¿æœ›ï¼(ps:å°±å½“æ˜¯å¸®æˆ‘åšä¸‹å‹åŠ›æµ‹è¯•å‘—ğŸ˜œ)</del></p>
<p>åšå®¢ç®€åŒ–åå·²å–æ¶ˆè¯„è®ºåŒº</p>
]]></content>
      <categories>
        <category>èŠ‚æ—¥</category>
      </categories>
      <tags>
        <tag>å…ƒæ—¦</tag>
      </tags>
  </entry>
  <entry>
    <title>Gitå¸¸è§æ“ä½œ</title>
    <url>/2022/05/07/Git%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><h2 id="é¡¹ç›®éœ€è¦è¿­ä»£"><a href="#é¡¹ç›®éœ€è¦è¿­ä»£" class="headerlink" title="é¡¹ç›®éœ€è¦è¿­ä»£"></a>é¡¹ç›®éœ€è¦è¿­ä»£</h2><p>æˆ‘ä»¬å¼€å‘çš„åº”ç”¨ç¨‹åºæ˜¯éœ€è¦ä¸æ–­çš„è¿­ä»£çš„ï¼Œæ¯”å¦‚ version 1.0 ã€version 2.5 ã€version 3.9.11ï¼Œè¿™äº›æŒ‡çš„éƒ½æ˜¯ç‰ˆæœ¬å·ã€‚ä¸åŒç‰ˆæœ¬å·çš„åº”ç”¨ç¨‹åºï¼Œé‡Œé¢çš„åŠŸèƒ½éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬åšä¸€ä¸ªåå­—å«åš project1 çš„åº”ç”¨ï¼Œv1.0æ—¶å¯èƒ½ä»…ä»…åªæ˜¯åŸºç¡€æ¡†æ¶ï¼Œv1.1æ—¶å¢åŠ ç”¨æˆ·ä¸­å¿ƒæ¨¡å—ï¼Œç„¶åç”¨äº†ä¸€æ®µæ—¶é—´å‡ºç°äº†ä¸€ä¸ªè‡´å‘½çš„bugï¼Œç„¶åæˆ‘ä»¬æŠŠ project1 å‡çº§åˆ°äº† v1.1.1 è§£å†³äº†è¿™ä¸ªbugï¼Œæ‰€ä»¥è¯´åº”ç”¨ç¨‹åºæ˜¯éœ€è¦ä¸æ–­çš„è¿­ä»£çš„ã€‚</p>
<h2 id="ç‰ˆæœ¬ç®¡ç†"><a href="#ç‰ˆæœ¬ç®¡ç†" class="headerlink" title="ç‰ˆæœ¬ç®¡ç†"></a>ç‰ˆæœ¬ç®¡ç†</h2><p>ç›´æ¥æŠŠé¡¹ç›®å¤åˆ¶å‡ºæ¥ä¸€ä»½ï¼Œåœ¨å‰¯æœ¬é¡¹ç›®ä¸­ï¼Œç›´æ¥åšè¿­ä»£ï¼Œä½†è¿™æ ·åšæœ‰ä¸€ä¸ªåå¤„ï¼Œå¦‚æœå‡çº§çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œæ—¶é—´é—´éš”åˆå¤§çš„è¯ï¼Œå¯èƒ½ä¼šå¿˜è®°éƒ½åšè¿‡ä»€ä¹ˆäº‹ï¼Œè¿™æ ·å°±ä¸ä¾¿äºç®¡ç†äº†ï¼Œæ‰€ä»¥åº”è¯¥é€‰æ‹©ä¸€ç§æ›´æ™ºèƒ½çš„æ–¹å¼ç®¡ç†æˆ‘ä»¬çš„æ–‡ä»¶ç‰ˆæœ¬ã€‚</p>
<h1 id="Gitåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ"><a href="#Gitåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ" class="headerlink" title="Gitåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ"></a>Gitåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</h1><h2 id="Git-çš„è¯ç”Ÿ"><a href="#Git-çš„è¯ç”Ÿ" class="headerlink" title="Git çš„è¯ç”Ÿ"></a>Git çš„è¯ç”Ÿ</h2><h2 id="Gitçš„ä¸‰æ£µæ ‘"><a href="#Gitçš„ä¸‰æ£µæ ‘" class="headerlink" title="Gitçš„ä¸‰æ£µæ ‘"></a>Gitçš„ä¸‰æ£µæ ‘</h2><ul>
<li>å·¥ä½œåŒºï¼šæˆ‘ä»¬ç¼–å†™ä»£ç çš„æ–‡ä»¶å…·ä½“å­˜æ”¾ä½ç½®ã€‚</li>
<li>æš‚å­˜åŒºï¼šä¸´æ—¶å­˜å‚¨åŒºåŸŸã€‚</li>
<li>ç‰ˆæœ¬åº“ï¼šä»£ç ä»“åº“ï¼Œå³åˆ†æ”¯ã€‚æ–‡ä»¶æœ€ç»ˆä¿å­˜çš„åŒºåŸŸã€‚</li>
</ul>
<h2 id="å®‰è£…-Git"><a href="#å®‰è£…-Git" class="headerlink" title="å®‰è£… Git"></a>å®‰è£… Git</h2><p>mac è‡ªå¸¦ gitï¼Œwindows éœ€è¦å®‰è£… gitã€‚</p>
<p>å®‰è£…å®Œæˆåï¼Œè¿˜éœ€è¦æœ€åä¸€æ­¥è®¾ç½®ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;Your Name&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;email@example.com&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½¿ç”¨git config user.nameæˆ–git config user.emailå¯ä»¥æŸ¥çœ‹ç”¨æˆ·åå’Œé‚®ç®±ã€‚</p>
</blockquote>
<h2 id="åˆ›å»ºæœ¬åœ°ä»“åº“"><a href="#åˆ›å»ºæœ¬åœ°ä»“åº“" class="headerlink" title="åˆ›å»ºæœ¬åœ°ä»“åº“"></a>åˆ›å»ºæœ¬åœ°ä»“åº“</h2><ul>
<li><h3 id="åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œtest-git"><a href="#åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œtest-git" class="headerlink" title="åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œtest_git"></a>åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œtest_git</h3></li>
<li><h3 id="ç»ˆç«¯å‘½ä»¤è¡Œè¾“å…¥ï¼šgit-init"><a href="#ç»ˆç«¯å‘½ä»¤è¡Œè¾“å…¥ï¼šgit-init" class="headerlink" title="ç»ˆç«¯å‘½ä»¤è¡Œè¾“å…¥ï¼šgit init"></a>ç»ˆç«¯å‘½ä»¤è¡Œè¾“å…¥ï¼šgit init</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">git init	#gitåˆå§‹åŒ–ï¼Œä¸æŠ¥é”™ï¼Œä»£è¡¨åˆå§‹åŒ–æˆåŠŸï¼Œä¼šç”Ÿæˆ.gitæ–‡ä»¶å¤¹(æ˜¯éšè—çš„)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¦‚æœæŠ¥é”™ï¼Œæ²¡æœ‰è¯†åˆ«åˆ°git, è®°å¾—æ·»åŠ ç¯å¢ƒå˜é‡  â€¦Git\bin</p>
</blockquote>
</li>
<li><h3 id="æ·»åŠ åˆ°æš‚å­˜åŒº"><a href="#æ·»åŠ åˆ°æš‚å­˜åŒº" class="headerlink" title="æ·»åŠ åˆ°æš‚å­˜åŒº"></a>æ·»åŠ åˆ°æš‚å­˜åŒº</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git add .   #æäº¤æ‰€æœ‰å˜åŒ–çš„æ–‡ä»¶</span><br><span class="line">git add abc #æäº¤abcè¿™ä¸ªæ–‡ä»¶å¤¹</span><br><span class="line">git add *.css #æäº¤æ‰€æœ‰cssæ–‡ä»¶</span><br></pre></td></tr></table></figure></li>
<li><h3 id="æš‚å­˜åŒºåˆ°ä»£ç åº“"><a href="#æš‚å­˜åŒºåˆ°ä»£ç åº“" class="headerlink" title="æš‚å­˜åŒºåˆ°ä»£ç åº“"></a>æš‚å­˜åŒºåˆ°ä»£ç åº“</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git commit -m &#x27;ç¬¬ä¸€æ¬¡æäº¤&#x27;   #é»˜è®¤ä»¥masterä¸»åˆ†æ”¯æäº¤ï¼Œè®°å¾—æ·»åŠ æäº¤çš„æ³¨é‡Šï¼Œä¾¿äºåˆ†æ¸…æ¥šæäº¤æ—¶çš„ä¿¡æ¯</span><br><span class="line">å†ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">é‡æ–°git add .   git commit -m &#x27;ç¬¬äºŒæ¬¡æäº¤&#x27;æ‰§è¡Œä¸€æ¬¡</span><br></pre></td></tr></table></figure></li>
<li><h3 id="æŸ¥çœ‹æäº¤å†å²"><a href="#æŸ¥çœ‹æäº¤å†å²" class="headerlink" title="æŸ¥çœ‹æäº¤å†å²"></a>æŸ¥çœ‹æäº¤å†å²</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git log :æŸ¥çœ‹æäº¤æ—¥å¿—</span><br></pre></td></tr></table></figure></li>
<li><h3 id="ç‰ˆæœ¬å›æº¯"><a href="#ç‰ˆæœ¬å›æº¯" class="headerlink" title="ç‰ˆæœ¬å›æº¯"></a>ç‰ˆæœ¬å›æº¯</h3><p>ä½ çœ‹åˆ°çš„ä¸€å¤§ä¸²ç±»ä¼¼3628164â€¦882e1e0çš„æ˜¯commit idï¼ˆç‰ˆæœ¬å·ï¼‰åœ¨Gitä¸­ï¼Œç”¨HEADè¡¨ç¤ºå½“å‰ç‰ˆæœ¬ï¼Œä¸Šä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯HEAD^ ï¼Œä¸Šä¸Šä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯HEAD^^ ï¼Œå½“ç„¶å¾€ä¸Š100ä¸ªç‰ˆæœ¬å†™100ä¸ª^æ¯”è¾ƒå®¹æ˜“æ•°ä¸è¿‡æ¥ï¼Œæ‰€ä»¥å†™æˆHEAD~100ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git reset --hard head^</span><br><span class="line">æˆ–è€…ä¸éœ€è¦è®°å¿†æ¬¡æ•°ï¼Œç›´æ¥æ ¹æ®ç‰ˆæœ¬å·å‰å…­ä½è¿›è¡Œå›é€€</span><br><span class="line">git reset --hard ç‰ˆæœ¬å·å‰å…­ä½</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­ä½¿ç”¨git logæŸ¥çœ‹ï¼Œå‘ç°æ’¤é”€å‰çš„ç‰ˆæœ¬çœ‹ä¸åˆ°äº†ï¼Œæƒ³å›å›ä¸å»äº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</p>
<p>åªèƒ½æŸ¥çœ‹å†å²è®°å½•ï¼Œæ‰¾ä¹‹å‰çš„ç‰ˆæœ¬å·,</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git reset --hard ç‰ˆæœ¬å·å‰å…­ä½</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡git reflogæ‰¾ç‰ˆæœ¬å·</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git reflog</span><br><span class="line">å†åˆ‡æ¢ç‰ˆæœ¬</span><br><span class="line">git reset --hard ç‰ˆæœ¬å·å‰å…­ä½</span><br></pre></td></tr></table></figure></li>
<li><h3 id="åˆ†æ”¯æ“ä½œ"><a href="#åˆ†æ”¯æ“ä½œ" class="headerlink" title="åˆ†æ”¯æ“ä½œ"></a>åˆ†æ”¯æ“ä½œ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºåˆ†æ”¯</span><br><span class="line">git branch åˆ†æ”¯å</span><br><span class="line">æŸ¥çœ‹åˆ†æ”¯</span><br><span class="line">git branch -v</span><br><span class="line">åˆ‡æ¢åˆ†æ”¯fit</span><br><span class="line">git checkout åˆ†æ”¯å</span><br><span class="line">åˆå¹¶åˆ†æ”¯</span><br><span class="line">1. git checkout æ¥æ”¶ä¿®æ”¹çš„åˆ†æ”¯</span><br><span class="line">2. git merge æ–°å†…å®¹çš„åˆ†æ”¯</span><br><span class="line">å‡ºç°å†²çªï¼Œå¯ä»¥æ‰‹åŠ¨è§£å†³ï¼Œä¹‹å</span><br><span class="line">git add æ–‡ä»¶å</span><br><span class="line">git commit -m &#x27;æ—¥å¿—&#x27; #æ³¨æ„ï¼Œæ­¤æ—¶commitä¸è¦å¸¦å…·ä½“æ–‡ä»¶å</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="è¿œç¨‹ä»£ç ä»“åº“"><a href="#è¿œç¨‹ä»£ç ä»“åº“" class="headerlink" title="è¿œç¨‹ä»£ç ä»“åº“"></a>è¿œç¨‹ä»£ç ä»“åº“</h2><p>GitHubæ¯”è¾ƒç«ï¼Œä½†æ¯•ç«Ÿæ˜¯å›½å¤–çš„ç½‘ç«™ï¼Œè®¿é—®é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥é€‰æ‹©å›½å†…çš„ç äº‘</p>
<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p>gitHubæ˜¯ä¸€ä¸ªé¢å‘å¼€æºåŠç§æœ‰è½¯ä»¶é¡¹ç›®çš„æ‰˜ç®¡å¹³å°ï¼Œå› ä¸ºåªæ”¯æŒgit ä½œä¸ºå”¯ä¸€çš„ç‰ˆæœ¬åº“æ ¼å¼è¿›è¡Œæ‰˜ç®¡ï¼Œæ•…ågitHubã€‚</p>
<p>2018å¹´6æœˆ4æ—¥ï¼Œå¾®è½¯å®£å¸ƒï¼Œé€šè¿‡75äº¿ç¾å…ƒçš„è‚¡ç¥¨äº¤æ˜“æ”¶è´­ä»£ç æ‰˜ç®¡å¹³å°GitHubã€‚</p>
<h2 id="è¿œç¨‹åº“æ“ä½œ"><a href="#è¿œç¨‹åº“æ“ä½œ" class="headerlink" title="è¿œç¨‹åº“æ“ä½œ"></a>è¿œç¨‹åº“æ“ä½œ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æŸ¥çœ‹è¿œç¨‹åº“åˆ«å</span><br><span class="line">git remote -v</span><br><span class="line">åˆ›å»ºè¿œç¨‹åº“åˆ«å</span><br><span class="line">git remote add åˆ«å(æœ€å¥½è·Ÿé¡¹ç›®åä¸€è‡´) è¿œç¨‹gitåœ°å€</span><br><span class="line">æ¨é€è¿œç¨‹åº“</span><br><span class="line">git push åˆ«åæˆ–è€…åœ°å€ åˆ†æ”¯å</span><br><span class="line">æ‹‰å–è¿œç¨‹åº“å†…å®¹</span><br><span class="line">git pull åˆ«åæˆ–è€…åœ°å€ åˆ†æ”¯å</span><br><span class="line">å…‹éš†</span><br><span class="line">git clone è¿œç¨‹åœ°å€(cloneä¸éœ€è¦ç™»å½•è´¦å·)</span><br></pre></td></tr></table></figure>

<h3 id="ç”Ÿæˆæœ¬åœ°å¯†é’¥"><a href="#ç”Ÿæˆæœ¬åœ°å¯†é’¥" class="headerlink" title="ç”Ÿæˆæœ¬åœ°å¯†é’¥"></a>ç”Ÿæˆæœ¬åœ°å¯†é’¥</h3><p>åˆ›å»ºSSH Keyã€‚åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰.sshç›®å½•ï¼Œå¦‚æœæœ‰ï¼Œå†çœ‹çœ‹è¿™ä¸ªç›®å½•ä¸‹æœ‰æ²¡æœ‰ id_rsa å’Œ id_rsa.pub è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚æœå·²ç»æœ‰äº†ï¼Œå¯ç›´æ¥è·³åˆ°ä¸‹ä¸€æ­¥ã€‚</p>
<p>å¦‚æœæ²¡æœ‰</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;1469720568@qq.com&quot;</span><br></pre></td></tr></table></figure>

<p>ä½ éœ€è¦æŠŠé‚®ä»¶åœ°å€æ¢æˆä½ è‡ªå·±çš„é‚®ä»¶åœ°å€ï¼Œç„¶åä¸€è·¯å›è½¦ï¼Œä½¿ç”¨é»˜è®¤å€¼å³å¯ï¼Œæ‰€ä»¥ä¹Ÿæ— éœ€è®¾ç½®å¯†ç ã€‚</p>
<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œå¯ä»¥åœ¨ç”¨æˆ·ä¸»ç›®å½•é‡Œæ‰¾åˆ°.sshç›®å½•ï¼Œé‡Œé¢æœ‰id_rsaå’Œid_rsa.pubä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªå°±æ˜¯SSH Keyçš„ç§˜é’¥å¯¹ï¼Œid_rsaæ˜¯ç§é’¥ï¼Œä¸èƒ½æ³„éœ²å‡ºå»ï¼Œid_rsa.pubæ˜¯å…¬é’¥ï¼Œå¯ä»¥æ”¾å¿ƒåœ°å‘Šè¯‰ä»»ä½•äººã€‚</p>
<h3 id="GitHubæˆæƒ"><a href="#GitHubæˆæƒ" class="headerlink" title="GitHubæˆæƒ"></a>GitHubæˆæƒ</h3><p>ç™»é™†GitHubï¼Œæ‰“å¼€â€œAccount settingsâ€ï¼Œâ€œSSH Keysâ€é¡µé¢ï¼š</p>
<p>ç„¶åï¼Œç‚¹â€œAdd SSH Keyâ€ï¼Œå¡«ä¸Šä»»æ„Titleï¼Œåœ¨Keyæ–‡æœ¬æ¡†é‡Œç²˜è´´ id_rsa.pub æ–‡ä»¶çš„å†…å®¹ï¼Œç‚¹â€œAdd Keyâ€ï¼Œä½ å°±åº”è¯¥çœ‹åˆ°å·²ç»æ·»åŠ çš„Keyã€‚</p>
<h3 id="Gitæ•´åˆIdea"><a href="#Gitæ•´åˆIdea" class="headerlink" title="Gitæ•´åˆIdea"></a>Gitæ•´åˆIdea</h3><h4 id="Giteeå’ŒGitlabéœ€è¦å¤§å®¶è¯¾ä¸‹è‡ªè¡Œå­¦ä¹ "><a href="#Giteeå’ŒGitlabéœ€è¦å¤§å®¶è¯¾ä¸‹è‡ªè¡Œå­¦ä¹ " class="headerlink" title="Giteeå’ŒGitlabéœ€è¦å¤§å®¶è¯¾ä¸‹è‡ªè¡Œå­¦ä¹ "></a>Giteeå’ŒGitlabéœ€è¦å¤§å®¶è¯¾ä¸‹è‡ªè¡Œå­¦ä¹ </h4>]]></content>
      <categories>
        <category>å¸¸ç”¨å·¥å…·</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>SSMç¬”è®°-3</title>
    <url>/2022/04/23/JavaSSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    <content><![CDATA[<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fp3.ssl.qhimg.com%2Ft0166542ac0759ab525.png&refer=http%3A%2F%2Fp3.ssl.qhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1642428815&t=f486dc0d3f2581c0afaf0cce7eaa0d57" alt="img"></p>
<h1 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h1><p>æœ¬ç« æˆ‘ä»¬ä¼šä¸€è¾¹è®²è§£SpringSecurityæ¡†æ¶ï¼Œä¸€è¾¹ä»å¤´å¼€å§‹ç¼–å†™å›¾ä¹¦ç®¡ç†ç³»ç»Ÿã€‚</p>
<p>  SpringSecurityæ˜¯ä¸€ä¸ªåŸºäºSpringå¼€å‘çš„éå¸¸å¼ºå¤§çš„æƒé™éªŒè¯æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<span id="more"></span>

<ul>
<li>è®¤è¯ ï¼ˆç”¨æˆ·ç™»å½•ï¼‰</li>
<li>æˆæƒ ï¼ˆæ­¤ç”¨æˆ·èƒ½å¤Ÿåšå“ªäº›äº‹æƒ…ï¼‰</li>
<li>æ”»å‡»é˜²æŠ¤ ï¼ˆé˜²æ­¢ä¼ªé€ èº«ä»½æ”»å‡»ï¼‰</li>
</ul>
<p>æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨æ›´åŠ ä¸“ä¸šçš„å…¨æ–°éªŒè¯æ¡†æ¶ï¼Œè¿˜è¦ä»CSRFè¯´èµ·ã€‚</p>
<h2 id="CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»"><a href="#CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»" class="headerlink" title="CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»"></a>CSRFè·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»</h2><p>æˆ‘ä»¬æ—¶å¸¸ä¼šåœ¨QQä¸Šæ”¶åˆ°åˆ«äººå‘é€çš„é’“é±¼ç½‘ç«™é“¾æ¥ï¼Œåªè¦ä½ åœ¨ä¸Šé¢ç™»é™†äº†ä½ çš„QQè´¦å·ï¼Œé‚£ä¹ˆä¸å‡ºæ„å¤–ï¼Œä½ çš„å·å·²ç»åœ¨åˆ«äººæ‰‹ä¸­äº†ã€‚å®é™…ä¸Šè¿™ä¸€ç±»ç½‘ç«™éƒ½å±äºæ¶æ„ç½‘ç«™ï¼Œä¸“é—¨ç”¨äºç›—å–ä»–äººä¿¡æ¯ï¼Œæ‰§è¡Œéæ³•æ“ä½œï¼Œç”šè‡³è·å–ä»–äººè´¦æˆ·ä¸­çš„è´¢äº§ï¼Œéæ³•è½¬è´¦ç­‰ã€‚è€Œè¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ç§æ¯”è¾ƒå®¹æ˜“å‘ç”Ÿçš„æ¶æ„æ“ä½œï¼Œä»ä¸æ³•åˆ†å­çš„è§’åº¦å»äº†è§£æ•´ä¸ªæµç¨‹ã€‚</p>
<p>æˆ‘ä»¬åœ¨JavaWebé˜¶æ®µå·²ç»äº†è§£äº†Sessionå’ŒCookieçš„æœºåˆ¶ï¼Œåœ¨ä¸€å¼€å§‹çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šç»™æµè§ˆå™¨ä¸€ä¸ªåä¸ºJSESSIONçš„Cookieä¿¡æ¯ä½œä¸ºä¼šè¯çš„å”¯ä¸€å‡­æ®ï¼Œåªè¦ç”¨æˆ·æºå¸¦æ­¤Cookieè®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®¤å®šæ­¤ä¼šè¯å±äºå“ªä¸ªæµè§ˆå™¨ã€‚å› æ­¤ï¼Œåªè¦æ­¤ä¼šè¯çš„ç”¨æˆ·æ‰§è¡Œäº†ç™»å½•æ“ä½œï¼Œé‚£ä¹ˆå°±å¯ä»¥éšæ„è®¿é—®ä¸ªäººä¿¡æ¯ç­‰å†…å®¹ã€‚</p>
<p>æ¯”å¦‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨æ–°å¢äº†ä¸€ä¸ªè½¬è´¦çš„æ¥å£ï¼Œç”¨æˆ·ç™»å½•ä¹‹åï¼Œåªéœ€è¦ä½¿ç”¨POSTè¯·æ±‚æºå¸¦éœ€è¦è½¬è´¦çš„é‡‘é¢å’Œè½¬è´¦äººè®¿é—®æ­¤æ¥å£å°±å¯ä»¥è¿›è¡Œè½¬è´¦æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">    session.setAttribute(<span class="string">&quot;login&quot;</span>, <span class="literal">true</span>);   <span class="comment">//è¿™é‡Œå°±æ­£å¸¸è®¿é—®ä¸€ä¸‹indexè¡¨ç¤ºç™»é™†</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/pay&quot;, method = RequestMethod.POST, produces = &quot;text/html;charset=utf-8&quot;)</span> <span class="comment">//è¿™é‡Œè¦è®¾ç½®ä¸€ä¸‹producesä¸ç„¶ä¼šä¹±ç </span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">pay</span><span class="params">(String account,</span></span><br><span class="line"><span class="params">                  <span class="type">int</span> amount,</span></span><br><span class="line"><span class="params">                  <span class="meta">@SessionAttribute(&quot;login&quot;)</span> Boolean isLogin)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isLogin) <span class="keyword">return</span> <span class="string">&quot;æˆåŠŸè½¬è´¦ ï¿¥&quot;</span>+amount+<span class="string">&quot; ç»™ï¼š&quot;</span>+account;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="string">&quot;è½¬è´¦å¤±è´¥ï¼Œæ‚¨æ²¡æœ‰ç™»é™†ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œå¤§å®¶æœ‰æ²¡æœ‰æƒ³è¿‡è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸ºäº†æœç´¢å­¦ä¹ èµ„æ–™æ—¶å¯èƒ½ä¸€ä¸å°å¿ƒè®¿é—®äº†ä¸€ä¸ªæ¶æ„ç½‘ç«™ï¼Œè€Œæ­¤ç½‘ç«™æºå¸¦äº†è¿™æ ·ä¸€æ®µå†…å®¹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>æˆ‘æ˜¯(æ¶)å­¦(æ„)ä¹ ç½‘ç«™<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>å¯¹ä¸èµ·ï¼Œæ‚¨è¿˜æ²¡æœ‰å……å€¼æœ¬ç«™çš„å­¦ä¹ ä¼šå‘˜ï¼Œè¯·å…ˆå……å€¼åå†è§‚çœ‹å­¦ä¹ è§†é¢‘<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://localhost:8080/mvc/pay&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;account&quot;</span> <span class="attr">value</span>=<span class="string">&quot;hacker&quot;</span> <span class="attr">hidden</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;number&quot;</span> <span class="attr">name</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">value</span>=<span class="string">&quot;666666&quot;</span> <span class="attr">hidden</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç‚¹æˆ‘å……å€¼ä¼šå‘˜ï¼Œè§‚çœ‹å®Œæ•´è§†é¢‘&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™ä¸ªé¡µé¢å¹¶ä¸æ˜¯æˆ‘ä»¬å®˜æ–¹æä¾›çš„é¡µé¢ï¼Œè€Œæ˜¯ä¸æ³•åˆ†å­æ­å»ºçš„æ¶æ„ç½‘ç«™ã€‚æˆ‘ä»¬å‘ç°æ­¤é¡µé¢ä¸­æœ‰ä¸€ä¸ªè¡¨å•ï¼Œä½†æ˜¯è¡¨å•ä¸­çš„ä¸¤ä¸ªè¾“å…¥æ¡†è¢«éšè—äº†ï¼Œè€Œæˆ‘ä»¬çœ‹åˆ°çš„åªæœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œæˆ‘ä»¬ä¸çŸ¥é“è¿™æ˜¯ä¸€ä¸ªè¡¨å•ï¼Œä¹Ÿä¸çŸ¥é“è¡¨å•ä¼šæäº¤ç»™é‚£ä¸ªåœ°å€ï¼Œè¿™æ—¶æ•´ä¸ªé¡µé¢å°±éå¸¸æœ‰è¿·æƒ‘æ€§äº†ã€‚å¦‚æœæˆ‘ä»¬ç‚¹å‡»æ­¤æŒ‰é’®ï¼Œé‚£ä¹ˆæ•´ä¸ªè¡¨å•çš„æ•°æ®ä¼šä»¥POSTçš„å½¢å¼å‘é€ç»™æˆ‘ä»¬çš„æœåŠ¡ç«¯ï¼ˆä¼šæºå¸¦ä¹‹å‰ç™»é™†æˆ‘ä»¬ç½‘ç«™çš„Cookieä¿¡æ¯ï¼‰ï¼Œä½†æ˜¯è¿™é‡Œå¾ˆæ˜æ˜¾æ˜¯å¦ä¸€ä¸ªç½‘ç«™è·³è½¬ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œæ¶æ„ç½‘ç«™å°±æˆåŠŸåœ°åœ¨æˆ‘ä»¬æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å¼•å¯¼æˆ‘ä»¬æ‰§è¡Œäº†è½¬è´¦æ“ä½œï¼Œå½“ä½ å‘ç°ä¸Šå½“å—éª—æ—¶ï¼Œé’±å·²ç»è¢«è½¬èµ°äº†ã€‚</p>
<p>è€Œè¿™ç§æ„å»ºæ¶æ„é¡µé¢ï¼Œå¼•å¯¼ç”¨æˆ·è®¿é—®å¯¹åº”ç½‘ç«™æ‰§è¡Œæ“ä½œçš„æ–¹å¼ç§°ä¸ºï¼š<strong>è·¨ç«™è¯·æ±‚ä¼ªé€ </strong>ï¼ˆCSRFï¼ŒCross Site Request Forgeryï¼‰</p>
<p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¹‹å‰ç¼–å†™çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿå°±å­˜åœ¨è¿™æ ·çš„å®‰å…¨æ¼æ´ï¼Œè€ŒSpringSecurityå°±å¾ˆå¥½åœ°è§£å†³äº†è¿™æ ·çš„é—®é¢˜ã€‚</p>
<hr>
<h2 id="å¼€å‘ç¯å¢ƒæ­å»º"><a href="#å¼€å‘ç¯å¢ƒæ­å»º" class="headerlink" title="å¼€å‘ç¯å¢ƒæ­å»º"></a>å¼€å‘ç¯å¢ƒæ­å»º</h2><p>æˆ‘ä»¬ä¾ç„¶ä½¿ç”¨ä¹‹å‰çš„æ¨¡æ¿æ¥æ­å»ºå›¾ä¹¦ç®¡ç†ç³»ç»Ÿé¡¹ç›®ã€‚</p>
<p>å¯¼å…¥ä»¥ä¸‹ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å»ºè®®ä¸ºå„ä¸ªä¾èµ–è¿›è¡Œåˆ†ç±»ï¼Œåˆ°åæœŸæˆ‘ä»¬çš„é¡¹ç›®å¯èƒ½ä¼šå¯¼å…¥å¾ˆå¤šä¾èµ–ï¼Œæ·»åŠ æ³¨é‡Šä¼šå¤§å¹…åº¦æé«˜é˜…è¯»æ•ˆç‡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  Springæ¡†æ¶ä¾èµ–  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  æŒä¹…å±‚æ¡†æ¶ä¾èµ–  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zaxxer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>HikariCP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  å…¶ä»–å·¥å…·æ¡†æ¶ä¾èµ–ï¼šLombokã€Slf4j  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-jdk14<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  ServletAPI  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  JUnitä¾èµ–  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€åˆ›å»ºInitializeræ¥é…ç½®Webåº”ç”¨ç¨‹åºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcInitializer</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;RootConfiguration.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;MvcConfiguration.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºMvcé…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&quot;book.manager.controller&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æˆ‘ä»¬éœ€è¦ä½¿ç”¨ThymeleafViewResolverä½œä¸ºè§†å›¾è§£æå™¨ï¼Œå¹¶è§£ææˆ‘ä»¬çš„HTMLé¡µé¢</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ThymeleafViewResolver <span class="title function_">thymeleafViewResolver</span><span class="params">(<span class="meta">@Autowired</span> SpringTemplateEngine springTemplateEngine)</span>&#123;</span><br><span class="line">        <span class="type">ThymeleafViewResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThymeleafViewResolver</span>();</span><br><span class="line">        resolver.setOrder(<span class="number">1</span>);</span><br><span class="line">        resolver.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        resolver.setTemplateEngine(springTemplateEngine);</span><br><span class="line">        <span class="keyword">return</span> resolver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é…ç½®æ¨¡æ¿è§£æå™¨</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SpringResourceTemplateResolver <span class="title function_">templateResolver</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SpringResourceTemplateResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringResourceTemplateResolver</span>();</span><br><span class="line">        resolver.setSuffix(<span class="string">&quot;.html&quot;</span>);</span><br><span class="line">        resolver.setPrefix(<span class="string">&quot;/WEB-INF/template/&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> resolver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é…ç½®æ¨¡æ¿å¼•æ“Bean</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SpringTemplateEngine <span class="title function_">springTemplateEngine</span><span class="params">(<span class="meta">@Autowired</span> ITemplateResolver resolver)</span>&#123;</span><br><span class="line">        <span class="type">SpringTemplateEngine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringTemplateEngine</span>();</span><br><span class="line">        engine.setTemplateResolver(resolver);</span><br><span class="line">        <span class="keyword">return</span> engine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼€å¯é™æ€èµ„æºå¤„ç†</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> &#123;</span><br><span class="line">        configurer.enable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é™æ€èµ„æºè·¯å¾„é…ç½®</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/static/**&quot;</span>).addResourceLocations(<span class="string">&quot;/WEB-INF/static/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºRooté…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RootConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ååˆ›å»ºä¸€ä¸ªä¸“ç”¨äºå“åº”é¡µé¢çš„Controllerå³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸“ç”¨äºå¤„ç†é¡µé¢å“åº”çš„æ§åˆ¶å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦å°†å‰ç«¯é¡µé¢æ”¾åˆ°å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸­ï¼Œç„¶åå¼€å¯æœåŠ¡å™¨å¹¶é€šè¿‡æµè§ˆå™¨ï¼ŒæˆåŠŸè®¿é—®ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦é…ç½®SpringSecurityï¼Œä¸Mvcä¸€æ ·ï¼Œéœ€è¦ä¸€ä¸ªåˆå§‹åŒ–å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityInitializer</span> <span class="keyword">extends</span> <span class="title class_">AbstractSecurityWebApplicationInitializer</span> &#123;</span><br><span class="line">    <span class="comment">//ä¸ç”¨é‡å†™ä»»ä½•å†…å®¹</span></span><br><span class="line">  	<span class="comment">//è¿™é‡Œå®é™…ä¸Šä¼šè‡ªåŠ¨æ³¨å†Œä¸€ä¸ªFilterï¼ŒSpringSecurityåº•å±‚å°±æ˜¯ä¾é Nä¸ªè¿‡æ»¤å™¨å®ç°çš„ï¼Œæˆ‘ä»¬ä¹‹åå†æ¢è®¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦å†åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ç”¨äºé…ç½®SpringSecurityï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">		<span class="comment">//ç»§æ‰¿WebSecurityConfigurerAdapterï¼Œä¹‹åä¼šè¿›è¡Œé…ç½®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€åœ¨æ ¹å®¹å™¨ä¸­æ·»åŠ æ­¤é…ç½®æ–‡ä»¶å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;RootConfiguration.class, SecurityConfiguration.class&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼ŒSpringSecurityçš„é…ç½®å°±å®Œæˆäº†ï¼Œæˆ‘ä»¬å†æ¬¡è¿è¡Œé¡¹ç›®ï¼Œä¼šå‘ç°æ— æ³•è¿›å…¥çš„æˆ‘ä»¬çš„é¡µé¢ä¸­ï¼Œæ— è®ºæˆ‘ä»¬è®¿é—®å“ªä¸ªé¡µé¢ï¼Œéƒ½ä¼šè¿›å…¥åˆ°SpringSecurityä¸ºæˆ‘ä»¬æä¾›çš„ä¸€ä¸ªé»˜è®¤ç™»å½•é¡µé¢ï¼Œä¹‹åæˆ‘ä»¬ä¼šè®²è§£å¦‚ä½•è¿›è¡Œé…ç½®ã€‚</p>
<p>è‡³æ­¤ï¼Œé¡¹ç›®ç¯å¢ƒæ­å»ºå®Œæˆã€‚</p>
<hr>
<h2 id="è®¤è¯"><a href="#è®¤è¯" class="headerlink" title="è®¤è¯"></a>è®¤è¯</h2><h3 id="ç›´æ¥è®¤è¯"><a href="#ç›´æ¥è®¤è¯" class="headerlink" title="ç›´æ¥è®¤è¯"></a>ç›´æ¥è®¤è¯</h3><p>æ—¢ç„¶æˆ‘ä»¬çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿè¦æ±‚ç”¨æˆ·ç™»å½•ä¹‹åæ‰èƒ½ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦åšçš„å°±æ˜¯å®ç°ç”¨æˆ·éªŒè¯ï¼Œè¦å®ç°ç”¨æˆ·éªŒè¯ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€äº›é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">BCryptPasswordEncoder</span> <span class="variable">encoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();  <span class="comment">//è¿™é‡Œä½¿ç”¨SpringSecurityæä¾›çš„BCryptPasswordEncoder</span></span><br><span class="line">    auth</span><br><span class="line">            .inMemoryAuthentication() <span class="comment">//ç›´æ¥éªŒè¯æ–¹å¼ï¼Œä¹‹åä¼šè®²è§£ä½¿ç”¨æ•°æ®åº“éªŒè¯</span></span><br><span class="line">            .passwordEncoder(encoder) <span class="comment">//å¯†ç åŠ å¯†å™¨</span></span><br><span class="line">            .withUser(<span class="string">&quot;test&quot;</span>)   <span class="comment">//ç”¨æˆ·å</span></span><br><span class="line">            .password(encoder.encode(<span class="string">&quot;123456&quot;</span>))   <span class="comment">//è¿™é‡Œéœ€è¦å¡«å†™åŠ å¯†åçš„å¯†ç </span></span><br><span class="line">            .roles(<span class="string">&quot;user&quot;</span>);   <span class="comment">//ç”¨æˆ·çš„è§’è‰²ï¼ˆä¹‹åè®²è§£ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpringSecurityçš„å¯†ç æ ¡éªŒå¹¶ä¸æ˜¯ç›´æ¥ä½¿ç”¨åŸæ–‡è¿›è¡Œæ¯”è¾ƒï¼Œè€Œæ˜¯ä½¿ç”¨åŠ å¯†ç®—æ³•å°†å¯†ç è¿›è¡ŒåŠ å¯†ï¼ˆæ›´å‡†ç¡®åœ°è¯´åº”è¯¥è¿›è¡ŒHashå¤„ç†ï¼Œæ­¤è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ï¼Œæ— æ³•è§£å¯†ï¼‰ï¼Œæœ€åå°†ç”¨æˆ·æä¾›çš„å¯†ç ä»¥åŒæ ·çš„æ–¹å¼åŠ å¯†åä¸å¯†æ–‡è¿›è¡Œæ¯”è¾ƒã€‚å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œç”¨æˆ·æä¾›çš„å¯†ç å±äºéšç§ä¿¡æ¯ï¼Œç›´æ¥æ˜æ–‡å­˜å‚¨å¹¶ä¸å¥½ï¼Œè€Œä¸”å¦‚æœæ•°æ®åº“å†…å®¹è¢«çªƒå–ï¼Œé‚£ä¹ˆæ‰€æœ‰ç”¨æˆ·çš„å¯†ç å°†å…¨éƒ¨æ³„éœ²ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›çœ‹åˆ°çš„ç»“æœï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ—¢èƒ½éšè—ç”¨æˆ·å¯†ç ä¹Ÿèƒ½å®Œæˆè®¤è¯çš„æœºåˆ¶ï¼Œè€ŒHashå¤„ç†å°±æ˜¯ä¸€ç§å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡å°†ç”¨æˆ·çš„å¯†ç è¿›è¡ŒHashå€¼è®¡ç®—ï¼Œè®¡ç®—å‡ºæ¥çš„ç»“æœæ— æ³•è¿˜åŸä¸ºåŸæ–‡ï¼Œå¦‚æœéœ€è¦éªŒè¯æ˜¯å¦ä¸æ­¤å¯†ç ä¸€è‡´ï¼Œé‚£ä¹ˆéœ€è¦ä»¥åŒæ ·çš„æ–¹å¼åŠ å¯†å†æ¯”è¾ƒä¸¤ä¸ªHashå€¼æ˜¯å¦ä¸€è‡´ï¼Œè¿™æ ·å°±å¾ˆå¥½çš„ä¿è¯äº†ç”¨æˆ·å¯†ç çš„å®‰å…¨æ€§ã€‚</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimages.10qianwan.com%2F10qianwan%2F20180223%2Fb_1_201802231459287319.jpg&refer=http%3A%2F%2Fimages.10qianwan.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1643122575&t=da2d04d86d4869d3054fb9a861ad1824" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯SpringSecurityæä¾›çš„BCryptPasswordEncoderï¼Œè‡³äºåŠ å¯†è¿‡ç¨‹ï¼Œè¿™é‡Œä¸åšæ·±å…¥è®²è§£ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨æ­¤è´¦å·ç™»å½•ï¼Œåœ¨ç™»å½•åï¼Œå°±å¯ä»¥éšæ„è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™å†…å®¹äº†ã€‚</p>
<h3 id="ä½¿ç”¨æ•°æ®åº“è®¤è¯"><a href="#ä½¿ç”¨æ•°æ®åº“è®¤è¯" class="headerlink" title="ä½¿ç”¨æ•°æ®åº“è®¤è¯"></a>ä½¿ç”¨æ•°æ®åº“è®¤è¯</h3><p>å‰é¢æˆ‘ä»¬å·²ç»å®ç°äº†ç›´æ¥è®¤è¯çš„æ–¹å¼ï¼Œé‚£ä¹ˆå¦‚ä½•å°†å…¶è¿æ¥åˆ°æ•°æ®åº“ï¼Œé€šè¿‡æŸ¥è¯¢æ•°æ®åº“ä¸­çš„å†…å®¹æ¥è¿›è¡Œç”¨æˆ·ç™»å½•å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†åŠ å¯†åçš„å¯†ç æ·»åŠ åˆ°æ•°æ®åº“ä¸­ä½œä¸ºç”¨æˆ·å¯†ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">BCryptPasswordEncoder</span> <span class="variable">encoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">        System.out.println(encoder.encode(<span class="string">&quot;123456&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¥å®Œæˆã€‚</p>
<p>ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªServiceå®ç°ï¼Œå®ç°çš„æ˜¯UserDetailsServiceï¼Œå®ƒæ”¯æŒæˆ‘ä»¬è‡ªå·±è¿”å›ä¸€ä¸ªUserDetailså¯¹è±¡ï¼Œæˆ‘ä»¬åªéœ€ç›´æ¥è¿”å›ä¸€ä¸ªåŒ…å«æ•°æ®åº“ä¸­çš„ç”¨æˆ·åã€å¯†ç ç­‰ä¿¡æ¯çš„UserDetailså³å¯ï¼ŒSpringSecurityä¼šè‡ªåŠ¨è¿›è¡Œæ¯”å¯¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAuthService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> mapper.getPasswordByUsername(s);  <span class="comment">//ä»æ•°æ®åº“æ ¹æ®ç”¨æˆ·åè·å–å¯†ç </span></span><br><span class="line">        <span class="keyword">if</span>(password == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;ç™»å½•å¤±è´¥ï¼Œç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> User   <span class="comment">//è¿™é‡Œéœ€è¦è¿”å›UserDetailsï¼ŒSpringSecurityä¼šæ ¹æ®ç»™å®šçš„ä¿¡æ¯è¿›è¡Œæ¯”å¯¹</span></span><br><span class="line">                .withUsername(s)</span><br><span class="line">                .password(password)   <span class="comment">//ç›´æ¥ä»æ•°æ®åº“å–çš„å¯†ç </span></span><br><span class="line">                .roles(<span class="string">&quot;user&quot;</span>)   <span class="comment">//ç”¨æˆ·è§’è‰²</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ«å¿˜äº†åœ¨é…ç½®ç±»ä¸­è¿›è¡Œæ‰«æï¼Œå°†å…¶æ³¨å†Œä¸ºBeanï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªMapperç”¨äºå’Œæ•°æ®åº“äº¤äº’ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select password from users where username = #&#123;username&#125;&quot;)</span></span><br><span class="line">    String <span class="title function_">getPasswordByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å’Œä¹‹å‰ä¸€æ ·ï¼Œé…ç½®ä¸€ä¸‹Mybatiså’Œæ•°æ®æºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScans(&#123;</span></span><br><span class="line"><span class="meta">        @ComponentScan(&quot;book.manager.service&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;book.manager.mapper&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RootConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">HikariDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>();</span><br><span class="line">        dataSource.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/study&quot;</span>);</span><br><span class="line">        dataSource.setDriverClassName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactoryBean</span><span class="params">(<span class="meta">@Autowired</span> DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        bean.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åå†ä¿®æ”¹ä¸€ä¸‹Securityé…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    auth</span><br><span class="line">      .userDetailsService(service)   <span class="comment">//ä½¿ç”¨è‡ªå®šä¹‰çš„Serviceå®ç°ç±»è¿›è¡ŒéªŒè¯</span></span><br><span class="line">      .passwordEncoder(<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>());   <span class="comment">//ä¾ç„¶ä½¿ç”¨BCryptPasswordEncoder</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œç™»é™†å°±ä¼šä»æ•°æ®åº“ä¸­è¿›è¡ŒæŸ¥è¯¢ã€‚</p>
<h3 id="è‡ªå®šä¹‰ç™»å½•ç•Œé¢"><a href="#è‡ªå®šä¹‰ç™»å½•ç•Œé¢" class="headerlink" title="è‡ªå®šä¹‰ç™»å½•ç•Œé¢"></a>è‡ªå®šä¹‰ç™»å½•ç•Œé¢</h3><p>å‰é¢æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•å®ç°æ•°æ®åº“æƒé™éªŒè¯ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬æ¥ç€æ¥çœ‹çœ‹ï¼Œå¦‚ä½•å°†ç™»é™†é¡µé¢ä¿®æ”¹ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„æ ·å¼ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬è¦äº†è§£ä¸€ä¸‹SpringSecurityæ˜¯å¦‚ä½•è¿›è¡Œç™»é™†éªŒè¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä¸€ä¸‹é»˜è®¤çš„ç™»é™†ç•Œé¢ä¸­ï¼Œè¡¨å•å†…æœ‰å“ªäº›å†…å®¹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;form-signin&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/book_manager/login&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;form-signin-heading&quot;</span>&gt;</span>Please sign in<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Username&quot;</span> <span class="attr">required</span>=<span class="string">&quot;&quot;</span> <span class="attr">autofocus</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Password&quot;</span> <span class="attr">required</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;_csrf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;83421936-b84b-44e3-be47-58bb2c14571a&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-lg btn-primary btn-block&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œé¦–å…ˆæœ‰ä¸€ä¸ªç”¨æˆ·åçš„è¾“å…¥æ¡†å’Œä¸€ä¸ªå¯†ç çš„è¾“å…¥æ¡†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å…¶ä¸­å¡«å†™ç”¨æˆ·åå’Œå¯†ç ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œé™¤äº†è¿™ä¸¤ä¸ªè¾“å…¥æ¡†ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªinputæ ‡ç­¾ï¼Œå®ƒæ˜¯éšè—çš„ï¼Œå¹¶ä¸”å®ƒå­˜å‚¨äº†ä¸€ä¸²ç±»ä¼¼äºHashå€¼çš„ä¸œè¥¿ï¼Œåç§°ä¸ºâ€_csrfâ€ï¼Œå…¶å®çœ‹åå­—å°±çŸ¥é“ï¼Œè¿™ç©æ„å…«æˆéƒ½æ˜¯ä¸ºäº†é˜²æ­¢CSRFæ”»å‡»è€Œå­˜åœ¨çš„ã€‚</p>
<p>ä»Spring Security 4.0å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šå¯ç”¨CSRFä¿æŠ¤ï¼Œä»¥é˜²æ­¢CSRFæ”»å‡»åº”ç”¨ç¨‹åºï¼ŒSpring Security CSRFä¼šé’ˆå¯¹PATCHï¼ŒPOSTï¼ŒPUTå’ŒDELETEæ–¹æ³•çš„è¯·æ±‚ï¼ˆä¸ä»…ä»…åªæ˜¯ç™»é™†è¯·æ±‚ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯ä»»ä½•è¯·æ±‚è·¯å¾„ï¼‰è¿›è¡Œé˜²æŠ¤ï¼Œè€Œè¿™é‡Œçš„ç™»é™†è¡¨å•æ­£å¥½æ˜¯ä¸€ä¸ªPOSTç±»å‹çš„è¯·æ±‚ã€‚åœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œæ— è®ºæ˜¯å¦ç™»é™†ï¼Œé¡µé¢ä¸­åªè¦å‘èµ·äº†PATCHï¼ŒPOSTï¼ŒPUTå’ŒDELETEè¯·æ±‚ä¸€å®šä¼šè¢«æ‹’ç»ï¼Œå¹¶è¿”å›<strong>403</strong>é”™è¯¯<strong>ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œæ˜¯ä¸ªç©¶æå¤§å‘ï¼‰</strong>ï¼Œéœ€è¦åœ¨è¯·æ±‚çš„æ—¶å€™åŠ å…¥csrfTokenæ‰è¡Œï¼Œä¹Ÿå°±æ˜¯â€83421936-b84b-44e3-be47-58bb2c14571aâ€ï¼Œæ­£æ˜¯csrfTokenï¼Œå¦‚æœæäº¤çš„æ˜¯è¡¨å•ç±»å‹çš„æ•°æ®ï¼Œé‚£ä¹ˆè¡¨å•ä¸­å¿…é¡»åŒ…å«æ­¤Tokenå­—ç¬¦ä¸²ï¼Œé”®åç§°ä¸ºâ€_csrfâ€ï¼›å¦‚æœæ˜¯JSONæ•°æ®æ ¼å¼å‘é€çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«æ­¤Tokenå­—ç¬¦ä¸²ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬æœ€åæäº¤çš„ç™»é™†è¡¨å•ï¼Œé™¤äº†å¿…é¡»çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿˜åŒ…å«äº†ä¸€ä¸ªcsrfTokenå­—ç¬¦ä¸²ç”¨äºéªŒè¯ï¼Œé˜²æ­¢æ”»å‡»ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™è‡ªå·±çš„ç™»é™†é¡µé¢æ—¶ï¼Œéœ€è¦æ·»åŠ è¿™æ ·ä¸€ä¸ªè¾“å…¥æ¡†ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:name</span>=<span class="string">&quot;$&#123;_csrf.getParameterName()&#125;&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;_csrf.token&#125;&quot;</span> <span class="attr">hidden</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>éšè—å³å¯ï¼Œä½†æ˜¯å¿…é¡»è¦æœ‰ï¼Œè€ŒTokençš„é”®åç§°å’ŒTokenå­—ç¬¦ä¸²å¯ä»¥é€šè¿‡Thymeleafä»Modelä¸­è·å–ï¼ŒSpringSecurityä¼šè‡ªåŠ¨å°†Tokenä¿¡æ¯æ·»åŠ åˆ°Modelä¸­ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥å°†æˆ‘ä»¬è‡ªå·±çš„é¡µé¢æ›¿æ¢æ‰é»˜è®¤çš„é¡µé¢äº†ï¼Œæˆ‘ä»¬éœ€è¦é‡å†™å¦ä¸€ä¸ªæ–¹æ³•æ¥å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http</span><br><span class="line">            .authorizeRequests()   <span class="comment">//é¦–å…ˆéœ€è¦é…ç½®å“ªäº›è¯·æ±‚ä¼šè¢«æ‹¦æˆªï¼Œå“ªäº›è¯·æ±‚å¿…é¡»å…·æœ‰ä»€ä¹ˆè§’è‰²æ‰èƒ½è®¿é—®</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/static/**&quot;</span>).permitAll()    <span class="comment">//é™æ€èµ„æºï¼Œä½¿ç”¨permitAllæ¥è¿è¡Œä»»ä½•äººè®¿é—®ï¼ˆæ³¨æ„ä¸€å®šè¦æ”¾åœ¨å‰é¢ï¼‰</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/**&quot;</span>).hasRole(<span class="string">&quot;user&quot;</span>)     <span class="comment">//æ‰€æœ‰è¯·æ±‚å¿…é¡»ç™»é™†å¹¶ä¸”æ˜¯userè§’è‰²æ‰å¯ä»¥è®¿é—®ï¼ˆä¸åŒ…å«ä¸Šé¢çš„é™æ€èµ„æºï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦é…ç½®æ‹¦æˆªè§„åˆ™ï¼Œä¹Ÿå°±æ˜¯å½“ç”¨æˆ·æœªç™»å½•æ—¶ï¼Œå“ªäº›è·¯å¾„å¯ä»¥è®¿é—®ï¼Œå“ªäº›è·¯å¾„ä¸å¯ä»¥è®¿é—®ï¼Œå¦‚æœä¸å¯ä»¥è®¿é—®ï¼Œé‚£ä¹ˆä¼šè¢«è‡ªåŠ¨é‡å®šå‘åˆ°ç™»é™†é¡µé¢ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦é…ç½®è¡¨å•ç™»é™†å’Œç™»å½•é¡µé¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">.formLogin()       <span class="comment">//é…ç½®Formè¡¨å•ç™»é™†</span></span><br><span class="line">.loginPage(<span class="string">&quot;/login&quot;</span>)       <span class="comment">//ç™»é™†é¡µé¢åœ°å€ï¼ˆGETï¼‰</span></span><br><span class="line">.loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>)    <span class="comment">//formè¡¨å•æäº¤åœ°å€ï¼ˆPOSTï¼‰</span></span><br><span class="line">.defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>)    <span class="comment">//ç™»é™†æˆåŠŸåè·³è½¬çš„é¡µé¢ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Handlerå®ç°é«˜åº¦è‡ªå®šä¹‰</span></span><br><span class="line">.permitAll()    <span class="comment">//ç™»é™†é¡µé¢ä¹Ÿéœ€è¦å…è®¸æ‰€æœ‰äººè®¿é—®</span></span><br></pre></td></tr></table></figure>

<p>éœ€è¦é…ç½®ç™»é™†é¡µé¢çš„åœ°å€å’Œç™»é™†è¯·æ±‚å‘é€çš„åœ°å€ï¼Œè¿™é‡Œç™»é™†é¡µé¢å¡«å†™ä¸º<code>/login</code>ï¼Œç™»é™†è¯·æ±‚åœ°å€ä¸º<code>/doLogin</code>ï¼Œç™»é™†é¡µé¢éœ€è¦æˆ‘ä»¬è‡ªå·±å»ç¼–å†™Controlleræ¥å®ç°ï¼Œç™»é™†è¯·æ±‚æäº¤å¤„ç†ç”±SpringSecurityæä¾›ï¼Œåªéœ€è¦å†™è·¯å¾„å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">login</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®å¥½åï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®ä¸€ä¸‹é€€å‡ºç™»é™†æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">.and()</span><br><span class="line">.logout()</span><br><span class="line">.logoutUrl(<span class="string">&quot;/logout&quot;</span>)    <span class="comment">//é€€å‡ºç™»é™†çš„è¯·æ±‚åœ°å€</span></span><br><span class="line">.logoutSuccessUrl(<span class="string">&quot;/login&quot;</span>);    <span class="comment">//é€€å‡ºåé‡å®šå‘çš„åœ°å€</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™é‡Œçš„é€€å‡ºç™»é™†è¯·æ±‚ä¹Ÿå¿…é¡»æ˜¯POSTè¯·æ±‚æ–¹å¼ï¼ˆå› ä¸ºå¼€å¯äº†CSFRé˜²æŠ¤ï¼Œéœ€è¦æ·»åŠ Tokenï¼‰ï¼Œå¦åˆ™æ— æ³•è®¿é—®ï¼Œè¿™é‡Œä¸»é¡µé¢å°±è¿™æ ·å†™ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;logout&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">th:name</span>=<span class="string">&quot;$&#123;_csrf.getParameterName()&#125;&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;_csrf.token&#125;&quot;</span> <span class="attr">hidden</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>é€€å‡ºç™»é™†<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç™»é™†æˆåŠŸåï¼Œç‚¹å‡»é€€å‡ºç™»é™†æŒ‰é’®ï¼Œå°±å¯ä»¥æˆåŠŸé€€å‡ºå¹¶å›åˆ°ç™»é™†ç•Œé¢äº†ã€‚</p>
<p>ç”±äºæˆ‘ä»¬åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­æš‚æ—¶ç”¨ä¸åˆ°CSFRé˜²æŠ¤ï¼Œå› æ­¤å¯ä»¥å°†å…¶å…³é—­ï¼Œè¿™æ ·ç›´æ¥ä½¿ç”¨getè¯·æ±‚ä¹Ÿå¯ä»¥é€€å‡ºç™»é™†ï¼Œå¹¶ä¸”ç™»é™†è¯·æ±‚ä¸­æ— éœ€å†æºå¸¦Tokenäº†ï¼Œæ¨èå…³é—­ï¼Œå› ä¸ºä¸å…³é—­åé¢å¯èƒ½ä¼šå› ä¸ºæ²¡è€ƒè™‘CSRFé˜²æŠ¤è€Œé‡åˆ°ä¸€è¿ä¸²çš„é—®é¢˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">.and()</span><br><span class="line">.csrf().disable();</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥ç›´æ¥å…³é—­æ­¤åŠŸèƒ½äº†ï¼Œä½†æ˜¯æ³¨æ„ï¼Œè¿™æ ·å°†ä¼šå¯¼è‡´æ‚¨çš„Webç½‘ç«™å­˜åœ¨å®‰å…¨æ¼æ´ã€‚ï¼ˆè¿™é‡Œä¸ºäº†ä¹‹åçœäº‹ï¼Œå°±å…³é—­ä¿æŠ¤äº†ï¼Œä½†æ˜¯ä¸€å®šè¦è®°å¾—åœ¨ä¸å…³é—­çš„æƒ…å†µä¸‹éœ€è¦æºå¸¦Tokenè®¿é—®ï¼‰</p>
<hr>
<h2 id="æˆæƒ"><a href="#æˆæƒ" class="headerlink" title="æˆæƒ"></a>æˆæƒ</h2><p>ç”¨æˆ·ç™»å½•åï¼Œå¯èƒ½ä¼šæ ¹æ®ç”¨æˆ·å½“å‰æ˜¯èº«ä»½è¿›è¡Œè§’è‰²åˆ’åˆ†ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€å¸¸ç”¨çš„QQï¼Œä¸€ä¸ªQQç¾¤é‡Œé¢ï¼Œæœ‰ç¾¤ä¸»ã€ç®¡ç†å‘˜å’Œæ™®é€šç¾¤æˆå‘˜ä¸‰ç§è§’è‰²ï¼Œå…¶ä¸­ç¾¤ä¸»å…·æœ‰æœ€é«˜æƒé™ï¼Œç¾¤ä¸»å¯ä»¥ç®¡ç†æ•´ä¸ªç¾¤çš„ä»»ä½•æ¿å—ï¼Œå¹¶ä¸”å…·æœ‰è§£æ•£å’Œå‡çº§ç¾¤çš„èµ„æ ¼ï¼Œè€Œç®¡ç†å‘˜åªæœ‰ç¾¤ä¸»çš„ä¸€éƒ¨åˆ†æƒé™ï¼Œåªèƒ½ç”¨äºæ—¥å¸¸ç®¡ç†ï¼Œæ™®é€šç¾¤æˆå‘˜åˆ™åªèƒ½è¿›è¡Œæœ€åŸºæœ¬çš„èŠå¤©æ“ä½œã€‚</p>
<p>å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œç”¨æˆ·çš„ä¸€ä¸ªæ“ä½œå®é™…ä¸Šå°±æ˜¯åœ¨è®¿é—®æˆ‘ä»¬æä¾›çš„<code>æ¥å£</code>(ç¼–å†™çš„å¯¹åº”è®¿é—®è·¯å¾„çš„Servletï¼‰ï¼Œæ¯”å¦‚ç™»é™†ï¼Œå°±éœ€è¦è°ƒç”¨<code>/login</code>æ¥å£ï¼Œé€€å‡ºç™»é™†å°±è¦è°ƒç”¨/<code>logout</code>æ¥å£ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæ–°å¢å›¾ä¹¦ã€åˆ é™¤å›¾ä¹¦ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æœ‰ç€å¯¹åº”çš„Servletæ¥è¿›è¡Œå¤„ç†ã€‚å› æ­¤ï¼Œä»æˆ‘ä»¬å¼€å‘è€…çš„è§’åº¦æ¥è¯´ï¼Œå†³å®šç”¨æˆ·èƒ½å¦ä½¿ç”¨æŸä¸ªåŠŸèƒ½ï¼Œåªéœ€è¦å†³å®šç”¨æˆ·æ˜¯å¦èƒ½å¤Ÿè®¿é—®å¯¹åº”çš„Servletå³å¯ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å¤§è‡´åƒä¸‹é¢è¿™æ ·è¿›è¡Œåˆ’åˆ†ï¼š</p>
<ul>
<li>ç¾¤ä¸»ï¼š<code>/login</code>ã€<code>/logout</code>ã€<code>/chat</code>ã€<code>/edit</code>ã€<code>/delete</code>ã€<code>/upgrade</code></li>
<li>ç®¡ç†å‘˜ï¼š<code>/login</code>ã€<code>/logout</code>ã€<code>/chat</code>ã€<code>/edit</code></li>
<li>æ™®é€šç¾¤æˆå‘˜ï¼š<code>/login</code>ã€<code>/logout</code>ã€<code>/chat</code></li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æŒ‡å®šå“ªäº›è¯·æ±‚å¯ä»¥ç”±å“ªäº›ç”¨æˆ·å‘èµ·ã€‚</p>
<p>SpringSecurityä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§æˆæƒæ–¹å¼ï¼š</p>
<ul>
<li>åŸºäºæƒé™çš„æˆæƒï¼šåªè¦æ‹¥æœ‰æŸæƒé™çš„ç”¨æˆ·ï¼Œå°±å¯ä»¥è®¿é—®æŸä¸ªè·¯å¾„</li>
<li>åŸºäºè§’è‰²çš„æˆæƒï¼šæ ¹æ®ç”¨æˆ·å±äºå“ªä¸ªè§’è‰²æ¥å†³å®šæ˜¯å¦å¯ä»¥è®¿é—®æŸä¸ªè·¯å¾„</li>
</ul>
<p>ä¸¤è€…åªæ˜¯æ¦‚å¿µä¸Šçš„ä¸åŒï¼Œå®é™…ä¸Šä½¿ç”¨èµ·æ¥æ•ˆæœå·®ä¸å¤šã€‚è¿™é‡Œæˆ‘ä»¬å°±å…ˆæ¼”ç¤ºä»¥è§’è‰²æ–¹å¼æ¥è¿›è¡Œæˆæƒã€‚</p>
<h3 id="åŸºäºè§’è‰²çš„æˆæƒ"><a href="#åŸºäºè§’è‰²çš„æˆæƒ" class="headerlink" title="åŸºäºè§’è‰²çš„æˆæƒ"></a>åŸºäºè§’è‰²çš„æˆæƒ</h3><p>ç°åœ¨æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸¤ä¸ªè§’è‰²ï¼Œæ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜ï¼Œæ™®é€šç”¨æˆ·åªèƒ½è®¿é—®indexé¡µé¢ï¼Œè€Œç®¡ç†å‘˜å¯ä»¥è®¿é—®ä»»ä½•é¡µé¢ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®åº“ä¸­çš„è§’è‰²è¡¨è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œæ·»åŠ ä¸€ä¸ªç”¨æˆ·è§’è‰²å­—æ®µï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·ï¼ŒTestç”¨æˆ·çš„è§’è‰²ä¸ºuserï¼Œè€ŒAdminç”¨æˆ·çš„è§’è‰²ä¸ºadminã€‚</p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦é…ç½®SpringSecurityï¼Œå†³å®šå“ªäº›è§’è‰²å¯ä»¥è®¿é—®å“ªäº›é¡µé¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">http</span><br><span class="line">        .authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/static/**&quot;</span>).permitAll()</span><br><span class="line">  			.antMatchers(<span class="string">&quot;/index&quot;</span>).hasAnyRole(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;admin&quot;</span>)   <span class="comment">//indexé¡µé¢å¯ä»¥ç”±useræˆ–adminè®¿é—®</span></span><br><span class="line">        .anyRequest().hasRole(<span class="string">&quot;admin&quot;</span>)   <span class="comment">//é™¤äº†ä¸Šé¢ä»¥å¤–çš„æ‰€æœ‰å†…å®¹ï¼Œåªèƒ½æ˜¯adminè®¿é—®</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹éªŒè¯é€»è¾‘ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªå®ä½“ç±»ç”¨äºè¡¨ç¤ºæ•°æ®åº“ä¸­çš„ç”¨æˆ·åã€å¯†ç å’Œè§’è‰²ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthUser</span> &#123;</span><br><span class="line">    String username;</span><br><span class="line">    String password;</span><br><span class="line">    String role;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ä¿®æ”¹ä¸€ä¸‹Mapperï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from users where username = #&#123;username&#125;&quot;)</span></span><br><span class="line">    AuthUser <span class="title function_">getPasswordByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åå†ä¿®æ”¹ä¸€ä¸‹Serviceï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">    <span class="type">AuthUser</span> <span class="variable">user</span> <span class="operator">=</span> mapper.getPasswordByUsername(s);</span><br><span class="line">    <span class="keyword">if</span>(user == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;ç™»å½•å¤±è´¥ï¼Œç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> User</span><br><span class="line">            .withUsername(user.getUsername())</span><br><span class="line">            .password(user.getPassword())</span><br><span class="line">            .roles(user.getRole())</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å°è¯•ç™»é™†ï¼Œæ¥ç€è®¿é—®ä¸€ä¸‹<code>/index</code>å’Œ<code>/admin</code>ä¸¤ä¸ªé¡µé¢ã€‚</p>
<h3 id="åŸºäºæƒé™çš„æˆæƒ"><a href="#åŸºäºæƒé™çš„æˆæƒ" class="headerlink" title="åŸºäºæƒé™çš„æˆæƒ"></a>åŸºäºæƒé™çš„æˆæƒ</h3><p>åŸºäºæƒé™çš„æˆæƒä¸è§’è‰²ç±»ä¼¼ï¼Œéœ€è¦ä»¥<code>hasAnyAuthority</code>æˆ–<code>hasAuthority</code>è¿›è¡Œåˆ¤æ–­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">.anyRequest().hasAnyAuthority(<span class="string">&quot;page:index&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">    <span class="type">AuthUser</span> <span class="variable">user</span> <span class="operator">=</span> mapper.getPasswordByUsername(s);</span><br><span class="line">    <span class="keyword">if</span>(user == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;ç™»å½•å¤±è´¥ï¼Œç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> User</span><br><span class="line">            .withUsername(user.getUsername())</span><br><span class="line">            .password(user.getPassword())</span><br><span class="line">            .authorities(<span class="string">&quot;page:index&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨æ³¨è§£åˆ¤æ–­æƒé™"><a href="#ä½¿ç”¨æ³¨è§£åˆ¤æ–­æƒé™" class="headerlink" title="ä½¿ç”¨æ³¨è§£åˆ¤æ–­æƒé™"></a>ä½¿ç”¨æ³¨è§£åˆ¤æ–­æƒé™</h3><p>é™¤äº†ç›´æ¥é…ç½®ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä»¥æ³¨è§£å½¢å¼ç›´æ¥é…ç½®ï¼Œé¦–å…ˆéœ€è¦åœ¨é…ç½®ç±»ï¼ˆæ³¨æ„è¿™é‡Œæ˜¯åœ¨Mvcçš„é…ç½®ç±»ä¸Šæ·»åŠ ï¼Œå› ä¸ºè¿™é‡Œåªé’ˆå¯¹Controllerè¿›è¡Œè¿‡æ»¤ï¼Œæ‰€æœ‰çš„Controlleræ˜¯ç”±Mvcé…ç½®ç±»è¿›è¡Œæ³¨å†Œçš„ï¼Œå¦‚æœéœ€è¦ä¸ºServiceæˆ–å…¶ä»–Beanä¹Ÿå¯ç”¨æƒé™åˆ¤æ–­ï¼Œåˆ™éœ€è¦åœ¨Securityçš„é…ç½®ç±»ä¸Šæ·»åŠ ï¼‰ä¸Šå¼€å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨éœ€è¦æ·»åŠ æƒé™éªŒè¯çš„è¯·æ±‚æ˜ å°„ä¸Šæ·»åŠ æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#x27;user&#x27;)&quot;)</span>   <span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºuserè§’è‰²ï¼Œåªæœ‰æ­¤è§’è‰²æ‰å¯ä»¥è®¿é—®</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ·»åŠ <code>@PreAuthorize</code>æ³¨è§£ï¼Œåœ¨æ‰§è¡Œä¹‹å‰åˆ¤æ–­åˆ¤æ–­æƒé™ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”çš„æƒé™æˆ–æ˜¯å¯¹åº”çš„è§’è‰²ï¼Œå°†æ— æ³•è®¿é—®é¡µé¢ã€‚</p>
<p>è¿™é‡Œå…¶å®æ˜¯ä½¿ç”¨äº†SpELè¡¨è¾¾å¼ï¼Œç›¸å½“äºå¯ä»¥æ‰§è¡Œä¸€äº›é€»è¾‘å†å¾—åˆ°ç»“æœï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ å€¼ï¼Œå®˜æ–¹æ–‡æ¡£åœ°å€ï¼š<a href="https://docs.spring.io/spring-framework/docs/5.2.13.RELEASE/spring-framework-reference/core.html#expressions%EF%BC%8C%E5%86%85%E5%AE%B9%E6%AF%94%E8%BE%83%E5%A4%9A%EF%BC%8C%E4%B8%8D%E6%98%AF%E9%87%8D%E7%82%B9%EF%BC%8C%E8%BF%99%E9%87%8C%E5%B0%B1%E4%B8%8D%E5%86%8D%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D%E4%BA%86%E3%80%82">https://docs.spring.io/spring-framework/docs/5.2.13.RELEASE/spring-framework-reference/core.html#expressionsï¼Œå†…å®¹æ¯”è¾ƒå¤šï¼Œä¸æ˜¯é‡ç‚¹ï¼Œè¿™é‡Œå°±ä¸å†è¯¦ç»†ä»‹ç»äº†ã€‚</a></p>
<p>åŒæ ·çš„è¿˜æœ‰<code>@PostAuthorize</code>æ³¨è§£ï¼Œä½†æ˜¯å®ƒæ˜¯åœ¨æ–¹æ³•æ‰§è¡Œä¹‹åå†è¿›è¡Œæ‹¦æˆªï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostAuthorize(&quot;hasRole(&#x27;user&#x27;)&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†Controllerä»¥å¤–ï¼Œåªè¦æ˜¯ç”±Springç®¡ç†çš„Beanéƒ½å¯ä»¥ä½¿ç”¨æ³¨è§£å½¢å¼æ¥æ§åˆ¶æƒé™ï¼Œåªè¦ä¸å…·å¤‡è®¿é—®æƒé™ï¼Œé‚£ä¹ˆå°±æ— æ³•æ‰§è¡Œæ–¹æ³•å¹¶ä¸”ä¼šè¿”å›403é¡µé¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAnyRole(&#x27;user&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆåŠŸæ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„Serviceæ˜¯ç”±æ ¹å®¹å™¨è¿›è¡Œæ³¨å†Œï¼Œéœ€è¦åœ¨Securityé…ç½®ç±»ä¸Šæ·»åŠ <code>@EnableGlobalMethodSecurity</code>æ³¨è§£æ‰å¯ä»¥ç”Ÿæ•ˆã€‚ä¸å…·æœ‰ç›¸åŒåŠŸèƒ½çš„è¿˜æœ‰<code>@Secure</code>ä½†æ˜¯å®ƒä¸æ”¯æŒSpELè¡¨è¾¾å¼çš„æƒé™è¡¨ç¤ºå½¢å¼ï¼Œå¹¶ä¸”éœ€è¦æ·»åŠ â€ROLE_â€å‰ç¼€ï¼Œè¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>@PreFilter</code>å’Œ<code>@PostFilter</code>å¯¹é›†åˆç±»å‹çš„å‚æ•°æˆ–è¿”å›å€¼è¿›è¡Œè¿‡æ»¤ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PreFilter(&quot;filterObject.equals(&#x27;lbwnb&#x27;)&quot;)</span>   <span class="comment">//filterObjectä»£è¡¨é›†åˆä¸­æ¯ä¸ªå…ƒç´ ï¼Œåªè¦æ»¡è¶³æ¡ä»¶çš„å…ƒç´ æ‰ä¼šç•™ä¸‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(List&lt;String&gt; list)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æˆåŠŸæ‰§è¡Œ&quot;</span>+list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="string">&quot;lbwnb&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;yyds&quot;</span>);</span><br><span class="line">    service.test(list);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸<code>@PreFilter</code>ç±»ä¼¼çš„<code>@PostFilter</code>è¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†ï¼Œå®ƒç”¨äºå¤„ç†è¿”å›å€¼ï¼Œä½¿ç”¨æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å½“æœ‰å¤šä¸ªé›†åˆæ—¶ï¼Œéœ€è¦ä½¿ç”¨<code>filterTarget</code>è¿›è¡ŒæŒ‡å®šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PreFilter(value = &quot;filterObject.equals(&#x27;lbwnb&#x27;)&quot;, filterTarget = &quot;list2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(List&lt;String&gt; list, List&lt;String&gt; list2)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æˆåŠŸæ‰§è¡Œ&quot;</span>+list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="è®°ä½æˆ‘"><a href="#è®°ä½æˆ‘" class="headerlink" title="è®°ä½æˆ‘"></a>è®°ä½æˆ‘</h2><p>æˆ‘ä»¬çš„ç½‘ç«™è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ï¼Œå°±æ˜¯è®°ä½æˆ‘ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨ç™»é™†ä¹‹åçš„ä¸€æ®µæ—¶é—´å†…ï¼Œæ— éœ€å†æ¬¡è¾“å…¥è´¦å·å’Œå¯†ç è¿›è¡Œç™»é™†ï¼Œç›¸å½“äºæœåŠ¡ç«¯å·²ç»è®°ä½å½“å‰ç”¨æˆ·ï¼Œå†æ¬¡è®¿é—®æ—¶å°±å¯ä»¥å…ç™»é™†è¿›å…¥ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬ä¹‹å‰åœ¨JavaWebé˜¶æ®µï¼Œä½¿ç”¨æœ¬åœ°Cookieå­˜å‚¨çš„æ–¹å¼å®ç°äº†è®°ä½æˆ‘åŠŸèƒ½ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å¹¶ä¸å®‰å…¨ï¼ŒåŒæ—¶åœ¨ä»£ç ç¼–å†™ä¸Šä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œé‚£ä¹ˆèƒ½å¦æœ‰ä¸€ç§æ›´åŠ é«˜æ•ˆçš„è®°ä½æˆ‘åŠŸèƒ½å®ç°å‘¢ï¼Ÿ</p>
<p>SpringSecurityä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§ä¼˜ç§€çš„å®ç°ï¼Œå®ƒä¸ºæ¯ä¸ªå·²ç»ç™»é™†çš„æµè§ˆå™¨åˆ†é…ä¸€ä¸ªæºå¸¦Tokençš„Cookieï¼Œå¹¶ä¸”æ­¤Cookieé»˜è®¤ä¼šè¢«ä¿ç•™14å¤©ï¼Œåªè¦æˆ‘ä»¬ä¸æ¸…ç†æµè§ˆå™¨çš„Cookieï¼Œé‚£ä¹ˆä¸‹æ¬¡æºå¸¦æ­¤Cookieè®¿é—®æœåŠ¡å™¨å°†æ— éœ€ç™»é™†ï¼Œç›´æ¥ç»§ç»­ä½¿ç”¨ä¹‹å‰ç™»é™†çš„èº«ä»½ï¼Œè¿™æ ·æ˜¾ç„¶æ¯”æˆ‘ä»¬ä¹‹å‰çš„å†™æ³•æ›´åŠ ç®€ä¾¿ã€‚å¹¶ä¸”æˆ‘ä»¬éœ€è¦è¿›è¡Œç®€å•é…ç½®ï¼Œå³å¯å¼€å¯è®°ä½æˆ‘åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">.and()</span><br><span class="line">.rememberMe()   <span class="comment">//å¼€å¯è®°ä½æˆ‘åŠŸèƒ½</span></span><br><span class="line">.rememberMeParameter(<span class="string">&quot;remember&quot;</span>)  <span class="comment">//ç™»é™†è¯·æ±‚è¡¨å•ä¸­éœ€è¦æºå¸¦çš„å‚æ•°ï¼Œå¦‚æœæºå¸¦ï¼Œé‚£ä¹ˆæœ¬æ¬¡ç™»é™†ä¼šè¢«è®°ä½</span></span><br><span class="line">.tokenRepository(<span class="keyword">new</span> <span class="title class_">InMemoryTokenRepositoryImpl</span>())  <span class="comment">//è¿™é‡Œä½¿ç”¨çš„æ˜¯ç›´æ¥åœ¨å†…å­˜ä¸­ä¿å­˜çš„TokenRepositoryå®ç°</span></span><br><span class="line">  <span class="comment">//TokenRepositoryæœ‰å¾ˆå¤šç§å®ç°ï¼ŒInMemoryTokenRepositoryImplç›´æ¥åŸºäºMapå®ç°çš„ï¼Œç¼ºç‚¹å°±æ˜¯å å†…å­˜ã€æœåŠ¡å™¨é‡å¯åè®°ä½æˆ‘åŠŸèƒ½å°†å¤±æ•ˆ</span></span><br><span class="line">  <span class="comment">//åé¢æˆ‘ä»¬è¿˜ä¼šè®²è§£å¦‚ä½•ä½¿ç”¨æ•°æ®åº“æ¥æŒä¹…åŒ–ä¿å­˜Tokenä¿¡æ¯</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨å‰ç«¯ä¿®æ”¹ä¸€ä¸‹è®°ä½æˆ‘å‹¾é€‰æ¡†çš„åç§°ï¼Œå°†åç§°ä¿®æ”¹ä¸ä¸Šé¢ä¸€è‡´ï¼Œå¦‚æœä¸Šé¢æ²¡æœ‰é…ç½®åç§°ï¼Œé‚£ä¹ˆé»˜è®¤ä½¿ç”¨â€remember-meâ€ä½œä¸ºåç§°ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remember&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ad-checkbox&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¯åŠ¨æœåŠ¡å™¨ï¼Œåœ¨ç™»é™†æ—¶å‹¾é€‰è®°ä½æˆ‘å‹¾é€‰æ¡†ï¼Œè§‚å¯ŸCookieçš„å˜åŒ–ã€‚</p>
<p>è™½ç„¶ç°åœ¨å·²ç»å¯ä»¥å®ç°è®°ä½æˆ‘åŠŸèƒ½äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€å®šçš„ç¼ºé™·ï¼Œå¦‚æœæœåŠ¡å™¨é‡æ–°å¯åŠ¨ï¼ˆå› ä¸ºTokenä¿¡æ¯å…¨éƒ¨å­˜åœ¨HashMapä¸­ï¼Œä¹Ÿå°±æ˜¯å­˜åœ¨å†…å­˜ä¸­ï¼‰ï¼Œé‚£ä¹ˆæ‰€æœ‰è®°å½•çš„Tokenä¿¡æ¯å°†å…¨éƒ¨ä¸¢å¤±ï¼Œè¿™æ—¶å³ä½¿æµè§ˆå™¨æºå¸¦äº†ä¹‹å‰çš„Tokenä¹Ÿæ— æ³•æ¢å¤ä¹‹å‰ç™»é™†çš„èº«ä»½ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†Tokenä¿¡æ¯è®°å½•å…¨éƒ¨å­˜æ”¾åˆ°æ•°æ®åº“ä¸­ï¼ˆå­¦ä¹ äº†Redisä¹‹åè¿˜å¯ä»¥æ”¾åˆ°RedisæœåŠ¡å™¨ä¸­ï¼‰åˆ©ç”¨æ•°æ®åº“çš„æŒä¹…åŒ–å­˜å‚¨æœºåˆ¶ï¼Œå³ä½¿æœåŠ¡å™¨é‡æ–°å¯åŠ¨ï¼Œæ‰€æœ‰çš„Tokenä¿¡æ¯ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œé…ç½®æ•°æ®åº“å­˜å‚¨ä¹Ÿå¾ˆç®€å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">PersistentTokenRepository repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> PersistentTokenRepository <span class="title function_">jdbcRepository</span><span class="params">(<span class="meta">@Autowired</span> DataSource dataSource)</span>&#123;</span><br><span class="line">    <span class="type">JdbcTokenRepositoryImpl</span> <span class="variable">repository</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTokenRepositoryImpl</span>();  <span class="comment">//ä½¿ç”¨åŸºäºJDBCçš„å®ç°</span></span><br><span class="line">    repository.setDataSource(dataSource);   <span class="comment">//é…ç½®æ•°æ®æº</span></span><br><span class="line">  	repository.setCreateTableOnStartup(<span class="literal">true</span>);   <span class="comment">//å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºç”¨äºå­˜å‚¨Tokençš„è¡¨ï¼ˆå»ºè®®ç¬¬ä¸€æ¬¡å¯åŠ¨ä¹‹ååˆ é™¤è¯¥è¡Œï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> repository;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">.and()</span><br><span class="line">.rememberMe()</span><br><span class="line">.rememberMeParameter(<span class="string">&quot;remember&quot;</span>)</span><br><span class="line">.tokenRepository(repository)</span><br><span class="line">.tokenValiditySeconds(<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>)  <span class="comment">//Tokençš„æœ‰æ•ˆæ—¶é—´ï¼ˆç§’ï¼‰é»˜è®¤ä¸º14å¤©</span></span><br></pre></td></tr></table></figure>

<p>ç¨åæœåŠ¡å™¨å¯åŠ¨æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä¸€ä¸‹æ•°æ®åº“ï¼Œå¦‚æœå‡ºç°åä¸º<code>persistent_logins</code>çš„è¡¨ï¼Œé‚£ä¹ˆè¯æ˜é…ç½®æ²¡æœ‰é—®é¢˜ã€‚</p>
<p>å½“æˆ‘ä»¬ç™»é™†å¹¶å‹¾é€‰äº†è®°ä½æˆ‘ä¹‹åï¼Œé‚£ä¹ˆæ•°æ®åº“ä¸­ä¼šæ–°å¢ä¸€æ¡Tokenè®°å½•ã€‚</p>
<hr>
<h2 id="SecurityContext"><a href="#SecurityContext" class="headerlink" title="SecurityContext"></a>SecurityContext</h2><p>ç”¨æˆ·ç™»å½•ä¹‹åï¼Œæ€ä¹ˆè·å–å½“å‰å·²ç»ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯å‘¢ï¼Ÿé€šè¿‡ä½¿ç”¨SecurityContextHolderå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¾—åˆ°SecurityContextå¯¹è±¡äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨SecurityContextå¯¹è±¡æ¥è·å–å½“å‰çš„è®¤è¯ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SecurityContext</span> <span class="variable">context</span> <span class="operator">=</span> SecurityContextHolder.getContext();</span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> context.getAuthentication();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) authentication.getPrincipal();</span><br><span class="line">        System.out.println(user.getUsername());</span><br><span class="line">        System.out.println(user.getAuthorities());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡SecurityContextæˆ‘ä»¬å°±å¯ä»¥å¿«é€Ÿè·å–å½“å‰ç”¨æˆ·çš„åç§°å’Œæˆæƒä¿¡æ¯ç­‰ã€‚</p>
<p>é™¤äº†è¿™ç§æ–¹å¼ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥ä»Sessionä¸­è·å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(<span class="meta">@SessionAttribute(&quot;SPRING_SECURITY_CONTEXT&quot;)</span> SecurityContext context)</span>&#123;</span><br><span class="line">    <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> context.getAuthentication();</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) authentication.getPrincipal();</span><br><span class="line">    System.out.println(user.getUsername());</span><br><span class="line">    System.out.println(user.getAuthorities());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„SecurityContextHolderæ˜¯æœ‰ä¸€å®šçš„å­˜å‚¨ç­–ç•¥çš„ï¼ŒSecurityContextHolderä¸­çš„SecurityContextå¯¹è±¡ä¼šåœ¨ä¸€å¼€å§‹è¯·æ±‚åˆ°æ¥æ—¶è¢«è®¾å®šï¼Œè‡³äºå­˜å‚¨æ–¹å¼å…¶å®æ˜¯ç”±å­˜å‚¨ç­–ç•¥å†³å®šçš„ï¼Œå¦‚æœæˆ‘ä»¬è¿™æ ·ç¼–å†™ï¼Œé‚£ä¹ˆåœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯æ— æ³•è·å–åˆ°è®¤è¯ä¿¡æ¯çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;   <span class="comment">//åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹å»è·å–</span></span><br><span class="line">        <span class="type">SecurityContext</span> <span class="variable">context</span> <span class="operator">=</span> SecurityContextHolder.getContext();</span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> context.getAuthentication();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) authentication.getPrincipal();   <span class="comment">//NPE</span></span><br><span class="line">        System.out.println(user.getUsername());</span><br><span class="line">        System.out.println(user.getAuthorities()); </span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºSecurityContextHolderçš„å­˜å‚¨ç­–ç•¥é»˜è®¤æ˜¯<code>MODE_THREADLOCAL</code>ï¼Œå®ƒæ˜¯åŸºäºThreadLocalå®ç°çš„ï¼Œ<code>getContext()</code>æ–¹æ³•æœ¬è´¨ä¸Šè°ƒç”¨çš„æ˜¯å¯¹åº”çš„å­˜å‚¨ç­–ç•¥å®ç°çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> SecurityContext <span class="title function_">getContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> strategy.getContext();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SecurityContextHolderStrategyæœ‰ä¸‰ä¸ªå®ç°ç±»ï¼š</p>
<ul>
<li>GlobalSecurityContextHolderStrategyï¼šå…¨å±€æ¨¡å¼ï¼Œä¸å¸¸ç”¨</li>
<li>ThreadLocalSecurityContextHolderStrategyï¼šåŸºäºThreadLocalå®ç°ï¼Œçº¿ç¨‹å†…å¯è§</li>
<li>InheritableThreadLocalSecurityContextHolderStrategyï¼šåŸºäºInheritableThreadLocalå®ç°ï¼Œçº¿ç¨‹å’Œå­çº¿ç¨‹å¯è§</li>
</ul>
<p>å› æ­¤ï¼Œå¦‚æœä¸Šè¿°æƒ…å†µéœ€è¦åœ¨å­çº¿ç¨‹ä¸­è·å–ï¼Œé‚£ä¹ˆéœ€è¦ä¿®æ”¹SecurityContextHolderçš„å­˜å‚¨ç­–ç•¥ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™è®¾ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">    SecurityContextHolder.setStrategyName(SecurityContextHolder.MODE_INHERITABLETHREADLOCAL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·åœ¨å­çº¿ç¨‹ä¸­ä¹Ÿå¯ä»¥è·å–è®¤è¯ä¿¡æ¯äº†ã€‚</p>
<p>å› ä¸ºç”¨æˆ·çš„éªŒè¯ä¿¡æ¯æ˜¯åŸºäºSecurityContextè¿›è¡Œåˆ¤æ–­çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹SecurityContextçš„å†…å®¹ï¼Œæ¥æ‰‹åŠ¨ä¸ºç”¨æˆ·è¿›è¡Œç™»é™†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/auth&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">auth</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">SecurityContext</span> <span class="variable">context</span> <span class="operator">=</span> SecurityContextHolder.getContext();  <span class="comment">//è·å–SecurityContextå¯¹è±¡ï¼ˆå½“å‰ä¼šè¯è‚¯å®šæ˜¯æ²¡æœ‰ç™»é™†çš„ï¼‰</span></span><br><span class="line">    <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">token</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(<span class="string">&quot;Test&quot;</span>, <span class="literal">null</span>,</span><br><span class="line">            AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="string">&quot;ROLE_user&quot;</span>));  <span class="comment">//æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªUsernamePasswordAuthenticationTokenå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·çš„è®¤è¯ä¿¡æ¯ï¼Œè§’è‰²éœ€è¦æ·»åŠ ROLE_å‰ç¼€ï¼Œæƒé™ç›´æ¥å†™</span></span><br><span class="line">    context.setAuthentication(token);  <span class="comment">//æ‰‹åŠ¨ä¸ºSecurityContextè®¾å®šè®¤è¯ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login successï¼&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æœªç™»é™†çš„æƒ…å†µä¸‹ï¼Œè®¿é—®æ­¤åœ°å€å°†ç›´æ¥è¿›è¡Œæ‰‹åŠ¨ç™»é™†ï¼Œå†æ¬¡è®¿é—®<code>/index</code>é¡µé¢ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼Œè¯´æ˜æ‰‹åŠ¨è®¾ç½®è®¤è¯ä¿¡æ¯æˆåŠŸã€‚</p>
<p><strong>ç–‘æƒ‘ï¼š</strong>SecurityContextè¿™ç©æ„ä¸æ˜¯é»˜è®¤çº¿ç¨‹ç‹¬å å—ï¼Œé‚£æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼ŒæŒ‰ç†è¯´ä¸Šä¸€æ¬¡çš„SecurityContextå¯¹è±¡åº”è¯¥æ²¡äº†æ‰å¯¹å•Šï¼Œä¸ºä»€ä¹ˆå†æ¬¡è¯·æ±‚ä¾ç„¶èƒ½å¤Ÿç»§ç»­ä½¿ç”¨ä¸Šä¸€æ¬¡SecurityContextä¸­çš„è®¤è¯ä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>SecurityContextçš„ç”Ÿå‘½å‘¨æœŸï¼šè¯·æ±‚åˆ°æ¥æ—¶ä»Sessionä¸­å–å‡ºï¼Œæ”¾å…¥SecurityContextHolderä¸­ï¼Œè¯·æ±‚ç»“æŸæ—¶ä»SecurityContextHolderå–å‡ºï¼Œå¹¶æ”¾åˆ°Sessionä¸­ï¼Œå®é™…ä¸Šå°±æ˜¯ä¾é Sessionæ¥å­˜å‚¨çš„ï¼Œä¸€æ—¦ä¼šè¯è¿‡æœŸéªŒè¯ä¿¡æ¯ä¹Ÿè·Ÿç€æ¶ˆå¤±ã€‚</p>
<hr>
<h2 id="SpringSecurityåŸç†"><a href="#SpringSecurityåŸç†" class="headerlink" title="SpringSecurityåŸç†"></a>SpringSecurityåŸç†</h2><p><strong>æ³¨æ„ï¼š</strong>æœ¬å°èŠ‚å†…å®¹ä½œä¸ºé€‰å­¦å†…å®¹ï¼Œä½†æ˜¯éš¾åº¦æ¯”å‰ä¸¤ç« çš„æºç éƒ¨åˆ†ç®€å•å¾—å¤šã€‚</p>
<p>æœ€åæˆ‘ä»¬å†æ¥èŠä¸€ä¸‹SpringSecurityçš„å®ç°åŸç†ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¾é Nä¸ªFilterå®ç°çš„ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¿‡æ»¤é“¾ï¼ˆæ³¨æ„è¿™é‡Œæ˜¯è¿‡æ»¤å™¨ï¼Œä¸æ˜¯æ‹¦æˆªå™¨ï¼‰</p>
<p>æˆ‘ä»¬å°±ä»<code>AbstractSecurityWebApplicationInitializer</code>å¼€å§‹ä¸‹æ‰‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒé…ç½®äº†ä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ­¤æ–¹æ³•ä¼šåœ¨å¯åŠ¨æ—¶è¢«è°ƒç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">onStartup</span><span class="params">(ServletContext servletContext)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.beforeSpringSecurityFilterChain(servletContext);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.configurationClasses != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">AnnotationConfigWebApplicationContext</span> <span class="variable">rootAppContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigWebApplicationContext</span>();</span><br><span class="line">        rootAppContext.register(<span class="built_in">this</span>.configurationClasses);</span><br><span class="line">        servletContext.addListener(<span class="keyword">new</span> <span class="title class_">ContextLoaderListener</span>(rootAppContext));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.enableHttpSessionEventPublisher()) &#123;</span><br><span class="line">        servletContext.addListener(<span class="string">&quot;org.springframework.security.web.session.HttpSessionEventPublisher&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    servletContext.setSessionTrackingModes(<span class="built_in">this</span>.getSessionTrackingModes());</span><br><span class="line">  	<span class="comment">//é‡ç‚¹åœ¨è¿™é‡Œï¼Œè¿™é‡Œæ’å…¥äº†å…³é”®çš„FilterChain</span></span><br><span class="line">    <span class="built_in">this</span>.insertSpringSecurityFilterChain(servletContext);</span><br><span class="line">    <span class="built_in">this</span>.afterSpringSecurityFilterChain(servletContext);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertSpringSecurityFilterChain</span><span class="params">(ServletContext servletContext)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">filterName</span> <span class="operator">=</span> <span class="string">&quot;springSecurityFilterChain&quot;</span>;</span><br><span class="line">  	<span class="comment">//åˆ›å»ºäº†ä¸€ä¸ªDelegatingFilterProxyå¯¹è±¡ï¼Œå®ƒæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªFilter</span></span><br><span class="line">    <span class="type">DelegatingFilterProxy</span> <span class="variable">springSecurityFilterChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DelegatingFilterProxy</span>(filterName);</span><br><span class="line">    <span class="type">String</span> <span class="variable">contextAttribute</span> <span class="operator">=</span> <span class="built_in">this</span>.getWebApplicationContextAttribute();</span><br><span class="line">    <span class="keyword">if</span> (contextAttribute != <span class="literal">null</span>) &#123;</span><br><span class="line">        springSecurityFilterChain.setContextAttribute(contextAttribute);</span><br><span class="line">    &#125;</span><br><span class="line">		<span class="comment">//é€šè¿‡ServletContextæ³¨å†ŒDelegatingFilterProxyè¿™ä¸ªFilter</span></span><br><span class="line">    <span class="built_in">this</span>.registerFilter(servletContext, <span class="literal">true</span>, filterName, springSecurityFilterChain);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹çœ‹ï¼Œ<code>DelegatingFilterProxy</code>åœ¨åšä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿™ä¸ªæ˜¯åˆå§‹åŒ–æ–¹æ³•ï¼Œå®ƒç”±GenericFilterBeanï¼ˆçˆ¶ç±»ï¼‰å®šä¹‰ï¼Œåœ¨afterPropertiesSetæ–¹æ³•ä¸­è¢«è°ƒç”¨</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initFilterBean</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="built_in">this</span>.delegateMonitor) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.delegate == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.targetBeanName == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.targetBeanName = <span class="built_in">this</span>.getFilterName();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">WebApplicationContext</span> <span class="variable">wac</span> <span class="operator">=</span> <span class="built_in">this</span>.findWebApplicationContext();</span><br><span class="line">            <span class="keyword">if</span> (wac != <span class="literal">null</span>) &#123;</span><br><span class="line">              	<span class="comment">//è€å¿ƒç‚¹ï¼Œå¥—å¨ƒå¾ˆæ­£å¸¸</span></span><br><span class="line">                <span class="built_in">this</span>.delegate = <span class="built_in">this</span>.initDelegate(wac);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Filter <span class="title function_">initDelegate</span><span class="params">(WebApplicationContext wac)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">targetBeanName</span> <span class="operator">=</span> <span class="built_in">this</span>.getTargetBeanName();</span><br><span class="line">    Assert.state(targetBeanName != <span class="literal">null</span>, <span class="string">&quot;No target bean name set&quot;</span>);</span><br><span class="line">  	<span class="comment">//è¿™é‡Œé€šè¿‡WebApplicationContextè·å–äº†ä¸€ä¸ªBean</span></span><br><span class="line">    <span class="type">Filter</span> <span class="variable">delegate</span> <span class="operator">=</span> (Filter)wac.getBean(targetBeanName, Filter.class);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.isTargetFilterLifecycle()) &#123;</span><br><span class="line">        delegate.init(<span class="built_in">this</span>.getFilterConfig());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//è¿”å›Filter</span></span><br><span class="line">    <span class="keyword">return</span> delegate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªæ–­ç‚¹æ¥æŸ¥çœ‹åˆ°åº•è·å–åˆ°äº†ä»€ä¹ˆBeanã€‚</p>
<p>é€šè¿‡æ–­ç‚¹è°ƒè¯•ï¼Œæˆ‘ä»¬å‘ç°è¿™é‡Œæ”¾å›çš„å¯¹è±¡æ˜¯ä¸€ä¸ªFilterChainProxyç±»å‹çš„ï¼Œå¹¶ä¸”è°ƒç”¨äº†å®ƒçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œä½†æ˜¯FilterChainProxyç±»ä¸­å¹¶æ²¡æœ‰é‡å†™<code>init</code>æ–¹æ³•æˆ–æ˜¯<code>initFilterBean</code>æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬å€’å›å»çœ‹ï¼Œå½“Filterè¿”å›ä¹‹åï¼Œ<code>DelegatingFilterProxy</code>çš„ä¸€ä¸ªæˆå‘˜å˜é‡<code>delegate</code>è¢«èµ‹å€¼ä¸ºå¾—åˆ°çš„Filterï¼Œä¹Ÿå°±æ˜¯FilterChainProxyå¯¹è±¡ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œ<code>DelegatingFilterProxy</code>æ˜¯å¦‚ä½•æ‰§è¡ŒdoFilteræ–¹æ³•çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">Filter</span> <span class="variable">delegateToUse</span> <span class="operator">=</span> <span class="built_in">this</span>.delegate;</span><br><span class="line">    <span class="keyword">if</span> (delegateToUse == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//éæ­£å¸¸æƒ…å†µï¼Œè¿™é‡Œçœç•¥...</span></span><br><span class="line">    &#125;</span><br><span class="line">		<span class="comment">//è¿™é‡Œæ‰æ˜¯çœŸæ­£çš„è°ƒç”¨ï¼Œåˆ«å¿˜äº†delegateToUseå°±æ˜¯åˆå§‹åŒ–çš„FilterChainProxyå¯¹è±¡</span></span><br><span class="line">    <span class="built_in">this</span>.invokeDelegate(delegateToUse, request, response, filterChain);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">invokeDelegate</span><span class="params">(Filter delegate, ServletRequest request, ServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">  <span class="comment">//æœ€åå®é™…ä¸Šè°ƒç”¨çš„æ˜¯FilterChainProxyçš„doFilteræ–¹æ³•</span></span><br><span class="line">    delegate.doFilter(request, response, filterChain);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œ<code>FilterChainProxy</code>çš„doFilteræ–¹æ³•åˆåœ¨å¹²ä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">clearContext</span> <span class="operator">=</span> request.getAttribute(FILTER_APPLIED) == <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (!clearContext) &#123;</span><br><span class="line">      	<span class="comment">//çœŸæ­£çš„è¿‡æ»¤åœ¨è¿™é‡Œæ‰§è¡Œ</span></span><br><span class="line">        <span class="built_in">this</span>.doFilterInternal(request, response, chain);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="type">FirewalledRequest</span> <span class="variable">firewallRequest</span> <span class="operator">=</span> <span class="built_in">this</span>.firewall.getFirewalledRequest((HttpServletRequest)request);</span><br><span class="line">    <span class="type">HttpServletResponse</span> <span class="variable">firewallResponse</span> <span class="operator">=</span> <span class="built_in">this</span>.firewall.getFirewalledResponse((HttpServletResponse)response);</span><br><span class="line">  	<span class="comment">//è¿™é‡Œè·å–äº†ä¸€ä¸ªFilteråˆ—è¡¨ï¼Œå®é™…ä¸ŠSpringSecurityå°±æ˜¯ç”±Nä¸ªè¿‡æ»¤å™¨å®ç°çš„ï¼Œè¿™é‡Œè·å–çš„éƒ½æ˜¯SpringSecurityæä¾›çš„è¿‡æ»¤å™¨</span></span><br><span class="line">  	<span class="comment">//ä½†æ˜¯è¯·æ³¨æ„ï¼Œç»è¿‡æˆ‘ä»¬ä¹‹å‰çš„åˆ†æï¼Œå®é™…ä¸ŠçœŸæ­£æ³¨å†Œçš„Filteråªæœ‰DelegatingFilterProxy</span></span><br><span class="line">  	<span class="comment">//è€Œè¿™é‡Œçš„Filteråˆ—è¡¨ä¸­çš„æ‰€æœ‰Filterå¹¶æ²¡æœ‰è¢«æ³¨å†Œï¼Œè€Œæ˜¯åœ¨è¿™é‡Œè¿›è¡Œå†…éƒ¨è°ƒç”¨</span></span><br><span class="line">    List&lt;Filter&gt; filters = <span class="built_in">this</span>.getFilters((HttpServletRequest)firewallRequest);</span><br><span class="line">  	<span class="comment">//åªè¦Filteråˆ—è¡¨ä¸æ˜¯ç©ºï¼Œå°±ä¾æ¬¡æ‰§è¡Œå†…ç½®çš„Filter</span></span><br><span class="line">    <span class="keyword">if</span> (filters != <span class="literal">null</span> &amp;&amp; filters.size() != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(LogMessage.of(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Securing &quot;</span> + requestLine(firewallRequest);</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">				<span class="comment">//è¿™é‡Œåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„è¿‡æ»¤é“¾ï¼Œè¿‡æ»¤æµç¨‹æ˜¯ç”±SpringSecurityè‡ªå·±å®ç°çš„</span></span><br><span class="line">        FilterChainProxy.<span class="type">VirtualFilterChain</span> <span class="variable">virtualFilterChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterChainProxy</span>.VirtualFilterChain(firewallRequest, chain, filters);</span><br><span class="line">      	<span class="comment">//è°ƒç”¨è™šæ‹Ÿè¿‡æ»¤é“¾çš„doFilter</span></span><br><span class="line">        virtualFilterChain.doFilter(firewallRequest, firewallResponse);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(LogMessage.of(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;No security for &quot;</span> + requestLine(firewallRequest);</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        firewallRequest.reset();</span><br><span class="line">        chain.doFilter(firewallRequest, firewallResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è™šæ‹Ÿè¿‡æ»¤é“¾çš„doFilteræ˜¯æ€ä¹ˆå¤„ç†çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//çœ‹ä¼¼æ²¡æœ‰ä»»ä½•å¾ªç¯ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œæ˜¯ä¸€ä¸ªé€’å½’è°ƒç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">  	<span class="comment">//åˆ¤æ–­æ˜¯å¦å·²ç»é€šè¿‡å…¨éƒ¨çš„å†…ç½®è¿‡æ»¤å™¨ï¼Œå®šä½æ˜¯å¦ç­‰äºå½“å‰å¤§å°</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.currentPosition == <span class="built_in">this</span>.size) &#123;</span><br><span class="line">        <span class="keyword">if</span> (FilterChainProxy.logger.isDebugEnabled()) &#123;</span><br><span class="line">            FilterChainProxy.logger.debug(LogMessage.of(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Secured &quot;</span> + FilterChainProxy.requestLine(<span class="built_in">this</span>.firewalledRequest);</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.firewalledRequest.reset();</span><br><span class="line">      	<span class="comment">//æ‰€æœ‰çš„å†…ç½®è¿‡æ»¤å™¨å·²ç»å®Œæˆï¼ŒæŒ‰ç…§æ­£å¸¸æµç¨‹èµ°DelegatingFilterProxyçš„ä¸‹ä¸€ä¸ªFilter</span></span><br><span class="line">      	<span class="comment">//ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œä¹‹åå°±ä¸DelegatingFilterProxyæ²¡æœ‰ä»»ä½•å…³ç³»äº†ï¼Œè¯¥èµ°å…¶ä»–è¿‡æ»¤å™¨å°±èµ°å…¶ä»–åœ°æ–¹é…ç½®çš„è¿‡æ»¤å™¨ï¼ŒSpringSecurityçš„è¿‡æ»¤æ“ä½œå·²ç»ç»“æŸ</span></span><br><span class="line">        <span class="built_in">this</span>.originalChain.doFilter(request, response);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      	<span class="comment">//å®šä½è‡ªå¢</span></span><br><span class="line">        ++<span class="built_in">this</span>.currentPosition;</span><br><span class="line">      	<span class="comment">//è·å–å½“å‰å®šä½çš„Filter</span></span><br><span class="line">        <span class="type">Filter</span> <span class="variable">nextFilter</span> <span class="operator">=</span> (Filter)<span class="built_in">this</span>.additionalFilters.get(<span class="built_in">this</span>.currentPosition - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (FilterChainProxy.logger.isTraceEnabled()) &#123;</span><br><span class="line">            FilterChainProxy.logger.trace(LogMessage.format(<span class="string">&quot;Invoking %s (%d/%d)&quot;</span>, nextFilter.getClass().getSimpleName(), <span class="built_in">this</span>.currentPosition, <span class="built_in">this</span>.size));</span><br><span class="line">        &#125;</span><br><span class="line">				<span class="comment">//æ‰§è¡Œå†…éƒ¨è¿‡æ»¤å™¨çš„doFilteræ–¹æ³•ï¼Œä¼ å…¥å½“å‰å¯¹è±¡æœ¬èº«ä½œä¸ºFilterï¼Œæ‰§è¡Œå¦‚æœæˆåŠŸï¼Œé‚£ä¹ˆä¸€å®šä¼šå†æ¬¡è°ƒç”¨å½“å‰å¯¹è±¡çš„doFilteræ–¹æ³•</span></span><br><span class="line">      	<span class="comment">//å¯èƒ½æœ€ä¸ç†è§£çš„å°±æ˜¯è¿™é‡Œï¼Œæ‰§è¡Œçš„éš¾é“ä¸æ˜¯å†…éƒ¨å…¶ä»–Filterçš„doFilteræ–¹æ³•å—ï¼Œæ€ä¹ˆä¼šè®©å½“å‰å¯¹è±¡çš„doFilteræ–¹æ³•é€’å½’è°ƒç”¨å‘¢ï¼Ÿ</span></span><br><span class="line">      	<span class="comment">//æ²¡å…³ç³»ï¼Œäº†è§£äº†å…¶ä¸­ä¸€ä¸ªå†…éƒ¨è¿‡æ»¤å™¨å°±æ˜ç™½äº†</span></span><br><span class="line">        nextFilter.doFilter(request, response, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œæˆ‘ä»¬å·®ä¸å¤šå·²ç»äº†è§£äº†æ•´ä¸ªSpringSecurityçš„å®ç°æœºåˆ¶äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹å‡ ä¸ªå†…éƒ¨çš„è¿‡æ»¤å™¨åˆ†åˆ«åœ¨åšä»€ä¹ˆã€‚</p>
<p>æ¯”å¦‚ç”¨äºå¤„ç†ç™»é™†çš„è¿‡æ»¤å™¨<code>UsernamePasswordAuthenticationFilter</code>ï¼Œå®ƒç»§æ‰¿è‡ª<code>AbstractAuthenticationProcessingFilter</code>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆè¿›è¡Œè¿‡æ»¤çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="built_in">this</span>.doFilter((HttpServletRequest)request, (HttpServletResponse)response, chain);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">  	<span class="comment">//å¦‚æœä¸æ˜¯ç™»é™†è¯·æ±‚ï¼Œé‚£ä¹ˆæ ¹æœ¬ä¸ä¼šç†è¿™ä¸ªè¯·æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.requiresAuthentication(request, response)) &#123;</span><br><span class="line">      	<span class="comment">//ç›´æ¥è°ƒç”¨ä¼ å…¥çš„FilterChainçš„doFilteræ–¹æ³•</span></span><br><span class="line">      	<span class="comment">//è€Œè¿™é‡Œä¼ å…¥çš„æ­£å¥½æ˜¯VirtualFilterChainå¯¹è±¡</span></span><br><span class="line">      	<span class="comment">//è¿™ä¸‹çŸ¥é“ä¸ºä»€ä¹ˆä¸Šé¢è¯´æ˜¯é€’å½’äº†å§</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      	<span class="comment">//å¦‚æœæ˜¯ç™»é™†è¯·æ±‚ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œç™»é™†è¯·æ±‚çš„ç›¸å…³é€»è¾‘ï¼Œæ³¨æ„æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°ä»»ä½•é—®é¢˜éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">      	<span class="comment">//æ¯”å¦‚ç”¨æˆ·åå’Œå¯†ç é”™è¯¯ï¼Œæˆ‘ä»¬ä¹‹å‰ä¹Ÿå·²ç»æµ‹è¯•è¿‡äº†ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªBadCredentialsException</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          	<span class="comment">//è¿›è¡Œè®¤è¯</span></span><br><span class="line">            <span class="type">Authentication</span> <span class="variable">authenticationResult</span> <span class="operator">=</span> <span class="built_in">this</span>.attemptAuthentication(request, response);</span><br><span class="line">            <span class="keyword">if</span> (authenticationResult == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.sessionStrategy.onAuthentication(authenticationResult, request, response);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.continueChainBeforeSuccessfulAuthentication) &#123;</span><br><span class="line">                chain.doFilter(request, response);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          	<span class="comment">//å¦‚æœä¸€è·¯ç»¿ç¯ï¼Œæ²¡æœ‰æŠ¥é”™ï¼Œé‚£ä¹ˆéªŒè¯æˆåŠŸï¼Œæ‰§è¡ŒsuccessfulAuthentication</span></span><br><span class="line">            <span class="built_in">this</span>.successfulAuthentication(request, response, chain, authenticationResult);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InternalAuthenticationServiceException var5) &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.error(<span class="string">&quot;An internal error occurred while trying to authenticate the user.&quot;</span>, var5);</span><br><span class="line">          	<span class="comment">//éªŒè¯å¤±è´¥ï¼Œä¼šæ‰§è¡ŒunsuccessfulAuthentication</span></span><br><span class="line">            <span class="built_in">this</span>.unsuccessfulAuthentication(request, response, var5);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AuthenticationException var6) &#123;</span><br><span class="line">            <span class="built_in">this</span>.unsuccessfulAuthentication(request, response, var6);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹successfulAuthenticationå’ŒunsuccessfulAuthenticationåˆ†åˆ«åšäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">successfulAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">  	<span class="comment">//å‘SecurityContextHolderæ·»åŠ è®¤è¯ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡SecurityContextHolderå¯¹è±¡è·å–å½“å‰ç™»é™†çš„ç”¨æˆ·</span></span><br><span class="line">    SecurityContextHolder.getContext().setAuthentication(authResult);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isDebugEnabled()) &#123;</span><br><span class="line">        <span class="built_in">this</span>.logger.debug(LogMessage.format(<span class="string">&quot;Set SecurityContextHolder to %s&quot;</span>, authResult));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//è®°ä½æˆ‘å®ç°</span></span><br><span class="line">    <span class="built_in">this</span>.rememberMeServices.loginSuccess(request, response, authResult);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.eventPublisher != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">InteractiveAuthenticationSuccessEvent</span>(authResult, <span class="built_in">this</span>.getClass()));</span><br><span class="line">    &#125;</span><br><span class="line">		</span><br><span class="line">  	<span class="comment">//è°ƒç”¨é»˜è®¤çš„æˆ–æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„AuthenticationSuccessHandlerçš„onAuthenticationSuccessæ–¹æ³•</span></span><br><span class="line">  	<span class="comment">//è¿™ä¸ªæ ¹æ®æˆ‘ä»¬é…ç½®æ–‡ä»¶å†³å®š</span></span><br><span class="line">  	<span class="comment">//åˆ°è¿™é‡Œå…¶å®é¡µé¢å°±å·²ç»ç›´æ¥è·³è½¬äº†</span></span><br><span class="line">    <span class="built_in">this</span>.successHandler.onAuthenticationSuccess(request, response, authResult);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">unsuccessfulAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException failed)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">  	<span class="comment">//ç™»é™†å¤±è´¥ä¼šç›´æ¥æ¸…ç†æ‰SecurityContextHolderä¸­çš„è®¤è¯ä¿¡æ¯</span></span><br><span class="line">    SecurityContextHolder.clearContext();</span><br><span class="line">    <span class="built_in">this</span>.logger.trace(<span class="string">&quot;Failed to process authentication request&quot;</span>, failed);</span><br><span class="line">    <span class="built_in">this</span>.logger.trace(<span class="string">&quot;Cleared SecurityContextHolder&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.logger.trace(<span class="string">&quot;Handling authentication failure&quot;</span>);</span><br><span class="line">  	<span class="comment">//ç™»é™†å¤±è´¥çš„è®°ä½æˆ‘å¤„ç†</span></span><br><span class="line">    <span class="built_in">this</span>.rememberMeServices.loginFail(request, response);</span><br><span class="line">  	<span class="comment">//åŒä¸Šï¼Œè°ƒç”¨é»˜è®¤æˆ–æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„AuthenticationFailureHandler</span></span><br><span class="line">    <span class="built_in">this</span>.failureHandler.onAuthenticationFailure(request, response, failed);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>äº†è§£äº†æ•´ä¸ªç”¨æˆ·éªŒè¯å®ç°æµç¨‹ï¼Œå…¶å®å…¶å®ƒçš„è¿‡æ»¤å™¨æ˜¯å¦‚ä½•å®ç°çš„ä¹Ÿå°±å¾ˆå®¹æ˜“è”æƒ³åˆ°äº†ï¼ŒSpringSecurityçš„è¿‡æ»¤å™¨ä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªå¤„ç†ä¸šåŠ¡çš„Servletï¼Œå®ƒåšçš„äº‹æƒ…ä¸åƒæ˜¯æ‹¦æˆªï¼Œæ›´åƒæ˜¯å®Œæˆè‡ªå·±å¯¹åº”çš„èŒè´£ï¼Œåªä¸è¿‡æ˜¯ä½¿ç”¨äº†è¿‡æ»¤å™¨æœºåˆ¶è¿›è¡Œå®ç°ç½¢äº†ã€‚</p>
<p>SecurityContextPersistenceFilterä¹Ÿæ˜¯å†…ç½®çš„Filterï¼Œå¯ä»¥å°è¯•é˜…è¯»ä¸€ä¸‹å…¶æºç ï¼Œäº†è§£æ•´ä¸ªSecurityContextHolderçš„è¿ä½œåŸç†ï¼Œè¿™é‡Œå…ˆè¯´ä¸€ä¸‹å¤§è‡´æµç¨‹ï¼Œå„ä½å¯ä»¥ä¾ç…§æ•´ä¸ªæµç¨‹æŒ‰ç…§æºç è¿›è¡Œæ¨å¯¼ï¼š</p>
<p>å½“è¿‡æ»¤å™¨é“¾æ‰§è¡Œåˆ°SecurityContextPersistenceFilteræ—¶ï¼Œå®ƒä¼šä»HttpSessionä¸­æŠŠSecurityContextå¯¹è±¡å–å‡ºæ¥ï¼ˆæ˜¯å­˜åœ¨Sessionä¸­çš„ï¼Œè·Ÿéšä¼šè¯çš„æ¶ˆå¤±è€Œæ¶ˆå¤±ï¼‰ï¼Œç„¶åæ”¾å…¥SecurityContextHolderå¯¹è±¡ä¸­ã€‚è¯·æ±‚ç»“æŸåï¼Œå†æŠŠSecurityContextå­˜å…¥HttpSessionä¸­ï¼Œå¹¶æ¸…é™¤SecurityContextHolderå†…çš„SecurityContextå¯¹è±¡ã€‚</p>
<hr>
<h2 id="å®Œå–„åŠŸèƒ½"><a href="#å®Œå–„åŠŸèƒ½" class="headerlink" title="å®Œå–„åŠŸèƒ½"></a>å®Œå–„åŠŸèƒ½</h2><p>åœ¨äº†è§£äº†SpringSecurityçš„å¤§éƒ¨åˆ†åŠŸèƒ½åï¼Œæˆ‘ä»¬å°±æ¥å°†æ•´ä¸ªç½‘ç«™çš„å†…å®¹è¿›è¡Œå®Œå–„ï¼Œç™»é™†ç›®å‰å·²ç»å®ç°äº†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>æ³¨å†ŒåŠŸèƒ½ï¼ˆä»…é’ˆå¯¹äºå­¦ç”Ÿï¼‰</li>
<li>è§’è‰²åˆ†ä¸ºåŒå­¦å’Œç®¡ç†å‘˜<ul>
<li>ç®¡ç†å‘˜è´Ÿè´£ä¸Šæ¶ã€åˆ é™¤ã€æ›´æ–°ä¹¦ç±ï¼ŒæŸ¥çœ‹æ‰€æœ‰åŒå­¦çš„å€Ÿé˜…åˆ—è¡¨</li>
<li>åŒå­¦å¯ä»¥å€Ÿé˜…å’Œå½’è¿˜ä¹¦ç±ï¼Œä»¥åŠæŸ¥çœ‹è‡ªå·±çš„å€Ÿé˜…åˆ—è¡¨</li>
</ul>
</li>
</ul>
<p>å¼€å§‹ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆé…ç½®ä¸€ä¸‹Thymeleafçš„SpringSecurityæ‰©å±•ï¼Œå®ƒé’ˆå¯¹SpringSecurityæä¾›äº†æ›´å¤šé¢å¤–çš„è§£æï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é…ç½®æ¨¡æ¿å¼•æ“Bean</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SpringTemplateEngine <span class="title function_">springTemplateEngine</span><span class="params">(<span class="meta">@Autowired</span> ITemplateResolver resolver)</span>&#123;</span><br><span class="line">    <span class="type">SpringTemplateEngine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringTemplateEngine</span>();</span><br><span class="line">    engine.setTemplateResolver(resolver);</span><br><span class="line">    engine.addDialect(<span class="keyword">new</span> <span class="title class_">SpringSecurityDialect</span>());   <span class="comment">//æ·»åŠ é’ˆå¯¹äºSpringSecurityçš„æ–¹è¨€</span></span><br><span class="line">    <span class="keyword">return</span> engine;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:sec</span>=<span class="string">&quot;http://www.thymeleaf.org/extras/spring-security&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹ä¸€ç« å°±æ˜¯æœ€åä¸€ç« äº†ï¼Œæˆ‘ä»¬ä¼šæ·±å…¥è®²è§£MySQLçš„é«˜çº§éƒ¨åˆ†ï¼ŒåŒ…æ‹¬å‡½æ•°ã€å­˜å‚¨è¿‡ç¨‹ã€é”æœºåˆ¶ã€ç´¢å¼•ä»¥åŠå­˜å‚¨å¼•æ“ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>SSM</tag>
      </tags>
  </entry>
  <entry>
    <title>SSMç¬”è®°-4</title>
    <url>/2022/04/23/JavaSSM%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/</url>
    <content><![CDATA[<h1 id="MySQLé«˜çº§"><a href="#MySQLé«˜çº§" class="headerlink" title="MySQLé«˜çº§"></a>MySQLé«˜çº§</h1><p>åœ¨JavaWebé˜¶æ®µï¼Œæˆ‘ä»¬åˆæ­¥è®¤è¯†äº†MySQLæ•°æ®åº“ï¼ŒåŒ…æ‹¬ä¸€äº›åŸºæœ¬æ“ä½œï¼Œæ¯”å¦‚åˆ›å»ºæ•°æ®åº“ã€è¡¨ã€è§¦å‘å™¨ï¼Œä»¥åŠæœ€åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ã€äº‹åŠ¡ç­‰æ“ä½œã€‚è€Œåœ¨æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬å°†ç»§ç»­æ·±å…¥å­¦ä¹ MySQLï¼Œäº†è§£å®ƒçš„æ›´å¤šé«˜çº§ç©æ³•ï¼Œä¹Ÿç›¸å½“äºè¿›è¡Œå¤ä¹ ã€‚</p>
<h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>å…¶å®å‡½æ•°æˆ‘ä»¬åœ¨ä¹‹å‰å·²ç»æ¥è§¦åˆ°ä¸€éƒ¨åˆ†äº†ï¼Œåœ¨JavaWebé˜¶æ®µï¼Œæˆ‘ä»¬äº†è§£äº†èšé›†å‡½æ•°ï¼Œèšé›†å‡½æ•°ä¸€èˆ¬ç”¨ä½œç»Ÿè®¡ï¼ŒåŒ…æ‹¬ï¼š</p>
<span id="more"></span>

<ul>
<li>count([distinct]*)    ç»Ÿè®¡æ‰€æœ‰çš„è¡Œæ•°ï¼ˆdistinctè¡¨ç¤ºå»é‡å†ç»Ÿè®¡ï¼Œä¸‹åŒï¼‰</li>
<li>count([distinct]åˆ—å)    ç»Ÿè®¡æŸåˆ—çš„å€¼æ€»å’Œ</li>
<li>sum([distinct]åˆ—å)    æ±‚ä¸€åˆ—çš„å’Œï¼ˆæ³¨æ„å¿…é¡»æ˜¯æ•°å­—ç±»å‹çš„ï¼‰</li>
<li>avg([distinct]åˆ—å)    æ±‚ä¸€åˆ—çš„å¹³å‡å€¼ï¼ˆæ³¨æ„å¿…é¡»æ˜¯æ•°å­—ç±»å‹ï¼‰</li>
<li>max([distinct]åˆ—å)    æ±‚ä¸€åˆ—çš„æœ€å¤§å€¼</li>
<li>min([distinct]åˆ—å)    æ±‚ä¸€åˆ—çš„æœ€å°å€¼</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦è®¡ç®—æŸä¸ªè¡¨ä¸€å…±æœ‰å¤šå°‘è¡Œï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä½¿ç”¨COUNTèšé›†å‡½æ•°ï¼Œå°±å¯ä»¥å¿«é€Ÿç»Ÿè®¡å¹¶å¾—åˆ°ç»“æœï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è®¡ç®—æŸä¸€åˆ—ä¸Šæ‰€æœ‰æ•°å­—çš„å’Œï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(sid) <span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡SUMèšé›†å‡½æ•°ï¼Œå°±å¯ä»¥å¿«é€Ÿè®¡ç®—æ¯ä¸€åˆ—çš„å’Œï¼Œå®é™…ä¸Šè¿™äº›å‡½æ•°éƒ½æ˜¯ç”±ç³»ç»Ÿæä¾›çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p>
<p>æœ¬ç‰ˆå—æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»å„ç±»ç³»ç»Ÿå‡½æ•°ä»¥åŠå¦‚ä½•ç¼–å†™è‡ªå®šä¹‰å‡½æ•°ã€‚</p>
<h3 id="ç³»ç»Ÿå‡½æ•°"><a href="#ç³»ç»Ÿå‡½æ•°" class="headerlink" title="ç³»ç»Ÿå‡½æ•°"></a>ç³»ç»Ÿå‡½æ•°</h3><p>ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„å‡½æ•°ä¹Ÿæ˜¯éå¸¸å®ç”¨çš„ï¼Œæˆ‘ä»¬å°†ä¼šåˆ†ä¸ºå‡ ä¸ªç±»å‹è¿›è¡Œè®²è§£ã€‚</p>
<h4 id="å­—ç¬¦ä¸²å‡½æ•°"><a href="#å­—ç¬¦ä¸²å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²å‡½æ•°"></a>å­—ç¬¦ä¸²å‡½æ•°</h4><p>å¤„ç†å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²å‡½æ•°æ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå¤„ç†å­—ç¬¦ä¸²ï¼Œå…¶ä¸­å¸¸ç”¨æ¯”å¦‚ç”¨äºå­—ç¬¦ä¸²åˆ†å‰²çš„å‡½æ•°æœ‰ï¼š</p>
<ul>
<li>substring(å­—ç¬¦ä¸², èµ·å§‹ä½ç½®, ç»“æŸä½ç½®)     åŒJavaä¸­Stringç±»çš„substringä¸€è‡´ï¼Œä½†æ˜¯æ³¨æ„ä¸‹æ ‡æ˜¯ä»1å¼€å§‹ï¼Œä¸‹åŒ</li>
<li>left(å­—ç¬¦ä¸², é•¿åº¦)     ä»æœ€å·¦è¾¹å‘å³æˆªå–å­—ç¬¦ä¸²</li>
<li>right(å­—ç¬¦ä¸², é•¿åº¦)     ä»æœ€å³è¾¹å‘å·¦æˆªå–å­—ç¬¦ä¸²</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬åªæƒ³è·å–æ‰€æœ‰å­¦ç”Ÿå§“åçš„ç¬¬äºŒä¸ªå­—ï¼Œé‚£ä¹ˆå¯ä»¥åƒè¿™æ ·å†™ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUBSTRING</span>(name, <span class="number">2</span>, <span class="number">2</span>) <span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚æˆ‘ä»¬æƒ³è·å–æ‰€æœ‰å­¦ç”Ÿå§“åçš„ç¬¬ä¸€ä¸ªå­—ï¼Œå¯ä»¥åƒè¿™æ ·å†™ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(name, <span class="number">1</span>) <span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨å­—ç¬¦ä¸²å‡½æ•°æ¥å¿«é€Ÿå°†æ‰€æœ‰çš„å­—æ¯è½¬æ¢ä¸ºå¤§å†™å­—æ¯æˆ–æ˜¯å¿«é€Ÿè½¬æ¢ä¸ºå°å†™å­—æ¯ï¼š</p>
<ul>
<li>upper(å­—ç¬¦ä¸²)     å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—æ¯è½¬æ¢ä¸ºå¤§å†™å­—æ¯</li>
<li>lower(å­—ç¬¦ä¸²)     å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—æ¯è½¬æ¢ä¸ºå°å†™å­—æ¯</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›å°†ä¸€ä¸ªå­—ç¬¦ä¸²æ‰€æœ‰å­—ç¬¦ä¸“ä¸ºå¤§å†™ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(<span class="string">&#x27;abcdefg&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åƒJavaä¸­é‚£æ ·ç›´æ¥å¯¹å­—ç¬¦ä¸²ä¸­çš„å†…å®¹è¿›è¡Œæ›¿æ¢ï¼š</p>
<ul>
<li>replace(å­—ç¬¦ä¸², åŸæ–‡, æ›¿æ¢æ–‡)      åŒJavaä¸­Stringçš„replaceæ•ˆæœ</li>
</ul>
<p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬å¸Œæœ›å°†æŸ¥è¯¢åˆ°çš„æ‰€æœ‰åŒå­¦çš„åç§°ä¸­çš„<code>å°</code>å…¨éƒ¨æ›¿æ¢<code>å¤§</code>ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> REPLACE(`name`, <span class="string">&#x27;å°&#x27;</span>, <span class="string">&#x27;å¤§&#x27;</span>) <span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure>

<p>å­—ç¬¦ä¸²ä¹Ÿæ”¯æŒè¿›è¡Œæ‹¼æ¥ï¼Œç³»ç»Ÿæä¾›äº†å­—ç¬¦ä¸²çš„æ‹¼æ¥å‡½æ•°ï¼š</p>
<ul>
<li>concat(å­—ç¬¦ä¸²1, å­—ç¬¦ä¸²2)   è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›å°†æŸ¥è¯¢åˆ°çš„æ‰€æœ‰åŒå­¦çš„åç§°æœ€åéƒ½æ·»åŠ ä¸€ä¸ª<code>å­</code>å­—ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> concat(name, <span class="string">&#x27;å­&#x27;</span>) <span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure>

<p>æœ€åå°±æ˜¯è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦ï¼š</p>
<ul>
<li>length(å­—ç¬¦ä¸²)    è·å–å­—ç¬¦ä¸²é•¿åº¦ï¼ˆæ³¨æ„å¦‚æœä½¿ç”¨çš„æ˜¯UTF-8ç¼–ç æ ¼å¼ï¼Œé‚£ä¹ˆä¸€ä¸ªæ±‰å­—å 3å­—èŠ‚ï¼Œæ•°å­—å’Œå­—æ¯å ä¸€ä¸ªå­—èŠ‚ï¼‰</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬è¦è·å–æ‰€æœ‰äººåå­—çš„é•¿åº¦ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LENGTH(`name`) <span class="keyword">FROM</span> student</span><br></pre></td></tr></table></figure>

<h4 id="æ—¥æœŸå‡½æ•°"><a href="#æ—¥æœŸå‡½æ•°" class="headerlink" title="æ—¥æœŸå‡½æ•°"></a>æ—¥æœŸå‡½æ•°</h4><p>MySQLæä¾›çš„æ—¥æœŸå‡½æ•°ä¹Ÿéå¸¸å®ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿå¯¹æ—¥æœŸè¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦å¿«é€Ÿå°†æ—¥æœŸæ·»åŠ Nå¤©ï¼Œå°±å¯ä»¥ä½¿ç”¨ï¼š</p>
<ul>
<li>date_add(æ—¥æœŸ, interval å¢é‡ å•ä½)</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›è®©2022-1-1å‘å5å¤©ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2022-1-1&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">5</span> <span class="keyword">day</span>)</span><br></pre></td></tr></table></figure>

<p>åŒç†ï¼Œå‘å‰1å¹´ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_ADD(<span class="string">&#x27;2022-1-1&#x27;</span>,<span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">year</span>)</span><br></pre></td></tr></table></figure>

<p>å•ä½æœ‰ï¼šyearï¼ˆå¹´ï¼‰ã€monthï¼ˆæœˆï¼‰ã€dayï¼ˆæ—¥ï¼‰ã€hourï¼ˆå°æ—¶ï¼‰ã€minuteï¼ˆåˆ†é’Ÿï¼‰ã€secondï¼ˆç§’ï¼‰</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥å¿«é€Ÿè®¡ç®—æ—¥æœŸçš„é—´éš”å¤©æ•°ï¼š</p>
<ul>
<li>datediff(æ—¥æœŸ1, æ—¥æœŸ2)</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬æƒ³è®¡ç®—2022å¹´çš„2æœˆæœ‰å¤šå°‘å¤©ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATEDIFF(<span class="string">&#x27;2022-3-1&#x27;</span>,<span class="string">&#x27;2022-2-1&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬æƒ³å¿«é€Ÿè·å–å½“å‰æ—¶é—´çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›ï¼š</p>
<ul>
<li>curdate()     å½“å‰çš„æ—¥æœŸ</li>
<li>curtime()     å½“å‰çš„æ—¶é—´</li>
<li>now()    å½“å‰çš„æ—¥æœŸ+æ—¶é—´</li>
</ul>
<p>æ­¤å‡½æ•°ä¹‹å‰æˆ‘ä»¬åœ¨ç¼–å†™å®æˆ˜é¡¹ç›®çš„æ—¶å€™å·²ç»ä½¿ç”¨è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬è·å–æ—¶é—´ä¸­çš„æŸä¸ªå€¼ï¼š</p>
<ul>
<li>day(æ—¥æœŸ)    è·å–æ—¥æœŸæ˜¯å‡ å·</li>
<li>month(æ—¥æœŸ)   è·å–æ—¥æœŸæ˜¯å‡ æœˆ</li>
<li>year(æ—¥æœŸ)      è·å–æ—¥æœŸæ˜¯å“ªä¸€å¹´</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬æƒ³è·å–ä»Šå¤©æ˜¯å‡ å·ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(NOW())</span><br></pre></td></tr></table></figure>

<h4 id="æ•°å­¦å‡½æ•°"><a href="#æ•°å­¦å‡½æ•°" class="headerlink" title="æ•°å­¦å‡½æ•°"></a>æ•°å­¦å‡½æ•°</h4><p>æ•°å­¦å‡½æ•°æ¯”è¾ƒå¸¸è§„ï¼ŒåŸºæœ¬ä¸Javaçš„Mathå·¥å…·ç±»ä¸€è‡´ï¼Œè¿™é‡Œåˆ—å‡ºå³å¯ï¼Œå„ä½å¯ä»¥è‡ªè¡Œå°è¯•ï¼š</p>
<ul>
<li>abs(x)   æ±‚xçš„ç»å¯¹å€¼</li>
<li>ceiling(x)   xå‘ä¸Šå–æ•´</li>
<li>floor(x)  xå‘ä¸‹å–æ•´</li>
<li>round(x, ç²¾åº¦)  xå–å››èˆäº”å…¥ï¼Œéµå¾ªå°æ•°ç‚¹ç²¾åº¦ </li>
<li>exp(x)   eçš„xæ¬¡æ–¹</li>
<li>rand()   0-1ä¹‹é—´çš„éšæœºæ•°</li>
<li>log(x)    xçš„å¯¹æ•°</li>
<li>pi()     Ï€</li>
<li>power(x, n)    xçš„næ¬¡æ–¹</li>
<li>sqrt(x)     xçš„å¹³æ–¹æ ¹</li>
<li>sin(x)  cos(x)   tan(x)     ä¸‰è§’å‡½æ•°ï¼ˆè²Œä¼¼æ²¡æœ‰arctanè¿™ç±»åå‡½æ•°ï¼Ÿï¼‰</li>
</ul>
<h4 id="ç±»å‹è½¬æ¢å‡½æ•°"><a href="#ç±»å‹è½¬æ¢å‡½æ•°" class="headerlink" title="ç±»å‹è½¬æ¢å‡½æ•°"></a>ç±»å‹è½¬æ¢å‡½æ•°</h4><p>MySQLçš„ç±»å‹è½¬æ¢ä¹Ÿåˆ†ä¸ºéšå¼ç±»å‹è½¬æ¢å’Œæ˜¾ç¤ºç±»å‹è½¬æ¢ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹éšå¼ç±»å‹è½¬æ¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span><span class="operator">+</span><span class="string">&#x27;2&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è™½ç„¶è¿™å¥ä¸­æ—¢åŒ…å«äº†æ•°å­—å’Œå­—ç¬¦ï¼Œä½†æ˜¯å­—ç¬¦ä¸²ä¼šè¢«è¿›è¡Œéšå¼è½¬æ¢ï¼ˆæ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯æŒ‰ç…§å­—ç¬¦çš„ASCIIç è½¬æ¢ï¼Œè€Œæ˜¯å†™çš„å¤šå°‘è¡¨ç¤ºå¤šå°‘ï¼‰æ‰€ä»¥æœ€åå¾—åˆ°çš„å°±æ˜¯1+2çš„ç»“æœä¸º3</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="number">1</span>, <span class="string">&#x27;2&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå› ä¸ºéœ€è¦ä¼ å…¥å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬ç»™çš„æ˜¯1è¿™ä¸ªæ•°å­—ï¼Œå› æ­¤è¿™é‡Œä¹Ÿä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œ1ä¼šè¢«ç›´æ¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„â€™1â€™ï¼Œæ‰€ä»¥è¿™é‡Œå¾—åˆ°çš„ç»“æœæ˜¯â€™12â€™</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢æ¥å°†å¾—åˆ°çš„æ•°æ®è½¬æ¢æˆæˆ‘ä»¬éœ€è¦çš„æ•°æ®ç±»å‹ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ°ç±»å‹è½¬æ¢å‡½æ•°äº†ï¼ŒMySQLæä¾›äº†ï¼š</p>
<ul>
<li>cast(æ•°æ®   as æ•°æ®ç±»å‹)</li>
</ul>
<p>æ•°æ®ç±»å‹æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>BINARY[(N)] ï¼šäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè½¬æ¢åé•¿åº¦å°äºNä¸ªå­—èŠ‚</li>
<li>CHAR[(N)] ï¼šå­—ç¬¦ä¸²ï¼Œè½¬æ¢åé•¿åº¦å°äºNä¸ªå­—ç¬¦</li>
<li>DATE ï¼šæ—¥æœŸ</li>
<li>DATETIME ï¼šæ—¥æœŸæ—¶é—´</li>
<li>DECIMAL[(M[,N])] ï¼šæµ®ç‚¹æ•°ï¼ŒMä¸ºæ•°å­—æ€»ä½æ•°(åŒ…æ‹¬æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†)ï¼ŒNä¸ºå°æ•°ç‚¹åçš„ä½æ•°</li>
<li>SIGNED [INTEGER] ï¼šæœ‰ç¬¦å·æ•´æ•°</li>
<li>TIME ï¼šæ—¶é—´</li>
<li>UNSIGNED [INTEGER] ï¼šæ— ç¬¦å·æ•´æ•°</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦å°†ä¸€ä¸ªæµ®ç‚¹æ•°è½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•°ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CAST</span>(pi() <span class="keyword">AS</span> SIGNED)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œæ‰«æï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ä¸€æ—¦é‡åˆ°éæ•°å­—çš„å­—ç¬¦ï¼Œä¼šåœæ­¢æ‰«æï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CAST</span>(<span class="string">&#x27;123abc456&#x27;</span> <span class="keyword">as</span> SIGNED)</span><br></pre></td></tr></table></figure>

<p>é™¤äº†castä»¥å¤–è¿˜æœ‰convertå‡½æ•°ï¼ŒåŠŸèƒ½æ¯”è¾ƒç›¸ä¼¼ï¼Œè¿™é‡Œå°±ä¸åšè®²è§£äº†ã€‚</p>
<h4 id="æµç¨‹æ§åˆ¶å‡½æ•°"><a href="#æµç¨‹æ§åˆ¶å‡½æ•°" class="headerlink" title="æµç¨‹æ§åˆ¶å‡½æ•°"></a>æµç¨‹æ§åˆ¶å‡½æ•°</h4><p>MySQLè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šçš„é€»è¾‘åˆ¤æ–­å‡½æ•°ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>if(æ¡ä»¶è¡¨è¾¾å¼, ç»“æœ1, ç»“æœ2)    ä¸Javaä¸­çš„ä¸‰ç›®è¿ç®—ç¬¦ä¸€è‡´ a &gt; b ? â€œAAAâ€ : â€œBBBâ€</li>
<li>ifnull(å€¼1, å€¼2)     å¦‚æœå€¼1ä¸ºNULLåˆ™è¿”å›å€¼2ï¼Œå¦åˆ™è¿”å›å€¼1</li>
<li>nullif(å€¼1, å€¼2)     å¦‚æœå€¼1ä¸å€¼2ç›¸ç­‰ï¼Œé‚£ä¹ˆè¿”å›NULL</li>
<li>isnull(å€¼)      åˆ¤æ–­å€¼æ˜¯å¦ä¸ºNULL</li>
</ul>
<p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬æƒ³åˆ¤æ–­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IF(<span class="number">1</span> <span class="operator">&lt;</span> <span class="number">0</span>,<span class="string">&#x27;lbwnb&#x27;</span>,<span class="string">&#x27;yyds&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡åˆ¤æ–­å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œä¸€äº›æ¡ä»¶åˆ¤æ–­æ“ä½œã€‚</p>
<p>é™¤äº†IFæ¡ä»¶åˆ¤æ–­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç±»ä¼¼Switchä¸€æ ·çš„è¯­å¥å®Œæˆå¤šåˆ†æ”¯ç»“æ„ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">CASE</span> <span class="number">2</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">		<span class="number">10</span></span><br><span class="line">	<span class="keyword">ELSE</span></span><br><span class="line">		<span class="number">5</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è‡ªå®šä¹‰çš„åˆ¤æ–­æ¡ä»¶æ”¾å…¥Whenä¹‹åï¼Œå®ƒç±»ä¼¼äºelse-ifï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">3</span><span class="operator">&gt;</span><span class="number">5</span> <span class="keyword">THEN</span></span><br><span class="line">		<span class="number">10</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">0</span><span class="operator">&lt;</span><span class="number">1</span> <span class="keyword">THEN</span></span><br><span class="line">		<span class="number">11</span></span><br><span class="line">	<span class="keyword">ELSE</span></span><br><span class="line">		<span class="number">5</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼äºJavaä¸­çš„Thread.sleepçš„å‡½æ•°ï¼Œä»¥ç§’ä¸ºå•ä½ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> sleep(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>æœ‰å…³MySQL8.0æ–°å¢çš„çª—å£å‡½æ•°è¿™é‡Œæš‚æ—¶ä¸åšä»‹ç»ã€‚</p>
<h3 id="è‡ªå®šä¹‰å‡½æ•°"><a href="#è‡ªå®šä¹‰å‡½æ•°" class="headerlink" title="è‡ªå®šä¹‰å‡½æ•°"></a>è‡ªå®šä¹‰å‡½æ•°</h3><p>é™¤äº†ä½¿ç”¨ç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„å‡½æ•°ä»¥å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å‡½æ•°ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°è¿›è¡Œæ•°æ®å¤„ç†ï¼Œå”¯ä¸€æ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯å‡½æ•°å®šä¹‰åä¸èƒ½ä¿®æ”¹ï¼Œåªèƒ½åˆ äº†é‡æ–°å†™ã€‚</p>
<h4 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h4><p>MySQLçš„å‡½æ•°ä¸Javaä¸­çš„æ–¹æ³•ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥æ·»åŠ å‚æ•°å’Œè¿”å›å€¼ï¼Œå¯ä»¥é€šè¿‡<code>CREATE FUNCTION</code>åˆ›å»ºå‡½æ•°ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> test() <span class="keyword">RETURNS</span> <span class="type">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">RETURN</span> <span class="number">666</span>;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>å®šä¹‰å‡½æ•°çš„æ ¼å¼ä¸ºï¼š</p>
<ul>
<li>create function å‡½æ•°åç§°([å‚æ•°åˆ—è¡¨]) returns è¿”å›å€¼ç±»å‹</li>
<li>begin å’Œ end ä¹‹é—´å†™å‡½æ•°çš„å…¶ä»–é€»è¾‘ï¼Œbeginå’Œendå°±ç›¸å½“äºJavaä¸­çš„èŠ±æ‹¬å·<code>&#123;  ...  &#125;</code></li>
<li>returnåç´§è·Ÿè¿”å›çš„ç»“æœ</li>
</ul>
<p>æ·»åŠ å‚æ•°ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å‡½æ•°åç§°æ‹¬å·ä¸­æ·»åŠ å³å¯ï¼Œæ³¨æ„ç±»å‹éœ€è¦å†™åœ¨å‚æ•°åç§°åé¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> test(i <span class="type">INT</span>) <span class="keyword">RETURNS</span> <span class="type">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">RETURN</span> i <span class="operator">*</span> i;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥åœ¨BEGINå’ŒRETURNä¹‹é—´ç¼–å†™ä¸€äº›å…¶ä»–çš„é€»è¾‘ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦å®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå¹¶ä¸ºå…¶èµ‹å€¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> a <span class="type">INT</span>;</span><br><span class="line"><span class="keyword">SET</span> a <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">RETURN</span> i <span class="operator">*</span> i <span class="operator">*</span> a;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>å®šä¹‰å±€éƒ¨å˜é‡çš„æ ¼å¼ä¸ºï¼š</p>
<ul>
<li>declare å˜é‡åç§° å˜é‡ç±»å‹ [, â€¦]</li>
<li>declare å˜é‡åç§° å˜é‡ç±»å‹ default é»˜è®¤å€¼</li>
</ul>
<p>ä¸ºå˜é‡èµ‹å€¼çš„æ ¼å¼ä¸ºï¼š</p>
<ul>
<li>set å˜é‡åç§° = å€¼</li>
</ul>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨<code>select</code>è¯­å¥ï¼Œå®ƒå¯ä»¥ç›´æ¥ä»è¡¨ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å¯ä»¥ç»“åˆintoå…³é”®å­—å°†æŸ¥è¯¢ç»“æœèµ‹å€¼ç»™å˜é‡ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> a <span class="type">INT</span>;</span><br><span class="line"><span class="comment">-- select into from è¯­å¥</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> a <span class="keyword">FROM</span> student;</span><br><span class="line"><span class="keyword">RETURN</span> a;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<h4 id="æµç¨‹æ§åˆ¶"><a href="#æµç¨‹æ§åˆ¶" class="headerlink" title="æµç¨‹æ§åˆ¶"></a>æµç¨‹æ§åˆ¶</h4><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨æµç¨‹æ§åˆ¶è¯­å¥ï¼Œå…¶ä¸­æœ€å…³é”®çš„å°±æ˜¯IFåˆ¤æ–­è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> a <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">10</span>;</span><br><span class="line">IF a <span class="operator">&gt;</span> <span class="number">10</span> <span class="keyword">THEN</span></span><br><span class="line">	<span class="keyword">RETURN</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">ELSE</span></span><br><span class="line">	<span class="keyword">RETURN</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>IFåˆ†æ”¯è¯­å¥çš„æ ¼å¼ä¸ºï¼š</p>
<ul>
<li>if åˆ¤æ–­æ¡ä»¶ then  â€¦ else if åˆ¤æ–­æ¡ä»¶ then â€¦. else â€¦ end if;</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ç»“åˆ<code>exists</code>å…³é”®å­—æ¥åˆ¤æ–­æ˜¯å¦ä¸ºNULLï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> a <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">-- IF EXISTS(SELECT * FROM student WHERE sid = 100) THEN</span></span><br><span class="line">IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sid <span class="operator">=</span> <span class="number">100</span>) <span class="keyword">THEN</span></span><br><span class="line">	<span class="keyword">SET</span> a <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">RETURN</span> a;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å‡½æ•°ä¸­ä½¿ç”¨switchè¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> a <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">CASE</span> a</span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">10</span> <span class="keyword">THEN</span></span><br><span class="line">		<span class="keyword">RETURN</span> <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">ELSE</span></span><br><span class="line">		<span class="keyword">RETURN</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>SWITCHåˆ†æ”¯è¯­å¥çš„æ ¼å¼ä¸ºï¼š</p>
<ul>
<li>case å˜é‡ when å…·ä½“å€¼æˆ–æ˜¯å¸ƒå°”è¡¨è¾¾å¼ then â€¦ when * then â€¦ else â€¦ end case;</li>
</ul>
<p>ä¸Javaä¸åŒçš„æ˜¯ï¼Œå®ƒæ”¯æŒä½¿ç”¨å¸ƒå°”è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> a <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">	<span class="keyword">WHEN</span> <span class="number">1</span> <span class="operator">&lt;</span> <span class="number">5</span> <span class="keyword">THEN</span></span><br><span class="line">		<span class="keyword">SET</span> a <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">	<span class="keyword">ELSE</span></span><br><span class="line">		<span class="keyword">SET</span> a <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line"><span class="keyword">RETURN</span> a;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä»¥ç±»ä¼¼äºelseifçš„å½¢å¼è¿›è¡Œåˆ¤æ–­ï¼Œå…¶å®å’Œä¸Šé¢ç›´æ¥ä½¿ç”¨æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹å¾ªç¯è¯­å¥ï¼ŒMySQLæä¾›äº†ä¸‰ç§å¾ªç¯è¯­å¥ï¼Œå…¶ä¸­ç¬¬ä¸€ç§æ˜¯WHILEè¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> a <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">10</span>;</span><br><span class="line">WHILE a <span class="operator">&lt;</span> <span class="number">11</span> DO</span><br><span class="line">	<span class="keyword">SET</span> a <span class="operator">=</span> a <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> WHILE;</span><br><span class="line"><span class="keyword">RETURN</span> a;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>æ ¼å¼ä¸ºï¼š</p>
<ul>
<li>while å¾ªç¯æ¡ä»¶ do â€¦  end while;</li>
</ul>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ç¬¬äºŒç§å¾ªç¯è¯­å¥ï¼ŒLOOPå¾ªç¯ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> a <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">10</span>;</span><br><span class="line">lp1: LOOP</span><br><span class="line">  <span class="keyword">SET</span> a <span class="operator">=</span> a <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">	IF a <span class="operator">=</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">		LEAVE lp1; </span><br><span class="line">	<span class="keyword">END</span> IF; </span><br><span class="line"><span class="keyword">END</span> LOOP lp1;</span><br><span class="line"><span class="keyword">RETURN</span> a;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>ç›¸æ¯”whileè¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>LEAVE</code>ç²¾å‡†æ§åˆ¶ç»“æŸå“ªä¸ªå¾ªç¯ï¼Œæœ‰ç‚¹ç±»ä¼¼äºgotoè¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> a <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">lp1: LOOP</span><br><span class="line">  lp2: LOOP</span><br><span class="line">	<span class="keyword">SET</span> a <span class="operator">=</span> a <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">	IF a <span class="operator">&gt;</span> <span class="number">5</span> <span class="keyword">THEN</span></span><br><span class="line">		LEAVE lp1; </span><br><span class="line">	<span class="keyword">END</span> IF; </span><br><span class="line">	<span class="keyword">END</span> LOOP lp2;</span><br><span class="line"><span class="keyword">END</span> LOOP lp1;</span><br><span class="line"><span class="keyword">RETURN</span> a;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼äºJavaä¸­çš„gotoå†™æ³•ï¼ˆåœ¨JavaSEé˜¶æ®µå·²ç»è®²è§£è¿‡ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    lp1: <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        lp2: <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            a++;</span><br><span class="line">            <span class="keyword">if</span>(a &gt; <span class="number">5</span>) <span class="keyword">break</span> lp1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒçš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¾ªç¯åç§° loop â€¦(å¯ä»¥æ’å…¥leaveè¯­å¥ç»“æŸ) end loop å¾ªç¯åç§°;</li>
</ul>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹æœ€åä¸€ç§å¾ªç¯è¯­å¥ï¼Œrepeatè¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">DECLARE</span> a <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">REPEAT</span><br><span class="line">	<span class="keyword">SET</span> a <span class="operator">=</span> a <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">UNTIL a <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">END</span> REPEAT;</span><br><span class="line"><span class="keyword">RETURN</span> a;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>å®ƒç±»ä¼¼äºJavaä¸­çš„do-whileå¾ªç¯è¯­å¥ï¼Œå®ƒä¼šå…ˆå»æ‰§è¡Œé‡Œé¢çš„å†…å®¹ï¼Œå†è¿›è¡Œåˆ¤æ–­ï¼Œæ ¼å¼ä¸ºï¼š</p>
<ul>
<li>repeat â€¦ until ç»“æŸå¾ªç¯æ¡ä»¶ end repeat;</li>
</ul>
<h4 id="å…¨å±€å˜é‡"><a href="#å…¨å±€å˜é‡" class="headerlink" title="å…¨å±€å˜é‡"></a>å…¨å±€å˜é‡</h4><p>æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ä¸€æ¬¡ä¼šè¯ä¸­ç›´æ¥å®šä¹‰å˜é‡å¹¶ä½¿ç”¨ï¼Œè¿™æ—¶å®ƒå¹¶ä¸æ˜¯ä½äºå‡½æ•°å†…çš„ï¼Œè¿™å°±æ˜¯å…¨å±€å˜é‡ï¼Œå®ƒæ— éœ€é¢„å…ˆå®šä¹‰ï¼Œç›´æ¥ä½¿ç”¨å³å¯ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="variable">@x</span> <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å°†å…¨å±€å˜é‡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> test(<span class="variable">@x</span>);</span><br></pre></td></tr></table></figure>

<p>é™¤äº†æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å…¨éƒ¨å˜é‡ä»¥å¤–ï¼Œç³»ç»Ÿé»˜è®¤ä¹Ÿæœ‰å¾ˆå¤šçš„å˜é‡ï¼Œå› æ­¤æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å˜é‡ç§°ä¸ºç”¨æˆ·å˜é‡ï¼Œç³»ç»Ÿé»˜è®¤å˜é‡ç§°ä¸ºç³»ç»Ÿå˜é‡ã€‚æŸ¥çœ‹ç³»ç»Ÿå˜é‡çš„å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">GLOBAL</span> VARIABLES</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å­˜å‚¨è¿‡ç¨‹"><a href="#å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹"></a>å­˜å‚¨è¿‡ç¨‹</h2><p>å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ä¸ªåŒ…æ‹¬å¤šæ¡SQLè¯­å¥çš„é›†åˆï¼Œä¸“ç”¨äºç‰¹å®šè¡¨çš„ç‰¹å®šæ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰å®æˆ˜é¡¹ç›®ä¸­çš„åˆ›å»ºç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸€æ¬¡æ€§ä¸ºä¸¤å¼ è¡¨æ·»åŠ æ•°æ®ï¼Œä½†æ˜¯å¦‚æœä¸ä½¿ç”¨Javaï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½å»ä½¿ç”¨SQLå‘½ä»¤æ¥å®Œæˆï¼Œå°±éœ€è¦æ‰‹åŠ¨æ•²ä¸¤æ¬¡å‘½ä»¤ï¼Œéå¸¸éº»çƒ¦ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æå‰å°†è¿™äº›æ“ä½œå®šä¹‰å¥½ï¼Œé¢„ç•™å‡ºéœ€è¦å¡«å†™æ•°æ®çš„ä½ç½®ï¼Œä¸‹æ¬¡è¾“å…¥å‚æ•°ç›´æ¥è°ƒç”¨å³å¯ã€‚</p>
<p>è¿™é‡Œå¾ˆå®¹æ˜“ä¸å‡½æ•°ææ··æ·†ï¼Œå­˜å‚¨è¿‡ç¨‹ä¹Ÿæ˜¯æ‰§è¡Œå¤šæ¡SQLè¯­å¥ï¼Œä½†æ˜¯å®ƒä»¬çš„å‡ºå‘ç‚¹ä¸ä¸€æ ·ï¼Œå‡½æ•°æ˜¯ä¸“ç”¨äºè¿›è¡Œæ•°æ®å¤„ç†ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™è°ƒç”¨è€…ï¼Œå®ƒæ›´å¤šæƒ…å†µä¸‹æ˜¯ä¸€æ¡SQLè¯­å¥çš„å‚ä¸è€…ï¼Œæ— æ³•ç›´æ¥è¿è¡Œï¼Œå¹¶ä¸”ä¸æ¶‰åŠæŸä¸ªç‰¹å®šè¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure>

<p>è€Œå­˜å‚¨è¿‡ç¨‹æ˜¯å¤šæ¡SQLè¯­å¥çš„æ‰§è¡Œè€…ï¼Œè¿™æ˜¯å®ƒä»¬çš„æœ¬è´¨åŒºåˆ«ã€‚</p>
<p>å®šä¹‰å­˜å‚¨è¿‡ç¨‹ä¸å®šä¹‰å‡½æ•°æä¸ºç›¸ä¼¼ï¼Œå®ƒä¹Ÿå¯ä»¥åŒ…å«å‚æ•°ï¼Œå‡½æ•°ä¸­ä½¿ç”¨çš„è¯­å¥è¿™é‡Œä¹Ÿèƒ½ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰è¿”å›å€¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> lbwnb(`name` <span class="type">VARCHAR</span>(<span class="number">20</span>), pwd <span class="type">VARCHAR</span>(<span class="number">255</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> users(username, `password`) <span class="keyword">VALUES</span>(`name`, pwd);</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ç¼–å†™å¤šæ¡SQLè¯­å¥ï¼Œä½†æ˜¯æ³¨æ„ï¼ŒMySQLçš„å­˜å‚¨è¿‡ç¨‹ä¸å…·æœ‰åŸå­æ€§ï¼Œå½“å‡ºç°é”™è¯¯æ—¶ï¼Œå¹¶ä¸ä¼šå›æ»šä¹‹å‰çš„æ“ä½œï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬è‡ªå·±æ¥ç¼–å†™äº‹åŠ¡ä¿è¯åŸå­æ€§ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CALL</span> lbwnb(<span class="string">&#x27;111&#x27;</span>, <span class="string">&#x27;2222&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä½¿ç”¨<code>call</code>æ¥æ‰§è¡Œä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼Œå¦‚æœå­˜å‚¨è¿‡ç¨‹æœ‰å‚æ•°ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å¡«å†™å‚æ•°ã€‚</p>
<p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬æƒ³è¦å®ç°æŸ¥è¯¢ç”¨æˆ·è¡¨ï¼Œå¦‚æœåŒ…å«ç”¨æˆ·<code>test</code>é‚£ä¹ˆå°±åˆ é™¤ç”¨æˆ·ï¼Œå¦‚æœä¸åŒ…å«ï¼Œå°±æ·»åŠ ç”¨æˆ·ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> `lbwnb`()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;test&#x27;</span>) <span class="keyword">THEN</span></span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> users(username, `password`) <span class="keyword">VALUES</span>(<span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line">	<span class="keyword">ELSE</span></span><br><span class="line">		<span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">	<span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå…¶å®åªéœ€è¦ä¸€ä¸ªç®€å•çš„IFåˆ¤æ–­å³å¯å®ç°ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¸Œæœ›éå†ä¸€ä¸ªSELECTè¯­å¥æŸ¥è¯¢çš„ç»“æœå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¸¸æ ‡æ¥å®Œæˆï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> id <span class="type">INT</span>;</span><br><span class="line">	<span class="keyword">DECLARE</span> `name` <span class="type">VARCHAR</span>(<span class="number">10</span>);</span><br><span class="line">	<span class="keyword">DECLARE</span> sex <span class="type">VARCHAR</span>(<span class="number">5</span>);</span><br><span class="line">	<span class="keyword">DECLARE</span> cur <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student;</span><br><span class="line">	<span class="keyword">OPEN</span> cur;</span><br><span class="line">	WHILE <span class="literal">TRUE</span> DO</span><br><span class="line">		<span class="keyword">FETCH</span> cur <span class="keyword">INTO</span> id, `name`, sex;</span><br><span class="line">		<span class="keyword">SELECT</span> id, `name`, sex;</span><br><span class="line">	<span class="keyword">END</span> WHILE;</span><br><span class="line">	<span class="keyword">CLOSE</span> cur;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>æ¸¸æ ‡çš„ä½¿ç”¨åˆ†ä¸º4ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>DECLARE æ¸¸æ ‡åç§° CURSOR FOR æŸ¥è¯¢ç»“æœ   -  å®šä¹‰æ¸¸æ ‡</li>
<li>OPEN cur     -   å¼€å¯æ¸¸æ ‡</li>
<li>FETCH æ¸¸æ ‡åç§° INTO å­˜å‚¨ç»“æœçš„å˜é‡    -    ä»é¡¶éƒ¨å¼€å§‹ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡ï¼Œå‘ä¸‹ç§»åŠ¨ï¼Œå¦‚æœå·²ç»åœ¨æœ€åº•éƒ¨ï¼Œåˆ™è§¦å‘å¼‚å¸¸</li>
<li>CLOSE cur    -   å…³é—­æ¸¸æ ‡</li>
</ul>
<p>æˆ‘ä»¬è¿™é‡Œåˆ©ç”¨äº†ä¸€ä¸ªwhileå¾ªç¯æ¥å¤šæ¬¡é€šè¿‡æ¸¸æ ‡è·å–æŸ¥è¯¢ç»“æœï¼Œä½†æ˜¯æœ€åæ˜¯å› ä¸ºå‡ºç°å¼‚å¸¸æ‰é€€å‡ºçš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¹‹åçš„ä»£ç å°±æ— æ³•ç»§ç»­æ­£å¸¸è¿è¡Œäº†ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•å¤„ç†å¼‚å¸¸ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> id <span class="type">INT</span>;</span><br><span class="line">	<span class="keyword">DECLARE</span> `name` <span class="type">VARCHAR</span>(<span class="number">10</span>);</span><br><span class="line">	<span class="keyword">DECLARE</span> sex <span class="type">VARCHAR</span>(<span class="number">5</span>);</span><br><span class="line">	<span class="keyword">DECLARE</span> score <span class="type">INT</span>;</span><br><span class="line">	<span class="keyword">DECLARE</span> a <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">DECLARE</span> cur <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student;</span><br><span class="line">	<span class="comment">-- å¿…é¡»åœ¨æ¸¸æ ‡å®šä¹‰ä¹‹åç¼–å†™</span></span><br><span class="line">	<span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="number">1329</span> <span class="keyword">SET</span> a <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">OPEN</span> cur;</span><br><span class="line">	WHILE a <span class="operator">=</span> <span class="number">0</span> DO</span><br><span class="line">		<span class="keyword">FETCH</span> cur <span class="keyword">INTO</span> id, `name`, sex, score;</span><br><span class="line">		<span class="keyword">SELECT</span> id, `name`, sex, score;</span><br><span class="line">	<span class="keyword">END</span> WHILE;</span><br><span class="line">	<span class="keyword">CLOSE</span> cur;</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªå¼‚å¸¸å¤„ç†å™¨ï¼ˆå¥æŸ„ï¼‰ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>declear (continue/exit) handler for å¼‚å¸¸åç§°(ID) åšç‚¹ä»€ä¹ˆ</li>
</ul>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é™å®šå­˜å‚¨è¿‡ç¨‹çš„å‚æ•°ä¼ é€’ï¼Œæ¯”å¦‚æˆ‘ä»¬åªå¸Œæœ›ç”¨æˆ·ç»™æˆ‘ä»¬ä¸€ä¸ªå‚æ•°ç”¨äºæ¥æ”¶æ•°æ®ï¼Œè€Œä¸æ˜¯å€¼ä¼ é€’ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è®¾å®šä¸ºOUTç±»å‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> `lbwnb`(<span class="keyword">OUT</span> a <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> a;</span><br><span class="line">	<span class="keyword">SET</span> a <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰çš„å‚æ•°é»˜è®¤ä¸º<code>IN</code>ç±»å‹ï¼Œä¹Ÿå°±æ˜¯åªèƒ½ä½œä¸ºä¼ å…¥å‚æ•°ï¼Œæ— æ³•ä¸ºå…¶èµ‹å€¼ï¼Œè€Œè¿™é‡Œè®²å‚æ•°è®¾å®šä¸º<code>OUT</code>ç±»å‹ï¼Œé‚£ä¹ˆå‚æ•°æ— æ³•å°†å€¼ä¼ å…¥ï¼Œè€Œåªèƒ½è¢«èµ‹å€¼ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æ—¢å¸Œæœ›å‚æ•°å¯ä»¥ä¼ å…¥ä¹Ÿå¯ä»¥è¢«é‡æ–°èµ‹å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¿®æ”¹ä¸º<code>INOUT</code>ç±»å‹ã€‚</p>
<hr>
<h2 id="å­˜å‚¨å¼•æ“"><a href="#å­˜å‚¨å¼•æ“" class="headerlink" title="å­˜å‚¨å¼•æ“"></a>å­˜å‚¨å¼•æ“</h2><p>å­˜å‚¨å¼•æ“å°±åƒæˆ‘ä»¬ç”µè„‘ä¸­çš„CPUï¼Œå®ƒæ˜¯æ•´ä¸ªMySQLæœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œæ•°æ®åº“ä¸­çš„æ•°æ®å¦‚ä½•å­˜å‚¨ï¼Œæ•°æ®åº“èƒ½å¤Ÿæ”¯æŒå“ªäº›åŠŸèƒ½ï¼Œæˆ‘ä»¬çš„å¢åˆ æ”¹æŸ¥è¯·æ±‚å¦‚ä½•æ‰§è¡Œï¼Œéƒ½æ˜¯ç”±å­˜å‚¨å¼•æ“æ¥å†³å®šçš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å¤§è‡´äº†è§£ä¸€ä¸‹ä»¥ä¸‹ä¸‰ç§å­˜å‚¨å¼•æ“ï¼š</p>
<ul>
<li><strong>MyISAMï¼š</strong>MySQL5.5ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œåœ¨æ’å…¥å’ŒæŸ¥è¯¢çš„æƒ…å†µä¸‹æ€§èƒ½å¾ˆé«˜ï¼Œä½†æ˜¯å®ƒä¸æ”¯æŒäº‹åŠ¡ï¼Œåªèƒ½æ·»åŠ è¡¨çº§é”ã€‚</li>
<li><strong>InnoDBï¼š</strong>MySQL5.5ä¹‹åçš„é»˜è®¤å­˜å‚¨å¼•æ“ï¼Œå®ƒæ”¯æŒACIDäº‹åŠ¡ã€è¡Œçº§é”ã€å¤–é”®ï¼Œä½†æ˜¯æ€§èƒ½æ¯”ä¸è¿‡MyISAMï¼Œæ›´åŠ æ¶ˆè€—èµ„æºã€‚</li>
<li><strong>Memoryï¼š</strong>æ•°æ®éƒ½å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®åº“é‡å¯æˆ–å‘ç”Ÿå´©æºƒï¼Œè¡¨ä¸­çš„æ•°æ®éƒ½å°†æ¶ˆå¤±ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹MySQLæ”¯æŒçš„å­˜å‚¨å¼•æ“ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> engines;</span><br></pre></td></tr></table></figure>

<p>åœ¨åˆ›å»ºè¡¨æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºè¡¨æŒ‡å®šå…¶å­˜å‚¨å¼•æ“ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼Œåœ¨Windows 11ç³»ç»Ÿä¸‹ï¼ŒMySQLçš„é…ç½®æ–‡ä»¶é»˜è®¤æ”¾åœ¨<code>C:\ProgramData\MySQL\MySQL Server 5.7</code>ä¸­ï¼Œæ³¨æ„ProgramDataæ˜¯ä¸ªéšè—æ–‡ä»¶å¤¹ã€‚</p>
<hr>
<h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><p><strong>æ³¨æ„ï¼š</strong>æœ¬å°èŠ‚ä¼šæ¶‰åŠ<code>æ•°æ®ç»“æ„ä¸ç®—æ³•</code>ç›¸å…³çŸ¥è¯†ã€‚</p>
<p>ç´¢å¼•å°±å¥½åƒæˆ‘ä»¬ä¹¦çš„ç›®å½•ï¼Œæ¯æœ¬ä¹¦éƒ½æœ‰ä¸€ä¸ªç›®å½•ç”¨äºæˆ‘ä»¬å¿«é€Ÿå®šä½æˆ‘ä»¬æƒ³è¦çš„å†…å®¹åœ¨å“ªä¸€é¡µï¼Œç´¢å¼•ä¹Ÿæ˜¯ï¼Œé€šè¿‡å»ºç«‹ç´¢å¼•ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ç´¢å¼•æ¥å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„ä¸€æ¡è®°å½•ï¼Œå¤§å¤§æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<p>æœ¬ç‰ˆå—æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»ç´¢å¼•çš„å‡ ç§ç±»å‹ï¼Œä»¥åŠç´¢å¼•çš„åº•å±‚å­˜å‚¨åŸç†ã€‚</p>
<h3 id="å•åˆ—ç´¢å¼•"><a href="#å•åˆ—ç´¢å¼•" class="headerlink" title="å•åˆ—ç´¢å¼•"></a>å•åˆ—ç´¢å¼•</h3><p>å•åˆ—ç´¢å¼•åªé’ˆå¯¹äºæŸä¸€åˆ—æ•°æ®åˆ›å»ºç´¢å¼•ï¼Œå•åˆ—ç´¢å¼•æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p>
<ul>
<li><strong>NORMALï¼š</strong>æ™®é€šçš„ç´¢å¼•ç±»å‹ï¼Œå®Œå®Œå…¨å…¨ç›¸å½“äºä¸€æœ¬ä¹¦çš„ç›®å½•ã€‚</li>
<li><strong>UNIQUEï¼š</strong>å”¯ä¸€ç´¢å¼•ï¼Œæˆ‘ä»¬ä¹‹å‰å·²ç»ç”¨è¿‡äº†ï¼Œä¸€æ—¦å»ºç«‹å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆæ•´ä¸ªåˆ—ä¸­å°†ä¸å…è®¸å‡ºç°é‡å¤æ•°æ®ã€‚æ¯ä¸ªè¡¨çš„ä¸»é”®åˆ—ï¼Œéƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œå«åšPrimary Keyï¼Œå®ƒä¸ä»…ä»…è¦æ±‚ä¸å…è®¸å‡ºç°é‡å¤ï¼Œè¿˜è¦æ±‚ä¸èƒ½ä¸ºNULLï¼Œå®ƒè¿˜å¯ä»¥è‡ªåŠ¨é€’å¢ã€‚æ¯å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªPrimaryç´¢å¼•ã€‚</li>
<li><strong>SPATIALï¼š</strong>ç©ºé—´ç´¢å¼•ï¼Œç©ºé—´ç´¢å¼•æ˜¯å¯¹ç©ºé—´æ•°æ®ç±»å‹çš„å­—æ®µå»ºç«‹çš„ç´¢å¼•ï¼ŒMYSQLä¸­çš„ç©ºé—´æ•°æ®ç±»å‹æœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯GEOMETRYã€POINTã€LINESTRINGã€POLYGONï¼Œä¸æ˜¯å¾ˆå¸¸ç”¨ï¼Œè¿™é‡Œä¸åšä»‹ç»ã€‚</li>
<li><strong>FULLTEXTï¼š</strong>å…¨æ–‡ç´¢å¼•ï¼ˆMySQL 5.6 ä¹‹åInnoDBæ‰æ”¯æŒï¼‰ï¼Œå®ƒæ˜¯æ¨¡ç³ŠåŒ¹é…çš„ä¸€ç§æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒçš„æ•ˆç‡è¦æ¯”ä½¿ç”¨<code>like %</code>æ›´é«˜ï¼Œå¹¶ä¸”å®ƒè¿˜æ”¯æŒå¤šç§åŒ¹é…æ–¹å¼ï¼Œçµæ´»æ€§ä¹Ÿæ›´åŠ å¼ºå¤§ã€‚åªæœ‰å­—æ®µçš„æ•°æ®ç±»å‹ä¸º charã€varcharã€text åŠå…¶ç³»åˆ—æ‰å¯ä»¥å»ºå…¨æ–‡ç´¢å¼•ã€‚</li>
</ul>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼Œé¦–å…ˆåˆ›å»ºä¸€å¼ ç”¨äºæµ‹è¯•å…¨æ–‡ç´¢å¼•çš„è¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> articles (</span><br><span class="line">  id <span class="type">INT</span> UNSIGNED AUTO_INCREMENT <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  title <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">  body TEXT,</span><br><span class="line">  FULLTEXT (body));</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> articles <span class="keyword">VALUES</span></span><br><span class="line">	(<span class="keyword">NULL</span>,<span class="string">&#x27;MySQL Tutorial&#x27;</span>, <span class="string">&#x27;DBMS stands for DataBase ...&#x27;</span>),</span><br><span class="line">	(<span class="keyword">NULL</span>,<span class="string">&#x27;How To Use MySQL Efficiently&#x27;</span>, <span class="string">&#x27;After you went through a ...&#x27;</span>),</span><br><span class="line">	(<span class="keyword">NULL</span>,<span class="string">&#x27;Optimising MySQL&#x27;</span>,<span class="string">&#x27;In this tutorial we will show ...&#x27;</span>),</span><br><span class="line">	(<span class="keyword">NULL</span>,<span class="string">&#x27;1001 MySQL Tricks&#x27;</span>,<span class="string">&#x27;1. Never run mysqld as root. 2. ...&#x27;</span>),</span><br><span class="line">	(<span class="keyword">NULL</span>,<span class="string">&#x27;MySQL vs. YourSQL&#x27;</span>, <span class="string">&#x27;In the following database comparison ...&#x27;</span>),</span><br><span class="line">	(<span class="keyword">NULL</span>,<span class="string">&#x27;MySQL Security&#x27;</span>, <span class="string">&#x27;When configured properly, MySQL ...&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬ä½¿ç”¨å…¨æ–‡ç´¢å¼•è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> <span class="keyword">MATCH</span> (body) AGAINST (<span class="string">&#x27;database&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„å…¨æ–‡ç´¢å¼•å¦‚ä½•å®šä¹‰å­—æ®µçš„ï¼Œmatchä¸­å°±å¿…é¡»æ˜¯å“ªäº›å­—æ®µï¼Œagainstä¸­å®šä¹‰éœ€è¦æ¨¡ç³ŠåŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ç”¨ä½œæŸ¥æ‰¾çš„å­—ç¬¦ä¸²å®é™…ä¸Šæ˜¯è¢«åˆ†è¯ä¹‹åçš„ç»“æœï¼Œå¦‚æœè¿›è¡Œæ¨¡ç³ŠåŒ¹é…çš„ä¸æ˜¯ä¸€ä¸ªè¯è¯­ï¼Œé‚£ä¹ˆä¼šæŸ¥æ‰¾å¤±è´¥ï¼Œä½†æ˜¯å®ƒçš„æ•ˆç‡è¿œé«˜äºä»¥ä¸‹è¿™ç§å†™æ³•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> body <span class="keyword">like</span> <span class="string">&#x27;%database%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ç»„åˆç´¢å¼•"><a href="#ç»„åˆç´¢å¼•" class="headerlink" title="ç»„åˆç´¢å¼•"></a>ç»„åˆç´¢å¼•</h3><p>ç»„åˆç´¢å¼•å®é™…ä¸Šå°±æ˜¯å°†å¤šè¡Œæ†ç»‘åœ¨ä¸€èµ·ï¼Œä½œä¸ºä¸€ä¸ªç´¢å¼•ï¼Œå®ƒåŒæ ·æ”¯æŒä»¥ä¸Šå‡ ç§ç´¢å¼•ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Navicatä¸­è¿›è¡Œæ¼”ç¤ºã€‚</p>
<p>æ³¨æ„ç»„åˆç´¢å¼•åœ¨è¿›è¡ŒåŒ¹é…æ—¶ï¼Œéµå¾ªæœ€å·¦åŸåˆ™ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>explain</code>è¯­å¥ï¼ˆå®ƒå¯ä»¥ç”¨äºåˆ†æselectè¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼Œä¹Ÿå°±æ˜¯MySQLåˆ°åº•æ˜¯å¦‚ä½•åœ¨æ‰§è¡ŒæŸæ¡selectè¯­å¥çš„ï¼‰æ¥åˆ†ææŸ¥è¯¢è¯­å¥åˆ°åº•æœ‰æ²¡æœ‰é€šè¿‡ç´¢å¼•è¿›è¡ŒåŒ¹é…ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;å°ç‹&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<ul>
<li>select_typeï¼šæŸ¥è¯¢ç±»å‹ï¼Œä¸Šé¢çš„å°±æ˜¯ç®€å•æŸ¥è¯¢ï¼ˆSIMPLEï¼‰</li>
<li>tableï¼šæŸ¥è¯¢çš„è¡¨</li>
<li>typeï¼šMySQLå†³å®šå¦‚ä½•æŸ¥æ‰¾å¯¹åº”çš„è®°å½•ï¼Œæ•ˆç‡ä»é«˜åˆ°ä½ï¼šsystem &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; all</li>
<li>possible_keysï¼šæ‰§è¡ŒæŸ¥è¯¢æ—¶å¯èƒ½ä¼šç”¨åˆ°çš„ç´¢å¼•</li>
<li>keyï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•</li>
<li>key_lenï¼šMysqlåœ¨ç´¢å¼•é‡Œä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦</li>
<li>rowsï¼šæ‰«æçš„è¡Œæ•°</li>
<li>extraï¼šé™„åŠ è¯´æ˜</li>
</ul>
<h3 id="ç´¢å¼•åº•å±‚åŸç†"><a href="#ç´¢å¼•åº•å±‚åŸç†" class="headerlink" title="ç´¢å¼•åº•å±‚åŸç†"></a>ç´¢å¼•åº•å±‚åŸç†</h3><p>åœ¨äº†è§£å®Œäº†ç´¢å¼•çš„ç±»å‹ä¹‹åï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹çœ‹ç´¢å¼•æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<p>æ—¢ç„¶æˆ‘ä»¬è¦é€šè¿‡ç´¢å¼•æ¥å¿«é€ŸæŸ¥æ‰¾å†…å®¹ï¼Œé‚£ä¹ˆå¦‚ä½•è®¾è®¡ç´¢å¼•å°±æ˜¯æˆ‘ä»¬çš„é‡ç‚¹å†…å®¹ï¼Œå› ä¸ºç´¢å¼•æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šçš„ï¼Œè·Ÿæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„HashMapä¹‹ç±»çš„ä¸åŒï¼Œå®ƒä»¬éƒ½æ˜¯åœ¨å†…å­˜ä¸­çš„ï¼Œä½†æ˜¯ç¡¬ç›˜çš„è¯»å–é€Ÿåº¦è¿œå°äºå†…å­˜çš„é€Ÿåº¦ï¼Œæ¯ä¸€æ¬¡IOæ“ä½œéƒ½ä¼šè€—è´¹å¤§é‡çš„æ—¶é—´ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¯èƒ½æŠŠæ•´ä¸ªç£ç›˜ä¸Šçš„ç´¢å¼•å…¨éƒ¨å¯¼å…¥å†…å­˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è€ƒè™‘å°½å¯èƒ½å¤šçš„å‡å°‘IOæ¬¡æ•°ï¼Œç´¢å¼•çš„å®ç°å¯ä»¥ä¾é ä¸¤ç§æ•°æ®ç»“æ„ï¼Œä¸€ç§æ˜¯æˆ‘ä»¬åœ¨JavaSEé˜¶æ®µå·²ç»å­¦ä¹ è¿‡çš„Hashè¡¨ï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯B-Treeã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å“ˆå¸Œè¡¨ï¼Œå®é™…ä¸Šå°±æ˜¯è®¡ç®—Hashå€¼æ¥å¿«é€Ÿå®šä½ï¼š</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fnimg.ws.126.net%2F%3Furl%3Dhttp%3A%2F%2Fdingyue.ws.126.net%2F2020%2F1223%2F2dd7c986j00qlrut10012c000rq00eam.jpg%26thumbnail%3D650x2147483647%26quality%3D80%26type%3Djpg&refer=http%3A%2F%2Fnimg.ws.126.net&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1643975564&t=8c9eabd82da9ac2637b0bdfea57d99bf" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>é€šè¿‡å¯¹Keyè¿›è¡Œæ•£åˆ—å€¼è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¾—åˆ°å¯¹åº”æ•°æ®çš„å­˜æ”¾ä½ç½®ï¼Œå®ƒçš„æŸ¥è¯¢æ•ˆç‡èƒ½å¤Ÿè¾¾åˆ°O(1)ï¼Œä½†æ˜¯å®ƒä¹Ÿå­˜åœ¨ä¸€å®šçš„ç¼ºé™·ï¼š</p>
<ul>
<li>Hashç´¢å¼•ä»…ä»…èƒ½æ»¡è¶³â€œ=â€ï¼Œâ€œinâ€æŸ¥è¯¢æ¡ä»¶ï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢ã€‚ </li>
<li>Hashç¢°æ’é—®é¢˜ã€‚</li>
<li>ä¸èƒ½ç”¨éƒ¨åˆ†ç´¢å¼•é”®æ¥æœç´¢ï¼Œå› ä¸ºç»„åˆç´¢å¼•åœ¨è®¡ç®—å“ˆå¸Œå€¼çš„æ—¶å€™æ˜¯ä¸€èµ·è®¡ç®—çš„ã€‚</li>
</ul>
<p>é‚£ä¹ˆï¼Œæ—¢ç„¶è¦è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ç±»ä¼¼äºäºŒå‰æ ‘é‚£æ ·çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨ç´¢å¼•ï¼Œä½†æ˜¯è¿™æ ·ç›¸æ¯”ä½¿ç”¨Hashç´¢å¼•ï¼Œä¼šç‰ºç‰²ä¸€å®šçš„è¯»å–é€Ÿåº¦ã€‚</p>
<p>ä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨äºŒå‰æ ‘ï¼Œè€Œæ˜¯ä½¿ç”¨äº†BTreeï¼Œå®ƒæ˜¯ä¸“é—¨ä¸ºç£ç›˜æ•°æ®è¯»å–è®¾è®¡çš„ä¸€ç§åº¦ä¸ºnçš„æŸ¥æ‰¾æ ‘ï¼š</p>
<ul>
<li>æ ‘ä¸­æ¯ä¸ªç»“ç‚¹æœ€å¤šå«æœ‰mä¸ªå­©å­ï¼ˆm &gt;= 2ï¼‰</li>
<li>é™¤æ ¹ç»“ç‚¹å’Œå¶å­ç»“ç‚¹å¤–ï¼Œå…¶å®ƒæ¯ä¸ªç»“ç‚¹è‡³å°‘æœ‰[ceil(m / 2)]ä¸ªå­©å­ã€‚</li>
<li>è‹¥æ ¹ç»“ç‚¹ä¸æ˜¯å¶å­ç»“ç‚¹ï¼Œåˆ™è‡³å°‘æœ‰2ä¸ªå­©å­ã€‚</li>
<li>æ‰€æœ‰å¶å­ç»“ç‚¹éƒ½å‡ºç°åœ¨åŒä¸€å±‚ã€‚</li>
<li>æ¯ä¸ªéç»ˆç«¯ç»“ç‚¹ä¸­åŒ…å«æœ‰nä¸ªé”®å€¼ä¿¡æ¯ï¼š (P1ï¼ŒK1ï¼ŒP2ï¼ŒK2ï¼ŒP3ï¼Œâ€¦â€¦ï¼ŒKnï¼ŒPn+1)ã€‚å…¶ä¸­ï¼š <ol>
<li>Ki (i=1â€¦n)ä¸ºé”®å€¼ï¼Œä¸”é”®å€¼æŒ‰é¡ºåºå‡åºæ’åºK(i-1)&lt; Kiã€‚  </li>
<li>Piä¸ºæŒ‡å‘å­æ ‘æ ¹çš„ç»“ç‚¹ï¼Œä¸”æŒ‡é’ˆP(i)æŒ‡å‘çš„å­æ ‘ä¸­æ‰€æœ‰ç»“ç‚¹çš„é”®å€¼å‡å°äºKiï¼Œä½†éƒ½å¤§äºK(i-1)ã€‚  </li>
<li>é”®å€¼çš„ä¸ªæ•°nå¿…é¡»æ»¡è¶³ï¼š [ceil(m / 2)-1] &lt;= n &lt;= m-1ã€‚</li>
</ol>
</li>
</ul>
<p><img src="https://upload-images.jianshu.io/upload_images/12058546-44a71668594a77d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/654" alt="img"></p>
<p>æ¯”å¦‚ç°åœ¨æˆ‘ä»¬è¦å¯¹é”®å€¼ä¸º<strong>10</strong>çš„è®°å½•è¿›è¡ŒæŸ¥æ‰¾ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>è¯»å–æ ¹èŠ‚ç‚¹æ•°æ®ï¼ˆç›®å‰è¿›è¡Œäº†ä¸€æ¬¡IOæ“ä½œï¼‰</li>
<li>æ ¹æ®æ ¹èŠ‚ç‚¹æ•°æ®è¿›è¡Œåˆ¤æ–­å¾—åˆ°10&lt;17ï¼Œå› ä¸ºP1æŒ‡å‘çš„å­æ ‘ä¸­æ‰€æœ‰å€¼éƒ½æ˜¯å°äº17çš„ï¼Œæ‰€ä»¥è¿™æ—¶æˆ‘ä»¬å°†P1æŒ‡å‘çš„èŠ‚ç‚¹è¯»å–ï¼ˆç›®å‰è¿›è¡Œäº†ä¸¤æ¬¡IOæ“ä½œï¼‰</li>
<li>å†æ¬¡è¿›è¡Œåˆ¤æ–­ï¼Œå¾—åˆ°8&lt;10&lt;12ï¼Œå› ä¸ºP2æŒ‡å‘çš„å­æ ‘ä¸­æ‰€æœ‰çš„å€¼éƒ½æ˜¯å°äº12å¤§äº8çš„ï¼Œæ‰€ä»¥è¿™æ—¶è¯»å–P2æŒ‡å‘çš„èŠ‚ç‚¹ï¼ˆç›®å‰è¿›è¡Œäº†ä¸‰æ¬¡IOæ“ä½œï¼‰</li>
<li>æˆåŠŸæ‰¾åˆ°ã€‚</li>
</ol>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œè™½ç„¶BTreeèƒ½å¤Ÿå¾ˆå¥½åœ°åˆ©ç”¨äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€æƒ³å¤§å¹…åº¦å‡å°‘æŸ¥æ‰¾æ¬¡æ•°ï¼Œä½†æ˜¯å®ƒçš„æŸ¥æ‰¾æ•ˆç‡è¿˜æ˜¯å¾ˆä½ï¼Œå› æ­¤å®ƒçš„ä¼˜åŒ–ç‰ˆæœ¬B+Treeè¯ç”Ÿäº†ï¼Œå®ƒæ‹¥æœ‰æ›´ç¨³å®šçš„æŸ¥è¯¢æ•ˆç‡å’Œæ›´ä½çš„IOè¯»å–æ¬¡æ•°ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12058546-2ae10c0ddc8ac9ea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/646" alt="img"></p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå®ƒå’ŒBTreeæœ‰ä¸€å®šçš„åŒºåˆ«ï¼š</p>
<ul>
<li>æœ‰næ£µå­æ ‘çš„ç»“ç‚¹ä¸­å«æœ‰nä¸ªé”®å€¼ï¼ŒBTreeåªæœ‰n-1ä¸ªã€‚</li>
<li>æ‰€æœ‰çš„é”®å€¼ä¿¡æ¯åªåœ¨å¶å­èŠ‚ç‚¹ä¸­åŒ…å«ï¼Œéå¶å­èŠ‚ç‚¹ä»…ä»…ä¿å­˜å­èŠ‚ç‚¹çš„æœ€å°ï¼ˆæˆ–æœ€å¤§ï¼‰å€¼ï¼Œå’ŒæŒ‡å‘å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè¿™æ ·ç›¸æ¯”BTreeæ¯ä¸€ä¸ªèŠ‚ç‚¹åœ¨ç¡¬ç›˜ä¸­å­˜æ”¾äº†æ›´å°‘çš„å†…å®¹ï¼ˆæ²¡æœ‰é”®å€¼ä¿¡æ¯äº†ï¼‰</li>
<li>æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªæ ¹æ®å¤§å°é¡ºåºæŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆQï¼Œæœ¬è´¨ä¸Šæ•°æ®å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚</li>
</ul>
<p>è¿™æ ·ï¼Œè¯»å–IOçš„æ—¶é—´ç›¸æ¯”BTreeå°±å‡å°‘äº†å¾ˆå¤šï¼Œå¹¶ä¸”æŸ¥è¯¢ä»»ä½•é”®å€¼ä¿¡æ¯éƒ½éœ€è¦å®Œæ•´åœ°èµ°åˆ°å¶å­èŠ‚ç‚¹ï¼Œä¿è¯äº†æŸ¥è¯¢çš„IOè¯»å–æ¬¡æ•°ä¸€è‡´ã€‚å› æ­¤MySQLé»˜è®¤é€‰æ‹©B+Treeä½œä¸ºç´¢å¼•çš„å­˜å‚¨æ•°æ®ç»“æ„ã€‚</p>
<p>è¿™æ˜¯MyISAMå­˜å‚¨å¼•æ“ä¸‹çš„B+Treeå®ç°ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12058546-316168444236022b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/664" alt="img"></p>
<p>è¿™æ˜¯InnoDBå­˜å‚¨å¼•æ“ä¸‹çš„B+Treeå®ç°ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/12058546-0da96cb9de1ff1c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/543" alt="img"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/12058546-8cb0dbfd433253b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/543" alt="img"></p>
<p>InnoDBä¸MyISAMå®ç°çš„ä¸åŒä¹‹å¤„ï¼š</p>
<ul>
<li>æ•°æ®æœ¬èº«å°±æ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼ˆæ‰€ä»¥è¿™é‡Œå»ºè®®ä¸»é”®ä½¿ç”¨è‡ªå¢ï¼‰</li>
<li>éä¸»é”®ç´¢å¼•çš„æ•°æ®å®é™…ä¸Šå­˜å‚¨çš„æ˜¯å¯¹åº”è®°å½•çš„ä¸»é”®å€¼ï¼ˆå› æ­¤InnoDBå¿…é¡»æœ‰ä¸»é”®ï¼Œè‹¥æ²¡æœ‰ä¹Ÿä¼šè‡ªåŠ¨æŸ¥æ‰¾æ›¿ä»£ï¼‰</li>
</ul>
<hr>
<h2 id="é”æœºåˆ¶"><a href="#é”æœºåˆ¶" class="headerlink" title="é”æœºåˆ¶"></a>é”æœºåˆ¶</h2><p>åœ¨JavaSEçš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬åœ¨å¤šçº¿ç¨‹æ¿å—é¦–æ¬¡ç”¨åˆ°äº†é”æœºåˆ¶ï¼Œå½“æˆ‘ä»¬å¯¹æŸä¸ªæ–¹æ³•æˆ–æ˜¯æŸä¸ªä»£ç å—åŠ é”åï¼Œé™¤éé”çš„æŒæœ‰è€…é‡Šæ”¾å½“å‰çš„é”ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹æ— æ³•è¿›å…¥æ­¤æ–¹æ³•æˆ–æ˜¯ä»£ç å—ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨é”æœºåˆ¶æ¥ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´çš„å®‰å…¨æ€§ã€‚</p>
<p>åœ¨MySQLä¸­ï¼Œå°±å¾ˆå®¹æ˜“å‡ºç°å¤šçº¿ç¨‹åŒæ—¶æ“ä½œè¡¨ä¸­æ•°æ®çš„æƒ…å†µï¼Œå¦‚æœè¦é¿å…æ½œåœ¨çš„å¹¶å‘é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰è®²è§£çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ¥å¤„ç†ï¼Œè€Œäº‹åŠ¡éš”ç¦»ä¸­åˆ©ç”¨äº†é”æœºåˆ¶ã€‚</p>
<ul>
<li>è¯»æœªæäº¤(Read Uncommitted)ï¼šèƒ½å¤Ÿè¯»å–åˆ°å…¶ä»–äº‹åŠ¡ä¸­æœªæäº¤çš„å†…å®¹ï¼Œå­˜åœ¨è„è¯»é—®é¢˜ã€‚</li>
<li>è¯»å·²æäº¤(Read Committed RC)ï¼šåªèƒ½è¯»å–å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„å†…å®¹ï¼Œå­˜åœ¨ä¸å¯é‡å¤è¯»é—®é¢˜ã€‚</li>
<li>å¯é‡å¤è¯»(Repeated Read RR)ï¼šåœ¨è¯»å–æŸè¡Œåä¸å…è®¸å…¶ä»–äº‹åŠ¡æ“ä½œæ­¤è¡Œï¼Œç›´åˆ°äº‹åŠ¡ç»“æŸï¼Œä½†æ˜¯ä¾ç„¶å­˜åœ¨å¹»è¯»é—®é¢˜ã€‚</li>
<li>ä¸²è¡Œè¯»(Serializable)ï¼šä¸€ä¸ªäº‹åŠ¡çš„å¼€å§‹å¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªäº‹åŠ¡çš„å®Œæˆã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥åˆ‡æ¢éš”ç¦»çº§åˆ«åˆ†åˆ«æ¼”ç¤ºä¸€ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> session transaction isolation level read uncommitted;</span><br></pre></td></tr></table></figure>

<p>åœ¨RRçº§åˆ«ä¸‹ï¼ŒMySQLåœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†å¹»è¯»é—®é¢˜ï¼š</p>
<ul>
<li>åœ¨å¿«ç…§è¯»ï¼ˆä¸åŠ é”ï¼‰è¯»æƒ…å†µä¸‹ï¼Œmysqlé€šè¿‡mvccæ¥é¿å…å¹»è¯»ã€‚</li>
<li>åœ¨å½“å‰è¯»ï¼ˆåŠ é”ï¼‰è¯»æƒ…å†µä¸‹ï¼Œmysqlé€šè¿‡next-keyæ¥é¿å…å¹»è¯»ã€‚</li>
</ul>
<blockquote>
<p>**<code>MVCC</code>**ï¼Œå…¨ç§° <code>Multi-Version Concurrency Control</code> ï¼Œå³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚MVCC æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æ–¹æ³•ï¼Œä¸€èˆ¬åœ¨æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå®ç°å¯¹æ•°æ®åº“çš„å¹¶å‘è®¿é—®ï¼Œåœ¨ç¼–ç¨‹è¯­è¨€ä¸­å®ç°äº‹åŠ¡å†…å­˜ã€‚</p>
</blockquote>
<h3 id="è¯»é”å’Œå†™é”"><a href="#è¯»é”å’Œå†™é”" class="headerlink" title="è¯»é”å’Œå†™é”"></a>è¯»é”å’Œå†™é”</h3><p>ä»å¯¹æ•°æ®çš„æ“ä½œç±»å‹ä¸Šæ¥è¯´ï¼Œé”åˆ†ä¸ºè¯»é”å’Œå†™é”ï¼š</p>
<ul>
<li><strong>è¯»é”ï¼š</strong>ä¹Ÿå«å…±äº«é”ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡æ·»åŠ äº†è¯»é”åï¼Œå…¶ä»–çš„äº‹åŠ¡ä¹Ÿå¯ä»¥æ·»åŠ è¯»é”æˆ–æ˜¯è¯»å–æ•°æ®ï¼Œä½†æ˜¯ä¸èƒ½è¿›è¡Œå†™æ“ä½œï¼Œåªèƒ½ç­‰åˆ°æ‰€æœ‰çš„è¯»é”å…¨éƒ¨é‡Šæ”¾ã€‚</li>
<li><strong>å†™é”ï¼š</strong>ä¹Ÿå«æ’ä»–é”ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡æ·»åŠ äº†å†™é”åï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½è¯»ä¸èƒ½å†™ä¹Ÿä¸èƒ½æ·»åŠ ä»»ä½•é”ï¼Œåªèƒ½ç­‰å¾…å½“å‰äº‹åŠ¡é‡Šæ”¾é”ã€‚</li>
</ul>
<h3 id="å…¨å±€é”ã€è¡¨é”å’Œè¡Œé”"><a href="#å…¨å±€é”ã€è¡¨é”å’Œè¡Œé”" class="headerlink" title="å…¨å±€é”ã€è¡¨é”å’Œè¡Œé”"></a>å…¨å±€é”ã€è¡¨é”å’Œè¡Œé”</h3><p>ä»é”çš„ä½œç”¨èŒƒå›´ä¸Šåˆ’åˆ†ï¼Œåˆ†ä¸ºå…¨å±€é”ã€è¡¨é”å’Œè¡Œé”ï¼š</p>
<ul>
<li><strong>å…¨å±€é”ï¼š</strong>é”ä½œç”¨äºå…¨å±€ï¼Œæ•´ä¸ªæ•°æ®åº“çš„æ‰€æœ‰æ“ä½œå…¨éƒ¨å—åˆ°é”é™åˆ¶ã€‚</li>
<li><strong>è¡¨é”ï¼š</strong>é”ä½œç”¨äºæ•´ä¸ªè¡¨ï¼Œæ‰€æœ‰å¯¹è¡¨çš„æ“ä½œéƒ½ä¼šæ”¶åˆ°é”é™åˆ¶ã€‚</li>
<li><strong>è¡Œé”ï¼š</strong>é”ä½œç”¨äºè¡¨ä¸­çš„æŸä¸€è¡Œï¼Œåªä¼šé€šè¿‡é”é™åˆ¶å¯¹æŸä¸€è¡Œçš„æ“ä½œï¼ˆä»…InnoDBæ”¯æŒï¼‰</li>
</ul>
<h4 id="å…¨å±€é”"><a href="#å…¨å±€é”" class="headerlink" title="å…¨å±€é”"></a>å…¨å±€é”</h4><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹å…¨å±€é”ï¼Œå®ƒä½œç”¨äºæ•´ä¸ªæ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¼€å¯è¯»å…¨å±€é”ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">flush tables <span class="keyword">with</span> read lock;</span><br></pre></td></tr></table></figure>

<p>å¼€å¯åï¼Œæ•´ä¸ªæ•°æ®åº“è¢«ä¸Šè¯»é”ï¼Œæˆ‘ä»¬åªèƒ½å»è¯»å–æ•°æ®ï¼Œä½†æ˜¯ä¸å…è®¸è¿›è¡Œå†™æ“ä½œï¼ˆåŒ…æ‹¬æ›´æ–°ã€æ’å…¥ã€åˆ é™¤ç­‰ï¼‰ä¸€æ—¦æ‰§è¡Œå†™æ“ä½œï¼Œä¼šè¢«é˜»å¡ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è§£é”ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">unlock tables;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†æ‰‹åŠ¨é‡Šæ”¾é”ä¹‹å¤–ï¼Œå½“æˆ‘ä»¬çš„ä¼šè¯ç»“æŸåï¼Œé”ä¹Ÿä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ã€‚</p>
<h4 id="è¡¨é”"><a href="#è¡¨é”" class="headerlink" title="è¡¨é”"></a>è¡¨é”</h4><p>è¡¨é”ä½œç”¨äºæŸä¸€å¼ è¡¨ï¼Œä¹Ÿæ˜¯MyISAMå’ŒInnoDBå­˜å‚¨å¼•æ“æ”¯æŒçš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ä¸ºè¡¨æ·»åŠ é”ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">lock <span class="keyword">table</span> è¡¨åç§° read<span class="operator">/</span>write;</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬ä¸ºè¡¨æ·»åŠ å†™é”åï¼Œæˆ‘ä»¬å‘ç°å…¶ä»–åœ°æ–¹æ˜¯æ— æ³•è®¿é—®æ­¤è¡¨çš„ï¼Œä¸€å¾‹éƒ½è¢«é˜»å¡ã€‚</p>
<h4 id="è¡Œé”"><a href="#è¡Œé”" class="headerlink" title="è¡Œé”"></a>è¡Œé”</h4><p>è¡¨é”çš„ä½œç”¨èŒƒå›´å¤ªå¹¿äº†ï¼Œå¦‚æœæˆ‘ä»¬ä»…ä»…åªæ˜¯å¯¹æŸä¸€è¡Œè¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆå¤§å¯ä¸å¿…å¯¹æ•´ä¸ªè¡¨è¿›è¡ŒåŠ é”ï¼Œå› æ­¤<code>InnoDB</code>æ”¯æŒäº†è¡Œé”ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¯¹æŸä¸€è¡Œè¿›è¡ŒåŠ é”ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æ·»åŠ è¯»é”ï¼ˆå…±äº«é”ï¼‰</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> ... lock <span class="keyword">in</span> share mode;</span><br><span class="line"><span class="comment">-- æ·»åŠ å†™é”ï¼ˆæ’ä»–é”ï¼‰</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> ... <span class="keyword">for</span> <span class="keyword">update</span>;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨InnoDBçš„æƒ…å†µä¸‹ï¼Œåœ¨æ‰§è¡Œæ›´æ–°ã€åˆ é™¤ã€æ’å…¥æ“ä½œæ—¶ï¼Œæ•°æ®åº“ä¹Ÿä¼šè‡ªåŠ¨ä¸ºæ‰€æ¶‰åŠçš„è¡Œæ·»åŠ å†™é”ï¼ˆæ’ä»–é”ï¼‰ï¼Œç›´åˆ°äº‹åŠ¡æäº¤æ—¶ï¼Œæ‰ä¼šé‡Šæ”¾é”ï¼Œæ‰§è¡Œæ™®é€šçš„æŸ¥è¯¢æ“ä½œæ—¶ï¼Œä¸ä¼šæ·»åŠ ä»»ä½•é”ã€‚ä½¿ç”¨MyISAMçš„æƒ…å†µä¸‹ï¼Œåœ¨æ‰§è¡Œæ›´æ–°ã€åˆ é™¤ã€æ’å…¥æ“ä½œæ—¶ï¼Œæ•°æ®åº“ä¼šå¯¹æ¶‰åŠçš„è¡¨æ·»åŠ å†™é”ï¼Œåœ¨æ‰§è¡ŒæŸ¥è¯¢æ“ä½œæ—¶ï¼Œæ•°æ®åº“ä¼šå¯¹æ¶‰åŠçš„è¡¨æ·»åŠ è¯»é”ã€‚</p>
<p><strong>æé—®ï¼š</strong>å½“æˆ‘ä»¬ä¸ä½¿ç”¨idè¿›è¡Œé€‰æ‹©ï¼Œè¡Œé”ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ï¼Ÿï¼ˆè¡Œé”å‡çº§ï¼‰</p>
<h3 id="è®°å½•é”ã€é—´éš™é”å’Œä¸´é”®é”"><a href="#è®°å½•é”ã€é—´éš™é”å’Œä¸´é”®é”" class="headerlink" title="è®°å½•é”ã€é—´éš™é”å’Œä¸´é”®é”"></a>è®°å½•é”ã€é—´éš™é”å’Œä¸´é”®é”</h3><p>æˆ‘ä»¬çŸ¥é“InnoDBæ”¯æŒä½¿ç”¨è¡Œé”ï¼Œä½†æ˜¯è¡Œé”æ¯”è¾ƒå¤æ‚ï¼Œå®ƒå¯ä»¥ç»§ç»­åˆ†ä¸ºå¤šä¸ªç±»å‹ã€‚</p>
<h4 id="è®°å½•é”"><a href="#è®°å½•é”" class="headerlink" title="è®°å½•é”"></a>è®°å½•é”</h4><p>ï¼ˆRecord Locksï¼‰è®°å½•é”, ä»…ä»…é”ä½ç´¢å¼•è®°å½•çš„ä¸€è¡Œï¼Œåœ¨å•æ¡ç´¢å¼•è®°å½•ä¸ŠåŠ é”ã€‚Record locké”ä½çš„æ°¸è¿œæ˜¯ç´¢å¼•ï¼Œè€Œéè®°å½•æœ¬èº«ï¼Œå³ä½¿è¯¥è¡¨ä¸Šæ²¡æœ‰ä»»ä½•ç´¢å¼•ï¼Œé‚£ä¹ˆinnodbä¼šåœ¨åå°åˆ›å»ºä¸€ä¸ªéšè—çš„èšé›†ä¸»é”®ç´¢å¼•ï¼Œé‚£ä¹ˆé”ä½çš„å°±æ˜¯è¿™ä¸ªéšè—çš„èšé›†ä¸»é”®ç´¢å¼•ã€‚æ‰€ä»¥è¯´å½“ä¸€æ¡sqlæ²¡æœ‰èµ°ä»»ä½•ç´¢å¼•æ—¶ï¼Œé‚£ä¹ˆå°†ä¼šåœ¨æ¯ä¸€æ¡èšåˆç´¢å¼•åé¢åŠ å†™é”ï¼Œè¿™ä¸ªç±»ä¼¼äºè¡¨é”ï¼Œä½†åŸç†ä¸Šå’Œè¡¨é”åº”è¯¥æ˜¯å®Œå…¨ä¸åŒçš„ã€‚</p>
<h4 id="é—´éš™é”"><a href="#é—´éš™é”" class="headerlink" title="é—´éš™é”"></a>é—´éš™é”</h4><p>ï¼ˆGap Locksï¼‰ä»…ä»…é”ä½ä¸€ä¸ªç´¢å¼•åŒºé—´ï¼ˆå¼€åŒºé—´ï¼Œä¸åŒ…æ‹¬åŒç«¯ç«¯ç‚¹ï¼‰ã€‚åœ¨ç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™ä¸­åŠ é”ï¼Œæˆ–è€…æ˜¯åœ¨æŸä¸€æ¡ç´¢å¼•è®°å½•ä¹‹å‰æˆ–è€…ä¹‹ååŠ é”ï¼Œå¹¶ä¸åŒ…æ‹¬è¯¥ç´¢å¼•è®°å½•æœ¬èº«ã€‚æ¯”å¦‚åœ¨ 1ã€2ä¸­ï¼Œé—´éš™é”çš„å¯èƒ½å€¼æœ‰ (-âˆ, 1)ï¼Œ(1, 2)ï¼Œ(2, +âˆ)ï¼Œé—´éš™é”å¯ç”¨äºé˜²æ­¢å¹»è¯»ï¼Œä¿è¯ç´¢å¼•é—´çš„ä¸ä¼šè¢«æ’å…¥æ•°æ®ã€‚</p>
<h4 id="ä¸´é”®é”"><a href="#ä¸´é”®é”" class="headerlink" title="ä¸´é”®é”"></a>ä¸´é”®é”</h4><p>ï¼ˆNext-Key Locksï¼‰Record lock + Gap lockï¼Œå·¦å¼€å³é—­åŒºé—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>InnoDB</code>æ­£æ˜¯ä½¿ç”¨Next-key Locksæ¥é”å®šè®°å½•ï¼ˆå¦‚select â€¦ for updateè¯­å¥ï¼‰å®ƒè¿˜ä¼šæ ¹æ®åœºæ™¯è¿›è¡Œçµæ´»å˜æ¢ï¼š</p>
<table>
<thead>
<tr>
<th align="left">åœºæ™¯</th>
<th>è½¬æ¢</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ä½¿ç”¨å”¯ä¸€ç´¢å¼•è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œä½†è¡¨ä¸­ä¸å­˜åœ¨è®°å½•</td>
<td>è‡ªåŠ¨è½¬æ¢ä¸º Gap Locks</td>
</tr>
<tr>
<td align="left">ä½¿ç”¨å”¯ä¸€ç´¢å¼•è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œä¸”è¡¨ä¸­å­˜åœ¨è®°å½•</td>
<td>è‡ªåŠ¨è½¬æ¢ä¸º Record Locks</td>
</tr>
<tr>
<td align="left">ä½¿ç”¨éå”¯ä¸€ç´¢å¼•è¿›è¡Œç²¾ç¡®åŒ¹é…</td>
<td>ä¸è½¬æ¢</td>
</tr>
<tr>
<td align="left">ä½¿ç”¨å”¯ä¸€ç´¢å¼•è¿›è¡ŒèŒƒå›´åŒ¹é…</td>
<td>ä¸è½¬æ¢ï¼Œä½†æ˜¯åªé”ä¸Šç•Œï¼Œä¸é”ä¸‹ç•Œ</td>
</tr>
</tbody></table>
<p><a href="https://zhuanlan.zhihu.com/p/48269420">https://zhuanlan.zhihu.com/p/48269420</a></p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>SSM</tag>
      </tags>
  </entry>
  <entry>
    <title>SSMç¬”è®°-2</title>
    <url>/2022/04/23/JavaSSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-37ff43e92267558c2fbaa70aedbfc133_1200x500.jpg&refer=http%3A%2F%2Fpic4.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1641702986&t=9a8080a4683d1e65b0b5e6f1ac764dfe" alt="img"></p>
<h1 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h1><p>åœ¨å‰é¢å­¦ä¹ å®ŒSpringæ¡†æ¶æŠ€æœ¯ä¹‹åï¼Œå·®ä¸å¤šä¼šå‡ºç°ä¸¤æ‰¹äººï¼šä¸€æ‰¹æ˜¯å¬å¾—äº‘é‡Œé›¾é‡Œï¼Œä¾ç„¶ä¸æ˜ç™½è¿™ä¸ªä¸œè¥¿æ˜¯å¹²å˜›çš„ï¼›è¿˜æœ‰ä¸€æ‰¹å°±æ˜¯å·®ä¸å¤šç†è§£äº†æ ¸å¿ƒæ€æƒ³ï¼Œä½†æ˜¯ä¸çŸ¥é“è¿™äº›ä¸œè¥¿è¯¥å¦‚ä½•å»å‘æŒ¥å®ƒçš„ä½œç”¨ã€‚åœ¨SpringMVCé˜¶æ®µï¼Œä½ å°±èƒ½é€æ¸å¤Ÿä½“ä¼šåˆ°Springæ¡†æ¶ä¸ºæˆ‘ä»¬å¸¦æ¥çš„ä¾¿æ·ä¹‹å¤„äº†ã€‚</p>
<span id="more"></span>

<p>æ­¤é˜¶æ®µï¼Œæˆ‘ä»¬å°†å†æ¬¡å›åˆ°Tomcatçš„Webåº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œå»æ„Ÿå—SpringMVCä¸ºæˆ‘ä»¬å¸¦æ¥çš„å·¨å¤§ä¾¿æ·ã€‚</p>
<h2 id="MVCç†è®ºåŸºç¡€"><a href="#MVCç†è®ºåŸºç¡€" class="headerlink" title="MVCç†è®ºåŸºç¡€"></a>MVCç†è®ºåŸºç¡€</h2><p>åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬ç»™å¤§å®¶è®²è§£äº†ä¸‰å±‚æ¶æ„ï¼ŒåŒ…æ‹¬ï¼š</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fs4.51cto.com%2Fwyfs02%2FM00%2F8B%2FBA%2FwKioL1hXU8vRX8elAAA2bXqAxMs799.png&refer=http%3A%2F%2Fs4.51cto.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1641788288&t=1658084627505c12812596d8ca1b9885" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>æ¯ä¸€å±‚éƒ½æœ‰ç€å„è‡ªçš„èŒè´£ï¼Œå…¶ä¸­æœ€å…³é”®çš„å½“å±è¡¨ç¤ºå±‚ï¼Œå› ä¸ºå®ƒç›¸å½“äºå°±æ˜¯ç›´æ¥ä¸ç”¨æˆ·çš„æµè§ˆå™¨æ‰“äº¤é“çš„ä¸€å±‚ï¼Œå¹¶ä¸”æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šç»è¿‡å®ƒè¿›è¡Œè§£æï¼Œç„¶åå†å‘ŠçŸ¥ä¸šåŠ¡å±‚è¿›è¡Œå¤„ç†ï¼Œä»»ä½•é¡µé¢çš„è¿”å›å’Œæ•°æ®å¡«å……ä¹Ÿå…¨é è¡¨ç¤ºå±‚æ¥å®Œæˆï¼Œå› æ­¤å®ƒå®é™…ä¸Šæ˜¯æ•´ä¸ªä¸‰å±‚æ¶æ„ä¸­æœ€å…³é”®çš„ä¸€å±‚ï¼Œè€Œåœ¨ä¹‹å‰çš„å®æˆ˜å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç¼–å†™äº†å¤§é‡çš„Servletï¼ˆä¹Ÿå°±æ˜¯è¡¨ç¤ºå±‚å®ç°ï¼‰æ¥å¤„ç†æ¥è‡ªæµè§ˆå™¨çš„å„ç§è¯·æ±‚ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œä»…ä»…æ˜¯å‡ ä¸ªå¾ˆå°çš„åŠŸèƒ½ï¼Œä»¥åŠå‡ ä¸ªå¾ˆåŸºæœ¬çš„é¡µé¢ï¼Œæˆ‘ä»¬éƒ½è¦ç¼–å†™å°†è¿‘åä¸ªServletï¼Œå¦‚æœæ˜¯æ›´åŠ å¤§å‹çš„ç½‘ç«™ç³»ç»Ÿï¼Œæ¯”å¦‚æ·˜å®ã€Bç«™ï¼Œå…‰æ˜¯ä¸€ä¸ªé¡µé¢ä¸­å¯èƒ½å°±åŒ…å«äº†å‡ åç”šè‡³ä¸Šç™¾ä¸ªåŠŸèƒ½ï¼Œæƒ³æƒ³é‚£æ ·çš„è¯å†™èµ·æ¥å¾—å¤šææ€–ã€‚</p>
<p>å› æ­¤ï¼ŒSpringMVCæ­£æ˜¯ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜è€Œç”Ÿçš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„è¡¨ç¤ºå±‚æ¡†æ¶ï¼ˆåœ¨æ­¤ä¹‹å‰è¿˜æœ‰ä¸€ä¸ªå«åšStruts2çš„æ¡†æ¶ï¼Œä½†æ˜¯ç°é˜¶æ®µè²Œä¼¼å¿«å‡‰é€äº†ï¼‰ï¼Œé‡‡ç”¨MVCæ€æƒ³è®¾è®¡å®ç°ã€‚</p>
<p>MVCè§£é‡Šå¦‚ä¸‹ï¼š</p>
<ul>
<li>Mæ˜¯æŒ‡ä¸šåŠ¡æ¨¡å‹ï¼ˆModelï¼‰ï¼šé€šä¿—çš„è®²å°±æ˜¯æˆ‘ä»¬ä¹‹å‰ç”¨äºå°è£…æ•°æ®ä¼ é€’çš„å®ä½“ç±»ã€‚</li>
<li>Væ˜¯æŒ‡ç”¨æˆ·ç•Œé¢ï¼ˆViewï¼‰ï¼šä¸€èˆ¬æŒ‡çš„æ˜¯å‰ç«¯é¡µé¢ã€‚</li>
<li>Cåˆ™æ˜¯æ§åˆ¶å™¨ï¼ˆControllerï¼‰ï¼šæ§åˆ¶å™¨å°±ç›¸å½“äºServletçš„åŸºæœ¬åŠŸèƒ½ï¼Œå¤„ç†è¯·æ±‚ï¼Œè¿”å›å“åº”ã€‚</li>
</ul>
<p><img src="https://pics5.baidu.com/feed/d0c8a786c9177f3e5707320277aeb1c39f3d5677.jpeg?token=e4c298063f4efa11fd0f94c2760c252b&s=782834721BC044435C55F4CA0000E0B1" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>SpringMVCæ­£æ˜¯å¸Œæœ›è¿™ä¸‰è€…ä¹‹é—´è¿›è¡Œè§£è€¦ï¼Œå®ç°å„å¹²å„çš„ï¼Œæ›´åŠ ç²¾ç»†åœ°åˆ’åˆ†å¯¹åº”çš„èŒè´£ã€‚æœ€åå†å°†Viewå’ŒModelè¿›è¡Œæ¸²æŸ“ï¼Œå¾—åˆ°æœ€ç»ˆçš„é¡µé¢å¹¶è¿”å›ç»™å‰ç«¯ï¼ˆå°±åƒä¹‹å‰ä½¿ç”¨Thymeleafé‚£æ ·ï¼ŒæŠŠå®ä½“æ•°æ®å¯¹è±¡å’Œå‰ç«¯é¡µé¢éƒ½ç»™åˆ°Thymeleafï¼Œç„¶åå®ƒä¼šå°†å…¶è¿›è¡Œæ•´åˆæ¸²æŸ“å¾—åˆ°æœ€ç»ˆæœ‰æ•°æ®çš„é¡µé¢ï¼Œè€Œæœ¬æ•™ç¨‹ä¹Ÿä¼šä½¿ç”¨Thymeleafä½œä¸ºè§†å›¾è§£æå™¨è¿›è¡Œè®²è§£ï¼‰</p>
<hr>
<h2 id="é…ç½®ç¯å¢ƒå¹¶æ­å»ºé¡¹ç›®"><a href="#é…ç½®ç¯å¢ƒå¹¶æ­å»ºé¡¹ç›®" class="headerlink" title="é…ç½®ç¯å¢ƒå¹¶æ­å»ºé¡¹ç›®"></a>é…ç½®ç¯å¢ƒå¹¶æ­å»ºé¡¹ç›®</h2><p>ç”±äºSpringMVCè¿˜æ²¡æœ‰æ”¯æŒæœ€æ–°çš„Tomcat10ï¼ˆä¸»è¦æ˜¯ä¹‹å‰æåˆ°çš„åŒ…åé—®é¢˜ï¼Œç¥ä»™æ‰“æ¶ç™¾å§“é­æ®ƒï¼‰æ‰€ä»¥æˆ‘ä»¬å¹²è„†å°±å†æ¥é…ç½®ä¸€ä¸‹Tomcat9ç¯å¢ƒï¼Œç›¸å½“äºå›é¡¾ä¸€ä¸‹ã€‚</p>
<p>ä¸‹è½½åœ°å€ï¼š<a href="https://tomcat.apache.org/download-90.cgi">https://tomcat.apache.org/download-90.cgi</a></p>
<p>æ·»åŠ SpringMVCçš„ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸‹web.xmlï¼Œå°†DispatcherServletæ›¿æ¢æ‰Tomcatè‡ªå¸¦çš„Servletï¼Œè¿™é‡Œurl-patternéœ€è¦å†™ä¸º<code>/</code>ï¼Œå³å¯å®Œæˆæ›¿æ¢ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>mvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€éœ€è¦ä¸ºæ•´ä¸ªWebåº”ç”¨ç¨‹åºé…ç½®ä¸€ä¸ªSpringä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆä¹Ÿå°±æ˜¯å®¹å™¨ï¼‰ï¼Œå› ä¸ºSpringMVCæ˜¯åŸºäºSpringå¼€å‘çš„ï¼Œå®ƒç›´æ¥åˆ©ç”¨Springæä¾›çš„å®¹å™¨æ¥å®ç°å„ç§åŠŸèƒ½ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ³¨è§£æ–¹å¼è¿›è¡Œé…ç½®ï¼Œä¸å†ä½¿ç”¨XMLé…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>com.example.config.MvcConfiguration<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextClass<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¿˜æ˜¯æƒ³ä½¿ç”¨XMLé…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>é…ç½®æ–‡ä»¶åç§°<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å¸Œæœ›å®Œå®Œå…¨å…¨ä¸¢å¼ƒé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªç±»ï¼ŒTomcatä¼šåœ¨ç±»è·¯å¾„ä¸­æŸ¥æ‰¾å®ç°ServletContainerInitializer æ¥å£çš„ç±»ï¼Œå¦‚æœå‘ç°çš„è¯ï¼Œå°±ç”¨å®ƒæ¥é…ç½®Servletå®¹å™¨ï¼ŒSpringæä¾›äº†è¿™ä¸ªæ¥å£çš„å®ç°ç±» SpringServletContainerInitializer , é€šè¿‡@HandlesTypes(WebApplicationInitializer.class)è®¾ç½®ï¼Œè¿™ä¸ªç±»åè¿‡æ¥ä¼šæŸ¥æ‰¾å®ç°WebApplicationInitializer çš„ç±»ï¼Œå¹¶å°†é…ç½®çš„ä»»åŠ¡äº¤ç»™ä»–ä»¬æ¥å®Œæˆï¼Œå› æ­¤ç›´æ¥å®ç°æ¥å£å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainInitializer</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;MainConfiguration.class&#125;;   <span class="comment">//åŸºæœ¬çš„Springé…ç½®ç±»ï¼Œä¸€èˆ¬ç”¨äºä¸šåŠ¡å±‚é…ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>];  <span class="comment">//é…ç½®DispatcherServletçš„é…ç½®ç±»ã€ä¸»è¦ç”¨äºControllerç­‰é…ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;    <span class="comment">//åŒ¹é…è·¯å¾„ï¼Œä¸ä¸Šé¢ä¸€è‡´</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¡ºä¾¿ç¼–å†™ä¸€ä¸‹æœ€åŸºæœ¬çš„é…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åé¢æˆ‘ä»¬éƒ½é‡‡ç”¨æ— XMLé…ç½®æ–¹å¼è¿›è¡Œè®²è§£ã€‚</p>
<p><img src="https://img2018.cnblogs.com/blog/738818/201906/738818-20190617214214614-761905677.png" alt="img"></p>
<p>è¿™æ ·ï¼Œå°±å®Œæˆæœ€åŸºæœ¬çš„é…ç½®äº†ï¼Œç°åœ¨ä»»ä½•è¯·æ±‚éƒ½ä¼šä¼˜å…ˆç»è¿‡<code>DispatcherServlet</code>è¿›è¡Œé›†ä¸­å¤„ç†ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šè¯¦ç»†è®²è§£å¦‚ä½•ä½¿ç”¨å®ƒã€‚</p>
<hr>
<h2 id="Controlleræ§åˆ¶å™¨"><a href="#Controlleræ§åˆ¶å™¨" class="headerlink" title="Controlleræ§åˆ¶å™¨"></a>Controlleræ§åˆ¶å™¨</h2><p>æœ‰äº†SpringMVCä¹‹åï¼Œæˆ‘ä»¬ä¸å¿…å†åƒä¹‹å‰é‚£æ ·ä¸€ä¸ªè¯·æ±‚åœ°å€åˆ›å»ºä¸€ä¸ªServletäº†ï¼Œå®ƒä½¿ç”¨<code>DispatcherServlet</code>æ›¿ä»£Tomcatä¸ºæˆ‘ä»¬æä¾›çš„é»˜è®¤çš„é™æ€èµ„æºServletï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨æ‰€æœ‰çš„è¯·æ±‚ï¼ˆé™¤äº†jspï¼Œå› ä¸ºTomcatè¿˜æä¾›äº†ä¸€ä¸ªjspçš„Servletï¼‰éƒ½ä¼šç»è¿‡<code>DispatcherServlet</code>è¿›è¡Œå¤„ç†ã€‚</p>
<p>é‚£ä¹ˆ<code>DispatcherServlet</code>ä¼šå¸®åŠ©æˆ‘ä»¬åšä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg2018.cnblogs.com%2Fblog%2F1190675%2F201812%2F1190675-20181203121258033-524477408.png&refer=http%3A%2F%2Fimg2018.cnblogs.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1642058685&t=13fd16796a8b5ed58762c9947f15681f" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>æ ¹æ®å›¾ç‰‡æˆ‘ä»¬å¯ä»¥äº†è§£ï¼Œæˆ‘ä»¬çš„è¯·æ±‚åˆ°è¾¾TomcatæœåŠ¡å™¨ä¹‹åï¼Œä¼šäº¤ç»™å½“å‰çš„Webåº”ç”¨ç¨‹åºè¿›è¡Œå¤„ç†ï¼Œè€ŒSpringMVCä½¿ç”¨<code>DispatcherServlet</code>æ¥å¤„ç†æ‰€æœ‰çš„è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒè¢«ä½œä¸ºä¸€ä¸ªç»Ÿä¸€çš„è®¿é—®ç‚¹ï¼Œæ‰€æœ‰çš„è¯·æ±‚å…¨éƒ¨ç”±å®ƒæ¥è¿›è¡Œè°ƒåº¦ã€‚</p>
<p>å½“ä¸€ä¸ªè¯·æ±‚ç»è¿‡<code>DispatcherServlet</code>ä¹‹åï¼Œä¼šå…ˆèµ°<code>HandlerMapping</code>ï¼Œå®ƒä¼šå°†è¯·æ±‚æ˜ å°„ä¸º<code>HandlerExecutionChain</code>ï¼Œä¾æ¬¡ç»è¿‡<code>HandlerInterceptor</code>æœ‰ç‚¹ç±»ä¼¼äºä¹‹å‰æˆ‘ä»¬æ‰€å­¦çš„è¿‡æ»¤å™¨ï¼Œä¸è¿‡åœ¨SpringMVCä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æ‹¦æˆªå™¨ï¼Œç„¶åå†äº¤ç»™<code>HandlerAdapter</code>ï¼Œæ ¹æ®è¯·æ±‚çš„è·¯å¾„é€‰æ‹©åˆé€‚çš„æ§åˆ¶å™¨è¿›è¡Œå¤„ç†ï¼Œæ§åˆ¶å™¨å¤„ç†å®Œæˆä¹‹åï¼Œä¼šè¿”å›ä¸€ä¸ª<code>ModelAndView</code>å¯¹è±¡ï¼ŒåŒ…æ‹¬æ•°æ®æ¨¡å‹å’Œè§†å›¾ï¼Œé€šä¿—çš„è®²å°±æ˜¯é¡µé¢ä¸­æ•°æ®å’Œé¡µé¢æœ¬èº«ï¼ˆåªåŒ…å«è§†å›¾åç§°å³å¯ï¼‰ã€‚</p>
<p>è¿”å›<code>ModelAndView</code>ä¹‹åï¼Œä¼šäº¤ç»™<code>ViewResolver</code>ï¼ˆè§†å›¾è§£æå™¨ï¼‰è¿›è¡Œå¤„ç†ï¼Œè§†å›¾è§£æå™¨ä¼šå¯¹æ•´ä¸ªè§†å›¾é¡µé¢è¿›è¡Œè§£æï¼ŒSpringMVCè‡ªå¸¦äº†ä¸€äº›è§†å›¾è§£æå™¨ï¼Œä½†æ˜¯åªé€‚ç”¨äºJSPé¡µé¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åƒä¹‹å‰ä¸€æ ·ä½¿ç”¨Thymeleafä½œä¸ºè§†å›¾è§£æå™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ç»™å®šçš„è§†å›¾åç§°ï¼Œç›´æ¥è¯»å–HTMLç¼–å†™çš„é¡µé¢ï¼Œè§£æä¸ºä¸€ä¸ªçœŸæ­£çš„Viewã€‚</p>
<p>è§£æå®Œæˆåï¼Œå°±éœ€è¦å°†é¡µé¢ä¸­çš„æ•°æ®å…¨éƒ¨æ¸²æŸ“åˆ°Viewä¸­ï¼Œæœ€åè¿”å›ç»™<code>DispatcherServlet</code>ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ•°æ®çš„æˆå½¢é¡µé¢ï¼Œå†å“åº”ç»™æµè§ˆå™¨ï¼Œå®Œæˆæ•´ä¸ªè¿‡ç¨‹ã€‚</p>
<p>å› æ­¤ï¼Œå®é™…ä¸Šæ•´ä¸ªè¿‡ç¨‹æˆ‘ä»¬åªéœ€è¦ç¼–å†™å¯¹åº”è¯·æ±‚è·¯å¾„çš„çš„Controllerä»¥åŠé…ç½®å¥½æˆ‘ä»¬éœ€è¦çš„ViewResolverå³å¯ï¼Œä¹‹åè¿˜å¯ä»¥ç»§ç»­è¡¥å……æ·»åŠ æ‹¦æˆªå™¨ï¼Œè€Œå…¶ä»–çš„æµç¨‹å·²ç»ç”±SpringMVCå¸®åŠ©æˆ‘ä»¬å®Œæˆäº†ã€‚</p>
<h3 id="é…ç½®è§†å›¾è§£æå™¨å’Œæ§åˆ¶å™¨"><a href="#é…ç½®è§†å›¾è§£æå™¨å’Œæ§åˆ¶å™¨" class="headerlink" title="é…ç½®è§†å›¾è§£æå™¨å’Œæ§åˆ¶å™¨"></a>é…ç½®è§†å›¾è§£æå™¨å’Œæ§åˆ¶å™¨</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®ç°æœ€åŸºæœ¬çš„é¡µé¢è§£æå¹¶è¿”å›ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯é…ç½®è§†å›¾è§£æå™¨ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Thymeleafä¸ºæˆ‘ä»¬æä¾›çš„è§†å›¾è§£æå™¨ï¼Œå¯¼å…¥éœ€è¦çš„ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-spring5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®è§†å›¾è§£æå™¨éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å¯¹åº”çš„<code>ViewResolver</code>æ³¨å†Œä¸ºBeanå³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥åœ¨é…ç½®ç±»ä¸­ç¼–å†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&quot;com.example.controller&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æˆ‘ä»¬éœ€è¦ä½¿ç”¨ThymeleafViewResolverä½œä¸ºè§†å›¾è§£æå™¨ï¼Œå¹¶è§£ææˆ‘ä»¬çš„HTMLé¡µé¢</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ThymeleafViewResolver <span class="title function_">thymeleafViewResolver</span><span class="params">(<span class="meta">@Autowired</span> SpringTemplateEngine springTemplateEngine)</span>&#123;</span><br><span class="line">        <span class="type">ThymeleafViewResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThymeleafViewResolver</span>();</span><br><span class="line">        resolver.setOrder(<span class="number">1</span>);   <span class="comment">//å¯ä»¥å­˜åœ¨å¤šä¸ªè§†å›¾è§£æå™¨ï¼Œå¹¶ä¸”å¯ä»¥ä¸ºä»–ä»¬è®¾å®šè§£æé¡ºåº</span></span><br><span class="line">        resolver.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);   <span class="comment">//ç¼–ç æ ¼å¼æ˜¯é‡ä¸­ä¹‹é‡</span></span><br><span class="line">        resolver.setTemplateEngine(springTemplateEngine);   <span class="comment">//å’Œä¹‹å‰JavaWebé˜¶æ®µä¸€æ ·ï¼Œéœ€è¦ä½¿ç”¨æ¨¡æ¿å¼•æ“è¿›è¡Œè§£æï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿéœ€è¦è®¾å®šä¸€ä¸‹æ¨¡æ¿å¼•æ“</span></span><br><span class="line">        <span class="keyword">return</span> resolver;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="comment">//é…ç½®æ¨¡æ¿è§£æå™¨</span></span><br><span class="line">  	<span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SpringResourceTemplateResolver <span class="title function_">templateResolver</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">SpringResourceTemplateResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringResourceTemplateResolver</span>();</span><br><span class="line">        resolver.setSuffix(<span class="string">&quot;.html&quot;</span>);   <span class="comment">//éœ€è¦è§£æçš„åç¼€åç§°</span></span><br><span class="line">        resolver.setPrefix(<span class="string">&quot;/&quot;</span>);   <span class="comment">//éœ€è¦è§£æçš„HTMLé¡µé¢æ–‡ä»¶å­˜æ”¾çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">return</span> resolver;</span><br><span class="line">    &#125;</span><br><span class="line">  	</span><br><span class="line">  	<span class="comment">//é…ç½®æ¨¡æ¿å¼•æ“Bean</span></span><br><span class="line">  	<span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SpringTemplateEngine <span class="title function_">springTemplateEngine</span><span class="params">(<span class="meta">@Autowired</span> ITemplateResolver resolver)</span>&#123;</span><br><span class="line">        <span class="type">SpringTemplateEngine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringTemplateEngine</span>();</span><br><span class="line">        engine.setTemplateResolver(resolver);   <span class="comment">//æ¨¡æ¿è§£æå™¨ï¼Œé»˜è®¤å³å¯</span></span><br><span class="line">        <span class="keyword">return</span> engine;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ«å¿˜äº†åœ¨<code>Initializer</code>ä¸­æ·»åŠ æ­¤ç±»ä½œä¸ºé…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;MvcConfiguration.class&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å°±å®Œæˆäº†è§†å›¾è§£æå™¨çš„é…ç½®ï¼Œæˆ‘ä»¬æ¥ç€æ¥åˆ›å»ºä¸€ä¸ªControllerï¼Œåˆ›å»ºControllerä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€åœ¨ä¸€ä¸ªç±»ä¸Šæ·»åŠ ä¸€ä¸ª<code>@Controller</code>æ³¨è§£å³å¯ï¼Œå®ƒä¼šè¢«Springæ‰«æå¹¶è‡ªåŠ¨æ³¨å†Œä¸ºControllerç±»å‹çš„Beanï¼Œç„¶åæˆ‘ä»¬åªéœ€è¦åœ¨ç±»ä¸­ç¼–å†™æ–¹æ³•ç”¨äºå¤„ç†å¯¹åº”åœ°å€çš„è¯·æ±‚å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span>   <span class="comment">//ç›´æ¥æ·»åŠ æ³¨è§£å³å¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/index&quot;)</span>   <span class="comment">//ç›´æ¥å¡«å†™è®¿é—®è·¯å¾„</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);  <span class="comment">//è¿”å›ModelAndViewå¯¹è±¡ï¼Œè¿™é‡Œå¡«å…¥äº†è§†å›¾çš„åç§°</span></span><br><span class="line">      	<span class="comment">//è¿”å›åä¼šç»è¿‡è§†å›¾è§£æå™¨è¿›è¡Œå¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œæ‰“å¼€æµè§ˆå™¨ä¹‹åå°±å¯ä»¥ç›´æ¥è®¿é—®æˆ‘ä»¬çš„HTMLé¡µé¢äº†ã€‚</p>
<p>è€Œé¡µé¢ä¸­çš„æ•°æ®æˆ‘ä»¬å¯ä»¥ç›´æ¥å‘Modelè¿›è¡Œæä¾›ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    modelAndView.getModel().put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;å•Šè¿™&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·Thymeleafå°±èƒ½æ”¶åˆ°æˆ‘ä»¬ä¼ é€’çš„æ•°æ®è¿›è¡Œè§£æï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;static/test.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    HelloWorldï¼</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;name&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œå¦‚æœä»…ä»…æ˜¯ä¼ é€’ä¸€ä¸ªé¡µé¢ä¸éœ€è¦ä»»ä½•çš„é™„åŠ å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›Viewåç§°ï¼ŒSpringMVCä¼šå°†å…¶è‡ªåŠ¨åŒ…è£…ä¸ºModelAndViewå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥å•ç‹¬æ·»åŠ ä¸€ä¸ªModelä½œä¸ºå½¢å‚è¿›è¡Œè®¾ç½®ï¼ŒSpringMVCä¼šè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬ä¼ é€’å®ä¾‹å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(Model model)</span>&#123;  <span class="comment">//è¿™é‡Œä¸ä»…ä»…å¯ä»¥æ˜¯Modelï¼Œè¿˜å¯ä»¥æ˜¯Mapã€ModelMap</span></span><br><span class="line">    model.addAttribute(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;yyds&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¹ˆæ–¹ä¾¿çš„å†™æ³•ï¼Œä½ å°±è¯´ä½ çˆ±ä¸çˆ±å§ï¼Œä½ çˆ±ä¸çˆ±ã€‚</p>
<p>æ³¨æ„ï¼Œä¸€å®šè¦ä¿è¯è§†å›¾åç§°ä¸‹é¢å‡ºç°æ¨ªçº¿å¹¶ä¸”æŒ‰ä½Ctrlå¯ä»¥è·³è½¬ï¼Œé…ç½®æ‰æ˜¯æ­£ç¡®çš„ï¼ˆæœ€æ–°ç‰ˆIDEAï¼‰</p>
<p>æˆ‘ä»¬çš„é¡µé¢ä¸­å¯èƒ½è¿˜ä¼šåŒ…å«ä¸€äº›é™æ€èµ„æºï¼Œæ¯”å¦‚jsã€cssï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½®ä¸€ä¸‹ï¼Œè®©é™æ€èµ„æºé€šè¿‡Tomcatæä¾›çš„é»˜è®¤Servletè¿›è¡Œè§£æï¼Œæˆ‘ä»¬éœ€è¦è®©é…ç½®ç±»å®ç°ä¸€ä¸‹<code>WebMvcConfigurer</code>æ¥å£ï¼Œè¿™æ ·åœ¨Webåº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šæ ¹æ®æˆ‘ä»¬é‡å†™æ–¹æ³•é‡Œé¢çš„å†…å®¹è¿›è¡Œè¿›ä¸€æ­¥çš„é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> &#123;</span><br><span class="line">    configurer.enable();   <span class="comment">//å¼€å¯é»˜è®¤çš„Servlet</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">    registry.addResourceHandler(<span class="string">&quot;/static/**&quot;</span>).addResourceLocations(<span class="string">&quot;/WEB-INF/static/&quot;</span>);   </span><br><span class="line">  	<span class="comment">//é…ç½®é™æ€èµ„æºçš„è®¿é—®è·¯å¾„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç¼–å†™ä¸€ä¸‹å‰ç«¯å†…å®¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- å¼•ç”¨é™æ€èµ„æºï¼Œè¿™é‡Œä½¿ç”¨Thymeleafçš„ç½‘å€é“¾æ¥è¡¨è¾¾å¼ï¼ŒThymeleafä¼šè‡ªåŠ¨æ·»åŠ webåº”ç”¨ç¨‹åºçš„åç§°åˆ°é“¾æ¥å‰é¢ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/static/test.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    HelloWorldï¼</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ›å»º<code>test.js</code>å¹¶ç¼–å†™å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">alert</span>(<span class="string">&quot;æ¬¢è¿æ¥åˆ°GayHubå…¨çƒæœ€å¤§åŒæ€§äº¤å‹ç½‘ç«™&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>æœ€åè®¿é—®é¡µé¢ï¼Œé¡µé¢åœ¨åŠ è½½æ—¶å°±ä¼šæ˜¾ç¤ºä¸€ä¸ªå¼¹çª—ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†æœ€åŸºæœ¬çš„é¡µé¢é…ç½®ã€‚ç›¸æ¯”ä¹‹å‰çš„æ–¹å¼ï¼Œè¿™æ ·å°±ç®€å•å¾ˆå¤šäº†ï¼Œç›´æ¥é¿å…äº†ç¼–å†™å¤§é‡çš„Servletæ¥å¤„ç†è¯·æ±‚ã€‚</p>
<h3 id="RequestMappingè¯¦è§£"><a href="#RequestMappingè¯¦è§£" class="headerlink" title="@RequestMappingè¯¦è§£"></a>@RequestMappingè¯¦è§£</h3><p>å‰é¢æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨æ¥å¤„ç†æˆ‘ä»¬çš„è¯·æ±‚ï¼Œæ¥ç€æˆ‘ä»¬åªéœ€è¦åœ¨æ§åˆ¶å™¨æ·»åŠ ä¸€ä¸ªæ–¹æ³•ç”¨äºå¤„ç†å¯¹åº”çš„è¯·æ±‚å³å¯ï¼Œä¹‹å‰æˆ‘ä»¬éœ€è¦å®Œæ•´åœ°ç¼–å†™ä¸€ä¸ªServletæ¥å®ç°ï¼Œè€Œç°åœ¨æˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ª<code>@RequestMapping</code>å³å¯å®ç°ï¼Œå…¶å®ä»å®ƒçš„åå­—æˆ‘ä»¬ä¹Ÿèƒ½å¾—çŸ¥ï¼Œæ­¤æ³¨è§£å°±æ˜¯å°†è¯·æ±‚å’Œå¤„ç†è¯·æ±‚çš„æ–¹æ³•å»ºç«‹ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼Œå½“æ”¶åˆ°è¯·æ±‚æ—¶å°±å¯ä»¥æ ¹æ®æ˜ å°„å…³ç³»è°ƒç”¨å¯¹åº”çš„è¯·æ±‚å¤„ç†æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥å…ˆèŠèŠ<code>@RequestMapping</code>å§ï¼Œæ³¨è§£å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RequestMapping &#123;</span><br><span class="line">    String <span class="title function_">name</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor(&quot;path&quot;)</span></span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">    String[] path() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    RequestMethod[] method() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] params() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] headers() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] consumes() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] produces() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­æœ€å…³é”®çš„æ˜¯pathå±æ€§ï¼ˆç­‰ä»·äºvalueï¼‰ï¼Œå®ƒå†³å®šäº†å½“å‰æ–¹æ³•å¤„ç†çš„è¯·æ±‚è·¯å¾„ï¼Œæ³¨æ„è·¯å¾„å¿…é¡»å…¨å±€å”¯ä¸€ï¼Œä»»ä½•è·¯å¾„åªèƒ½æœ‰ä¸€ä¸ªæ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ–¹æ³•ä¸ä»…ä»…å¯ä»¥åªç”¨äºå¤„ç†æŸä¸€ä¸ªè¯·æ±‚è·¯å¾„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•å¤„ç†å¤šä¸ªè¯·æ±‚è·¯å¾„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&#123;&quot;/index&quot;, &quot;/test&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬è®¿é—®/indexæˆ–æ˜¯/testéƒ½ä¼šç»è¿‡æ­¤æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å°†<code>@RequestMapping</code>æ·»åŠ åˆ°ç±»åä¸Šï¼Œè¡¨ç¤ºä¸ºæ­¤ç±»ä¸­çš„æ‰€æœ‰è¯·æ±‚æ˜ å°„æ·»åŠ ä¸€ä¸ªè·¯å¾„å‰ç¼€ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/yyds&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&#123;&quot;/index&quot;, &quot;/test&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬éœ€è¦è®¿é—®<code>/yyds/index</code>æˆ–æ˜¯<code>/yyds/test</code>æ‰å¯ä»¥å¾—åˆ°æ­¤é¡µé¢ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨IDEAä¸‹æ–¹çš„ç«¯ç‚¹æ¿å—ä¸­æŸ¥çœ‹å½“å‰Webåº”ç”¨ç¨‹åºå®šä¹‰çš„æ‰€æœ‰è¯·æ±‚æ˜ å°„ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡IDEAä¸ºæˆ‘ä»¬æä¾›çš„å†…ç½®Webå®¢æˆ·ç«¯ç›´æ¥è®¿é—®æŸä¸ªè·¯å¾„ã€‚</p>
<p>è·¯å¾„è¿˜æ”¯æŒä½¿ç”¨é€šé…ç¬¦è¿›è¡ŒåŒ¹é…ï¼š</p>
<ul>
<li>?ï¼šè¡¨ç¤ºä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚<code>@RequestMapping(&quot;/index/x?&quot;)</code>å¯ä»¥åŒ¹é…/index/xaã€/index/xbç­‰ç­‰ã€‚</li>
<li>*ï¼šè¡¨ç¤ºä»»æ„0-nä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚<code>@RequestMapping(&quot;/index/*&quot;)</code>å¯ä»¥åŒ¹é…/index/lbwnbã€/index/yydsç­‰ã€‚</li>
<li>**ï¼šè¡¨ç¤ºå½“å‰ç›®å½•æˆ–åŸºäºå½“å‰ç›®å½•çš„å¤šçº§ç›®å½•ï¼Œæ¯”å¦‚<code>@RequestMapping(&quot;/index/**&quot;)</code>å¯ä»¥åŒ¹é…/indexã€/index/xxxç­‰ã€‚</li>
</ul>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ä¸‹ä¸€ä¸ªmethodå±æ€§ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒå°±æ˜¯è¯·æ±‚çš„æ–¹æ³•ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥é™å®šè¯·æ±‚æ–¹å¼ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¦‚æœç›´æ¥ä½¿ç”¨æµè§ˆå™¨è®¿é—®æ­¤é¡µé¢ï¼Œä¼šæ˜¾ç¤º405æ–¹æ³•ä¸æ”¯æŒï¼Œå› ä¸ºæµè§ˆå™¨é»˜è®¤æ˜¯ç›´æ¥ä½¿ç”¨GETæ–¹æ³•è·å–é¡µé¢ï¼Œè€Œæˆ‘ä»¬è¿™é‡ŒæŒ‡å®šä¸ºPOSTæ–¹æ³•è®¿é—®æ­¤åœ°å€ï¼Œæ‰€ä»¥è®¿é—®å¤±è´¥ï¼Œæˆ‘ä»¬ç°åœ¨å†å»ç«¯ç‚¹ä¸­ç”¨POSTæ–¹å¼å»è®¿é—®ï¼ŒæˆåŠŸå¾—åˆ°é¡µé¢ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¡ç”Ÿæ³¨è§£ç›´æ¥è®¾å®šä¸ºæŒ‡å®šç±»å‹çš„è¯·æ±‚æ˜ å°„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½¿ç”¨äº†<code>@PostMapping</code>ç›´æ¥æŒ‡å®šä¸ºPOSTè¯·æ±‚ç±»å‹çš„è¯·æ±‚æ˜ å°„ï¼ŒåŒæ ·çš„ï¼Œè¿˜æœ‰<code>@GetMapping</code>å¯ä»¥ç›´æ¥æŒ‡å®šä¸ºGETè¯·æ±‚æ–¹å¼ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>params</code>å±æ€§æ¥æŒ‡å®šè¯·æ±‚å¿…é¡»æºå¸¦å“ªäº›è¯·æ±‚å‚æ•°ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;, params = &#123;&quot;username&quot;, &quot;password&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬è¦æ±‚è¯·æ±‚ä¸­å¿…é¡»æºå¸¦<code>username</code>å’Œ<code>password</code>å±æ€§ï¼Œå¦åˆ™æ— æ³•è®¿é—®ã€‚å®ƒè¿˜æ”¯æŒè¡¨è¾¾å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ç¼–å†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;, params = &#123;&quot;!username&quot;, &quot;password&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨usernameä¹‹å‰æ·»åŠ ä¸€ä¸ªæ„Ÿå¹å·è¡¨ç¤ºè¯·æ±‚çš„ä¸å…è®¸æºå¸¦æ­¤å‚æ•°ï¼Œå¦åˆ™æ— æ³•è®¿é—®ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ç›´æ¥è®¾å®šä¸€ä¸ªå›ºå®šå€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;, params = &#123;&quot;username!=test&quot;, &quot;password=123&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œè¯·æ±‚å‚æ•°usernameä¸å…è®¸ä¸ºtestï¼Œå¹¶ä¸”passwordå¿…é¡»ä¸º123ï¼Œå¦åˆ™æ— æ³•è®¿é—®ã€‚</p>
<p><code>header</code>å±æ€§ç”¨æ³•ä¸<code>params</code>ä¸€è‡´ï¼Œä½†æ˜¯å®ƒè¦æ±‚çš„æ˜¯è¯·æ±‚å¤´ä¸­éœ€è¦æºå¸¦ä»€ä¹ˆå†…å®¹ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;, headers = &quot;!Connection&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œå¦‚æœè¯·æ±‚å¤´ä¸­æºå¸¦äº†<code>Connection</code>å±æ€§ï¼Œå°†æ— æ³•è®¿é—®ã€‚å…¶ä»–ä¸¤ä¸ªå±æ€§ï¼š</p>
<ul>
<li>consumesï¼š æŒ‡å®šå¤„ç†è¯·æ±‚çš„æäº¤å†…å®¹ç±»å‹ï¼ˆContent-Typeï¼‰ï¼Œä¾‹å¦‚application/json, text/html;</li>
<li>produces:  æŒ‡å®šè¿”å›çš„å†…å®¹ç±»å‹ï¼Œä»…å½“requestè¯·æ±‚å¤´ä¸­çš„(Accept)ç±»å‹ä¸­åŒ…å«è¯¥æŒ‡å®šç±»å‹æ‰è¿”å›ï¼›</li>
</ul>
<h3 id="RequestParamå’Œ-RequestHeaderè¯¦è§£"><a href="#RequestParamå’Œ-RequestHeaderè¯¦è§£" class="headerlink" title="@RequestParamå’Œ@RequestHeaderè¯¦è§£"></a>@RequestParamå’Œ@RequestHeaderè¯¦è§£</h3><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œå¦‚ä½•è·å–åˆ°è¯·æ±‚ä¸­çš„å‚æ•°ã€‚</p>
<p>æˆ‘ä»¬åªéœ€è¦ä¸ºæ–¹æ³•æ·»åŠ ä¸€ä¸ªå½¢å¼å‚æ•°ï¼Œå¹¶åœ¨å½¢å¼å‚æ•°å‰é¢æ·»åŠ <code>@RequestParam</code>æ³¨è§£å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String username)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¥å—åˆ°è¯·æ±‚å‚æ•°ï¼š&quot;</span>+username);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦åœ¨<code>@RequestParam</code>ä¸­å¡«å†™å‚æ•°åç§°ï¼Œå‚æ•°çš„å€¼ä¼šè‡ªåŠ¨ä¼ é€’ç»™å½¢å¼å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œæ³¨æ„ï¼Œå¦‚æœå‚æ•°åç§°ä¸å½¢å¼å‚æ•°åç§°ç›¸åŒï¼Œå³ä½¿ä¸æ·»åŠ <code>@RequestParam</code>ä¹Ÿèƒ½è·å–åˆ°å‚æ•°å€¼ã€‚</p>
<p>ä¸€æ—¦æ·»åŠ <code>@RequestParam</code>ï¼Œé‚£ä¹ˆæ­¤è¯·æ±‚å¿…é¡»æºå¸¦æŒ‡å®šå‚æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†requireå±æ€§è®¾å®šä¸ºfalseæ¥å°†å±æ€§è®¾å®šä¸ºéå¿…é¡»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">(<span class="meta">@RequestParam(value = &quot;username&quot;, required = false)</span> String username)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¥å—åˆ°è¯·æ±‚å‚æ•°ï¼š&quot;</span>+username);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥è®¾å®šä¸€ä¸ªé»˜è®¤å€¼ï¼Œå½“è¯·æ±‚å‚æ•°ç¼ºå¤±æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨é»˜è®¤å€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">(<span class="meta">@RequestParam(value = &quot;username&quot;, required = false, defaultValue = &quot;ä¼å…µä¸€å·&quot;)</span> String username)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¥å—åˆ°è¯·æ±‚å‚æ•°ï¼š&quot;</span>+username);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœéœ€è¦ä½¿ç”¨ServletåŸæœ¬çš„ä¸€äº›ç±»ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¥å—åˆ°è¯·æ±‚å‚æ•°ï¼š&quot;</span>+request.getParameterMap().keySet());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥æ·»åŠ <code>HttpServletRequest</code>ä¸ºå½¢å¼å‚æ•°å³å¯ï¼ŒSpringMVCä¼šè‡ªåŠ¨ä¼ é€’è¯¥è¯·æ±‚åŸæœ¬çš„<code>HttpServletRequest</code>å¯¹è±¡ï¼ŒåŒç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ <code>HttpServletResponse</code>ä½œä¸ºå½¢å¼å‚æ•°ï¼Œç”šè‡³å¯ä»¥ç›´æ¥å°†HttpSessionä¹Ÿä½œä¸ºå‚æ•°ä¼ é€’ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">    System.out.println(session.getAttribute(<span class="string">&quot;test&quot;</span>));</span><br><span class="line">    session.setAttribute(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;é¸¡ä½ å¤ªç¾&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥å°†è¯·æ±‚å‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå®ä½“ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    String username;</span><br><span class="line">    String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„å¿…é¡»æºå¸¦setæ–¹æ³•æˆ–æ˜¯æ„é€ æ–¹æ³•ä¸­åŒ…å«æ‰€æœ‰å‚æ•°ï¼Œè¯·æ±‚å‚æ•°ä¼šè‡ªåŠ¨æ ¹æ®ç±»ä¸­çš„å­—æ®µåç§°è¿›è¡ŒåŒ¹é…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">(User user)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;è·å–åˆ°cookieå€¼ä¸ºï¼š&quot;</span>+user);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@RequestHeader</code>ä¸<code>@RequestParam</code>ç”¨æ³•ä¸€è‡´ï¼Œä¸è¿‡å®ƒæ˜¯ç”¨äºè·å–è¯·æ±‚å¤´å‚æ•°çš„ï¼Œè¿™é‡Œå°±ä¸å†æ¼”ç¤ºäº†ã€‚</p>
<h3 id="CookieValueå’Œ-SessionAttrbutie"><a href="#CookieValueå’Œ-SessionAttrbutie" class="headerlink" title="@CookieValueå’Œ@SessionAttrbutie"></a>@CookieValueå’Œ@SessionAttrbutie</h3><p>é€šè¿‡ä½¿ç”¨<code>@CookieValue</code>æ³¨è§£ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¿«é€Ÿè·å–è¯·æ±‚æºå¸¦çš„Cookieä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">(HttpServletResponse response,</span></span><br><span class="line"><span class="params">                          <span class="meta">@CookieValue(value = &quot;test&quot;, required = false)</span> String test)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;è·å–åˆ°cookieå€¼ä¸ºï¼š&quot;</span>+test);</span><br><span class="line">    response.addCookie(<span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;lbwnb&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼ŒSessionä¹Ÿèƒ½ä½¿ç”¨æ³¨è§£å¿«é€Ÿè·å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">(<span class="meta">@SessionAttribute(value = &quot;test&quot;, required = false)</span> String test,</span></span><br><span class="line"><span class="params">                          HttpSession session)</span>&#123;</span><br><span class="line">    session.setAttribute(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;xxxx&quot;</span>);</span><br><span class="line">    System.out.println(test);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°ï¼Œé€šè¿‡ä½¿ç”¨SpringMVCæ¡†æ¶ï¼Œæ•´ä¸ªWebåº”ç”¨ç¨‹åºçš„å¼€å‘å˜å¾—éå¸¸ç®€å•ï¼Œå¤§éƒ¨åˆ†åŠŸèƒ½åªéœ€è¦ä¸€ä¸ªæ³¨è§£å°±å¯ä»¥æå®šäº†ï¼Œæ­£æ˜¯å¾—ç›ŠäºSpringæ¡†æ¶ï¼ŒSpringMVCæ‰èƒ½å¤§æ˜¾èº«æ‰‹ã€‚</p>
<h3 id="é‡å®šå‘å’Œè¯·æ±‚è½¬å‘"><a href="#é‡å®šå‘å’Œè¯·æ±‚è½¬å‘" class="headerlink" title="é‡å®šå‘å’Œè¯·æ±‚è½¬å‘"></a>é‡å®šå‘å’Œè¯·æ±‚è½¬å‘</h3><p>é‡å®šå‘å’Œè¯·æ±‚è½¬å‘ä¹Ÿéå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨è§†å›¾åç§°å‰é¢æ·»åŠ ä¸€ä¸ªå‰ç¼€å³å¯ï¼Œæ¯”å¦‚é‡å®šå‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/home&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">home</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ·»åŠ <code>redirect:</code>å‰ç¼€ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å®ç°é‡å®šå‘ï¼Œé‚£ä¹ˆè¯·æ±‚è½¬å‘å‘¢ï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä½¿ç”¨<code>forward:</code>å‰ç¼€è¡¨ç¤ºè½¬å‘ç»™å…¶ä»–è¯·æ±‚æ˜ å°„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/home&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">home</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨SpringMVCï¼Œåªéœ€è¦ä¸€ä¸ªå‰ç¼€å°±å¯ä»¥å®ç°é‡å®šå‘å’Œè¯·æ±‚è½¬å‘ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<h3 id="Beançš„Webä½œç”¨åŸŸ"><a href="#Beançš„Webä½œç”¨åŸŸ" class="headerlink" title="Beançš„Webä½œç”¨åŸŸ"></a>Beançš„Webä½œç”¨åŸŸ</h3><p>åœ¨å­¦ä¹ Springæ—¶æˆ‘ä»¬è®²è§£äº†Beançš„ä½œç”¨åŸŸï¼ŒåŒ…æ‹¬<code>singleton</code>å’Œ<code>prototype</code>ï¼ŒBeanåˆ†åˆ«ä¼šä»¥å•ä¾‹å’Œå¤šä¾‹æ¨¡å¼è¿›è¡Œåˆ›å»ºï¼Œè€Œåœ¨SpringMVCä¸­ï¼Œå®ƒçš„ä½œç”¨åŸŸè¢«ç»§ç»­ç»†åˆ†ï¼š</p>
<ul>
<li>requestï¼šå¯¹äºæ¯æ¬¡HTTPè¯·æ±‚ï¼Œä½¿ç”¨requestä½œç”¨åŸŸå®šä¹‰çš„Beanéƒ½å°†äº§ç”Ÿä¸€ä¸ªæ–°å®ä¾‹ï¼Œè¯·æ±‚ç»“æŸåBeanä¹Ÿæ¶ˆå¤±ã€‚</li>
<li>sessionï¼šå¯¹äºæ¯ä¸€ä¸ªä¼šè¯ï¼Œä½¿ç”¨sessionä½œç”¨åŸŸå®šä¹‰çš„Beanéƒ½å°†äº§ç”Ÿä¸€ä¸ªæ–°å®ä¾‹ï¼Œä¼šè¯è¿‡æœŸåBeanä¹Ÿæ¶ˆå¤±ã€‚</li>
<li>global sessionï¼šä¸å¸¸ç”¨ï¼Œä¸åšè®²è§£ã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»æ¥è¯•è¯•çœ‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBean</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€å°†å…¶æ³¨å†Œä¸ºBeanï¼Œæ³¨æ„è¿™é‡Œéœ€è¦æ·»åŠ <code>@RequestScope</code>æˆ–æ˜¯<code>@SessionScope</code>è¡¨ç¤ºæ­¤Beançš„Webä½œç”¨åŸŸï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@RequestScope</span></span><br><span class="line"><span class="keyword">public</span> TestBean <span class="title function_">testBean</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TestBean</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å°†å…¶è‡ªåŠ¨æ³¨å…¥åˆ°Controllerä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    TestBean bean;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(bean);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œæ¯æ¬¡å‘èµ·å¾—åˆ°çš„Beanå®ä¾‹éƒ½ä¸åŒï¼Œæ¥ç€æˆ‘ä»¬å°†å…¶ä½œç”¨åŸŸä¿®æ”¹ä¸º<code>@SessionScope</code>ï¼Œè¿™æ ·ä½œç”¨åŸŸå°±ä¸Šå‡åˆ°Sessionï¼Œåªè¦æ¸…ç†æµè§ˆå™¨çš„Cookieï¼Œé‚£ä¹ˆéƒ½ä¼šè¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªä¼šè¯ï¼Œåªè¦æ˜¯åŒä¸€ä¸ªä¼šè¯ï¼Œé‚£ä¹ˆBeanå®ä¾‹å§‹ç»ˆä¸å˜ã€‚</p>
<p>å®é™…ä¸Šï¼Œå®ƒä¹Ÿæ˜¯é€šè¿‡ä»£ç†å®ç°çš„ï¼Œæˆ‘ä»¬è°ƒç”¨Beanä¸­çš„æ–¹æ³•ä¼šè¢«è½¬å‘åˆ°çœŸæ­£çš„Beanå¯¹è±¡å»æ‰§è¡Œã€‚</p>
<hr>
<h2 id="RestFulé£æ ¼"><a href="#RestFulé£æ ¼" class="headerlink" title="RestFulé£æ ¼"></a>RestFulé£æ ¼</h2><p>ä¸­æ–‡é‡Šä¹‰ä¸º<strong>â€œè¡¨ç°å±‚çŠ¶æ€è½¬æ¢â€</strong>ï¼ˆåå­—æŒºé«˜å¤§ä¸Šçš„ï¼‰ï¼Œå®ƒä¸æ˜¯ä¸€ç§æ ‡å‡†ï¼Œè€Œæ˜¯ä¸€ç§è®¾è®¡é£æ ¼ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å……åˆ†å¹¶æ­£ç¡®åˆ©ç”¨HTTPåè®®çš„ç‰¹æ€§ï¼Œè§„èŒƒèµ„æºè·å–çš„URIè·¯å¾„ã€‚é€šä¿—çš„è®²ï¼ŒRESTfulé£æ ¼çš„è®¾è®¡å…è®¸å°†å‚æ•°é€šè¿‡URLæ‹¼æ¥ä¼ åˆ°æœåŠ¡ç«¯ï¼Œç›®çš„æ˜¯è®©URLçœ‹èµ·æ¥æ›´ç®€æ´å®ç”¨ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥å……åˆ†ä½¿ç”¨å¤šç§HTTPè¯·æ±‚æ–¹å¼ï¼ˆPOST/GET/PUT/DELETEï¼‰ï¼Œæ¥æ‰§è¡Œç›¸åŒè¯·æ±‚åœ°å€çš„ä¸åŒç±»å‹æ“ä½œã€‚</p>
<p>å› æ­¤ï¼Œè¿™ç§é£æ ¼çš„è¿æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä»è¯·æ±‚è·¯å¾„ä¸­è¯»å–å‚æ•°ï¼Œæ¯”å¦‚ï¼š</p>
<p><code>http://localhost:8080/mvc/index/123456</code></p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†indexçš„ä¸‹ä¸€çº§è·¯å¾„ä½œä¸ºè¯·æ±‚å‚æ•°è¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨çš„è¯·æ±‚å‚æ•°åŒ…å«åœ¨äº†è¯·æ±‚è·¯å¾„ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index/&#123;str&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(<span class="meta">@PathVariable</span> String str)</span> &#123;</span><br><span class="line">    System.out.println(str);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¯·æ±‚è·¯å¾„æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ·»åŠ ç±»ä¼¼å ä½ç¬¦ä¸€æ ·çš„ä¿¡æ¯ï¼Œè¿™æ ·å ä½ç¬¦ä½ç½®çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šè¢«ä½œä¸ºè¯·æ±‚å‚æ•°ï¼Œè€Œæ–¹æ³•çš„å½¢å‚åˆ—è¡¨ä¸­å¿…é¡»åŒ…æ‹¬ä¸€ä¸ªä¸å ä½ç¬¦åŒåçš„å¹¶ä¸”æ·»åŠ äº†<code>@PathVariable</code>æ³¨è§£çš„å‚æ•°ï¼Œæˆ–æ˜¯ç”±<code>@PathVariable</code>æ³¨è§£æŒ‡å®šä¸ºå ä½ç¬¦åç§°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index/&#123;str&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(<span class="meta">@PathVariable(&quot;str&quot;)</span> String text)</span>&#123;</span><br><span class="line">    System.out.println(text);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ²¡æœ‰é…ç½®æ­£ç¡®ï¼Œæ–¹æ³•åç§°ä¸Šä¼šå‡ºç°é»„çº¿ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä¸åŒåŠŸèƒ½è¿›è¡Œåˆ’åˆ†ï¼š</p>
<ul>
<li>POST <a href="http://localhost:8080/mvc/index">http://localhost:8080/mvc/index</a>  -  æ·»åŠ ç”¨æˆ·ä¿¡æ¯ï¼Œæºå¸¦è¡¨å•æ•°æ®</li>
<li>GET <a href="http://localhost:8080/mvc/index/%7Bid%7D">http://localhost:8080/mvc/index/{id}</a>  -  è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œidç›´æ¥æ”¾åœ¨è¯·æ±‚è·¯å¾„ä¸­</li>
<li>PUT <a href="http://localhost:8080/mvc/index">http://localhost:8080/mvc/index</a>  -  ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œæºå¸¦è¡¨å•æ•°æ®</li>
<li>DELETE <a href="http://localhost:8080/mvc/index/%7Bid%7D">http://localhost:8080/mvc/index/{id}</a>  -  åˆ é™¤ç”¨æˆ·ä¿¡æ¯ï¼Œidç›´æ¥æ”¾åœ¨è¯·æ±‚è·¯å¾„ä¸­</li>
</ul>
<p>æˆ‘ä»¬åˆ†åˆ«ç¼–å†™å››ä¸ªè¯·æ±‚æ˜ å°„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/index/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String text)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è·å–ç”¨æˆ·ï¼š&quot;</span>+text);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/index&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">post</span><span class="params">(String username)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ·»åŠ ç”¨æˆ·ï¼š&quot;</span>+username);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/index/&#123;id&#125;&quot;, method = RequestMethod.DELETE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String text)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤ç”¨æˆ·ï¼š&quot;</span>+text);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/index&quot;, method = RequestMethod.PUT)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">put</span><span class="params">(String username)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿®æ”¹ç”¨æˆ·ï¼š&quot;</span>+username);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™åªæ˜¯ä¸€ç§è®¾è®¡é£æ ¼è€Œå·²ï¼Œå„ä½å°ä¼™ä¼´äº†è§£å³å¯ã€‚</p>
<hr>
<h2 id="Interceptoræ‹¦æˆªå™¨"><a href="#Interceptoræ‹¦æˆªå™¨" class="headerlink" title="Interceptoræ‹¦æˆªå™¨"></a>Interceptoræ‹¦æˆªå™¨</h2><p>æ‹¦æˆªå™¨æ˜¯æ•´ä¸ªSpringMVCçš„ä¸€ä¸ªé‡è¦å†…å®¹ï¼Œæ‹¦æˆªå™¨ä¸è¿‡æ»¤å™¨ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨äºæ‹¦æˆªä¸€äº›éæ³•è¯·æ±‚ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹‹å‰è®²è§£çš„è¿‡æ»¤å™¨æ˜¯ä½œç”¨äºServletä¹‹å‰ï¼Œåªæœ‰ç»è¿‡å±‚å±‚çš„æ‹¦æˆªå™¨æ‰å¯ä»¥æˆåŠŸåˆ°è¾¾Servletï¼Œè€Œæ‹¦æˆªå™¨å¹¶ä¸æ˜¯åœ¨Servletä¹‹å‰ï¼Œå®ƒåœ¨Servletä¸RequestMappingä¹‹é—´ï¼Œç›¸å½“äºDispatcherServletåœ¨å°†è¯·æ±‚äº¤ç»™å¯¹åº”Controllerä¸­çš„æ–¹æ³•ä¹‹å‰è¿›è¡Œæ‹¦æˆªå¤„ç†ï¼Œå®ƒåªä¼šæ‹¦æˆªæ‰€æœ‰Controllerä¸­å®šä¹‰çš„è¯·æ±‚æ˜ å°„å¯¹åº”çš„è¯·æ±‚ï¼ˆä¸ä¼šæ‹¦æˆªé™æ€èµ„æºï¼‰ï¼Œè¿™é‡Œä¸€å®šè¦åŒºåˆ†ä¸¤è€…çš„ä¸åŒã€‚</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fupload-images.jianshu.io%2Fupload_images%2F4685968-ca4e9021f653c954.png%3FimageMogr2%2Fauto-orient%2Fstrip%257CimageView2%2F2%2Fw%2F1240&refer=http%3A%2F%2Fupload-images.jianshu.io&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1642340637&t=70d3dd6b52ae01ac76c04d99e6bd95ed" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<h3 id="åˆ›å»ºæ‹¦æˆªå™¨"><a href="#åˆ›å»ºæ‹¦æˆªå™¨" class="headerlink" title="åˆ›å»ºæ‹¦æˆªå™¨"></a>åˆ›å»ºæ‹¦æˆªå™¨</h3><p>åˆ›å»ºä¸€ä¸ªæ‹¦æˆªå™¨æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª<code>HandlerInterceptor</code>æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯å¤„ç†ä¹‹å‰ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;   <span class="comment">//åªæœ‰è¿”å›trueæ‰ä¼šç»§ç»­ï¼Œå¦åˆ™ç›´æ¥ç»“æŸ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯å¤„ç†ä¹‹åï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯å®Œæˆä¹‹åï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨é…ç½®ç±»ä¸­è¿›è¡Œæ³¨å†Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">MainInterceptor</span>())</span><br><span class="line">      .addPathPatterns(<span class="string">&quot;/**&quot;</span>)    <span class="comment">//æ·»åŠ æ‹¦æˆªå™¨çš„åŒ¹é…è·¯å¾„ï¼Œåªè¦åŒ¹é…ä¸€å¾‹æ‹¦æˆª</span></span><br><span class="line">      .excludePathPatterns(<span class="string">&quot;/home&quot;</span>);   <span class="comment">//æ‹¦æˆªå™¨ä¸è¿›è¡Œæ‹¦æˆªçš„è·¯å¾„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®indexé¡µé¢ï¼Œæ‹¦æˆªå™¨å·²ç»ç”Ÿæ•ˆã€‚</p>
<p>å¾—åˆ°æ•´ç†æ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåºï¼š</p>
<blockquote>
<p>æˆ‘æ˜¯å¤„ç†ä¹‹å‰ï¼</p>
<p>æˆ‘æ˜¯å¤„ç†ï¼</p>
<p>æˆ‘æ˜¯å¤„ç†ä¹‹åï¼</p>
<p>æˆ‘æ˜¯å®Œæˆä¹‹åï¼</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¤„ç†å‰å’Œå¤„ç†åï¼ŒåŒ…å«äº†çœŸæ­£çš„è¯·æ±‚æ˜ å°„çš„å¤„ç†ï¼Œåœ¨æ•´ä¸ªæµç¨‹ç»“æŸåè¿˜æ‰§è¡Œäº†ä¸€æ¬¡<code>afterCompletion</code>æ–¹æ³•ï¼Œå…¶å®æ•´ä¸ªè¿‡ç¨‹ä¸æˆ‘ä»¬ä¹‹å‰æ‰€è®¤è¯†çš„Filterç±»ä¼¼ï¼Œä¸è¿‡åœ¨å¤„ç†å‰ï¼Œæˆ‘ä»¬åªéœ€è¦è¿”å›trueæˆ–æ˜¯falseè¡¨ç¤ºæ˜¯å¦è¢«æ‹¦æˆªå³å¯ï¼Œè€Œä¸æ˜¯å†å»ä½¿ç”¨FilterChainè¿›è¡Œå‘ä¸‹ä¼ é€’ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹çœ‹ï¼Œå¦‚æœå¤„ç†å‰è¿”å›falseï¼Œä¼šæ€ä¹ˆæ ·ï¼š</p>
<blockquote>
<p>æˆ‘æ˜¯å¤„ç†ä¹‹å‰ï¼</p>
</blockquote>
<p>é€šè¿‡ç»“æœå‘ç°ä¸€æ—¦è¿”å›falseï¼Œä¹‹åçš„æ‰€æœ‰æµç¨‹å…¨éƒ¨å–æ¶ˆï¼Œé‚£ä¹ˆå¦‚æœæ˜¯åœ¨å¤„ç†ä¸­å‘ç”Ÿå¼‚å¸¸äº†å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æˆ‘æ˜¯å¤„ç†ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">true</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æœä¸ºï¼š</p>
<blockquote>
<p>æˆ‘æ˜¯å¤„ç†ä¹‹å‰ï¼<br>æˆ‘æ˜¯å¤„ç†ï¼<br>æˆ‘æ˜¯å®Œæˆä¹‹åï¼</p>
</blockquote>
<p>æˆ‘ä»¬å‘ç°å¦‚æœå¤„ç†è¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆä¹…ä¸ä¼šæ‰§è¡Œå¤„ç†å<code>postHandle</code>æ–¹æ³•ï¼Œä½†æ˜¯ä¼šæ‰§è¡Œ<code>afterCompletion</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­è·å–åˆ°æŠ›å‡ºçš„å¼‚å¸¸ã€‚</p>
<h3 id="å¤šçº§æ‹¦æˆªå™¨"><a href="#å¤šçº§æ‹¦æˆªå™¨" class="headerlink" title="å¤šçº§æ‹¦æˆªå™¨"></a>å¤šçº§æ‹¦æˆªå™¨</h3><p>å‰é¢ä»‹ç»äº†ä»…ä»…åªæœ‰ä¸€ä¸ªæ‹¦æˆªå™¨çš„æƒ…å†µï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚æœå­˜åœ¨å¤šä¸ªæ‹¦æˆªå™¨ä¼šå¦‚ä½•æ‰§è¡Œï¼Œæˆ‘ä»¬ä»¥åŒæ ·çš„æ–¹å¼åˆ›å»ºäºŒå·æ‹¦æˆªå™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;äºŒå·æ‹¦æˆªå™¨ï¼šæˆ‘æ˜¯å¤„ç†ä¹‹å‰ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;äºŒå·æ‹¦æˆªå™¨ï¼šæˆ‘æ˜¯å¤„ç†ä¹‹åï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;äºŒå·æ‹¦æˆªå™¨ï¼šæˆ‘æ˜¯å®Œæˆä¹‹åï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨å†ŒäºŒå·æ‹¦æˆªå™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">  	<span class="comment">//ä¸€å·æ‹¦æˆªå™¨</span></span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">MainInterceptor</span>()).addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/home&quot;</span>);</span><br><span class="line">  	<span class="comment">//äºŒå·æ‹¦æˆªå™¨</span></span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">SubInterceptor</span>()).addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„æ‹¦æˆªé¡ºåºå°±æ˜¯æ³¨å†Œçš„é¡ºåºï¼Œå› æ­¤æ‹¦æˆªå™¨ä¼šæ ¹æ®æ³¨å†Œé¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å¼€æµè§ˆå™¨è¿è¡Œä¸€æ¬¡ï¼š</p>
<blockquote>
<p>ä¸€å·æ‹¦æˆªå™¨ï¼šæˆ‘æ˜¯å¤„ç†ä¹‹å‰ï¼<br>äºŒå·æ‹¦æˆªå™¨ï¼šæˆ‘æ˜¯å¤„ç†ä¹‹å‰ï¼<br>æˆ‘æ˜¯å¤„ç†ï¼<br>äºŒå·æ‹¦æˆªå™¨ï¼šæˆ‘æ˜¯å¤„ç†ä¹‹åï¼<br>ä¸€å·æ‹¦æˆªå™¨ï¼šæˆ‘æ˜¯å¤„ç†ä¹‹åï¼<br>äºŒå·æ‹¦æˆªå™¨ï¼šæˆ‘æ˜¯å®Œæˆä¹‹åï¼<br>ä¸€å·æ‹¦æˆªå™¨ï¼šæˆ‘æ˜¯å®Œæˆä¹‹åï¼</p>
</blockquote>
<p>å’Œå¤šçº§Filterç›¸åŒï¼Œåœ¨å¤„ç†ä¹‹å‰ï¼Œæ˜¯æŒ‰ç…§é¡ºåºä»å‰å‘åè¿›è¡Œæ‹¦æˆªçš„ï¼Œä½†æ˜¯å¤„ç†å®Œæˆä¹‹åï¼Œå°±æŒ‰ç…§å€’åºæ‰§è¡Œå¤„ç†åæ–¹æ³•ï¼Œè€Œå®Œæˆåæ˜¯åœ¨æ‰€æœ‰çš„<code>postHandle</code>æ‰§è¡Œä¹‹åå†åŒæ ·çš„ä»¥å€’åºæ–¹å¼æ‰§è¡Œã€‚</p>
<p>é‚£ä¹ˆå¦‚æœè¿™æ—¶ä¸€å·æ‹¦æˆªå™¨åœ¨å¤„ç†å‰å°±è¿”å›äº†falseå‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸€å·æ‹¦æˆªå™¨ï¼šæˆ‘æ˜¯å¤„ç†ä¹‹å‰ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>ä¸€å·æ‹¦æˆªå™¨ï¼šæˆ‘æ˜¯å¤„ç†ä¹‹å‰ï¼</p>
</blockquote>
<p>æˆ‘ä»¬å‘ç°ï¼Œä¸å•ä¸ªæ‹¦æˆªå™¨çš„æƒ…å†µä¸€æ ·ï¼Œä¸€æ—¦æ‹¦æˆªå™¨è¿”å›falseï¼Œé‚£ä¹ˆä¹‹åæ— è®ºæœ‰æ— æ‹¦æˆªå™¨ï¼Œéƒ½ä¸å†ç»§ç»­ã€‚</p>
<h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h2><p>å½“æˆ‘ä»¬çš„è¯·æ±‚æ˜ å°„æ–¹æ³•ä¸­å‡ºç°å¼‚å¸¸æ—¶ï¼Œä¼šç›´æ¥å±•ç¤ºåœ¨å‰ç«¯é¡µé¢ï¼Œè¿™æ˜¯å› ä¸ºSpringMVCä¸ºæˆ‘ä»¬æä¾›äº†é»˜è®¤çš„å¼‚å¸¸å¤„ç†é¡µé¢ï¼Œå½“å‡ºç°å¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬çš„è¯·æ±‚ä¼šè¢«ç›´æ¥è½¬äº¤ç»™ä¸“é—¨ç”¨äºå¼‚å¸¸å¤„ç†çš„æ§åˆ¶å™¨è¿›è¡Œå¤„ç†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå¼‚å¸¸å¤„ç†æ§åˆ¶å™¨ï¼Œä¸€æ—¦å‡ºç°æŒ‡å®šå¼‚å¸¸ï¼Œå°±ä¼šè½¬æ¥åˆ°æ­¤æ§åˆ¶å™¨æ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ErrorController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">error</span><span class="params">(Exception e, Model model)</span>&#123;  <span class="comment">//å¯ä»¥ç›´æ¥æ·»åŠ å½¢å‚æ¥è·å–å¼‚å¸¸</span></span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        model.addAttribute(<span class="string">&quot;e&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;500&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªä¸“é—¨æ˜¾ç¤ºå¼‚å¸¸çš„é¡µé¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  <span class="number">500</span> - æœåŠ¡å™¨å‡ºç°äº†ä¸€ä¸ªå†…éƒ¨é”™è¯¯QAQ</span><br><span class="line">  &lt;div th:text=<span class="string">&quot;$&#123;e&#125;&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ä¿®æ”¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æˆ‘æ˜¯å¤„ç†ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">true</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ‚¨çš„æ°ªé‡‘åŠ›åº¦ä¸è¶³ï¼Œæ— æ³•è®¿é—®ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®¿é—®åï¼Œæˆ‘ä»¬å‘ç°æ§åˆ¶å°ä¼šè¾“å‡ºå¼‚å¸¸ä¿¡æ¯ï¼ŒåŒæ—¶é¡µé¢ä¹Ÿæ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€ä¸ªé¡µé¢ã€‚</p>
<h2 id="JSONæ•°æ®æ ¼å¼ä¸AJAXè¯·æ±‚"><a href="#JSONæ•°æ®æ ¼å¼ä¸AJAXè¯·æ±‚" class="headerlink" title="JSONæ•°æ®æ ¼å¼ä¸AJAXè¯·æ±‚"></a>JSONæ•°æ®æ ¼å¼ä¸AJAXè¯·æ±‚</h2><p>JSON (JavaScript Object Notation, JS å¯¹è±¡ç®€è°±) æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨æ¨å´‡çš„æ˜¯å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ï¼Œè€Œä¸æ˜¯æ‰€æœ‰çš„å†…å®¹å…¨éƒ¨äº¤ç»™åç«¯æ¸²æŸ“å†å‘é€ç»™æµè§ˆå™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªWebé¡µé¢çš„å†…å®¹åœ¨ä¸€å¼€å§‹å°±ç¼–å†™å®Œæˆäº†ï¼Œè€Œå…¶ä¸­çš„æ•°æ®ç”±å‰ç«¯æ‰§è¡ŒJSä»£ç æ¥å‘æœåŠ¡å™¨åŠ¨æ€è·å–ï¼Œå†åˆ°å‰ç«¯è¿›è¡Œæ¸²æŸ“ï¼ˆå¡«å……ï¼‰ï¼Œè¿™æ ·å¯ä»¥å¤§å¹…åº¦å‡å°‘åç«¯çš„å‹åŠ›ï¼Œå¹¶ä¸”åç«¯åªéœ€è¦ä¼ è¾“å…³é”®æ•°æ®å³å¯ï¼ˆåœ¨å³å°†åˆ°æ¥çš„SpringBooté˜¶æ®µï¼Œæˆ‘ä»¬å°†å®Œå…¨é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼ï¼‰</p>
<h3 id="JSONæ•°æ®æ ¼å¼"><a href="#JSONæ•°æ®æ ¼å¼" class="headerlink" title="JSONæ•°æ®æ ¼å¼"></a>JSONæ•°æ®æ ¼å¼</h3><p>æ—¢ç„¶è¦å®ç°å‰åç«¯åˆ†ç¦»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¿…é¡»çº¦å®šä¸€ç§æ›´åŠ é«˜æ•ˆçš„æ•°æ®ä¼ è¾“æ¨¡å¼ï¼Œæ¥å‘å‰ç«¯é¡µé¢ä¼ è¾“åç«¯æä¾›çš„æ•°æ®ã€‚å› æ­¤JSONæ¨ªç©ºå‡ºä¸–ï¼Œå®ƒéå¸¸å®¹æ˜“ç†è§£ï¼Œå¹¶ä¸”ä¸å‰ç«¯çš„å…¼å®¹æ€§æå¥½ï¼Œå› æ­¤ç°åœ¨æ¯”è¾ƒä¸»æµçš„æ•°æ®ä¼ è¾“æ–¹å¼åˆ™æ˜¯é€šè¿‡JSONæ ¼å¼æ‰¿è½½çš„ã€‚</p>
<p>ä¸€ä¸ªJSONæ ¼å¼çš„æ•°æ®é•¿è¿™æ ·ï¼Œä»¥å­¦ç”Ÿå¯¹è±¡ä¸ºä¾‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ°å“¥&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¤šä¸ªå­¦ç”Ÿå¯ä»¥ä»¥æ•°ç»„çš„å½¢å¼è¡¨ç¤ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ°å“¥&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;é˜¿ä¼Ÿ&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>åµŒå¥—å…³ç³»å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;studentList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ°å“¥&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;é˜¿ä¼Ÿ&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å®ƒç›´æ¥åŒ…æ‹¬äº†å±æ€§çš„åç§°å’Œå±æ€§çš„å€¼ï¼Œä¸JavaScriptçš„å¯¹è±¡æä¸ºç›¸ä¼¼ï¼Œå®ƒåˆ°è¾¾å‰ç«¯åï¼Œå¯ä»¥ç›´æ¥è½¬æ¢ä¸ºå¯¹è±¡ï¼Œä»¥å¯¹è±¡çš„å½¢å¼è¿›è¡Œæ“ä½œå’Œå†…å®¹çš„è¯»å–ï¼Œç›¸å½“äºä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºäº†ä¸€ä¸ªJSå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ§åˆ¶å°çª—å£ä¸­æµ‹è¯•ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;studentList&quot;: [&#123;&quot;name&quot;: &quot;æ°å“¥&quot;, &quot;age&quot;: 18&#125;, &#123;&quot;name&quot;: &quot;é˜¿ä¼Ÿ&quot;, &quot;age&quot;: 18&#125;], &quot;count&quot;: 2&#125;&#x27;</span>)</span><br><span class="line"><span class="comment">//å°†JSONæ ¼å¼å­—ç¬¦ä¸²è½¬æ¢ä¸ºJSå¯¹è±¡</span></span><br><span class="line">obj.<span class="property">studentList</span>[<span class="number">0</span>].<span class="property">name</span>   <span class="comment">//ç›´æ¥è®¿é—®ç¬¬ä¸€ä¸ªå­¦ç”Ÿçš„åç§°</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†JSå¯¹è±¡è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åç«¯å°±å¯ä»¥ä»¥JSONå­—ç¬¦ä¸²çš„å½¢å¼å‘å‰ç«¯è¿”å›æ•°æ®ï¼Œè¿™æ ·å‰ç«¯åœ¨æ‹¿åˆ°æ•°æ®ä¹‹åï¼Œå°±å¯ä»¥å¿«é€Ÿè·å–ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<p>é‚£ä¹ˆåç«¯å¦‚ä½•å¿«é€Ÿåˆ›å»ºä¸€ä¸ªJSONæ ¼å¼çš„æ•°æ®å‘¢ï¼Ÿæˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¼å…¥ä»¥ä¸‹ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.78<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JSONè§£ææ¡†æ¶æœ‰å¾ˆå¤šç§ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ˜¯Jacksonå’ŒFastJSONï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨é˜¿é‡Œå·´å·´çš„FastJSONè¿›è¡Œè§£æã€‚</p>
<p>é¦–å…ˆè¦ä»‹ç»çš„æ˜¯JSONObjectï¼Œå®ƒå’ŒMapçš„ä½¿ç”¨æ–¹æ³•ä¸€æ ·ï¼ˆå®ç°äº†Mapæ¥å£ï¼‰ï¼Œæ¯”å¦‚æˆ‘ä»¬å‘å…¶ä¸­å­˜æ”¾å‡ ä¸ªæ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    object.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;æ°å“¥&quot;</span>);</span><br><span class="line">    object.put(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    System.out.println(object.toJSONString());   <span class="comment">//ä»¥JSONæ ¼å¼è¾“å‡ºJSONObjectå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å¾—åˆ°çš„ç»“æœä¸ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ°å“¥&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸ŠJSONObjectå°±æ˜¯å¯¹JSONæ•°æ®çš„ä¸€ç§å¯¹è±¡è¡¨ç¤ºã€‚åŒæ ·çš„è¿˜æœ‰JSONArrayï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ³•å’ŒListä¸€æ ·ï¼Œæ•°ç»„ä¸­å¯ä»¥åµŒå¥—å…¶ä»–çš„JSONObjectæˆ–æ˜¯JSONArrayï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    object.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;æ°å“¥&quot;</span>);</span><br><span class="line">    object.put(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">    <span class="type">JSONArray</span> <span class="variable">array</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">    array.add(object);</span><br><span class="line">    System.out.println(array.toJSONString());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°çš„ç»“æœä¸ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ°å“¥&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>å½“å‡ºç°å¾ªç¯å¼•ç”¨æ—¶ï¼Œä¼šæŒ‰ç…§ä»¥ä¸‹è¯­æ³•æ¥è§£æï¼š<img src="https://img2018.cnblogs.com/blog/1758707/201908/1758707-20190814212141691-1998020800.png" alt="img"></p>
<p>æˆ‘ä»¬å¯ä»¥ä¹Ÿç›´æ¥åˆ›å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œå°†å®ä½“ç±»è½¬æ¢ä¸ºJSONæ ¼å¼çš„æ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/index&quot;, produces = &quot;application/json&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">data</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setName(<span class="string">&quot;æ°å“¥&quot;</span>);</span><br><span class="line">    student.setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="keyword">return</span> JSON.toJSONString(student);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹äº†<code>produces</code>çš„å€¼ï¼Œå°†è¿”å›çš„å†…å®¹ç±»å‹è®¾å®šä¸º<code>application/json</code>ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç«¯è¿”å›äº†ä¸€ä¸ªJSONæ ¼å¼çš„æ•°æ®ï¼ˆå½“ç„¶ä¸è®¾ç½®ä¹Ÿè¡Œï¼Œä¹Ÿèƒ½å±•ç¤ºï¼Œè¿™æ ·æ˜¯ä¸ºäº†è§„èŒƒï¼‰ç„¶åæˆ‘ä»¬åœ¨æ–¹æ³•ä¸Šæ·»åŠ ä¸€ä¸ª<code>@ResponseBody</code>è¡¨ç¤ºæ–¹æ³•è¿”å›ï¼ˆä¹Ÿå¯ä»¥åœ¨ç±»ä¸Šæ·»åŠ <code>@RestController</code>è¡¨ç¤ºæ­¤Controlleré»˜è®¤è¿”å›çš„æ˜¯å­—ç¬¦ä¸²æ•°æ®ï¼‰çš„ç»“æœä¸æ˜¯è§†å›¾åç§°è€Œæ˜¯ç›´æ¥éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºé¡µé¢æ•°æ®ï¼Œè¿™æ ·ï¼Œè¿”å›ç»™æµè§ˆå™¨çš„å°±æ˜¯æˆ‘ä»¬ç›´æ¥è¿”å›çš„å­—ç¬¦ä¸²å†…å®¹ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬ä½¿ç”¨JSONå·¥å…·ç±»å°†å…¶è½¬æ¢ä¸ºJSONæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œå¾—åˆ°JSONæ ¼å¼æ•°æ®ã€‚</p>
<p>SpringMVCéå¸¸æ™ºèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/data&quot;, produces = &quot;application/json&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Student <span class="title function_">data</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setName(<span class="string">&quot;æ°å“¥&quot;</span>);</span><br><span class="line">    student.setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„éœ€è¦åœ¨é…ç½®ç±»ä¸­æ·»åŠ ä¸€ä¸‹FastJSONè½¬æ¢å™¨ï¼ˆé»˜è®¤åªæ”¯æŒJackSonï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">    converters.add(<span class="keyword">new</span> <span class="title class_">FastJsonHttpMessageConverter</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="AJAXè¯·æ±‚"><a href="#AJAXè¯·æ±‚" class="headerlink" title="AJAXè¯·æ±‚"></a>AJAXè¯·æ±‚</h3><p>å‰é¢æˆ‘ä»¬è®²è§£äº†å¦‚ä½•å‘æµè§ˆå™¨å‘é€ä¸€ä¸ªJSONæ ¼å¼çš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹å¦‚ä½•å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ã€‚</p>
<p><img src="https://www.runoob.com/wp-content/uploads/2013/09/ajax-yl.png" alt="AJAX"></p>
<p>Ajaxå³<strong>A</strong>synchronous <strong>J</strong>avascript <strong>A</strong>nd <strong>X</strong>MLï¼ˆå¼‚æ­¥JavaScriptå’ŒXMLï¼‰ï¼Œå®ƒçš„ç›®æ ‡å°±æ˜¯å®ç°é¡µé¢ä¸­çš„æ•°æ®åŠ¨æ€æ›´æ–°ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ·æ–°æ•´ä¸ªé¡µé¢ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¦‚å¿µã€‚</p>
<p>å®ƒåœ¨JQueryæ¡†æ¶ä¸­æœ‰å®ç°ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥å¯¼å…¥JQueryï¼ˆJQueryæå¤§åœ°ç®€åŒ–äº†JSçš„å¼€å‘ï¼Œå°è£…äº†å¾ˆå¤šå†…å®¹ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥äº†è§£ä¸€ä¸‹ï¼‰ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://code.jquery.com/jquery-3.1.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ï¼Œé¦–å…ˆä¿®æ”¹ä¸€ä¸‹å‰ç«¯é¡µé¢ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://code.jquery.com/jquery-3.1.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/static/test.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    ä½ å¥½ï¼Œ</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    æ‚¨çš„å¹´é¾„æ˜¯ï¼š</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;updateData()&quot;</span>&gt;</span>ç‚¹æˆ‘æ›´æ–°é¡µé¢æ•°æ®<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¸Œæœ›ç”¨æˆ·åç§°å’Œå¹´é¾„éœ€è¦åœ¨æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ä¹‹åæ‰ä¼šæ›´æ–°ï¼Œæˆ‘ä»¬æ¥ç€æ¥ç¼–å†™ä¸€ä¸‹JSï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//ç¾å…ƒç¬¦.çš„æ–¹å¼æ¥ä½¿ç”¨Ajaxè¯·æ±‚ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯getæ–¹å¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¯·æ±‚çš„åœ°å€ï¼ˆæ³¨æ„éœ€è¦å¸¦ä¸ŠWebåº”ç”¨ç¨‹åºåç§°ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæˆåŠŸè·å–åˆ°æ•°æ®çš„æ–¹æ³•ï¼Œdataå°±æ˜¯è¿”å›çš„æ•°æ®å†…å®¹</span></span><br><span class="line">  	$.<span class="title function_">get</span>(<span class="string">&quot;/mvc/data&quot;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;   <span class="comment">//è·å–æˆåŠŸæ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">alert</span>(<span class="string">&#x27;æ¥å—åˆ°å¼‚æ­¥è¯·æ±‚æ•°æ®ï¼š&#x27;</span>+<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))  <span class="comment">//å¼¹çª—å±•ç¤ºæ•°æ®</span></span><br><span class="line">        $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">text</span>(data.<span class="property">name</span>)   <span class="comment">//è¿™é‡Œä½¿ç”¨äº†JQueryæä¾›çš„é€‰æ‹©å™¨ï¼Œç›´æ¥é€‰æ‹©idä¸ºusernameçš„å…ƒç´ ï¼Œæ›´æ–°æ•°æ®</span></span><br><span class="line">        $(<span class="string">&quot;#age&quot;</span>).<span class="title function_">text</span>(data.<span class="property">age</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨JQueryéå¸¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡JQueryçš„é€‰æ‹©å™¨å°±å¯ä»¥å¿«é€Ÿè·å–é¡µé¢ä¸­çš„å…ƒç´ ï¼Œæ³¨æ„è¿™é‡Œè·å–çš„å…ƒç´ æ˜¯è¢«JQueryå°è£…è¿‡çš„å…ƒç´ ï¼Œéœ€è¦ä½¿ç”¨JQueryæä¾›çš„æ–¹æ³•æ¥è¿›è¡Œæ“ä½œã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®ç°äº†ä»æœåŠ¡ç«¯è·å–æ•°æ®å¹¶æ›´æ–°åˆ°é¡µé¢ä¸­ï¼ˆå®é™…ä¸Šä¹‹å‰ï¼Œæˆ‘ä»¬åœ¨JavaWebé˜¶æ®µä½¿ç”¨XHRè¯·æ±‚ä¹Ÿæ¼”ç¤ºè¿‡ï¼Œä¸è¿‡å½“æ—¶æ˜¯çº¯ç²¹çš„æ•°æ®ï¼‰</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œå¦‚ä½•å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªJSå¯¹è±¡æ•°æ®å¹¶è¿›è¡Œè§£æï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">submitData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $.<span class="title function_">post</span>(<span class="string">&quot;/mvc/submit&quot;</span>, &#123;   <span class="comment">//è¿™é‡Œä½¿ç”¨POSTæ–¹æ³•å‘é€è¯·æ±‚</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;æµ‹è¯•&quot;</span>,     <span class="comment">//ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦ä¼ é€’çš„å¯¹è±¡ï¼Œä¼šä»¥è¡¨å•æ•°æ®çš„æ–¹å¼å‘é€</span></span><br><span class="line">      	<span class="attr">age</span>: <span class="number">18</span>   </span><br><span class="line">    &#125;, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">alert</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))   <span class="comment">//å‘é€æˆåŠŸæ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœåŠ¡å™¨ç«¯åªéœ€è¦åœ¨è¯·æ±‚å‚æ•°ä½ç½®æ·»åŠ ä¸€ä¸ªå¯¹è±¡æ¥æ”¶å³å¯ï¼ˆå’Œå‰é¢æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºè¿™é‡Œä¹Ÿæ˜¯æäº¤çš„è¡¨å•æ•°æ®ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/submit&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">submit</span><span class="params">(Student student)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°å‰ç«¯æ•°æ®ï¼š&quot;</span>+student);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;success\&quot;: true&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†jså¯¹è±¡è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²çš„å½¢å¼è¿›è¡Œä¼ è¾“ï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨ajaxæ–¹æ³•æ¥å¤„ç†ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">submitData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;   <span class="comment">//æœ€åŸºæœ¬çš„è¯·æ±‚æ–¹å¼ï¼Œéœ€è¦è‡ªå·±è®¾å®šä¸€äº›å‚æ•°</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,   <span class="comment">//è®¾å®šè¯·æ±‚æ–¹æ³•</span></span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;/mvc/submit&quot;</span>,   <span class="comment">//è¯·æ±‚åœ°å€</span></span><br><span class="line">        <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;æµ‹è¯•&quot;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;),  <span class="comment">//è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²è¿›è¡Œå‘é€</span></span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="title function_">alert</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">contentType</span>: <span class="string">&quot;application/json&quot;</span>  <span class="comment">//è¯·æ±‚å¤´Content-Typeä¸€å®šè¦è®¾å®šä¸ºJSONæ ¼å¼</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬éœ€è¦è¯»å–å‰ç«¯å‘é€ç»™æˆ‘ä»¬çš„JSONæ ¼å¼æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦æ·»åŠ <code>@RequestBody</code>æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/submit&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">submit</span><span class="params">(<span class="meta">@RequestBody</span> JSONObject object)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°å‰ç«¯æ•°æ®ï¼š&quot;</span>+object);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;success\&quot;: true&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®ç°äº†å‰åç«¯ä½¿ç”¨JSONå­—ç¬¦ä¸²è¿›è¡Œé€šä¿¡ã€‚</p>
<h2 id="å®ç°æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½"><a href="#å®ç°æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½" class="headerlink" title="å®ç°æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½"></a>å®ç°æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½</h2><p>åˆ©ç”¨SpringMVCï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°å®ç°æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦é…ç½®ä¸€ä¸ªResolverï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;multipartResolver&quot;)</span>   <span class="comment">//æ³¨æ„è¿™é‡ŒBeançš„åç§°æ˜¯å›ºå®šçš„ï¼Œå¿…é¡»æ˜¯multipartResolver</span></span><br><span class="line"><span class="keyword">public</span> CommonsMultipartResolver <span class="title function_">commonsMultipartResolver</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CommonsMultipartResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommonsMultipartResolver</span>();</span><br><span class="line">    resolver.setMaxUploadSize(<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">10</span>);   <span class="comment">//æœ€å¤§10MBå¤§å°</span></span><br><span class="line">    resolver.setDefaultEncoding(<span class="string">&quot;UTF-8&quot;</span>);   <span class="comment">//é»˜è®¤ç¼–ç æ ¼å¼</span></span><br><span class="line">    <span class="keyword">return</span> resolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬ç›´æ¥ç¼–å†™Controllerå³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/upload&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam</span> CommonsMultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">File</span> <span class="variable">fileObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;test.html&quot;</span>);</span><br><span class="line">    file.transferTo(fileObj);</span><br><span class="line">    System.out.println(<span class="string">&quot;ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶å·²ä¿å­˜åˆ°ï¼š&quot;</span>+fileObj.getAbsolutePath());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨CommonsMultipartFileå¯¹è±¡æ¥æ¥æ”¶ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ã€‚å®ƒæ˜¯åŸºäºApacheçš„Commons-fileuploadæ¡†æ¶å®ç°çš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¼å…¥ä¸€ä¸ªä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€ååœ¨å‰ç«¯æ·»åŠ ä¸€ä¸ªæ–‡ä»¶çš„ä¸Šä¼ ç‚¹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œç‚¹å‡»æäº¤ä¹‹åï¼Œæ–‡ä»¶å°±ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨äº†ã€‚</p>
<p>ä¸‹è½½å…¶å®å’Œæˆ‘ä»¬ä¹‹å‰çš„å†™æ³•å¤§è‡´ä¸€æ ·ï¼Œç›´æ¥ä½¿ç”¨HttpServletResponseï¼Œå¹¶å‘è¾“å‡ºæµä¸­ä¼ è¾“æ•°æ®å³å¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/download&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">download</span><span class="params">(HttpServletResponse response)</span>&#123;</span><br><span class="line">    response.setContentType(<span class="string">&quot;multipart/form-data&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span>(<span class="type">OutputStream</span> <span class="variable">stream</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;test.html&quot;</span>))&#123;</span><br><span class="line">        IOUtils.copy(inputStream, stream);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å‰ç«¯é¡µé¢ä¸­æ·»åŠ ä¸€ä¸ªä¸‹è½½ç‚¹ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;download&quot;</span> <span class="attr">download</span>=<span class="string">&quot;test.html&quot;</span>&gt;</span>ä¸‹è½½æœ€æ–°èµ„æº<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="è§£è¯»DispatcherServletæºç "><a href="#è§£è¯»DispatcherServletæºç " class="headerlink" title="è§£è¯»DispatcherServletæºç "></a>è§£è¯»DispatcherServletæºç </h2><p><strong>æ³¨æ„ï¼š</strong>æœ¬éƒ¨åˆ†ä½œä¸ºé€‰å­¦å†…å®¹ï¼</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå…³äºSpringMVCçš„ç›¸å…³å†…å®¹å°±å­¦ä¹ å¾—å·®ä¸å¤šäº†ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨æœ€åè¿˜æ˜¯éœ€è¦æ·±å…¥äº†è§£ä¸€ä¸‹DispatcherServletåº•å±‚æ˜¯å¦‚ä½•è¿›è¡Œè°ƒåº¦çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¼šä»æºç è§’åº¦è¿›è¡Œè®²è§£ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ°<code>DispatcherServlet</code>çš„æœ€é¡¶å±‚<code>HttpServletBean</code>ï¼Œåœ¨è¿™é‡Œç›´æ¥ç»§æ‰¿çš„<code>HttpServlet</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œå®ƒåœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­åšäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">  	<span class="comment">//è¯»å–é…ç½®å‚æ•°ï¼Œå¹¶è¿›è¡Œé…ç½®</span></span><br><span class="line">    <span class="type">PropertyValues</span> <span class="variable">pvs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpServletBean</span>.ServletConfigPropertyValues(<span class="built_in">this</span>.getServletConfig(), <span class="built_in">this</span>.requiredProperties);</span><br><span class="line">    <span class="keyword">if</span> (!pvs.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">BeanWrapper</span> <span class="variable">bw</span> <span class="operator">=</span> PropertyAccessorFactory.forBeanPropertyAccess(<span class="built_in">this</span>);</span><br><span class="line">            <span class="type">ResourceLoader</span> <span class="variable">resourceLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextResourceLoader</span>(<span class="built_in">this</span>.getServletContext());</span><br><span class="line">            bw.registerCustomEditor(Resource.class, <span class="keyword">new</span> <span class="title class_">ResourceEditor</span>(resourceLoader, <span class="built_in">this</span>.getEnvironment()));</span><br><span class="line">            <span class="built_in">this</span>.initBeanWrapper(bw);</span><br><span class="line">            bw.setPropertyValues(pvs, <span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BeansException var4) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isErrorEnabled()) &#123;</span><br><span class="line">                <span class="built_in">this</span>.logger.error(<span class="string">&quot;Failed to set bean properties on servlet &#x27;&quot;</span> + <span class="built_in">this</span>.getServletName() + <span class="string">&quot;&#x27;&quot;</span>, var4);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> var4;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">		<span class="comment">//æ­¤åˆå§‹åŒ–é˜¶æ®µç”±å­ç±»å®ç°ï¼Œ</span></span><br><span class="line">    <span class="built_in">this</span>.initServletBean();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹<code>initServletBean()</code>æ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå®ƒæ˜¯åœ¨å­ç±»<code>FrameworkServlet</code>ä¸­å®šä¹‰çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">initServletBean</span><span class="params">()</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    <span class="built_in">this</span>.getServletContext().log(<span class="string">&quot;Initializing Spring &quot;</span> + <span class="built_in">this</span>.getClass().getSimpleName() + <span class="string">&quot; &#x27;&quot;</span> + <span class="built_in">this</span>.getServletName() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isInfoEnabled()) &#123;</span><br><span class="line">        <span class="built_in">this</span>.logger.info(<span class="string">&quot;Initializing Servlet &#x27;&quot;</span> + <span class="built_in">this</span>.getServletName() + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      	<span class="comment">//æ³¨æ„ï¼šæˆ‘ä»¬åœ¨ä¸€å¼€å§‹è¯´äº†SpringMVCæœ‰ä¸¤ä¸ªå®¹å™¨ï¼Œä¸€ä¸ªæ˜¯Webå®¹å™¨ä¸€ä¸ªæ˜¯æ ¹å®¹å™¨</span></span><br><span class="line">      	<span class="comment">//Webå®¹å™¨åªè´Ÿè´£Controllerç­‰è¡¨ç°å±‚å†…å®¹</span></span><br><span class="line">      	<span class="comment">//æ ¹å®¹å™¨å°±æ˜¯Springå®¹å™¨ï¼Œå®ƒè´Ÿè´£Serviceã€Daoç­‰ï¼Œå¹¶ä¸”å®ƒæ˜¯Webå®¹å™¨çš„çˆ¶å®¹å™¨ã€‚</span></span><br><span class="line">      	<span class="comment">//åˆå§‹åŒ–WebApplicationContextï¼Œè¿™ä¸ªé˜¶æ®µä¼šä¸ºæ ¹å®¹å™¨å’ŒWebå®¹å™¨è¿›è¡Œçˆ¶å­å…³ç³»å»ºç«‹</span></span><br><span class="line">        <span class="built_in">this</span>.webApplicationContext = <span class="built_in">this</span>.initWebApplicationContext();</span><br><span class="line">        <span class="built_in">this</span>.initFrameworkServlet();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException | ServletException var4) &#123;</span><br><span class="line">      <span class="comment">//...ä»¥ä¸‹å†…å®¹å…¨æ˜¯æ‰“å°æ—¥å¿—</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://images2018.cnblogs.com/blog/1290804/201712/1290804-20171209164442730-1374080285.png" alt="img"></p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹<code>initWebApplicationContext</code>æ˜¯å¦‚ä½•è¿›è¡Œåˆå§‹åŒ–çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">initWebApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">  	<span class="comment">//è¿™é‡Œè·å–çš„æ˜¯æ ¹å®¹å™¨ï¼Œä¸€èˆ¬ç”¨äºé…ç½®Serviceã€æ•°æ®æºç­‰</span></span><br><span class="line">    <span class="type">WebApplicationContext</span> <span class="variable">rootContext</span> <span class="operator">=</span> WebApplicationContextUtils.getWebApplicationContext(<span class="built_in">this</span>.getServletContext());</span><br><span class="line">    <span class="type">WebApplicationContext</span> <span class="variable">wac</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.webApplicationContext != <span class="literal">null</span>) &#123;</span><br><span class="line">      	<span class="comment">//å¦‚æœwebApplicationContextåœ¨ä¹‹å‰å·²ç»å­˜åœ¨ï¼Œåˆ™ç›´æ¥ç»™åˆ°wac</span></span><br><span class="line">        wac = <span class="built_in">this</span>.webApplicationContext;</span><br><span class="line">        <span class="keyword">if</span> (wac <span class="keyword">instanceof</span> ConfigurableWebApplicationContext) &#123;</span><br><span class="line">            <span class="type">ConfigurableWebApplicationContext</span> <span class="variable">cwac</span> <span class="operator">=</span> (ConfigurableWebApplicationContext)wac;</span><br><span class="line">            <span class="keyword">if</span> (!cwac.isActive()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (cwac.getParent() == <span class="literal">null</span>) &#123;</span><br><span class="line">                  	<span class="comment">//è®¾å®šæ ¹å®¹å™¨ä¸ºWebå®¹å™¨çš„çˆ¶å®¹å™¨</span></span><br><span class="line">                    cwac.setParent(rootContext);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">this</span>.configureAndRefreshWebApplicationContext(cwac);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (wac == <span class="literal">null</span>) &#123;</span><br><span class="line">      	<span class="comment">//å¦‚æœwebApplicationContextæ˜¯ç©ºï¼Œé‚£ä¹ˆå°±ä»ServletContextæ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰åˆå§‹åŒ–ä¸Šä¸‹æ–‡</span></span><br><span class="line">        wac = <span class="built_in">this</span>.findWebApplicationContext();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (wac == <span class="literal">null</span>) &#123;</span><br><span class="line">      	<span class="comment">//å¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œç›´æ¥åˆ›ä¸ªæ–°çš„ï¼Œå¹¶ç›´æ¥å°†æ ¹å®¹å™¨ä½œä¸ºçˆ¶å®¹å™¨</span></span><br><span class="line">        wac = <span class="built_in">this</span>.createWebApplicationContext(rootContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.refreshEventReceived) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="built_in">this</span>.onRefreshMonitor) &#123;</span><br><span class="line">          	<span class="comment">//æ­¤æ–¹æ³•ç”±DispatcherServletå®ç°</span></span><br><span class="line">            <span class="built_in">this</span>.onRefresh(wac);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.publishContext) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">attrName</span> <span class="operator">=</span> <span class="built_in">this</span>.getServletContextAttributeName();</span><br><span class="line">      	<span class="comment">//æŠŠWebå®¹å™¨ä¸¢è¿›ServletContext</span></span><br><span class="line">        <span class="built_in">this</span>.getServletContext().setAttribute(attrName, wac);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wac;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹DispatcherServletä¸­å®ç°çš„<code>onRefresh()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onRefresh</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">    initStrategies(context);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initStrategies</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">  	<span class="comment">//åˆå§‹åŒ–å„ç§è§£æå™¨</span></span><br><span class="line">    initMultipartResolver(context);</span><br><span class="line">    initLocaleResolver(context);</span><br><span class="line">    initThemeResolver(context);</span><br><span class="line">  	<span class="comment">//åœ¨å®¹å™¨ä¸­æŸ¥æ‰¾æ‰€æœ‰çš„HandlerMappingï¼Œæ”¾å…¥é›†åˆä¸­</span></span><br><span class="line">  	<span class="comment">//HandlerMappingä¿å­˜äº†æ‰€æœ‰çš„è¯·æ±‚æ˜ å°„ä¿¡æ¯ï¼ˆControllerä¸­å®šä¹‰çš„ï¼‰ï¼Œå®ƒå¯ä»¥æ ¹æ®è¯·æ±‚æ‰¾åˆ°å¤„ç†å™¨Handlerï¼Œä½†å¹¶ä¸æ˜¯ç®€å•çš„è¿”å›å¤„ç†å™¨ï¼Œè€Œæ˜¯å°†å¤„ç†å™¨å’Œæ‹¦æˆªå™¨å°è£…ï¼Œå½¢æˆä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ˆç±»ä¼¼äºä¹‹å‰çš„Filterï¼‰</span></span><br><span class="line">    initHandlerMappings(context);</span><br><span class="line">  	<span class="comment">//åœ¨å®¹å™¨ä¸­æŸ¥æ‰¾æ‰€æœ‰çš„HandlerAdapterï¼Œå®ƒç”¨äºå¤„ç†è¯·æ±‚å¹¶è¿”å›ModelAndViewå¯¹è±¡</span></span><br><span class="line">  	<span class="comment">//é»˜è®¤æœ‰ä¸‰ç§å®ç°HttpRequestHandlerAdapterï¼ŒSimpleControllerHandlerAdapterå’ŒAnnotationMethodHandlerAdapter</span></span><br><span class="line">  	<span class="comment">//å½“HandlerMappingæ‰¾åˆ°å¤„ç†è¯·æ±‚çš„Controllerä¹‹åï¼Œä¼šé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„HandlerAdapterå¤„ç†è¯·æ±‚</span></span><br><span class="line">  	<span class="comment">//æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æ˜¯æ³¨è§£æ–¹å¼é…ç½®Controllerï¼Œç°åœ¨æœ‰ä¸€ä¸ªè¯·æ±‚æºå¸¦äº†ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆHandlerAdapterä¼šå¯¹è¯·æ±‚çš„æ•°æ®è¿›è¡Œè§£æï¼Œå¹¶ä¼ å…¥æ–¹æ³•ä½œä¸ºå®å‚ï¼Œæœ€åæ ¹æ®æ–¹æ³•çš„è¿”å›å€¼å°†å…¶å°è£…ä¸ºModelAndViewå¯¹è±¡</span></span><br><span class="line">    initHandlerAdapters(context);</span><br><span class="line">  	<span class="comment">//å…¶ä»–çš„å†…å®¹</span></span><br><span class="line">    initHandlerExceptionResolvers(context);</span><br><span class="line">    initRequestToViewNameTranslator(context);</span><br><span class="line">    initViewResolvers(context);</span><br><span class="line">    initFlashMapManager(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DispatcherServletåˆå§‹åŒ–è¿‡ç¨‹æˆ‘ä»¬å·²ç»äº†è§£äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ç€æ¥çœ‹DispatcherServletæ˜¯å¦‚ä½•è¿›è¡Œè°ƒåº¦çš„ï¼Œé¦–å…ˆæˆ‘ä»¬çš„è¯·æ±‚è‚¯å®šä¼šç»è¿‡<code>HttpServlet</code>ï¼Œç„¶åå…¶äº¤ç»™å¯¹åº”çš„doGetã€doPostç­‰æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œè€Œåœ¨<code>FrameworkServlet</code>ä¸­ï¼Œè¿™äº›æ–¹æ³•éƒ½è¢«é‡å†™ï¼Œå¹¶ä¸”ä½¿ç”¨<code>processRequest</code>æ¥è¿›è¡Œå¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="built_in">this</span>.processRequest(request, response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="built_in">this</span>.processRequest(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥çœ‹çœ‹<code>processRequest</code>åšäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">  	<span class="comment">//å‰æœŸå‡†å¤‡å·¥ä½œ</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">failureCause</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">LocaleContext</span> <span class="variable">previousLocaleContext</span> <span class="operator">=</span> LocaleContextHolder.getLocaleContext();</span><br><span class="line">    <span class="type">LocaleContext</span> <span class="variable">localeContext</span> <span class="operator">=</span> <span class="built_in">this</span>.buildLocaleContext(request);</span><br><span class="line">    <span class="type">RequestAttributes</span> <span class="variable">previousAttributes</span> <span class="operator">=</span> RequestContextHolder.getRequestAttributes();</span><br><span class="line">    <span class="type">ServletRequestAttributes</span> <span class="variable">requestAttributes</span> <span class="operator">=</span> <span class="built_in">this</span>.buildRequestAttributes(request, response, previousAttributes);</span><br><span class="line">    <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line">    asyncManager.registerCallableInterceptor(FrameworkServlet.class.getName(), <span class="keyword">new</span> <span class="title class_">FrameworkServlet</span>.RequestBindingInterceptor());</span><br><span class="line">    <span class="built_in">this</span>.initContextHolders(request, localeContext, requestAttributes);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      	<span class="comment">//é‡ç‚¹åœ¨è¿™é‡Œï¼Œè¿™é‡Œè¿›è¡Œäº†Serviceçš„æ‰§è¡Œï¼Œä¸è¿‡æ˜¯åœ¨DispatcherServletä¸­å®šä¹‰çš„</span></span><br><span class="line">        <span class="built_in">this</span>.doService(request, response);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException | ServletException var16) &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯·å„ä½ä¸€å®šè¦è€å¿ƒï¼Œè¿™äº›å¤§å‹æ¡†æ¶çš„åº•å±‚ä¸€èˆ¬éƒ½æ˜¯å±‚å±‚å¥—å¨ƒï¼Œå› ä¸ºè¿™æ ·å†™èµ·æ¥å±‚æ¬¡ä¼šæ›´åŠ æ¸…æ™°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹<code>DispatcherServlet</code>ä¸­æ˜¯å¦‚ä½•å®ç°çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">   <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      	<span class="comment">//é‡ç‚¹åœ¨è¿™é‡Œï¼Œè¿™æ‰æ˜¯æ•´ä¸ªå¤„ç†è¿‡ç¨‹ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†</span></span><br><span class="line">        <span class="built_in">this</span>.doDispatch(request, response);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»ˆäºæ‰¾åˆ°æœ€æ ¸å¿ƒçš„éƒ¨åˆ†äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">processedRequest</span> <span class="operator">=</span> request;</span><br><span class="line">    <span class="type">HandlerExecutionChain</span> <span class="variable">mappedHandler</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">multipartRequestParsed</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">dispatchException</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                processedRequest = <span class="built_in">this</span>.checkMultipart(request);</span><br><span class="line">                multipartRequestParsed = processedRequest != request;</span><br><span class="line">              	<span class="comment">//åœ¨HandlerMappingé›†åˆä¸­å¯»æ‰¾å¯ä»¥å¤„ç†å½“å‰è¯·æ±‚çš„HandlerMapping</span></span><br><span class="line">                mappedHandler = <span class="built_in">this</span>.getHandler(processedRequest);</span><br><span class="line">                <span class="keyword">if</span> (mappedHandler == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.noHandlerFound(processedRequest, response);</span><br><span class="line">                  	<span class="comment">//æ‰¾ä¸åˆ°HandlerMappingåˆ™æ— æ³•è¿›è¡Œå¤„ç†</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">              	<span class="comment">//æ ¹æ®HandlerMappingæä¾›çš„ä¿¡æ¯ï¼Œæ‰¾åˆ°å¯ä»¥å¤„ç†çš„HandlerAdapter</span></span><br><span class="line">                <span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> <span class="built_in">this</span>.getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line">                <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">isGet</span> <span class="operator">=</span> HttpMethod.GET.matches(method);</span><br><span class="line">                <span class="keyword">if</span> (isGet || HttpMethod.HEAD.matches(method)) &#123;</span><br><span class="line">                    <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> ha.getLastModified(request, mappedHandler.getHandler());</span><br><span class="line">                    <span class="keyword">if</span> ((<span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response)).checkNotModified(lastModified) &amp;&amp; isGet) &#123;</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">              	<span class="comment">//æ‰§è¡Œæ‰€æœ‰æ‹¦æˆªå™¨çš„preHandle()æ–¹æ³•</span></span><br><span class="line">                <span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">              	<span class="comment">//ä½¿ç”¨HandlerAdapterè¿›è¡Œå¤„ç†ï¼ˆæˆ‘ä»¬ç¼–å†™çš„è¯·æ±‚æ˜ å°„æ–¹æ³•åœ¨è¿™ä¸ªä½ç½®æ‰çœŸæ­£åœ°æ‰§è¡Œäº†ï¼‰</span></span><br><span class="line">              	<span class="comment">//HandlerAdapterä¼šå¸®åŠ©æˆ‘ä»¬å°†è¯·æ±‚çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå†æ¥è°ƒç”¨æˆ‘ä»¬ç¼–å†™çš„è¯·æ±‚æ˜ å°„æ–¹æ³•</span></span><br><span class="line">              	<span class="comment">//æœ€åHandlerAdapterä¼šå°†ç»“æœå°è£…ä¸ºModelAndViewè¿”å›ç»™mv</span></span><br><span class="line">                mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line">                <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">this</span>.applyDefaultViewName(processedRequest, mv);</span><br><span class="line">              	<span class="comment">//æ‰§è¡Œæ‰€æœ‰æ‹¦æˆªå™¨çš„postHandle()æ–¹æ³•</span></span><br><span class="line">                mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception var20) &#123;</span><br><span class="line">                dispatchException = var20;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable var21) &#123;</span><br><span class="line">                dispatchException = <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Handler dispatch failed&quot;</span>, var21);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          	<span class="comment">//æœ€åå¤„ç†ç»“æœï¼Œå¯¹è§†å›¾è¿›è¡Œæ¸²æŸ“ç­‰ï¼Œå¦‚æœæŠ›å‡ºå¼‚å¸¸ä¼šå‡ºç°é”™è¯¯é¡µé¢</span></span><br><span class="line">            <span class="built_in">this</span>.processDispatchResult(processedRequest, response, mappedHandler, mv, (Exception)dispatchException);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var22) &#123;</span><br><span class="line">            <span class="built_in">this</span>.triggerAfterCompletion(processedRequest, response, mappedHandler, var22);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var23) &#123;</span><br><span class="line">            <span class="built_in">this</span>.triggerAfterCompletion(processedRequest, response, mappedHandler, <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Handler processing failed&quot;</span>, var23));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mappedHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">                mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (multipartRequestParsed) &#123;</span><br><span class="line">            <span class="built_in">this</span>.cleanupMultipart(processedRequest);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œæ ¹æ®ä»¥ä¸Šæºç åˆ†æå¾—å‡ºæœ€ç»ˆçš„æµç¨‹å›¾ï¼š</p>
<p><img src="https://img2018.cnblogs.com/blog/1338162/201901/1338162-20190113192808388-307235311.png" alt="img"></p>
<p>è™½ç„¶å®Œæˆæœ¬ç« å­¦ä¹ åï¼Œæˆ‘ä»¬å·²ç»åŸºæœ¬èƒ½å¤ŸåŸºäºSpringå»é‡æ–°ç¼–å†™ä¸€ä¸ªæ›´åŠ é«˜çº§çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿäº†ï¼Œä½†æ˜¯ç™»é™†éªŒè¯å¤æ‚çš„é—®é¢˜ä¾ç„¶æ²¡æœ‰è§£å†³ï¼Œå¦‚æœæˆ‘ä»¬ä¾ç„¶æŒ‰ç…§ä¹‹å‰çš„æ–¹å¼ç¼–å†™ç™»é™†éªŒè¯ï¼Œæ˜¾ç„¶å¤ªè¿‡ç®€å•ï¼Œå®ƒä»…ä»…åªæ˜¯ä¸€ä¸ªç™»é™†ï¼Œä½†æ˜¯æ²¡æœ‰ä»»ä½•çš„æƒé™åˆ’åˆ†æˆ–æ˜¯åŠ å¯†å¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦æ›´åŠ é«˜çº§çš„æƒé™æ ¡éªŒæ¡†æ¶æ¥å¸®åŠ©æˆ‘ä»¬å®ç°ç™»é™†æ“ä½œï¼Œä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬ä¼šè¯¦ç»†è®²è§£å¦‚ä½•ä½¿ç”¨æ›´åŠ é«˜çº§çš„SpringSecurityæ¡†æ¶æ¥è¿›è¡Œæƒé™éªŒè¯ï¼Œå¹¶åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œé‡å†™æˆ‘ä»¬çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿã€‚</p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>SSM</tag>
      </tags>
  </entry>
  <entry>
    <title>SSMç¬”è®°-1</title>
    <url>/2022/04/23/Java%20SSM%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic1.zhimg.com%2Fv2-0e96436a999ac26218fc54344799c859_1200x500.jpg&refer=http%3A%2F%2Fpic1.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1640617321&t=806572e49f8f6deafd8486b19af6d192" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p><strong>å»ºè®®ï¼š</strong>å¯¹Javaå¼€å‘è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰çš„åŒå­¦ï¼Œæœ€å¥½å…ˆèŠ±è´¹åŠä¸ªæœˆåˆ°ä¸€ä¸ªæœˆæ—¶é—´å¤§é‡åœ°å»ç¼–å†™å°é¡¹ç›®ï¼Œä¸æ¨èä¸€å£æ°”å­¦å®Œï¼Œåé¢çš„å†…å®¹ç›¸æ¯”å‰é¢çš„å†…å®¹å‡ ä¹æ˜¯é™ç»´æ‰“å‡»ï¼Œä¸€å£æ°”å­¦å®Œå¾ˆå®¹æ˜“å¿˜è®°ä¹‹å‰æ‰€å­¦çš„åŸºç¡€çŸ¥è¯†ï¼Œå°¤å…¶æ˜¯JavaSEé˜¶æ®µçš„å†…å®¹ã€‚</p>
<span id="more"></span>

<h1 id="Springæ¡†æ¶æŠ€æœ¯"><a href="#Springæ¡†æ¶æŠ€æœ¯" class="headerlink" title="Springæ¡†æ¶æŠ€æœ¯"></a>Springæ¡†æ¶æŠ€æœ¯</h1><p>æ­å–œå„ä½é¡ºåˆ©è¿›å…¥åˆ°SSMï¼ˆSpring+SpringMVC+Mybatisï¼‰é˜¶æ®µçš„å­¦ä¹ ï¼Œä¹Ÿç®—æ˜¯æˆåŠŸå‡ºäº†Javaæ–°æ‰‹æ‘ï¼Œç”±äºå‰é¢æˆ‘ä»¬å·²ç»å­¦ä¹ è¿‡Mybatisäº†ï¼Œå› æ­¤ï¼Œæœ¬æœŸæ•™ç¨‹çš„æ—¶é—´å®‰æ’ç›¸æ¯”ä¹‹å‰ä¼šæ›´çŸ­ä¸€äº›ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œå¾ˆå¤šçš„æ¦‚å¿µç†è§£èµ·æ¥å°±ç¨å¾®æœ‰ä¸€ç‚¹éš¾åº¦äº†ï¼Œå› ä¸ºä½ ä»¬æ²¡æœ‰æ¥è§¦è¿‡ä¼ä¸šå¼€å‘åœºæ™¯ï¼Œå¾ˆéš¾ä½“ä¼šåˆ°é‚£ç§æ€æƒ³å¸¦æ¥çš„å¥½å¤„ï¼Œç”šè‡³åˆ°åæœŸæ¥è§¦åˆ°çš„å‡ ä¹éƒ½æ˜¯åŸºäºäº‘è®¡ç®—å’Œå¤§æ•°æ®ç†è®ºå®ç°çš„æ¡†æ¶ï¼ˆå½“ä¸‹æœ€çƒ­é—¨æœ€å‰æ²¿çš„æŠ€æœ¯ï¼‰é€æ¸ä¸å†æ˜¯å’Œè®¡ç®—æœºåŸºç¡€ç›¸å…³è”ï¼Œè€Œæ˜¯å’Œæ€ä¹ˆé«˜æ•ˆå¹²æ´»ç›¸å…³äº†ã€‚</p>
<p>åœ¨JavaWebé˜¶æ®µï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨Javaè¿›è¡ŒWebåº”ç”¨ç¨‹åºå¼€å‘ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»å…·æœ‰æ­å»ºWebç½‘ç«™çš„èƒ½åŠ›ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°å­˜åœ¨è¯¸å¤šçš„ä¸ä¾¿ï¼Œåœ¨æœ€åçš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿç¼–ç¨‹å®æˆ˜ä¸­ï¼Œæˆ‘ä»¬å‘ç°è™½ç„¶æˆ‘ä»¬æ€è·¯å¾ˆæ¸…æ™°ï¼ŒçŸ¥é“å¦‚ä½•ç¼–å†™å¯¹åº”çš„æ¥å£ï¼Œä½†æ˜¯è¿™æ ·çš„å¼€å‘æ•ˆç‡ï¼Œå®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œå¹¶ä¸”å¯¹äºå¯¹è±¡åˆ›å»ºçš„ç®¡ç†ï¼Œå­˜åœ¨è¯¸å¤šçš„ä¸å¦¥ä¹‹å¤„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬è¦å»ç»§ç»­å­¦ä¹ æ›´å¤šçš„æ¡†æ¶æŠ€æœ¯ï¼Œæ¥ç®€åŒ–å’Œè§„èŒƒæˆ‘ä»¬çš„Javaå¼€å‘ã€‚</p>
<p>Springå°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ¡†æ¶ï¼ˆæ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-framework/docs/5.2.13.RELEASE/spring-framework-reference%EF%BC%89%EF%BC%8C%E5%AE%83%E5%B0%B1%E6%98%AF%E4%B8%BA%E4%BA%86%E7%AE%80%E5%8C%96%E5%BC%80%E5%8F%91%E8%80%8C%E7%94%9F%EF%BC%8C%E5%AE%83%E6%98%AF%E8%BD%BB%E9%87%8F%E7%BA%A7%E7%9A%84**IoC**%E5%92%8C**AOP**%E7%9A%84%E5%AE%B9%E5%99%A8%E6%A1%86%E6%9E%B6%EF%BC%8C%E4%B8%BB%E8%A6%81%E6%98%AF%E9%92%88%E5%AF%B9**JavaBean**%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E8%BF%9B%E8%A1%8C%E7%AE%A1%E7%90%86%E7%9A%84%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%AE%B9%E5%99%A8%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%AE%83%E7%9A%84%E7%94%9F%E6%80%81%E5%B7%B2%E7%BB%8F%E5%8F%91%E5%B1%95%E5%BE%97%E6%9E%81%E4%B8%BA%E5%BA%9E%E5%A4%A7%E3%80%82%E9%82%A3%E4%B9%88%EF%BC%8C%E9%A6%96%E5%85%88%E4%B8%80%E9%97%AE%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AF**IoC**%E5%92%8C**AOP**%EF%BC%8C%E4%BB%80%E4%B9%88%E5%8F%88%E6%98%AF**JavaBean**%E5%91%A2%EF%BC%9F%E5%8F%AA%E6%98%AF%E5%90%AC%E8%B5%B7%E6%9D%A5%E6%BB%A1%E6%BB%A1%E7%9A%84%E9%AB%98%E7%BA%A7%E6%84%9F%EF%BC%8C%E5%AE%9E%E9%99%85%E4%B8%8A%E6%B2%A1%E6%9C%89%E5%A4%9A%E9%AB%98%E7%BA%A7%EF%BC%88%E5%BE%88%E5%A4%9A%E4%B8%9C%E8%A5%BF%E9%83%BD%E6%98%AF%E8%BF%99%E6%A0%B7%EF%BC%8C%E5%90%8D%E5%AD%97%E5%90%AC%E8%B5%B7%E6%9D%A5%E5%BE%88%E7%89%9B%EF%BC%8C%E5%AE%9E%E9%99%85%E4%B8%8A%E5%8F%AA%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BE%88%E5%AE%B9%E6%98%93%E7%90%86%E8%A7%A3%E7%9A%84%E4%B8%9C%E8%A5%BF%EF%BC%89">https://docs.spring.io/spring-framework/docs/5.2.13.RELEASE/spring-framework-referenceï¼‰ï¼Œå®ƒå°±æ˜¯ä¸ºäº†ç®€åŒ–å¼€å‘è€Œç”Ÿï¼Œå®ƒæ˜¯è½»é‡çº§çš„**IoC**å’Œ**AOP**çš„å®¹å™¨æ¡†æ¶ï¼Œä¸»è¦æ˜¯é’ˆå¯¹**JavaBean**çš„ç”Ÿå‘½å‘¨æœŸè¿›è¡Œç®¡ç†çš„è½»é‡çº§å®¹å™¨ï¼Œå¹¶ä¸”å®ƒçš„ç”Ÿæ€å·²ç»å‘å±•å¾—æä¸ºåºå¤§ã€‚é‚£ä¹ˆï¼Œé¦–å…ˆä¸€é—®ï¼Œä»€ä¹ˆæ˜¯**IoC**å’Œ**AOP**ï¼Œä»€ä¹ˆåˆæ˜¯**JavaBean**å‘¢ï¼Ÿåªæ˜¯å¬èµ·æ¥æ»¡æ»¡çš„é«˜çº§æ„Ÿï¼Œå®é™…ä¸Šæ²¡æœ‰å¤šé«˜çº§ï¼ˆå¾ˆå¤šä¸œè¥¿éƒ½æ˜¯è¿™æ ·ï¼Œåå­—å¬èµ·æ¥å¾ˆç‰›ï¼Œå®é™…ä¸Šåªæ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“ç†è§£çš„ä¸œè¥¿ï¼‰</a></p>
<p>å› æ­¤ï¼Œä¸€åˆ‡çš„ä¸€åˆ‡ï¼Œæˆ‘ä»¬è¿˜è¦ä»JavaBeanè¯´èµ·ï¼Œä»è¿™é¢—è±†å­ç”Ÿæ ¹å‘èŠ½å¼€å§‹ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯JavaBean"><a href="#ä»€ä¹ˆæ˜¯JavaBean" class="headerlink" title="ä»€ä¹ˆæ˜¯JavaBean"></a>ä»€ä¹ˆæ˜¯JavaBean</h2><p>JavaBeanå°±æ˜¯æœ‰ä¸€å®šè§„èŒƒçš„Javaå®ä½“ç±»ï¼Œè·Ÿæ™®é€šç±»å·®ä¸å¤šï¼Œä¸åŒçš„æ˜¯ç±»å†…éƒ¨æä¾›äº†ä¸€äº›å…¬å…±çš„æ–¹æ³•ä»¥ä¾¿å¤–ç•Œå¯¹è¯¥å¯¹è±¡å†…éƒ¨å±æ€§è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚setã€getæ“ä½œï¼Œå®é™…ä¸Šï¼Œå°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä¸€ç›´åœ¨ç”¨çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getAge</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span>&#123;</span><br><span class="line">		<span class="built_in">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒçš„æ‰€æœ‰å±æ€§éƒ½æ˜¯privateï¼Œæ‰€æœ‰çš„å±æ€§éƒ½å¯ä»¥é€šè¿‡get/setæ–¹æ³•è¿›è¡Œè®¿é—®ï¼ŒåŒæ—¶è¿˜éœ€è¦æœ‰ä¸€ä¸ªæ— å‚æ„é€ ï¼ˆé»˜è®¤å°±æœ‰ï¼‰</p>
<p>å› æ­¤æˆ‘ä»¬ä¹‹å‰ç¼–å†™çš„å¾ˆå¤šç±»ï¼Œå…¶å®éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªJavaBeanã€‚</p>
<h2 id="IoCç†è®ºåŸºç¡€"><a href="#IoCç†è®ºåŸºç¡€" class="headerlink" title="IoCç†è®ºåŸºç¡€"></a>IoCç†è®ºåŸºç¡€</h2><p>åœ¨æˆ‘ä»¬ä¹‹å‰çš„å›¾ä¹¦ç®¡ç†ç³»ç»ŸWebåº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼Œæ•´ä¸ªç¨‹åºå…¶å®æ˜¯ä¾é å„ä¸ªéƒ¨åˆ†ç›¸äº’åä½œï¼Œå…±åŒå®Œæˆä¸€ä¸ªæ“ä½œï¼Œæ¯”å¦‚è¦å±•ç¤ºå€Ÿé˜…ä¿¡æ¯åˆ—è¡¨ï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦ä½¿ç”¨Servletè¿›è¡Œè¯·æ±‚å’Œå“åº”çš„æ•°æ®å¤„ç†ï¼Œç„¶åè¯·æ±‚çš„æ•°æ®å…¨éƒ¨äº¤ç»™å¯¹åº”çš„Serviceï¼ˆä¸šåŠ¡å±‚ï¼‰æ¥å¤„ç†ï¼Œå½“Serviceå‘ç°è¦ä»æ•°æ®åº“ä¸­è·å–æ•°æ®æ—¶ï¼Œå†å‘å¯¹åº”çš„Mapperå‘èµ·è¯·æ±‚ã€‚</p>
<p>å®ƒä»¬ä¹‹é—´å°±åƒè¿æ¥åœ¨ä¸€èµ·çš„é½¿è½®ï¼Œè°ä¹Ÿç¦»ä¸å¼€è°ï¼š</p>
<p><img src="https://images0.cnblogs.com/blog/281227/201305/30130748-488045b61d354b019a088b9cb7fc2d73.png" alt="img"></p>
<p>å°±åƒä¸€ä¸ªå›¢é˜Ÿï¼Œæ¯ä¸ªäººçš„åˆ†å·¥éƒ½å¾ˆæ˜ç¡®ï¼Œæµæ°´çº¿ä¸Šçš„ä¸€å¥—æ“ä½œå¿…é¡»ç¯ç¯ç›¸æ‰£ï¼Œè¿™æ˜¯ä¸€ç§é«˜åº¦è€¦åˆçš„ä½“ç³»ã€‚</p>
<p>è™½ç„¶è¿™æ ·çš„ä½“ç³»é€»è¾‘éå¸¸æ¸…æ™°ï¼Œæ•´ä¸ªæµç¨‹ä¹Ÿèƒ½å¤Ÿè®©äººå¿«é€Ÿäº†è§£ï¼Œä½†æ˜¯è¿™æ ·å­˜åœ¨ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç°åœ¨çš„æ—¶ä»£å®é™…ä¸Šæ˜¯ä¸€ä¸ªè½¯ä»¶é¡¹ç›®é«˜é€Ÿè¿­ä»£çš„æ—¶ä»£ï¼Œæˆ‘ä»¬å‘ç°å¾ˆå¤šAppä¸‰å¤©ä¸¤å¤´éš”ä¸‰å·®äº”åœ°å°±æ›´æ–°ï¼Œè€Œä¸”æ˜¯ä»€ä¹ˆåŠŸèƒ½å½“ä¸‹æœ€ç«ï¼Œå°±é©¬ä¸åœè¹„åœ°è¿›è¡Œè·Ÿè¿›å¼€å‘ï¼Œå› æ­¤ï¼Œå°±å¾ˆå®¹æ˜“å‡ºç°ï¼Œä¹‹å‰å†™å¥½çš„ä»£ç ï¼Œå®ç°çš„åŠŸèƒ½ï¼Œéœ€è¦å…¨éƒ¨æ¨ç¿»ï¼Œæ”¹æˆæ–°çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸å¾—ä¸å»ä¿®æ”¹æŸäº›æµæ°´çº¿ä¸Šçš„æ¨¡å—ï¼Œä½†æ˜¯è¿™æ ·ä¸€ä¿®æ”¹ï¼Œä¼šç›´æ¥å¯¼è‡´æ•´ä¸ªæµæ°´çº¿çš„å¼•ç”¨å…³ç³»å¤§é¢ç§¯æ›´æ–°ã€‚</p>
<p>å°±åƒæˆ‘ä¸æƒ³ç”¨è¿™ä¸ªServiceå®ç°ç±»äº†ï¼Œæˆ‘æƒ³ä½¿ç”¨å…¶ä»–çš„å®ç°ç±»ç”¨ä¸åŒçš„é€»è¾‘åšè¿™äº›åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åªèƒ½æ¯ä¸ªç±»éƒ½å»æŒ¨ä¸ªè¿›è¡Œä¿®æ”¹ï¼Œå½“é¡¹ç›®ç‰¹åˆ«åºå¤§æ—¶ï¼Œå…‰æ˜¯æ”¹ä¸ªç±»åå°±å¤Ÿä½ æ”¹ä¸€å¤©ã€‚</p>
<p>å› æ­¤ï¼Œé«˜è€¦åˆåº¦å¸¦æ¥çš„ç¼ºç‚¹æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œä¹Ÿæ˜¯ç°ä»£è½¯ä»¶å¼€å‘ä¸­å¾ˆè‡´å‘½çš„é—®é¢˜ã€‚å¦‚æœè¦æ”¹å–„è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åªèƒ½å°†å„ä¸ªæ¨¡å—è¿›è¡Œè§£è€¦ï¼Œè®©å„ä¸ªæ¨¡å—ä¹‹é—´çš„ä¾èµ–æ€§ä¸å†é‚£ä¹ˆåœ°å¼ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒServiceçš„å®ç°ç±»ï¼Œä¸å†ç”±æˆ‘ä»¬å†³å®šï¼Œè€Œæ˜¯è®©ç¨‹åºè‡ªå·±å†³å®šï¼Œæ‰€æœ‰çš„å®ç°ç±»å¯¹è±¡ï¼Œå…¨éƒ¨äº¤ç»™ç¨‹åºæ¥ç®¡ç†ï¼Œæ‰€æœ‰å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œä¹Ÿç”±ç¨‹åºæ¥åŠ¨æ€å†³å®šï¼Œè¿™æ ·å°±å¼•å…¥äº†IoCç†è®ºã€‚</p>
<p>IOCæ˜¯Inversion of Controlçš„ç¼©å†™ï¼Œç¿»è¯‘ä¸ºï¼šâ€œæ§åˆ¶åè½¬â€ï¼ŒæŠŠå¤æ‚ç³»ç»Ÿåˆ†è§£æˆç›¸äº’åˆä½œçš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ç±»é€šè¿‡å°è£…ä»¥åï¼Œå†…éƒ¨å®ç°å¯¹å¤–éƒ¨æ˜¯é€æ˜çš„ï¼Œä»è€Œé™ä½äº†è§£å†³é—®é¢˜çš„å¤æ‚åº¦ï¼Œè€Œä¸”å¯ä»¥çµæ´»åœ°è¢«é‡ç”¨å’Œæ‰©å±•ã€‚</p>
<p><img src="https://images0.cnblogs.com/blog/281227/201305/30131727-a8268fe6370049028078e6b8a1cbc88f.png" alt="img"></p>
<p>æˆ‘ä»¬å¯ä»¥å°†å¯¹è±¡äº¤ç»™IoCå®¹å™¨è¿›è¡Œç®¡ç†ï¼Œæ¯”å¦‚å½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¥å£çš„å®ç°æ—¶ï¼Œç”±å®ƒæ ¹æ®é…ç½®æ–‡ä»¶æ¥å†³å®šåˆ°åº•ç»™æˆ‘ä»¬å“ªä¸€ä¸ªå®ç°ç±»ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ç”¨å†å…³å¿ƒæˆ‘ä»¬è¦å»ä½¿ç”¨å“ªä¸€ä¸ªå®ç°ç±»äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒï¼Œç»™åˆ°æˆ‘çš„ä¸€å®šæ˜¯ä¸€ä¸ªå¯ä»¥æ­£å¸¸ä½¿ç”¨çš„å®ç°ç±»ï¼Œèƒ½ç”¨å°±å®Œäº‹äº†ï¼Œåæ­£æ¥å£å®šä¹‰äº†å•¥ï¼Œæˆ‘åªç®¡è°ƒï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¾å¿ƒåœ°è®©ä¸€ä¸ªäººå»å†™è§†å›¾å±‚çš„ä»£ç ï¼Œä¸€ä¸ªäººå»å†™ä¸šåŠ¡å±‚çš„ä»£ç ï¼Œå¼€å‘æ•ˆç‡é‚£æ˜¯é«˜çš„ä¸€åŒ¹å•Šã€‚</p>
<p>é«˜å†…èšï¼Œä½è€¦åˆï¼Œæ˜¯ç°ä»£è½¯ä»¶çš„å¼€å‘çš„è®¾è®¡ç›®æ ‡ï¼Œè€ŒSpringæ¡†æ¶å°±ç»™æˆ‘ä»¬æä¾›äº†è¿™æ ·çš„ä¸€ä¸ªIoCå®¹å™¨è¿›è¡Œå¯¹è±¡çš„ç®¡ç†ã€‚</p>
<h2 id="ä½¿ç”¨IoCå®¹å™¨"><a href="#ä½¿ç”¨IoCå®¹å™¨" class="headerlink" title="ä½¿ç”¨IoCå®¹å™¨"></a>ä½¿ç”¨IoCå®¹å™¨</h2><p>é¦–å…ˆä¸€å®šè¦æ˜ç¡®ï¼Œä½¿ç”¨Springé¦–è¦ç›®çš„æ˜¯ä¸ºäº†ä½¿å¾—è½¯ä»¶é¡¹ç›®è¿›è¡Œè§£è€¦ï¼Œè€Œä¸æ˜¯ä¸ºäº†å»ç®€åŒ–ä»£ç ï¼</p>
<p>Springå¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¡†æ¶ï¼Œå®ƒå®é™…ä¸ŠåŒ…å«äº†å¾ˆå¤šçš„æ¨¡å—ï¼š</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fwww.pianshen.com%2Fimages%2F58%2Fb64f717e0ba180c290cf75580c442132.JPEG&refer=http%3A%2F%2Fwww.pianshen.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1640690781&t=0b3f1818d8dd6c8810491bf8050ecd4e" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>è€Œæˆ‘ä»¬é¦–å…ˆè¦å»å­¦ä¹ çš„å°±æ˜¯Core Containerï¼Œä¹Ÿå°±æ˜¯æ ¸å¿ƒå®¹å™¨æ¨¡å—ã€‚</p>
<p>Springæ˜¯ä¸€ä¸ªéå…¥ä¾µå¼çš„æ¡†æ¶ï¼Œå°±åƒä¸€ä¸ªå·¥å…·åº“ä¸€æ ·ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦ç›´æ¥å¯¼å…¥å…¶ä¾èµ–å°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p>
<h3 id="ç¬¬ä¸€ä¸ªSpringé¡¹ç›®"><a href="#ç¬¬ä¸€ä¸ªSpringé¡¹ç›®" class="headerlink" title="ç¬¬ä¸€ä¸ªSpringé¡¹ç›®"></a>ç¬¬ä¸€ä¸ªSpringé¡¹ç›®</h3><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„Mavené¡¹ç›®ï¼Œå¹¶å¯¼å…¥Springæ¡†æ¶çš„ä¾èµ–ï¼ŒSpringæ¡†æ¶çš„åæ ‡ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€åœ¨resourceä¸­åˆ›å»ºä¸€ä¸ªSpringé…ç½®æ–‡ä»¶ï¼Œå‘½åä¸ºtest.xmlï¼Œç›´æ¥å³é”®ç‚¹å‡»å³å¯åˆ›å»ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œåœ¨ä¸»æ–¹æ³•ä¸­ç¼–å†™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;text&quot;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œä¸€ä¸ªæœ€åŸºæœ¬çš„Springé¡¹ç›®å°±åˆ›å»ºå®Œæˆäº†ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å‘IoCå®¹å™¨ä¸­æ³¨å†ŒJavaBeanï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªStudentç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ³¨æ„ï¼Œè¿™é‡Œè¿˜ç”¨ä¸åˆ°å€¼æ³¨å…¥ï¼Œåªéœ€è¦åŒ…å«æˆå‘˜å±æ€§å³å¯ï¼Œä¸ç”¨Getter/Setterã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ è¿™ä¸ªbeanï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Student&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œè¿™ä¸ªå¯¹è±¡ä¸éœ€è¦æˆ‘ä»¬å†å»ç”Ÿæˆäº†ï¼Œè€Œæ˜¯ç”±IoCå®¹å™¨æ¥æä¾›ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;test.xml&quot;</span>);</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">    System.out.println(student);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼Œè¿™é‡Œå¾—åˆ°çš„Studentå¯¹è±¡æ˜¯ç”±Springé€šè¿‡åå°„æœºåˆ¶å¸®åŠ©æˆ‘ä»¬åˆ›å»ºçš„ï¼Œåˆå­¦è€…ä¼šéå¸¸ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·æ¥åˆ›å»ºå¯¹è±¡ï¼Œæˆ‘ä»¬ç›´æ¥newä¸€ä¸ªå®ƒä¸é¦™å—ï¼Ÿä¸ºä»€ä¹ˆè¦äº¤ç»™IoCå®¹å™¨ç®¡ç†å‘¢ï¼Ÿåœ¨åé¢çš„å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬å†æ…¢æ…¢è¿›è¡Œä½“ä¼šã€‚</p>
<h3 id="å°†JavaBeanäº¤ç»™IoCå®¹å™¨ç®¡ç†"><a href="#å°†JavaBeanäº¤ç»™IoCå®¹å™¨ç®¡ç†" class="headerlink" title="å°†JavaBeanäº¤ç»™IoCå®¹å™¨ç®¡ç†"></a>å°†JavaBeanäº¤ç»™IoCå®¹å™¨ç®¡ç†</h3><p>é€šè¿‡å‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å‘ç°åªè¦å°†æˆ‘ä»¬åˆ›å»ºå¥½çš„JavaBeané€šè¿‡é…ç½®æ–‡ä»¶ç¼–å†™ï¼Œå³å¯å°†å…¶äº¤ç»™IoCå®¹å™¨è¿›è¡Œç®¡ç†ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œä¸€ä¸ªJavaBeançš„è¯¦ç»†é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Student&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>name</code>å±æ€§ï¼ˆä¹Ÿå¯ä»¥æ˜¯<code>id</code>å±æ€§ï¼‰ï¼Œå…¨å±€å”¯ä¸€ï¼Œä¸å¯å‡ºç°é‡å¤çš„åç§°ï¼Œæˆ‘ä»¬å‘ç°ï¼Œä¹‹å‰å…¶å®å°±æ˜¯é€šè¿‡Beançš„åç§°æ¥å‘IoCå®¹å™¨ç´¢è¦å¯¹åº”çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼è·å–ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨åœ¨ä¸»æ–¹æ³•ä¸­è¿ç»­è·å–ä¸¤ä¸ªå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;test.xml&quot;</span>);</span><br><span class="line"><span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line"><span class="type">Student</span> <span class="variable">student2</span> <span class="operator">=</span> (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">System.out.println(student);</span><br><span class="line">System.out.println(student2);</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ä¸¤æ¬¡è·å–åˆ°çš„å®é™…ä¸Šæ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡IoCå®¹å™¨è¿›è¡Œç®¡ç†çš„JavaBeanæ˜¯å•ä¾‹æ¨¡å¼çš„ï¼Œæ— è®ºæ€ä¹ˆè·å–å§‹ç»ˆä¸ºé‚£ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå¦‚ä½•è¿›è¡Œä¿®æ”¹å‘¢ï¼Ÿåªéœ€è¦ä¿®æ”¹å…¶ä½œç”¨åŸŸå³å¯ï¼Œæ·»åŠ <code>scope</code>å±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Student&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡å°†å…¶è®¾å®šä¸º<code>prototype</code>ï¼ˆåŸå‹æ¨¡å¼ï¼‰æ¥ä½¿å¾—å…¶æ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚æˆ‘ä»¬æ¥ç€æ¥è§‚å¯Ÿä¸€ä¸‹ï¼Œè¿™ä¸¤ç§æ¨¡å¼ä¸‹Beançš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬ç»™æ„é€ æ–¹æ³•æ·»åŠ ä¸€ä¸ªè¾“å‡ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘è¢«æ„é€ äº†ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åœ¨mianæ–¹æ³•ä¸­æ‰“ä¸Šæ–­ç‚¹æ¥æŸ¥çœ‹å¯¹è±¡åˆ†åˆ«æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è¢«æ„é€ çš„ã€‚</p>
<p>æˆ‘ä»¬å‘ç°ï¼Œå½“Beançš„ä½œç”¨åŸŸä¸ºå•ä¾‹æ¨¡å¼ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨ä¸€å¼€å§‹å°±è¢«åˆ›å»ºï¼Œè€Œå¤„äºåŸå‹æ¨¡å¼ä¸‹ï¼Œåªæœ‰åœ¨è·å–æ—¶æ‰ä¼šè¢«åˆ›å»ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå•ä¾‹æ¨¡å¼ä¸‹ï¼ŒBeanä¼šè¢«IoCå®¹å™¨å­˜å‚¨ï¼Œåªè¦å®¹å™¨æ²¡æœ‰è¢«é”€æ¯ï¼Œé‚£ä¹ˆæ­¤å¯¹è±¡å°†ä¸€ç›´å­˜åœ¨ï¼Œè€ŒåŸå‹æ¨¡å¼æ‰æ˜¯ç›¸å½“äºç›´æ¥newäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸ä¼šè¢«ä¿å­˜ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œå‘Šè¯‰åˆ›å»ºä¸€ä¸ªå¯¹è±¡éœ€è¦æ‰§è¡Œæ­¤åˆå§‹åŒ–æ–¹æ³•ï¼Œä»¥åŠé”€æ¯ä¸€ä¸ªå¯¹è±¡çš„é”€æ¯æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯åˆå§‹åŒ–æ–¹æ³•ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯é”€æ¯æ–¹æ³•ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘è¢«æ„é€ äº†ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;test.xml&quot;</span>);</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">    System.out.println(student);</span><br><span class="line">    context.close();  <span class="comment">//æ‰‹åŠ¨é”€æ¯å®¹å™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ååœ¨XMLæ–‡ä»¶ä¸­ç¼–å†™é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Student&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æµ‹è¯•ä¸€ä¸‹å³å¯ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥æ‰‹åŠ¨æŒ‡å®šBeançš„åŠ è½½é¡ºåºï¼Œè‹¥æŸä¸ªBeanéœ€è¦ä¿è¯ä¸€å®šåœ¨å¦ä¸€ä¸ªBeanåŠ è½½ä¹‹å‰åŠ è½½ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨<code>depend-on</code>å±æ€§ã€‚</p>
<h3 id="ä¾èµ–æ³¨å…¥DI"><a href="#ä¾èµ–æ³¨å…¥DI" class="headerlink" title="ä¾èµ–æ³¨å…¥DI"></a>ä¾èµ–æ³¨å…¥DI</h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•æ³¨å†Œå’Œä½¿ç”¨ä¸€ä¸ªBeanï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•å‘Beançš„æˆå‘˜å±æ€§è¿›è¡Œèµ‹å€¼å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼ŒIoCåœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œéœ€è¦å°†æˆ‘ä»¬é¢„å…ˆç»™å®šçš„å±æ€§æ³¨å…¥åˆ°å¯¹è±¡ä¸­ï¼Œéå¸¸ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>property</code>æ ‡ç­¾æ¥å®ç°ï¼Œä½†æ˜¯ä¸€å®šæ³¨æ„ï¼Œæ­¤å±æ€§å¿…é¡»å­˜åœ¨ä¸€ä¸ªsetæ–¹æ³•ï¼Œå¦åˆ™æ— æ³•èµ‹å€¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å°æ˜&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯ï¼š&quot;</span>+name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæµ‹è¯•æ˜¯å¦èƒ½å¤ŸæˆåŠŸå°†å±æ€§æ³¨å…¥åˆ°æˆ‘ä»¬çš„å¯¹è±¡ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;test.xml&quot;</span>);</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">    student.say();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œå¦‚æœæˆå‘˜å±æ€§æ˜¯ä¸€ä¸ªéåŸºæœ¬ç±»å‹éStringçš„å¯¹è±¡ç±»å‹ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆæ³¨å…¥å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Card</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    Card card;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCard</span><span class="params">(Card card)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.card = card;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯ï¼š&quot;</span>+name+<span class="string">&quot;ï¼Œæˆ‘éƒ½å­¦ç”Ÿè¯ï¼š&quot;</span>+card);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åªéœ€è¦å°†å¯¹åº”çš„ç±»å‹ä¹Ÿæ³¨å†Œä¸ºbeanå³å¯ï¼Œç„¶åç›´æ¥ä½¿ç”¨<code>ref</code>å±æ€§æ¥è¿›è¡Œå¼•ç”¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;card&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Card&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å°æ˜&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;card&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;card&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œé›†åˆå¦‚ä½•å®ç°æ³¨å…¥å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦åœ¨<code>property</code>å†…éƒ¨è¿›è¡Œç¼–å†™ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span> <span class="attr">type</span>=<span class="string">&quot;double&quot;</span>&gt;</span>100.0<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span> <span class="attr">type</span>=<span class="string">&quot;double&quot;</span>&gt;</span>95.0<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span> <span class="attr">type</span>=<span class="string">&quot;double&quot;</span>&gt;</span>92.5<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä»¥ä¸€ä¸ªæ•°ç»„çš„æ–¹å¼å°†å±æ€§æ³¨å…¥ï¼Œæ³¨æ„å¦‚æœæ˜¯Listç±»å‹çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>array</code>æ•°ç»„ã€‚åŒæ ·çš„ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªMapç±»å‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>entry</code>æ¥æ³¨å…¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    Map&lt;String, Double&gt; map;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMap</span><span class="params">(Map&lt;String, Double&gt; map)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.map = map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘çš„æˆç»©ï¼š&quot;</span>+ map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;è¯­æ–‡&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100.0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;æ•°å­¦&quot;</span> <span class="attr">value</span>=<span class="string">&quot;80.0&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;è‹±è¯­&quot;</span> <span class="attr">value</span>=<span class="string">&quot;92.5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨è‡ªåŠ¨è£…é…æ¥å®ç°å±æ€§å€¼çš„æ³¨å…¥ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;card&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Card&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Student&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>è‡ªåŠ¨è£…é…ä¼šæ ¹æ®setæ–¹æ³•ä¸­éœ€è¦çš„ç±»å‹ï¼Œè‡ªåŠ¨åœ¨å®¹å™¨ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å¯¹åº”ç±»å‹æˆ–æ˜¯å¯¹åº”åç§°ä»¥åŠå¯¹åº”æ„é€ æ–¹æ³•çš„Beanï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸Šé¢æŒ‡å®šçš„ä¸º<code>byType</code>ï¼Œé‚£ä¹ˆå…¶ä¸­çš„cardå±æ€§å°±ä¼šè¢«è‡ªåŠ¨æ³¨å…¥ç±»å‹ä¸ºCardçš„Bean</p>
<p>æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨setæ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ï¼Œé‚£ä¹ˆèƒ½å¦ä¸ä½¿ç”¨é»˜è®¤çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œè€Œæ˜¯æŒ‡å®šä¸€ä¸ªæœ‰å‚æ„é€ è¿›è¡Œå¯¹è±¡çš„åˆ›å»ºå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŒ‡å®šæ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å°æ˜&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯ï¼š&quot;</span>+name+<span class="string">&quot;ä»Šå¹´&quot;</span>+age+<span class="string">&quot;å²äº†ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ‰‹åŠ¨æŒ‡å®šæ„é€ æ–¹æ³•å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å‘Šè¯‰å®¹å™¨ä½¿ç”¨å“ªä¸€ä¸ªæ„é€ æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚</p>
<hr>
<h2 id="é¢å‘åˆ‡é¢AOP"><a href="#é¢å‘åˆ‡é¢AOP" class="headerlink" title="é¢å‘åˆ‡é¢AOP"></a>é¢å‘åˆ‡é¢AOP</h2><p>åˆæ˜¯ä¸€ä¸ªå¬èµ·æ¥å¾ˆé«˜å¤§ä¸Šçš„åè¯ï¼ŒAOPæ€æƒ³å®é™…ä¸Šå°±æ˜¯ï¼šåœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€åœ°å°†ä»£ç åˆ‡å…¥åˆ°ç±»çš„æŒ‡å®šæ–¹æ³•ã€æŒ‡å®šä½ç½®ä¸Šçš„ç¼–ç¨‹æ€æƒ³å°±æ˜¯é¢å‘åˆ‡é¢çš„ç¼–ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨AOPæ¥å¸®åŠ©æˆ‘ä»¬åœ¨æ–¹æ³•æ‰§è¡Œå‰æˆ–æ‰§è¡Œä¹‹åï¼Œåšä¸€äº›é¢å¤–çš„æ“ä½œï¼Œå®é™…ä¸Šï¼Œå°±æ˜¯ä»£ç†ï¼</p>
<p>é€šè¿‡AOPæˆ‘ä»¬å¯ä»¥åœ¨ä¿è¯åŸæœ‰ä¸šåŠ¡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œæ·»åŠ é¢å¤–çš„åŠ¨ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬çš„æŸäº›æ–¹æ³•æ‰§è¡Œå®Œæˆä¹‹åï¼Œéœ€è¦æ‰“å°æ—¥å¿—ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨AOPæ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆï¼Œå®ƒå¯ä»¥æ‰¹é‡åœ°ä¸ºè¿™äº›æ–¹æ³•æ·»åŠ åŠ¨ä½œã€‚å¯ä»¥è¯´ï¼Œå®ƒç›¸å½“äºå°†æˆ‘ä»¬åŸæœ‰çš„æ–¹æ³•ï¼Œåœ¨ä¸æ”¹å˜æºä»£ç çš„åŸºç¡€ä¸Šè¿›è¡Œäº†å¢å¼ºå¤„ç†ã€‚</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimage.mamicode.com%2Finfo%2F201808%2F20180810205057430646.png&refer=http%3A%2F%2Fimage.mamicode.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1640952533&t=2e5d4955d8f3436603622dd184da65d6" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>ç›¸å½“äºæˆ‘ä»¬çš„æ•´ä¸ªä¸šåŠ¡æµç¨‹ï¼Œè¢«ç›´æ¥æ–©æ–­ï¼Œå¹¶åœ¨æ–­æ‰çš„ä½ç½®æ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„æ“ä½œï¼Œå†è¿æ¥èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ªåˆ‡ç‚¹ä½ç½®æ’å…¥å†…å®¹ã€‚å®ƒçš„åŸç†å®é™…ä¸Šå°±æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æœºåˆ¶å®ç°çš„ï¼Œæˆ‘ä»¬åœ¨JavaWebé˜¶æ®µå·²ç»ç»™å¤§å®¶è®²è§£è¿‡åŠ¨æ€ä»£ç†äº†ã€‚ä¸è¿‡Springåº•å±‚å¹¶ä¸æ˜¯ä½¿ç”¨çš„JDKæä¾›çš„åŠ¨æ€ä»£ç†ï¼Œè€Œæ˜¯ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“å®ç°ï¼Œå®ƒèƒ½å¤Ÿä»¥çˆ¶ç±»çš„å½¢å¼ä»£ç†ï¼Œè€Œä¸æ˜¯æ¥å£ã€‚</p>
<h3 id="ä½¿ç”¨SpringAOP"><a href="#ä½¿ç”¨SpringAOP" class="headerlink" title="ä½¿ç”¨SpringAOP"></a>ä½¿ç”¨SpringAOP</h3><p>Springæ˜¯æ”¯æŒAOPç¼–ç¨‹çš„æ¡†æ¶ä¹‹ä¸€ï¼ˆå®é™…ä¸Šå®ƒæ•´åˆäº†AspectJæ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œè¦ä½¿ç”¨AOPæˆ‘ä»¬éœ€è¦å…ˆå¯¼å…¥ä¸€ä¸ªä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œå¦‚ä½•ä½¿ç”¨AOPå‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ï¼Œè¦å®ç°AOPæ“ä½œï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“è¿™äº›å†…å®¹ï¼š</p>
<ol>
<li>éœ€è¦åˆ‡å…¥çš„ç±»ï¼Œç±»çš„å“ªä¸ªæ–¹æ³•éœ€è¦è¢«åˆ‡å…¥</li>
<li>åˆ‡å…¥ä¹‹åéœ€è¦æ‰§è¡Œä»€ä¹ˆåŠ¨ä½œ</li>
<li>æ˜¯åœ¨æ–¹æ³•æ‰§è¡Œå‰åˆ‡å…¥è¿˜æ˜¯åœ¨æ–¹æ³•æ‰§è¡Œååˆ‡å…¥</li>
<li>å¦‚ä½•å‘Šè¯‰Springéœ€è¦è¿›è¡Œåˆ‡å…¥</li>
</ol>
<p>é‚£ä¹ˆæˆ‘ä»¬ä¾æ¬¡æ¥çœ‹ï¼Œé¦–å…ˆéœ€è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œæ‰¾åˆ°éœ€è¦åˆ‡å…¥çš„ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//åˆ†åˆ«åœ¨testæ–¹æ³•æ‰§è¡Œå‰ååˆ‡å…¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">test</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ï¼š&quot;</span>+str);</span><br><span class="line">        <span class="keyword">return</span> str.length();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¸Œæœ›åœ¨<code>test</code>æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ æˆ‘ä»¬çš„é¢å¤–æ‰§è¡Œçš„å†…å®¹ï¼Œæ¥ç€ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä¸ºæ–¹æ³•æ‰§è¡Œå‰å’Œæ‰§è¡Œåæ·»åŠ åˆ‡å…¥åŠ¨ä½œã€‚æ¯”å¦‚ç°åœ¨æˆ‘ä»¬æƒ³åœ¨æ–¹æ³•è¿”å›ä¹‹åï¼Œå†æ‰§è¡Œæˆ‘ä»¬çš„åŠ¨ä½œï¼Œé¦–å…ˆå®šä¹‰æˆ‘ä»¬è¦æ‰§è¡Œçš„æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰§è¡Œä¹‹åçš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯æ‰§è¡Œä¹‹å&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰§è¡Œä¹‹å‰çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯æ‰§è¡Œä¹‹å‰&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œç°åœ¨å¦‚ä½•å‘Šè¯‰Springæˆ‘ä»¬éœ€è¦åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰å’Œä¹‹åæ’å…¥å…¶ä»–é€»è¾‘å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬å°†è¦è¿›è¡ŒAOPæ“ä½œçš„ç±»æ³¨å†Œä¸ºBeanï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Student&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;aopTest&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.aop.AopTest&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªæ˜¯Studentç±»ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯åŒ…å«æˆ‘ä»¬è¦åˆ‡å…¥æ–¹æ³•çš„AopTestç±»ï¼Œæ³¨å†Œä¸ºBeanåï¼Œä»–ä»¬å°±äº¤ç»™Springè¿›è¡Œç®¡ç†ï¼Œè¿™æ ·Springæ‰èƒ½å¸®åŠ©æˆ‘ä»¬å®ŒæˆAOPæ“ä½œã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰Springï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ åˆ‡å…¥ç‚¹ï¼Œé¦–å…ˆå°†é¡¶éƒ¨ä¿®æ”¹ä¸ºï¼Œå¼•å…¥aopç›¸å…³æ ‡ç­¾ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä½¿ç”¨<code>aop:config</code>æ¥æ·»åŠ ä¸€ä¸ªæ–°çš„AOPé…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰Springï¼Œæˆ‘ä»¬è¦åˆ‡å…¥çš„æ˜¯å“ªä¸€ä¸ªç±»çš„å“ªä¸ªæˆ–æ˜¯å“ªäº›æ–¹æ³•ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.test.bean.Student.test(String))&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>expression</code>å±æ€§çš„<code>execution</code>å¡«å†™æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">ä¿®é¥°ç¬¦ åŒ…å.ç±»å.æ–¹æ³•åç§°(æ–¹æ³•å‚æ•°)</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¿®é¥°ç¬¦ï¼špublicã€protectedã€privateã€åŒ…æ‹¬è¿”å›å€¼ç±»å‹ã€staticç­‰ç­‰ï¼ˆä½¿ç”¨*ä»£è¡¨ä»»æ„ä¿®é¥°ç¬¦ï¼‰</li>
<li>åŒ…åï¼šå¦‚com.testï¼ˆ*ä»£è¡¨å…¨éƒ¨ï¼Œæ¯”å¦‚com.*ä»£è¡¨comåŒ…ä¸‹çš„å…¨éƒ¨åŒ…ï¼‰</li>
<li>ç±»åï¼šä½¿ç”¨*ä¹Ÿå¯ä»¥ä»£è¡¨åŒ…ä¸‹çš„æ‰€æœ‰ç±»</li>
<li>æ–¹æ³•åç§°ï¼šå¯ä»¥ä½¿ç”¨*ä»£è¡¨å…¨éƒ¨æ–¹æ³•</li>
<li>æ–¹æ³•å‚æ•°ï¼šå¡«å†™å¯¹åº”çš„å‚æ•°å³å¯ï¼Œæ¯”å¦‚(String, String)ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨*æ¥ä»£è¡¨ä»»æ„ä¸€ä¸ªå‚æ•°ï¼Œä½¿ç”¨..ä»£è¡¨æ‰€æœ‰å‚æ•°ã€‚</li>
</ul>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–å±æ€§æ¥è¿›è¡ŒåŒ¹é…ï¼Œæ¯”å¦‚<code>@annotation</code>å¯ä»¥ç”¨äºè¡¨ç¤ºæ ‡è®°äº†å“ªäº›æ³¨è§£çš„æ–¹æ³•è¢«åˆ‡å…¥ã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ­¤æ–¹æ³•æ·»åŠ ä¸€ä¸ªæ‰§è¡Œå‰åŠ¨ä½œå’Œä¸€ä¸ªæ‰§è¡ŒååŠ¨ä½œï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;aopTest&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;test&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;after&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;test&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†å…¨éƒ¨çš„é…ç½®ï¼Œç°åœ¨æ¥å®éªŒä¸€ä¸‹å§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;test.xml&quot;</span>);</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> context.getBean(Student.class);</span><br><span class="line">    student.test(<span class="string">&quot;lbwnb&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œæ–¹æ³•æ‰§è¡Œå‰åï¼Œåˆ†åˆ«è°ƒç”¨äº†æˆ‘ä»¬å¯¹åº”çš„æ–¹æ³•ã€‚ä½†æ˜¯ä»…ä»…è¿™æ ·è¿˜æ˜¯ä¸èƒ½æ»¡è¶³ä¸€äº›éœ€æ±‚ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥éœ€æ±‚æ–¹æ³•æ‰§è¡Œçš„ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚æ–¹æ³•æ‰§è¡Œä¹‹åè¿”å›äº†ä»€ä¹ˆï¼Œæˆ–æ˜¯æ–¹æ³•å¼€å§‹ä¹‹å‰ä¼ å…¥äº†ä»€ä¹ˆå‚æ•°ç­‰ç­‰ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬åˆ‡å…¥çš„æ–¹æ³•æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼Œé€šè¿‡æ­¤å‚æ•°å°±å¯ä»¥å¿«é€Ÿè·å–åˆ‡ç‚¹ä½ç½®çš„ä¸€äº›ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ‰§è¡Œä¹‹å‰çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint point)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æˆ‘æ˜¯æ‰§è¡Œä¹‹å‰&quot;</span>);</span><br><span class="line">    System.out.println(point.getTarget());  <span class="comment">//è·å–æ‰§è¡Œæ–¹æ³•çš„å¯¹è±¡</span></span><br><span class="line">    System.out.println(Arrays.toString(point.getArgs()));  <span class="comment">//è·å–ä¼ å…¥æ–¹æ³•çš„å®å‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ·»åŠ JoinPointä½œä¸ºå½¢å‚ï¼ŒSpringä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬ä¸€ä¸ªå®ç°ç±»å¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½è·å–æ–¹æ³•çš„ä¸€äº›ä¿¡æ¯äº†ã€‚</p>
<p>æœ€åæˆ‘ä»¬å†æ¥çœ‹ç¯ç»•æ–¹æ³•ï¼Œç¯ç»•æ–¹æ³•ç›¸å½“äºå®Œå…¨ä»£ç†äº†æ­¤æ–¹æ³•ï¼Œå®ƒå®Œå…¨å°†æ­¤æ–¹æ³•åŒ…å«åœ¨ä¸­é—´ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨æ‰å¯ä»¥æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ç›´æ¥è·å–æ›´å¤šçš„å‚æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ–¹æ³•å¼€å§‹ä¹‹å‰&quot;</span>);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œç»“æœä¸ºï¼š&quot;</span>+value);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå¦‚æœä»£ç†æ–¹æ³•å­˜åœ¨è¿”å›å€¼ï¼Œé‚£ä¹ˆç¯ç»•æ–¹æ³•ä¹Ÿéœ€è¦æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œé€šè¿‡<code>proceed</code>æ–¹æ³•æ¥æ‰§è¡Œä»£ç†çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹å‚æ•°ä¹‹åè°ƒç”¨<code>proceed(Object[])</code>ï¼Œä½¿ç”¨æˆ‘ä»¬ç»™å®šçš„å‚æ•°å†å»æ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ–¹æ³•å¼€å§‹ä¹‹å‰&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">arg</span> <span class="operator">=</span> joinPoint.getArgs()[<span class="number">0</span>] + <span class="string">&quot;ä¼å…µä¸€å·&quot;</span>;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> joinPoint.proceed(<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;arg&#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œç»“æœä¸ºï¼š&quot;</span>+value);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨æ¥å£å®ç°AOP"><a href="#ä½¿ç”¨æ¥å£å®ç°AOP" class="headerlink" title="ä½¿ç”¨æ¥å£å®ç°AOP"></a>ä½¿ç”¨æ¥å£å®ç°AOP</h3><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨xmlé…ç½®ä¸€ä¸ªAOPæ“ä½œï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Adviceå®ç°AOPã€‚</p>
<p>å®ƒä¸æˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„åŠ¨æ€ä»£ç†æ›´æ¥è¿‘ä¸€äº›ï¼Œæ¯”å¦‚åœ¨æ–¹æ³•å¼€å§‹æ‰§è¡Œä¹‹å‰æˆ–æ˜¯æ‰§è¡Œä¹‹åä¼šå»è°ƒç”¨æˆ‘ä»¬å®ç°çš„æ¥å£ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ªç±»å®ç°Adviceæ¥å£ï¼Œåªæœ‰å®ç°æ­¤æ¥å£ï¼Œæ‰å¯ä»¥è¢«é€šçŸ¥ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œä½¿ç”¨<code>MethodBeforeAdvice</code>è¡¨ç¤ºæ˜¯ä¸€ä¸ªåœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰çš„åŠ¨ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopTest</span> <span class="keyword">implements</span> <span class="title class_">MethodBeforeAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é€šè¿‡Adviceå®ç°AOP&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œæ–¹æ³•ä¸­åŒ…æ‹¬äº†å¾ˆå¤šçš„å‚æ•°ï¼Œå…¶ä¸­argsä»£è¡¨çš„æ˜¯æ–¹æ³•æ‰§è¡Œå‰å¾—åˆ°çš„å®å‚åˆ—è¡¨ï¼Œè¿˜æœ‰targetè¡¨ç¤ºæ‰§è¡Œæ­¤æ–¹æ³•çš„å®ä¾‹å¯¹è±¡ã€‚è¿è¡Œä¹‹åï¼Œæ•ˆæœå’Œä¹‹å‰æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åœ¨è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å¿«é€Ÿè·å–åˆ°æ›´å¤šä¿¡æ¯ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;stu&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.test.bean.Student.say(String))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;stu&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é™¤äº†æ­¤æ¥å£ä»¥å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„æ¥å£ï¼Œæ¯”å¦‚<code>AfterReturningAdvice</code>å°±éœ€è¦å®ç°ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œä¹‹åçš„æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopTest</span> <span class="keyword">implements</span> <span class="title class_">MethodBeforeAdvice</span>, AfterReturningAdvice &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object returnValue, Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯æ–¹æ³•æ‰§è¡Œä¹‹åï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶å®ï¼Œæˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„æ“ä½œæ­£å¥½å¯¹åº”äº†AOP é¢†åŸŸä¸­çš„ç‰¹æ€§æœ¯è¯­ï¼š</p>
<ul>
<li>é€šçŸ¥ï¼ˆAdviceï¼‰: AOP æ¡†æ¶ä¸­çš„å¢å¼ºå¤„ç†ï¼Œé€šçŸ¥æè¿°äº†åˆ‡é¢ä½•æ—¶æ‰§è¡Œä»¥åŠå¦‚ä½•æ‰§è¡Œå¢å¼ºå¤„ç†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢ç¼–å†™çš„æ–¹æ³•å®ç°ã€‚</li>
<li>è¿æ¥ç‚¹ï¼ˆjoin pointï¼‰: è¿æ¥ç‚¹è¡¨ç¤ºåº”ç”¨æ‰§è¡Œè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ’å…¥åˆ‡é¢çš„ä¸€ä¸ªç‚¹ï¼Œè¿™ä¸ªç‚¹å¯ä»¥æ˜¯æ–¹æ³•çš„è°ƒç”¨ã€å¼‚å¸¸çš„æŠ›å‡ºï¼Œå®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬åœ¨æ–¹æ³•æ‰§è¡Œå‰æˆ–æ˜¯æ‰§è¡Œåéœ€è¦åšçš„å†…å®¹ã€‚</li>
<li>åˆ‡ç‚¹ï¼ˆPointCutï¼‰: å¯ä»¥æ’å…¥å¢å¼ºå¤„ç†çš„è¿æ¥ç‚¹ï¼Œå¯ä»¥æ˜¯æ–¹æ³•æ‰§è¡Œä¹‹å‰ä¹Ÿå¯ä»¥æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œè¿˜å¯ä»¥æ˜¯æŠ›å‡ºå¼‚å¸¸ä¹‹ç±»çš„ã€‚</li>
<li>åˆ‡é¢ï¼ˆAspectï¼‰: åˆ‡é¢æ˜¯é€šçŸ¥å’Œåˆ‡ç‚¹çš„ç»“åˆï¼Œæˆ‘ä»¬ä¹‹å‰åœ¨xmlä¸­å®šä¹‰çš„å°±æ˜¯åˆ‡é¢ï¼ŒåŒ…æ‹¬å¾ˆå¤šä¿¡æ¯ã€‚</li>
<li>å¼•å…¥ï¼ˆIntroductionï¼‰ï¼šå¼•å…¥å…è®¸æˆ‘ä»¬å‘ç°æœ‰çš„ç±»æ·»åŠ æ–°çš„æ–¹æ³•æˆ–è€…å±æ€§ã€‚</li>
<li>ç»‡å…¥ï¼ˆWeavingï¼‰: å°†å¢å¼ºå¤„ç†æ·»åŠ åˆ°ç›®æ ‡å¯¹è±¡ä¸­ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè¢«å¢å¼ºçš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä¹‹å‰éƒ½æ˜¯åœ¨å°†æˆ‘ä»¬çš„å¢å¼ºå¤„ç†æ·»åŠ åˆ°ç›®æ ‡å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ç»‡å…¥ï¼ˆè¿™åå­—æŒºæœ‰æ–‡è‰ºèŒƒçš„ï¼‰</li>
</ul>
<hr>
<h2 id="ä½¿ç”¨æ³¨è§£å¼€å‘"><a href="#ä½¿ç”¨æ³¨è§£å¼€å‘" class="headerlink" title="ä½¿ç”¨æ³¨è§£å¼€å‘"></a>ä½¿ç”¨æ³¨è§£å¼€å‘</h2><p>å‰é¢æˆ‘ä»¬å·²ç»äº†è§£äº†IoCå®¹å™¨å’ŒAOPå®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œè¦ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸ç¼–å†™å¤§é‡çš„é…ç½®ï¼Œè¿™æ˜¯éå¸¸æµªè´¹æ—¶é—´å’Œç²¾åŠ›çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜åªæ˜¯æ¼”ç¤ºäº†å‡ ä¸ªå°çš„ä¾‹å­ï¼Œå¦‚æœæ˜¯åƒä¹‹å‰ä¸€æ ·å»ç¼–å†™ä¸€ä¸ªå®Œæ•´çš„Webåº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆäº§ç”Ÿçš„é…ç½®å¯èƒ½ä¼šéå¸¸å¤šã€‚èƒ½å¦æœ‰ä¸€ç§æ›´åŠ é«˜æ•ˆçš„æ–¹æ³•èƒ½å¤Ÿçœå»é…ç½®å‘¢ï¼Ÿå½“ç„¶è¿˜æ˜¯æ³¨è§£äº†ã€‚</p>
<p>æ‰€ä»¥è¯´ï¼Œç¬¬ä¸€æ­¥å…ˆæŠŠä½ çš„xmlé…ç½®æ–‡ä»¶åˆ äº†å§ï¼Œç°åœ¨æˆ‘ä»¬å…¨éƒ¨ä½¿ç”¨æ³¨è§£è¿›è¡Œå¼€å‘ï¼ˆå“ˆå“ˆï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰XMLé…ç½®ç™½å­¦äº†ï¼‰</p>
<h3 id="æ³¨è§£å®ç°é…ç½®æ–‡ä»¶"><a href="#æ³¨è§£å®ç°é…ç½®æ–‡ä»¶" class="headerlink" title="æ³¨è§£å®ç°é…ç½®æ–‡ä»¶"></a>æ³¨è§£å®ç°é…ç½®æ–‡ä»¶</h3><p>é‚£ä¹ˆï¼Œç°åœ¨æ—¢ç„¶ä¸ä½¿ç”¨XMLæ–‡ä»¶äº†ï¼Œé‚£é€šè¿‡æ³¨è§£çš„æ–¹å¼å°±åªèƒ½ä»¥å®ä½“ç±»çš„å½¢å¼è¿›è¡Œé…ç½®äº†ï¼Œæˆ‘ä»¬åœ¨è¦ä½œä¸ºé…ç½®çš„ç±»ä¸Šæ·»åŠ <code>@Configuration</code>æ³¨è§£ï¼Œæˆ‘ä»¬è¿™é‡Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»<code>MainConfiguration</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfiguration</span> &#123;</span><br><span class="line">    <span class="comment">//æ²¡æœ‰é…ç½®ä»»ä½•Bean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ å¯ä»¥ç›´æ¥æŠŠå®ƒç­‰ä»·äºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- æ²¡æœ‰é…ç½®ä»»ä½•Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå¦‚ä½•é…ç½®Beanï¼Œä¹‹å‰æˆ‘ä»¬æ˜¯ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™Beançš„ä¸€äº›ä¿¡æ¯ï¼Œç°åœ¨åœ¨é…ç½®ç±»ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶è¿”å›æˆ‘ä»¬è¦åˆ›å»ºçš„Beançš„å¯¹è±¡å³å¯ï¼Œå¹¶åœ¨å…¶ä¸Šæ–¹æ·»åŠ <code>@Bean</code>æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Card <span class="title function_">card</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Card</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œç­‰ä»·äºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.test.bean.Card&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­æ·»åŠ <code>@Scope</code>æ³¨è§£æ¥æŒ‡å®šä½œç”¨åŸŸï¼Œè¿™é‡Œæˆ‘ä»¬å°±ç”¨åŸå‹æ¨¡å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Card <span class="title function_">card</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Card</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´åŠ æ–¹ä¾¿åœ°æ§åˆ¶ä¸€ä¸ªBeanå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œç°åœ¨ç›¸å½“äºè¿™ä¸ªå¯¹è±¡æ˜¯ç”±æˆ‘ä»¬åˆ›å»ºå¥½äº†å†äº¤ç»™Springè¿›è¡Œåç»­å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºæ—¶åšå¾ˆå¤šé¢å¤–çš„æ“ä½œï¼ŒåŒ…æ‹¬ä¸€äº›å±æ€§å€¼çš„é…ç½®ç­‰ã€‚</p>
<p>æ—¢ç„¶ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºå¥½äº†é…ç½®ç±»ï¼Œæ¥ç€æˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸»æ–¹æ³•ä¸­åŠ è½½æ­¤é…ç½®ç±»ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåŸºäºé…ç½®ç±»çš„å®¹å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      	<span class="comment">//ä½¿ç”¨AnnotationConfigApplicationContextæ¥å®ç°æ³¨è§£é…ç½®</span></span><br><span class="line">        <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(MainConfiguration.class); <span class="comment">//è¿™é‡Œéœ€è¦å‘Šè¯‰Springå“ªä¸ªç±»ä½œä¸ºé…ç½®ç±»</span></span><br><span class="line">        <span class="type">Card</span> <span class="variable">card</span> <span class="operator">=</span> context.getBean(Card.class);  <span class="comment">//å®¹å™¨ç”¨æ³•å’Œä¹‹å‰ä¸€æ ·</span></span><br><span class="line">        System.out.println(card);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨é…ç½®çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç‚¹å‡»IDEAåº•éƒ¨çš„Springæ ‡ç­¾ï¼Œæ‰“å¼€åå¯ä»¥å¯¹å½“å‰å‘å®¹å™¨ä¸­æ³¨å†Œçš„Beanè¿›è¡Œé›†ä¸­æŸ¥çœ‹ï¼Œå¹¶ä¸”ä¼šæ ‡æ³¨Beanä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒBeançš„é»˜è®¤åç§°å®é™…ä¸Šå°±æ˜¯é¦–å­—æ¯å°å†™çš„æ–¹æ³•åç§°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;lbwnb&quot;)</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Card <span class="title function_">card</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Card</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†åƒåŸæ¥ä¸€æ ·åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ›å»ºBeanä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥åœ¨ç±»ä¸Šæ·»åŠ <code>@Component</code>æ³¨è§£æ¥å°†ä¸€ä¸ªç±»è¿›è¡Œæ³¨å†Œ<strong>ï¼ˆç°åœ¨æœ€å¸¸ç”¨çš„æ–¹å¼ï¼‰</strong>ï¼Œä¸è¿‡è¦å®ç°è¿™æ ·çš„æ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªè‡ªåŠ¨æ‰«æï¼Œæ¥å‘Šè¯‰Springéœ€è¦åœ¨å“ªäº›åŒ…ä¸­æŸ¥æ‰¾æˆ‘ä»¬æä¾›<code>@Component</code>å£°æ˜çš„Beanã€‚</p>
<p>åªéœ€è¦åœ¨é…ç½®ç±»ä¸Šæ·»åŠ ä¸€ä¸ª<code>@ComponentScan</code>æ³¨è§£å³å¯ï¼Œå¦‚æœè¦æ·»åŠ å¤šä¸ªåŒ…è¿›è¡Œæ‰«æï¼Œå¯ä»¥ä½¿ç”¨<code>@ComponentScans</code>æ¥æ‰¹é‡æ·»åŠ ã€‚è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºå°†<code>bean</code>åŒ…ä¸‹çš„æ‰€æœ‰ç±»è¿›è¡Œæ‰«æï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&quot;com.test.bean&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨åˆ é™¤ç±»ä¸­çš„Beanå®šä¹‰ï¼Œæˆ‘ä»¬åœ¨Studentç±»çš„ä¸Šé¢æ·»åŠ <code>@Component</code>æ³¨è§£ï¼Œæ¥è¡¨ç¤ºæ­¤ç±»å‹éœ€è¦ä½œä¸ºBeanäº¤ç»™å®¹å™¨è¿›è¡Œç®¡ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    Card card;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œåœ¨ç±»ä¸Šä¹Ÿå¯ä»¥ç›´æ¥æ·»åŠ <code>@Scope</code>æ¥é™å®šä½œç”¨åŸŸã€‚</p>
<p>æ•ˆæœå’Œåˆšåˆšå®é™…ä¸Šæ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(MainConfiguration.class);</span><br><span class="line">        System.out.println(context.getBean(Student.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°IDEAçš„Springæ¿å—ä¸­ä¹Ÿæ˜¾ç¤ºäº†æˆ‘ä»¬åˆšåˆšé€šè¿‡ç›´æ¥åœ¨ç±»ä¸Šæ·»åŠ <code>@Component</code>å£°æ˜çš„Beanã€‚</p>
<p>ä¸<code>@Component</code>åŒæ ·æ•ˆæœçš„è¿˜æœ‰<code>@Controller</code>ã€<code>@Service</code>å’Œ<code>@Repository</code>ï¼Œä½†æ˜¯ç°åœ¨æš‚æ—¶ä¸æï¼Œè®²åˆ°SpringMVCæ—¶å†æ¥æ¢è®¨ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å°±æœ‰ä¸¤ç§æ–¹å¼æ³¨å†Œä¸€ä¸ªBeanäº†ï¼Œé‚£ä¹ˆå¦‚ä½•å®ç°åƒä¹‹å‰ä¸€æ ·çš„è‡ªåŠ¨æ³¨å…¥å‘¢ï¼Œæ¯”å¦‚æˆ‘ä»¬å°†Cardä¹Ÿæ³¨å†Œä¸ºBeanï¼Œæˆ‘ä»¬å¸Œæœ›Springè‡ªåŠ¨å°†å…¶æ³¨å…¥åˆ°Studentçš„å±æ€§ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> sid;</span><br><span class="line">    Card card;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­¤ç±»å‹ï¼Œä¹Ÿé€šè¿‡è¿™ç§æ–¹å¼æ³¨å†Œä¸ºä¸€ä¸ªBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Card</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨éœ€è¦æ³¨å…¥çš„ä½ç½®ï¼Œæ·»åŠ ä¸€ä¸ª<code>@Resource</code>æ³¨è§£æ¥å®ç°è‡ªåŠ¨è£…é…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> sid;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    Card card;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬å®Œå…¨ä¸éœ€è¦åˆ›å»ºä»»ä½•çš„setæ–¹æ³•ï¼Œåªéœ€è¦æ·»åŠ è¿™æ ·çš„ä¸€ä¸ªæ³¨è§£å°±å¯ä»¥äº†ï¼ŒSpringä¼šè·Ÿä¹‹å‰é…ç½®æ–‡ä»¶çš„è‡ªåŠ¨æ³¨å…¥ä¸€æ ·ï¼Œåœ¨æ•´ä¸ªå®¹å™¨ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¹¶å°†å¯¹åº”çš„Beanå®ä¾‹å¯¹è±¡æ³¨å…¥åˆ°æ­¤å±æ€§ä¸­ï¼Œå½“ç„¶ï¼Œå¦‚æœè¿˜æ˜¯éœ€è¦é€šè¿‡setæ–¹æ³•æ¥æ³¨å…¥ï¼Œå¯ä»¥å°†æ³¨è§£æ·»åŠ åˆ°æ–¹æ³•ä¸Šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> sid;</span><br><span class="line">    Card card;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCard</span><span class="params">(Card card)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é€šè¿‡æ–¹æ³•&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.card = card;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤äº†ä½¿ç”¨<code>@Resource</code>ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>@Autowired</code>ï¼ˆIDEAä¸æ¨èå°†å…¶ä½¿ç”¨åœ¨å­—æ®µä¸Šï¼Œä¼šå‡ºç°é»„æ ‡ï¼Œä½†æ˜¯å¯ä»¥æ”¾åœ¨æ–¹æ³•æˆ–æ˜¯æ„é€ æ–¹æ³•ä¸Šï¼‰ï¼Œå®ƒä»¬çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å®ƒä»¬å­˜åœ¨åŒºåˆ«ï¼Œè™½ç„¶å®ƒä»¬éƒ½æ˜¯è‡ªåŠ¨è£…é…ï¼š</p>
<ul>
<li>@Resourceé»˜è®¤<strong>ByName</strong>å¦‚æœæ‰¾ä¸åˆ°åˆ™<strong>ByType</strong>ï¼Œå¯ä»¥æ·»åŠ åˆ°setæ–¹æ³•ã€å­—æ®µä¸Šã€‚</li>
<li>@Autowiredé»˜è®¤æ˜¯<strong>byType</strong>ï¼Œå¯ä»¥æ·»åŠ åœ¨æ„é€ æ–¹æ³•ã€setæ–¹æ³•ã€å­—æ®µã€æ–¹æ³•å‚æ•°ä¸Šã€‚</li>
</ul>
<p>å¹¶ä¸”<code>@Autowired</code>å¯ä»¥é…åˆ<code>@Qualifier</code>ä½¿ç”¨ï¼Œæ¥æŒ‡å®šä¸€ä¸ªåç§°çš„Beanè¿›è¡Œæ³¨å…¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;sxc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCard</span><span class="params">(Card card)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;é€šè¿‡æ–¹æ³•&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.card = card;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœBeanæ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå®šä¹‰çš„ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ–¹æ³•çš„å‚æ•°ä¸­ä½¿ç”¨<code>@Autowired</code>æ¥è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&quot;com.test.bean&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">student</span><span class="params">(<span class="meta">@Autowired</span> Card card)</span>&#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student.setCard(card);</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<code>@PostConstruct</code>æ³¨è§£æ¥æ·»åŠ æ„é€ åæ‰§è¡Œçš„æ–¹æ³•ï¼Œå®ƒç­‰ä»·äºä¹‹å‰è®²è§£çš„<code>init-method</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æˆ‘æ˜¯åˆå§‹åŒ–æ–¹æ³•ï¼1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„å®ƒä»¬çš„é¡ºåºï¼šConstructor(æ„é€ æ–¹æ³•) -&gt; @Autowired(ä¾èµ–æ³¨å…¥) -&gt; @PostConstruct</p>
<p>åŒæ ·çš„ï¼Œå¦‚æœéœ€è¦é”€æ¯æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>@PreDestroy</code>æ³¨è§£ï¼Œè¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†ã€‚</p>
<p>è¿™æ ·ï¼Œä¸¤ç§é€šè¿‡æ³¨è§£è¿›è¡ŒBeanå£°æ˜çš„æ–¹å¼å°±è®²è§£å®Œæ¯•äº†ï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™è¯¥ç”¨ä»€ä¹ˆæ–¹å¼å»å£°æ˜å‘¢ï¼Ÿ</p>
<ul>
<li>å¦‚æœè¦æ³¨å†Œä¸ºBeançš„ç±»æ˜¯ç”±å…¶ä»–æ¡†æ¶æä¾›ï¼Œæˆ‘ä»¬æ— æ³•ä¿®æ”¹å…¶æºä»£ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼è¿›è¡Œé…ç½®ã€‚</li>
<li>å¦‚æœè¦æ³¨å†Œä¸ºBeançš„ç±»æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼Œå¹¶åœ¨é…ç½®ä¸­æ·»åŠ æ‰«æã€‚</li>
</ul>
<h3 id="æ³¨è§£å®ç°AOPæ“ä½œ"><a href="#æ³¨è§£å®ç°AOPæ“ä½œ" class="headerlink" title="æ³¨è§£å®ç°AOPæ“ä½œ"></a>æ³¨è§£å®ç°AOPæ“ä½œ</h3><p>äº†è§£äº†å¦‚ä½•ä½¿ç”¨æ³¨è§£æ³¨å†ŒBeanä¹‹åï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•é€šè¿‡æ³¨è§£å®ç°AOPæ“ä½œï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨ä¸»ç±»æ·»åŠ <code>@EnableAspectJAutoProxy</code>æ³¨è§£ï¼Œå¼€å¯AOPæ³¨è§£æ”¯æŒï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.test.bean&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åªéœ€åœ¨å®šä¹‰AOPå¢å¼ºæ“ä½œçš„ç±»ä¸Šæ·»åŠ <code>@Aspect</code>æ³¨è§£å’Œ<code>@Component</code>å°†å…¶æ³¨å†Œä¸ºBeanå³å¯ï¼Œå°±åƒæˆ‘ä»¬ä¹‹å‰åœ¨é…ç½®æ–‡ä»¶ä¸­ä¹Ÿè¦å°†å…¶æ³¨å†Œä¸ºBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopTest</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨é‡Œé¢ç¼–å†™æ–¹æ³•ï¼Œå¹¶å°†æ­¤æ–¹æ³•æ·»åŠ åˆ°ä¸€ä¸ªåˆ‡ç‚¹ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›åœ¨Studentçš„testæ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œæˆ‘ä»¬çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">test</span><span class="params">(String str)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æˆ‘è¢«è°ƒç”¨äº†:&quot;</span>+str);</span><br><span class="line">    <span class="keyword">return</span> str.length();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªéœ€è¦æ·»åŠ <code>@Before</code>æ³¨è§£å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;execution(* com.test.bean.Student.test(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æˆ‘æ˜¯ä¹‹å‰æ‰§è¡Œçš„å†…å®¹ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…¶æ·»åŠ <code>JoinPoint</code>å‚æ•°æ¥è·å–åˆ‡å…¥ç‚¹ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;execution(* com.test.bean.Student.test(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint point)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;å‚æ•°åˆ—è¡¨ï¼š&quot;</span>+ Arrays.toString(point.getArgs()));</span><br><span class="line">    System.out.println(<span class="string">&quot;æˆ‘æ˜¯ä¹‹å‰æ‰§è¡Œçš„å†…å®¹ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>@AfterReturning</code>æ³¨è§£æ¥æŒ‡å®šæ–¹æ³•è¿”å›åçš„æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AfterReturning(value = &quot;execution(* com.test.bean.Student.test(..))&quot;, returning = &quot;returnVal&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(Object returnVal)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ–¹æ³•å·²è¿”å›ï¼Œç»“æœä¸ºï¼š&quot;</span>+returnVal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šreturningå±æ€§ï¼Œå¹¶å°†å…¶ä½œä¸ºæ–¹æ³•æŸä¸ªå‚æ•°çš„å®å‚ã€‚åŒæ ·çš„ï¼Œç¯ç»•ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡æ³¨è§£å£°æ˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;execution(* com.test.bean.Student.test(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint point)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼&quot;</span>);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">val</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œä¹‹åï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–æ³¨è§£é…ç½®"><a href="#å…¶ä»–æ³¨è§£é…ç½®" class="headerlink" title="å…¶ä»–æ³¨è§£é…ç½®"></a>å…¶ä»–æ³¨è§£é…ç½®</h3><p>é…ç½®æ–‡ä»¶å¯èƒ½ä¸æ­¢ä¸€ä¸ªï¼Œæˆ‘ä»¬æœ‰å¯èƒ½ä¼šæ ¹æ®æ¨¡å—åˆ’åˆ†ï¼Œå®šä¹‰å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°å¾ˆå¤šä¸ªé…ç½®ç±»ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦<code>@Import</code>æ³¨è§£æ¥å¿«é€Ÿå°†æŸä¸ªç±»åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶å°†æ•°æ®åº“Beanä¹Ÿæ¬è¿‡å»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2Configuration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ›å»ºæ–°çš„è¿æ¥ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/study&quot;</span>,</span><br><span class="line">                <span class="string">&quot;root&quot;</span>,</span><br><span class="line">                <span class="string">&quot;root&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.test&quot;)</span></span><br><span class="line"><span class="meta">@Import(Test2Configuration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    Connection connection;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(connection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„å¦ä¸€ä¸ªé…ç½®ç±»å¹¶æ²¡æœ‰æ·»åŠ ä»»ä½•æ³¨è§£ï¼Œå®é™…ä¸Šï¼Œç›¸å½“äºå¯¼å…¥çš„ç±»è¢«å¼ºåˆ¶æ³¨å†Œä¸ºäº†ä¸€ä¸ªBeanï¼Œåˆ°ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€å…±äº†è§£äº†ä¸‰ç§æ³¨å†Œä¸ºBeançš„æ–¹å¼ï¼Œåˆ©ç”¨è¿™ç§ç‰¹æ€§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†å…¶ä»–çš„ç±»å‹ä¹Ÿå¼ºåˆ¶æ³¨å†Œä¸ºBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.test&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;Test2Configuration.class, Date.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    Connection connection;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    Date date;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(date+<span class="string">&quot; -&gt; &quot;</span>+connection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæ—¥æœŸç›´æ¥ä½œä¸ºä¸€ä¸ªBeanæ”¾å…¥åˆ°IoCå®¹å™¨ä¸­äº†ï¼Œå¹¶ä¸”æ—¶é—´æ°¸è¿œéƒ½æ˜¯è¢«newçš„é‚£ä¸ªæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼ˆå› ä¸ºé»˜è®¤æ˜¯å•ä¾‹æ¨¡å¼ï¼‰ã€‚</p>
<p>é€šè¿‡<code>@Import</code>æ–¹å¼æœ€ä¸»è¦ä¸ºäº†å®ç°çš„ç›®æ ‡å¹¶ä¸æ˜¯åˆ›å»ºBeanï¼Œè€Œæ˜¯ä¸ºäº†æ–¹ä¾¿ä¸€äº›æ¡†æ¶çš„<code>Registrar</code>è¿›è¡ŒBeanå®šä¹‰ï¼Œåœ¨è®²è§£åˆ°SpringåŸç†æ—¶ï¼Œæˆ‘ä»¬å†æ¥è¯¦ç»†è®¨è®ºï¼Œç›®å‰åªåšäº†è§£å³å¯ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œå…³äºSpringæ¡†æ¶çš„å¤§è‡´å†…å®¹å°±èŠå¾—å·®ä¸å¤šäº†ï¼Œå…¶ä½™çš„å†…å®¹ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢ç»§ç»­è®²è§£ã€‚</p>
<hr>
<h2 id="æ·±å…¥Mybatisæ¡†æ¶"><a href="#æ·±å…¥Mybatisæ¡†æ¶" class="headerlink" title="æ·±å…¥Mybatisæ¡†æ¶"></a>æ·±å…¥Mybatisæ¡†æ¶</h2><p>å­¦ä¹ äº†Springä¹‹åï¼Œæˆ‘ä»¬å·²ç»äº†è§£å¦‚ä½•å°†ä¸€ä¸ªç±»ä½œä¸ºBeanäº¤ç”±IoCå®¹å™¨ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ–¹ä¾¿çš„æ–¹å¼æ¥ä½¿ç”¨Mybatisæ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠSqlSessionFactoryã€Mapperäº¤ç»™Springè¿›è¡Œç®¡ç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æ³¨å…¥çš„æ–¹å¼å¿«é€Ÿåœ°ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬è¦å­¦ä¹ ä¸€ä¸‹å¦‚ä½•å°†Mybatisä¸Springè¿›è¡Œæ•´åˆï¼Œé‚£ä¹ˆé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¹‹å‰çŸ¥è¯†çš„åŸºç¡€ä¸Šç»§ç»­æ·±åŒ–å­¦ä¹ ã€‚</p>
<h3 id="äº†è§£æ•°æ®æº"><a href="#äº†è§£æ•°æ®æº" class="headerlink" title="äº†è§£æ•°æ®æº"></a>äº†è§£æ•°æ®æº</h3><p>åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¦‚æœéœ€è¦åˆ›å»ºä¸€ä¸ªJDBCçš„è¿æ¥ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨<code>DriverManager.getConnection()</code>æ¥åˆ›å»ºè¿æ¥ï¼Œè¿æ¥å»ºç«‹åï¼Œæˆ‘ä»¬æ‰å¯ä»¥è¿›è¡Œæ•°æ®åº“æ“ä½œã€‚</p>
<p>è€Œå­¦ä¹ äº†Mybatisä¹‹åï¼Œæˆ‘ä»¬å°±ä¸ç”¨å†å»ä½¿ç”¨<code>DriverManager</code>ä¸ºæˆ‘ä»¬æä¾›è¿æ¥å¯¹è±¡ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨Mybatisä¸ºæˆ‘ä»¬æä¾›çš„<code>SqlSessionFactory</code>å·¥å…·ç±»æ¥è·å–å¯¹åº”çš„<code>SqlSession</code>é€šè¿‡ä¼šè¯å¯¹è±¡å»æ“ä½œæ•°æ®åº“ã€‚</p>
<p>é‚£ä¹ˆï¼Œå®ƒåˆ°åº•æ˜¯å¦‚ä½•å°è£…JDBCçš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è¯•ç€æ¥çŒœæƒ³ä¸€ä¸‹ï¼Œä¼šä¸ä¼šæ˜¯Mybatisæ¯æ¬¡éƒ½æ˜¯å¸®åŠ©æˆ‘ä»¬è°ƒç”¨<code>DriverManager</code>æ¥å®ç°çš„æ•°æ®åº“è¿æ¥åˆ›å»ºï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹çœ‹Mybatisçš„æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> SqlSession <span class="title function_">openSession</span><span class="params">(<span class="type">boolean</span> autoCommit)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.openSessionFromDataSource(<span class="built_in">this</span>.configuration.getDefaultExecutorType(), (TransactionIsolationLevel)<span class="literal">null</span>, autoCommit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨é€šè¿‡<code>SqlSessionFactory</code>è°ƒç”¨<code>openSession</code>æ–¹æ³•ä¹‹åï¼Œå®ƒè°ƒç”¨äº†å†…éƒ¨çš„ä¸€ä¸ªç§æœ‰çš„æ–¹æ³•<code>openSessionFromDataSource</code>ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢å®šä¹‰äº†ä»€ä¹ˆå†…å®¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> SqlSession <span class="title function_">openSessionFromDataSource</span><span class="params">(ExecutorType execType, TransactionIsolationLevel level, <span class="type">boolean</span> autoCommit)</span> &#123;</span><br><span class="line">    <span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    DefaultSqlSession var8;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      	<span class="comment">//è·å–å½“å‰ç¯å¢ƒï¼ˆç”±é…ç½®æ–‡ä»¶æ˜ å°„çš„å¯¹è±¡å®ä½“ï¼‰</span></span><br><span class="line">        <span class="type">Environment</span> <span class="variable">environment</span> <span class="operator">=</span> <span class="built_in">this</span>.configuration.getEnvironment();</span><br><span class="line">      	<span class="comment">//äº‹åŠ¡å·¥å‚ï¼ˆæš‚æ—¶ä¸æï¼Œä¸‹ä¸€æ¿å—è®²è§£ï¼‰</span></span><br><span class="line">        <span class="type">TransactionFactory</span> <span class="variable">transactionFactory</span> <span class="operator">=</span> <span class="built_in">this</span>.getTransactionFactoryFromEnvironment(environment);</span><br><span class="line">      	<span class="comment">//é…ç½®æ–‡ä»¶ä¸­ï¼š&lt;transactionManager type=&quot;JDBC&quot;/&gt;</span></span><br><span class="line">      	<span class="comment">//ç”Ÿæˆäº‹åŠ¡ï¼ˆæ ¹æ®æˆ‘ä»¬çš„é…ç½®ï¼Œä¼šé»˜è®¤ç”ŸæˆJdbcTransactionï¼‰ï¼Œè¿™é‡Œæ˜¯å…³é”®ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™é‡Œç”¨åˆ°äº†environment.getDataSource()æ–¹æ³•</span></span><br><span class="line">        tx = transactionFactory.newTransaction(environment.getDataSource(), level, autoCommit);</span><br><span class="line">      	<span class="comment">//æ‰§è¡Œå™¨ï¼ŒåŒ…æ‹¬å…¨éƒ¨çš„æ•°æ®åº“æ“ä½œæ–¹æ³•å®šä¹‰ï¼Œæœ¬è´¨ä¸Šæ˜¯åœ¨ä½¿ç”¨æ‰§è¡Œå™¨æ“ä½œæ•°æ®åº“ï¼Œéœ€è¦ä¼ å…¥äº‹åŠ¡å¯¹è±¡</span></span><br><span class="line">        <span class="type">Executor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="built_in">this</span>.configuration.newExecutor(tx, execType);</span><br><span class="line">      	<span class="comment">//å°è£…ä¸ºSqlSessionå¯¹è±¡</span></span><br><span class="line">        var8 = <span class="keyword">new</span> <span class="title class_">DefaultSqlSession</span>(<span class="built_in">this</span>.configuration, executor, autoCommit);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception var12) &#123;</span><br><span class="line">        <span class="built_in">this</span>.closeTransaction(tx);</span><br><span class="line">        <span class="keyword">throw</span> ExceptionFactory.wrapException(<span class="string">&quot;Error opening session.  Cause: &quot;</span> + var12, var12);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        ErrorContext.instance().reset();</span><br><span class="line">    &#125;</span><br><span class="line">		</span><br><span class="line">    <span class="keyword">return</span> var8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„æ•°æ®æºé…ç½®ä¿¡æ¯ï¼Œå­˜æ”¾åœ¨äº†<code>Transaction</code>å¯¹è±¡ä¸­ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬åªéœ€è¦çŸ¥é“æ‰§è¡Œå™¨åˆ°åº•æ˜¯å¦‚ä½•æ‰§è¡ŒSQLè¯­å¥çš„ï¼Œæˆ‘ä»¬å°±çŸ¥é“åˆ°åº•å¦‚ä½•åˆ›å»º<code>Connection</code>å¯¹è±¡äº†ï¼Œå°±éœ€è¦è·å–æ•°æ®åº“çš„é“¾æ¥ä¿¡æ¯äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œè¿™ä¸ª<code>DataSource</code>åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DataSource</span>  <span class="keyword">extends</span> <span class="title class_">CommonDataSource</span>, Wrapper &#123;</span><br><span class="line"></span><br><span class="line">  Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line"></span><br><span class="line">  Connection <span class="title function_">getConnection</span><span class="params">(String username, String password)</span></span><br><span class="line">    <span class="keyword">throws</span> SQLException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œå®ƒæ˜¯åœ¨<code>javax.sql</code>å®šä¹‰çš„ä¸€ä¸ªæ¥å£ï¼Œå®ƒåŒ…æ‹¬äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œéƒ½æ˜¯ç”¨äºè·å–è¿æ¥çš„ã€‚å› æ­¤ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥æ–­å®šï¼Œå¹¶ä¸æ˜¯é€šè¿‡ä¹‹å‰<code>DriverManager</code>çš„æ–¹æ³•å»è·å–è¿æ¥äº†ï¼Œè€Œæ˜¯ä½¿ç”¨<code>DataSource</code>çš„å®ç°ç±»æ¥è·å–çš„ï¼Œå› æ­¤ï¼Œä¹Ÿå°±æ­£å¼å¼•å…¥åˆ°æˆ‘ä»¬è¿™ä¸€èŠ‚çš„è¯é¢˜äº†ï¼š</p>
<blockquote>
<p>æ•°æ®åº“é“¾æ¥çš„å»ºç«‹å’Œå…³é—­æ˜¯æå…¶è€—è´¹ç³»ç»Ÿèµ„æºçš„æ“ä½œï¼Œé€šè¿‡DriverManagerè·å–çš„æ•°æ®åº“è¿æ¥ï¼Œä¸€ä¸ªæ•°æ®åº“è¿æ¥å¯¹è±¡å‡å¯¹åº”ä¸€ä¸ªç‰©ç†æ•°æ®åº“è¿æ¥ï¼Œæ¯æ¬¡æ“ä½œéƒ½æ‰“å¼€ä¸€ä¸ªç‰©ç†è¿æ¥ï¼Œä½¿ç”¨å®Œåç«‹å³å…³é—­è¿æ¥ï¼Œé¢‘ç¹çš„æ‰“å¼€ã€å…³é—­è¿æ¥ä¼šæŒç»­æ¶ˆè€—ç½‘ç»œèµ„æºï¼Œé€ æˆæ•´ä¸ªç³»ç»Ÿæ€§èƒ½çš„ä½ä¸‹ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼ŒJDBCä¸ºæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ•°æ®æºçš„æ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯<code>DataSource</code>æ¥å£ï¼Œå‘Šè¯‰æ•°æ®æºæ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ï¼Œå¹¶å°†æ‰€æœ‰çš„è¿æ¥å…¨éƒ¨äº¤ç»™æ•°æ®æºè¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œå½“éœ€è¦ä¸€ä¸ª<code>Connection</code>å¯¹è±¡æ—¶ï¼Œå¯ä»¥å‘æ•°æ®æºç”³è¯·ï¼Œæ•°æ®æºä¼šæ ¹æ®å†…éƒ¨æœºåˆ¶ï¼Œåˆç†åœ°åˆ†é…è¿æ¥å¯¹è±¡ç»™æˆ‘ä»¬ã€‚</p>
<p>ä¸€èˆ¬æ¯”è¾ƒå¸¸ç”¨çš„<code>DataSource</code>å®ç°ï¼Œéƒ½æ˜¯é‡‡ç”¨æ± åŒ–æŠ€æœ¯ï¼Œå°±æ˜¯åœ¨ä¸€å¼€å§‹å°±åˆ›å»ºå¥½Nä¸ªè¿æ¥ï¼Œè¿™æ ·ä¹‹åä½¿ç”¨å°±æ— éœ€å†æ¬¡è¿›è¡Œè¿æ¥ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ç°æˆçš„<code>Connection</code>å¯¹è±¡è¿›è¡Œæ•°æ®åº“æ“ä½œã€‚</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Faliyunzixunbucket.oss-cn-beijing.aliyuncs.com%2Fjpg%2Fe9e0ccfda1fe04136d0388f8539ea402.jpg%3Fx-oss-process%3Dimage%2Fresize%2Cp_100%2Fauto-orient%2C1%2Fquality%2Cq_90%2Fformat%2Cjpg%2Fwatermark%2Cimage_eXVuY2VzaGk%3D%2Ct_100&refer=http%3A%2F%2Faliyunzixunbucket.oss-cn-beijing.aliyuncs.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1641441442&t=c6b5a2eec0786a21357f91126e8c8335" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„å³ç”¨å³è¿çš„æ–¹å¼è·å–<code>Connection</code>å¯¹è±¡ï¼ŒMybatisä¸ºæˆ‘ä»¬æä¾›äº†å‡ ä¸ªé»˜è®¤çš„æ•°æ®æºå®ç°ï¼Œæˆ‘ä»¬ä¹‹å‰ä¸€ç›´åœ¨ä½¿ç”¨çš„æ˜¯å®˜æ–¹çš„é»˜è®¤é…ç½®ï¼Œä¹Ÿå°±æ˜¯æ± åŒ–æ•°æ®æºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸€å…±ä¸‰ä¸ªé€‰é¡¹ï¼š</p>
<ul>
<li>UNPOOLED    ä¸ä½¿ç”¨è¿æ¥æ± çš„æ•°æ®æº</li>
<li>POOLED      ä½¿ç”¨è¿æ¥æ± çš„æ•°æ®æº</li>
<li>JNDI        ä½¿ç”¨JNDIå®ç°çš„æ•°æ®æº</li>
</ul>
<h3 id="è§£è¯»Mybatisæ•°æ®æºå®ç°"><a href="#è§£è¯»Mybatisæ•°æ®æºå®ç°" class="headerlink" title="è§£è¯»Mybatisæ•°æ®æºå®ç°"></a>è§£è¯»Mybatisæ•°æ®æºå®ç°</h3><p>é‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼Œä¸ä½¿ç”¨æ± åŒ–çš„æ•°æ®æºå®ç°ï¼Œå®ƒå«åš<code>UnpooledDataSource</code>ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnpooledDataSource</span> <span class="keyword">implements</span> <span class="title class_">DataSource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ClassLoader driverClassLoader;</span><br><span class="line">    <span class="keyword">private</span> Properties driverProperties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Driver&gt; registeredDrivers = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>();</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Boolean autoCommit;</span><br><span class="line">    <span class="keyword">private</span> Integer defaultTransactionIsolationLevel;</span><br><span class="line">    <span class="keyword">private</span> Integer defaultNetworkTimeout;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè¿™ä¸ªç±»ä¸­å®šä¹‰äº†å¾ˆå¤šçš„æˆå‘˜ï¼ŒåŒ…æ‹¬æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ã€æ•°æ®åº“é©±åŠ¨ä¿¡æ¯ã€äº‹åŠ¡ç›¸å…³ä¿¡æ¯ç­‰ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œå®ƒæ˜¯å¦‚ä½•å®ç°<code>DataSource</code>ä¸­æä¾›çš„æ¥å£çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.doGetConnection(<span class="built_in">this</span>.username, <span class="built_in">this</span>.password);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.doGetConnection(username, password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æŒ‡å‘äº†å†…éƒ¨çš„ä¸€ä¸ª<code>doGetConnection</code>æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Connection <span class="title function_">doGetConnection</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.driverProperties != <span class="literal">null</span>) &#123;</span><br><span class="line">        props.putAll(<span class="built_in">this</span>.driverProperties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (username != <span class="literal">null</span>) &#123;</span><br><span class="line">        props.setProperty(<span class="string">&quot;user&quot;</span>, username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (password != <span class="literal">null</span>) &#123;</span><br><span class="line">        props.setProperty(<span class="string">&quot;password&quot;</span>, password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.doGetConnection(props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆå®ƒå°†æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ä¹Ÿç»™æ·»åŠ åˆ°<code>Properties</code>å¯¹è±¡ä¸­è¿›è¡Œå­˜æ”¾ï¼Œå¹¶äº¤ç»™ä¸‹ä¸€ä¸ª<code>doGetConnection</code>æ¥å¤„ç†ï¼Œå¥—å¨ƒå°±å®Œäº‹äº†å‘—ï¼Œæ¥ç€æ¥çœ‹ä¸‹ä¸€å±‚æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Connection <span class="title function_">doGetConnection</span><span class="params">(Properties properties)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">  	<span class="comment">//è‹¥æœªåˆå§‹åŒ–é©±åŠ¨ï¼Œéœ€è¦å…ˆåˆå§‹åŒ–ï¼Œå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªMapæ¥è®°å½•åˆå§‹åŒ–ä¿¡æ¯ï¼Œè¿™é‡Œä¸å¤šä»‹ç»äº†</span></span><br><span class="line">    <span class="built_in">this</span>.initializeDriver();</span><br><span class="line">  	<span class="comment">//ä¼ ç»Ÿçš„è·å–è¿æ¥çš„æ–¹å¼</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="built_in">this</span>.url, properties);</span><br><span class="line">  	<span class="comment">//å¯¹è¿æ¥è¿›è¡Œé¢å¤–çš„ä¸€äº›é…ç½®</span></span><br><span class="line">    <span class="built_in">this</span>.configureConnection(connection);</span><br><span class="line">    <span class="keyword">return</span> connection;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œï¼Œå°±è¿”å›<code>Connection</code>å¯¹è±¡äº†ï¼Œè€Œæ­¤å¯¹è±¡æ­£æ˜¯é€šè¿‡<code>DriverManager</code>æ¥åˆ›å»ºçš„ï¼Œå› æ­¤ï¼Œéæ± åŒ–çš„æ•°æ®æºå®ç°ä¾ç„¶ä½¿ç”¨çš„æ˜¯ä¼ ç»Ÿçš„è¿æ¥åˆ›å»ºæ–¹å¼ï¼Œé‚£æˆ‘ä»¬æ¥ç€æ¥çœ‹æ± åŒ–çš„æ•°æ®æºå®ç°ï¼Œå®ƒæ˜¯<code>PooledDataSource</code>ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PooledDataSource</span> <span class="keyword">implements</span> <span class="title class_">DataSource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(PooledDataSource.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">PoolState</span> <span class="variable">state</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PoolState</span>(<span class="built_in">this</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UnpooledDataSource dataSource;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">poolMaximumActiveConnections</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">poolMaximumIdleConnections</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">poolMaximumCheckoutTime</span> <span class="operator">=</span> <span class="number">20000</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">poolTimeToWait</span> <span class="operator">=</span> <span class="number">20000</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> <span class="variable">poolMaximumLocalBadConnectionTolerance</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">String</span> <span class="variable">poolPingQuery</span> <span class="operator">=</span> <span class="string">&quot;NO PING QUERY SET&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> poolPingEnabled;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> poolPingConnectionsNotUsedFor;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> expectedConnectionTypeCode;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œåœ¨è¿™é‡Œçš„å®šä¹‰å°±æ¯”éæ± åŒ–çš„å®ç°å¤æ‚å¾—å¤šäº†ï¼Œå› ä¸ºå®ƒè¿˜è¦è€ƒè™‘å¹¶å‘çš„é—®é¢˜ï¼Œå¹¶ä¸”è¿˜è¦è€ƒè™‘å¦‚ä½•åˆç†åœ°å­˜æ”¾å¤§é‡çš„é“¾æ¥å¯¹è±¡ï¼Œè¯¥å¦‚ä½•è¿›è¡Œåˆç†åˆ†é…ï¼Œå› æ­¤å®ƒçš„ç©æ³•éå¸¸ä¹‹é«˜çº§ï¼Œä½†æ˜¯ï¼Œå†é«˜çº§çš„ç©æ³•ï¼Œæˆ‘ä»¬éƒ½è¦æ‹¿ä¸‹ã€‚</p>
<p>é¦–å…ˆæ³¨æ„ï¼Œå®ƒå­˜æ”¾äº†ä¸€ä¸ªUnpooledDataSourceï¼Œæ­¤å¯¹è±¡æ˜¯åœ¨æ„é€ æ—¶å°±è¢«åˆ›å»ºï¼Œå…¶å®åˆ›å»ºConnectionè¿˜æ˜¯ä¾é æ•°æ®åº“é©±åŠ¨åˆ›å»ºï¼Œæˆ‘ä»¬åé¢æ…¢æ…¢è§£æï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®ç°æ¥å£æ–¹æ³•çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.popConnection(<span class="built_in">this</span>.dataSource.getUsername(), <span class="built_in">this</span>.dataSource.getPassword()).getProxyConnection();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.popConnection(username, password).getProxyConnection();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒè°ƒç”¨äº†<code>popConnection()</code>æ–¹æ³•æ¥è·å–è¿æ¥å¯¹è±¡ï¼Œç„¶åè¿›è¡Œäº†ä¸€ä¸ªä»£ç†ï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œæœ‰å¯èƒ½æ•´ä¸ªè¿æ¥æ± å°±æ˜¯ä¸€ä¸ªç±»ä¼¼äºæ ˆçš„é›†åˆç±»å‹ç»“æ„å®ç°çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥ç€æ¥çœ‹çœ‹<code>popConnection</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> PooledConnection <span class="title function_">popConnection</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">countedWait</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">  	<span class="comment">//è¿”å›çš„æ˜¯PooledConnectionå¯¹è±¡ï¼Œ</span></span><br><span class="line">    <span class="type">PooledConnection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">t</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">int</span> <span class="variable">localBadConnectionCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(conn == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="built_in">this</span>.state) &#123;   <span class="comment">//åŠ é”ï¼Œå› ä¸ºæœ‰å¯èƒ½å¾ˆå¤šä¸ªçº¿ç¨‹éƒ½éœ€è¦è·å–è¿æ¥å¯¹è±¡</span></span><br><span class="line">            PoolState var10000;</span><br><span class="line">          	<span class="comment">//PoolStateå­˜äº†ä¸¤ä¸ªListï¼Œä¸€ä¸ªæ˜¯ç©ºé—²åˆ—è¡¨ï¼Œä¸€ä¸ªæ˜¯æ´»è·ƒåˆ—è¡¨</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">this</span>.state.idleConnections.isEmpty()) &#123;   <span class="comment">//æœ‰ç©ºé—²è¿æ¥æ—¶ï¼Œå¯ä»¥ç›´æ¥åˆ†é…Connection</span></span><br><span class="line">                conn = (PooledConnection)<span class="built_in">this</span>.state.idleConnections.remove(<span class="number">0</span>);  <span class="comment">//ArrayListä¸­å–ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">                <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;Checked out connection &quot;</span> + conn.getRealHashCode() + <span class="string">&quot; from pool.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">              <span class="comment">//å¦‚æœå·²ç»æ²¡æœ‰å¤šä½™çš„è¿æ¥å¯ä»¥åˆ†é…ï¼Œé‚£ä¹ˆå°±æ£€æŸ¥ä¸€ä¸‹æ´»è·ƒè¿æ¥æ•°æ˜¯å¦è¾¾åˆ°æœ€å¤§çš„åˆ†é…ä¸Šé™ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±newä¸€ä¸ª</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.state.activeConnections.size() &lt; <span class="built_in">this</span>.poolMaximumActiveConnections) &#123;</span><br><span class="line">              	<span class="comment">//æ³¨æ„newäº†ä¹‹åå¹¶æ²¡æœ‰ç«‹å³å¾€Listé‡Œé¢å¡ï¼Œåªæ˜¯å­˜äº†ä¸€äº›åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">              	<span class="comment">//æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œä¾é UnpooledDataSourceåˆ›å»ºäº†ä¸€ä¸ªConnectionå¯¹è±¡ï¼Œå¹¶å°†å…¶å°è£…åˆ°PooledConnectionä¸­</span></span><br><span class="line">                conn = <span class="keyword">new</span> <span class="title class_">PooledConnection</span>(<span class="built_in">this</span>.dataSource.getConnection(), <span class="built_in">this</span>);</span><br><span class="line">                <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;Created connection &quot;</span> + conn.getRealHashCode() + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">              <span class="comment">//ä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆåªèƒ½ä»ä¹‹å‰çš„è¿æ¥ä¸­å¯»æ‰¾äº†ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰é‚£ç§å¡ä½çš„é“¾æ¥ï¼ˆç”±äºç½‘ç»œé—®é¢˜æœ‰å¯èƒ½ä¹‹å‰çš„è¿æ¥ä¸€ç›´è¢«å¡ä½ï¼Œç„¶è€Œæ­£å¸¸æƒ…å†µä¸‹æ—©å°±ç»“æŸå¹¶ä¸”å¯ä»¥ä½¿ç”¨äº†ï¼Œæ‰€ä»¥è¿™é‡Œç›¸å½“äºæ˜¯ä¼˜åŒ–ä¹Ÿç®—æ˜¯ä¸€ç§æ¡æ¼çš„æ–¹å¼ï¼‰</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              	<span class="comment">//è·å–æœ€æ—©åˆ›å»ºçš„è¿æ¥</span></span><br><span class="line">                <span class="type">PooledConnection</span> <span class="variable">oldestActiveConnection</span> <span class="operator">=</span> (PooledConnection)<span class="built_in">this</span>.state.activeConnections.get(<span class="number">0</span>);</span><br><span class="line">                <span class="type">long</span> <span class="variable">longestCheckoutTime</span> <span class="operator">=</span> oldestActiveConnection.getCheckoutTime();</span><br><span class="line">              	<span class="comment">//åˆ¤æ–­æ˜¯å¦è¶…è¿‡æœ€å¤§çš„ä½¿ç”¨æ—¶é—´</span></span><br><span class="line">                <span class="keyword">if</span> (longestCheckoutTime &gt; (<span class="type">long</span>)<span class="built_in">this</span>.poolMaximumCheckoutTime) &#123;</span><br><span class="line">                  	<span class="comment">//è¶…æ—¶ç»Ÿè®¡ä¿¡æ¯ï¼ˆä¸é‡è¦ï¼‰</span></span><br><span class="line">                    ++<span class="built_in">this</span>.state.claimedOverdueConnectionCount;</span><br><span class="line">                    var10000 = <span class="built_in">this</span>.state;</span><br><span class="line">                    var10000.accumulatedCheckoutTimeOfOverdueConnections += longestCheckoutTime;</span><br><span class="line">                    var10000 = <span class="built_in">this</span>.state;</span><br><span class="line">                    var10000.accumulatedCheckoutTime += longestCheckoutTime;</span><br><span class="line">                  	<span class="comment">//ä»æ´»è·ƒåˆ—è¡¨ä¸­ç§»é™¤æ­¤é“¾æ¥ä¿¡æ¯</span></span><br><span class="line">                    <span class="built_in">this</span>.state.activeConnections.remove(oldestActiveConnection);</span><br><span class="line">                  	<span class="comment">//å¦‚æœå¼€å¯äº‹åŠ¡ï¼Œè¿˜éœ€è¦å›æ»šä¸€ä¸‹</span></span><br><span class="line">                    <span class="keyword">if</span> (!oldestActiveConnection.getRealConnection().getAutoCommit()) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            oldestActiveConnection.getRealConnection().rollback();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (SQLException var15) &#123;</span><br><span class="line">                            log.debug(<span class="string">&quot;Bad connection. Could not roll back&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">										</span><br><span class="line">                  	<span class="comment">//è¿™é‡Œå°±æ ¹æ®ä¹‹å‰çš„è¿æ¥å¯¹è±¡ç›´æ¥newä¸€ä¸ªæ–°çš„è¿æ¥ï¼ˆæ³¨æ„ä½¿ç”¨çš„è¿˜æ˜¯ä¹‹å‰çš„Connectionå¯¹è±¡ï¼Œåªæ˜¯è¢«é‡æ–°å°è£…äº†ï¼‰</span></span><br><span class="line">                    conn = <span class="keyword">new</span> <span class="title class_">PooledConnection</span>(oldestActiveConnection.getRealConnection(), <span class="built_in">this</span>);</span><br><span class="line">                    conn.setCreatedTimestamp(oldestActiveConnection.getCreatedTimestamp());</span><br><span class="line">                    conn.setLastUsedTimestamp(oldestActiveConnection.getLastUsedTimestamp());</span><br><span class="line">                  	<span class="comment">//è¿‡æœŸ</span></span><br><span class="line">                    oldestActiveConnection.invalidate();</span><br><span class="line">                    <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                        log.debug(<span class="string">&quot;Claimed overdue connection &quot;</span> + conn.getRealHashCode() + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="comment">//ç¡®å®æ˜¯æ²¡å¾—ç”¨äº†ï¼Œåªèƒ½å¡ä½äº†ï¼ˆé˜»å¡ï¼‰</span></span><br><span class="line">                  <span class="comment">//ç„¶åè®°å½•ä¸€ä¸‹æœ‰å‡ ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…å½“å‰çš„ä»»åŠ¡æå®Œ</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!countedWait) &#123;</span><br><span class="line">                            ++<span class="built_in">this</span>.state.hadToWaitCount;</span><br><span class="line">                            countedWait = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                            log.debug(<span class="string">&quot;Waiting as long as &quot;</span> + <span class="built_in">this</span>.poolTimeToWait + <span class="string">&quot; milliseconds for connection.&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="type">long</span> <span class="variable">wt</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">                        <span class="built_in">this</span>.state.wait((<span class="type">long</span>)<span class="built_in">this</span>.poolTimeToWait);   <span class="comment">//è¦æ˜¯è¶…è¿‡ç­‰å¾…æ—¶é—´è¿˜æ˜¯æ²¡ç­‰åˆ°ï¼Œåªèƒ½æ”¾å¼ƒ</span></span><br><span class="line">                      	<span class="comment">//æ³¨æ„è¿™æ ·çš„è¯conå°±ä¸ºnulläº†</span></span><br><span class="line">                        var10000 = <span class="built_in">this</span>.state;</span><br><span class="line">                        var10000.accumulatedWaitTime += System.currentTimeMillis() - wt;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException var16) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">						</span><br><span class="line">          	<span class="comment">//ç»è¿‡ä¹‹å‰çš„æ“ä½œï¼Œå·²ç»æˆåŠŸåˆ†é…åˆ°è¿æ¥å¯¹è±¡çš„æƒ…å†µä¸‹</span></span><br><span class="line">            <span class="keyword">if</span> (conn != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (conn.isValid()) &#123;  <span class="comment">//æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">                    <span class="keyword">if</span> (!conn.getRealConnection().getAutoCommit()) &#123;  <span class="comment">//æ¸…ç†ä¹‹å‰é—ç•™çš„äº‹åŠ¡æ“ä½œ</span></span><br><span class="line">                        conn.getRealConnection().rollback();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    conn.setConnectionTypeCode(<span class="built_in">this</span>.assembleConnectionTypeCode(<span class="built_in">this</span>.dataSource.getUrl(), username, password));</span><br><span class="line">                    conn.setCheckoutTimestamp(System.currentTimeMillis());</span><br><span class="line">                    conn.setLastUsedTimestamp(System.currentTimeMillis());</span><br><span class="line">                  	<span class="comment">//æ·»åŠ åˆ°æ´»è·ƒè¡¨ä¸­</span></span><br><span class="line">                    <span class="built_in">this</span>.state.activeConnections.add(conn);</span><br><span class="line">                    <span class="comment">//ç»Ÿè®¡ä¿¡æ¯ï¼ˆä¸é‡è¦ï¼‰</span></span><br><span class="line">                    ++<span class="built_in">this</span>.state.requestCount;</span><br><span class="line">                    var10000 = <span class="built_in">this</span>.state;</span><br><span class="line">                    var10000.accumulatedRequestTime += System.currentTimeMillis() - t;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  	<span class="comment">//æ— æ•ˆçš„è¿æ¥ï¼Œç›´æ¥æŠ›å¼‚å¸¸</span></span><br><span class="line">                    <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                        log.debug(<span class="string">&quot;A bad connection (&quot;</span> + conn.getRealHashCode() + <span class="string">&quot;) was returned from the pool, getting another connection.&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    ++<span class="built_in">this</span>.state.badConnectionCount;</span><br><span class="line">                    ++localBadConnectionCount;</span><br><span class="line">                    conn = <span class="literal">null</span>;</span><br><span class="line">                    <span class="keyword">if</span> (localBadConnectionCount &gt; <span class="built_in">this</span>.poolMaximumIdleConnections + <span class="built_in">this</span>.poolMaximumLocalBadConnectionTolerance) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                            log.debug(<span class="string">&quot;PooledDataSource: Could not get a good connection to the database.&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SQLException</span>(<span class="string">&quot;PooledDataSource: Could not get a good connection to the database.&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">  	<span class="comment">//æœ€åè¯¥å¹²å˜›å¹²å˜›ï¼Œæ‹¿ä¸åˆ°è¿æ¥ç›´æ¥æŠ›å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (conn == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;PooledDataSource: Unknown severe error condition.  The connection pool returned a null connection.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SQLException</span>(<span class="string">&quot;PooledDataSource: Unknown severe error condition.  The connection pool returned a null connection.&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡ä¸Šé¢ä¸€é¡¿çŒ›å¦‚è™çš„æ“ä½œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<blockquote>
<p>å¦‚æœæœ€åå¾—åˆ°äº†è¿æ¥å¯¹è±¡ï¼ˆæœ‰å¯èƒ½æ˜¯ä»ç©ºé—²åˆ—è¡¨ä¸­å¾—åˆ°ï¼Œæœ‰å¯èƒ½æ˜¯ç›´æ¥åˆ›å»ºçš„æ–°çš„ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯ç»è¿‡å›æ”¶ç­–ç•¥å›æ”¶å¾—åˆ°çš„ï¼‰ï¼Œé‚£ä¹ˆè¿æ¥(Connection)å¯¹è±¡ä¸€å®šä¼šè¢«æ”¾åœ¨æ´»è·ƒåˆ—è¡¨ä¸­(state.activeConnections)</p>
</blockquote>
<p>é‚£ä¹ˆè‚¯å®šæœ‰ä¸€ä¸ªç–‘é—®ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“è·å–ä¸€ä¸ªé“¾æ¥ä¼šç›´æ¥è¿›å…¥åˆ°æ´»è·ƒåˆ—è¡¨ä¸­ï¼Œé‚£ä¹ˆï¼Œå¦‚æœä¸€ä¸ªè¿æ¥è¢«å…³é—­ï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…å‘¢ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ­¤æ–¹æ³•è¿”å›ä¹‹åï¼Œä¼šè°ƒç”¨<code>getProxyConnection</code>æ¥è·å–ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå®é™…ä¸Šå°±æ˜¯<code>PooledConnection</code>ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PooledConnection</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CLOSE</span> <span class="operator">=</span> <span class="string">&quot;close&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Class&lt;?&gt;[] IFACES = <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Connection.class&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> hashCode;</span><br><span class="line">  	<span class="comment">//ä¼šè®°å½•æ˜¯æ¥è‡ªå“ªä¸€ä¸ªæ•°æ®æºåˆ›å»ºçš„çš„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PooledDataSource dataSource;</span><br><span class="line">  	<span class="comment">//è¿æ¥å¯¹è±¡æœ¬ä½“</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Connection realConnection;</span><br><span class="line">  	<span class="comment">//ä»£ç†çš„é“¾æ¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Connection proxyConnection;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p>å®ƒç›´æ¥ä»£ç†äº†æ„é€ æ–¹æ³•ä¸­ä¼ å…¥çš„Connectionå¯¹è±¡ï¼Œä¹Ÿæ˜¯ä½¿ç”¨JDKçš„åŠ¨æ€ä»£ç†å®ç°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå®ƒæ˜¯å¦‚ä½•è¿›è¡Œä»£ç†çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> method.getName();</span><br><span class="line">  	<span class="comment">//å¦‚æœè°ƒç”¨çš„æ˜¯Connectionå¯¹è±¡çš„closeæ–¹æ³•ï¼Œ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;close&quot;</span>.equals(methodName)) &#123;</span><br><span class="line">      	<span class="comment">//è¿™é‡Œå¹¶ä¸ä¼šçœŸçš„å…³é—­è¿æ¥ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç”¨ä»£ç†ï¼‰ï¼Œè€Œæ˜¯è°ƒç”¨ä¹‹å‰æ•°æ®æºçš„pushConnectionæ–¹æ³•ï¼Œå°†æ­¤è¿æ¥æ”¹ä¸ºä¸ºç©ºé—²çŠ¶æ€</span></span><br><span class="line">        <span class="built_in">this</span>.dataSource.pushConnection(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!Object.class.equals(method.getDeclaringClass())) &#123;</span><br><span class="line">                <span class="built_in">this</span>.checkConnection();</span><br><span class="line">              	<span class="comment">//ä»»ä½•æ“ä½œæ‰§è¡Œä¹‹å‰éƒ½ä¼šæ£€æŸ¥è¿æ¥æ˜¯å¦å¯ç”¨</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          	<span class="comment">//è¯¥å¹²å˜›å¹²å˜›</span></span><br><span class="line">            <span class="keyword">return</span> method.invoke(<span class="built_in">this</span>.realConnection, args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var6) &#123;</span><br><span class="line">            <span class="keyword">throw</span> ExceptionUtil.unwrapThrowable(var6);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬æœ€åå†æ¥çœ‹çœ‹<code>pushConnection</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">pushConnection</span><span class="params">(PooledConnection conn)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="built_in">this</span>.state) &#123;   <span class="comment">//è€è§„çŸ©ï¼Œå…ˆæ¥æŠŠé”</span></span><br><span class="line">      	<span class="comment">//å…ˆä»æ´»è·ƒåˆ—è¡¨ç§»é™¤æ­¤è¿æ¥</span></span><br><span class="line">        <span class="built_in">this</span>.state.activeConnections.remove(conn);</span><br><span class="line">      	<span class="comment">//åˆ¤æ–­æ­¤é“¾æ¥æ˜¯å¦å¯ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (conn.isValid()) &#123;</span><br><span class="line">            PoolState var10000;</span><br><span class="line">          	<span class="comment">//çœ‹çœ‹é—²ç½®åˆ—è¡¨å®¹é‡æ˜¯å¦å·²æ»¡ï¼ˆå®¹é‡æ»¡äº†å°±å›ä¸å»äº†ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.state.idleConnections.size() &lt; <span class="built_in">this</span>.poolMaximumIdleConnections &amp;&amp; conn.getConnectionTypeCode() == <span class="built_in">this</span>.expectedConnectionTypeCode) &#123;</span><br><span class="line">                var10000 = <span class="built_in">this</span>.state;</span><br><span class="line">                var10000.accumulatedCheckoutTime += conn.getCheckoutTime();</span><br><span class="line">                <span class="keyword">if</span> (!conn.getRealConnection().getAutoCommit()) &#123;</span><br><span class="line">                    conn.getRealConnection().rollback();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">              	<span class="comment">//æŠŠå”¯ä¸€æœ‰ç”¨çš„Connectionå¯¹è±¡æ‹¿å‡ºæ¥ï¼Œç„¶åé‡æ–°åˆ›å»ºä¸€ä¸ªPooledConnection</span></span><br><span class="line">                <span class="type">PooledConnection</span> <span class="variable">newConn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PooledConnection</span>(conn.getRealConnection(), <span class="built_in">this</span>);</span><br><span class="line">              	<span class="comment">//æ”¾å…¥é—²ç½®åˆ—è¡¨ï¼ŒæˆåŠŸå›æ”¶</span></span><br><span class="line">                <span class="built_in">this</span>.state.idleConnections.add(newConn);</span><br><span class="line">                newConn.setCreatedTimestamp(conn.getCreatedTimestamp());</span><br><span class="line">                newConn.setLastUsedTimestamp(conn.getLastUsedTimestamp());</span><br><span class="line">                conn.invalidate();</span><br><span class="line">                <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;Returned connection &quot;</span> + newConn.getRealHashCode() + <span class="string">&quot; to pool.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">this</span>.state.notifyAll();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                var10000 = <span class="built_in">this</span>.state;</span><br><span class="line">                var10000.accumulatedCheckoutTime += conn.getCheckoutTime();</span><br><span class="line">                <span class="keyword">if</span> (!conn.getRealConnection().getAutoCommit()) &#123;</span><br><span class="line">                    conn.getRealConnection().rollback();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                conn.getRealConnection().close();</span><br><span class="line">                <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;Closed connection &quot;</span> + conn.getRealHashCode() + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                conn.invalidate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;A bad connection (&quot;</span> + conn.getRealHashCode() + <span class="string">&quot;) attempted to return to the pool, discarding connection.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ++<span class="built_in">this</span>.state.badConnectionCount;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å·²ç»å®Œå…¨äº†è§£äº†Mybatisçš„æ± åŒ–æ•°æ®æºçš„æ‰§è¡Œæµç¨‹äº†ã€‚åªä¸è¿‡ï¼Œæ— è®ºConnectionç®¡ç†æ–¹å¼å¦‚ä½•å˜æ¢ï¼Œæ— è®ºæ•°æ®æºå†é«˜çº§ï¼Œæˆ‘ä»¬è¦çŸ¥é“ï¼Œå®ƒéƒ½æœ€ç»ˆéƒ½ä¼šä½¿ç”¨<code>DriverManager</code>æ¥åˆ›å»ºè¿æ¥å¯¹è±¡ï¼Œè€Œæœ€ç»ˆä½¿ç”¨çš„ä¹Ÿæ˜¯<code>DriverManager</code>æä¾›çš„<code>Connection</code>å¯¹è±¡ã€‚</p>
<h3 id="æ•´åˆMybatisæ¡†æ¶"><a href="#æ•´åˆMybatisæ¡†æ¶" class="headerlink" title="æ•´åˆMybatisæ¡†æ¶"></a>æ•´åˆMybatisæ¡†æ¶</h3><p>é€šè¿‡äº†è§£æ•°æ®æºï¼Œæˆ‘ä»¬å·²ç»æ¸…æ¥šï¼ŒMybatiså®é™…ä¸Šæ˜¯åœ¨ä½¿ç”¨è‡ªå·±ç¼–å†™çš„æ•°æ®æºï¼ˆæ•°æ®æºæœ‰å¾ˆå¤šï¼Œä¹‹åæˆ‘ä»¬å†èŠå…¶ä»–çš„ï¼‰é»˜è®¤ä½¿ç”¨çš„æ˜¯æ± åŒ–çš„æ•°æ®æºï¼Œå®ƒé¢„å…ˆå­˜å‚¨äº†å¾ˆå¤šçš„è¿æ¥å¯¹è±¡ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•å°†Mybatisä¸Springæ›´å¥½çš„ç»“åˆå‘¢ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å¸Œæœ›å°†SqlSessionFactoryäº¤ç»™IoCå®¹å™¨è¿›è¡Œç®¡ç†ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬è‡ªå·±åˆ›å»ºå·¥å…·ç±»æ¥ç®¡ç†ï¼ˆæˆ‘ä»¬ä¹‹å‰ä¸€ç›´éƒ½åœ¨ä½¿ç”¨å·¥å…·ç±»ç®¡ç†å’Œåˆ›å»ºä¼šè¯ï¼‰</p>
<p>é¦–å…ˆå¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨mybatis-springä¾èµ–ä¸­ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†SqlSessionTemplateç±»ï¼Œå®ƒå…¶å®å°±æ˜¯å®˜æ–¹å°è£…çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ³¨å†Œä¸ºBeanï¼Œè¿™æ ·æˆ‘ä»¬éšæ—¶éƒ½å¯ä»¥å‘IoCå®¹å™¨ç´¢è¦ï¼Œè€Œä¸ç”¨è‡ªå·±å†å»ç¼–å†™ä¸€ä¸ªå·¥å…·ç±»äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®ç±»ä¸­åˆ›å»ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionTemplate <span class="title function_">sqlSessionTemplate</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(Resources.getResourceAsReader(<span class="string">&quot;mybatis-config.xml&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SqlSessionTemplate</span>(factory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/study&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.test.mapper.TestMapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(TestConfiguration.class);</span><br><span class="line">    <span class="type">SqlSessionTemplate</span> <span class="variable">template</span> <span class="operator">=</span> context.getBean(SqlSessionTemplate.class);</span><br><span class="line">    <span class="type">TestMapper</span> <span class="variable">testMapper</span> <span class="operator">=</span> template.getMapper(TestMapper.class);</span><br><span class="line">    System.out.println(testMapper.getStudent());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TestMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from student where sid = 1&quot;)</span></span><br><span class="line">    Student <span class="title function_">getStudent</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="type">int</span> sid;</span><br><span class="line">    String name;</span><br><span class="line">    String sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆåŠŸå¾—åˆ°Studentå®ä½“ç±»ï¼Œè¯æ˜<code>SqlSessionTemplate</code>æˆåŠŸæ³¨å†Œä¸ºBeanå¯ä»¥ä½¿ç”¨äº†ã€‚è™½ç„¶è¿™æ ·å·²ç»å¾ˆæ–¹ä¾¿äº†ï¼Œä½†æ˜¯è¿˜ä¸å¤Ÿæ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¾ç„¶éœ€è¦æ‰‹åŠ¨å»è·å–Mapperå¯¹è±¡ï¼Œé‚£ä¹ˆèƒ½å¦ç›´æ¥å¾—åˆ°å¯¹åº”çš„Mapperå¯¹è±¡å‘¢ï¼Œæˆ‘ä»¬å¸Œæœ›è®©Springç›´æ¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†æ‰€æœ‰çš„Mapperï¼Œå½“éœ€è¦æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»å®¹å™¨ä¸­è·å–ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®ç±»ä¸Šæ–¹æ·»åŠ æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;com.test.mapper&quot;)</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼ŒSpringä¼šè‡ªåŠ¨æ‰«ææ‰€æœ‰çš„Mapperï¼Œå¹¶å°†å…¶å®ç°æ³¨å†Œä¸ºBeanï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±å¯ä»¥ç›´æ¥é€šè¿‡å®¹å™¨è·å–äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(TestConfiguration.class);</span><br><span class="line">    <span class="type">TestMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> context.getBean(TestMapper.class);</span><br><span class="line">    System.out.println(mapper.getStudent());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯·ä¸€å®šæ³¨æ„ï¼Œå¿…é¡»å­˜åœ¨<code>SqlSessionTemplate</code>æˆ–æ˜¯<code>SqlSessionFactoryBean</code>çš„Beanï¼Œå¦åˆ™ä¼šæ— æ³•åˆå§‹åŒ–ï¼ˆæ¯•ç«Ÿè¦æ•°æ®åº“çš„é“¾æ¥ä¿¡æ¯ï¼‰</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ç›´æ¥å»é™¤Mybatisçš„é…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆæ”¹æ€ä¹ˆå»å®ç°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>SqlSessionFactoryBean</code>ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.test&quot;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.test.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PooledDataSource</span>(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>,</span><br><span class="line">                <span class="string">&quot;jdbc:mysql://localhost:3306/study&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactoryBean</span><span class="params">(<span class="meta">@Autowired</span> DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        bean.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ•°æ®æºçš„å®ç°ç±»ï¼Œå› ä¸ºè¿™æ˜¯æ•°æ®åº“æœ€åŸºæœ¬çš„ä¿¡æ¯ï¼Œç„¶åå†ç»™åˆ°<code>SqlSessionFactoryBean</code>å®ä¾‹ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬ç›¸å½“äºç›´æ¥åœ¨ä¸€å¼€å§‹é€šè¿‡IoCå®¹å™¨é…ç½®äº†<code>SqlSessionFactory</code>ï¼Œåªéœ€è¦ä¼ å…¥ä¸€ä¸ª<code>DataSource</code>çš„å®ç°å³å¯ã€‚</p>
<p>åˆ é™¤é…ç½®æ–‡ä»¶ï¼Œé‡æ–°å†æ¥è¿è¡Œï¼ŒåŒæ ·å¯ä»¥æ­£å¸¸ä½¿ç”¨Mapperã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œé€šè¿‡IoCå®¹å™¨ï¼ŒMybatiså·²ç»ä¸å†éœ€è¦ä½¿ç”¨é…ç½®æ–‡ä»¶äº†ï¼Œä¹‹ååŸºäºSpringçš„å¼€å‘å°†ä¸ä¼šå†å‡ºç°Mybatisçš„é…ç½®æ–‡ä»¶ã€‚</p>
<h3 id="ä½¿ç”¨HikariCPè¿æ¥æ± "><a href="#ä½¿ç”¨HikariCPè¿æ¥æ± " class="headerlink" title="ä½¿ç”¨HikariCPè¿æ¥æ± "></a>ä½¿ç”¨HikariCPè¿æ¥æ± </h3><p>å‰é¢æˆ‘ä»¬æåˆ°äº†æ•°æ®æºè¿˜æœ‰å…¶ä»–å®ç°ï¼Œæ¯”å¦‚C3P0ã€Druidç­‰ï¼Œå®ƒä»¬éƒ½æ˜¯éå¸¸ä¼˜ç§€çš„æ•°æ®æºå®ç°ï¼ˆå¯ä»¥è‡ªè¡Œäº†è§£ï¼‰ï¼Œä¸è¿‡æˆ‘ä»¬è¿™é‡Œè¦ä»‹ç»çš„ï¼Œæ˜¯ä¹‹ååœ¨SpringBootä¸­è¿˜ä¼šé‡åˆ°çš„HikariCPè¿æ¥æ± ã€‚</p>
<blockquote>
<p>HikariCPæ˜¯ç”±æ—¥æœ¬ç¨‹åºå‘˜å¼€æºçš„ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ç»„ä»¶ï¼Œä»£ç éå¸¸è½»é‡ï¼Œå¹¶ä¸”é€Ÿåº¦éå¸¸çš„å¿«ã€‚æ ¹æ®å®˜æ–¹æä¾›çš„æ•°æ®ï¼Œåœ¨é…·ç¿i7å¼€å¯32ä¸ªçº¿ç¨‹32ä¸ªè¿æ¥çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œéšæœºæ•°æ®åº“è¯»å†™æ“ä½œï¼ŒHikariCPçš„é€Ÿåº¦æ˜¯ç°åœ¨å¸¸ç”¨çš„C3P0æ•°æ®åº“è¿æ¥æ± çš„æ•°ç™¾å€ã€‚åœ¨SpringBoot2.0ä¸­ï¼Œå®˜æ–¹ä¹Ÿæ˜¯æ¨èä½¿ç”¨HikariCPã€‚</p>
</blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/2532461-ffcae57755776052.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/864" alt="img"></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zaxxer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>HikariCP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€ä¿®æ”¹ä¸€ä¸‹Beançš„å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="type">HikariDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>();</span><br><span class="line">    dataSource.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/study&quot;</span>);</span><br><span class="line">    dataSource.setDriverClassName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">    dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">    dataSource.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> dataSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å‘ç°ï¼ŒåŒæ ·å¯ä»¥å¾—åˆ°è¾“å‡ºç»“æœï¼Œä½†æ˜¯å‡ºç°äº†ä¸€ä¸ªæŠ¥é”™ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">SLF4J: Failed to load class &quot;org.slf4j.impl.StaticLoggerBinder&quot;.</span><br><span class="line">SLF4J: Defaulting to no-operation (NOP) logger implementation</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.</span><br></pre></td></tr></table></figure>

<p>æ­¤æ•°æ®æºå®é™…ä¸Šæ˜¯é‡‡ç”¨äº†SLF4Jæ—¥å¿—æ¡†æ¶æ‰“å°æ—¥å¿—ä¿¡æ¯ï¼Œä½†æ˜¯ç°åœ¨æ²¡æœ‰ä»»ä½•çš„æ—¥å¿—å®ç°ï¼ˆslf4jåªæ˜¯ä¸€ä¸ªAPIæ ‡å‡†ï¼Œå®ƒè§„èŒƒäº†å¤šç§æ—¥å¿—æ¡†æ¶çš„æ“ä½œï¼Œç»Ÿä¸€ä½¿ç”¨SLF4Jå®šä¹‰çš„æ–¹æ³•æ¥æ“ä½œä¸åŒçš„æ—¥å¿—æ¡†æ¶ï¼‰æˆ‘ä»¬è¿™é‡Œå°±ä½¿ç”¨JULä½œä¸ºæ—¥å¿—å®ç°ï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥å¦ä¸€ä¸ªä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-jdk14<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ç‰ˆæœ¬ä¸€å®šè¦å’Œ<code>slf4j-api</code>ä¿æŒä¸€è‡´ï¼</p>
<p>è¿™æ ·å°±èƒ½å¾—åˆ°æˆ‘ä»¬çš„æ—¥å¿—ä¿¡æ¯äº†ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">åäºŒæœˆ 07, 2021 8:46:41 ä¸‹åˆ com.zaxxer.hikari.HikariDataSource getConnection</span><br><span class="line">ä¿¡æ¯: HikariPool-1 - Starting...</span><br><span class="line">åäºŒæœˆ 07, 2021 8:46:41 ä¸‹åˆ com.zaxxer.hikari.HikariDataSource getConnection</span><br><span class="line">ä¿¡æ¯: HikariPool-1 - Start completed.</span><br><span class="line">Student(sid=1, name=å°æ˜, sex=ç”·)</span><br></pre></td></tr></table></figure>

<p>åœ¨SpringBooté˜¶æ®µï¼Œæˆ‘ä»¬è¿˜ä¼šé‡åˆ°<code>HikariPool-1 - Starting...</code>å’Œ<code>HikariPool-1 - Start completed.</code>åŒæ¬¾æ—¥å¿—ä¿¡æ¯ã€‚</p>
<p>å½“ç„¶ï¼ŒLombokè‚¯å®šä¹Ÿæ˜¯æ”¯æŒè¿™ä¸ªæ—¥å¿—æ¡†æ¶å¿«é€Ÿæ³¨è§£çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;é¡¹ç›®æ­£åœ¨å¯åŠ¨...&quot;</span>);</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(TestConfiguration.class);</span><br><span class="line">        <span class="type">TestMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> context.getBean(TestMapper.class);</span><br><span class="line">        System.out.println(mapper.getStudent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mybatisäº‹åŠ¡ç®¡ç†"><a href="#Mybatisäº‹åŠ¡ç®¡ç†" class="headerlink" title="Mybatisäº‹åŠ¡ç®¡ç†"></a>Mybatisäº‹åŠ¡ç®¡ç†</h3><p>æˆ‘ä»¬å‰é¢å·²ç»è®²è§£äº†å¦‚ä½•è®©Mybatisä¸Springæ›´å¥½åœ°èåˆåœ¨ä¸€èµ·ï¼Œé€šè¿‡å°†å¯¹åº”çš„Beanç±»å‹æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œå°±èƒ½æ›´åŠ æ–¹ä¾¿çš„å»ä½¿ç”¨Mapperï¼Œé‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹Springçš„äº‹åŠ¡æ§åˆ¶ã€‚</p>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯å›é¡¾ä¸€ä¸‹äº‹åŠ¡æœºåˆ¶ã€‚é¦–å…ˆäº‹åŠ¡éµå¾ªä¸€ä¸ªACIDåŸåˆ™ï¼š</p>
<ul>
<li>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œç”±ä¸€ç³»åˆ—åŠ¨ä½œç»„æˆã€‚äº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨ã€‚</li>
<li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šä¸€æ—¦äº‹åŠ¡å®Œæˆï¼ˆä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼‰ï¼Œç³»ç»Ÿå¿…é¡»ç¡®ä¿å®ƒæ‰€å»ºæ¨¡çš„ä¸šåŠ¡å¤„äºä¸€è‡´çš„çŠ¶æ€ï¼Œè€Œä¸ä¼šæ˜¯éƒ¨åˆ†å®Œæˆéƒ¨åˆ†å¤±è´¥ã€‚åœ¨ç°å®ä¸­çš„æ•°æ®ä¸åº”è¯¥è¢«ç ´åã€‚</li>
<li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šå¯èƒ½æœ‰è®¸å¤šäº‹åŠ¡ä¼šåŒæ—¶å¤„ç†ç›¸åŒçš„æ•°æ®ï¼Œå› æ­¤æ¯ä¸ªäº‹åŠ¡éƒ½åº”è¯¥ä¸å…¶ä»–äº‹åŠ¡éš”ç¦»å¼€æ¥ï¼Œé˜²æ­¢æ•°æ®æŸåã€‚</li>
<li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šä¸€æ—¦äº‹åŠ¡å®Œæˆï¼Œæ— è®ºå‘ç”Ÿä»€ä¹ˆç³»ç»Ÿé”™è¯¯ï¼Œå®ƒçš„ç»“æœéƒ½ä¸åº”è¯¥å—åˆ°å½±å“ï¼Œè¿™æ ·å°±èƒ½ä»ä»»ä½•ç³»ç»Ÿå´©æºƒä¸­æ¢å¤è¿‡æ¥ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œäº‹åŠ¡çš„ç»“æœè¢«å†™åˆ°æŒä¹…åŒ–å­˜å‚¨å™¨ä¸­ã€‚</li>
</ul>
<p>ç®€å•æ¥è¯´ï¼Œäº‹åŠ¡å°±æ˜¯è¦ä¹ˆå®Œæˆï¼Œè¦ä¹ˆå°±å•¥éƒ½åˆ«åšï¼å¹¶ä¸”ä¸åŒçš„äº‹åŠ¡ç›´æ¥ç›¸äº’éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥ç€æ¥æ·±å…¥äº†è§£ä¸€ä¸‹äº‹åŠ¡çš„<strong>éš”ç¦»æœºåˆ¶</strong>ï¼ˆåœ¨ä¹‹å‰æ•°æ®åº“å…¥é—¨é˜¶æ®µå¹¶æ²¡æœ‰æåˆ°ï¼‰æˆ‘ä»¬è¯´äº†ï¼Œäº‹åŠ¡ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»äº’ä¸å¹²æ‰°çš„ï¼Œé‚£ä¹ˆå¦‚æœå‡ºç°äº†ä¸‹é¢çš„æƒ…å†µï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼š</p>
<blockquote>
<p>å½“ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶åœ¨æ‰§è¡Œï¼Œå¹¶ä¸”åŒæ—¶åœ¨æ“ä½œåŒä¸€ä¸ªæ•°æ®ï¼Œè¿™æ ·å¾ˆå®¹æ˜“å‡ºç°å¹¶å‘ç›¸å…³çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸€ä¸ªäº‹åŠ¡å…ˆè¯»å–äº†æŸæ¡æ•°æ®ï¼Œè€Œå¦ä¸€ä¸ªäº‹åŠ¡æ­¤æ—¶ä¿®æ”¹äº†æ­¤æ•°æ®ï¼Œå½“å‰ä¸€ä¸ªäº‹åŠ¡ç´§æ¥ç€å†æ¬¡è¯»å–æ—¶ï¼Œä¼šå¯¼è‡´å’Œå‰ä¸€æ¬¡è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™å°±æ˜¯ä¸€ç§å…¸å‹çš„æ•°æ®è™šè¯»ç°è±¡ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œäº‹åŠ¡ä¹‹é—´å®é™…ä¸Šæ˜¯å­˜åœ¨ä¸€äº›éš”ç¦»çº§åˆ«çš„ï¼š</p>
<ul>
<li>ISOLATION_READ_UNCOMMITTEDï¼ˆè¯»æœªæäº¤ï¼‰ï¼šå…¶ä»–äº‹åŠ¡ä¼šè¯»å–å½“å‰äº‹åŠ¡å°šæœªæ›´æ”¹çš„æäº¤ï¼ˆç›¸å½“äºè¯»å–çš„æ˜¯è¿™ä¸ªäº‹åŠ¡æš‚æ—¶ç¼“å­˜çš„å†…å®¹ï¼Œå¹¶ä¸æ˜¯æ•°æ®åº“ä¸­çš„å†…å®¹ï¼‰</li>
<li>ISOLATION_READ_COMMITTEDï¼ˆè¯»å·²æäº¤ï¼‰ï¼šå…¶ä»–äº‹åŠ¡ä¼šè¯»å–å½“å‰äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯ç›´æ¥è¯»å–æ•°æ®åº“ä¸­å·²ç»å‘ç”Ÿæ›´æ”¹çš„å†…å®¹ï¼‰</li>
<li>ISOLATION_REPEATABLE_READï¼ˆå¯é‡å¤è¯»ï¼‰ï¼šå…¶ä»–äº‹åŠ¡ä¼šè¯»å–å½“å‰äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®å¹¶ä¸”å…¶ä»–äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸å…è®¸å†è¿›è¡Œæ•°æ®ä¿®æ”¹ï¼ˆæ³¨æ„è¿™é‡Œä»…ä»…æ˜¯ä¸å…è®¸ä¿®æ”¹æ•°æ®ï¼‰</li>
<li>ISOLATION_SERIALIZABLEï¼ˆä¸²è¡ŒåŒ–ï¼‰ï¼šå®ƒå®Œå…¨æœä»ACIDåŸåˆ™ï¼Œä¸€ä¸ªäº‹åŠ¡å¿…é¡»ç­‰å¾…å…¶ä»–äº‹åŠ¡ç»“æŸä¹‹åæ‰èƒ½å¼€å§‹æ‰§è¡Œï¼Œç›¸å½“äºæŒ¨ä¸ªæ‰§è¡Œï¼Œæ•ˆç‡å¾ˆä½</li>
</ul>
<p>æˆ‘ä»¬ä¾æ¬¡æ¥çœ‹çœ‹ï¼Œä¸åŒçš„éš”ç¦»çº§åˆ«ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ã€‚é¦–å…ˆæ˜¯<code>è¯»æœªæäº¤</code>çº§åˆ«ï¼Œæ­¤çº§åˆ«å±äºæœ€ä½çº§åˆ«ï¼Œç›¸å½“äºå„ä¸ªäº‹åŠ¡å…±äº«ä¸€ä¸ªç¼“å­˜åŒºåŸŸï¼Œä»»ä½•äº‹åŠ¡çš„æ“ä½œéƒ½åœ¨è¿™é‡Œè¿›è¡Œã€‚é‚£ä¹ˆå®ƒä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š</p>
<p><img src="http://image.mamicode.com/info/202004/20200406202855520730.png" alt="æŠ€æœ¯å›¾ç‰‡"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œäº‹åŠ¡Aæœ€åå¾—åˆ°çš„å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¯«æ— æ„ä¹‰çš„æ•°æ®ï¼ˆäº‹åŠ¡Bå·²ç»å›æ»šäº†ï¼‰æˆ‘ä»¬ç§°æ­¤æ•°æ®ä¸ºâ€è„æ•°æ®â€ï¼Œè¿™ç§ç°è±¡ç§°ä¸º<strong>è„è¯»</strong></p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹<code>è¯»å·²æäº¤</code>çº§åˆ«ï¼Œäº‹åŠ¡åªèƒ½è¯»å–å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„å†…å®¹ï¼Œç›¸å½“äºç›´æ¥ä»æ•°æ®ä¸­è¯»å–æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…<strong>è„è¯»</strong>é—®é¢˜äº†ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<p><img src="http://image.mamicode.com/info/202004/20200406202856166262.png" alt="æŠ€æœ¯å›¾ç‰‡"></p>
<p>è¿™æ­£æ˜¯æˆ‘ä»¬å‰é¢ä¾‹å­ä¸­æåˆ°çš„é—®é¢˜ï¼Œè™½ç„¶å®ƒé¿å…äº†è„è¯»é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœäº‹ä»¶Bä¿®æ”¹å¹¶æäº¤äº†æ•°æ®ï¼Œé‚£ä¹ˆå®é™…ä¸Šäº‹åŠ¡Aä¹‹å‰è¯»å–åˆ°çš„æ•°æ®ä¾ç„¶ä¸æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œç›´æ¥å¯¼è‡´ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè¿™ç§ç°è±¡ç§°ä¸º<strong>è™šè¯»</strong>ä¹Ÿå¯ä»¥ç§°ä¸º<strong>ä¸å¯é‡å¤è¯»</strong></p>
<p>å› æ­¤ï¼Œä¸‹ä¸€ä¸ªéš”ç¦»çº§åˆ«<code>å¯é‡å¤è¯»</code>å°±èƒ½å¤Ÿè§£å†³è¿™æ ·çš„é—®é¢˜ï¼ˆMySQLçš„é»˜è®¤éš”ç¦»çº§åˆ«ï¼‰ï¼Œå®ƒè§„å®šåœ¨å…¶ä»–äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œä¸å…è®¸ä¿®æ”¹æ•°æ®ï¼Œè¿™æ ·ï¼Œå°±å¯ä»¥æœ‰æ•ˆåœ°é¿å…ä¸å¯é‡å¤è¯»çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™æ ·å°±ä¸€å®šå®‰å…¨äº†å—ï¼Ÿè¿™é‡Œä»…ä»…æ˜¯ç¦æ­¢äº†äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„UPDATEæ“ä½œï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰ç¦æ­¢INSERTè¿™ç±»æ“ä½œï¼Œå› æ­¤ï¼Œå¦‚æœäº‹åŠ¡Aæ‰§è¡Œè¿‡ç¨‹ä¸­äº‹åŠ¡Bæ’å…¥äº†æ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆAè¿™æ—¶æ˜¯æ¯«ä¸çŸ¥æƒ…çš„ï¼Œæ¯”å¦‚ï¼š</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg-blog.csdnimg.cn%2Fimg_convert%2Fb1036ed06cc158d79a17a4e1bbb11de4.png&refer=http%3A%2F%2Fimg-blog.csdnimg.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1641478553&t=2218729b0125730a7874f1cd6193db22" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>ä¸¤ä¸ªäººåŒæ—¶æŠ¥åä¸€ä¸ªæ´»åŠ¨ï¼Œä¸¤ä¸ªæŠ¥åçš„äº‹åŠ¡åŒæ—¶åœ¨è¿›è¡Œï¼Œä½†æ˜¯ä»–ä»¬ä¸€å¼€å§‹è¯»å–åˆ°çš„äººæ•°éƒ½æ˜¯5ï¼Œè€Œè¿™æ—¶ï¼Œå®ƒä»¬éƒ½ä¼šè®¤ä¸ºæŠ¥åæˆåŠŸåäººæ•°åº”è¯¥å˜æˆ6ï¼Œè€Œæ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯7ï¼Œå› æ­¤è¿™ä¸ªæ—¶å€™å°±å‘ç”Ÿäº†æ•°æ®çš„<strong>å¹»è¯»</strong>ç°è±¡ã€‚</p>
<p>å› æ­¤ï¼Œè¦è§£å†³è¿™ç§é—®é¢˜ï¼Œåªèƒ½ä½¿ç”¨æœ€åä¸€ç§éš”ç¦»çº§åˆ«<code>ä¸²è¡ŒåŒ–</code>æ¥å®ç°äº†ï¼Œæ¯ä¸ªäº‹åŠ¡ä¸èƒ½åŒæ—¶è¿›è¡Œï¼Œç›´æ¥é¿å…æ‰€æœ‰å¹¶å‘é—®é¢˜ï¼Œç®€å•ç²—æš´ï¼Œä½†æ˜¯æ•ˆç‡çˆ†å‡ï¼Œå¹¶ä¸æ¨èã€‚</p>
<p>æœ€åæ€»ç»“ä¸‰ç§æƒ…å†µï¼š</p>
<ul>
<li>è„è¯»ï¼šè¯»å–åˆ°äº†è¢«å›æ»šçš„æ•°æ®ï¼Œå®ƒæ¯«æ— æ„ä¹‰ã€‚</li>
<li>è™šè¯»ï¼ˆä¸å¯é‡å¤è¯»ï¼‰ï¼šç”±äºå…¶ä»–äº‹åŠ¡æ›´æ–°æ•°æ®ï¼Œä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸ä¸€è‡´ã€‚</li>
<li>å¹»è¯»ï¼šç”±äºå…¶ä»–äº‹åŠ¡æ‰§è¡Œæ’å…¥åˆ é™¤æ“ä½œï¼Œè€Œåˆæ— æ³•æ„ŸçŸ¥åˆ°è¡¨ä¸­è®°å½•æ¡æ•°å‘ç”Ÿå˜åŒ–ï¼Œå½“ä¸‹æ¬¡å†è¯»å–æ—¶ä¼šè«åå…¶å¦™å¤šå‡ºæˆ–ç¼ºå¤±æ•°æ®ï¼Œå°±åƒäº§ç”Ÿå¹»è§‰ä¸€æ ·ã€‚</li>
</ul>
<p>ï¼ˆå¯¹äºè™šè¯»å’Œå¹»è¯»çš„åŒºåˆ†ï¼šè™šè¯»æ˜¯æŸä¸ªæ•°æ®å‰åè¯»å–ä¸ä¸€è‡´ï¼Œå¹»è¯»æ˜¯æ•´ä¸ªè¡¨çš„è®°å½•æ•°é‡å‰åè¯»å–ä¸ä¸€è‡´ï¼‰</p>
<p>æœ€åè¿™å¼ å›¾ï¼Œè¯·åŠ¡å¿…è®°åœ¨ä½ çš„è„‘æµ·ï¼Œè®°åœ¨ä½ çš„å¿ƒä¸­ï¼Œè®°åœ¨ä½ çš„å…¨ä¸–ç•Œï¼š</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.ouyym.com%2Fcontent%2Fa5a7d2e28973a6a1d8bcfd753c218736.png&refer=http%3A%2F%2Fimg.ouyym.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1641479475&t=5f255460ad285932a74ccad3547adcff" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>Mybatiså¯¹äºæ•°æ®åº“çš„äº‹åŠ¡ç®¡ç†ï¼Œä¹Ÿæœ‰ç€ç›¸åº”çš„å°è£…ã€‚ä¸€ä¸ªäº‹åŠ¡æ— éå°±æ˜¯åˆ›å»ºã€æäº¤ã€å›æ»šã€å…³é—­ï¼Œå› æ­¤è¿™äº›æ“ä½œè¢«MybatisæŠ½è±¡ä¸ºä¸€ä¸ªæ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Transaction</span> &#123;</span><br><span class="line">    Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line"></span><br><span class="line">    Integer <span class="title function_">getTimeout</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºæ­¤æ¥å£çš„å®ç°ï¼ŒMyBatisçš„äº‹åŠ¡ç®¡ç†åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼š</p>
<ol>
<li>ä½¿ç”¨<strong>JDBC</strong>çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶ï¼šå³åˆ©ç”¨å¯¹åº”æ•°æ®åº“çš„é©±åŠ¨ç”Ÿæˆçš„<code>Connection</code>å¯¹è±¡å®Œæˆå¯¹äº‹åŠ¡çš„æäº¤ï¼ˆcommit()ï¼‰ã€å›æ»šï¼ˆrollback()ï¼‰ã€å…³é—­ï¼ˆclose()ï¼‰ç­‰ï¼Œå¯¹åº”çš„å®ç°ç±»ä¸º<code>JdbcTransaction</code></li>
<li>ä½¿ç”¨<strong>MANAGED</strong>çš„äº‹åŠ¡ç®¡ç†æœºåˆ¶ï¼šè¿™ç§æœºåˆ¶MyBatisè‡ªèº«ä¸ä¼šå»å®ç°äº‹åŠ¡ç®¡ç†ï¼Œè€Œæ˜¯è®©ç¨‹åºçš„å®¹å™¨ï¼ˆæ¯”å¦‚Springï¼‰æ¥å®ç°å¯¹äº‹åŠ¡çš„ç®¡ç†ï¼Œå¯¹åº”çš„å®ç°ç±»ä¸º<code>ManagedTransaction</code></li>
</ol>
<p>è€Œæˆ‘ä»¬ä¹‹å‰ä¸€ç›´ä½¿ç”¨çš„å…¶å®å°±æ˜¯JDBCçš„äº‹åŠ¡ï¼Œç›¸å½“äºç›´æ¥ä½¿ç”¨<code>Connection</code>å¯¹è±¡ï¼ˆä¹‹å‰JavaWebé˜¶æ®µå·²ç»è®²è§£è¿‡äº†ï¼‰åœ¨è¿›è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶æ²¡æœ‰é¢å¤–çš„ç®¡ç†æœºåˆ¶ï¼Œå¯¹åº”çš„é…ç½®ä¸ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹<code>JdbcTransaction</code>æ˜¯ä¸æ˜¯åƒæˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„é‚£æ ·ç®¡ç†äº‹åŠ¡çš„ï¼Œç›´æ¥ä¸Šæºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTransaction</span> <span class="keyword">implements</span> <span class="title class_">Transaction</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(JdbcTransaction.class);</span><br><span class="line">    <span class="keyword">protected</span> Connection connection;</span><br><span class="line">    <span class="keyword">protected</span> DataSource dataSource;</span><br><span class="line">    <span class="keyword">protected</span> TransactionIsolationLevel level;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> autoCommit;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JdbcTransaction</span><span class="params">(DataSource ds, TransactionIsolationLevel desiredLevel, <span class="type">boolean</span> desiredAutoCommit)</span> &#123;</span><br><span class="line">      	<span class="comment">//æ•°æ®æº</span></span><br><span class="line">        <span class="built_in">this</span>.dataSource = ds;</span><br><span class="line">      	<span class="comment">//äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¸Šé¢å·²ç»æåˆ°è¿‡äº†</span></span><br><span class="line">        <span class="built_in">this</span>.level = desiredLevel;</span><br><span class="line">      	<span class="comment">//æ˜¯å¦è‡ªåŠ¨æäº¤</span></span><br><span class="line">        <span class="built_in">this</span>.autoCommit = desiredAutoCommit;</span><br><span class="line">    &#125;</span><br><span class="line">  	</span><br><span class="line">  <span class="comment">//ä¹Ÿå¯ä»¥ç›´æ¥ç»™ä¸ªConnectionå¯¹è±¡</span></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">JdbcTransaction</span><span class="params">(Connection connection)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.connection = connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">      	<span class="comment">//æ²¡æœ‰å°±é€šè¿‡æ•°æ®æºæ–°å¼€ä¸€ä¸ªConnection</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.connection == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.openConnection();</span><br><span class="line">        &#125;</span><br><span class="line">	</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">      	<span class="comment">//è¿æ¥å·²ç»åˆ›å»ºå¹¶ä¸”æ²¡å¼€å¯è‡ªåŠ¨æäº¤æ‰å¯ä»¥ä½¿ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.connection != <span class="literal">null</span> &amp;&amp; !<span class="built_in">this</span>.connection.getAutoCommit()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;Committing JDBC Connection [&quot;</span> + <span class="built_in">this</span>.connection + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">						<span class="comment">//å®é™…ä¸Šä½¿ç”¨çš„æ˜¯æ•°æ®åº“é©±åŠ¨æä¾›çš„Connectionå¯¹è±¡è¿›è¡Œäº‹åŠ¡æ“ä½œ</span></span><br><span class="line">            <span class="built_in">this</span>.connection.commit();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ç›¸å½“äº<code>JdbcTransaction</code>åªæ˜¯ä¸ºæ•°æ®åº“é©±åŠ¨æä¾›çš„<code>Connection</code>å¯¹è±¡å¥—äº†å±‚å£³ï¼Œæ‰€æœ‰çš„äº‹åŠ¡æ“ä½œå®é™…ä¸Šæ˜¯ç›´æ¥è°ƒç”¨<code>Connection</code>å¯¹è±¡ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥ç€æ¥çœ‹<code>ManagedTransaction</code>çš„æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ManagedTransaction</span> <span class="keyword">implements</span> <span class="title class_">Transaction</span> &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œå¤§ä½“å†…å®¹å’Œ<code>JdbcTransaction</code>å·®ä¸å¤šï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰å®ç°ä»»ä½•çš„äº‹åŠ¡æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå¸Œæœ›å°†å®ç°äº¤ç»™å…¶ä»–çš„ç®¡ç†æ¡†æ¶æ¥å®Œæˆï¼Œè€ŒSpringå°±ä¸ºMybatisæä¾›äº†ä¸€ä¸ªéå¸¸å¥½çš„äº‹åŠ¡ç®¡ç†å®ç°ã€‚</p>
<h3 id="ä½¿ç”¨Springäº‹åŠ¡ç®¡ç†"><a href="#ä½¿ç”¨Springäº‹åŠ¡ç®¡ç†" class="headerlink" title="ä½¿ç”¨Springäº‹åŠ¡ç®¡ç†"></a>ä½¿ç”¨Springäº‹åŠ¡ç®¡ç†</h3><p>ç°åœ¨æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹Springæä¾›çš„äº‹åŠ¡ç®¡ç†ï¼ˆSpringäº‹åŠ¡ç®¡ç†åˆ†ä¸ºç¼–ç¨‹å¼äº‹åŠ¡å’Œå£°æ˜å¼äº‹åŠ¡ï¼Œä½†æ˜¯ç¼–ç¨‹å¼äº‹åŠ¡è¿‡äºå¤æ‚å¹¶ä¸”å…·æœ‰é«˜åº¦è€¦åˆæ€§ï¼Œè¿èƒŒäº†Springæ¡†æ¶çš„è®¾è®¡åˆè¡·ï¼Œå› æ­¤è¿™é‡Œåªè®²è§£å£°æ˜å¼äº‹åŠ¡ï¼‰å£°æ˜å¼äº‹åŠ¡æ˜¯åŸºäºAOPå®ç°çš„ã€‚</p>
<p>ä½¿ç”¨å£°æ˜å¼äº‹åŠ¡éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®ç±»æ·»åŠ <code>@EnableTransactionManagement</code>æ³¨è§£å³å¯ï¼Œè¿™æ ·å°±å¯ä»¥å¼€å¯Springçš„äº‹åŠ¡æ”¯æŒäº†ã€‚æ¥ç€ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠä¸€ä¸ªäº‹åŠ¡è¦åšçš„æ‰€æœ‰äº‹æƒ…å°è£…åˆ°Serviceå±‚çš„ä¸€ä¸ªæ–¹æ³•ä¸­å³å¯ï¼Œé¦–å…ˆéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œä¸€ä¸ªæ–°çš„Beanï¼Œäº‹åŠ¡éœ€è¦æ‰§è¡Œå¿…é¡»æœ‰ä¸€ä¸ªäº‹åŠ¡ç®¡ç†å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> TransactionManager <span class="title function_">transactionManager</span><span class="params">(<span class="meta">@Autowired</span> DataSource dataSource)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>(dataSource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ç¼–å†™Mapperæ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TestMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into student(name, sex) values(&#x27;æµ‹è¯•&#x27;, &#x27;ç”·&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insertStudent</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¼šå‘æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡æ–°çš„å­¦ç”Ÿä¿¡æ¯ï¼Œæ¥ç€ï¼Œå‡è®¾æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªä¸šåŠ¡éœ€è¦è¿ç»­æ’å…¥ä¸¤æ¡å­¦ç”Ÿä¿¡æ¯ï¼Œé¦–å…ˆç¼–å†™ä¸šåŠ¡å±‚çš„æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TestService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ï¼Œæˆ‘ä»¬å†æ¥ç¼–å†™ä¸šåŠ¡å±‚çš„å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†å…¶æ³¨å†Œä¸ºBeanï¼Œäº¤ç»™Springæ¥è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·å°±å¯ä»¥è‡ªåŠ¨å°†Mapperæ³¨å…¥åˆ°ç±»ä¸­äº†ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒäº‹åŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">TestService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    TestMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        mapper.insertStudent();</span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">true</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸ï¼&quot;</span>);</span><br><span class="line">        mapper.insertStudent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åªéœ€åœ¨æ–¹æ³•ä¸Šæ·»åŠ <code>@Transactional</code>æ³¨è§£ï¼Œå³å¯è¡¨ç¤ºæ­¤æ–¹æ³•æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªäº‹åŠ¡æ“ä½œï¼Œåœ¨è°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼ŒSpringä¼šé€šè¿‡AOPæœºåˆ¶ä¸ºå…¶è¿›è¡Œå¢å¼ºï¼Œä¸€æ—¦å‘ç°å¼‚å¸¸ï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨å›æ»šã€‚æœ€åæˆ‘ä»¬æ¥è°ƒç”¨ä¸€ä¸‹æ­¤æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;é¡¹ç›®æ­£åœ¨å¯åŠ¨...&quot;</span>);</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(TestConfiguration.class);</span><br><span class="line">        <span class="type">TestService</span> <span class="variable">service</span> <span class="operator">=</span> context.getBean(TestService.class);</span><br><span class="line">        service.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°çš„ç»“æœæ˜¯å‡ºç°é”™è¯¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">åäºŒæœˆ 08, <span class="number">2021</span> <span class="number">3</span>:09:<span class="number">29</span> ä¸‹åˆ com.test.Main main</span><br><span class="line">ä¿¡æ¯: é¡¹ç›®æ­£åœ¨å¯åŠ¨...</span><br><span class="line">åäºŒæœˆ 08, <span class="number">2021</span> <span class="number">3</span>:09:<span class="number">29</span> ä¸‹åˆ com.zaxxer.hikari.HikariDataSource getConnection</span><br><span class="line">ä¿¡æ¯: HikariPool-<span class="number">1</span> - Starting...</span><br><span class="line">åäºŒæœˆ 08, <span class="number">2021</span> <span class="number">3</span>:09:<span class="number">29</span> ä¸‹åˆ com.zaxxer.hikari.HikariDataSource getConnection</span><br><span class="line">ä¿¡æ¯: HikariPool-<span class="number">1</span> - Start completed.</span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.RuntimeException: æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸ï¼</span><br><span class="line">	at com.test.service.TestServiceImpl.test(TestServiceImpl.java:<span class="number">22</span>)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:<span class="number">43</span>)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:<span class="number">498</span>)</span><br><span class="line">	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:<span class="number">344</span>)</span><br><span class="line">	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:<span class="number">198</span>)</span><br><span class="line">	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:<span class="number">163</span>)</span><br><span class="line">	at org.springframework.transaction.interceptor.TransactionInterceptor$<span class="number">1.</span>proceedWithInvocation(TransactionInterceptor.java:<span class="number">123</span>)</span><br><span class="line">	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:<span class="number">388</span>)</span><br><span class="line">	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:<span class="number">119</span>)</span><br><span class="line">	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:<span class="number">186</span>)</span><br><span class="line">	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:<span class="number">215</span>)</span><br><span class="line">	at com.sun.proxy.$Proxy30.test(Unknown Source)</span><br><span class="line">	at com.test.Main.main(Main.java:<span class="number">17</span>)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œæ•´ä¸ªæ ˆè¿½è¸ªä¿¡æ¯ä¸­åŒ…å«äº†å¤§é‡aopåŒ…ä¸‹çš„ç›¸å…³å†…å®¹ï¼Œä¹Ÿå°±å°è¯äº†ï¼Œå®ƒç¡®å®æ˜¯é€šè¿‡AOPå®ç°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ç€æ¥çœ‹ä¸€ä¸‹ï¼Œæ•°æ®åº“ä¸­çš„æ•°æ®æ˜¯å¦æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼ˆå‡ºç°å¼‚å¸¸å›æ»šäº†ï¼‰</p>
<p>ç»“æœæ˜¾è€Œæ˜“è§ï¼Œç¡®å®è¢«å›æ»šäº†ï¼Œæ•°æ®åº“ä¸­æ²¡æœ‰ä»»ä½•çš„å†…å®¹ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥ç ”ç©¶ä¸€ä¸‹<code>@Transactional</code>æ³¨è§£çš„ä¸€äº›å‚æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Transactional &#123;</span><br><span class="line">    <span class="meta">@AliasFor(&quot;transactionManager&quot;)</span></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">    String <span class="title function_">transactionManager</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String[] label() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Propagation <span class="title function_">propagation</span><span class="params">()</span> <span class="keyword">default</span> Propagation.REQUIRED;</span><br><span class="line"></span><br><span class="line">    Isolation <span class="title function_">isolation</span><span class="params">()</span> <span class="keyword">default</span> Isolation.DEFAULT;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">timeout</span><span class="params">()</span> <span class="keyword">default</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">timeoutString</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">readOnly</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Throwable</span>&gt;[] rollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] rollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Throwable</span>&gt;[] noRollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] noRollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥è®²è§£å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„ä¿¡æ¯ï¼š</p>
<ul>
<li>transactionManagerï¼šæŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨</li>
<li>propagationï¼šäº‹åŠ¡ä¼ æ’­è§„åˆ™ï¼Œä¸€ä¸ªäº‹åŠ¡å¯ä»¥åŒ…æ‹¬Nä¸ªå­äº‹åŠ¡</li>
<li>isolationï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¸å¤šè¯´äº†</li>
<li>timeoutï¼šäº‹åŠ¡è¶…æ—¶æ—¶é—´</li>
<li>readOnlyï¼šæ˜¯å¦ä¸ºåªè¯»äº‹åŠ¡ï¼Œä¸åŒçš„æ•°æ®åº“ä¼šæ ¹æ®åªè¯»å±æ€§è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚MySQLä¸€æ—¦å£°æ˜äº‹åŠ¡ä¸ºåªè¯»ï¼Œé‚£ä¹ˆä¹…ä¸å…è®¸å¢åˆ æ”¹æ“ä½œäº†ã€‚</li>
<li>rollbackForå’ŒnoRollbackForï¼šå‘ç”ŸæŒ‡å®šå¼‚å¸¸æ—¶å›æ»šæˆ–æ˜¯ä¸å›æ»šï¼Œé»˜è®¤å‘ç”Ÿä»»ä½•å¼‚å¸¸éƒ½å›æ»š</li>
</ul>
<p>é™¤äº†äº‹åŠ¡çš„ä¼ æ’­è§„åˆ™ï¼Œå…¶ä»–çš„å†…å®¹å…¶å®å·²ç»ç»™å¤§å®¶è®²è§£è¿‡äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹çœ‹äº‹åŠ¡çš„ä¼ æ’­ã€‚äº‹åŠ¡ä¼ æ’­ä¸€å…±æœ‰ä¸ƒç§çº§åˆ«ï¼š</p>
<p><img src="https://img-blog.csdn.net/20170420212829825?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc29vbmZseQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>Springé»˜è®¤çš„ä¼ æ’­çº§åˆ«æ˜¯<code>PROPAGATION_REQUIRED</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå®ƒæ˜¯å¦‚ä½•ä¼ æ’­çš„ï¼Œç°åœ¨æˆ‘ä»¬çš„<code>Service</code>ç±»ä¸­ä¸€å…±å­˜åœ¨ä¸¤ä¸ªäº‹åŠ¡ï¼Œè€Œä¸€ä¸ªäº‹åŠ¡æ–¹æ³•åŒ…å«äº†å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    test2();</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">true</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸ï¼&quot;</span>);  <span class="comment">//å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šå›æ»šå¦ä¸€ä¸ªäº‹åŠ¡å—ï¼Ÿ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">    mapper.insertStudent();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å¾—åˆ°ç»“æœï¼Œå¦ä¸€ä¸ªäº‹åŠ¡è¢«å›æ»šäº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç›¸å½“äºå¦ä¸€ä¸ªäº‹åŠ¡ç›´æ¥åŠ å…¥åˆ°æ­¤äº‹åŠ¡ä¸­äº†ï¼Œä¹Ÿå°±æ˜¯è¡¨ä¸­æ‰€æè¿°çš„é‚£æ ·ã€‚</p>
<p>å¦‚æœå•ç‹¬æ‰§è¡Œ<code>test2()</code>åˆ™ä¼šå¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œè€Œæ‰§è¡Œ<code>test()</code>åˆ™ä¼šç›´æ¥è®©å†…éƒ¨çš„<code>test2()</code>åŠ å…¥åˆ°å½“å‰äº‹åŠ¡ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    test2();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.SUPPORTS)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">    mapper.insertStudent();</span><br><span class="line">   	<span class="keyword">if</span>(<span class="literal">true</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å°†<code>test2()</code>çš„ä¼ æ’­çº§åˆ«è®¾å®šä¸º<code>SUPPORTS</code>ï¼Œé‚£ä¹ˆè¿™æ—¶å¦‚æœå•ç‹¬è°ƒç”¨<code>test2()</code>æ–¹æ³•ï¼Œå¹¶ä¸ä¼šä»¥äº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œï¼Œå½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œè™½ç„¶ä¾ç„¶å­˜åœ¨AOPå¢å¼ºï¼Œä½†æ˜¯ä¸ä¼šè¿›è¡Œå›æ»šæ“ä½œï¼Œè€Œç°åœ¨å†è°ƒç”¨<code>test()</code>æ–¹æ³•ï¼Œæ‰ä¼šä»¥äº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹<code>MANDATORY</code>ï¼Œå®ƒéå¸¸ä¸¥æ ¼ï¼Œå¦‚æœå½“å‰æ–¹æ³•å¹¶æ²¡æœ‰åœ¨ä»»ä½•äº‹åŠ¡ä¸­è¿›è¡Œï¼Œä¼šç›´æ¥å‡ºç°å¼‚å¸¸ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    test2();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.MANDATORY)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">    mapper.insertStudent();</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">true</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æˆ‘æ˜¯æµ‹è¯•å¼‚å¸¸ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥è¿è¡Œ<code>test2()</code>æ–¹æ³•ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> org.springframework.transaction.IllegalTransactionStateException: No existing transaction found <span class="keyword">for</span> transaction marked with propagation <span class="string">&#x27;mandatory&#x27;</span></span><br><span class="line">	at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:<span class="number">362</span>)</span><br><span class="line">	at org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:<span class="number">595</span>)</span><br><span class="line">	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:<span class="number">382</span>)</span><br><span class="line">	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:<span class="number">119</span>)</span><br><span class="line">	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:<span class="number">186</span>)</span><br><span class="line">	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:<span class="number">215</span>)</span><br><span class="line">	at com.sun.proxy.$Proxy29.test2(Unknown Source)</span><br><span class="line">	at com.test.Main.main(Main.java:<span class="number">17</span>)</span><br></pre></td></tr></table></figure>

<p><code>NESTED</code>çº§åˆ«è¡¨ç¤ºå¦‚æœå­˜åœ¨å¤–å±‚äº‹åŠ¡ï¼Œåˆ™æ­¤æ–¹æ³•å•ç‹¬åˆ›å»ºä¸€ä¸ªå­äº‹åŠ¡ï¼Œå›æ»šåªä¼šå½±å“åˆ°æ­¤å­äº‹åŠ¡ï¼Œå®é™…ä¸Šå°±æ˜¯åˆ©ç”¨åˆ›å»ºSavepointï¼Œç„¶åå›æ»šåˆ°æ­¤ä¿å­˜ç‚¹å®ç°çš„ã€‚<code>NEVER</code>çº§åˆ«è¡¨ç¤ºæ­¤æ–¹æ³•ä¸åº”è¯¥åŠ å…¥åˆ°ä»»ä½•äº‹åŠ¡ä¸­ï¼Œå…¶ä½™ç±»å‹é€‚ç”¨äºåŒæ—¶æ“ä½œå¤šæ•°æ®æºæƒ…å†µä¸‹çš„åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç†ï¼Œè¿™é‡Œæš‚æ—¶ä¸åšä»‹ç»ã€‚</p>
<p>è‡³æ­¤ï¼Œæœ‰å…³Springçš„æ ¸å¿ƒå†…å®¹å°±è®²è§£å®Œæ¯•äº†ã€‚</p>
<hr>
<h2 id="é›†æˆJUnitæµ‹è¯•"><a href="#é›†æˆJUnitæµ‹è¯•" class="headerlink" title="é›†æˆJUnitæµ‹è¯•"></a>é›†æˆJUnitæµ‹è¯•</h2><p>æ—¢ç„¶ä½¿ç”¨äº†Springï¼Œé‚£ä¹ˆæ€ä¹ˆé›†æˆåˆ°JUnitä¸­è¿›è¡Œæµ‹è¯•å‘¢ï¼Œé¦–å…ˆå¤§å®¶èƒ½å¤Ÿæƒ³åˆ°çš„è‚¯å®šæ˜¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(TestConfiguration.class);</span><br><span class="line">        <span class="type">TestService</span> <span class="variable">service</span> <span class="operator">=</span> context.getBean(TestService.class);</span><br><span class="line">        service.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´æ¥ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å³å¯ï¼Œä½†æ˜¯è¿™æ ·çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¾ˆå¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸å¯èƒ½æ¯æ¬¡æµ‹è¯•éƒ½å»åˆ›å»ºApplicationContextå§ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@Before</code>æ·»åŠ ä¸€ä¸ªæµ‹è¯•å‰åŠ¨ä½œæ¥æå‰é…ç½®ApplicationContextï¼Œä½†æ˜¯è¿™æ ·çš„è¯ï¼Œè¿˜æ˜¯ä¸å¤Ÿç®€ä¾¿ï¼Œèƒ½ä¸èƒ½æœ‰æ›´å¿«é€Ÿé«˜æ•ˆçš„æ–¹æ³•å‘¢ï¼Ÿ</p>
<p>Springä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªTestæ¨¡å—ï¼Œå®ƒä¼šè‡ªåŠ¨é›†æˆJunitè¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å¯¼å…¥ä¸€ä¸‹ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯¼å…¥çš„æ˜¯JUnit5å’ŒSpringTestæ¨¡å—ä¾èµ–ï¼Œç„¶åç›´æ¥åœ¨æˆ‘ä»¬çš„æµ‹è¯•ç±»ä¸Šæ·»åŠ ä¸¤ä¸ªæ³¨è§£å°±å¯ä»¥æå®šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = TestConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMain</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    TestService service;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        service.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@ExtendWith</code>æ˜¯ç”±JUnitæä¾›çš„æ³¨è§£ï¼Œç­‰åŒäºæ—§ç‰ˆæœ¬çš„<code>@RunWith</code>æ³¨è§£ï¼Œç„¶åä½¿ç”¨SpringTestæ¨¡å—æä¾›çš„<code>@ContextConfiguration</code>æ³¨è§£æ¥è¡¨ç¤ºè¦åŠ è½½å“ªä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯XMLæ–‡ä»¶ä¹Ÿå¯ä»¥æ˜¯ç±»ï¼Œæˆ‘ä»¬è¿™é‡Œå°±ç›´æ¥ä½¿ç”¨ç±»è¿›è¡ŒåŠ è½½ã€‚</p>
<p>é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨<code>@Autowired</code>æ¥è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œå¹¶ä¸”ç›´æ¥åœ¨æµ‹è¯•æ–¹æ³•ä¸­ä½¿ç”¨æ³¨å…¥çš„Beanï¼Œç°åœ¨å°±éå¸¸æ–¹ä¾¿äº†ã€‚</p>
<hr>
<h2 id="æ¢ç©¶SpringåŸç†"><a href="#æ¢ç©¶SpringåŸç†" class="headerlink" title="æ¢ç©¶SpringåŸç†"></a>æ¢ç©¶SpringåŸç†</h2><p><strong>æ³¨æ„ï¼š</strong>æœ¬ç‰ˆå—éš¾åº¦å¾ˆå¤§ï¼Œä½œä¸ºé€‰å­¦å†…å®¹ã€‚</p>
<p>å¦‚æœå­¦ä¹ SpringåŸºæœ¬å†…å®¹å¯¹ä½ æ¥è¯´å·²ç»éå¸¸å›°éš¾äº†ï¼Œå»ºè®®è·³è¿‡æ­¤å°èŠ‚ï¼Œç›´æ¥è¿›å…¥MVCé˜¶æ®µçš„å­¦ä¹ ï¼Œæ­¤å°èŠ‚ä¼šä»æºç è§’åº¦è§£é‡ŠSpringçš„æ•´ä¸ªè¿è¡ŒåŸç†ï¼Œå¯¹åˆå­¦è€…æ¥è¯´ç­‰åŒäºå°å­¦è·¨è¶Šåˆ°é«˜ä¸­ï¼Œå®ƒå¹¶ä¸æ˜¯å¿…å­¦å†…å®¹ï¼Œä½†æ˜¯å¯¹äºä¸ªäººå¼€å‘èƒ½åŠ›çš„æå‡æä¸ºé‡è¦ï¼ˆæ¨èå®Œæˆæ•´ä¸ªSSMé˜¶æ®µçš„å­¦ä¹ å¹¶ä¸”åŠ ä»¥å®æˆ˜ä¹‹åå†æ¥çœ‹æ­¤éƒ¨åˆ†ï¼‰ï¼Œå¦‚æœä½ è¿˜æ˜¯è§‰å¾—è‡ªå·±èƒ½å¤Ÿè·Ÿä¸ŠèŠ‚å¥ç»§ç»­æ·±å…¥é’»ç ”åº•å±‚åŸç†ï¼Œé‚£ä¹ˆç°åœ¨å°±å¼€å§‹å§ã€‚</p>
<h3 id="æ¢ç©¶IoCåŸç†"><a href="#æ¢ç©¶IoCåŸç†" class="headerlink" title="æ¢ç©¶IoCåŸç†"></a>æ¢ç©¶IoCåŸç†</h3><p>é¦–å…ˆæˆ‘ä»¬å¤§è‡´äº†è§£ä¸€ä¸‹ApplicationContextçš„åŠ è½½æµç¨‹ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/749633-e707e5a84194d13a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/852" alt="img"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªè¿‡ç¨‹æä¸ºå¤æ‚ï¼Œä¸€å¥è¯è‚¯å®šæ˜¯æ— æ³•è§£é‡Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä»<code>ApplicationContext</code>è¯´èµ·å§ã€‚</p>
<p>ç”±äºSpringçš„æºç æä¸ºå¤æ‚ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¯èƒ½å†åƒäº†è§£å…¶ä»–æ¡†æ¶é‚£æ ·ç›´æ¥è‡ªåº•å‘ä¸Šé€è¡Œå¹²æºç äº†ï¼ˆå¯ä»¥è‡ªå·±ç‚¹å¼€çœ‹çœ‹ï¼Œä»£ç é‡éå¸¸ä¹‹å¤šï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä»ä¸€äº›æœ€åŸºæœ¬çš„æ¥å£å®šä¹‰å¼€å§‹è®²èµ·ï¼Œè‡ªé¡¶å‘ä¸‹é€æ­¥ç“¦è§£ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹<code>ApplicationContext</code>æœ€é¡¶å±‚æ¥å£æ˜¯ä»€ä¹ˆï¼Œä¸€ç›´å¾€ä¸Šï¼Œæˆ‘ä»¬ä¼šå‘ç°æœ‰ä¸€ä¸ª<code>AbstractApplicationContext</code>ç±»ï¼Œæˆ‘ä»¬ç›´æ¥å³é”®ç”Ÿæˆä¸€ä¸ªUMLç±»å›¾æŸ¥çœ‹ï¼š</p>
<p>![image-20211209202503121](/Users/nagocoler/Library/Application Support/typora-user-images/image-20211209202503121.png)</p>
<p>æˆ‘ä»¬å‘ç°æœ€é¡¶å±‚å®é™…ä¸Šæ˜¯ä¸€ä¸ªBeanFactoryæ¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä»è¿™ä¸ªæ¥å£å¼€å§‹ç ”ç©¶èµ·ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­¤æ¥å£ä¸­å®šä¹‰äº†å¾ˆå¤šçš„è¡Œä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanFactory</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">FACTORY_BEAN_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">getBean</span><span class="params">(String var1)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(String var1, Class&lt;T&gt; var2)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">getBean</span><span class="params">(String var1, Object... var2)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(Class&lt;T&gt; var1)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(Class&lt;T&gt; var1, Object... var2)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; ObjectProvider&lt;T&gt; <span class="title function_">getBeanProvider</span><span class="params">(Class&lt;T&gt; var1)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; ObjectProvider&lt;T&gt; <span class="title function_">getBeanProvider</span><span class="params">(ResolvableType var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">containsBean</span><span class="params">(String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">(String var1)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isPrototype</span><span class="params">(String var1)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isTypeMatch</span><span class="params">(String var1, ResolvableType var2)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isTypeMatch</span><span class="params">(String var1, Class&lt;?&gt; var2)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    Class&lt;?&gt; getType(String var1) <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    Class&lt;?&gt; getType(String var1, <span class="type">boolean</span> var2) <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line">    String[] getAliases(String var1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œå…¶ä¸­æœ€çœ¼ç†Ÿçš„å°±æ˜¯<code>getBean()</code>æ–¹æ³•äº†ï¼Œæ­¤æ–¹æ³•è¢«é‡è½½äº†å¾ˆå¤šæ¬¡ï¼Œå¯ä»¥æ¥å—å¤šç§å‚æ•°ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ–­å®šï¼Œä¸€ä¸ªIoCå®¹å™¨æœ€åŸºæœ¬çš„è¡Œä¸ºåœ¨æ­¤æ¥å£ä¸­å·²ç»è¢«å®šä¹‰å¥½äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰çš„BeanFactoryå®ç°ç±»éƒ½åº”è¯¥å…·å¤‡å®¹å™¨ç®¡ç†Beançš„åŸºæœ¬èƒ½åŠ›ï¼Œå°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªBeanå·¥å‚ï¼Œå·¥å‚å°±æ˜¯ç”¨æ¥ç”Ÿäº§Beanå®ä¾‹å¯¹è±¡çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰¾åˆ°æ­¤æ¥å£çš„ä¸€ä¸ªæŠ½è±¡å®ç°<code>AbstractBeanFactory</code>ç±»ï¼Œå®ƒå®ç°äº†<code>getBean()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.doGetBean(name, (Class)<span class="literal">null</span>, (Object[])<span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬<code>doGetBean()</code>æ¥ç€æ¥çœ‹æ–¹æ³•é‡Œé¢å¹²äº†ä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> &lt;T&gt; T <span class="title function_">doGetBean</span><span class="params">(String name, <span class="meta">@Nullable</span> Class&lt;T&gt; requiredType, <span class="meta">@Nullable</span> Object[] args, <span class="type">boolean</span> typeCheckOnly)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> <span class="built_in">this</span>.transformedBeanName(name);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">sharedInstance</span> <span class="operator">=</span> <span class="built_in">this</span>.getSingleton(beanName);</span><br><span class="line">    Object beanInstance;</span><br><span class="line">    <span class="keyword">if</span> (sharedInstance != <span class="literal">null</span> &amp;&amp; args == <span class="literal">null</span>) &#123;</span><br><span class="line">      ...</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ‰€æœ‰çš„Beané»˜è®¤éƒ½æ˜¯å•ä¾‹æ¨¡å¼ï¼Œå¯¹è±¡åªä¼šå­˜åœ¨ä¸€ä¸ªï¼Œå› æ­¤å®ƒä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„<code>getSingleton()</code>æ–¹æ³•æ¥ç›´æ¥è·å–å•ä¾‹å¯¹è±¡ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿åˆ°Beançš„å®ä¾‹ã€‚å¦‚æœæ²¡æœ‰ä¼šè¿›å…¥elseä»£ç å—ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œé¦–å…ˆä¼šè¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.isPrototypeCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCurrentlyInCreationException</span>(beanName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸ºäº†è§£å†³å¾ªç¯ä¾èµ–è¿›è¡Œçš„å¤„ç†ï¼Œæ¯”å¦‚Aå’ŒBéƒ½æ˜¯ä»¥åŸå‹æ¨¡å¼è¿›è¡Œåˆ›å»ºï¼Œè€ŒAä¸­éœ€è¦æ³¨å…¥Bï¼ŒBä¸­éœ€è¦æ³¨å…¥Aï¼Œè¿™æ—¶å°±ä¼šå‡ºç°Aè¿˜æœªåˆ›å»ºå®Œæˆï¼Œå°±éœ€è¦Bï¼Œè€ŒBè¿™æ—¶ä¹Ÿæ²¡åˆ›å»ºå®Œæˆï¼Œå› ä¸ºBéœ€è¦Aï¼Œè€ŒAç­‰ç€Bï¼Œè¿™æ ·å°±åªèƒ½æ— é™å¾ªç¯ä¸‹å»äº†ï¼Œæ‰€ä»¥å°±å‡ºç°äº†å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼ˆåŒç†ï¼Œä¸€ä¸ªå¯¹è±¡ï¼Œå¤šä¸ªå¯¹è±¡ä¹Ÿä¼šå‡ºç°è¿™ç§æƒ…å†µï¼‰ä½†æ˜¯åœ¨å•ä¾‹æ¨¡å¼ä¸‹ï¼Œç”±äºæ¯ä¸ªBeanåªä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼ŒSpringå®Œå…¨æœ‰æœºä¼šå¤„ç†å¥½å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼Œåªéœ€è¦ä¸€ä¸ªæ­£ç¡®çš„èµ‹å€¼æ“ä½œå®ç°å¾ªç¯å³å¯ã€‚é‚£ä¹ˆå•ä¾‹æ¨¡å¼ä¸‹æ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜çš„å‘¢ï¼Ÿ</p>
<p><img src="https://pica.zhimg.com/80/v2-a426f1c897402e708f3781581211008f_1440w.jpg?source=1940ef5c" alt="img"></p>
<p>æˆ‘ä»¬å›åˆ°<code>getSingleton()</code>æ–¹æ³•ä¸­ï¼Œå•ä¾‹æ¨¡å¼æ˜¯å¯ä»¥è‡ªåŠ¨è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">getSingleton</span><span class="params">(String beanName, <span class="type">boolean</span> allowEarlyReference)</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">singletonObject</span> <span class="operator">=</span> <span class="built_in">this</span>.singletonObjects.get(beanName);</span><br><span class="line">  	<span class="comment">//å…ˆä»ç¬¬ä¸€å±‚åˆ—è¡¨ä¸­æ‹¿Beanå®ä¾‹ï¼Œæ‹¿åˆ°ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (singletonObject == <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">      	<span class="comment">//ç¬¬ä¸€å±‚æ‹¿ä¸åˆ°ï¼Œå¹¶ä¸”å·²ç»è®¤å®šä¸ºå¤„äºå¾ªç¯çŠ¶æ€ï¼Œçœ‹çœ‹ç¬¬äºŒå±‚æœ‰æ²¡æœ‰</span></span><br><span class="line">        singletonObject = <span class="built_in">this</span>.earlySingletonObjects.get(beanName);</span><br><span class="line">        <span class="keyword">if</span> (singletonObject == <span class="literal">null</span> &amp;&amp; allowEarlyReference) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(<span class="built_in">this</span>.singletonObjects) &#123;</span><br><span class="line">              	<span class="comment">//åŠ é”å†æ‰§è¡Œä¸€æ¬¡ä¸Šè¿°æµç¨‹</span></span><br><span class="line">                singletonObject = <span class="built_in">this</span>.singletonObjects.get(beanName);</span><br><span class="line">                <span class="keyword">if</span> (singletonObject == <span class="literal">null</span>) &#123;</span><br><span class="line">                    singletonObject = <span class="built_in">this</span>.earlySingletonObjects.get(beanName);</span><br><span class="line">                    <span class="keyword">if</span> (singletonObject == <span class="literal">null</span>) &#123;</span><br><span class="line">                      	<span class="comment">//ä»ç„¶æ²¡æœ‰è·å–åˆ°å®ä¾‹ï¼Œåªèƒ½ä»singletonFactoryä¸­è·å–äº†</span></span><br><span class="line">                        ObjectFactory&lt;?&gt; singletonFactory = (ObjectFactory)<span class="built_in">this</span>.singletonFactories.get(beanName);</span><br><span class="line">                        <span class="keyword">if</span> (singletonFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">                            singletonObject = singletonFactory.getObject();</span><br><span class="line">                          	<span class="comment">//ä¸¢è¿›earlySingletonObjectsä¸­ï¼Œä¸‹æ¬¡å°±å¯ä»¥ç›´æ¥åœ¨ç¬¬äºŒå±‚æ‹¿åˆ°äº†</span></span><br><span class="line">                            <span class="built_in">this</span>.earlySingletonObjects.put(beanName, singletonObject);</span><br><span class="line">                            <span class="built_in">this</span>.singletonFactories.remove(beanName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> singletonObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œå®é™…ä¸Šå®ƒä½¿ç”¨äº†ä¸‰å±‚åˆ—è¡¨çš„æ–¹å¼æ¥å¤„ç†å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚åŒ…æ‹¬ï¼š</p>
<ul>
<li>singletonObjects</li>
<li>earlySingletonObjects</li>
<li>singletonFactories</li>
</ul>
<p>å½“ç¬¬ä¸€å±‚æ‹¿ä¸åˆ°æ—¶ï¼Œä¼šæ¥ç€åˆ¤æ–­è¿™ä¸ªBeanæ˜¯å¦å¤„äºåˆ›å»ºçŠ¶æ€<code>isSingletonCurrentlyInCreation()</code>ï¼Œå®ƒä¼šä»ä¸€ä¸ªSeté›†åˆä¸­æŸ¥è¯¢ï¼Œè¿™ä¸ªé›†åˆä¸­å­˜å‚¨äº†å·²ç»åˆ›å»ºä½†è¿˜æœªæ³¨å…¥å±æ€§çš„å®ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¤„äºæ­£åœ¨åˆ›å»ºçŠ¶æ€ï¼Œå¦‚æœè¯´å‘ç°æ­¤Beanå¤„äºæ­£åœ¨åˆ›å»ºçŠ¶æ€ï¼ˆä¸€å®šæ˜¯å› ä¸ºæŸä¸ªBeanéœ€è¦æ³¨å…¥è¿™ä¸ªBeançš„å®ä¾‹ï¼‰ï¼Œå°±å¯ä»¥æ–­å®šå®ƒåº”è¯¥æ˜¯å‡ºç°äº†å¾ªç¯ä¾èµ–çš„æƒ…å†µã€‚</p>
<p>earlySingletonObjectsç›¸å½“äºæ˜¯ä¸“é—¨å¤„ç†å¾ªç¯ä¾èµ–çš„è¡¨ï¼Œä¸€èˆ¬åŒ…å«singletonObjectsä¸­çš„å…¨éƒ¨å®ä¾‹ï¼Œå¦‚æœè¿™ä¸ªé‡Œé¢è¿˜æ˜¯æ²¡æœ‰ï¼Œæ¥ç€å¾€ä¸‹èµ°ï¼Œè¿™æ—¶ä¼šä»singletonFactoriesä¸­è·å–ï¼ˆæ‰€æœ‰çš„Beanåˆå§‹åŒ–å®Œæˆä¹‹åéƒ½ä¼šè¢«ä¸¢è¿›singletonFactoriesï¼Œä¹Ÿå°±æ˜¯åªåˆ›å»ºäº†ï¼Œä½†æ˜¯è¿˜æ²¡è¿›è¡Œä¾èµ–æ³¨å…¥çš„æ—¶å€™ï¼‰åœ¨è·å–åˆ°åï¼Œå‘earlySingletonObjectsä¸­ä¸¢å…¥æ­¤Beançš„å®ä¾‹ï¼Œå¹¶å°†å®ä¾‹ä»singletonFactoriesä¸­ç§»é™¤ã€‚</p>
<p>æˆ‘ä»¬æœ€åå†æ¥æ¢³ç†ä¸€ä¸‹æµç¨‹ï¼Œè¿˜æ˜¯ç”¨æˆ‘ä»¬åˆšæ‰çš„ä¾‹å­ï¼ŒAä¾èµ–äºBï¼ŒBä¾èµ–äºAï¼š</p>
<ol>
<li>å‡å¦‚Aå…ˆè½½å…¥ï¼Œé‚£ä¹ˆAé¦–å…ˆè¿›å…¥äº†singletonFactoriesä¸­ï¼Œæ³¨æ„è¿™æ—¶è¿˜æ²¡è¿›è¡Œä¾èµ–æ³¨å…¥ï¼ŒAä¸­çš„Bè¿˜æ˜¯null<ul>
<li>singletonFactoriesï¼šA</li>
<li>earlySingletonObjectsï¼š</li>
<li>singletonObjectsï¼š</li>
</ul>
</li>
<li>æ¥ç€è‚¯å®šæ˜¯æ³¨å…¥Açš„ä¾èµ–Bäº†ï¼Œä½†æ˜¯Bè¿˜æ²¡åˆå§‹åŒ–ï¼Œå› æ­¤ç°åœ¨å…ˆæŠŠBç»™è½½å…¥äº†ï¼ŒBæ„é€ å®Œæˆåä¹Ÿè¿›äº†singletonFactories<ul>
<li>singletonFactoriesï¼šAï¼ŒB</li>
<li>earlySingletonObjectsï¼š</li>
<li>singletonObjectsï¼š</li>
</ul>
</li>
<li>å¼€å§‹ä¸ºBæ³¨å…¥ä¾èµ–ï¼Œå‘ç°Bä¾èµ–äºAï¼Œè¿™æ—¶åˆå¾—å»è·å–Açš„å®ä¾‹ï¼Œæ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œè¿™æ—¶å€™Aè¿˜åœ¨singletonFactoriesä¸­ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«ä¸¢è¿›earlySingletonObjectsï¼Œç„¶åä»singletonFactoriesä¸­ç§»é™¤ï¼Œç„¶åè¿”å›Açš„å®ä¾‹ï¼ˆæ³¨æ„æ­¤æ—¶Aä¸­çš„Bä¾èµ–è¿˜æ˜¯nullï¼‰<ul>
<li>singletonFactoriesï¼šB</li>
<li>earlySingletonObjectsï¼šA</li>
<li>singletonObjectsï¼š</li>
</ul>
</li>
<li>è¿™æ—¶Bå·²ç»å®Œæˆä¾èµ–æ³¨å…¥äº†ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä¸¢è¿›singletonObjectsä¸­<ul>
<li>singletonFactoriesï¼š</li>
<li>earlySingletonObjectsï¼šA</li>
<li>singletonObjectsï¼šB</li>
</ul>
</li>
<li>ç„¶åå†å°†Bæ³¨å…¥åˆ°Aä¸­ï¼Œå®ŒæˆAçš„ä¾èµ–æ³¨å…¥ï¼ŒAä¹Ÿè¢«ä¸¢è¿›singletonObjectsä¸­ï¼Œè‡³æ­¤å¾ªç¯ä¾èµ–å®Œæˆï¼ŒAå’ŒBå®Œæˆå®ä¾‹åˆ›å»º<ul>
<li>singletonFactoriesï¼š</li>
<li>earlySingletonObjectsï¼š</li>
<li>singletonObjectsï¼šAï¼ŒB</li>
</ul>
</li>
</ol>
<p>ç»è¿‡æ•´ä½“è¿‡ç¨‹æ¢³ç†ï¼Œå…³äºSpringå¦‚ä½•è§£å†³å•ä¾‹æ¨¡å¼çš„å¾ªç¯ä¾èµ–ç†è§£èµ·æ¥å°±éå¸¸ç®€å•äº†ã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬å›åˆ°ä¹‹å‰çš„åœ°æ–¹ï¼ŒåŸå‹æ¨¡å¼ä¸‹å¦‚æœå‡ºç°å¾ªç¯ä¾èµ–ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šæ¥ç€å‘ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//BeanFactoryå­˜åœ¨çˆ¶å­å…³ç³»</span></span><br><span class="line"><span class="type">BeanFactory</span> <span class="variable">parentBeanFactory</span> <span class="operator">=</span> <span class="built_in">this</span>.getParentBeanFactory();</span><br><span class="line"><span class="comment">//å¦‚æœå­˜åœ¨çˆ¶BeanFactoryï¼ŒåŒæ—¶å½“å‰BeanFactoryæ²¡æœ‰è¿™ä¸ªBeançš„å®šä¹‰</span></span><br><span class="line"><span class="keyword">if</span> (parentBeanFactory != <span class="literal">null</span> &amp;&amp; !<span class="built_in">this</span>.containsBeanDefinition(beanName)) &#123;</span><br><span class="line">  	<span class="comment">//è¿™é‡Œæ˜¯å› ä¸ºBeanå¯èƒ½æœ‰åˆ«åï¼Œæ‰¾æœ€åŸå§‹çš„é‚£ä¸ªåç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">nameToLookup</span> <span class="operator">=</span> <span class="built_in">this</span>.originalBeanName(name);</span><br><span class="line">    <span class="keyword">if</span> (parentBeanFactory <span class="keyword">instanceof</span> AbstractBeanFactory) &#123;</span><br><span class="line">      	<span class="comment">//å‘çˆ¶BeanFactoryé€’å½’æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">return</span> ((AbstractBeanFactory)parentBeanFactory).doGetBean(nameToLookup, requiredType, args, typeCheckOnly);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (args != <span class="literal">null</span>) &#123;</span><br><span class="line">      	<span class="comment">//æ ¹æ®å‚æ•°æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">return</span> parentBeanFactory.getBean(nameToLookup, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (requiredType != <span class="literal">null</span>) &#123;</span><br><span class="line">      	<span class="comment">//æ ¹æ®ç±»å‹æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">return</span> parentBeanFactory.getBean(nameToLookup, requiredType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//å„ç§æ‰¾</span></span><br><span class="line">    <span class="keyword">return</span> parentBeanFactory.getBean(nameToLookup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒBeanFactoryä¼šå…ˆçœ‹å½“å‰æ˜¯å¦å­˜åœ¨Beançš„å®šä¹‰ï¼Œå¦‚æœæ²¡æœ‰ä¼šç›´æ¥ç”¨çˆ¶BeanFactoryå„ç§æ‰¾ã€‚è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªæ–°çš„æ¥å£<code>BeanDefinition</code>ï¼Œæ—¢ç„¶å·¥å‚éœ€è¦ç”Ÿäº§å•†å“ï¼Œé‚£ä¹ˆè‚¯å®šéœ€è¦æ‹¿åˆ°å•†å“çš„åŸææ–™ä»¥åŠåˆ¶ä½œé…æ–¹ï¼Œæˆ‘ä»¬çš„Beanä¹Ÿæ˜¯è¿™æ ·ï¼ŒBeanå·¥å‚éœ€è¦æ‹¿åˆ°Beançš„ä¿¡æ¯æ‰å¯ä»¥å»ç”Ÿæˆè¿™ä¸ªBeançš„å®ä¾‹å¯¹è±¡ï¼Œè€Œ<code>BeanDefinition</code>å°±æ˜¯ç”¨äºå­˜æ”¾Beançš„ä¿¡æ¯çš„ï¼Œæ‰€æœ‰çš„Beanä¿¡æ¯æ­£æ˜¯ä»XMLé…ç½®æ–‡ä»¶è¯»å–æˆ–æ˜¯æ³¨è§£æ‰«æåå¾—åˆ°çš„ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œå¦‚æœæ­¤BeanFactoryä¸å­˜åœ¨çˆ¶BeanFactoryæˆ–æ˜¯åŒ…å«äº†Beançš„å®šä¹‰ï¼Œé‚£ä¹ˆä¼šæ¥ç€å¾€ä¸‹èµ°ï¼Œè¿™æ—¶åªèƒ½è‡ªå·±åˆ›å»ºBeanäº†ï¼Œé¦–å…ˆä¼šæ‹¿åˆ°ä¸€ä¸ª<code>RootBeanDefinition</code>å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (requiredType != <span class="literal">null</span>) &#123;</span><br><span class="line">        beanCreation.tag(<span class="string">&quot;beanType&quot;</span>, requiredType::toString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">RootBeanDefinition</span> <span class="variable">mbd</span> <span class="operator">=</span> <span class="built_in">this</span>.getMergedLocalBeanDefinition(beanName);</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„å†…å®¹å°±éå¸¸å¤æ‚äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå®ƒä¸€å®šæ˜¯æ ¹æ®å¯¹åº”çš„ç±»å‹ï¼ˆå•ä¾‹ã€åŸå‹ï¼‰è¿›è¡Œäº†å¯¹åº”çš„å¤„ç†ï¼Œæœ€åè‡ªè¡Œåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡è¿”å›ã€‚ä¸€ä¸ªBeançš„åŠ è½½æµç¨‹ä¸ºï¼š</p>
<p>é¦–å…ˆæ‹¿åˆ°<code>BeanDefinition</code>å®šä¹‰ï¼Œé€‰æ‹©å¯¹åº”çš„æ„é€ æ–¹æ³•ï¼Œé€šè¿‡åå°„è¿›è¡Œå®ä¾‹åŒ–ï¼Œç„¶åè¿›è¡Œå±æ€§å¡«å……ï¼ˆä¾èµ–æ³¨å…¥ï¼‰ï¼Œå®Œæˆä¹‹åå†è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ï¼ˆinit-methodï¼‰ï¼Œæœ€åå¦‚æœå­˜åœ¨AOPï¼Œåˆ™ä¼šç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œæœ€åè¿”å›çš„æ‰æ˜¯æˆ‘ä»¬çœŸæ­£å¾—åˆ°çš„Beanå¯¹è±¡ã€‚</p>
<p>æœ€åè®©æˆ‘ä»¬å›åˆ°<code>ApplicationContext</code>ä¸­ï¼Œå®é™…ä¸Šï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå¼ºåŒ–ç‰ˆçš„<code>BeanFactory</code>ï¼Œåœ¨æœ€åŸºæœ¬çš„Beanç®¡ç†åŸºç¡€ä¸Šï¼Œè¿˜æ·»åŠ äº†ï¼š</p>
<ul>
<li>å›½é™…åŒ–ï¼ˆMessageSourceï¼‰</li>
<li>è®¿é—®èµ„æºï¼Œå¦‚URLå’Œæ–‡ä»¶ï¼ˆResourceLoaderï¼‰</li>
<li>è½½å…¥å¤šä¸ªï¼ˆæœ‰ç»§æ‰¿å…³ç³»ï¼‰ä¸Šä¸‹æ–‡ </li>
<li>æ¶ˆæ¯å‘é€ã€å“åº”æœºåˆ¶ï¼ˆApplicationEventPublisherï¼‰</li>
<li>AOPæœºåˆ¶</li>
</ul>
<p>æˆ‘ä»¬å‘ç°ï¼Œæ— è®ºæ˜¯è¿˜æ˜¯çš„æ„é€ æ–¹æ³•ä¸­éƒ½ä¼šè°ƒç”¨<code>refresh()</code>æ–¹æ³•æ¥åˆ·æ–°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AnnotationConfigApplicationContext</span><span class="params">(Class&lt;?&gt;... componentClasses)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>();</span><br><span class="line">    <span class="built_in">this</span>.register(componentClasses);</span><br><span class="line">    <span class="built_in">this</span>.refresh();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ–¹æ³•åœ¨è®²è§£å®ŒAOPåŸç†ä¹‹åï¼Œå†è¿›è¡Œè®²è§£ã€‚ç»¼ä¸Šï¼Œæœ‰å…³IoCå®¹å™¨çš„å¤§éƒ¨åˆ†åŸç†å°±è®²è§£å®Œæ¯•äº†ã€‚</p>
<h3 id="æ¢ç©¶AOPåŸç†"><a href="#æ¢ç©¶AOPåŸç†" class="headerlink" title="æ¢ç©¶AOPåŸç†"></a>æ¢ç©¶AOPåŸç†</h3><p>å‰é¢æˆ‘ä»¬æåˆ°äº†<code>PostProcessor</code>ï¼Œå®ƒå…¶å®æ˜¯Springæä¾›çš„ä¸€ç§åç½®å¤„ç†æœºåˆ¶ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬èƒ½å¤Ÿæ’æ‰‹Beanã€BeanFactoryã€BeanDefinitionçš„åˆ›å»ºè¿‡ç¨‹ï¼Œç›¸å½“äºè¿›è¡Œä¸€ä¸ªæœ€ç»ˆçš„å¤„ç†ï¼Œè€Œæœ€åå¾—åˆ°çš„ç»“æœï¼ˆæ¯”å¦‚Beanå®ä¾‹ã€Beanå®šä¹‰ç­‰ï¼‰å°±æ˜¯ç»è¿‡åç½®å¤„ç†å™¨è¿”å›çš„ç»“æœï¼Œå®ƒæ˜¯æ•´ä¸ªåŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ã€‚</p>
<p>è€ŒAOPæœºåˆ¶æ­£æ˜¯é€šè¿‡å®ƒæ¥å®ç°çš„ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥è®¤è¯†ä¸€ä¸‹ç¬¬ä¸€ä¸ªæ¥å£<code>BeanPostProcessor</code>ï¼Œå®ƒç›¸å½“äºBeanåˆå§‹åŒ–çš„ä¸€ä¸ªåç½®åŠ¨ä½œï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å®ç°æ­¤æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ³¨æ„å®ƒåç½®å¤„ç†å™¨ä¹Ÿè¦è¿›è¡Œæ³¨å†Œ</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBeanProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(beanName);  <span class="comment">//æ‰“å°beançš„åç§°</span></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> BeanPostProcessor.<span class="built_in">super</span>.postProcessBeforeInitialization(bean, beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œæ­¤æ¥å£ä¸­åŒ…æ‹¬ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯<code>postProcessAfterInitialization</code>ç”¨äºåœ¨Beanåˆå§‹åŒ–ä¹‹åè¿›è¡Œå¤„ç†ï¼Œè¿˜æœ‰ä¸€ä¸ª<code>postProcessBeforeInitialization</code>ç”¨äºåœ¨Beanåˆå§‹åŒ–ä¹‹å‰è¿›è¡Œå¤„ç†ï¼Œæ³¨æ„è¿™é‡Œçš„åˆå§‹åŒ–ä¸æ˜¯åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯è°ƒç”¨ç±»çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBeanProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯ä¹‹åï¼š&quot;</span>+beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;   <span class="comment">//è¿™é‡Œè¿”å›çš„Beanç›¸å½“äºæœ€ç»ˆçš„ç»“æœäº†ï¼Œæˆ‘ä»¬ä¾ç„¶èƒ½å¤Ÿæ’æ‰‹ä¿®æ”¹ï¼Œè¿™é‡Œè¿”å›ä¹‹åæ˜¯ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆäº†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯ä¹‹å‰ï¼š&quot;</span>+beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;   <span class="comment">//è¿™é‡Œè¿”å›çš„Beanä¼šäº¤ç»™ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">TestService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TestServiceImpl</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯æ„é€ æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯åˆå§‹åŒ–æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TestMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMapper</span><span class="params">(TestMapper mapper)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯ä¾èµ–æ³¨å…¥&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.mapper = mapper;</span><br><span class="line">    &#125;</span><br><span class="line">  	</span><br><span class="line">  	...</span><br></pre></td></tr></table></figure>

<p>è€ŒTestServiceImplçš„åŠ è½½é¡ºåºä¸ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">æˆ‘æ˜¯æ„é€ æ–¹æ³•</span><br><span class="line">æˆ‘æ˜¯ä¾èµ–æ³¨å…¥</span><br><span class="line">æˆ‘æ˜¯ä¹‹å‰ï¼štestServiceImpl</span><br><span class="line">æˆ‘æ˜¯åˆå§‹åŒ–æ–¹æ³•</span><br><span class="line">æˆ‘æ˜¯ä¹‹åï¼štestServiceImpl</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å†æ¥æ€»ç»“ä¸€ä¸‹ä¸€ä¸ªBeançš„åŠ è½½æµç¨‹ï¼š</p>
<p>[Beanå®šä¹‰]é¦–å…ˆæ‰«æBeanï¼ŒåŠ è½½Beanå®šä¹‰ -&gt; [ä¾èµ–æ³¨å…¥]æ ¹æ®Beanå®šä¹‰é€šè¿‡åå°„åˆ›å»ºBeanå®ä¾‹ -&gt; [ä¾èµ–æ³¨å…¥]è¿›è¡Œä¾èµ–æ³¨å…¥ï¼ˆé¡ºä¾¿è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼‰-&gt; [åˆå§‹åŒ–Bean]BeanPostProcessorçš„åˆå§‹åŒ–ä¹‹å‰æ–¹æ³• -&gt; [åˆå§‹åŒ–Bean]Beanåˆå§‹åŒ–æ–¹æ³• -&gt; [åˆå§‹åŒ–Bean]BeanPostProcessorçš„åˆå§‹åŒ–ä¹‹å‰åæ–¹æ³• -&gt; [å®Œæˆ]æœ€ç»ˆå¾—åˆ°çš„BeanåŠ è½½å®Œæˆçš„å®ä¾‹</p>
<p>åˆ©ç”¨è¿™ç§æœºåˆ¶ï¼Œç†è§£Aopçš„å®ç°è¿‡ç¨‹å°±éå¸¸ç®€å•äº†ï¼ŒAOPå®é™…ä¸Šä¹Ÿæ˜¯é€šè¿‡è¿™ç§æœºåˆ¶å®ç°çš„ï¼Œå®ƒçš„å®ç°ç±»æ˜¯<code>AnnotationAwareAspectJAutoProxyCreator</code>ï¼Œè€Œå®ƒå°±æ˜¯åœ¨æœ€åå¯¹Beanè¿›è¡Œäº†ä»£ç†ï¼Œå› æ­¤æœ€åæˆ‘ä»¬å¾—åˆ°çš„ç»“æœå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†çš„å¯¹è±¡ï¼ˆæœ‰å…³è¯¦ç»†å®ç°è¿‡ç¨‹ï¼Œè¿™é‡Œå°±ä¸è¿›è¡Œåˆ—ä¸¾äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç»§ç»­æ·±å…¥ï¼‰</p>
<p>é‚£ä¹ˆè‚¯å®šæœ‰äººæœ‰ç–‘é—®äº†ï¼Œè¿™ä¸ªç±»æ²¡æœ‰è¢«æ³¨å†Œå•Šï¼Œé‚£æŒ‰ç†è¯´å®ƒä¸åº”è¯¥å‚ä¸åˆ°Beançš„åˆå§‹åŒ–æµç¨‹ä¸­çš„ï¼Œä¸ºä»€ä¹ˆå®ƒç›´æ¥å°±è¢«åŠ è½½äº†å‘¢ï¼Ÿ</p>
<p>è¿˜è®°å¾—<code>@EnableAspectJAutoProxy</code>å—ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®šä¹‰å°±çŸ¥é“äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(&#123;AspectJAutoProxyRegistrar.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAspectJAutoProxy &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">proxyTargetClass</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">exposeProxy</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°å®ƒä½¿ç”¨äº†<code>@Import</code>æ¥æ³¨å†Œ<code>AspectJAutoProxyRegistrar</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AspectJAutoProxyRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line">    AspectJAutoProxyRegistrar() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">      	<span class="comment">//æ³¨å†ŒAnnotationAwareAspectJAutoProxyCreatoråˆ°å®¹å™¨ä¸­</span></span><br><span class="line">        AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary(registry);</span><br><span class="line">        <span class="type">AnnotationAttributes</span> <span class="variable">enableAspectJAutoProxy</span> <span class="operator">=</span> AnnotationConfigUtils.attributesFor(importingClassMetadata, EnableAspectJAutoProxy.class);</span><br><span class="line">        <span class="keyword">if</span> (enableAspectJAutoProxy != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (enableAspectJAutoProxy.getBoolean(<span class="string">&quot;proxyTargetClass&quot;</span>)) &#123;</span><br><span class="line">                AopConfigUtils.forceAutoProxyCreatorToUseClassProxying(registry);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (enableAspectJAutoProxy.getBoolean(<span class="string">&quot;exposeProxy&quot;</span>)) &#123;</span><br><span class="line">                AopConfigUtils.forceAutoProxyCreatorToExposeProxy(registry);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒå®ç°äº†æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¹Ÿæ˜¯Springæä¾›çš„ä¸€ç§BeanåŠ è½½æœºåˆ¶ï¼Œå®ƒæ”¯æŒç›´æ¥å‘å®¹å™¨ä¸­æ·»åŠ Beanå®šä¹‰ï¼Œå®¹å™¨ä¹Ÿä¼šåŠ è½½è¿™ä¸ªBeanï¼š</p>
<ul>
<li>ImportBeanDefinitionRegistrarç±»åªèƒ½é€šè¿‡å…¶ä»–ç±»@Importçš„æ–¹å¼æ¥åŠ è½½ï¼Œé€šå¸¸æ˜¯å¯åŠ¨ç±»æˆ–é…ç½®ç±»ã€‚</li>
<li>ä½¿ç”¨@Importï¼Œå¦‚æœæ‹¬å·ä¸­çš„ç±»æ˜¯ImportBeanDefinitionRegistrarçš„å®ç°ç±»ï¼Œåˆ™ä¼šè°ƒç”¨æ¥å£ä¸­æ–¹æ³•ï¼ˆä¸€èˆ¬ç”¨äºæ³¨å†ŒBeanï¼‰</li>
<li>å®ç°è¯¥æ¥å£çš„ç±»æ‹¥æœ‰æ³¨å†Œbeançš„èƒ½åŠ›ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ­¤æ¥å£æä¾›äº†ä¸€ä¸ª<code>BeanDefinitionRegistry</code>æ­£æ˜¯ç”¨äºæ³¨å†ŒBeançš„å®šä¹‰çš„ã€‚</p>
<p>å› æ­¤ï¼Œå½“æˆ‘ä»¬æ‰“ä¸Šäº†<code>@EnableAspectJAutoProxy</code>æ³¨è§£ä¹‹åï¼Œé¦–å…ˆä¼šé€šè¿‡<code>@Import</code>åŠ è½½AspectJAutoProxyRegistrarï¼Œç„¶åè°ƒç”¨å…¶<code>registerBeanDefinitions</code>æ–¹æ³•ï¼Œç„¶åä½¿ç”¨å·¥å…·ç±»æ³¨å†ŒAnnotationAwareAspectJAutoProxyCreatoråˆ°å®¹å™¨ä¸­ï¼Œè¿™æ ·åœ¨æ¯ä¸ªBeanåˆ›å»ºä¹‹åï¼Œå¦‚æœéœ€è¦ä½¿ç”¨AOPï¼Œé‚£ä¹ˆå°±ä¼šé€šè¿‡AOPçš„åç½®å¤„ç†å™¨è¿›è¡Œå¤„ç†ï¼Œæœ€åè¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•ç¼–å†™ä¸€ä¸ªè‡ªå·±çš„ImportBeanDefinitionRegistrarå®ç°ï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ªæµ‹è¯•Beanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBean</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘è¢«åˆå§‹åŒ–äº†ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">definition</span> <span class="operator">=</span> BeanDefinitionBuilder.rootBeanDefinition(Student.class).getBeanDefinition();</span><br><span class="line">        registry.registerBeanDefinition(<span class="string">&quot;lbwnb&quot;</span>, definition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼ŒæˆåŠŸåŠ è½½Beanå®ä¾‹ã€‚</p>
<p>ä¸<code>BeanPostProcessor</code>å·®ä¸å¤šçš„è¿˜æœ‰<code>BeanFactoryPostProcessor</code>ï¼Œå®ƒå’Œå‰è€…ä¸€æ ·ï¼Œä¹Ÿæ˜¯ç”¨äºæˆ‘ä»¬è‡ªå·±å¤„ç†åç½®åŠ¨ä½œçš„ï¼Œä¸è¿‡è¿™é‡Œæ˜¯ç”¨äºå¤„ç†BeanFactoryåŠ è½½çš„åç½®åŠ¨ä½œï¼Œ<code>BeanDefinitionRegistryPostProcessor</code>ç›´æ¥ç»§æ‰¿è‡ª<code>BeanFactoryPostProcessor</code>ï¼Œå¹¶ä¸”è¿˜æ·»åŠ äº†æ–°çš„åŠ¨ä½œ<code>postProcessBeanDefinitionRegistry</code>ï¼Œä½ å¯ä»¥åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ Beanå®šä¹‰æˆ–æ˜¯ä¿®æ”¹å·²ç»å­˜åœ¨çš„Beanå®šä¹‰ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ç›´æ¥æ¼”ç¤º<code>BeanDefinitionRegistryPostProcessor</code>çš„å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDefinitionProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯Beanå®šä¹‰åç½®å¤„ç†ï¼&quot;</span>);</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">definition</span> <span class="operator">=</span> BeanDefinitionBuilder.rootBeanDefinition(TestBean.class).getBeanDefinition();</span><br><span class="line">        registry.registerBeanDefinition(<span class="string">&quot;lbwnb&quot;</span>, definition);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯Beanå·¥å‚åç½®å¤„ç†ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæ³¨å†ŒBeanå®šä¹‰å…¶å®å’Œä¹‹å‰é‚£ç§æ–¹æ³•æ•ˆæœä¸€æ ·ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å†å®Œå–„ä¸€ä¸‹BeanåŠ è½½æµç¨‹ï¼ˆåŠ ç²—éƒ¨åˆ†æ˜¯æ–°å¢çš„ï¼‰ï¼š</p>
<p>[Beanå®šä¹‰]é¦–å…ˆæ‰«æBeanï¼ŒåŠ è½½Beanå®šä¹‰ -&gt; <strong>[Beanå®šä¹‰]Beanå®šä¹‰å’ŒBeanå·¥å‚åç½®å¤„ç†</strong> -&gt; [ä¾èµ–æ³¨å…¥]æ ¹æ®Beanå®šä¹‰é€šè¿‡åå°„åˆ›å»ºBeanå®ä¾‹ -&gt; [ä¾èµ–æ³¨å…¥]è¿›è¡Œä¾èµ–æ³¨å…¥ï¼ˆé¡ºä¾¿è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼‰-&gt; [åˆå§‹åŒ–Bean]BeanPostProcessorçš„åˆå§‹åŒ–ä¹‹å‰æ–¹æ³• -&gt; [åˆå§‹åŒ–Bean]Beanåˆå§‹åŒ–æ–¹æ³• -&gt; [åˆå§‹åŒ–Bean]BeanPostProcessorçš„åˆå§‹åŒ–ä¹‹å‰åæ–¹æ³• -&gt; [å®Œæˆ]æœ€ç»ˆå¾—åˆ°çš„BeanåŠ è½½å®Œæˆçš„å®ä¾‹</p>
<p>æœ€åæˆ‘ä»¬å†æ¥ç ”ç©¶ä¸€ä¸‹ApplicationContextä¸­çš„<code>refresh()</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="built_in">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">        <span class="type">StartupStep</span> <span class="variable">contextRefresh</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.refresh&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.prepareRefresh();</span><br><span class="line">        <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="built_in">this</span>.obtainFreshBeanFactory();</span><br><span class="line">      	<span class="comment">//åˆå§‹åŒ–Beanå·¥å‚</span></span><br><span class="line">        <span class="built_in">this</span>.prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.postProcessBeanFactory(beanFactory);</span><br><span class="line">            <span class="type">StartupStep</span> <span class="variable">beanPostProcess</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.beans.post-process&quot;</span>);</span><br><span class="line">          	<span class="comment">//è°ƒç”¨æ‰€æœ‰çš„Beanå·¥å‚ã€Beanæ³¨å†Œåç½®å¤„ç†å™¨</span></span><br><span class="line">            <span class="built_in">this</span>.invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">          	<span class="comment">//æ³¨å†ŒBeanåç½®å¤„ç†å™¨ï¼ˆåŒ…æ‹¬Springå†…éƒ¨çš„ï¼‰</span></span><br><span class="line">            <span class="built_in">this</span>.registerBeanPostProcessors(beanFactory);</span><br><span class="line">            beanPostProcess.end();</span><br><span class="line">          	<span class="comment">//å›½é™…åŒ–æ”¯æŒ</span></span><br><span class="line">            <span class="built_in">this</span>.initMessageSource();</span><br><span class="line">          	<span class="comment">//ç›‘å¬å’Œäº‹ä»¶å¹¿æ’­</span></span><br><span class="line">            <span class="built_in">this</span>.initApplicationEventMulticaster();</span><br><span class="line">            <span class="built_in">this</span>.onRefresh();</span><br><span class="line">            <span class="built_in">this</span>.registerListeners();</span><br><span class="line">          	<span class="comment">//å®ä¾‹åŒ–æ‰€æœ‰çš„Bean</span></span><br><span class="line">            <span class="built_in">this</span>.finishBeanFactoryInitialization(beanFactory);</span><br><span class="line">            <span class="built_in">this</span>.finishRefresh();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BeansException var10) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isWarnEnabled()) &#123;</span><br><span class="line">                <span class="built_in">this</span>.logger.warn(<span class="string">&quot;Exception encountered during context initialization - cancelling refresh attempt: &quot;</span> + var10);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.destroyBeans();</span><br><span class="line">            <span class="built_in">this</span>.cancelRefresh(var10);</span><br><span class="line">            <span class="keyword">throw</span> var10;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.resetCommonCaches();</span><br><span class="line">            contextRefresh.end();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ç»™è¿™äº›éƒ¨åˆ†åˆ†åˆ«æ‰“ä¸Šæ–­ç‚¹æ¥è§‚å¯Ÿä¸€ä¸‹æ­¤æ–¹æ³•çš„æ•´ä½“åŠ è½½æµç¨‹ã€‚</p>
<h3 id="Mybatisæ•´åˆåŸç†"><a href="#Mybatisæ•´åˆåŸç†" class="headerlink" title="Mybatisæ•´åˆåŸç†"></a>Mybatisæ•´åˆåŸç†</h3><p>é€šè¿‡ä¹‹å‰çš„äº†è§£ï¼Œæˆ‘ä»¬å†æ¥çœ‹Mybatisçš„<code>@MapperScan</code>æ˜¯å¦‚ä½•å®ç°çš„ï¼Œç°åœ¨ç†è§£èµ·æ¥å°±éå¸¸ç®€å•äº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰“å¼€æŸ¥çœ‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(&#123;MapperScannerRegistrar.class&#125;)</span></span><br><span class="line"><span class="meta">@Repeatable(MapperScans.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MapperScan &#123;</span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] basePackages() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">  	...</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œå’ŒAopä¸€æ ·ï¼Œå®ƒä¹Ÿæ˜¯é€šè¿‡Registraræœºåˆ¶ï¼Œé€šè¿‡<code>@Import</code>æ¥è¿›è¡ŒBeançš„æ³¨å†Œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹<code>MapperScannerRegistrar</code>æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata annoMeta, AnnotationAttributes annoAttrs, BeanDefinitionRegistry registry, String beanName)</span> &#123;</span><br><span class="line">    <span class="type">BeanDefinitionBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> BeanDefinitionBuilder.genericBeanDefinition(MapperScannerConfigurer.class);</span><br><span class="line">    builder.addPropertyValue(<span class="string">&quot;processPropertyPlaceHolders&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationClass = annoAttrs.getClass(<span class="string">&quot;annotationClass&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!Annotation.class.equals(annotationClass)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;annotationClass&quot;</span>, annotationClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt; markerInterface = annoAttrs.getClass(<span class="string">&quot;markerInterface&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!Class.class.equals(markerInterface)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;markerInterface&quot;</span>, markerInterface);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">BeanNameGenerator</span>&gt; generatorClass = annoAttrs.getClass(<span class="string">&quot;nameGenerator&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!BeanNameGenerator.class.equals(generatorClass)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;nameGenerator&quot;</span>, BeanUtils.instantiateClass(generatorClass));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">MapperFactoryBean</span>&gt; mapperFactoryBeanClass = annoAttrs.getClass(<span class="string">&quot;factoryBean&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!MapperFactoryBean.class.equals(mapperFactoryBeanClass)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;mapperFactoryBeanClass&quot;</span>, mapperFactoryBeanClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">sqlSessionTemplateRef</span> <span class="operator">=</span> annoAttrs.getString(<span class="string">&quot;sqlSessionTemplateRef&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(sqlSessionTemplateRef)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;sqlSessionTemplateBeanName&quot;</span>, annoAttrs.getString(<span class="string">&quot;sqlSessionTemplateRef&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">sqlSessionFactoryRef</span> <span class="operator">=</span> annoAttrs.getString(<span class="string">&quot;sqlSessionFactoryRef&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(sqlSessionFactoryRef)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span>, annoAttrs.getString(<span class="string">&quot;sqlSessionFactoryRef&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; basePackages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    basePackages.addAll((Collection)Arrays.stream(annoAttrs.getStringArray(<span class="string">&quot;value&quot;</span>)).filter(StringUtils::hasText).collect(Collectors.toList()));</span><br><span class="line">    basePackages.addAll((Collection)Arrays.stream(annoAttrs.getStringArray(<span class="string">&quot;basePackages&quot;</span>)).filter(StringUtils::hasText).collect(Collectors.toList()));</span><br><span class="line">    basePackages.addAll((Collection)Arrays.stream(annoAttrs.getClassArray(<span class="string">&quot;basePackageClasses&quot;</span>)).map(ClassUtils::getPackageName).collect(Collectors.toList()));</span><br><span class="line">    <span class="keyword">if</span> (basePackages.isEmpty()) &#123;</span><br><span class="line">        basePackages.add(getDefaultBasePackage(annoMeta));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">lazyInitialization</span> <span class="operator">=</span> annoAttrs.getString(<span class="string">&quot;lazyInitialization&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(lazyInitialization)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;lazyInitialization&quot;</span>, lazyInitialization);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">defaultScope</span> <span class="operator">=</span> annoAttrs.getString(<span class="string">&quot;defaultScope&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="string">&quot;&quot;</span>.equals(defaultScope)) &#123;</span><br><span class="line">        builder.addPropertyValue(<span class="string">&quot;defaultScope&quot;</span>, defaultScope);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    builder.addPropertyValue(<span class="string">&quot;basePackage&quot;</span>, StringUtils.collectionToCommaDelimitedString(basePackages));</span><br><span class="line">    registry.registerBeanDefinition(beanName, builder.getBeanDefinition());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶å¾ˆé•¿å¾ˆå¤šï¼Œä½†æ˜¯è¿™äº›ä»£ç éƒ½æ˜¯åœ¨æ·»åŠ ä¸€äº›Beanå®šä¹‰çš„å±æ€§ï¼Œè€Œæœ€å…³é”®çš„åˆ™æ˜¯æœ€ä¸Šæ–¹çš„<code>MapperScannerConfigurer</code>ï¼ŒMybatiså°†å…¶Beanä¿¡æ¯æ³¨å†Œåˆ°äº†å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»åˆæ˜¯å¹²å˜›çš„å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperScannerConfigurer</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span>, InitializingBean, ApplicationContextAware, BeanNameAware &#123;</span><br><span class="line">    <span class="keyword">private</span> String basePackage;</span><br></pre></td></tr></table></figure>

<p>å®ƒå®ç°äº†BeanDefinitionRegistryPostProcessorï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸ºBeanä¿¡æ¯åŠ è½½æä¾›äº†åç½®å¤„ç†ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹çœ‹å®ƒåœ¨Beanä¿¡æ¯åç½®å¤„ç†ä¸­åšäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.processPropertyPlaceHolders) &#123;</span><br><span class="line">        <span class="built_in">this</span>.processPropertyPlaceHolders();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//åˆå§‹åŒ–ç±»è·¯å¾„Mapperæ‰«æå™¨ï¼Œå®ƒç›¸å½“äºæ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œå¯ä»¥å¿«é€Ÿæ‰«æå‡ºæ•´ä¸ªåŒ…ä¸‹çš„ç±»å®šä¹‰ä¿¡æ¯</span></span><br><span class="line">  	<span class="comment">//ClassPathMapperScanneræ˜¯Mybatisè‡ªå·±å®ç°çš„ä¸€ä¸ªæ‰«æå™¨ï¼Œä¿®æ”¹äº†ä¸€äº›æ‰«æè§„åˆ™</span></span><br><span class="line">    <span class="type">ClassPathMapperScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathMapperScanner</span>(registry);</span><br><span class="line">    scanner.setAddToConfig(<span class="built_in">this</span>.addToConfig);</span><br><span class="line">    scanner.setAnnotationClass(<span class="built_in">this</span>.annotationClass);</span><br><span class="line">    scanner.setMarkerInterface(<span class="built_in">this</span>.markerInterface);</span><br><span class="line">    scanner.setSqlSessionFactory(<span class="built_in">this</span>.sqlSessionFactory);</span><br><span class="line">    scanner.setSqlSessionTemplate(<span class="built_in">this</span>.sqlSessionTemplate);</span><br><span class="line">    scanner.setSqlSessionFactoryBeanName(<span class="built_in">this</span>.sqlSessionFactoryBeanName);</span><br><span class="line">    scanner.setSqlSessionTemplateBeanName(<span class="built_in">this</span>.sqlSessionTemplateBeanName);</span><br><span class="line">    scanner.setResourceLoader(<span class="built_in">this</span>.applicationContext);</span><br><span class="line">    scanner.setBeanNameGenerator(<span class="built_in">this</span>.nameGenerator);</span><br><span class="line">    scanner.setMapperFactoryBeanClass(<span class="built_in">this</span>.mapperFactoryBeanClass);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(<span class="built_in">this</span>.lazyInitialization)) &#123;</span><br><span class="line">        scanner.setLazyInitialization(Boolean.valueOf(<span class="built_in">this</span>.lazyInitialization));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(<span class="built_in">this</span>.defaultScope)) &#123;</span><br><span class="line">        scanner.setDefaultScope(<span class="built_in">this</span>.defaultScope);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//æ·»åŠ è¿‡æ»¤å™¨ï¼Œè¿™é‡Œä¼šé…ç½®ä¸ºæ‰€æœ‰çš„æ¥å£éƒ½èƒ½è¢«æ‰«æï¼ˆå› æ­¤å³ä½¿ä½ ä¸æ·»åŠ @Mapperæ³¨è§£éƒ½èƒ½å¤Ÿè¢«æ‰«æå¹¶åŠ è½½ï¼‰</span></span><br><span class="line">    scanner.registerFilters();</span><br><span class="line">  	<span class="comment">//å¼€å§‹æ‰«æ</span></span><br><span class="line">    scanner.scan(StringUtils.tokenizeToStringArray(<span class="built_in">this</span>.basePackage, <span class="string">&quot;,; \t\n&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼€å§‹æ‰«æåï¼Œä¼šè°ƒç”¨<code>doScan()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼ˆè¿™æ˜¯<code>ClassPathMapperScanner</code>ä¸­çš„æ‰«ææ–¹æ³•ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">    Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="built_in">super</span>.doScan(basePackages);</span><br><span class="line">  	<span class="comment">//é¦–å…ˆä»åŒ…ä¸­æ‰«ææ‰€æœ‰çš„Beanå®šä¹‰</span></span><br><span class="line">    <span class="keyword">if</span> (beanDefinitions.isEmpty()) &#123;</span><br><span class="line">        LOGGER.warn(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No MyBatis mapper was found in &#x27;&quot;</span> + Arrays.toString(basePackages) + <span class="string">&quot;&#x27; package. Please check your configuration.&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      	<span class="comment">//å¤„ç†æ‰€æœ‰çš„Beanå®šä¹‰ï¼Œå®é™…ä¸Šå°±æ˜¯ç”Ÿæˆå¯¹åº”Mapperçš„ä»£ç†å¯¹è±¡ï¼Œå¹¶æ³¨å†Œåˆ°å®¹å™¨ä¸­</span></span><br><span class="line">        <span class="built_in">this</span>.processBeanDefinitions(beanDefinitions);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//æœ€åè¿”å›æ‰€æœ‰çš„Beanå®šä¹‰é›†åˆ</span></span><br><span class="line">    <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ–­ç‚¹æˆ‘ä»¬å‘ç°ï¼Œæœ€åå¤„ç†å¾—åˆ°çš„Beanå®šä¹‰å‘ç°æ­¤Beanæ˜¯ä¸€ä¸ªMapperFactoryBeanï¼Œå®ƒä¸åŒäºæ™®é€šçš„Beanï¼ŒFactoryBeanç›¸å½“äºä¸ºæ™®é€šçš„Beanæ·»åŠ äº†ä¸€å±‚å¤–å£³ï¼Œå®ƒå¹¶ä¸æ˜¯ä¾é Springç›´æ¥é€šè¿‡åå°„åˆ›å»ºï¼Œè€Œæ˜¯ä½¿ç”¨æ¥å£ä¸­çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">OBJECT_TYPE_ATTRIBUTE</span> <span class="operator">=</span> <span class="string">&quot;factoryBeanObjectType&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    Class&lt;?&gt; getObjectType();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡<code>getObject()</code>æ–¹æ³•ï¼Œå°±å¯ä»¥è·å–åˆ°Beançš„å®ä¾‹äº†ã€‚</p>
<p>æ³¨æ„è¿™é‡Œä¸€å®šè¦åŒºåˆ†FactoryBeanå’ŒBeanFactoryçš„æ¦‚å¿µï¼š</p>
<ul>
<li>BeanFactoryæ˜¯ä¸ªFactoryï¼Œä¹Ÿå°±æ˜¯ IOC å®¹å™¨æˆ–å¯¹è±¡å·¥å‚ï¼Œæ‰€æœ‰çš„ Bean éƒ½æ˜¯ç”± BeanFactory( ä¹Ÿå°±æ˜¯ IOC å®¹å™¨ ) æ¥è¿›è¡Œç®¡ç†ã€‚</li>
<li>FactoryBeanæ˜¯ä¸€ä¸ªèƒ½ç”Ÿäº§æˆ–è€…ä¿®é¥°ç”Ÿæˆå¯¹è±¡çš„å·¥å‚Bean(æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªBean)ï¼Œå¯ä»¥åœ¨BeanFactoryï¼ˆIOCå®¹å™¨ï¼‰ä¸­è¢«ç®¡ç†ï¼Œæ‰€ä»¥å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªç®€å•çš„Beanã€‚å½“ä½¿ç”¨å®¹å™¨ä¸­factory beançš„æ—¶å€™ï¼Œè¯¥å®¹å™¨ä¸ä¼šè¿”å›factory beanæœ¬èº«ï¼Œè€Œæ˜¯è¿”å›å…¶ç”Ÿæˆçš„å¯¹è±¡ã€‚è¦æƒ³è·å–FactoryBeançš„å®ç°ç±»æœ¬èº«ï¼Œå¾—åœ¨getBean(String BeanName)ä¸­çš„BeanNameä¹‹å‰åŠ ä¸Š&amp;,å†™æˆgetBean(String &amp;BeanName)ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™ä¸€ä¸ªå®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestFb</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Student&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Student <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è·å–äº†å­¦ç”Ÿ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> Student.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;é¡¹ç›®æ­£åœ¨å¯åŠ¨...&quot;</span>);</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(TestConfiguration.class);</span><br><span class="line">    System.out.println(context.getBean(<span class="string">&quot;&amp;test&quot;</span>));   <span class="comment">//å¾—åˆ°FactoryBeanæœ¬èº«ï¼ˆå¾—åŠ ä¸ª&amp;æå¾—åƒCè¯­è¨€æŒ‡é’ˆä¸€æ ·ï¼‰</span></span><br><span class="line">    System.out.println(context.getBean(<span class="string">&quot;test&quot;</span>));   <span class="comment">//å¾—åˆ°FactoryBeanè°ƒç”¨getObject()ä¹‹åçš„ç»“æœ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œå®é™…ä¸Šæˆ‘ä»¬çš„Mapperæœ€ç»ˆå°±ä»¥FactoryBeançš„å½¢å¼ï¼Œè¢«æ³¨å†Œåˆ°å®¹å™¨ä¸­è¿›è¡ŒåŠ è½½äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.getSqlSession().getMapper(<span class="built_in">this</span>.mapperInterface);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæ•´ä¸ªMybatisçš„<code>@MapperScan</code>çš„åŸç†å°±å…¨éƒ¨è§£é‡Šå®Œæ¯•äº†ã€‚</p>
<p>åœ¨äº†è§£å®Œäº†Springçš„åº•å±‚åŸç†ä¹‹åï¼Œæˆ‘ä»¬å…¶å®å·²ç»å®Œå…¨å¯ä»¥æ ¹æ®è¿™äº›å®ç°åŸç†æ¥æ‰‹å†™ä¸€ä¸ªSpringæ¡†æ¶äº†ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>SSM</tag>
      </tags>
  </entry>
  <entry>
    <title>MybatisåŠ¨æ€sql</title>
    <url>/2022/04/20/Mybatis%E5%8A%A8%E6%80%81sql/</url>
    <content><![CDATA[<ul>
<li><h3 id="æ˜¯å¦è‡ªåŠ¨åŠ å•å¼•å·"><a href="#æ˜¯å¦è‡ªåŠ¨åŠ å•å¼•å·" class="headerlink" title="æ˜¯å¦è‡ªåŠ¨åŠ å•å¼•å·"></a>æ˜¯å¦è‡ªåŠ¨åŠ å•å¼•å·</h3><ol>
<li><strong>#{}å¯¹åº”çš„å˜é‡ä¼šè‡ªåŠ¨åŠ ä¸Šå•å¼•å·</strong></li>
<li><strong>${}å¯¹åº”çš„å˜é‡ä¸ä¼šåŠ ä¸Šå•å¼•å·</strong></li>
</ol>
</li>
<li><h3 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h3><ol>
<li><strong>#{}èƒ½é˜²æ­¢sql æ³¨å…¥</strong></li>
<li><strong>${}ä¸èƒ½é˜²æ­¢sql æ³¨å…¥</strong></li>
</ol>
</li>
<li><h3 id="Mybatisé»˜è®¤å€¼ä¸åŒ"><a href="#Mybatisé»˜è®¤å€¼ä¸åŒ" class="headerlink" title="Mybatisé»˜è®¤å€¼ä¸åŒ"></a>Mybatisé»˜è®¤å€¼ä¸åŒ</h3><p>   1.<strong>#{} é»˜è®¤å€¼ arg0ã€arg1ã€arg2  æˆ– 0ã€ 1</strong><br>   2.<strong>${} é»˜è®¤å€¼param1ã€param2ã€param3</strong></p>
</li>
</ul>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>Mybatis</tag>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>springBootç¬”è®°-3</title>
    <url>/2022/04/26/SpringBoot%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    <content><![CDATA[<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-054d8ff6135b3638aca543eff7424f98_1200x500.jpg&refer=http%3A%2F%2Fpic4.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1644500043&t=72a4f8ecfca9ff5a2a0b3896edef4be7" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<h1 id="Redisæ•°æ®åº“"><a href="#Redisæ•°æ®åº“" class="headerlink" title="Redisæ•°æ®åº“"></a>Redisæ•°æ®åº“</h1><p><strong>çµé­‚æ‹·é—®ï¼š</strong>ä¸æ˜¯å­¦äº†MySQLå—ï¼Œå­˜æ•°æ®ä¹Ÿèƒ½å­˜äº†å•Šï¼Œåˆå­¦ä¸€ä¸ªæ•°æ®åº“å¹²å˜›ï¼Ÿ</p>
<p>åœ¨å‰é¢æˆ‘ä»¬å­¦ä¹ äº†MySQLæ•°æ®åº“ï¼Œå®ƒæ˜¯ä¸€ç§ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MySQLæ¥æ›´å¥½åœ°ç®¡ç†å’Œç»„ç»‡æˆ‘ä»¬çš„æ•°æ®ï¼Œè™½ç„¶åœ¨å°å‹Webåº”ç”¨ä¸‹ï¼Œåªéœ€è¦ä¸€ä¸ªMySQL+Mybatisè‡ªå¸¦çš„ç¼“å­˜ç³»ç»Ÿå°±å¯ä»¥èƒœä»»å¤§éƒ¨åˆ†çš„æ•°æ®å­˜å‚¨å·¥ä½œã€‚ä½†æ˜¯MySQLçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå®ƒçš„æ•°æ®å§‹ç»ˆæ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šçš„ï¼Œå¯¹äºæˆ‘ä»¬çš„ç”¨æˆ·ä¿¡æ¯è¿™ç§ä¸éœ€è¦ç»å¸¸å‘ç”Ÿä¿®æ”¹çš„å†…å®¹ï¼Œä½¿ç”¨MySQLå­˜å‚¨ç¡®å®å¯ä»¥ï¼Œä½†æ˜¯å¦‚æœæ˜¯å¿«é€Ÿæ›´æ–°æˆ–æ˜¯é¢‘ç¹ä½¿ç”¨çš„æ•°æ®ï¼Œæ¯”å¦‚å¾®åšçƒ­æœã€åŒåä¸€ç§’æ€ï¼Œè¿™äº›æ•°æ®ä¸ä»…è¦æ±‚æœåŠ¡å™¨éœ€è¦æä¾›æ›´é«˜çš„å“åº”é€Ÿåº¦ï¼Œè€Œä¸”è¿˜éœ€è¦é¢å¯¹çŸ­æ—¶é—´å†…ä¸Šç™¾ä¸‡ç”šè‡³ä¸Šåƒä¸‡æ¬¡è®¿é—®ï¼Œè€ŒMySQLçš„ç£ç›˜IOè¯»å†™æ€§èƒ½å®Œå…¨ä¸èƒ½æ»¡è¶³ä¸Šé¢çš„éœ€æ±‚ï¼Œèƒ½å¤Ÿæ»¡è¶³ä¸Šè¿°éœ€æ±‚çš„åªæœ‰å†…å­˜ï¼Œå› ä¸ºé€Ÿåº¦è¿œé«˜äºç£ç›˜IOã€‚</p>
<span id="more"></span>

<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯»æ‰¾ä¸€ç§æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¥å­˜å‚¨ä¸Šè¿°è¿™ç±»ç‰¹æ®Šæ•°æ®ï¼Œå¼¥è¡¥MySQLçš„ä¸è¶³ï¼Œä»¥åº”å¯¹å¤§æ•°æ®æ—¶ä»£çš„é‡é‡è€ƒéªŒã€‚</p>
<h2 id="NoSQLæ¦‚è®º"><a href="#NoSQLæ¦‚è®º" class="headerlink" title="NoSQLæ¦‚è®º"></a>NoSQLæ¦‚è®º</h2><p>NoSQLå…¨ç§°æ˜¯Not Only SQLï¼ˆä¸ä»…ä»…æ˜¯SQLï¼‰å®ƒæ˜¯ä¸€ç§éå…³ç³»å‹æ•°æ®åº“ï¼Œç›¸æ¯”ä¼ ç»ŸSQLå…³ç³»å‹æ•°æ®åº“ï¼Œå®ƒï¼š</p>
<ul>
<li>ä¸ä¿è¯å…³ç³»æ•°æ®çš„ACIDç‰¹æ€§</li>
<li>å¹¶ä¸éµå¾ªSQLæ ‡å‡†</li>
<li>æ¶ˆé™¤æ•°æ®ä¹‹é—´å…³è”æ€§</li>
</ul>
<p>ä¹ä¸€çœ‹ï¼Œè¿™ç©æ„ä¸æ¯”MySQLåƒåœ¾ï¼Ÿæˆ‘ä»¬å†æ¥çœ‹çœ‹å®ƒçš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>è¿œè¶…ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“çš„æ€§èƒ½</li>
<li>éå¸¸æ˜“äºæ‰©å±•</li>
<li>æ•°æ®æ¨¡å‹æ›´åŠ çµæ´»</li>
<li>é«˜å¯ç”¨</li>
</ul>
<p>è¿™æ ·ï¼ŒNoSQLçš„ä¼˜åŠ¿ä¸€ä¸‹å°±å‡ºæ¥äº†ï¼Œè¿™ä¸å°±æ˜¯æˆ‘ä»¬æ­£è¦å¯»æ‰¾çš„é«˜å¹¶å‘æµ·é‡æ•°æ®çš„è§£å†³æ–¹æ¡ˆå—ï¼</p>
<p>NoSQLæ•°æ®åº“åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li><strong>é”®å€¼å­˜å‚¨æ•°æ®åº“ï¼š</strong>æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ä»¥é”®å€¼æ–¹å¼å­˜å‚¨çš„ï¼Œç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰å­¦è¿‡çš„HashMapï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•æ–¹ä¾¿ï¼Œæ€§èƒ½ä¹Ÿéå¸¸é«˜ã€‚</li>
<li><strong>åˆ—å­˜å‚¨æ•°æ®åº“ï¼š</strong>è¿™éƒ¨åˆ†æ•°æ®åº“é€šå¸¸æ˜¯ç”¨æ¥åº”å¯¹åˆ†å¸ƒå¼å­˜å‚¨çš„æµ·é‡æ•°æ®ã€‚é”®ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯å®ƒä»¬çš„ç‰¹ç‚¹æ˜¯æŒ‡å‘äº†å¤šä¸ªåˆ—ã€‚</li>
<li><strong>æ–‡æ¡£å‹æ•°æ®åº“ï¼š</strong>å®ƒæ˜¯ä»¥ä¸€ç§ç‰¹å®šçš„æ–‡æ¡£æ ¼å¼å­˜å‚¨æ•°æ®ï¼Œæ¯”å¦‚JSONæ ¼å¼ï¼Œåœ¨å¤„ç†ç½‘é¡µç­‰å¤æ‚æ•°æ®æ—¶ï¼Œæ–‡æ¡£å‹æ•°æ®åº“æ¯”ä¼ ç»Ÿé”®å€¼æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡æ›´é«˜ã€‚</li>
<li><strong>å›¾å½¢æ•°æ®åº“ï¼š</strong>åˆ©ç”¨ç±»ä¼¼äºå›¾çš„æ•°æ®ç»“æ„å­˜å‚¨æ•°æ®ï¼Œç»“åˆå›¾ç›¸å…³ç®—æ³•å®ç°é«˜é€Ÿè®¿é—®ã€‚</li>
</ul>
<p>å…¶ä¸­æˆ‘ä»¬è¦å­¦ä¹ çš„Redisæ•°æ®åº“ï¼Œå°±æ˜¯ä¸€ä¸ªå¼€æºçš„<strong>é”®å€¼å­˜å‚¨æ•°æ®åº“</strong>ï¼Œæ‰€æœ‰çš„æ•°æ®å…¨éƒ¨å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œå®ƒçš„æ€§èƒ½å¤§å¤§é«˜äºç£ç›˜IOï¼Œå¹¶ä¸”å®ƒä¹Ÿå¯ä»¥æ”¯æŒæ•°æ®æŒä¹…åŒ–ï¼Œä»–è¿˜æ”¯æŒæ¨ªå‘æ‰©å±•ã€ä¸»ä»å¤åˆ¶ç­‰ã€‚</p>
<p>å®é™…ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šé…åˆä½¿ç”¨Rediså’ŒMySQLä»¥å‘æŒ¥å®ƒä»¬å„è‡ªçš„ä¼˜åŠ¿ï¼Œå–é•¿è¡¥çŸ­ã€‚</p>
<h2 id="Rediså®‰è£…å’Œéƒ¨ç½²"><a href="#Rediså®‰è£…å’Œéƒ¨ç½²" class="headerlink" title="Rediså®‰è£…å’Œéƒ¨ç½²"></a>Rediså®‰è£…å’Œéƒ¨ç½²</h2><p>æˆ‘ä»¬è¿™é‡Œè¿˜æ˜¯ä½¿ç”¨Windowså®‰è£…RedisæœåŠ¡å™¨ï¼Œä½†æ˜¯å®˜æ–¹æŒ‡å®šæ˜¯å®‰è£…åˆ°LinuxæœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬åé¢å­¦ä¹ äº†Linuxä¹‹åï¼Œå†æ¥å®‰è£…åˆ°LinuxæœåŠ¡å™¨ä¸Šã€‚ç”±äºå®˜æ–¹å¹¶æ²¡æœ‰æä¾›Windowsç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œæˆ‘ä»¬éœ€è¦å¦å¤–å¯»æ‰¾ï¼š</p>
<ul>
<li>å®˜ç½‘åœ°å€ï¼š<a href="https://redis.io/">https://redis.io</a></li>
<li>GitHub Windowsç‰ˆæœ¬ç»´æŠ¤åœ°å€ï¼š<a href="https://github.com/tporadowski/redis/releases">https://github.com/tporadowski/redis/releases</a></li>
</ul>
<hr>
<h2 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h2><p>åœ¨æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨MySQLæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¼ è¡¨ï¼Œå¹¶å®šä¹‰å¥½è¡¨çš„æ¯ä¸ªå­—æ®µå†…å®¹ï¼Œæœ€åå†é€šè¿‡<code>insert</code>è¯­å¥å‘è¡¨ä¸­æ·»åŠ æ•°æ®ï¼Œè€ŒRediså¹¶ä¸å…·æœ‰MySQLé‚£æ ·çš„ä¸¥æ ¼çš„è¡¨ç»“æ„ï¼ŒRedisæ˜¯ä¸€ä¸ªé”®å€¼æ•°æ®åº“ï¼Œå› æ­¤ï¼Œå¯ä»¥åƒMapä¸€æ ·çš„æ“ä½œæ–¹å¼ï¼Œé€šè¿‡é”®å€¼å¯¹å‘Redisæ•°æ®åº“ä¸­æ·»åŠ æ•°æ®ï¼ˆæ“ä½œèµ·æ¥ç±»ä¼¼äºå‘ä¸€ä¸ªHashMapä¸­å­˜æ”¾æ•°æ®ï¼‰</p>
<p>åœ¨Redisä¸‹ï¼Œæ•°æ®åº“æ˜¯ç”±ä¸€ä¸ªæ•´æ•°ç´¢å¼•æ ‡è¯†ï¼Œè€Œä¸æ˜¯ç”±ä¸€ä¸ªæ•°æ®åº“åç§°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿æ¥Redisæ•°æ®åº“ä¹‹åï¼Œä¼šä½¿ç”¨0å·æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Redisé…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°æ¥ä¿®æ”¹æ•°æ®åº“æ€»æ•°ï¼Œé»˜è®¤ä¸º16ä¸ªã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>select</code>è¯­å¥è¿›è¡Œåˆ‡æ¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> åºå·;</span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®æ“ä½œ"><a href="#æ•°æ®æ“ä½œ" class="headerlink" title="æ•°æ®æ“ä½œ"></a>æ•°æ®æ“ä½œ</h3><p>æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå¦‚ä½•å‘Redisæ•°æ®åº“ä¸­æ·»åŠ æ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- ä¸€æ¬¡æ€§å¤šä¸ª</span></span><br><span class="line">mset [<span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>]...</span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰å­˜å…¥çš„æ•°æ®é»˜è®¤ä¼šä»¥<strong>å­—ç¬¦ä¸²</strong>çš„å½¢å¼ä¿å­˜ï¼Œé”®å€¼å…·æœ‰ä¸€å®šçš„å‘½åè§„èŒƒï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬å¯ä»¥å¿«é€Ÿå®šä½æˆ‘ä»¬çš„æ•°æ®å±äºå“ªä¸€ä¸ªéƒ¨åˆ†ï¼Œæ¯”å¦‚ç”¨æˆ·çš„æ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ä½¿ç”¨å†’å·æ¥è¿›è¡Œæ¿å—åˆ†å‰²ï¼Œæ¯”å¦‚ä¸‹é¢è¡¨ç¤ºç”¨æˆ·XXXçš„ä¿¡æ¯ä¸­çš„nameå±æ€§ï¼Œå€¼ä¸ºlbw</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">user</span>:info:ç”¨æˆ·ID:name lbw</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é”®å€¼è·å–å­˜å…¥çš„å€¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">get</span> <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½ ä»¥ä¸ºRediså°±ä»…ä»…åªæ˜¯å­˜å–ä¸ªæ•°æ®å—ï¼Ÿå®ƒè¿˜æ”¯æŒæ•°æ®çš„è¿‡æœŸæ—¶é—´è®¾å®šï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span> EX ç§’</span><br><span class="line"><span class="keyword">set</span> <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span> PX æ¯«ç§’</span><br></pre></td></tr></table></figure>

<p>å½“æ•°æ®åˆ°è¾¾æŒ‡å®šæ—¶é—´æ—¶ï¼Œä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬ä¸ºå…¶ä»–çš„é”®å€¼å¯¹è®¾ç½®è¿‡æœŸæ—¶é—´ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">expire <span class="operator">&lt;</span>key<span class="operator">&gt;</span> ç§’</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥è¯¢æŸä¸ªé”®å€¼å¯¹çš„è¿‡æœŸæ—¶é—´è¿˜å‰©å¤šå°‘ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ttl <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- æ¯«ç§’æ˜¾ç¤º</span></span><br><span class="line">pttl <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- è½¬æ¢ä¸ºæ°¸ä¹…</span></span><br><span class="line">persist <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆå½“æˆ‘ä»¬æƒ³ç›´æ¥åˆ é™¤è¿™ä¸ªæ•°æ®æ—¶å‘¢ï¼Ÿç›´æ¥ä½¿ç”¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">del <span class="operator">&lt;</span>key<span class="operator">&gt;</span>...</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤å‘½ä»¤å¯ä»¥åŒæ—¶æ‹¼æ¥å¤šä¸ªé”®å€¼ä¸€èµ·åˆ é™¤ã€‚</p>
<p>å½“æˆ‘ä»¬æƒ³è¦æŸ¥çœ‹æ•°æ®åº“ä¸­æ‰€æœ‰çš„é”®å€¼æ—¶ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">keys <span class="operator">*</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥æŸ¥è¯¢æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">exists</span> <span class="operator">&lt;</span>key<span class="operator">&gt;</span>...</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥éšæœºæ‹¿ä¸€ä¸ªé”®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">randomkey</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªæ•°æ®åº“ä¸­çš„å†…å®¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ä¸­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">move <span class="operator">&lt;</span>key<span class="operator">&gt;</span> æ•°æ®åº“åºå·</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä¸€ä¸ªé”®ä¸ºå¦ä¸€ä¸ªé”®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">rename <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span>æ–°çš„åç§°<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- ä¸‹é¢è¿™ä¸ªä¼šæ£€æŸ¥æ–°çš„åç§°æ˜¯å¦å·²ç»å­˜åœ¨</span></span><br><span class="line">renamex <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span>æ–°çš„åç§°<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå­˜æ”¾çš„æ•°æ®æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹å…¶è¿›è¡Œè‡ªå¢è‡ªå‡æ“ä½œï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ç­‰ä»·äºa = a + 1</span></span><br><span class="line">incr <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- ç­‰ä»·äºa = a + b</span></span><br><span class="line">incrby <span class="operator">&lt;</span>key<span class="operator">&gt;</span> b</span><br><span class="line"><span class="comment">-- ç­‰ä»·äºa = a - 1</span></span><br><span class="line">decr <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€åå°±æ˜¯æŸ¥çœ‹å€¼çš„æ•°æ®ç±»å‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">type <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>Redisæ•°æ®åº“ä¹Ÿæ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼Œä½†æ˜¯å®ƒæ›´åå‘äºæˆ‘ä»¬åœ¨Javaä¸­è®¤è¯†çš„é‚£äº›æ•°æ®ç±»å‹ã€‚</p>
<h2 id="æ•°æ®ç±»å‹ä»‹ç»"><a href="#æ•°æ®ç±»å‹ä»‹ç»" class="headerlink" title="æ•°æ®ç±»å‹ä»‹ç»"></a>æ•°æ®ç±»å‹ä»‹ç»</h2><p>ä¸€ä¸ªé”®å€¼å¯¹é™¤äº†å­˜å‚¨ä¸€ä¸ªStringç±»å‹çš„å€¼ä»¥å¤–ï¼Œè¿˜æ”¯æŒå¤šç§å¸¸ç”¨çš„æ•°æ®ç±»å‹ã€‚</p>
<h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><p>è¿™ç§ç±»å‹æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªHashMapï¼Œä¹Ÿå°±æ˜¯åµŒå¥—äº†ä¸€ä¸ªHashMapç½¢äº†ï¼Œåœ¨Javaä¸­å°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#Redisé»˜è®¤å­˜Stringç±»ä¼¼äºè¿™æ ·ï¼š</span><br><span class="line">Map&lt;String, String&gt; hash = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">#Rediså­˜Hashç±»å‹çš„æ•°æ®ç±»ä¼¼äºè¿™æ ·ï¼š</span><br><span class="line">Map&lt;String, Map&lt;String, String&gt;&gt; hash = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>

<p>å®ƒæ¯”è¾ƒé€‚åˆå­˜å‚¨ç±»è¿™æ ·çš„æ•°æ®ï¼Œç”±äºå€¼æœ¬èº«åˆæ˜¯ä¸€ä¸ªMapï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æ­¤Mapä¸­æ”¾å…¥ç±»çš„å„ç§å±æ€§å’Œå€¼ï¼Œä»¥å®ç°ä¸€ä¸ªHashæ•°æ®ç±»å‹å­˜å‚¨ä¸€ä¸ªç±»çš„æ•°æ®ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·æ¥æ·»åŠ ä¸€ä¸ªHashç±»å‹çš„æ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hset <span class="operator">&lt;</span>key<span class="operator">&gt;</span> [<span class="operator">&lt;</span>å­—æ®µ<span class="operator">&gt;</span> <span class="operator">&lt;</span>å€¼<span class="operator">&gt;</span>]...</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥è·å–ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hget <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span>å­—æ®µ<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- å¦‚æœæƒ³è¦ä¸€æ¬¡æ€§è·å–æ‰€æœ‰çš„å­—æ®µå’Œå€¼</span></span><br><span class="line">hgetall <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ¤æ–­æŸä¸ªå­—æ®µæ˜¯å¦å­˜åœ¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hexists <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span>å­—æ®µ<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ é™¤Hashä¸­çš„æŸä¸ªå­—æ®µï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hdel <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œåœ¨æ“ä½œä¸€ä¸ªHashæ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬æ™®é€šæ“ä½œå‘½ä»¤å‰é¢æ·»åŠ ä¸€ä¸ª<code>h</code>ï¼Œè¿™æ ·å°±èƒ½ä»¥åŒæ ·çš„æ–¹å¼å»æ“ä½œHashé‡Œé¢å­˜æ”¾çš„é”®å€¼å¯¹äº†ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—å‡ºæ‰€æœ‰çš„æ“ä½œäº†ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å‡ ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨æƒ³è¦çŸ¥é“Hashä¸­ä¸€å…±å­˜äº†å¤šå°‘ä¸ªé”®å€¼å¯¹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hlen <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸€æ¬¡æ€§è·å–æ‰€æœ‰å­—æ®µçš„å€¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hvals <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒHashä¸­åªèƒ½å­˜æ”¾å­—ç¬¦ä¸²å€¼ï¼Œä¸å…è®¸å‡ºç°åµŒå¥—çš„çš„æƒ…å†µã€‚</p>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹Listç±»å‹ï¼Œå®é™…ä¸Šè¿™ä¸ªçŒœéƒ½çŸ¥é“ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œåˆ—è¡¨ä¸­å­˜æ”¾ä¸€ç³»åˆ—çš„å­—ç¬¦ä¸²ï¼Œå®ƒæ”¯æŒéšæœºè®¿é—®ï¼Œæ”¯æŒåŒç«¯æ“ä½œï¼Œå°±åƒæˆ‘ä»¬ä½¿ç”¨Javaä¸­çš„LinkedListä¸€æ ·ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥å‘ä¸€ä¸ªå·²å­˜åœ¨æˆ–æ˜¯ä¸å­˜åœ¨çš„Listä¸­æ·»åŠ æ•°æ®ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å‘åˆ—è¡¨å¤´éƒ¨æ·»åŠ å…ƒç´ </span></span><br><span class="line">lpush <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span>element<span class="operator">&gt;</span>...</span><br><span class="line"><span class="comment">-- å‘åˆ—è¡¨å°¾éƒ¨æ·»åŠ å…ƒç´ </span></span><br><span class="line">rpush <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span>element<span class="operator">&gt;</span>...</span><br><span class="line"><span class="comment">-- åœ¨æŒ‡å®šå…ƒç´ å‰é¢/åé¢æ’å…¥å…ƒç´ </span></span><br><span class="line">linsert <span class="operator">&lt;</span>key<span class="operator">&gt;</span> before<span class="operator">/</span>after <span class="operator">&lt;</span>æŒ‡å®šå…ƒç´ <span class="operator">&gt;</span> <span class="operator">&lt;</span>element<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œè·å–å…ƒç´ ä¹Ÿéå¸¸ç®€å•ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æ ¹æ®ä¸‹æ ‡è·å–å…ƒç´ </span></span><br><span class="line">lindex <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span>ä¸‹æ ‡<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- è·å–å¹¶ç§»é™¤å¤´éƒ¨å…ƒç´ </span></span><br><span class="line">lpop <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- è·å–å¹¶ç§»é™¤å°¾éƒ¨å…ƒç´ </span></span><br><span class="line">rpop <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- è·å–æŒ‡å®šèŒƒå›´å†…çš„</span></span><br><span class="line">lrange <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="keyword">start</span> stop</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ä¸‹æ ‡å¯ä»¥ä½¿ç”¨è´Ÿæ•°æ¥è¡¨ç¤ºä»ååˆ°å‰æ•°çš„æ•°å­—ï¼ˆPythonï¼šæè¿™å„¿æŠ„å‘¢æ˜¯å§ï¼‰:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- è·å–åˆ—è¡¨aä¸­çš„å…¨éƒ¨å…ƒç´ </span></span><br><span class="line">lrange a <span class="number">0</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure>

<p>æ²¡æƒ³åˆ°å§ï¼Œpushå’Œpopè¿˜èƒ½è¿ç€ç”¨å‘¢ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- ä»å‰ä¸€ä¸ªæ•°ç»„çš„æœ€åå–ä¸€ä¸ªæ•°å‡ºæ¥æ”¾åˆ°å¦ä¸€ä¸ªæ•°ç»„çš„å¤´éƒ¨ï¼Œå¹¶è¿”å›å…ƒç´ </span></span><br><span class="line">rpoplpush å½“å‰æ•°ç»„ ç›®æ ‡æ•°ç»„</span><br></pre></td></tr></table></figure>

<p>å®ƒè¿˜æ”¯æŒé˜»å¡æ“ä½œï¼Œç±»ä¼¼äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦ç­‰å¾…åˆ—è¡¨ä¸­æœ‰äº†æ•°æ®åå†è¿›è¡Œpopæ“ä½œï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¦‚æœåˆ—è¡¨ä¸­æ²¡æœ‰å…ƒç´ ï¼Œé‚£ä¹ˆå°±ç­‰å¾…ï¼Œå¦‚æœæŒ‡å®šæ—¶é—´ï¼ˆç§’ï¼‰å†…è¢«æ·»åŠ äº†æ•°æ®ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œpopæ“ä½œï¼Œå¦‚æœè¶…æ—¶å°±ä½œåºŸï¼Œæ”¯æŒåŒæ—¶ç­‰å¾…å¤šä¸ªåˆ—è¡¨ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªåˆ—è¡¨æœ‰å…ƒç´ äº†ï¼Œé‚£ä¹ˆå°±èƒ½æ‰§è¡Œ</span></span><br><span class="line">blpop <span class="operator">&lt;</span>key<span class="operator">&gt;</span>... timeout</span><br></pre></td></tr></table></figure>

<h3 id="Setå’ŒSortedSet"><a href="#Setå’ŒSortedSet" class="headerlink" title="Setå’ŒSortedSet"></a>Setå’ŒSortedSet</h3><p>Seté›†åˆå…¶å®å°±åƒJavaä¸­çš„HashSetä¸€æ ·ï¼ˆæˆ‘ä»¬åœ¨JavaSEä¸­å·²ç»è®²è§£è¿‡äº†ï¼ŒHashSetæœ¬è´¨ä¸Šå°±æ˜¯åˆ©ç”¨äº†ä¸€ä¸ªHashMapï¼Œä½†æ˜¯Valueéƒ½æ˜¯å›ºå®šå¯¹è±¡ï¼Œä»…ä»…æ˜¯Keyä¸åŒï¼‰å®ƒä¸å…è®¸å‡ºç°é‡å¤å…ƒç´ ï¼Œä¸æ”¯æŒéšæœºè®¿é—®ï¼Œä½†æ˜¯èƒ½å¤Ÿåˆ©ç”¨Hashè¡¨æä¾›æé«˜çš„æŸ¥æ‰¾æ•ˆç‡ã€‚</p>
<p>å‘Setä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">sadd <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>...</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹Seté›†åˆä¸­æœ‰å¤šå°‘ä¸ªå€¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">scard <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ¤æ–­é›†åˆä¸­æ˜¯å¦åŒ…å«ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æ˜¯å¦åŒ…å«æŒ‡å®šå€¼</span></span><br><span class="line">sismember <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- åˆ—å‡ºæ‰€æœ‰å€¼</span></span><br><span class="line">smembers <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>é›†åˆä¹‹é—´çš„è¿ç®—ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- é›†åˆä¹‹é—´çš„å·®é›†</span></span><br><span class="line">sdiff <span class="operator">&lt;</span>key1<span class="operator">&gt;</span> <span class="operator">&lt;</span>key2<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- é›†åˆä¹‹é—´çš„äº¤é›†</span></span><br><span class="line">sinter <span class="operator">&lt;</span>key1<span class="operator">&gt;</span> <span class="operator">&lt;</span>key2<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- æ±‚å¹¶é›†</span></span><br><span class="line">sunion <span class="operator">&lt;</span>key1<span class="operator">&gt;</span> <span class="operator">&lt;</span>key2<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- å°†é›†åˆä¹‹é—´çš„å·®é›†å­˜åˆ°ç›®æ ‡é›†åˆä¸­</span></span><br><span class="line">sdiffstore ç›®æ ‡ <span class="operator">&lt;</span>key1<span class="operator">&gt;</span> <span class="operator">&lt;</span>key2<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- åŒä¸Š</span></span><br><span class="line">sinterstore ç›®æ ‡ <span class="operator">&lt;</span>key1<span class="operator">&gt;</span> <span class="operator">&lt;</span>key2<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- åŒä¸Š</span></span><br><span class="line">sunionstore ç›®æ ‡ <span class="operator">&lt;</span>key1<span class="operator">&gt;</span> <span class="operator">&lt;</span>key2<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç§»åŠ¨æŒ‡å®šå€¼åˆ°å¦ä¸€ä¸ªé›†åˆä¸­ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">smove <span class="operator">&lt;</span>key<span class="operator">&gt;</span> ç›®æ ‡ <span class="keyword">value</span> </span><br></pre></td></tr></table></figure>

<p>ç§»é™¤æ“ä½œï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- éšæœºç§»é™¤ä¸€ä¸ªå¹¸è¿å„¿</span></span><br><span class="line">spop <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- ç§»é™¤æŒ‡å®š</span></span><br><span class="line">srem <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>...</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬è¦æ±‚Seté›†åˆä¸­çš„æ•°æ®æŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„é¡ºåºè¿›è¡Œæ’åˆ—æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨SortedSetï¼Œå®ƒæ”¯æŒæˆ‘ä»¬ä¸ºæ¯ä¸ªå€¼è®¾å®šä¸€ä¸ªåˆ†æ•°ï¼Œåˆ†æ•°çš„å¤§å°å†³å®šäº†å€¼çš„ä½ç½®ï¼Œæ‰€ä»¥å®ƒæ˜¯æœ‰åºçš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªå¸¦åˆ†æ•°çš„å€¼ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">zadd <span class="operator">&lt;</span>key<span class="operator">&gt;</span> [<span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span> <span class="operator">&lt;</span>score<span class="operator">&gt;</span>]...</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢æœ‰å¤šå°‘ä¸ªå€¼</span></span><br><span class="line">zcard <span class="operator">&lt;</span>key<span class="operator">&gt;</span></span><br><span class="line"><span class="comment">-- ç§»é™¤</span></span><br><span class="line">zrem <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span>...</span><br><span class="line"><span class="comment">-- è·å–åŒºé—´å†…çš„æ‰€æœ‰</span></span><br><span class="line">zrange <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="keyword">start</span> stop</span><br></pre></td></tr></table></figure>

<p>ç”±äºæ‰€æœ‰çš„å€¼éƒ½æœ‰ä¸€ä¸ªåˆ†æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®åˆ†æ•°æ®µæ¥è·å–ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- é€šè¿‡åˆ†æ•°æ®µæŸ¥çœ‹</span></span><br><span class="line">zrangebyscore <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="keyword">start</span> stop [withscores] [limit]</span><br><span class="line"><span class="comment">-- ç»Ÿè®¡åˆ†æ•°æ®µå†…çš„æ•°é‡</span></span><br><span class="line">zcount <span class="operator">&lt;</span>key<span class="operator">&gt;</span>  <span class="keyword">start</span> stop</span><br><span class="line"><span class="comment">-- æ ¹æ®åˆ†æ•°è·å–æŒ‡å®šå€¼çš„æ’å</span></span><br><span class="line">zrank <span class="operator">&lt;</span>key<span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="keyword">value</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.jianshu.com/p/32b9fe8c20e1">https://www.jianshu.com/p/32b9fe8c20e1</a></p>
<p>æœ‰å…³Bitmapã€HyperLogLogå’ŒGeospatialç­‰æ•°æ®ç±»å‹ï¼Œè¿™é‡Œæš‚æ—¶ä¸åšä»‹ç»ï¼Œæ„Ÿå…´è¶£å¯ä»¥è‡ªè¡Œäº†è§£ã€‚</p>
<hr>
<h2 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒRedisæ•°æ®åº“ä¸­çš„æ•°æ®éƒ½æ˜¯å­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œè™½ç„¶å¾ˆé«˜æ•ˆï¼Œä½†æ˜¯è¿™æ ·å­˜åœ¨ä¸€ä¸ªéå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œå¦‚æœçªç„¶åœç”µï¼Œé‚£æˆ‘ä»¬çš„æ•°æ®ä¸å°±å…¨éƒ¨ä¸¢å¤±äº†å—ï¼Ÿå®ƒä¸åƒç¡¬ç›˜ä¸Šçš„æ•°æ®ï¼Œæ–­ç”µä¾ç„¶èƒ½å¤Ÿä¿å­˜ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦æŒä¹…åŒ–ï¼Œæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„æ•°æ®å¤‡ä»½åˆ°ç¡¬ç›˜ä¸Šï¼Œé˜²æ­¢æ–­ç”µæˆ–æ˜¯æœºå™¨æ•…éšœå¯¼è‡´çš„æ•°æ®ä¸¢å¤±ã€‚</p>
<p>æŒä¹…åŒ–çš„å®ç°æ–¹å¼æœ‰ä¸¤ç§æ–¹æ¡ˆï¼šä¸€ç§æ˜¯ç›´æ¥ä¿å­˜å½“å‰<strong>å·²ç»å­˜å‚¨çš„æ•°æ®</strong>ï¼Œç›¸å½“äºå¤åˆ¶å†…å­˜ä¸­çš„æ•°æ®åˆ°ç¡¬ç›˜ä¸Šï¼Œéœ€è¦æ¢å¤æ•°æ®æ—¶ç›´æ¥è¯»å–å³å¯ï¼›è¿˜æœ‰ä¸€ç§å°±æ˜¯ä¿å­˜æˆ‘ä»¬å­˜æ”¾æ•°æ®çš„<strong>æ‰€æœ‰è¿‡ç¨‹</strong>ï¼Œéœ€è¦æ¢å¤æ•°æ®æ—¶ï¼Œåªéœ€è¦å°†æ•´ä¸ªè¿‡ç¨‹å®Œæ•´åœ°é‡æ¼”ä¸€éå°±èƒ½ä¿è¯ä¸ä¹‹å‰æ•°æ®åº“ä¸­çš„å†…å®¹ä¸€è‡´ã€‚</p>
<h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><p>RDBå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆå¦‚ä½•å°†æ•°æ®ä¿å­˜åˆ°æœ¬åœ°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">save</span><br><span class="line"><span class="comment">-- æ³¨æ„ä¸Šé¢è¿™ä¸ªå‘½ä»¤æ˜¯ç›´æ¥ä¿å­˜ï¼Œä¼šå ç”¨ä¸€å®šçš„æ—¶é—´ï¼Œä¹Ÿå¯ä»¥å•ç‹¬å¼€ä¸€ä¸ªå­è¿›ç¨‹åå°æ‰§è¡Œä¿å­˜</span></span><br><span class="line">bgsave</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œåï¼Œä¼šåœ¨æœåŠ¡ç«¯ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªdump.rdbæ–‡ä»¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶ä¸­å°±ä¿å­˜äº†å†…å­˜ä¸­å­˜æ”¾çš„æ•°æ®ï¼Œå½“æœåŠ¡å™¨é‡å¯åï¼Œä¼šè‡ªåŠ¨åŠ è½½é‡Œé¢çš„å†…å®¹åˆ°å¯¹åº”æ•°æ®åº“ä¸­ã€‚ä¿å­˜åæˆ‘ä»¬å¯ä»¥å…³é—­æœåŠ¡å™¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">shutdown</span><br></pre></td></tr></table></figure>

<p>é‡å¯åå¯ä»¥çœ‹åˆ°æ•°æ®ä¾ç„¶å­˜åœ¨ã€‚</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fqqe2.com%2Fjava%2Fzb_users%2Fupload%2F2020%2F04%2F202004281588086055367603.png&refer=http%3A%2F%2Fqqe2.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1644843952&t=ec4cd6eb2c6d47a10aff5b9f264d2f16" alt="ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡æ¥æº"></p>
<p>è™½ç„¶è¿™ç§æ–¹å¼éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ç”±äºä¼šå®Œæ•´å¤åˆ¶æ‰€æœ‰çš„æ•°æ®ï¼Œå¦‚æœæ•°æ®åº“ä¸­çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆå¤åˆ¶ä¸€æ¬¡å¯èƒ½å°±éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨è¿›è¡Œä¿å­˜ï¼›è¿˜æœ‰å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨è¿›è¡Œè¯»æ“ä½œï¼Œè€Œæ²¡æœ‰è¿›è¡Œå†™æ“ä½œï¼Œå®é™…ä¸Šåªéœ€è¦å¶å°”ä¿å­˜ä¸€æ¬¡å³å¯ï¼Œå› ä¸ºæ•°æ®å‡ ä¹æ²¡æœ‰æ€ä¹ˆå˜åŒ–ï¼Œå¯èƒ½ä¸¤æ¬¡ä¿å­˜çš„éƒ½æ˜¯ä¸€æ ·çš„æ•°æ®ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è‡ªåŠ¨ä¿å­˜ï¼Œå¹¶è®¾å®šåœ¨ä¸€æ®µæ—¶é—´å†…å†™å…¥å¤šå°‘æ•°æ®æ—¶ï¼Œæ‰§è¡Œä¸€æ¬¡ä¿å­˜æ“ä½œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">save 300 10 # 300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰å†…æœ‰10ä¸ªå†™å…¥</span><br><span class="line">save 60 10000 # 60ç§’ï¼ˆ1åˆ†é’Ÿï¼‰å†…æœ‰10000ä¸ªå†™å…¥</span><br></pre></td></tr></table></figure>

<p>é…ç½®çš„saveä½¿ç”¨çš„éƒ½æ˜¯bgsaveåå°æ‰§è¡Œã€‚</p>
<h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><p>è™½ç„¶RDBèƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³æ•°æ®æŒä¹…åŒ–é—®é¢˜ï¼Œä½†æ˜¯å®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šæ¯æ¬¡éƒ½éœ€è¦å»å®Œæ•´åœ°ä¿å­˜æ•´ä¸ªæ•°æ®åº“ä¸­çš„æ•°æ®ï¼ŒåŒæ—¶åå°ä¿å­˜è¿‡ç¨‹ä¸­ä¹Ÿä¼šäº§ç”Ÿé¢å¤–çš„å†…å­˜å¼€é”€ï¼Œæœ€ä¸¥é‡çš„æ˜¯å®ƒå¹¶ä¸æ˜¯å®æ—¶ä¿å­˜çš„ï¼Œå¦‚æœåœ¨è‡ªåŠ¨ä¿å­˜è§¦å‘ä¹‹å‰æœåŠ¡å™¨å´©æºƒï¼Œé‚£ä¹ˆä¾ç„¶ä¼šå¯¼è‡´å°‘é‡æ•°æ®çš„ä¸¢å¤±ã€‚</p>
<p>è€ŒAOFå°±æ˜¯å¦ä¸€ç§æ–¹å¼ï¼Œå®ƒä¼šä»¥æ—¥å¿—çš„å½¢å¼å°†æˆ‘ä»¬æ¯æ¬¡æ‰§è¡Œçš„å‘½ä»¤éƒ½è¿›è¡Œä¿å­˜ï¼ŒæœåŠ¡å™¨é‡å¯æ—¶ä¼šå°†æ‰€æœ‰å‘½ä»¤ä¾æ¬¡æ‰§è¡Œï¼Œé€šè¿‡è¿™ç§é‡æ¼”çš„æ–¹å¼å°†æ•°æ®æ¢å¤ï¼Œè¿™æ ·å°±èƒ½å¾ˆå¥½è§£å†³å®æ—¶æ€§å­˜å‚¨é—®é¢˜ã€‚</p>
<p><img src="https://qqe2.com/java/zb_users/upload/2020/04/202004281588086068660716.png" alt="rdbå’ŒaofåŒºåˆ«"></p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¤šä¹…å†™ä¸€æ¬¡æ—¥å¿—å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è‡ªå·±é…ç½®ä¿å­˜ç­–ç•¥ï¼Œæœ‰ä¸‰ç§ç­–ç•¥ï¼š</p>
<ul>
<li>alwaysï¼šæ¯æ¬¡æ‰§è¡Œå†™æ“ä½œéƒ½ä¼šä¿å­˜ä¸€æ¬¡</li>
<li>everysecï¼šæ¯ç§’ä¿å­˜ä¸€æ¬¡ï¼ˆé»˜è®¤é…ç½®ï¼‰ï¼Œè¿™æ ·å°±ç®—ä¸¢å¤±æ•°æ®ä¹Ÿåªä¼šä¸¢ä¸€ç§’ä»¥å†…çš„æ•°æ®</li>
<li>noï¼šçœ‹ç³»ç»Ÿå¿ƒæƒ…ä¿å­˜</li>
</ul>
<p>å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># æ³¨æ„å¾—æ”¹æˆä¹Ÿæ˜¯</span><br><span class="line">appendonly yes</span><br><span class="line"></span><br><span class="line"># appendfsync always</span><br><span class="line">appendfsync everysec</span><br><span class="line"># appendfsync <span class="keyword">no</span></span><br></pre></td></tr></table></figure>

<p>é‡å¯æœåŠ¡å™¨åï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡å™¨ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ª<code>appendonly.aof</code>æ–‡ä»¶ï¼Œå­˜å‚¨çš„å°±æ˜¯æˆ‘ä»¬æ‰§è¡Œçš„å‘½ä»¤ã€‚</p>
<p> AOFçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ¯æ¬¡æœåŠ¡å™¨å¯åŠ¨éƒ½éœ€è¦è¿›è¡Œè¿‡ç¨‹é‡æ¼”ï¼Œç›¸æ¯”RDBæ›´åŠ è€—è´¹æ—¶é—´ï¼Œå¹¶ä¸”éšç€æˆ‘ä»¬çš„æ“ä½œå˜å¤šï¼Œä¸æ–­ç´¯è®¡ï¼Œå¯èƒ½åˆ°æœ€åæˆ‘ä»¬çš„aofæ–‡ä»¶ä¼šå˜å¾—æ— æ¯”å·¨å¤§ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ”¹è¿›æ–¹æ¡ˆæ¥ä¼˜åŒ–è¿™äº›é—®é¢˜ã€‚</p>
<p>Redisæœ‰ä¸€ä¸ªAOFé‡å†™æœºåˆ¶è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œäº†è¿™æ ·çš„è¯­å¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lpush test 666</span><br><span class="line">lpush test 777</span><br><span class="line">lpush test 888</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šç”¨ä¸€æ¡è¯­å¥ä¹Ÿå¯ä»¥å®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lpush test 666 777 888</span><br></pre></td></tr></table></figure>

<p>æ­£æ˜¯å¦‚æ­¤ï¼Œåªè¦æˆ‘ä»¬èƒ½å¤Ÿä¿è¯æœ€ç»ˆçš„é‡æ¼”ç»“æœå’ŒåŸæœ‰è¯­å¥çš„ç»“æœä¸€è‡´ï¼Œæ— è®ºè¯­å¥å¦‚ä½•ä¿®æ”¹éƒ½å¯ä»¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å°†å¤šæ¡è¯­å¥è¿›è¡Œå‹ç¼©ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è¾“å…¥å‘½ä»¤æ¥æ‰‹åŠ¨æ‰§è¡Œé‡å†™æ“ä½œï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">bgrewriteaof</span><br></pre></td></tr></table></figure>

<p>æˆ–æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®è‡ªåŠ¨é‡å†™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ç™¾åˆ†æ¯”è®¡ç®—ï¼Œè¿™é‡Œä¸å¤šä»‹ç»</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line"># å½“è¾¾åˆ°è¿™ä¸ªå¤§å°æ—¶ï¼Œè§¦å‘è‡ªåŠ¨é‡å†™</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆçš„ä»‹ç»ï¼Œæœ€åæˆ‘ä»¬å†æ¥è¿›è¡Œä¸€ä¸‹æ€»ç»“ï¼š</p>
<ul>
<li>AOFï¼š<ul>
<li>ä¼˜ç‚¹ï¼šå­˜å‚¨é€Ÿåº¦å¿«ã€æ¶ˆè€—èµ„æºå°‘ã€æ”¯æŒå®æ—¶å­˜å‚¨</li>
<li>ç¼ºç‚¹ï¼šåŠ è½½é€Ÿåº¦æ…¢ã€æ•°æ®ä½“ç§¯å¤§</li>
</ul>
</li>
<li>RDBï¼š<ul>
<li>ä¼˜ç‚¹ï¼šåŠ è½½é€Ÿåº¦å¿«ã€æ•°æ®ä½“ç§¯å°</li>
<li>ç¼ºç‚¹ï¼šå­˜å‚¨é€Ÿåº¦æ…¢å¤§é‡æ¶ˆè€—èµ„æºã€ä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±</li>
</ul>
</li>
</ul>
<hr>
<h2 id="äº‹åŠ¡å’Œé”æœºåˆ¶"><a href="#äº‹åŠ¡å’Œé”æœºåˆ¶" class="headerlink" title="äº‹åŠ¡å’Œé”æœºåˆ¶"></a>äº‹åŠ¡å’Œé”æœºåˆ¶</h2><p>å’ŒMySQLä¸€æ ·ï¼Œåœ¨Redisä¸­ä¹Ÿæœ‰äº‹åŠ¡æœºåˆ¶ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¿è¯å¤šæ¡å‘½ä»¤ä¸€æ¬¡æ€§å®Œæ•´æ‰§è¡Œè€Œä¸­é€”ä¸å—åˆ°å…¶ä»–å‘½ä»¤å¹²æ‰°æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨äº‹åŠ¡æœºåˆ¶ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤æ¥ç›´æ¥å¼€å¯äº‹åŠ¡ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">multi</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬è¾“å…¥å®Œæ‰€æœ‰è¦æ‰§è¡Œçš„å‘½ä»¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤æ¥ç«‹å³æ‰§è¡Œäº‹åŠ¡ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">exec</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸­é€”å–æ¶ˆäº‹åŠ¡ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">discard</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šæ•´ä¸ªäº‹åŠ¡æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå‘½ä»¤é˜Ÿåˆ—ï¼Œå®ƒä¸åƒMySQLé‚£ç§åœ¨äº‹åŠ¡ä¸­ä¹Ÿèƒ½å•ç‹¬å¾—åˆ°ç»“æœï¼Œè€Œæ˜¯æˆ‘ä»¬æå‰å°†æ‰€æœ‰çš„å‘½ä»¤è£…åœ¨é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯å¹¶ä¸ä¼šæ‰§è¡Œï¼Œè€Œæ˜¯ç­‰æˆ‘ä»¬æäº¤äº‹åŠ¡çš„æ—¶å€™å†ç»Ÿä¸€æ‰§è¡Œã€‚</p>
<h3 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h3><p>åˆæåˆ°é”äº†ï¼Œå®é™…ä¸Šè¿™ä¸ªæ¦‚å¿µå¯¹æˆ‘ä»¬æ¥è¯´å·²ç»ä¸ç®—æ˜¯é™Œç”Ÿäº†ã€‚å®é™…ä¸Šåœ¨Redisä¸­ä¹Ÿä¼šå‡ºç°å¤šä¸ªå‘½ä»¤åŒæ—¶ç«äº‰åŒä¸€ä¸ªæ•°æ®çš„æƒ…å†µï¼Œæ¯”å¦‚ç°åœ¨æœ‰ä¸¤æ¡å‘½ä»¤åŒæ—¶æ‰§è¡Œï¼Œä»–ä»¬éƒ½è¦å»ä¿®æ”¹açš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±åªèƒ½åŠ¨ç”¨é”æœºåˆ¶æ¥ä¿è¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå‘½ä»¤æ“ä½œã€‚</p>
<p>è™½ç„¶Redisä¸­ä¹Ÿæœ‰é”æœºåˆ¶ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ç§ä¹è§‚é”ï¼Œä¸åŒäºMySQLï¼Œæˆ‘ä»¬åœ¨MySQLä¸­è®¤è¯†çš„é”æ˜¯æ‚²è§‚é”ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ä¹è§‚é”ä»€ä¹ˆæ˜¯æ‚²è§‚é”å‘¢ï¼Ÿ</p>
<ul>
<li>æ‚²è§‚é”ï¼šæ—¶åˆ»è®¤ä¸ºåˆ«äººä¼šæ¥æŠ¢å èµ„æºï¼Œç¦æ­¢ä¸€åˆ‡å¤–æ¥è®¿é—®ï¼Œç›´åˆ°é‡Šæ”¾é”ï¼Œå…·æœ‰å¼ºçƒˆçš„æ’ä»–æ€§è´¨ã€‚</li>
<li>ä¹è§‚é”ï¼šå¹¶ä¸è®¤ä¸ºä¼šæœ‰äººæ¥æŠ¢å èµ„æºï¼Œæ‰€ä»¥ä¼šç›´æ¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œåœ¨æ“ä½œæ—¶å†å»éªŒè¯æ˜¯å¦æœ‰å…¶ä»–äººæŠ¢å èµ„æºã€‚</li>
</ul>
<p>Redisä¸­å¯ä»¥ä½¿ç”¨watchæ¥ç›‘è§†ä¸€ä¸ªç›®æ ‡ï¼Œå¦‚æœæ‰§è¡Œäº‹åŠ¡ä¹‹å‰è¢«ç›‘è§†ç›®æ ‡å‘ç”Ÿäº†ä¿®æ”¹ï¼Œåˆ™å–æ¶ˆæœ¬æ¬¡äº‹åŠ¡ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">watch</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å¼€ä¸¤ä¸ªå®¢æˆ·ç«¯è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>å–æ¶ˆç›‘è§†å¯ä»¥ä½¿ç”¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">unwatch</span><br></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼ŒRedisçš„åŸºç¡€å†…å®¹å°±è®²è§£å®Œæ¯•äº†ï¼Œåœ¨ä¹‹åçš„SpringCloudé˜¶æ®µï¼Œæˆ‘ä»¬è¿˜ä¼šå»è®²è§£é›†ç¾¤ç›¸å…³çš„çŸ¥è¯†ï¼ŒåŒ…æ‹¬ä¸»ä»å¤åˆ¶ã€å“¨å…µæ¨¡å¼ç­‰ã€‚</p>
<hr>
<h2 id="ä½¿ç”¨Javaä¸Redisäº¤äº’"><a href="#ä½¿ç”¨Javaä¸Redisäº¤äº’" class="headerlink" title="ä½¿ç”¨Javaä¸Redisäº¤äº’"></a>ä½¿ç”¨Javaä¸Redisäº¤äº’</h2><p>æ—¢ç„¶äº†è§£äº†å¦‚ä½•é€šè¿‡å‘½ä»¤çª—å£æ“ä½œRedisæ•°æ®åº“ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä½¿ç”¨Javaæ¥æ“ä½œå‘¢ï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°Jedisæ¡†æ¶ï¼Œå®ƒèƒ½å¤Ÿå®ç°Javaä¸Redisæ•°æ®åº“çš„äº¤äº’ï¼Œä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="åŸºæœ¬æ“ä½œ-1"><a href="#åŸºæœ¬æ“ä½œ-1" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è¿æ¥Redisæ•°æ®åº“ï¼Œéå¸¸ç®€å•ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºJediså¯¹è±¡</span></span><br><span class="line">    <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">  	</span><br><span class="line">  	<span class="comment">//ä½¿ç”¨ä¹‹åå…³é—­è¿æ¥</span></span><br><span class="line">  	jedis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡Jediså¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è°ƒç”¨å‘½ä»¤çš„åŒåæ–¹æ³•æ¥æ‰§è¡ŒRediså‘½ä»¤äº†ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//ç›´æ¥ä½¿ç”¨try-with-resouseï¼Œçœå»close</span></span><br><span class="line">    <span class="keyword">try</span>(<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.3&quot;</span>, <span class="number">6379</span>))&#123;</span><br><span class="line">        jedis.set(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;lbwnb&quot;</span>);   <span class="comment">//ç­‰åŒäº set test lbwnb å‘½ä»¤</span></span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;test&quot;</span>));  <span class="comment">//ç­‰åŒäº get test å‘½ä»¤</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Hashç±»å‹çš„æ•°æ®ä¹Ÿæ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span>(<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.3&quot;</span>, <span class="number">6379</span>))&#123;</span><br><span class="line">        jedis.hset(<span class="string">&quot;hhh&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;sxc&quot;</span>);   <span class="comment">//ç­‰åŒäº hset hhh name sxc</span></span><br><span class="line">        jedis.hset(<span class="string">&quot;hhh&quot;</span>, <span class="string">&quot;sex&quot;</span>, <span class="string">&quot;19&quot;</span>);    <span class="comment">//ç­‰åŒäº hset hhh age 19</span></span><br><span class="line">        jedis.hgetAll(<span class="string">&quot;hhh&quot;</span>).forEach((k, v) -&gt; System.out.println(k+<span class="string">&quot;: &quot;</span>+v));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹çœ‹åˆ—è¡¨æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span>(<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.10.3&quot;</span>, <span class="number">6379</span>))&#123;</span><br><span class="line">        jedis.lpush(<span class="string">&quot;mylist&quot;</span>, <span class="string">&quot;111&quot;</span>, <span class="string">&quot;222&quot;</span>, <span class="string">&quot;333&quot;</span>);  <span class="comment">//ç­‰åŒäº lpush mylist 111 222 333 å‘½ä»¤</span></span><br><span class="line">        jedis.lrange(<span class="string">&quot;mylist&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>)</span><br><span class="line">                .forEach(System.out::println);    <span class="comment">//ç­‰åŒäº lrange mylist 0 -1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§å¯¹åº”çš„æ“ä½œå»è°ƒç”¨åŒåæ–¹æ³•å³å¯ï¼Œæ‰€æœ‰çš„ç±»å‹å°è£…Jediså·²ç»å¸®åŠ©æˆ‘ä»¬å®Œæˆäº†ã€‚</p>
<h3 id="SpringBootæ•´åˆRedis"><a href="#SpringBootæ•´åˆRedis" class="headerlink" title="SpringBootæ•´åˆRedis"></a>SpringBootæ•´åˆRedis</h3><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•åœ¨SpringBooté¡¹ç›®ä¸­æ•´åˆRedisæ“ä½œæ¡†æ¶ï¼Œåªéœ€è¦ä¸€ä¸ªstarterå³å¯ï¼Œä½†æ˜¯å®ƒåº•å±‚æ²¡æœ‰ç”¨Jedisï¼Œè€Œæ˜¯Lettuceï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>starteræä¾›çš„é»˜è®¤é…ç½®ä¼šå»è¿æ¥æœ¬åœ°çš„RedisæœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨0å·æ•°æ®åº“ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">  	<span class="comment">#RedisæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.10</span><span class="number">.3</span></span><br><span class="line">    <span class="comment">#ç«¯å£</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="comment">#ä½¿ç”¨å‡ å·æ•°æ®åº“</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>starterå·²ç»ç»™æˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªé»˜è®¤çš„æ¨¡æ¿ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">    proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;RedisOperations.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;RedisProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisAutoConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(</span></span><br><span class="line"><span class="meta">        name = &#123;&quot;redisTemplate&quot;&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line">    <span class="keyword">public</span> StringRedisTemplate <span class="title function_">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringRedisTemplate</span>(redisConnectionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆå¦‚ä½•å»ä½¿ç”¨è¿™ä¸¤ä¸ªæ¨¡æ¿ç±»å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç›´æ¥æ³¨å…¥<code>StringRedisTemplate</code>æ¥ä½¿ç”¨æ¨¡æ¿ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringBootTestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    StringRedisTemplate template;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        ValueOperations&lt;String, String&gt; operations = template.opsForValue();</span><br><span class="line">        operations.set(<span class="string">&quot;c&quot;</span>, <span class="string">&quot;xxxxx&quot;</span>);   <span class="comment">//è®¾ç½®å€¼</span></span><br><span class="line">        System.out.println(operations.get(<span class="string">&quot;c&quot;</span>));   <span class="comment">//è·å–å€¼</span></span><br><span class="line">      	</span><br><span class="line">        template.delete(<span class="string">&quot;c&quot;</span>);    <span class="comment">//åˆ é™¤é”®</span></span><br><span class="line">        System.out.println(template.hasKey(<span class="string">&quot;c&quot;</span>));   <span class="comment">//åˆ¤æ–­æ˜¯å¦åŒ…å«é”®</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šæ‰€æœ‰çš„å€¼çš„æ“ä½œéƒ½è¢«å°è£…åˆ°äº†<code>ValueOperations</code>å¯¹è±¡ä¸­ï¼Œè€Œæ™®é€šçš„é”®æ“ä½œç›´æ¥é€šè¿‡æ¨¡æ¿å¯¹è±¡å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œå¤§è‡´ä½¿ç”¨æ–¹å¼å…¶å®å’ŒJedisä¸€è‡´ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹çœ‹äº‹åŠ¡æ“ä½œï¼Œç”±äºSpringæ²¡æœ‰ä¸“é—¨çš„Redisäº‹åŠ¡ç®¡ç†å™¨ï¼Œæ‰€ä»¥åªèƒ½å€Ÿç”¨JDBCæä¾›çš„ï¼Œåªä¸è¿‡æ— æ‰€è°“ï¼Œæ­£å¸¸æƒ…å†µä¸‹åæ­£æˆ‘ä»¬ä¹Ÿè¦ç”¨åˆ°è¿™ç©æ„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    StringRedisTemplate template;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        template.setEnableTransactionSupport(<span class="literal">true</span>);   <span class="comment">//éœ€è¦å¼€å¯äº‹åŠ¡</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>    <span class="comment">//éœ€è¦æ·»åŠ æ­¤æ³¨è§£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        template.multi();</span><br><span class="line">        template.opsForValue().set(<span class="string">&quot;d&quot;</span>, <span class="string">&quot;xxxxx&quot;</span>);</span><br><span class="line">        template.exec();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºRedisTemplateå¯¹è±¡é…ç½®ä¸€ä¸ªSerializeræ¥å®ç°å¯¹è±¡çš„JSONå­˜å‚¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoad2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//æ³¨æ„Studentéœ€è¦å®ç°åºåˆ—åŒ–æ¥å£æ‰èƒ½å­˜å…¥Redis</span></span><br><span class="line">    template.opsForValue().set(<span class="string">&quot;student&quot;</span>, <span class="keyword">new</span> <span class="title class_">Student</span>());</span><br><span class="line">    System.out.println(template.opsForValue().get(<span class="string">&quot;student&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ä½¿ç”¨Redisåšç¼“å­˜"><a href="#ä½¿ç”¨Redisåšç¼“å­˜" class="headerlink" title="ä½¿ç”¨Redisåšç¼“å­˜"></a>ä½¿ç”¨Redisåšç¼“å­˜</h2><p>æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä½¿ç”¨Redisæ¥å®ç°ä¸€äº›æ¡†æ¶çš„ç¼“å­˜å’Œå…¶ä»–å­˜å‚¨ã€‚</p>
<h3 id="MybatisäºŒçº§ç¼“å­˜"><a href="#MybatisäºŒçº§ç¼“å­˜" class="headerlink" title="MybatisäºŒçº§ç¼“å­˜"></a>MybatisäºŒçº§ç¼“å­˜</h3><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨å­¦ä¹ Mybatisè®²è§£çš„ç¼“å­˜æœºåˆ¶å—ï¼Œæˆ‘ä»¬å½“æ—¶ä»‹ç»äº†äºŒçº§ç¼“å­˜ï¼Œå®ƒæ˜¯Mapperçº§åˆ«çš„ç¼“å­˜ï¼Œèƒ½å¤Ÿä½œç”¨ä¸æ‰€æœ‰ä¼šè¯ã€‚ä½†æ˜¯å½“æ—¶æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºMybatisçš„é»˜è®¤äºŒçº§ç¼“å­˜åªèƒ½æ˜¯å•æœºçš„ï¼Œå¦‚æœå­˜åœ¨å¤šå°æœåŠ¡å™¨è®¿é—®åŒä¸€ä¸ªæ•°æ®åº“ï¼Œå®é™…ä¸ŠäºŒçº§ç¼“å­˜åªä¼šåœ¨å„è‡ªçš„æœåŠ¡å™¨ä¸Šç”Ÿæ•ˆï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›çš„æ˜¯å¤šå°æœåŠ¡å™¨éƒ½èƒ½ä½¿ç”¨åŒä¸€ä¸ªäºŒçº§ç¼“å­˜ï¼Œè¿™æ ·å°±ä¸ä¼šé€ æˆè¿‡å¤šçš„èµ„æºæµªè´¹ã€‚</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/5afd7713f9a97615dc3a0b1d3bc7db27.png" alt="img"></p>
<p>æˆ‘ä»¬å¯ä»¥å°†Redisä½œä¸ºMybatisçš„äºŒçº§ç¼“å­˜ï¼Œè¿™æ ·å°±èƒ½å®ç°å¤šå°æœåŠ¡å™¨ä½¿ç”¨åŒä¸€ä¸ªäºŒçº§ç¼“å­˜ï¼Œå› ä¸ºå®ƒä»¬åªéœ€è¦è¿æ¥åŒä¸€ä¸ªRedisæœåŠ¡å™¨å³å¯ï¼Œæ‰€æœ‰çš„ç¼“å­˜æ•°æ®å…¨éƒ¨å­˜å‚¨åœ¨RedisæœåŠ¡å™¨ä¸Šã€‚æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å®ç°Mybatisæä¾›çš„Cacheæ¥å£ï¼Œè¿™é‡Œæˆ‘ä»¬ç®€å•ç¼–å†™ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®ç°Mybatisçš„Cacheæ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisMybatisCache</span> <span class="keyword">implements</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> RedisTemplate&lt;Object, Object&gt; template;</span><br><span class="line"></span><br><span class="line">   	<span class="comment">//æ³¨æ„æ„é€ æ–¹æ³•å¿…é¡»å¸¦ä¸€ä¸ªStringç±»å‹çš„å‚æ•°æ¥æ”¶id</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisMybatisCache</span><span class="params">(String id)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//åˆå§‹åŒ–æ—¶é€šè¿‡é…ç½®ç±»å°†RedisTemplateç»™è¿‡æ¥</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setTemplate</span><span class="params">(RedisTemplate&lt;Object, Object&gt; template)</span> &#123;</span><br><span class="line">        RedisMybatisCache.template = template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putObject</span><span class="params">(Object o, Object o1)</span> &#123;</span><br><span class="line">      	<span class="comment">//è¿™é‡Œç›´æ¥å‘Redisæ•°æ®åº“ä¸­ä¸¢æ•°æ®å³å¯ï¼Œoå°±æ˜¯Keyï¼Œo1å°±æ˜¯Valueï¼Œ60ç§’ä¸ºè¿‡æœŸæ—¶é—´</span></span><br><span class="line">        template.opsForValue().set(o, o1, <span class="number">60</span>, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">      	<span class="comment">//è¿™é‡Œæ ¹æ®Keyç›´æ¥ä»Redisæ•°æ®åº“ä¸­è·å–å€¼å³å¯</span></span><br><span class="line">        <span class="keyword">return</span> template.opsForValue().get(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">removeObject</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">      	<span class="comment">//æ ¹æ®Keyåˆ é™¤</span></span><br><span class="line">        <span class="keyword">return</span> template.delete(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">      	<span class="comment">//ç”±äºtemplateä¸­æ²¡å°è£…æ¸…é™¤æ“ä½œï¼Œåªèƒ½é€šè¿‡connectionæ¥æ‰§è¡Œ</span></span><br><span class="line">				template.execute((RedisCallback&lt;Void&gt;) connection -&gt; &#123;</span><br><span class="line">          	<span class="comment">//é€šè¿‡connectionå¯¹è±¡æ‰§è¡Œæ¸…ç©ºæ“ä½œ</span></span><br><span class="line">            connection.flushDb();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">      	<span class="comment">//è¿™é‡Œä¹Ÿæ˜¯ä½¿ç”¨connectionå¯¹è±¡æ¥è·å–å½“å‰çš„Keyæ•°é‡</span></span><br><span class="line">        <span class="keyword">return</span> template.execute(RedisServerCommands::dbSize).intValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼“å­˜ç±»ç¼–å†™å®Œæˆåï¼Œæˆ‘ä»¬æ¥ç€æ¥ç¼–å†™é…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RedisTemplate&lt;Object, Object&gt; template;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">      	<span class="comment">//æŠŠRedisTemplateç»™åˆ°RedisMybatisCache</span></span><br><span class="line">        RedisMybatisCache.setTemplate(template);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬åœ¨Mapperä¸Šå¯ç”¨æ­¤ç¼“å­˜å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åªéœ€è¦ä¿®æ”¹ç¼“å­˜å®ç°ç±»implementationä¸ºæˆ‘ä»¬çš„RedisMybatisCacheå³å¯</span></span><br><span class="line"><span class="meta">@CacheNamespace(implementation = RedisMybatisCache.class)</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select name from student where sid = 1&quot;)</span></span><br><span class="line">    String <span class="title function_">getSid</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬æä¾›ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥æŸ¥çœ‹å½“å‰çš„äºŒçº§ç¼“å­˜æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringBootTestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    MainMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(mapper.getSid());</span><br><span class="line">        System.out.println(mapper.getSid());</span><br><span class="line">        System.out.println(mapper.getSid());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰‹åŠ¨ä½¿ç”¨å®¢æˆ·ç«¯æŸ¥çœ‹Redisæ•°æ®åº“ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æœ‰ä¸€æ¡Mybatisç”Ÿæˆçš„ç¼“å­˜æ•°æ®äº†ã€‚</p>
<h3 id="TokenæŒä¹…åŒ–å­˜å‚¨"><a href="#TokenæŒä¹…åŒ–å­˜å‚¨" class="headerlink" title="TokenæŒä¹…åŒ–å­˜å‚¨"></a>TokenæŒä¹…åŒ–å­˜å‚¨</h3><p>æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨SpringSecurityæ—¶ï¼Œremember-meçš„Tokenæ˜¯æ”¯æŒæŒä¹…åŒ–å­˜å‚¨çš„ï¼Œè€Œæˆ‘ä»¬å½“æ—¶æ˜¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆTokenä¿¡æ¯èƒ½å¦å­˜å‚¨åœ¨ç¼“å­˜ä¸­å‘¢ï¼Œå½“ç„¶ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å®ç°ä¸€ä¸ªï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®ç°PersistentTokenRepositoryæ¥å£</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisTokenRepository</span> <span class="keyword">implements</span> <span class="title class_">PersistentTokenRepository</span> &#123;</span><br><span class="line">  	<span class="comment">//Keyåç§°å‰ç¼€ï¼Œç”¨äºåŒºåˆ†</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">REMEMBER_ME_KEY</span> <span class="operator">=</span> <span class="string">&quot;spring:security:rememberMe:&quot;</span>;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RedisTemplate&lt;Object, Object&gt; template;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createNewToken</span><span class="params">(PersistentRememberMeToken token)</span> &#123;</span><br><span class="line">      	<span class="comment">//è¿™é‡Œè¦æ”¾ä¸¤ä¸ªï¼Œä¸€ä¸ªå­˜seriesId-&gt;Tokenï¼Œä¸€ä¸ªå­˜username-&gt;seriesIdï¼Œå› ä¸ºåˆ é™¤æ—¶æ˜¯é€šè¿‡usernameåˆ é™¤</span></span><br><span class="line">        template.opsForValue().set(REMEMBER_ME_KEY+<span class="string">&quot;username:&quot;</span>+token.getUsername(), token.getSeries());</span><br><span class="line">        template.expire(REMEMBER_ME_KEY+<span class="string">&quot;username:&quot;</span>+token.getUsername(), <span class="number">1</span>, TimeUnit.DAYS);</span><br><span class="line">        <span class="built_in">this</span>.setToken(token);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//å…ˆè·å–ï¼Œç„¶åä¿®æ”¹åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼Œå†æ”¾å…¥</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateToken</span><span class="params">(String series, String tokenValue, Date lastUsed)</span> &#123;</span><br><span class="line">        <span class="type">PersistentRememberMeToken</span> <span class="variable">token</span> <span class="operator">=</span> <span class="built_in">this</span>.getToken(series);</span><br><span class="line">        <span class="keyword">if</span>(token != <span class="literal">null</span>)</span><br><span class="line">           <span class="built_in">this</span>.setToken(<span class="keyword">new</span> <span class="title class_">PersistentRememberMeToken</span>(token.getUsername(), series, tokenValue, lastUsed));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PersistentRememberMeToken <span class="title function_">getTokenForSeries</span><span class="params">(String seriesId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getToken(seriesId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//é€šè¿‡usernameæ‰¾seriesIdç›´æ¥åˆ é™¤è¿™ä¸¤ä¸ª</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeUserTokens</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">series</span> <span class="operator">=</span> (String) template.opsForValue().get(REMEMBER_ME_KEY+<span class="string">&quot;username:&quot;</span>+username);</span><br><span class="line">        template.delete(REMEMBER_ME_KEY+series);</span><br><span class="line">        template.delete(REMEMBER_ME_KEY+<span class="string">&quot;username:&quot;</span>+username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  	<span class="comment">//ç”±äºPersistentRememberMeTokenæ²¡å®ç°åºåˆ—åŒ–æ¥å£ï¼Œè¿™é‡Œåªèƒ½ç”¨Hashæ¥å­˜å‚¨äº†ï¼Œæ‰€ä»¥å•ç‹¬ç¼–å†™ä¸€ä¸ªsetå’Œgetæ“ä½œ</span></span><br><span class="line">    <span class="keyword">private</span> PersistentRememberMeToken <span class="title function_">getToken</span><span class="params">(String series)</span>&#123;</span><br><span class="line">        Map&lt;Object, Object&gt; map = template.opsForHash().entries(REMEMBER_ME_KEY+series);</span><br><span class="line">        <span class="keyword">if</span>(map.isEmpty()) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PersistentRememberMeToken</span>(</span><br><span class="line">                (String) map.get(<span class="string">&quot;username&quot;</span>),</span><br><span class="line">                (String) map.get(<span class="string">&quot;series&quot;</span>),</span><br><span class="line">                (String) map.get(<span class="string">&quot;tokenValue&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Date</span>(Long.parseLong((String) map.get(<span class="string">&quot;date&quot;</span>))));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setToken</span><span class="params">(PersistentRememberMeToken token)</span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;username&quot;</span>, token.getUsername());</span><br><span class="line">        map.put(<span class="string">&quot;series&quot;</span>, token.getSeries());</span><br><span class="line">        map.put(<span class="string">&quot;tokenValue&quot;</span>, token.getTokenValue());</span><br><span class="line">        map.put(<span class="string">&quot;date&quot;</span>, <span class="string">&quot;&quot;</span>+token.getDate().getTime());</span><br><span class="line">        template.opsForHash().putAll(REMEMBER_ME_KEY+token.getSeries(), map);</span><br><span class="line">        template.expire(REMEMBER_ME_KEY+token.getSeries(), <span class="number">1</span>, TimeUnit.DAYS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æŠŠéªŒè¯Serviceå®ç°äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> mapper.getAccountByUsername(username);</span><br><span class="line">        <span class="keyword">if</span>(account == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> User</span><br><span class="line">                .withUsername(username)</span><br><span class="line">                .password(account.getPassword())</span><br><span class="line">                .roles(account.getRole())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Mapperä¹Ÿå®‰æ’ä¸Šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String username;</span><br><span class="line">    String password;</span><br><span class="line">    String role;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CacheNamespace(implementation = MybatisRedisCache.class)</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from users where username = #&#123;username&#125;&quot;)</span></span><br><span class="line">    Account <span class="title function_">getAccountByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åé…ç½®æ–‡ä»¶é…ä¸€æ³¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http</span><br><span class="line">            .authorizeRequests()</span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .formLogin()</span><br><span class="line">            .and()</span><br><span class="line">            .rememberMe()</span><br><span class="line">            .tokenRepository(repository);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    auth</span><br><span class="line">            .userDetailsService(service)</span><br><span class="line">            .passwordEncoder(<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OKï¼Œå¯åŠ¨æœåŠ¡å™¨éªŒè¯ä¸€ä¸‹å§ã€‚</p>
<hr>
<h2 id="ä¸‰å¤§ç¼“å­˜é—®é¢˜"><a href="#ä¸‰å¤§ç¼“å­˜é—®é¢˜" class="headerlink" title="ä¸‰å¤§ç¼“å­˜é—®é¢˜"></a>ä¸‰å¤§ç¼“å­˜é—®é¢˜</h2><p><strong>æ³¨æ„ï¼š</strong>è¿™éƒ¨åˆ†å†…å®¹ä½œä¸ºé€‰å­¦å†…å®¹ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¼“å­˜æ¥å¤§å¹…åº¦æå‡æˆ‘ä»¬ç¨‹åºçš„æ•°æ®è·å–æ•ˆç‡ï¼Œä½†æ˜¯ä½¿ç”¨ç¼“å­˜ä¹Ÿå­˜åœ¨ç€ä¸€äº›æ½œåœ¨çš„é—®é¢˜ã€‚</p>
<h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><p><img src="https://mydlq-club.oss-cn-beijing.aliyuncs.com/images/springboot-cache-redis-1004.png?x-oss-process=style/shuiyin" alt="img"></p>
<p>å½“æˆ‘ä»¬å»æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œæ¯”å¦‚Mybatisåœ¨ç¼“å­˜æ˜¯æœªå‘½ä¸­çš„æƒ…å†µä¸‹éœ€è¦ä»æ•°æ®åº“æŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°æ•°æ®åº“å»æŸ¥è¯¢ï¼Œé€ æˆç¼“å­˜ç©¿é€ã€‚</p>
<p>è¿™æ˜¾ç„¶æ˜¯å¾ˆæµªè´¹èµ„æºçš„ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œä¸ºä»€ä¹ˆç¼“å­˜è¿™ä¸€å±‚ä¸ç›´æ¥è¿”å›ç©ºå‘¢ï¼Œè¿™æ—¶å°±ä¸å¿…å†å»æŸ¥æ•°æ®åº“äº†ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œç¼“å­˜ä¸å»æŸ¥æ•°æ®åº“æ€ä¹ˆçŸ¥é“æ•°æ®åº“é‡Œé¢åˆ°åº•æœ‰æ²¡æœ‰è¿™ä¸ªæ•°æ®å‘¢ï¼Ÿ</p>
<p>è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥è¿›è¡Œåˆ¤æ–­ã€‚ä»€ä¹ˆæ˜¯å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿï¼ˆå½“ç„¶ä¸æ˜¯æ‰“è¾…åŠ©çš„é‚£ä¸ªå¸ƒéš†ï¼Œåªä¸è¿‡ä¹ŸæŒºåƒï¼Œè¾…åŠ©å¸ƒéš†ä¹Ÿæ˜¯æŒ¡å­å¼¹çš„ï¼‰</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimage.bubuko.com%2Finfo%2F201903%2F20190321142642446276.png&refer=http%3A%2F%2Fimage.bubuko.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1644902390&t=4f0440b0357965ead1fa34fb27513927" alt="ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡æ¥æº"></p>
<p>ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œèƒ½å¤Ÿå‘Šè¯‰ä½ æŸæ ·ä¸œè¥¿ä¸€å®šä¸å­˜åœ¨æˆ–æ˜¯æŸæ ·ä¸œè¥¿å¯èƒ½å­˜åœ¨ã€‚</p>
<p>å¸ƒéš†è¿‡æ»¤å™¨æœ¬è´¨æ˜¯ä¸€ä¸ªå­˜æ”¾äºŒè¿›åˆ¶ä½çš„bitæ•°ç»„ï¼Œå¦‚æœæˆ‘ä»¬è¦æ·»åŠ ä¸€ä¸ªå€¼åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Nä¸ªä¸åŒçš„å“ˆå¸Œå‡½æ•°æ¥ç”ŸæˆNä¸ªå“ˆå¸Œå€¼ï¼Œå¹¶å¯¹æ¯ä¸ªç”Ÿæˆçš„å“ˆå¸Œå€¼æŒ‡å‘çš„bitä½ç½®1ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€å…±æ·»åŠ äº†ä¸‰ä¸ªå€¼abcã€‚</p>
<p>æ¥ç€æˆ‘ä»¬ç»™ä¸€ä¸ªdï¼Œé‚£ä¹ˆè¿™æ—¶å°±å¯ä»¥è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¯´dè®¡ç®—çš„Nä¸ªå“ˆå¸Œå€¼çš„ä½ç½®ä¸Šéƒ½æ˜¯1ï¼Œé‚£ä¹ˆå°±è¯´æ˜då¯èƒ½å­˜åœ¨ï¼›è¿™æ—¶å€™åˆæ¥äº†ä¸ªeï¼Œè®¡ç®—åæˆ‘ä»¬å‘ç°æœ‰ä¸€ä¸ªä½ç½®ä¸Šçš„å€¼æ˜¯0ï¼Œè¿™æ—¶å°±å¯ä»¥ç›´æ¥æ–­å®šeä¸€å®šä¸å­˜åœ¨ã€‚</p>
<h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><p><img src="https://mydlq-club.oss-cn-beijing.aliyuncs.com/images/springboot-cache-redis-1005.png?x-oss-process=style/shuiyin" alt="img"></p>
<p>æŸä¸ª Key å±äºçƒ­ç‚¹æ•°æ®ï¼Œè®¿é—®éå¸¸é¢‘ç¹ï¼ŒåŒä¸€æ—¶é—´å¾ˆå¤šäººéƒ½åœ¨è®¿é—®ï¼Œåœ¨è¿™ä¸ªKeyå¤±æ•ˆçš„ç¬é—´ï¼Œå¤§é‡çš„è¯·æ±‚åˆ°æ¥ï¼Œè¿™æ—¶å‘ç°ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œå°±å…¨éƒ½ç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œç›¸å½“äºå‡»ç©¿äº†ç¼“å­˜å±éšœï¼Œç›´æ¥æ”»å‡»æ•´ä¸ªç³»ç»Ÿæ ¸å¿ƒã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„è§£å†³åŠæ³•å°±æ˜¯ä¸è®©Keyé‚£ä¹ˆå¿«è¿‡æœŸï¼Œå¦‚æœä¸€ä¸ªKeyå¤„äºé«˜é¢‘è®¿é—®ï¼Œé‚£ä¹ˆå¯ä»¥é€‚å½“åœ°å»¶é•¿è¿‡æœŸæ—¶é—´ã€‚</p>
<h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><p><img src="https://mydlq-club.oss-cn-beijing.aliyuncs.com/images/springboot-cache-redis-1006.png?x-oss-process=style/shuiyin" alt="img"></p>
<p>å½“ä½ çš„RedisæœåŠ¡å™¨ç‚¸äº†æˆ–æ˜¯å¤§é‡çš„Keyåœ¨åŒä¸€æ—¶é—´è¿‡æœŸï¼Œè¿™æ—¶ç›¸å½“äºç¼“å­˜ç›´æ¥GGäº†ï¼Œé‚£ä¹ˆå¦‚æœè¿™æ—¶åˆæœ‰å¾ˆå¤šçš„è¯·æ±‚æ¥è®¿é—®ä¸åŒçš„æ•°æ®ï¼ŒåŒä¸€æ—¶é—´å†…ç¼“å­˜æœåŠ¡å™¨å°±å¾—å‘æ•°æ®åº“å¤§é‡å‘èµ·è¯·æ±‚æ¥é‡æ–°å»ºç«‹ç¼“å­˜ï¼Œå¾ˆå®¹æ˜“æŠŠæ•°æ®åº“ä¹ŸæGGã€‚</p>
<p>è§£å†³è¿™ç§é—®é¢˜æœ€å¥½çš„åŠæ³•å°±æ˜¯è®¾ç½®é«˜å¯ç”¨ï¼Œä¹Ÿå°±æ˜¯æ­å»ºRedisé›†ç¾¤ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é‡‡å–ä¸€äº›æœåŠ¡ç†”æ–­é™çº§æœºåˆ¶ï¼Œè¿™äº›å†…å®¹æˆ‘ä»¬ä¼šåœ¨SpringCloudé˜¶æ®µå†è¿›è¡Œæ¢è®¨ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>springBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>springBootç¬”è®°-1</title>
    <url>/2022/04/26/SpringBoot%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg-blog.csdnimg.cn%2Fimg_convert%2F174788b2ec1d828d85a0a7ac65bea2cd.png&refer=http%3A%2F%2Fimg-blog.csdnimg.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1644064714&t=46bead84c9b2fb6e0b65fd4afdaf805e" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<h1 id="SpringBootä¸€ç«™å¼å¼€å‘"><a href="#SpringBootä¸€ç«™å¼å¼€å‘" class="headerlink" title="SpringBootä¸€ç«™å¼å¼€å‘"></a>SpringBootä¸€ç«™å¼å¼€å‘</h1><p>å®˜ç½‘ï¼š<a href="https://spring.io/projects/spring-boot">https://spring.io/projects/spring-boot</a></p>
<blockquote>
<p>Spring Bootå¯ä»¥è½»æ¾åˆ›å»ºç‹¬ç«‹çš„ã€åŸºäºSpringçš„ç”Ÿäº§çº§åº”ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥è®©ä½ â€œè¿è¡Œå³å¯â€ã€‚å¤§å¤šæ•°Spring Bootåº”ç”¨ç¨‹åºåªéœ€è¦å°‘é‡çš„Springé…ç½®ã€‚</p>
</blockquote>
<span id="more"></span>

<p>SpringBootåŠŸèƒ½ï¼š</p>
<ul>
<li>åˆ›å»ºç‹¬ç«‹çš„Springåº”ç”¨ç¨‹åº</li>
<li>ç›´æ¥åµŒå…¥Tomcatã€Jettyæˆ–Undertowï¼ˆæ— éœ€éƒ¨ç½²WARåŒ…ï¼Œæ‰“åŒ…æˆJaræœ¬èº«å°±æ˜¯ä¸€ä¸ªå¯ä»¥è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼‰</li>
<li>æä¾›ä¸€ç«™å¼çš„â€œstarterâ€ä¾èµ–é¡¹ï¼Œä»¥ç®€åŒ–Mavené…ç½®ï¼ˆéœ€è¦æ•´åˆä»€ä¹ˆæ¡†æ¶ï¼Œç›´æ¥å¯¼å¯¹åº”æ¡†æ¶çš„starterä¾èµ–ï¼‰</li>
<li>å°½å¯èƒ½è‡ªåŠ¨é…ç½®Springå’Œç¬¬ä¸‰æ–¹åº“ï¼ˆé™¤éç‰¹æ®Šæƒ…å†µï¼Œå¦åˆ™å‡ ä¹ä¸éœ€è¦ä½ è¿›è¡Œä»€ä¹ˆé…ç½®ï¼‰</li>
<li>æä¾›ç”Ÿäº§å°±ç»ªåŠŸèƒ½ï¼Œå¦‚æŒ‡æ ‡ã€è¿è¡ŒçŠ¶å†µæ£€æŸ¥å’Œå¤–éƒ¨åŒ–é…ç½®</li>
<li>æ²¡æœ‰ä»£ç ç”Ÿæˆï¼Œä¹Ÿæ²¡æœ‰XMLé…ç½®çš„è¦æ±‚ï¼ˆXMLæ˜¯ä»€ä¹ˆï¼Œå¥½åƒå—ï¼‰</li>
</ul>
<p>SpringBootæ˜¯ç°åœ¨æœ€ä¸»æµçš„å¼€å‘æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€ç«™å¼çš„å¼€å‘ä½“éªŒï¼Œå¤§å¹…åº¦æé«˜äº†æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚</p>
<h2 id="èµ°è¿›SpringBoot"><a href="#èµ°è¿›SpringBoot" class="headerlink" title="èµ°è¿›SpringBoot"></a>èµ°è¿›SpringBoot</h2><p>åœ¨SSMé˜¶æ®µï¼Œå½“æˆ‘ä»¬éœ€è¦æ­å»ºä¸€ä¸ªåŸºäºSpringå…¨å®¶æ¡¶çš„Webåº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¸å¾—ä¸åšå¤§é‡çš„ä¾èµ–å¯¼å…¥å’Œæ¡†æ¶æ•´åˆç›¸å…³çš„Beanå®šä¹‰ï¼Œå…‰æ˜¯æ•´åˆæ¡†æ¶å°±èŠ±è´¹äº†æˆ‘ä»¬å¤§é‡çš„æ—¶é—´ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬å‘ç°ï¼Œæ•´åˆæ¡†æ¶å…¶å®åŸºæœ¬éƒ½æ˜¯ä¸€äº›å›ºå®šæµç¨‹ï¼Œæˆ‘ä»¬æ¯åˆ›å»ºä¸€ä¸ªæ–°çš„Webåº”ç”¨ç¨‹åºï¼ŒåŸºæœ¬éƒ½ä¼šä½¿ç”¨åŒæ ·çš„æ–¹å¼å»æ•´åˆæ¡†æ¶ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å°†ä¸€äº›é‡å¤çš„é…ç½®ä½œä¸ºçº¦å®šï¼Œåªè¦æ¡†æ¶éµå®ˆè¿™ä¸ªçº¦å®šï¼Œä¸ºæˆ‘ä»¬æä¾›é»˜è®¤çš„é…ç½®å°±å¥½ï¼Œè¿™æ ·å°±ä¸ç”¨æˆ‘ä»¬å†å»é…ç½®äº†ï¼Œçº¦å®šä¼˜äºé…ç½®ï¼</p>
<p>è€ŒSpringBootæ­£æ˜¯å°†è¿™äº›è¿‡ç¨‹å¤§å¹…åº¦è¿›è¡Œäº†ç®€åŒ–ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨è¿›è¡Œé…ç½®ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¼å…¥å¯¹åº”çš„å¯åŠ¨å™¨ï¼ˆstarterï¼‰ä¾èµ–å³å¯ã€‚</p>
<p>å®Œæˆæœ¬é˜¶æ®µçš„å­¦ä¹ ï¼ŒåŸºæœ¬èƒ½å¤Ÿèƒœä»»éƒ¨åˆ†ç½‘ç«™ç³»ç»Ÿçš„åç«¯å¼€å‘å·¥ä½œï¼Œä¹Ÿå»ºè®®åŒå­¦ä»¬å­¦ä¹ å®ŒSpringBootä¹‹åå¯»æ‰¾åˆé€‚çš„é˜Ÿå‹å»å‚åŠ è®¡ç®—æœºé¡¹ç›®ç›¸å…³çš„é«˜æ ¡ç«èµ›ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡IDEAæ¥æ¼”ç¤ºå¦‚ä½•å¿«é€Ÿåˆ›å»ºä¸€ä¸ªSpringBooté¡¹ç›®ï¼Œå¹¶ä¸”æ— éœ€ä»»ä½•é…ç½®ï¼Œå°±å¯ä»¥å®ç°Beanæ³¨å†Œã€‚</p>
<h2 id="SpringBooté¡¹ç›®æ–‡ä»¶ç»“æ„"><a href="#SpringBooté¡¹ç›®æ–‡ä»¶ç»“æ„" class="headerlink" title="SpringBooté¡¹ç›®æ–‡ä»¶ç»“æ„"></a>SpringBooté¡¹ç›®æ–‡ä»¶ç»“æ„</h2><p>æˆ‘ä»¬åœ¨åˆ›å»ºSpringBooté¡¹ç›®ä¹‹åï¼Œé¦–å…ˆä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªä¸»ç±»ï¼Œè€Œä¸»ç±»ä¸­çš„<code>main</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>SpringApplication</code>ç±»çš„é™æ€æ–¹æ³•æ¥å¯åŠ¨æ•´ä¸ªSpringBooté¡¹ç›®ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸»ç±»çš„ä¸Šæ–¹æœ‰ä¸€ä¸ª<code>@SpringBootApplication</code>æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBootTestApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringBootTestApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶è¿˜è‡ªå¸¦äº†ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œæµ‹è¯•ç±»çš„ä¸Šæ–¹ä»…æ·»åŠ äº†ä¸€ä¸ª<code>@SpringBootTest</code>æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringBootTestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹Mavenä¸­å†™äº†å“ªäº›å†…å®¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!--  çˆ¶å·¥ç¨‹  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot-study<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>SpringBootTest<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>SpringBootTest<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  spring-boot-starter SpringBootæ ¸å¿ƒå¯åŠ¨å™¨  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  spring-boot-starter-test SpringBootæµ‹è¯•æ¨¡å—å¯åŠ¨å™¨  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  SpringBoot Mavenæ’ä»¶ï¼Œæ‰“åŒ…Jaréƒ½ä¸ç”¨ä½ æ“å¿ƒäº†   --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é™¤äº†ä»¥ä¸Šè¿™äº›æ–‡ä»¶ä»¥å¤–ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ç›®å½•ä¸‹è¿˜æœ‰ï¼š</p>
<ul>
<li>.gitignore  -  Gitå¿½ç•¥åå•ï¼Œä¸‹ä¸€ç« æˆ‘ä»¬ä¼šä¸“é—¨è®²è§£Gitç‰ˆæœ¬æ§åˆ¶ã€‚</li>
<li>application.properties   -    SpringBootçš„é…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰ä¾èµ–çš„é…ç½®éƒ½åœ¨è¿™é‡Œç¼–å†™ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹åªéœ€è¦é…ç½®å¿…è¦é¡¹å³å¯ã€‚</li>
</ul>
<hr>
<h2 id="æ•´åˆWebç›¸å…³æ¡†æ¶"><a href="#æ•´åˆWebç›¸å…³æ¡†æ¶" class="headerlink" title="æ•´åˆWebç›¸å…³æ¡†æ¶"></a>æ•´åˆWebç›¸å…³æ¡†æ¶</h2><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œæ—¢ç„¶æˆ‘ä»¬å‰é¢æåˆ°SpringBootä¼šå†…åµŒä¸€ä¸ªTomcatæœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„Jaræ‰“åŒ…åï¼Œç›¸å½“äºå°±æ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•åˆ›å»ºä¸€ä¸ªSpringBootWebé¡¹ç›®ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºä½¿ç”¨IDEAæ¥åˆ›å»ºä¸€ä¸ªåŸºäºSpringBootçš„Webåº”ç”¨ç¨‹åºã€‚</p>
<h3 id="å®ƒæ˜¯çœŸçš„å¿«"><a href="#å®ƒæ˜¯çœŸçš„å¿«" class="headerlink" title="å®ƒæ˜¯çœŸçš„å¿«"></a>å®ƒæ˜¯çœŸçš„å¿«</h3><p>åˆ›å»ºå®Œæˆåï¼Œç›´æ¥å¼€å¯é¡¹ç›®ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è®¿é—®ï¼š<a href="http://localhost:8080/%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%EF%BC%8C%E4%BD%86%E6%98%AF%E7%94%B1%E4%BA%8E%E6%88%91%E4%BB%AC%E6%B2%A1%E6%9C%89%E7%BC%96%E5%86%99%E4%BB%BB%E4%BD%95%E7%9A%84%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84%EF%BC%8C%E6%89%80%E4%BB%A5%E6%B2%A1%E6%9C%89%E6%95%B0%E6%8D%AE%E3%80%82%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%9D%A5%E7%9C%8B%E7%9C%8B%E6%97%A5%E5%BF%97%EF%BC%9A">http://localhost:8080/ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æ²¡æœ‰ç¼–å†™ä»»ä½•çš„è¯·æ±‚æ˜ å°„ï¼Œæ‰€ä»¥æ²¡æœ‰æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥æ¥çœ‹çœ‹æ—¥å¿—ï¼š</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2022-01-06 22:17:46.308  INFO 853 --- [           main] c.example.SpringBootWebTestApplication   : Starting SpringBootWebTestApplication using Java 1.8.0_312 on NagodeMacBook-Pro.local with PID 853 (/Users/nagocoler/Downloads/SpringBootWebTest/target/classes started by nagocoler in /Users/nagocoler/Downloads/SpringBootWebTest)</span><br><span class="line">2022-01-06 22:17:46.309  INFO 853 --- [           main] c.example.SpringBootWebTestApplication   : No active profile set, falling back to default profiles: default</span><br><span class="line">2022-01-06 22:17:46.629  INFO 853 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)</span><br><span class="line">2022-01-06 22:17:46.632  INFO 853 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2022-01-06 22:17:46.632  INFO 853 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.56]</span><br><span class="line">2022-01-06 22:17:46.654  INFO 853 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2022-01-06 22:17:46.654  INFO 853 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 325 ms</span><br><span class="line">2022-01-06 22:17:46.780  INFO 853 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#x27;&#x27;</span><br><span class="line">2022-01-06 22:17:46.785  INFO 853 --- [           main] c.example.SpringBootWebTestApplication   : Started SpringBootWebTestApplication in 0.62 seconds (JVM running for 0.999)</span><br><span class="line">2022-01-06 22:18:02.979  INFO 853 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet &#x27;dispatcherServlet&#x27;</span><br><span class="line">2022-01-06 22:18:02.979  INFO 853 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet &#x27;dispatcherServlet&#x27;</span><br><span class="line">2022-01-06 22:18:02.980  INFO 853 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ—¥å¿—ä¸­é™¤äº†æœ€åŸºæœ¬çš„SpringBootå¯åŠ¨æ—¥å¿—ä»¥å¤–ï¼Œè¿˜æ–°å¢äº†å†…åµŒWebæœåŠ¡å™¨ï¼ˆTomcatï¼‰çš„å¯åŠ¨æ—¥å¿—ï¼Œå¹¶ä¸”æ˜¾ç¤ºäº†å½“å‰WebæœåŠ¡å™¨æ‰€å¼€æ”¾çš„ç«¯å£ï¼Œå¹¶ä¸”è‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬åˆå§‹åŒ–äº†DispatcherServletï¼Œä½†æ˜¯æˆ‘ä»¬åªæ˜¯åˆ›å»ºäº†é¡¹ç›®ï¼Œå¯¼å…¥äº†webç›¸å…³çš„starterä¾èµ–ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•çš„é…ç½®ï¼Œå®é™…ä¸Šå®ƒä½¿ç”¨çš„æ˜¯starteræä¾›çš„é»˜è®¤é…ç½®è¿›è¡Œåˆå§‹åŒ–çš„ã€‚</p>
<p>ç”±äºSpringBootæ˜¯è‡ªåŠ¨æ‰«æçš„ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥åˆ›å»ºä¸€ä¸ªControllerå³å¯è¢«åŠ è½½ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainController</span> &#123;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//ç›´æ¥è®¿é—®http://localhost:8080/indexå³å¯ï¼Œä¸ç”¨åŠ webåº”ç”¨ç¨‹åºåç§°äº†</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ä½ å¥½ï¼Œæ¬¢è¿è®¿é—®ä¸»é¡µï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‡ ä¹æ²¡æœ‰åšä»»ä½•é…ç½®ï¼Œä½†æ˜¯å¯ä»¥ç›´æ¥å¼€å§‹é…ç½®Controllerï¼ŒSpringBootåˆ›å»ºä¸€ä¸ªWebé¡¹ç›®çš„é€Ÿåº¦å°±æ˜¯è¿™ä¹ˆå¿«ï¼</p>
<p>å®ƒè¿˜å¯ä»¥è‡ªåŠ¨è¯†åˆ«ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œé‚£ä¹ˆå®ƒä¼šè‡ªåŠ¨è½¬æ¢ä¸ºJSONæ•°æ®æ ¼å¼ï¼Œæ— éœ€é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="type">int</span> sid;</span><br><span class="line">    String name;</span><br><span class="line">    String sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/student&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Student <span class="title function_">student</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">    student.setName(<span class="string">&quot;å°æ˜&quot;</span>);</span><br><span class="line">    student.setSex(<span class="string">&quot;ç”·&quot;</span>);</span><br><span class="line">    student.setSid(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæµè§ˆå™¨èƒ½å¤Ÿç›´æ¥å¾—åˆ°<code>application/json</code>çš„å“åº”æ•°æ®ï¼Œå°±æ˜¯è¿™ä¹ˆæ–¹ä¾¿ã€‚</p>
<h3 id="ä¿®æ”¹Webç›¸å…³é…ç½®"><a href="#ä¿®æ”¹Webç›¸å…³é…ç½®" class="headerlink" title="ä¿®æ”¹Webç›¸å…³é…ç½®"></a>ä¿®æ”¹Webç›¸å…³é…ç½®</h3><p>å¦‚æœæˆ‘ä»¬éœ€è¦ä¿®æ”¹WebæœåŠ¡å™¨çš„ç«¯å£æˆ–æ˜¯ä¸€äº›å…¶ä»–çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨<code>application.properties</code>ä¸­è¿›è¡Œä¿®æ”¹ï¼Œå®ƒæ˜¯æ•´ä¸ªSpringBootçš„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹ç«¯å£ä¸º80</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">80</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ç¼–å†™è‡ªå®šä¹‰çš„é…ç½®é¡¹ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­é€šè¿‡<code>@Value</code>ç›´æ¥æ³¨å…¥ï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">test.data</span>=<span class="string">100</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.data&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> data;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´å¥½åœ°å°†ä¸€äº›éœ€è¦é¢‘ç¹ä¿®æ”¹çš„é…ç½®é¡¹å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡æ³¨è§£æ–¹å¼å»è·å–å€¼ã€‚</p>
<p>é…ç½®æ–‡ä»¶é™¤äº†ä½¿ç”¨<code>properties</code>æ ¼å¼ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ç§å«åš<code>yaml</code>æ ¼å¼ï¼Œå®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">ä¸€çº§ç›®å½•:</span></span><br><span class="line">	<span class="string">äºŒçº§ç›®å½•:</span></span><br><span class="line">	  <span class="string">ä¸‰çº§ç›®å½•1:</span> <span class="string">å€¼</span></span><br><span class="line">	  <span class="string">ä¸‰çº§ç›®å½•2:</span> <span class="string">å€¼</span></span><br><span class="line">	  <span class="string">ä¸‰çº§ç›®å½•List:</span> </span><br><span class="line">	  <span class="bullet">-</span> <span class="string">å…ƒç´ 1</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">å…ƒç´ 2</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">å…ƒç´ 3</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€çº§ç›®å½•éƒ½æ˜¯é€šè¿‡ç¼©è¿›ï¼ˆä¸èƒ½ä½¿ç”¨Tabï¼Œåªèƒ½ä½¿ç”¨ç©ºæ ¼ï¼‰åŒºåˆ†ï¼Œå¹¶ä¸”é”®å’Œå€¼ä¹‹é—´éœ€è¦æ·»åŠ å†’å·+ç©ºæ ¼æ¥è¡¨ç¤ºã€‚</p>
<p>SpringBootä¹Ÿæ”¯æŒè¿™ç§æ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>application.properties</code>ä¿®æ”¹ä¸º<code>application.yml</code>æˆ–æ˜¯<code>application.yaml</code>æ¥ä½¿ç”¨YAMLè¯­æ³•ç¼–å†™é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h3 id="æ•´åˆSpringSecurityä¾èµ–"><a href="#æ•´åˆSpringSecurityä¾èµ–" class="headerlink" title="æ•´åˆSpringSecurityä¾èµ–"></a>æ•´åˆSpringSecurityä¾èµ–</h3><p>æˆ‘ä»¬æ¥ç€æ¥æ•´åˆä¸€ä¸‹SpringSecurityä¾èµ–ï¼Œç»§ç»­æ„Ÿå—SpringBootå¸¦æ¥çš„å…‰é€Ÿå¼€å‘ä½“éªŒï¼Œåªéœ€è¦å¯¼å…¥SpringSecurityçš„Starterä¾èµ–å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯¼å…¥ä¾èµ–åï¼Œæˆ‘ä»¬ç›´æ¥å¯åŠ¨SpringBootåº”ç”¨ç¨‹åºï¼Œå¯ä»¥å‘ç°SpringSecurityå·²ç»ç”Ÿæ•ˆäº†ã€‚</p>
<p>å¹¶ä¸”SpringSecurityä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªé»˜è®¤ç”¨æˆ·<code>user</code>ï¼Œå®ƒçš„å¯†ç ä¼šå‡ºç°åœ¨æ—¥å¿—ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2022-01-06 23:10:51.329  INFO 2901 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2022-01-06 23:10:51.329  INFO 2901 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.56]</span><br><span class="line">2022-01-06 23:10:51.350  INFO 2901 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2022-01-06 23:10:51.351  INFO 2901 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 341 ms</span><br><span class="line">2022-01-06 23:10:51.469  INFO 2901 --- [           main] .s.s.UserDetailsServiceAutoConfiguration : </span><br><span class="line"></span><br><span class="line">Using generated security password: ff24bee3-e1b7-4309-9609-d32618baf5cb</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>ff24bee3-e1b7-4309-9609-d32618baf5cb</code>å°±æ˜¯éšæœºç”Ÿæˆçš„ä¸€ä¸ªå¯†ç ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤ç”¨æˆ·ç™»å½•ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ç›´æ¥é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">test</span>   <span class="comment"># ç”¨æˆ·å</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span>  <span class="comment"># å¯†ç </span></span><br><span class="line">      <span class="attr">roles:</span>   <span class="comment"># è§’è‰²</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">user</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">admin</span></span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šè¿™æ ·çš„é…ç½®æ–¹å¼å°±æ˜¯ä¸€ä¸ª<code>inMemoryAuthentication</code>ï¼Œåªæ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥é…ç½®è€Œå·²ã€‚</p>
<p>å½“ç„¶ï¼Œé¡µé¢çš„æ§åˆ¶å’Œæ•°æ®åº“éªŒè¯æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æä¾›<code>WebSecurityConfigurerAdapter</code>çš„å®ç°ç±»å»å®Œæˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/login&quot;</span>).permitAll()</span><br><span class="line">                .anyRequest().hasRole(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™é‡Œä¸éœ€è¦å†æ·»åŠ <code>@EnableWebSecurity</code>äº†ï¼Œå› ä¸ºstarterä¾èµ–å·²ç»å¸®æˆ‘ä»¬æ·»åŠ äº†ã€‚</p>
<p>ä½¿ç”¨äº†SpringBootä¹‹åï¼Œæˆ‘ä»¬å‘ç°ï¼Œéœ€è¦ä»€ä¹ˆåŠŸèƒ½ï¼Œåªéœ€è¦å¯¼å…¥å¯¹åº”çš„starterä¾èµ–å³å¯ï¼Œç”šè‡³éƒ½ä¸éœ€è¦ä½ å»è¿›è¡Œé¢å¤–çš„é…ç½®ï¼Œä½ åªéœ€è¦å…³æ³¨ä¾èµ–æœ¬èº«çš„å¿…è¦è®¾ç½®å³å¯ï¼Œå¤§å¤§æé«˜äº†æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ã€‚</p>
<hr>
<h2 id="æ•´åˆMybatisæ¡†æ¶"><a href="#æ•´åˆMybatisæ¡†æ¶" class="headerlink" title="æ•´åˆMybatisæ¡†æ¶"></a>æ•´åˆMybatisæ¡†æ¶</h2><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•æ•´åˆMybatisæ¡†æ¶ï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¼å…¥å¯¹åº”çš„starterä¾èµ–å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯¼å…¥ä¾èµ–åï¼Œç›´æ¥å¯åŠ¨ä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸ºæœ‰å¿…è¦çš„é…ç½®æˆ‘ä»¬æ²¡æœ‰å»ç¼–å†™ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šæ•°æ®æºçš„ç›¸å…³ä¿¡æ¯ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>å†æ¬¡å¯åŠ¨ï¼ŒæˆåŠŸã€‚</p>
<p>æˆ‘ä»¬å‘ç°æ—¥å¿—ä¸­ä¼šå‡ºç°è¿™æ ·ä¸€å¥è¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2022-01-07 12:32:09.106  WARN 6917 --- [           main] o.m.s.mapper.ClassPathMapperScanner      : No MyBatis mapper was found in &#x27;[com.example]&#x27; package. Please check your configuration.</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯Mybatisè‡ªåŠ¨æ‰«æè¾“å‡ºçš„è¯­å¥ï¼Œå¯¼å…¥ä¾èµ–åï¼Œæˆ‘ä»¬ä¸éœ€è¦å†å»è®¾ç½®Mybatisçš„ç›¸å…³Beanäº†ï¼Œä¹Ÿä¸éœ€è¦æ·»åŠ ä»»ä½•<code>@MapperSacn</code>æ³¨è§£ï¼Œå› ä¸ºstarterå·²ç»å¸®åŠ©æˆ‘ä»¬åšäº†ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰«æé¡¹ç›®ä¸­æ·»åŠ äº†<code>@Mapper</code>æ³¨è§£çš„æ¥å£ï¼Œç›´æ¥å°†å…¶æ³¨å†Œä¸ºBeanï¼Œä¸éœ€è¦è¿›è¡Œä»»ä½•é…ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MainMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from users where username = #&#123;username&#125;&quot;)</span></span><br><span class="line">    UserData <span class="title function_">findUserByName</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œå¦‚æœä½ è§‰å¾—æ¯ä¸ªæ¥å£éƒ½å»åŠ ä¸€ä¸ª<code>@Mapper</code>æ¯”è¾ƒéº»çƒ¦çš„è¯ä¹Ÿå¯ä»¥ç”¨å›ä¹‹å‰çš„æ–¹å¼ï¼Œç›´æ¥<code>@MapperScan</code>ä½¿ç”¨åŒ…æ‰«æã€‚</p>
<p>æ·»åŠ Mapperä¹‹åï¼Œä½¿ç”¨æ–¹æ³•å’ŒSSMé˜¶æ®µæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¸SpringSecurityç»“åˆä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAuthService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    MainMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="type">UserData</span> <span class="variable">data</span> <span class="operator">=</span> mapper.findUserByName(username);</span><br><span class="line">        <span class="keyword">if</span>(data == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;ç”¨æˆ· &quot;</span>+username+<span class="string">&quot; ç™»å½•å¤±è´¥ï¼Œç”¨æˆ·åä¸å­˜åœ¨ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> User</span><br><span class="line">                .withUsername(data.getUsername())</span><br><span class="line">                .password(data.getPassword())</span><br><span class="line">                .roles(data.getRole())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åé…ç½®ä¸€ä¸‹è‡ªå®šä¹‰éªŒè¯å³å¯ï¼Œæ³¨æ„è¿™æ ·ä¹‹å‰é…ç½®æ–‡ä»¶é‡Œé¢é…ç½®çš„ç”¨æˆ·å°±å¤±æ•ˆäº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    auth</span><br><span class="line">            .userDetailsService(service)</span><br><span class="line">            .passwordEncoder(<span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å‘ç°æ—¥å¿—ä¸­è¾“å‡ºä»¥ä»¥ä¸‹è¯­å¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2022-01-07 12:39:40.559  INFO 6930 --- [nio-8080-exec-3] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...</span><br><span class="line">2022-01-07 12:39:41.033  INFO 6930 --- [nio-8080-exec-3] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼ŒSpringBootä¼šè‡ªåŠ¨ä¸ºMybatisé…ç½®æ•°æ®æºï¼Œé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯<code>HikariCP</code>æ•°æ®æºã€‚</p>
<hr>
<h2 id="æ•´åˆThymeleafæ¡†æ¶"><a href="#æ•´åˆThymeleafæ¡†æ¶" class="headerlink" title="æ•´åˆThymeleafæ¡†æ¶"></a>æ•´åˆThymeleafæ¡†æ¶</h2><p>æ•´åˆThymeleafä¹Ÿåªéœ€å¯¼å…¥å¯¹åº”çš„starterå³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åªéœ€è¦ç›´æ¥ä½¿ç”¨å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æ³¨æ„ï¼Œè¿™æ ·åªèƒ½æ­£å¸¸è§£æHTMLé¡µé¢ï¼Œä½†æ˜¯jsã€cssç­‰é™æ€èµ„æºæˆ‘ä»¬éœ€è¦è¿›è¡Œè·¯å¾„æŒ‡å®šï¼Œä¸ç„¶æ— æ³•è®¿é—®ï¼Œæˆ‘ä»¬åœ¨é…æ–‡ä»¶ä¸­é…ç½®ä¸€ä¸‹é™æ€èµ„æºçš„è®¿é—®å‰ç¼€ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">mvc:</span></span><br><span class="line">  	<span class="attr">static-path-pattern:</span> <span class="string">/static/**</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åƒä¹‹å‰ä¸€æ ·ï¼ŒæŠŠç™»é™†é¡µé¢å®ç°ä¸€ä¸‹å§ã€‚</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">http://www.thymeleaf.org</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:sec</span>=<span class="string">http://www.thymeleaf.org/extras/spring-security</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="æ—¥å¿—ç³»ç»Ÿ"><a href="#æ—¥å¿—ç³»ç»Ÿ" class="headerlink" title="æ—¥å¿—ç³»ç»Ÿ"></a>æ—¥å¿—ç³»ç»Ÿ</h2><p>SpringBootä¸ºæˆ‘ä»¬æä¾›äº†ä¸°å¯Œçš„æ—¥å¿—ç³»ç»Ÿï¼Œå®ƒå‡ ä¹æ˜¯å¼€ç®±å³ç”¨çš„ã€‚</p>
<h3 id="æ—¥å¿—é—¨é¢å’Œæ—¥å¿—å®ç°"><a href="#æ—¥å¿—é—¨é¢å’Œæ—¥å¿—å®ç°" class="headerlink" title="æ—¥å¿—é—¨é¢å’Œæ—¥å¿—å®ç°"></a>æ—¥å¿—é—¨é¢å’Œæ—¥å¿—å®ç°</h3><p>æˆ‘ä»¬é¦–å…ˆè¦åŒºåˆ†ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯æ—¥å¿—é—¨é¢ï¼ˆFacadeï¼‰ä»€ä¹ˆæ˜¯æ—¥å¿—å®ç°ï¼Œæˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„JULå®é™…ä¸Šå°±æ˜¯ä¸€ç§æ—¥å¿—å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨JULä¸ºæˆ‘ä»¬æä¾›çš„æ—¥å¿—æ¡†æ¶æ¥è§„èŒƒåŒ–æ‰“å°æ—¥å¿—ï¼Œè€Œæ—¥å¿—é—¨é¢ï¼Œå¦‚Slf4jï¼Œæ˜¯æŠŠä¸åŒçš„æ—¥å¿—ç³»ç»Ÿçš„å®ç°è¿›è¡Œäº†å…·ä½“çš„æŠ½è±¡åŒ–ï¼Œåªæä¾›äº†ç»Ÿä¸€çš„æ—¥å¿—ä½¿ç”¨æ¥å£ï¼Œä½¿ç”¨æ—¶åªéœ€è¦æŒ‰ç…§å…¶æä¾›çš„æ¥å£æ–¹æ³•è¿›è¡Œè°ƒç”¨å³å¯ï¼Œç”±äºå®ƒåªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„å¯ä»¥ç›´æ¥å•ç‹¬ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶ï¼Œæ‰€ä»¥æœ€ç»ˆæ—¥å¿—çš„æ ¼å¼ã€è®°å½•çº§åˆ«ã€è¾“å‡ºæ–¹å¼ç­‰éƒ½è¦é€šè¿‡æ¥å£ç»‘å®šçš„å…·ä½“çš„æ—¥å¿—ç³»ç»Ÿæ¥å®ç°ï¼Œè¿™äº›å…·ä½“çš„æ—¥å¿—ç³»ç»Ÿå°±æœ‰log4jã€logbackã€java.util.loggingç­‰ï¼Œå®ƒä»¬æ‰å®ç°äº†å…·ä½“çš„æ—¥å¿—ç³»ç»Ÿçš„åŠŸèƒ½ã€‚</p>
<p>æ—¥å¿—é—¨é¢å’Œæ—¥å¿—å®ç°å°±åƒJDBCå’Œæ•°æ®åº“é©±åŠ¨ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯ç”»å¤§é¥¼çš„ï¼Œä¸€ä¸ªæ˜¯çœŸçš„å»åšé¥¼çš„ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2909474-b5127a18b3eda3ec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/888" alt="img"></p>
<p>ä½†æ˜¯ç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œä¸åŒçš„æ¡†æ¶å¯èƒ½ä½¿ç”¨äº†ä¸åŒçš„æ—¥å¿—æ¡†æ¶ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™å‡ºç°ä¼—å¤šæ—¥å¿—æ¡†æ¶å¹¶å­˜çš„æƒ…å†µï¼Œæˆ‘ä»¬ç°åœ¨å¸Œæœ›çš„æ˜¯æ‰€æœ‰çš„æ¡†æ¶ä¸€å¾‹ä½¿ç”¨æ—¥å¿—é—¨é¢ï¼ˆSlf4jï¼‰è¿›è¡Œæ—¥å¿—æ‰“å°ï¼Œè¿™æ—¶è¯¥æ€ä¹ˆå»è§£å†³ï¼Ÿæˆ‘ä»¬ä¸å¯èƒ½å°†å…¶ä»–æ¡†æ¶ä¾èµ–çš„æ—¥å¿—æ¡†æ¶æ›¿æ¢æ‰ï¼Œç›´æ¥æ›´æ¢ä¸ºSlf4jå§ï¼Œè¿™æ ·æ˜¾ç„¶ä¸ç°å®ã€‚</p>
<p>è¿™æ—¶ï¼Œå¯ä»¥é‡‡å–ç±»ä¼¼äºå·æ¢æ¢æŸ±çš„åšæ³•ï¼Œåªä¿ç•™ä¸åŒæ—¥å¿—æ¡†æ¶çš„æ¥å£å’Œç±»å®šä¹‰ç­‰å…³é”®ä¿¡æ¯ï¼Œè€Œå°†å®ç°å…¨éƒ¨å®šå‘ä¸ºSlf4jè°ƒç”¨ã€‚ç›¸å½“äºæœ‰ç€å’ŒåŸæœ‰æ—¥å¿—æ¡†æ¶ä¸€æ ·çš„å¤–å£³ï¼Œå¯¹äºå…¶ä»–æ¡†æ¶æ¥è¯´ä¾ç„¶å¯ä»¥ä½¿ç”¨å¯¹åº”çš„ç±»è¿›è¡Œæ“ä½œï¼Œè€Œå…·ä½“å¦‚ä½•æ‰§è¡Œï¼ŒçœŸæ­£çš„å†…å¿ƒå·²ç»æ˜¯Slf4jçš„äº†ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2909474-512f5cca92e05e59.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/928" alt="img"></p>
<p>æ‰€ä»¥ï¼ŒSpringBootä¸ºäº†ç»Ÿä¸€æ—¥å¿—æ¡†æ¶çš„ä½¿ç”¨ï¼Œåšäº†è¿™äº›äº‹æƒ…ï¼š</p>
<ul>
<li>ç›´æ¥å°†å…¶ä»–ä¾èµ–ä»¥å‰çš„æ—¥å¿—æ¡†æ¶å‰”é™¤</li>
<li>å¯¼å…¥å¯¹åº”æ—¥å¿—æ¡†æ¶çš„Slf4jä¸­é—´åŒ…</li>
<li>å¯¼å…¥è‡ªå·±å®˜æ–¹æŒ‡å®šçš„æ—¥å¿—å®ç°ï¼Œå¹¶ä½œä¸ºSlf4jçš„æ—¥å¿—å®ç°å±‚</li>
</ul>
<h3 id="åœ¨SpringBootä¸­æ‰“å°æ—¥å¿—ä¿¡æ¯"><a href="#åœ¨SpringBootä¸­æ‰“å°æ—¥å¿—ä¿¡æ¯" class="headerlink" title="åœ¨SpringBootä¸­æ‰“å°æ—¥å¿—ä¿¡æ¯"></a>åœ¨SpringBootä¸­æ‰“å°æ—¥å¿—ä¿¡æ¯</h3><p>SpringBootä½¿ç”¨çš„æ˜¯Slf4jä½œä¸ºæ—¥å¿—é—¨é¢ï¼ŒLogbackï¼ˆ<a href="http://logback.qos.ch/">Logback</a> æ˜¯log4j æ¡†æ¶çš„ä½œè€…å¼€å‘çš„æ–°ä¸€ä»£æ—¥å¿—æ¡†æ¶ï¼Œå®ƒæ•ˆç‡æ›´é«˜ã€èƒ½å¤Ÿé€‚åº”è¯¸å¤šçš„è¿è¡Œç¯å¢ƒï¼ŒåŒæ—¶å¤©ç„¶æ”¯æŒSLF4Jï¼‰ä½œä¸ºæ—¥å¿—å®ç°ï¼Œå¯¹åº”çš„ä¾èµ–ä¸ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ­¤ä¾èµ–å·²ç»è¢«åŒ…å«äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœéœ€è¦æ‰“å°æ—¥å¿—ï¼Œå¯ä»¥åƒè¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">login</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(MainController.class);</span><br><span class="line">    logger.info(<span class="string">&quot;ç”¨æˆ·è®¿é—®äº†ä¸€æ¬¡ç™»é™†ç•Œé¢&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†Lombokï¼Œæ‰€ä»¥ç›´æ¥ä¸€ä¸ªæ³¨è§£ä¹Ÿå¯ä»¥æå®šå“¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;ç”¨æˆ·è®¿é—®äº†ä¸€æ¬¡ç™»é™†ç•Œé¢&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ—¥å¿—çº§åˆ«ä»ä½åˆ°é«˜åˆ†ä¸ºTRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATALï¼ŒSpringBooté»˜è®¤åªä¼šæ‰“å°INFOä»¥ä¸Šçº§åˆ«çš„ä¿¡æ¯ã€‚</p>
<h3 id="é…ç½®Logbackæ—¥å¿—"><a href="#é…ç½®Logbackæ—¥å¿—" class="headerlink" title="é…ç½®Logbackæ—¥å¿—"></a>é…ç½®Logbackæ—¥å¿—</h3><p>Logbackå®˜ç½‘ï¼š<a href="https://logback.qos.ch/">https://logback.qos.ch</a></p>
<p>å’ŒJULä¸€æ ·ï¼ŒLogbackä¹Ÿèƒ½å®ç°å®šåˆ¶åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼ŒSpringBootæ¨èå°†é…ç½®æ–‡ä»¶åç§°å‘½åä¸º<code>logback-spring.xml</code>è¡¨ç¤ºè¿™æ˜¯SpringBootä¸‹Logbackä¸“ç”¨çš„é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨SpringBoot çš„é«˜çº§Proï¬leåŠŸèƒ½ï¼Œå®ƒçš„å†…å®¹ç±»ä¼¼äºè¿™æ ·ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœ€å¤–å±‚ç”±<code>configuration</code>åŒ…è£¹ï¼Œä¸€æ—¦ç¼–å†™ï¼Œé‚£ä¹ˆå°±ä¼šæ›¿æ¢é»˜è®¤çš„é…ç½®ï¼Œæ‰€ä»¥å¦‚æœå†…éƒ¨ä»€ä¹ˆéƒ½ä¸å†™çš„è¯ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æˆ‘ä»¬çš„SpringBooté¡¹ç›®æ²¡æœ‰é…ç½®ä»»ä½•æ—¥å¿—è¾“å‡ºæ–¹å¼ï¼Œæ§åˆ¶å°ä¹Ÿä¸ä¼šæ‰“å°æ—¥å¿—ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•é…ç½®ä¸€ä¸ªæ§åˆ¶å°æ—¥å¿—æ‰“å°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¼å…¥å¹¶ä½¿ç”¨SpringBootä¸ºæˆ‘ä»¬é¢„è®¾å¥½çš„æ—¥å¿—æ ¼å¼ï¼Œåœ¨<code>org/springframework/boot/logging/logback/defaults.xml</code>ä¸­å·²ç»å¸®æˆ‘ä»¬æŠŠæ—¥å¿—çš„è¾“å‡ºæ ¼å¼å®šä¹‰å¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦è®¾ç½®å¯¹åº”çš„<code>appender</code>å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">included</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">&quot;clr&quot;</span> <span class="attr">converterClass</span>=<span class="string">&quot;org.springframework.boot.logging.logback.ColorConverter&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">&quot;wex&quot;</span> <span class="attr">converterClass</span>=<span class="string">&quot;org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">&quot;wEx&quot;</span> <span class="attr">converterClass</span>=<span class="string">&quot;org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE_LOG_PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;CONSOLE_LOG_PATTERN:-%clr(%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS&#125;&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&#125;&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE_LOG_CHARSET&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;CONSOLE_LOG_CHARSET:-$&#123;file.encoding:-UTF-8&#125;&#125;&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;FILE_LOG_PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;FILE_LOG_PATTERN:-%d&#123;$&#123;LOG_DATEFORMAT_PATTERN:-yyyy-MM-dd HH:mm:ss.SSS&#125;&#125; $&#123;LOG_LEVEL_PATTERN:-%5p&#125; $&#123;PID:- &#125; --- [%t] %-40.40logger&#123;39&#125; : %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;&#125;&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;FILE_LOG_CHARSET&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;FILE_LOG_CHARSET:-$&#123;file.encoding:-UTF-8&#125;&#125;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.catalina.startup.DigesterFactory&quot;</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.catalina.util.LifecycleBase&quot;</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.sshd.common.util.SecurityUtils&quot;</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.tomcat.util.net.NioSelectorPool&quot;</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.eclipse.jetty.util.component.AbstractLifeCycle&quot;</span> <span class="attr">level</span>=<span class="string">&quot;ERROR&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.hibernate.validator.internal.util.Version&quot;</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework.boot.actuate.endpoint.jmx&quot;</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">included</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯¼å…¥åï¼Œæˆ‘ä»¬åˆ©ç”¨é¢„è®¾çš„æ—¥å¿—æ ¼å¼åˆ›å»ºä¸€ä¸ªæ§åˆ¶å°æ—¥å¿—æ‰“å°ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  å¯¼å…¥å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œä½œä¸ºé¢„è®¾  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">&quot;org/springframework/boot/logging/logback/defaults.xml&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  Appenderä½œä¸ºæ—¥å¿—æ‰“å°å™¨é…ç½®ï¼Œè¿™é‡Œå‘½åéšæ„  --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  ch.qos.logback.core.ConsoleAppenderæ˜¯ä¸“ç”¨äºæ§åˆ¶å°çš„Appender  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>$&#123;CONSOLE_LOG_CHARSET&#125;<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  æŒ‡å®šæ—¥å¿—è¾“å‡ºçº§åˆ«ï¼Œä»¥åŠå¯ç”¨çš„Appenderï¼Œè¿™é‡Œå°±ä½¿ç”¨äº†æˆ‘ä»¬ä¸Šé¢çš„ConsoleAppender  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å‘ç°æ§åˆ¶å°å·²ç»å¯ä»¥æ­£å¸¸æ‰“å°æ—¥å¿—ä¿¡æ¯äº†ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å¼€å¯æ–‡ä»¶æ‰“å°ï¼Œæˆ‘ä»¬åªéœ€è¦é…ç½®ä¸€ä¸ªå¯¹åº”çš„Appenderå³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--  ch.qos.logback.core.rolling.RollingFileAppenderç”¨äºæ–‡ä»¶æ—¥å¿—è®°å½•ï¼Œå®ƒæ”¯æŒæ»šåŠ¨  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;FILE_LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">charset</span>&gt;</span>$&#123;FILE_LOG_CHARSET&#125;<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  è‡ªå®šä¹‰æ»šåŠ¨ç­–ç•¥ï¼Œé˜²æ­¢æ—¥å¿—æ–‡ä»¶æ— é™å˜å¤§ï¼Œä¹Ÿå°±æ˜¯æ—¥å¿—æ–‡ä»¶å†™åˆ°ä»€ä¹ˆæ—¶å€™ä¸ºæ­¢ï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶å¼€å§‹å†™  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  æ–‡ä»¶ä¿å­˜ä½ç½®ä»¥åŠæ–‡ä»¶å‘½åè§„åˆ™ï¼Œè¿™é‡Œç”¨åˆ°äº†%d&#123;yyyy-MM-dd&#125;è¡¨ç¤ºå½“å‰æ—¥æœŸï¼Œ%iè¡¨ç¤ºè¿™ä¸€å¤©çš„ç¬¬Nä¸ªæ—¥å¿—  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">FileNamePattern</span>&gt;</span>log/%d&#123;yyyy-MM-dd&#125;-spring-%i.log<span class="tag">&lt;/<span class="name">FileNamePattern</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  åˆ°æœŸè‡ªåŠ¨æ¸…ç†æ—¥å¿—æ–‡ä»¶  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">cleanHistoryOnStart</span>&gt;</span>true<span class="tag">&lt;/<span class="name">cleanHistoryOnStart</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  æœ€å¤§æ—¥å¿—ä¿ç•™æ—¶é—´  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>7<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  æœ€å¤§å•ä¸ªæ—¥å¿—æ–‡ä»¶å¤§å°  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>10MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--  æŒ‡å®šæ—¥å¿—è¾“å‡ºçº§åˆ«ï¼Œä»¥åŠå¯ç”¨çš„Appenderï¼Œè¿™é‡Œå°±ä½¿ç”¨äº†æˆ‘ä»¬ä¸Šé¢çš„ConsoleAppender  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ—¥å¿—æ–‡ä»¶ä¹Ÿèƒ½è‡ªåŠ¨ç”Ÿæˆäº†ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é­”æ”¹å®˜æ–¹æä¾›çš„æ—¥å¿—æ ¼å¼ï¼Œå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://logback.qos.ch/manual/layouts.html">https://logback.qos.ch/manual/layouts.html</a></p>
<p>è¿™é‡Œéœ€è¦æåŠçš„æ˜¯MDCæœºåˆ¶ï¼ŒLogbackå†…ç½®çš„æ—¥å¿—å­—æ®µè¿˜æ˜¯æ¯”è¾ƒå°‘ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ‰“å°æœ‰å…³ä¸šåŠ¡çš„æ›´å¤šçš„å†…å®¹ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰çš„ä¸€äº›æ•°æ®ï¼Œéœ€è¦å€ŸåŠ©logback MDCæœºåˆ¶ï¼ŒMDCä¸ºâ€œMapped Diagnostic Contextâ€ï¼ˆæ˜ å°„è¯Šæ–­ä¸Šä¸‹æ–‡ï¼‰ï¼Œå³å°†ä¸€äº›è¿è¡Œæ—¶çš„ä¸Šä¸‹æ–‡æ•°æ®é€šè¿‡logbackæ‰“å°å‡ºæ¥ï¼›æ­¤æ—¶æˆ‘ä»¬éœ€è¦å€ŸåŠ©org.sl4j.MDCç±»ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦è®°å½•æ˜¯å“ªä¸ªç”¨æˆ·è®¿é—®æˆ‘ä»¬ç½‘ç«™çš„æ—¥å¿—ï¼Œåªè¦æ˜¯æ­¤ç”¨æˆ·è®¿é—®æˆ‘ä»¬ç½‘ç«™ï¼Œéƒ½ä¼šåœ¨æ—¥å¿—ä¸­æºå¸¦è¯¥ç”¨æˆ·çš„IDï¼Œæˆ‘ä»¬å¸Œæœ›æ¯æ¡æ—¥å¿—ä¸­éƒ½æºå¸¦è¿™æ ·ä¸€æ®µä¿¡æ¯æ–‡æœ¬ï¼Œè€Œå®˜æ–¹æä¾›çš„å­—æ®µæ— æ³•å®ç°æ­¤åŠŸèƒ½ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨MDCæœºåˆ¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">()</span>&#123;</span><br><span class="line">      	<span class="comment">//è¿™é‡Œå°±ç”¨Sessionä»£æ›¿IDå§</span></span><br><span class="line">        MDC.put(<span class="string">&quot;reqId&quot;</span>, request.getSession().getId());</span><br><span class="line">        log.info(<span class="string">&quot;ç”¨æˆ·è®¿é—®äº†ä¸€æ¬¡ç™»é™†ç•Œé¢&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘æ—¥å¿—ä¸­ä¼ å…¥è‡ªå®šä¹‰å‚æ•°äº†ï¼Œæˆ‘ä»¬æ—¥å¿—ä¸­æ·»åŠ è¿™æ ·ä¸€ä¸ªå ä½ç¬¦<code>%X&#123;é”®å€¼&#125;</code>ï¼Œåå­—ä¿æŒä¸€è‡´ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">%clr([%X&#123;reqId&#125;])&#123;faint&#125; </span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å½“æˆ‘ä»¬å‘MDCä¸­æ·»åŠ ä¿¡æ¯åï¼Œåªè¦æ˜¯å½“å‰çº¿ç¨‹ï¼ˆæœ¬è´¨æ˜¯ThreadLocalå®ç°ï¼‰ä¸‹è¾“å‡ºçš„æ—¥å¿—ï¼Œéƒ½ä¼šè‡ªåŠ¨æ›¿æ¢å ä½ç¬¦ã€‚</p>
<h3 id="è‡ªå®šä¹‰Banner"><a href="#è‡ªå®šä¹‰Banner" class="headerlink" title="è‡ªå®šä¹‰Banner"></a>è‡ªå®šä¹‰Banner</h3><p>æˆ‘ä»¬åœ¨ä¹‹å‰å‘ç°ï¼Œå®é™…ä¸ŠBanneréƒ¨åˆ†å’Œæ—¥å¿—éƒ¨åˆ†æ˜¯ç‹¬ç«‹çš„ï¼ŒSpringBootå¯åŠ¨åï¼Œä¼šå…ˆæ‰“å°Banneréƒ¨åˆ†ï¼Œé‚£ä¹ˆè¿™ä¸ªBanneréƒ¨åˆ†æ˜¯å¦å¯ä»¥è‡ªå®šä¹‰å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥æ¥é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>banner.txt</code>çš„æ–‡æœ¬æ–‡æ¡£ï¼Œå†…å®¹éšä¾¿ä½ ï¼š</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">//                          _ooOoo_                               //</span><br><span class="line">//                         o8888888o                              //</span><br><span class="line">//                         88&quot; . &quot;88                              //</span><br><span class="line">//                         (| ^_^ |)                              //</span><br><span class="line">//                         O\  =  /O                              //</span><br><span class="line">//                      ____/`---&#x27;\____                           //</span><br><span class="line">//                    .&#x27;  \\|     |//  `.                         //</span><br><span class="line">//                   /  \\|||  :  |||//  \                        //</span><br><span class="line">//                  /  _||||| -:- |||||-  \                       //</span><br><span class="line">//                  |   | \\\  -  /// |   |                       //</span><br><span class="line">//                  | \_|  &#x27;&#x27;\---/&#x27;&#x27;  |   |                       //</span><br><span class="line">//                  \  .-\__  `-`  ___/-. /                       //</span><br><span class="line">//                ___`. .&#x27;  /--.--\  `. . ___                     //</span><br><span class="line">//              .&quot;&quot; &#x27;&lt;  `.___\_&lt;|&gt;_/___.&#x27;  &gt;&#x27;&quot;&quot;.                  //</span><br><span class="line">//            | | :  `- \`.;`\ _ /`;.`/ - ` : | |                 //</span><br><span class="line">//            \  \ `-.   \_ __\ /__ _/   .-` /  /                 //</span><br><span class="line">//      ========`-.____`-.___\_____/___.-`____.-&#x27;========         //</span><br><span class="line">//                           `=---=&#x27;                              //</span><br><span class="line">//      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^        //</span><br><span class="line">//             ä½›ç¥–ä¿ä½‘          æ°¸æ— BUG         æ°¸ä¸ä¿®æ”¹             //</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨åœ¨çº¿ç”Ÿæˆç½‘ç«™è¿›è¡Œç”Ÿæˆè‡ªå·±çš„ä¸ªæ€§Bannerï¼š<a href="https://www.bootschool.net/ascii">https://www.bootschool.net/ascii</a></p>
<p>æˆ‘ä»¬ç”šè‡³è¿˜å¯ä»¥ä½¿ç”¨é¢œè‰²ä»£ç æ¥ä¸ºæ–‡æœ¬åˆ‡æ¢é¢œè‰²ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$&#123;AnsiColor.BRIGHT_GREEN&#125;  //ç»¿è‰²</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥è·å–ä¸€äº›å¸¸ç”¨çš„å˜é‡ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$&#123;AnsiColor.YELLOW&#125; å½“å‰ Spring Boot ç‰ˆæœ¬ï¼š$&#123;spring-boot.version&#125;</span><br></pre></td></tr></table></figure>

<p>ç©çš„å¼€å¿ƒï¼</p>
<hr>
<h2 id="å¤šç¯å¢ƒé…ç½®"><a href="#å¤šç¯å¢ƒé…ç½®" class="headerlink" title="å¤šç¯å¢ƒé…ç½®"></a>å¤šç¯å¢ƒé…ç½®</h2><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é¡¹ç›®ä¼šæœ‰å¤šä¸ªç¯å¢ƒã€‚ä¾‹å¦‚å¼€å‘ç¯å¢ƒï¼ˆdevelopï¼‰ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç ”å‘è¿‡ç¨‹ä¸­ç–¯ç‹‚æ•²ä»£ç ä¿®BUGé˜¶æ®µï¼Œç”Ÿäº§ç¯å¢ƒï¼ˆproduction ï¼‰é¡¹ç›®å¼€å‘å¾—å·®ä¸å¤šäº†ï¼Œå¯ä»¥æ”¾åœ¨æœåŠ¡å™¨ä¸Šè·‘äº†ã€‚ä¸åŒçš„ç¯å¢ƒä¸‹ï¼Œå¯èƒ½æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ä¹Ÿå­˜åœ¨ä¸åŒï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å¯èƒ½åˆ‡æ¢ç¯å¢ƒçš„æ—¶å€™åˆå»é‡æ–°å†™ä¸€æ¬¡é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªç¯å¢ƒçš„é…ç½®æ–‡ä»¶æå‰å†™å¥½ï¼Œè¿›è¡Œè‡ªç”±åˆ‡æ¢ã€‚</p>
<p>ç”±äºSpringBootåªä¼šè¯»å–<code>application.properties</code>æˆ–æ˜¯<code>application.yml</code>æ–‡ä»¶ï¼Œé‚£ä¹ˆæ€ä¹ˆæ‰èƒ½å®ç°è‡ªç”±åˆ‡æ¢å‘¢ï¼ŸSpringBootç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®šï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åˆ†åˆ«åˆ›å»ºä¸¤ä¸ªç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œ<code>application-dev.yml</code>å’Œ<code>application-prod.yml</code>åˆ†åˆ«è¡¨ç¤ºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚å¼€å‘ç¯å¢ƒæˆ‘ä»¬ä½¿ç”¨çš„æœåŠ¡å™¨ç«¯å£ä¸º8080ï¼Œè€Œç”Ÿäº§ç¯å¢ƒä¸‹å¯èƒ½å°±éœ€è¦è®¾ç½®ä¸º80æˆ–æ˜¯443ç«¯å£ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸åŒç¯å¢ƒä¸‹çš„é…ç½®æ–‡ä»¶è¿›è¡ŒåŒºåˆ†ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çµæ´»åˆ‡æ¢ç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒä¸‹çš„é…ç½®æ–‡ä»¶äº†ã€‚</p>
<p>SpringBootè‡ªå¸¦çš„Logbackæ—¥å¿—ç³»ç»Ÿä¹Ÿæ˜¯æ”¯æŒå¤šç¯å¢ƒé…ç½®çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³åœ¨å¼€å‘ç¯å¢ƒä¸‹è¾“å‡ºæ—¥å¿—åˆ°æ§åˆ¶å°ï¼Œè€Œç”Ÿäº§ç¯å¢ƒä¸‹åªéœ€è¦è¾“å‡ºåˆ°æ–‡ä»¶å³å¯ï¼Œè¿™æ—¶å°±éœ€è¦è¿›è¡Œç¯å¢ƒé…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;prod&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„<code>springProfile</code>æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼</p>
<p>é‚£å¦‚æœæˆ‘ä»¬å¸Œæœ›ç”Ÿäº§ç¯å¢ƒä¸­ä¸è¦æ‰“åŒ…å¼€å‘ç¯å¢ƒä¸‹çš„é…ç½®æ–‡ä»¶å‘¢ï¼Œæˆ‘ä»¬ç›®å‰è™½ç„¶å¯ä»¥åˆ‡æ¢å¼€å‘ç¯å¢ƒï¼Œä½†æ˜¯æ‰“åŒ…çš„æ—¶å€™ä¾ç„¶æ˜¯æ‰€æœ‰é…ç½®æ–‡ä»¶å…¨éƒ¨æ‰“åŒ…ï¼Œè¿™æ ·æ€»æ„Ÿè§‰è¿˜æ¬ ç¼ºä¸€ç‚¹å®Œç¾ï¼Œå› æ­¤ï¼Œæ‰“åŒ…çš„é—®é¢˜å°±åªèƒ½æ‰¾Mavenè§£å†³äº†ï¼ŒMavenä¹Ÿå¯ä»¥è®¾ç½®å¤šç¯å¢ƒï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--åˆ†åˆ«è®¾ç½®å¼€å‘ï¼Œç”Ÿäº§ç¯å¢ƒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å‘ç¯å¢ƒ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">environment</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ç”Ÿäº§ç¯å¢ƒ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>false<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">environment</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ç¯å¢ƒçš„ä¸åŒï¼Œæ’é™¤å…¶ä»–ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ’é™¤é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å…ˆæ’é™¤æ‰€æœ‰çš„é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--ä½¿ç”¨é€šé…ç¬¦ï¼Œå½“ç„¶å¯ä»¥å®šä¹‰å¤šä¸ªexcludeæ ‡ç­¾è¿›è¡Œæ’é™¤--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>application*.yml<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æ ¹æ®æ¿€æ´»æ¡ä»¶å¼•å…¥æ‰“åŒ…æ‰€éœ€çš„é…ç½®å’Œæ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¼•å…¥æ‰€éœ€ç¯å¢ƒçš„é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>application.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ ¹æ®mavené€‰æ‹©ç¯å¢ƒå¯¼å…¥é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>application-$&#123;environment&#125;.yml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†Mavenä¸­çš„<code>environment</code>å±æ€§ï¼Œä¼ é€’ç»™SpringBootçš„é…ç½®æ–‡ä»¶ï¼Œåœ¨æ„å»ºæ—¶æ›¿æ¢ä¸ºå¯¹åº”çš„å€¼ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">&#x27;@environment@&#x27;</span>  <span class="comment">#æ³¨æ„YAMLé…ç½®æ–‡ä»¶éœ€è¦åŠ å•å¼•å·ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæ ¹æ®æˆ‘ä»¬Mavenç¯å¢ƒçš„åˆ‡æ¢ï¼ŒSpringBootçš„é…ç½®æ–‡ä»¶ä¹Ÿä¼šè¿›è¡Œå¯¹åº”çš„åˆ‡æ¢ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ‰“å¼€Mavenæ ç›®ï¼Œå°±å¯ä»¥è‡ªç”±åˆ‡æ¢äº†ï¼Œç›´æ¥å‹¾é€‰å³å¯ï¼Œæ³¨æ„åˆ‡æ¢ç¯å¢ƒä¹‹åè¦é‡æ–°åŠ è½½ä¸€ä¸‹Mavené¡¹ç›®ï¼Œä¸ç„¶ä¸ä¼šç”Ÿæ•ˆï¼</p>
<hr>
<h2 id="æ‰“åŒ…è¿è¡Œ"><a href="#æ‰“åŒ…è¿è¡Œ" class="headerlink" title="æ‰“åŒ…è¿è¡Œ"></a>æ‰“åŒ…è¿è¡Œ</h2><p>ç°åœ¨æˆ‘ä»¬çš„SpringBooté¡¹ç›®ç¼–å†™å®Œæˆäº†ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰“åŒ…è¿è¡Œå‘¢ï¼Ÿéå¸¸ç®€å•ï¼Œåªéœ€è¦ç‚¹å‡»Mavenç”Ÿå‘½å‘¨æœŸä¸­çš„<code>package</code>å³å¯ï¼Œå®ƒä¼šè‡ªåŠ¨å°†å…¶æ‰“åŒ…ä¸ºå¯ç›´æ¥è¿è¡Œçš„JaråŒ…ï¼Œç¬¬ä¸€æ¬¡æ‰“åŒ…å¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ä¸‹è½½éƒ¨åˆ†ä¾èµ–çš„æºç ä¸€èµ·æ‰“åŒ…è¿›Jaræ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬å‘ç°åœ¨æ‰“åŒ…çš„è¿‡ç¨‹ä¸­è¿˜ä¼šå®Œæ•´çš„å°†é¡¹ç›®è·‘ä¸€éè¿›è¡Œæµ‹è¯•ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³æµ‹è¯•ç›´æ¥æ‰“åŒ…ï¼Œå¯ä»¥æ‰‹åŠ¨ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mvn package  -DskipTests</span><br></pre></td></tr></table></figure>

<p>æ‰“åŒ…åï¼Œæˆ‘ä»¬ä¼šç›´æ¥å¾—åˆ°ä¸€ä¸ªåä¸º<code>springboot-study-0.0.1-SNAPSHOT.jar</code>çš„æ–‡ä»¶ï¼Œè¿™æ—¶åœ¨CMDçª—å£ä¸­è¾“å…¥å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar springboot-study-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥åï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„Javaé¡¹ç›®æˆåŠŸè¿è¡Œèµ·æ¥äº†ï¼Œå¦‚æœæ‰‹åŠ¨å…³é—­çª—å£ä¼šå¯¼è‡´æ•´ä¸ªé¡¹ç›®ç»ˆæ­¢è¿è¡Œã€‚</p>
<hr>
<h2 id="å†è°ˆSpringæ¡†æ¶"><a href="#å†è°ˆSpringæ¡†æ¶" class="headerlink" title="å†è°ˆSpringæ¡†æ¶"></a>å†è°ˆSpringæ¡†æ¶</h2><p><strong>æ³¨æ„ï¼š</strong>å¼€å§‹æœ¬éƒ¨åˆ†å‰ï¼Œå»ºè®®å…ˆå®ŒæˆSSMé˜¶æ®µçš„Springæºç è®²è§£éƒ¨åˆ†ã€‚</p>
<p>æˆ‘ä»¬åœ¨SpringBooté˜¶æ®µï¼Œéœ€è¦ç»§ç»­æ‰©å……Springæ¡†æ¶çš„ç›¸å…³çŸ¥è¯†ï¼Œæ¥å·©å›ºå’Œå¼ºåŒ–å¯¹äºSpringæ¡†æ¶çš„è®¤è¯†ã€‚</p>
<h3 id="ä»»åŠ¡è°ƒåº¦"><a href="#ä»»åŠ¡è°ƒåº¦" class="headerlink" title="ä»»åŠ¡è°ƒåº¦"></a>ä»»åŠ¡è°ƒåº¦</h3><p>ä¸ºäº†æ‰§è¡ŒæŸäº›ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦ä¸€äº›éå¸¸è§„çš„æ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†æˆ‘ä»¬çš„ç»“æœæˆ–æ˜¯æ‰§è¡Œä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œåˆ°è¾¾æŒ‡å®šæ—¶é—´å†å»æ‰§è¡Œã€‚</p>
<p>è¿™æ—¶æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥å¤„ç†ï¼Œæˆ–æ˜¯ä½¿ç”¨TimerTaskæ¥å®Œæˆå®šæ—¶ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰äº†Springæ¡†æ¶ä¹‹åï¼Œå°±ä¸ç”¨è¿™æ ·äº†ï¼Œå› ä¸ºSpringæ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›äº†æ›´åŠ ä¾¿æ·çš„æ–¹å¼è¿›è¡Œä»»åŠ¡è°ƒåº¦ã€‚</p>
<h4 id="å¼‚æ­¥ä»»åŠ¡"><a href="#å¼‚æ­¥ä»»åŠ¡" class="headerlink" title="å¼‚æ­¥ä»»åŠ¡"></a>å¼‚æ­¥ä»»åŠ¡</h4><p>éœ€è¦ä½¿ç”¨Springå¼‚æ­¥ä»»åŠ¡æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®ç±»ä¸Šæ·»åŠ <code>@EnableAsync</code>æˆ–æ˜¯åœ¨SpringBootçš„å¯åŠ¨ç±»ä¸Šæ·»åŠ ä¹Ÿå¯ä»¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBootWebTestApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringBootWebTestApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åªéœ€è¦åœ¨éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„æ–¹æ³•ä¸Šï¼Œæ·»åŠ <code>@Async</code>æ³¨è§£å³å¯å°†æ­¤æ–¹æ³•æ ‡è®°ä¸ºå¼‚æ­¥ï¼Œå½“æ­¤æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šå¼‚æ­¥æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ–°å¼€ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä¸æ˜¯åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘æ˜¯å¼‚æ­¥ä»»åŠ¡ï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    service.test();</span><br><span class="line">    System.out.println(<span class="string">&quot;æˆ‘æ˜¯åŒæ­¥ä»»åŠ¡ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šè¿™ä¹Ÿæ˜¯å¾—ç›ŠäºAOPæœºåˆ¶ï¼Œé€šè¿‡çº¿ç¨‹æ± å®ç°ï¼Œä½†æ˜¯ä¹Ÿè¦æ³¨æ„ï¼Œæ­£æ˜¯å› ä¸ºå®ƒæ˜¯AOPæœºåˆ¶çš„äº§ç‰©ï¼Œæ‰€ä»¥å®ƒåªèƒ½æ˜¯åœ¨Beanä¸­æ‰ä¼šç”Ÿæ•ˆï¼</p>
<p>ä½¿ç”¨ @Async æ³¨é‡Šçš„æ–¹æ³•å¯ä»¥è¿”å› â€˜voidâ€™ æˆ– â€œFutureâ€ ç±»å‹ï¼ŒFutureæ˜¯ä¸€ç§ç”¨äºæ¥æ”¶ä»»åŠ¡æ‰§è¡Œç»“æœçš„ä¸€ç§ç±»å‹ï¼Œæˆ‘ä»¬ä¼šåœ¨Javaå¹¶å‘ç¼–ç¨‹ä¸­è¿›è¡Œè®²è§£ï¼Œè¿™é‡Œæš‚æ—¶ä¸åšä»‹ç»ã€‚</p>
<h4 id="å®šæ—¶ä»»åŠ¡"><a href="#å®šæ—¶ä»»åŠ¡" class="headerlink" title="å®šæ—¶ä»»åŠ¡"></a>å®šæ—¶ä»»åŠ¡</h4><p>çœ‹å®Œäº†å¼‚æ­¥ä»»åŠ¡ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡å…¶å®å°±æ˜¯æŒ‡å®šåœ¨å“ªä¸ªæ—¶å€™å†å»æ‰§è¡Œï¼Œåœ¨JavaSEé˜¶æ®µæˆ‘ä»¬ä½¿ç”¨è¿‡TimerTaskæ¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡ã€‚</p>
<p>Springä¸­çš„å®šæ—¶ä»»åŠ¡æ˜¯å…¨å±€æ€§è´¨çš„ï¼Œå½“æˆ‘ä»¬çš„Springç¨‹åºå¯åŠ¨åï¼Œé‚£ä¹ˆå®šæ—¶ä»»åŠ¡ä¹Ÿå°±è·Ÿç€å¯åŠ¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é…ç½®ç±»ä¸Šæ·»åŠ <code>@EnableScheduling</code>æˆ–æ˜¯åœ¨SpringBootçš„å¯åŠ¨ç±»ä¸Šæ·»åŠ ä¹Ÿå¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBootWebTestApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringBootWebTestApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡é…ç½®ç±»ï¼Œåœ¨é…ç½®ç±»é‡Œé¢ç¼–å†™å®šæ—¶ä»»åŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduleConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(fixedRate = 2000)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">task</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯å®šæ—¶ä»»åŠ¡ï¼&quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ³¨æ„åˆ°<code> @Scheduled</code>ä¸­æœ‰å¾ˆå¤šå‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šâ€™cronâ€™, â€˜fixedDelay(String)â€™, or â€˜fixedRate(String)â€™çš„å…¶ä¸­ä¸€ä¸ªï¼Œå¦åˆ™æ— æ³•åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œä»–ä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>fixedDelayï¼šåœ¨ä¸Šä¸€æ¬¡å®šæ—¶ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œé—´éš”å¤šä¹…ç»§ç»­æ‰§è¡Œã€‚</li>
<li>fixedRateï¼šæ— è®ºä¸Šä¸€æ¬¡å®šæ—¶ä»»åŠ¡æœ‰æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œä¸¤æ¬¡ä»»åŠ¡ä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚</li>
<li>cronï¼šä½¿ç”¨cronè¡¨è¾¾å¼æ¥æŒ‡å®šä»»åŠ¡è®¡åˆ’ã€‚</li>
</ul>
<p>è¿™é‡Œé‡ç‚¹è®²è§£ä¸€ä¸‹cronè¡¨è¾¾å¼ï¼š<a href="https://blog.csdn.net/sunnyzyq/article/details/98597252">https://blog.csdn.net/sunnyzyq/article/details/98597252</a></p>
<h3 id="ç›‘å¬å™¨"><a href="#ç›‘å¬å™¨" class="headerlink" title="ç›‘å¬å™¨"></a>ç›‘å¬å™¨</h3><p>ç›‘å¬å™¨å¯¹æˆ‘ä»¬æ¥è¯´ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒé™Œç”Ÿçš„æ¦‚å¿µï¼Œé‚£ä¹ˆä½•è°“ç›‘å¬å‘¢ï¼Ÿ</p>
<p>ç›‘å¬å®é™…ä¸Šå°±æ˜¯ç­‰å¾…æŸä¸ªäº‹ä»¶çš„è§¦å‘ï¼Œå½“äº‹ä»¶è§¦å‘æ—¶ï¼Œå¯¹åº”äº‹ä»¶çš„ç›‘å¬å™¨å°±ä¼šè¢«é€šçŸ¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;ContextRefreshedEvent&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ContextRefreshedEvent event)</span> &#123;</span><br><span class="line">        System.out.println(event.getApplicationContext());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ç›‘å¬äº‹ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å¯¹åº”çš„æ—¶æœºè¿›è¡Œä¸€äº›é¢å¤–çš„å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ–­ç‚¹è°ƒè¯•æ¥æŸ¥çœ‹ä¸€ä¸ªäº‹ä»¶æ˜¯å¦‚ä½•å‘ç”Ÿï¼Œä»¥åŠå¦‚ä½•é€šçŸ¥ç›‘å¬å™¨çš„ã€‚</p>
<p>é€šè¿‡é˜…è¯»æºç ï¼Œæˆ‘ä»¬å¾—çŸ¥ï¼Œä¸€ä¸ªäº‹ä»¶å®é™…ä¸Šå°±æ˜¯é€šè¿‡<code>publishEvent</code>æ–¹æ³•æ¥è¿›è¡Œå‘å¸ƒçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æˆ‘ä»¬è‡ªå·±é¡¹ç›®ä¸­çš„äº‹ä»¶ï¼Œå¹¶æ³¨å†Œå¯¹åº”çš„ç›‘å¬å™¨è¿›è¡Œå¤„ç†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestEvent</span> <span class="keyword">extends</span> <span class="title class_">ApplicationEvent</span> &#123;   <span class="comment">//éœ€è¦ç»§æ‰¿ApplicationEvent</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TestEvent</span><span class="params">(Object source)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;TestEvent&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(TestEvent event)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è‡ªå®šä¹‰äº‹ä»¶å‘ç”Ÿäº†ï¼š&quot;</span>+event.getSource());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">ApplicationContext context;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    context.publishEvent(<span class="keyword">new</span> <span class="title class_">TestEvent</span>(<span class="string">&quot;æœ‰äººè®¿é—®äº†ç™»å½•ç•Œé¢ï¼&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®ç°äº†è‡ªå®šä¹‰äº‹ä»¶å‘å¸ƒå’Œç›‘å¬ã€‚</p>
<h3 id="Awareç³»åˆ—æ¥å£"><a href="#Awareç³»åˆ—æ¥å£" class="headerlink" title="Awareç³»åˆ—æ¥å£"></a>Awareç³»åˆ—æ¥å£</h3><p>æˆ‘ä»¬åœ¨ä¹‹å‰è®²è§£Springæºç æ—¶ï¼Œç»å¸¸ä¼šå‘ç°æŸäº›ç±»çš„å®šä¹‰ä¸Šï¼Œé™¤äº†æˆ‘ä»¬å½“æ—¶è®²è§£çš„ç»§æ‰¿å…³ç³»ä»¥å¤–ï¼Œè¿˜å®ç°äº†ä¸€äº›æ¥å£ï¼Œä»–ä»¬çš„åç§°åŸºæœ¬éƒ½æ˜¯<code>xxxxAware</code>ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨è®²è§£SpringSecurityçš„æºç ä¸­ï¼ŒAbstractAuthenticationProcessingFilterç±»å°±æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractAuthenticationProcessingFilter</span> <span class="keyword">extends</span> <span class="title class_">GenericFilterBean</span> <span class="keyword">implements</span> <span class="title class_">ApplicationEventPublisherAware</span>, MessageSourceAware &#123;</span><br><span class="line">    <span class="keyword">protected</span> ApplicationEventPublisher eventPublisher;</span><br><span class="line">    <span class="keyword">protected</span> AuthenticationDetailsSource&lt;HttpServletRequest, ?&gt; authenticationDetailsSource = <span class="keyword">new</span> <span class="title class_">WebAuthenticationDetailsSource</span>();</span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°å®ƒé™¤äº†ç»§æ‰¿è‡ªGenericFilterBeanä¹‹å¤–ï¼Œè¿˜å®ç°äº†ApplicationEventPublisherAwareå’ŒMessageSourceAwareæ¥å£ï¼Œé‚£ä¹ˆè¿™äº›Awareæ¥å£åˆ°åº•æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿ</p>
<p>Awareçš„ä¸­æ–‡æ„æ€ä¸º<strong>æ„ŸçŸ¥</strong>ã€‚ç®€å•æ¥è¯´ï¼Œä»–å°±æ˜¯ä¸€ä¸ªæ ‡è¯†ï¼Œå®ç°æ­¤æ¥å£çš„ç±»ä¼šè·å¾—æŸäº›æ„ŸçŸ¥èƒ½åŠ›ï¼ŒSpringå®¹å™¨ä¼šåœ¨Beanè¢«åŠ è½½æ—¶ï¼Œæ ¹æ®ç±»å®ç°çš„æ„ŸçŸ¥æ¥å£ï¼Œä¼šè°ƒç”¨ç±»ä¸­å®ç°çš„å¯¹åº”æ„ŸçŸ¥æ–¹æ³•ã€‚</p>
<p>æ¯”å¦‚AbstractAuthenticationProcessingFilterå°±å®ç°äº†ApplicationEventPublisherAwareæ¥å£ï¼Œæ­¤æ¥å£çš„æ„ŸçŸ¥åŠŸèƒ½ä¸ºäº‹ä»¶å‘å¸ƒå™¨ï¼Œåœ¨BeanåŠ è½½æ—¶ï¼Œä¼šè°ƒç”¨å®ç°ç±»ä¸­çš„<code>setApplicationEventPublisher</code>æ–¹æ³•ï¼Œè€ŒAbstractAuthenticationProcessingFilterç±»åˆ™åˆ©ç”¨æ­¤æ–¹æ³•ï¼Œåœ¨BeanåŠ è½½é˜¶æ®µè·å¾—äº†å®¹å™¨çš„äº‹ä»¶å‘å¸ƒå™¨ï¼Œä»¥ä¾¿ä¹‹åå‘å¸ƒäº‹ä»¶ä½¿ç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationEventPublisher</span><span class="params">(ApplicationEventPublisher eventPublisher)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.eventPublisher = eventPublisher;   <span class="comment">//ç›´æ¥å­˜åˆ°æˆå‘˜å˜é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">successfulAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">    <span class="type">SecurityContext</span> <span class="variable">context</span> <span class="operator">=</span> SecurityContextHolder.createEmptyContext();</span><br><span class="line">    context.setAuthentication(authResult);</span><br><span class="line">    SecurityContextHolder.setContext(context);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isDebugEnabled()) &#123;</span><br><span class="line">        <span class="built_in">this</span>.logger.debug(LogMessage.format(<span class="string">&quot;Set SecurityContextHolder to %s&quot;</span>, authResult));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.rememberMeServices.loginSuccess(request, response, authResult);</span><br><span class="line">  	<span class="comment">//åœ¨è¿™é‡Œä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.eventPublisher != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">InteractiveAuthenticationSuccessEvent</span>(authResult, <span class="built_in">this</span>.getClass()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.successHandler.onAuthenticationSuccess(request, response, authResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œé™¤äº†ApplicationEventPublisherAwareæ¥å£å¤–ï¼Œæˆ‘ä»¬å†æ¥æ¼”ç¤ºä¸€ä¸ªæ¥å£ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestService</span> <span class="keyword">implements</span> <span class="title class_">BeanNameAware</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanName</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BeanNameAwareå°±æ˜¯æ„ŸçŸ¥Beanåç§°çš„ä¸€ä¸ªæ¥å£ï¼Œå½“Beanè¢«åŠ è½½æ—¶ï¼Œä¼šè°ƒç”¨<code>setBeanName</code>æ–¹æ³•å¹¶å°†Beanåç§°ä½œä¸ºå‚æ•°ä¼ é€’ã€‚</p>
<p>æœ‰å…³æ‰€æœ‰çš„Awareè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p>
<hr>
<h2 id="æ¢ç©¶SpringBootå®ç°åŸç†"><a href="#æ¢ç©¶SpringBootå®ç°åŸç†" class="headerlink" title="æ¢ç©¶SpringBootå®ç°åŸç†"></a>æ¢ç©¶SpringBootå®ç°åŸç†</h2><p><strong>æ³¨æ„ï¼š</strong>éš¾åº¦è¾ƒå¤§ï¼Œæœ¬ç‰ˆå—ä½œä¸ºé€‰å­¦å†…å®¹ï¼Œåœ¨å¼€å§‹å‰ï¼Œå¿…é¡»å®ŒæˆSSMé˜¶æ®µæºç è§£æéƒ¨åˆ†çš„å­¦ä¹ ã€‚</p>
<p>æˆ‘ä»¬åœ¨å‰é¢çš„å­¦ä¹ ä¸­åˆ‡å®æ„Ÿå—åˆ°äº†SpringBootä¸ºæˆ‘ä»¬å¸¦æ¥çš„ä¾¿æ·ï¼Œé‚£ä¹ˆå®ƒä¸ºä½•èƒ½å¤Ÿå®ç°å¦‚æ­¤å¿«æ·çš„å¼€å‘æ¨¡å¼ï¼Œstarteråˆæ˜¯ä¸€ä¸ªæ€æ ·çš„å­˜åœ¨ï¼Œå®ƒæ˜¯å¦‚ä½•è¿›è¡Œè‡ªåŠ¨é…ç½®çš„ï¼Œæˆ‘ä»¬ç°åœ¨å°±å¼€å§‹ç ”ç©¶ã€‚</p>
<h3 id="å¯åŠ¨åŸç†"><a href="#å¯åŠ¨åŸç†" class="headerlink" title="å¯åŠ¨åŸç†"></a>å¯åŠ¨åŸç†</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ï¼ŒSpringBooté¡¹ç›®å¯åŠ¨ä¹‹åï¼Œåšäº†ä»€ä¹ˆäº‹æƒ…ï¼ŒSpringApplicationä¸­çš„é™æ€<code>run</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(Class&lt;?&gt; primarySource, String... args)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> run(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;primarySource&#125;, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¥—å¨ƒå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(Class&lt;?&gt;[] primarySources, String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">new</span> <span class="title class_">SpringApplication</span>(primarySources)).run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œç›´æ¥newäº†ä¸€ä¸ªæ–°çš„SpringApplicationå¯¹è±¡ï¼Œä¼ å…¥æˆ‘ä»¬çš„ä¸»ç±»ä½œä¸ºæ„é€ æ–¹æ³•å‚æ•°ï¼Œå¹¶è°ƒç”¨äº†éstaticçš„<code>run</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ„é€ æ–¹æ³•é‡Œé¢åšäº†ä»€ä¹ˆäº‹æƒ…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">SpringApplication</span><span class="params">(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">this</span>.resourceLoader = resourceLoader;</span><br><span class="line">    Assert.notNull(primarySources, <span class="string">&quot;PrimarySources must not be null&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.primarySources = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>(Arrays.asList(primarySources));</span><br><span class="line">  	<span class="comment">//è¿™é‡Œæ˜¯å…³é”®ï¼Œè¿™é‡Œä¼šåˆ¤æ–­å½“å‰SpringBootåº”ç”¨ç¨‹åºæ˜¯å¦ä¸ºWebé¡¹ç›®ï¼Œå¹¶è¿”å›å½“å‰çš„é¡¹ç›®ç±»å‹</span></span><br><span class="line">  	<span class="comment">//deduceFromClasspathæ˜¯æ ¹æ®ç±»è·¯å¾„ä¸‹åˆ¤æ–­æ˜¯å¦åŒ…å«SpringBootWebä¾èµ–ï¼Œå¦‚æœä¸åŒ…å«å°±æ˜¯NONEç±»å‹ï¼ŒåŒ…å«å°±æ˜¯SERVLETç±»å‹</span></span><br><span class="line">    <span class="built_in">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();</span><br><span class="line">    <span class="built_in">this</span>.bootstrapRegistryInitializers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="built_in">this</span>.getSpringFactoriesInstances(BootstrapRegistryInitializer.class));</span><br><span class="line">  	<span class="comment">//åˆ›å»ºæ‰€æœ‰ApplicationContextInitializerå®ç°ç±»çš„å¯¹è±¡</span></span><br><span class="line">    <span class="built_in">this</span>.setInitializers(<span class="built_in">this</span>.getSpringFactoriesInstances(ApplicationContextInitializer.class));</span><br><span class="line">    <span class="built_in">this</span>.setListeners(<span class="built_in">this</span>.getSpringFactoriesInstances(ApplicationListener.class));</span><br><span class="line">    <span class="built_in">this</span>.mainApplicationClass = <span class="built_in">this</span>.deduceMainApplicationClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…³é”®å°±åœ¨è¿™é‡Œäº†ï¼Œå®ƒæ˜¯å¦‚ä½•çŸ¥é“å“ªäº›ç±»æ˜¯ApplicationContextInitializerçš„å®ç°ç±»çš„å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œå°±è¦æåˆ°spring.factoriesäº†ï¼Œå®ƒæ˜¯ Spring ä»¿é€ Java SPIå®ç°çš„ä¸€ç§ç±»åŠ è½½æœºåˆ¶ã€‚å®ƒåœ¨ META-INF/spring.factories æ–‡ä»¶ä¸­é…ç½®æ¥å£çš„å®ç°ç±»åç§°ï¼Œç„¶ååœ¨ç¨‹åºä¸­è¯»å–è¿™äº›é…ç½®æ–‡ä»¶å¹¶å®ä¾‹åŒ–ã€‚è¿™ç§è‡ªå®šä¹‰çš„SPIæœºåˆ¶æ˜¯ Spring Boot Starter å®ç°çš„åŸºç¡€ã€‚</p>
<p>SPIçš„å¸¸è§ä¾‹å­ï¼š</p>
<ul>
<li>æ•°æ®åº“é©±åŠ¨åŠ è½½æ¥å£å®ç°ç±»çš„åŠ è½½ï¼šJDBCåŠ è½½ä¸åŒç±»å‹æ•°æ®åº“çš„é©±åŠ¨</li>
<li>æ—¥å¿—é—¨é¢æ¥å£å®ç°ç±»åŠ è½½ï¼šSLF4JåŠ è½½ä¸åŒæä¾›å•†çš„æ—¥å¿—å®ç°ç±»</li>
</ul>
<p>è¯´ç™½äº†å°±æ˜¯äººå®¶å®šä¹‰æ¥å£ï¼Œä½†æ˜¯å®ç°å¯èƒ½æœ‰å¾ˆå¤šç§ï¼Œä½†æ˜¯æ ¸å¿ƒåªæä¾›æ¥å£ï¼Œéœ€è¦æˆ‘ä»¬æŒ‰éœ€é€‰æ‹©å¯¹åº”çš„å®ç°ï¼Œè¿™ç§æ–¹å¼æ˜¯é«˜åº¦è§£è€¦çš„ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹<code>getSpringFactoriesInstances</code>æ–¹æ³•åšäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; Collection&lt;T&gt; <span class="title function_">getSpringFactoriesInstances</span><span class="params">(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, Object... args)</span> &#123;</span><br><span class="line">  	<span class="comment">//è·å–å½“å‰çš„ç±»åŠ è½½å™¨</span></span><br><span class="line">    <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="built_in">this</span>.getClassLoader();</span><br><span class="line">  	<span class="comment">//è·å–æ‰€æœ‰ä¾èµ–ä¸­ META-INF/spring.factories ä¸­é…ç½®çš„å¯¹åº”æ¥å£ç±»çš„å®ç°ç±»åˆ—è¡¨</span></span><br><span class="line">    Set&lt;String&gt; names = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>(SpringFactoriesLoader.loadFactoryNames(type, classLoader));</span><br><span class="line">  	<span class="comment">//æ ¹æ®ä¸Šæ–¹åˆ—è¡¨ï¼Œä¾æ¬¡åˆ›å»ºå®ä¾‹å¯¹è±¡  </span></span><br><span class="line">  List&lt;T&gt; instances = <span class="built_in">this</span>.createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);</span><br><span class="line">  	<span class="comment">//æ ¹æ®å¯¹åº”ç±»ä¸Šçš„Orderæ¥å£æˆ–æ˜¯æ³¨è§£è¿›è¡Œæ’åº</span></span><br><span class="line">    AnnotationAwareOrderComparator.sort(instances);</span><br><span class="line">  	<span class="comment">//è¿”å›å®ä¾‹</span></span><br><span class="line">    <span class="keyword">return</span> instances;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>SpringFactoriesLoader.loadFactoryNames</code>æ­£æ˜¯è¯»å–é…ç½®çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæˆ‘ä»¬åé¢è¿˜ä¼šé‡åˆ°ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹runæ–¹æ³•é‡Œé¢åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">    <span class="type">DefaultBootstrapContext</span> <span class="variable">bootstrapContext</span> <span class="operator">=</span> <span class="built_in">this</span>.createBootstrapContext();</span><br><span class="line">    <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">this</span>.configureHeadlessProperty();</span><br><span class="line">  	<span class="comment">//è·å–æ‰€æœ‰çš„SpringApplicationRunListenerï¼Œå¹¶é€šçŸ¥å¯åŠ¨äº‹ä»¶ï¼Œé»˜è®¤åªæœ‰ä¸€ä¸ªå®ç°ç±»EventPublishingRunListener</span></span><br><span class="line">  	<span class="comment">//EventPublishingRunListenerä¼šå°†åˆå§‹åŒ–å„ä¸ªé˜¶æ®µçš„äº‹ä»¶è½¬å‘ç»™æ‰€æœ‰ç›‘å¬å™¨</span></span><br><span class="line">    <span class="type">SpringApplicationRunListeners</span> <span class="variable">listeners</span> <span class="operator">=</span> <span class="built_in">this</span>.getRunListeners(args);</span><br><span class="line">    listeners.starting(bootstrapContext, <span class="built_in">this</span>.mainApplicationClass);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      	<span class="comment">//ç¯å¢ƒé…ç½®</span></span><br><span class="line">        <span class="type">ApplicationArguments</span> <span class="variable">applicationArguments</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultApplicationArguments</span>(args);</span><br><span class="line">        <span class="type">ConfigurableEnvironment</span> <span class="variable">environment</span> <span class="operator">=</span> <span class="built_in">this</span>.prepareEnvironment(listeners, bootstrapContext, applicationArguments);</span><br><span class="line">        <span class="built_in">this</span>.configureIgnoreBeanInfo(environment);</span><br><span class="line">      	<span class="comment">//æ‰“å°Banner</span></span><br><span class="line">        <span class="type">Banner</span> <span class="variable">printedBanner</span> <span class="operator">=</span> <span class="built_in">this</span>.printBanner(environment);</span><br><span class="line">      	<span class="comment">//åˆ›å»ºApplicationContextï¼Œæ³¨æ„è¿™é‡Œä¼šæ ¹æ®æ˜¯å¦ä¸ºWebå®¹å™¨ä½¿ç”¨ä¸åŒçš„ApplicationContextå®ç°ç±»</span></span><br><span class="line">        context = <span class="built_in">this</span>.createApplicationContext();</span><br><span class="line">        context.setApplicationStartup(<span class="built_in">this</span>.applicationStartup);</span><br><span class="line">      	<span class="comment">//åˆå§‹åŒ–ApplicationContext</span></span><br><span class="line">        <span class="built_in">this</span>.prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);</span><br><span class="line">      	<span class="comment">//æ‰§è¡ŒApplicationContextçš„refreshæ–¹æ³•</span></span><br><span class="line">        <span class="built_in">this</span>.refreshContext(context);</span><br><span class="line">        <span class="built_in">this</span>.afterRefresh(context, applicationArguments);</span><br><span class="line">        <span class="type">Duration</span> <span class="variable">timeTakenToStartup</span> <span class="operator">=</span> Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) &#123;</span><br><span class="line">            (<span class="keyword">new</span> <span class="title class_">StartupInfoLogger</span>(<span class="built_in">this</span>.mainApplicationClass)).logStarted(<span class="built_in">this</span>.getApplicationLog(), timeTakenToStartup);</span><br><span class="line">        &#125;</span><br><span class="line">        ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œå®é™…ä¸ŠSpringBootå°±æ˜¯Springçš„ä¸€å±‚å£³ç½¢äº†ï¼Œç¦»ä¸å¼€æœ€å…³é”®çš„ApplicationContextï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¯åŠ¨åä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªApplicationContextï¼Œåªä¸è¿‡æ˜¯è¿›è¡Œäº†å¤§é‡çš„æ‰©å±•ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ApplicationContextæ˜¯æ€ä¹ˆæ¥çš„ï¼Œæ‰“å¼€<code>createApplicationContext</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> ConfigurableApplicationContext <span class="title function_">createApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.applicationContextFactory.create(<span class="built_in">this</span>.webApplicationType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°åœ¨æ„é€ æ–¹æ³•ä¸­<code>applicationContextFactory</code>ç›´æ¥ä½¿ç”¨çš„æ˜¯DEFAULTï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.applicationContextFactory = ApplicationContextFactory.DEFAULT;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ApplicationContextFactory</span> <span class="variable">DEFAULT</span> <span class="operator">=</span> (webApplicationType) -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span>(webApplicationType) &#123;</span><br><span class="line">        <span class="keyword">case</span> SERVLET:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigServletWebServerApplicationContext</span>();</span><br><span class="line">        <span class="keyword">case</span> REACTIVE:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigReactiveWebServerApplicationContext</span>();</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception var2) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Unable create a default ApplicationContext instance, you may need a custom ApplicationContextFactory&quot;</span>, var2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ConfigurableApplicationContext <span class="title function_">create</span><span class="params">(WebApplicationType webApplicationType)</span>;</span><br></pre></td></tr></table></figure>

<p>DEFAULTæ˜¯ç›´æ¥ç¼–å†™çš„ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œå…¶å®å·²ç»å¾ˆæ˜ç¡®äº†ï¼Œæ­£æ˜¯æ ¹æ®<code>webApplicationType</code>ç±»å‹è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯SERVLETï¼Œé‚£ä¹ˆä¹…è¿”å›ä¸“ç”¨äºWebç¯å¢ƒçš„AnnotationConfigServletWebServerApplicationContextå¯¹è±¡ï¼ˆSpringBootä¸­æ–°å¢çš„ï¼‰ï¼Œå¦åˆ™è¿”å›æ™®é€šçš„AnnotationConfigApplicationContextå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯åˆ°è¿™é‡Œä¸ºæ­¢ï¼ŒSpringçš„å®¹å™¨å°±åŸºæœ¬å·²ç»ç¡®å®šäº†ã€‚</p>
<p>æ³¨æ„AnnotationConfigApplicationContextæ˜¯Springæ¡†æ¶æä¾›çš„ç±»ï¼Œä»è¿™é‡Œå¼€å§‹ç›¸å½“äºæˆ‘ä»¬åœ¨è®²Springçš„åº•å±‚æºç äº†ï¼Œæˆ‘ä»¬ç»§ç»­æ·±å…¥ï¼ŒAnnotationConfigApplicationContextå¯¹è±¡åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ä¼šåˆ›å»º<code>AnnotatedBeanDefinitionReader</code>ï¼Œå®ƒæ˜¯ç”¨äºé€šè¿‡æ³¨è§£è§£æBeanå®šä¹‰çš„å·¥å…·ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AnnotationConfigApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">StartupStep</span> <span class="variable">createAnnotatedBeanDefReader</span> <span class="operator">=</span> <span class="built_in">this</span>.getApplicationStartup().start(<span class="string">&quot;spring.context.annotated-bean-reader.create&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.reader = <span class="keyword">new</span> <span class="title class_">AnnotatedBeanDefinitionReader</span>(<span class="built_in">this</span>);</span><br><span class="line">    createAnnotatedBeanDefReader.end();</span><br><span class="line">    <span class="built_in">this</span>.scanner = <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶æ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AnnotatedBeanDefinitionReader</span><span class="params">(BeanDefinitionRegistry registry, Environment environment)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//è¿™é‡Œä¼šæ³¨å†Œå¾ˆå¤šçš„åç½®å¤„ç†å™¨</span></span><br><span class="line">    AnnotationConfigUtils.registerAnnotationConfigProcessors(<span class="built_in">this</span>.registry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">registerAnnotationConfigProcessors</span><span class="params">(BeanDefinitionRegistry registry, <span class="meta">@Nullable</span> Object source)</span> &#123;</span><br><span class="line">    <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> unwrapDefaultListableBeanFactory(registry);</span><br><span class="line">    ....</span><br><span class="line">    Set&lt;BeanDefinitionHolder&gt; beanDefs = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>(<span class="number">8</span>);</span><br><span class="line">    RootBeanDefinition def;</span><br><span class="line">    <span class="keyword">if</span> (!registry.containsBeanDefinition(<span class="string">&quot;org.springframework.context.annotation.internalConfigurationAnnotationProcessor&quot;</span>)) &#123;</span><br><span class="line">      	<span class="comment">//æ³¨å†Œäº†ConfigurationClassPostProcessorç”¨äºå¤„ç†@Configurationã€@Importç­‰æ³¨è§£</span></span><br><span class="line">      	<span class="comment">//æ³¨æ„è¿™é‡Œæ˜¯å…³é”®ï¼Œä¹‹åSelectorè¿˜è¦è®²åˆ°å®ƒ</span></span><br><span class="line">      	<span class="comment">//å®ƒæ˜¯ç»§æ‰¿è‡ªBeanDefinitionRegistryPostProcessorï¼Œæ‰€ä»¥å®ƒçš„æ‰§è¡Œæ—¶é—´åœ¨Beanå®šä¹‰åŠ è½½å®Œæˆåï¼ŒBeanåˆå§‹åŒ–ä¹‹å‰</span></span><br><span class="line">        def = <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(ConfigurationClassPostProcessor.class);</span><br><span class="line">        def.setSource(source);</span><br><span class="line">        beanDefs.add(registerPostProcessor(registry, def, <span class="string">&quot;org.springframework.context.annotation.internalConfigurationAnnotationProcessor&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!registry.containsBeanDefinition(<span class="string">&quot;org.springframework.context.annotation.internalAutowiredAnnotationProcessor&quot;</span>)) &#123;</span><br><span class="line">      	<span class="comment">//AutowiredAnnotationBeanPostProcessorç”¨äºå¤„ç†@Valueç­‰æ³¨è§£è‡ªåŠ¨æ³¨å…¥</span></span><br><span class="line">        def = <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(AutowiredAnnotationBeanPostProcessor.class);</span><br><span class="line">        def.setSource(source);</span><br><span class="line">        beanDefs.add(registerPostProcessor(registry, def, <span class="string">&quot;org.springframework.context.annotation.internalAutowiredAnnotationProcessor&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	...</span><br></pre></td></tr></table></figure>

<p>å›åˆ°SpringBootï¼Œæˆ‘ä»¬æœ€åæ¥çœ‹ï¼Œ<code>prepareContext</code>æ–¹æ³•ä¸­åˆåšäº†ä»€ä¹ˆäº‹æƒ…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">prepareContext</span><span class="params">(DefaultBootstrapContext bootstrapContext, ConfigurableApplicationContext context, ConfigurableEnvironment environment, SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments, Banner printedBanner)</span> &#123;</span><br><span class="line">  	<span class="comment">//ç¯å¢ƒé…ç½®</span></span><br><span class="line">    context.setEnvironment(environment);</span><br><span class="line">    <span class="built_in">this</span>.postProcessApplicationContext(context);</span><br><span class="line">    <span class="built_in">this</span>.applyInitializers(context);</span><br><span class="line">    listeners.contextPrepared(context);</span><br><span class="line">    bootstrapContext.close(context);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) &#123;</span><br><span class="line">        <span class="built_in">this</span>.logStartupInfo(context.getParent() == <span class="literal">null</span>);</span><br><span class="line">        <span class="built_in">this</span>.logStartupProfileInfo(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//å°†Banneræ³¨å†Œä¸ºBean</span></span><br><span class="line">    <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> context.getBeanFactory();</span><br><span class="line">    beanFactory.registerSingleton(<span class="string">&quot;springApplicationArguments&quot;</span>, applicationArguments);</span><br><span class="line">    <span class="keyword">if</span> (printedBanner != <span class="literal">null</span>) &#123;</span><br><span class="line">        beanFactory.registerSingleton(<span class="string">&quot;springBootBanner&quot;</span>, printedBanner);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> AbstractAutowireCapableBeanFactory) &#123;</span><br><span class="line">        ((AbstractAutowireCapableBeanFactory)beanFactory).setAllowCircularReferences(<span class="built_in">this</span>.allowCircularReferences);</span><br><span class="line">        <span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> DefaultListableBeanFactory) &#123;</span><br><span class="line">            ((DefaultListableBeanFactory)beanFactory).setAllowBeanDefinitionOverriding(<span class="built_in">this</span>.allowBeanDefinitionOverriding);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.lazyInitialization) &#123;</span><br><span class="line">        context.addBeanFactoryPostProcessor(<span class="keyword">new</span> <span class="title class_">LazyInitializationBeanFactoryPostProcessor</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//è¿™é‡Œä¼šè·å–æˆ‘ä»¬ä¸€å¼€å§‹ä¼ å…¥çš„é¡¹ç›®ä¸»ç±»</span></span><br><span class="line">    Set&lt;Object&gt; sources = <span class="built_in">this</span>.getAllSources();</span><br><span class="line">    Assert.notEmpty(sources, <span class="string">&quot;Sources must not be empty&quot;</span>);</span><br><span class="line">  	<span class="comment">//è¿™é‡Œä¼šå°†æˆ‘ä»¬çš„ä¸»ç±»ç›´æ¥æ³¨å†Œä¸ºBeanï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡æ³¨è§£åŠ è½½äº†</span></span><br><span class="line">    <span class="built_in">this</span>.load(context, sources.toArray(<span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]));</span><br><span class="line">    listeners.contextLoaded(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œåœ¨<code>prepareContext</code>æ‰§è¡Œå®Œæˆä¹‹åï¼Œæˆ‘ä»¬çš„ä¸»ç±»æˆåŠŸå®ŒæˆBeanæ³¨å†Œï¼Œæ¥ä¸‹æ¥ï¼Œå°±è¯¥ç±»ä¸Šæ³¨è§£å¤§æ˜¾èº«æ‰‹äº†ã€‚</p>
<h3 id="è‡ªåŠ¨é…ç½®åŸç†"><a href="#è‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="è‡ªåŠ¨é…ç½®åŸç†"></a>è‡ªåŠ¨é…ç½®åŸç†</h3><p>æ—¢ç„¶ä¸»ç±»å·²ç»åœ¨åˆå§‹é˜¶æ®µæ³¨å†Œä¸ºBeanï¼Œé‚£ä¹ˆåœ¨åŠ è½½æ—¶ï¼Œå°±ä¼šæ ¹æ®æ³¨è§£å®šä¹‰ï¼Œè¿›è¡Œæ›´å¤šçš„é¢å¤–æ“ä½œã€‚æ‰€ä»¥æˆ‘ä»¬æ¥çœ‹çœ‹ä¸»ç±»ä¸Šçš„<code>@SpringBootApplication</code>æ³¨è§£åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">    excludeFilters = &#123;@Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;TypeExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">), @Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">)&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œ<code>@SpringBootApplication</code>ä¸Šæ·»åŠ äº†<code>@ComponentScan</code>æ³¨è§£ï¼Œæ­¤æ³¨è§£æˆ‘ä»¬æ­¤å‰å·²ç»è®¤è¯†è¿‡äº†ï¼Œä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰é…ç½®å…·ä½“æ‰«æçš„åŒ…ï¼Œå› æ­¤å®ƒä¼šè‡ªåŠ¨å°†å£°æ˜æ­¤æ¥å£çš„ç±»æ‰€åœ¨çš„åŒ…ä½œä¸ºbasePackageï¼Œå› æ­¤å½“æ·»åŠ <code>@SpringBootApplication</code>ä¹‹åä¹Ÿå°±ç­‰äºç›´æ¥å¼€å¯äº†è‡ªåŠ¨æ‰«æï¼Œä½†æ˜¯ä¸€å®šæ³¨æ„ä¸èƒ½åœ¨ä¸»ç±»ä¹‹å¤–çš„åŒ…è¿›è¡ŒBeanå®šä¹‰ï¼Œå¦åˆ™æ— æ³•æ‰«æåˆ°ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ç¬¬äºŒä¸ªæ³¨è§£<code>@EnableAutoConfiguration</code>ï¼Œå®ƒå°±æ˜¯è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒäº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å®šä¹‰çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br></pre></td></tr></table></figure>

<p>è€å¥—è·¯äº†ï¼Œç›´æ¥ä¸€æ‰‹<code>@Import</code>ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥å°†ä¸€äº›å¤–éƒ¨çš„BeanåŠ è½½åˆ°å®¹å™¨ä¸­ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹AutoConfigurationImportSelectoråšäº†ä»€ä¹ˆäº‹æƒ…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title class_">DeferredImportSelector</span>, BeanClassLoaderAware, ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered &#123;</span><br><span class="line">		...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çœ‹åˆ°å®ƒå®ç°äº†å¾ˆå¤šæ¥å£ï¼ŒåŒ…æ‹¬å¤§é‡çš„Awareæ¥å£ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸ºäº†æ„ŸçŸ¥æŸäº›å¿…è¦çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶å­˜åˆ°å½“å‰ç±»ä¸­ã€‚</p>
<p>å…¶ä¸­æœ€æ ¸å¿ƒçš„æ˜¯<code>DeferredImportSelector</code>æ¥å£ï¼Œå®ƒæ˜¯<code>ImportSelector</code>çš„å­ç±»ï¼Œå®ƒå®šä¹‰äº†<code>selectImports</code>æ–¹æ³•ï¼Œç”¨äºè¿”å›éœ€è¦åŠ è½½çš„ç±»åç§°ï¼Œåœ¨SpringåŠ è½½ImportSelectorç±»å‹çš„Beanæ—¶ï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³•æ¥è·å–æ›´å¤šéœ€è¦åŠ è½½çš„ç±»ï¼Œå¹¶å°†è¿™äº›ç±»ä¸€å¹¶æ³¨å†Œä¸ºBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">    String[] selectImports(AnnotationMetadata importingClassMetadata);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">default</span> Predicate&lt;String&gt; <span class="title function_">getExclusionFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬äº†è§£äº†ä¸¤ç§ä½¿ç”¨<code>@Import</code>æœ‰ç‰¹æ®Šæœºåˆ¶çš„æ¥å£ï¼šImportSelectorï¼ˆè¿™é‡Œç”¨åˆ°çš„ï¼‰å’ŒImportBeanDefinitionRegistrarï¼ˆä¹‹å‰Mybatis-springæºç æœ‰è®²ï¼‰å½“ç„¶è¿˜æœ‰æ™®é€šçš„<code>@Configuration</code>é…ç½®ç±»ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ¥é˜…è¯»ä¸€ä¸‹<code>ConfigurationClassPostProcessor</code>çš„æºç ï¼Œçœ‹çœ‹å®ƒåˆ°åº•æ˜¯å¦‚ä½•å¤„ç†<code>@Import</code>çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processConfigBeanDefinitions</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    List&lt;BeanDefinitionHolder&gt; configCandidates = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">  	<span class="comment">//æ³¨æ„è¿™ä¸ªé˜¶æ®µä»…ä»…æ˜¯å·²ç»å®Œæˆæ‰«æäº†æ‰€æœ‰çš„Beanï¼Œå¾—åˆ°äº†æ‰€æœ‰çš„BeanDefinitionï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¿›è¡Œä»»ä½•åŒºåˆ†</span></span><br><span class="line">  	<span class="comment">//candidateæ˜¯å€™é€‰è€…çš„æ„æ€ï¼Œä¸€ä¼šä¼šå°†æ ‡è®°äº†@Configurationçš„ç±»ä½œä¸ºConfigurationClassåŠ å…¥åˆ°configCandidatesä¸­</span></span><br><span class="line">    String[] candidateNames = registry.getBeanDefinitionNames();</span><br><span class="line">    String[] var4 = candidateNames;</span><br><span class="line">    <span class="type">int</span> <span class="variable">var5</span> <span class="operator">=</span> candidateNames.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">var6</span> <span class="operator">=</span> <span class="number">0</span>; var6 &lt; var5; ++var6) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> var4[var6];</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDef</span> <span class="operator">=</span> registry.getBeanDefinition(beanName);</span><br><span class="line">        <span class="keyword">if</span> (beanDef.getAttribute(ConfigurationClassUtils.CONFIGURATION_CLASS_ATTRIBUTE) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isDebugEnabled()) &#123;</span><br><span class="line">                <span class="built_in">this</span>.logger.debug(<span class="string">&quot;Bean definition has already been processed as a configuration class: &quot;</span> + beanDef);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(beanDef, <span class="built_in">this</span>.metadataReaderFactory)) &#123;   <span class="comment">//åˆ¤æ–­æ˜¯å¦æ·»åŠ äº†@Configurationæ³¨è§£</span></span><br><span class="line">            configCandidates.add(<span class="keyword">new</span> <span class="title class_">BeanDefinitionHolder</span>(beanDef, beanName));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!configCandidates.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">//...çœç•¥</span></span><br><span class="line"></span><br><span class="line">      	<span class="comment">//è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªConfigurationClassParserç”¨äºè§£æé…ç½®ç±»</span></span><br><span class="line">        <span class="type">ConfigurationClassParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationClassParser</span>(<span class="built_in">this</span>.metadataReaderFactory, <span class="built_in">this</span>.problemReporter, <span class="built_in">this</span>.environment, <span class="built_in">this</span>.resourceLoader, <span class="built_in">this</span>.componentScanBeanNameGenerator, registry);</span><br><span class="line">      	<span class="comment">//æ‰€æœ‰é…ç½®ç±»çš„BeanDefinitionHolderåˆ—è¡¨</span></span><br><span class="line">        Set&lt;BeanDefinitionHolder&gt; candidates = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>(configCandidates);</span><br><span class="line">      	<span class="comment">//å·²ç»è§£æå®Œæˆçš„ç±»</span></span><br><span class="line">        <span class="type">HashSet</span> <span class="variable">alreadyParsed</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>(configCandidates.size());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">//è¿™é‡Œçœç•¥ï¼Œç›´åˆ°æ‰€æœ‰çš„é…ç½®ç±»å…¨éƒ¨è§£æå®Œæˆ</span></span><br><span class="line">          	<span class="comment">//æ³¨æ„åœ¨å¾ªç¯è¿‡ç¨‹ä¸­å¯èƒ½ä¼šç”±äº@Importæ–°å¢æ›´å¤šçš„å¾…è§£æé…ç½®ç±»ï¼Œä¸€å¾‹ä¸¢è¿›candidatesé›†åˆä¸­</span></span><br><span class="line">        &#125; <span class="keyword">while</span>(!candidates.isEmpty());</span><br><span class="line"></span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œ<code>ConfigurationClassParser</code>æ˜¯å¦‚ä½•è¿›è¡Œè§£æçš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processConfigurationClass</span><span class="params">(ConfigurationClass configClass, Predicate&lt;String&gt; filter)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">  	<span class="comment">//@Conditionalç›¸å…³æ³¨è§£å¤„ç†</span></span><br><span class="line">  	<span class="comment">//åé¢ä¼šè®²</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.conditionEvaluator.shouldSkip(configClass.getMetadata(), ConfigurationPhase.PARSE_CONFIGURATION)) &#123;</span><br><span class="line">        ...</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ConfigurationClassParser.<span class="type">SourceClass</span> <span class="variable">sourceClass</span> <span class="operator">=</span> <span class="built_in">this</span>.asSourceClass(configClass, filter);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">          	<span class="comment">//æ ¸å¿ƒ</span></span><br><span class="line">            sourceClass = <span class="built_in">this</span>.doProcessConfigurationClass(configClass, sourceClass, filter);</span><br><span class="line">        &#125; <span class="keyword">while</span>(sourceClass != <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.configurationClasses.put(configClass, configClass);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å†æ¥çœ‹æœ€æ ¸å¿ƒçš„<code>doProcessConfigurationClass</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> SourceClass <span class="title function_">doProcessConfigurationClass</span><span class="params">(ConfigurationClass configClass, SourceClass sourceClass)</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    processImports(configClass, sourceClass, getImports(sourceClass), <span class="literal">true</span>);    <span class="comment">// å¤„ç†Importæ³¨è§£</span></span><br><span class="line"></span><br><span class="line">		...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processImports</span><span class="params">(ConfigurationClass configClass, ConfigurationClassParser.SourceClass currentSourceClass, Collection&lt;ConfigurationClassParser.SourceClass&gt; importCandidates, Predicate&lt;String&gt; exclusionFilter, <span class="type">boolean</span> checkForCircularImports)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!importCandidates.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (checkForCircularImports &amp;&amp; <span class="built_in">this</span>.isChainedImportOnStack(configClass)) &#123;</span><br><span class="line">            <span class="built_in">this</span>.problemReporter.error(<span class="keyword">new</span> <span class="title class_">ConfigurationClassParser</span>.CircularImportProblem(configClass, <span class="built_in">this</span>.importStack));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.importStack.push(configClass);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Iterator</span> <span class="variable">var6</span> <span class="operator">=</span> importCandidates.iterator();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span>(var6.hasNext()) &#123;</span><br><span class="line">                    ConfigurationClassParser.<span class="type">SourceClass</span> <span class="variable">candidate</span> <span class="operator">=</span> (ConfigurationClassParser.SourceClass)var6.next();</span><br><span class="line">                    Class candidateClass;</span><br><span class="line">                  	<span class="comment">//å¦‚æœæ˜¯ImportSelectorç±»å‹ï¼Œç»§ç»­è¿›è¡Œè¿è¡Œ</span></span><br><span class="line">                    <span class="keyword">if</span> (candidate.isAssignable(ImportSelector.class)) &#123;</span><br><span class="line">                        candidateClass = candidate.loadClass();</span><br><span class="line">                        <span class="type">ImportSelector</span> <span class="variable">selector</span> <span class="operator">=</span> (ImportSelector)ParserStrategyUtils.instantiateClass(candidateClass, ImportSelector.class, <span class="built_in">this</span>.environment, <span class="built_in">this</span>.resourceLoader, <span class="built_in">this</span>.registry);</span><br><span class="line">                        Predicate&lt;String&gt; selectorFilter = selector.getExclusionFilter();</span><br><span class="line">                        <span class="keyword">if</span> (selectorFilter != <span class="literal">null</span>) &#123;</span><br><span class="line">                            exclusionFilter = exclusionFilter.or(selectorFilter);</span><br><span class="line">                        &#125;</span><br><span class="line">									<span class="comment">//å¦‚æœæ˜¯DeferredImportSelectorçš„å®ç°ç±»ï¼Œé‚£ä¹ˆä¼šèµ°deferredImportSelectorHandlerçš„handleæ–¹æ³•</span></span><br><span class="line">                        <span class="keyword">if</span> (selector <span class="keyword">instanceof</span> DeferredImportSelector) &#123;</span><br><span class="line">                            <span class="built_in">this</span>.deferredImportSelectorHandler.handle(configClass, (DeferredImportSelector)selector);</span><br><span class="line">                          <span class="comment">//å¦åˆ™å°±æŒ‰ç…§æ­£å¸¸çš„ImportSelectorç±»å‹è¿›è¡ŒåŠ è½½</span></span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                          	<span class="comment">//è°ƒç”¨selectImportsæ–¹æ³•è·å–æ‰€æœ‰éœ€è¦åŠ è½½çš„ç±»</span></span><br><span class="line">                            String[] importClassNames = selector.selectImports(currentSourceClass.getMetadata());</span><br><span class="line">                            Collection&lt;ConfigurationClassParser.SourceClass&gt; importSourceClasses = <span class="built_in">this</span>.asSourceClasses(importClassNames, exclusionFilter);</span><br><span class="line">                          	<span class="comment">//é€’å½’å¤„ç†ï¼Œç›´åˆ°æ²¡æœ‰</span></span><br><span class="line">                            <span class="built_in">this</span>.processImports(configClass, currentSourceClass, importSourceClasses, exclusionFilter, <span class="literal">false</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                      <span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºImportBeanDefinitionRegistrarç±»å‹</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (candidate.isAssignable(ImportBeanDefinitionRegistrar.class)) &#123;</span><br><span class="line">                        candidateClass = candidate.loadClass();</span><br><span class="line">                        <span class="type">ImportBeanDefinitionRegistrar</span> <span class="variable">registrar</span> <span class="operator">=</span> (ImportBeanDefinitionRegistrar)ParserStrategyUtils.instantiateClass(candidateClass, ImportBeanDefinitionRegistrar.class, <span class="built_in">this</span>.environment, <span class="built_in">this</span>.resourceLoader, <span class="built_in">this</span>.registry);</span><br><span class="line">                      	<span class="comment">//å¾€configClassä¸¢ImportBeanDefinitionRegistrarä¿¡æ¯è¿›å»ï¼Œä¹‹åå†å¤„ç†</span></span><br><span class="line">                        configClass.addImportBeanDefinitionRegistrar(registrar, currentSourceClass.getMetadata());</span><br><span class="line">                      <span class="comment">//å¦åˆ™æŒ‰æ™®é€šçš„é…ç½®ç±»è¿›è¡Œå¤„ç†</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="built_in">this</span>.importStack.registerImport(currentSourceClass.getMetadata(), candidate.getMetadata().getClassName());</span><br><span class="line">                        <span class="built_in">this</span>.processConfigurationClass(candidate.asConfigClass(configClass), exclusionFilter);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (BeanDefinitionStoreException var17) &#123;</span><br><span class="line">                <span class="keyword">throw</span> var17;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable var18) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(<span class="string">&quot;Failed to process import candidates for configuration class [&quot;</span> + configClass.getMetadata().getClassName() + <span class="string">&quot;]&quot;</span>, var18);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.importStack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸éš¾æ³¨æ„åˆ°ï¼Œè™½ç„¶è¿™é‡Œé¢å¤–å¤„ç†äº†<code>ImportSelector</code>å¯¹è±¡ï¼Œä½†æ˜¯è¿˜é’ˆå¯¹<code>ImportSelector</code>çš„å­æ¥å£<code>DeferredImportSelector</code>è¿›è¡Œäº†é¢å¤–å¤„ç†ï¼ŒDeferredæ˜¯å»¶è¿Ÿçš„æ„æ€ï¼Œå®ƒæ˜¯ä¸€ä¸ªå»¶è¿Ÿæ‰§è¡Œçš„<code>ImportSelector</code>ï¼Œå¹¶ä¸ä¼šç«‹å³è¿›å¤„ç†ï¼Œè€Œæ˜¯ä¸¢è¿›DeferredImportSelectorHandlerï¼Œå¹¶ä¸”åœ¨<code>parse</code>æ–¹æ³•çš„æœ€åè¿›è¡Œå¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">parse</span><span class="params">(Set&lt;BeanDefinitionHolder&gt; configCandidates)</span> &#123;</span><br><span class="line">     ...</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.deferredImportSelectorHandler.process();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹<code>DeferredImportSelector</code>æ­£å¥½å°±æœ‰ä¸€ä¸ª<code>process</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeferredImportSelector</span> <span class="keyword">extends</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">default</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">DeferredImportSelector</span>.Group&gt; getImportGroup() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Group</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(AnnotationMetadata metadata, DeferredImportSelector selector)</span>;</span><br><span class="line"></span><br><span class="line">        Iterable&lt;DeferredImportSelector.Group.Entry&gt; selectImports();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> &#123;</span><br><span class="line">          ...</span><br></pre></td></tr></table></figure>

<p>æœ€åç»è¿‡ConfigurationClassParserå¤„ç†å®Œæˆåï¼Œé€šè¿‡<code>parser.getConfigurationClasses()</code>å°±èƒ½å¾—åˆ°é€šè¿‡é…ç½®ç±»å¯¼å…¥äº†å“ªäº›é¢å¤–çš„é…ç½®ç±»ã€‚æœ€åå°†è¿™äº›é…ç½®ç±»å…¨éƒ¨æ³¨å†ŒBeanDefinitionï¼Œç„¶åå°±å¯ä»¥äº¤ç»™æ¥ä¸‹æ¥çš„Beanåˆå§‹åŒ–è¿‡ç¨‹å»å¤„ç†äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.reader.loadBeanDefinitions(configClasses);</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å†å»çœ‹<code>loadBeanDefinitions</code>æ˜¯å¦‚ä½•è¿è¡Œçš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loadBeanDefinitions</span><span class="params">(Set&lt;ConfigurationClass&gt; configurationModel)</span> &#123;</span><br><span class="line">    ConfigurationClassBeanDefinitionReader.<span class="type">TrackedConditionEvaluator</span> <span class="variable">trackedConditionEvaluator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationClassBeanDefinitionReader</span>.TrackedConditionEvaluator();</span><br><span class="line">    <span class="type">Iterator</span> <span class="variable">var3</span> <span class="operator">=</span> configurationModel.iterator();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(var3.hasNext()) &#123;</span><br><span class="line">        <span class="type">ConfigurationClass</span> <span class="variable">configClass</span> <span class="operator">=</span> (ConfigurationClass)var3.next();</span><br><span class="line">        <span class="built_in">this</span>.loadBeanDefinitionsForConfigurationClass(configClass, trackedConditionEvaluator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loadBeanDefinitionsForConfigurationClass</span><span class="params">(ConfigurationClass configClass, ConfigurationClassBeanDefinitionReader.TrackedConditionEvaluator trackedConditionEvaluator)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (trackedConditionEvaluator.shouldSkip(configClass)) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> configClass.getBeanName();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasLength(beanName) &amp;&amp; <span class="built_in">this</span>.registry.containsBeanDefinition(beanName)) &#123;</span><br><span class="line">            <span class="built_in">this</span>.registry.removeBeanDefinition(beanName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.importRegistry.removeImportingClass(configClass.getMetadata().getClassName());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (configClass.isImported()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.registerBeanDefinitionForImportedConfigurationClass(configClass);  <span class="comment">//æ³¨å†Œé…ç½®ç±»è‡ªå·±</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">var3</span> <span class="operator">=</span> configClass.getBeanMethods().iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var3.hasNext()) &#123;</span><br><span class="line">            <span class="type">BeanMethod</span> <span class="variable">beanMethod</span> <span class="operator">=</span> (BeanMethod)var3.next();</span><br><span class="line">            <span class="built_in">this</span>.loadBeanDefinitionsForBeanMethod(beanMethod); <span class="comment">//æ³¨å†Œ@Beanæ³¨è§£æ ‡è¯†çš„æ–¹æ³•</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      	<span class="comment">//æ³¨å†Œ`@ImportResource`å¼•å…¥çš„XMLé…ç½®æ–‡ä»¶ä¸­è¯»å–çš„beanå®šä¹‰</span></span><br><span class="line">        <span class="built_in">this</span>.loadBeanDefinitionsFromImportedResources(configClass.getImportedResources());</span><br><span class="line">     	 <span class="comment">//æ³¨å†ŒconfigClassä¸­ç»è¿‡è§£æåä¿å­˜çš„æ‰€æœ‰ImportBeanDefinitionRegistrarï¼Œæ³¨å†Œå¯¹åº”çš„BeanDefinition</span></span><br><span class="line">        <span class="built_in">this</span>.loadBeanDefinitionsFromRegistrars(configClass.getImportBeanDefinitionRegistrars());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæ•´ä¸ª<code>@Configuration</code>é…ç½®ç±»çš„åº•å±‚é…ç½®æµç¨‹æˆ‘ä»¬å°±å¤§è‡´äº†è§£äº†ã€‚æ¥ç€æˆ‘ä»¬æ¥çœ‹AutoConfigurationImportSelectoræ˜¯å¦‚ä½•å®ç°è‡ªåŠ¨é…ç½®çš„ï¼Œå¯ä»¥çœ‹åˆ°å†…éƒ¨ç±»AutoConfigurationGroupçš„processæ–¹æ³•ï¼Œå®ƒæ˜¯çˆ¶æ¥å£çš„å®ç°ï¼Œå› ä¸ºçˆ¶æ¥å£æ˜¯<code>DeferredImportSelector</code>ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å¾—çŸ¥ï¼Œå®é™…ä¸Šæœ€åä¼šè°ƒç”¨<code>process</code>æ–¹æ³•è·å–æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(AnnotationMetadata annotationMetadata, DeferredImportSelector deferredImportSelector)</span> &#123;</span><br><span class="line">    Assert.state(deferredImportSelector <span class="keyword">instanceof</span> AutoConfigurationImportSelector, () -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;Only %s implementations are supported, got %s&quot;</span>, AutoConfigurationImportSelector.class.getSimpleName(), deferredImportSelector.getClass().getName());</span><br><span class="line">    &#125;);</span><br><span class="line">  	<span class="comment">//è·å–æ‰€æœ‰çš„Entryï¼Œå…¶å®å°±æ˜¯ï¼Œè¯»å–spring.factoriesæ¥æŸ¥çœ‹æœ‰å“ªäº›è‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line">    AutoConfigurationImportSelector.<span class="type">AutoConfigurationEntry</span> <span class="variable">autoConfigurationEntry</span> <span class="operator">=</span> ((AutoConfigurationImportSelector)deferredImportSelector).getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line">    <span class="built_in">this</span>.autoConfigurationEntries.add(autoConfigurationEntry);</span><br><span class="line">    <span class="type">Iterator</span> <span class="variable">var4</span> <span class="operator">=</span> autoConfigurationEntry.getConfigurations().iterator();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(var4.hasNext()) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">importClassName</span> <span class="operator">=</span> (String)var4.next();</span><br><span class="line">        <span class="built_in">this</span>.entries.putIfAbsent(importClassName, annotationMetadata);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹<code>getAutoConfigurationEntry</code>æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> AutoConfigurationImportSelector.AutoConfigurationEntry <span class="title function_">getAutoConfigurationEntry</span><span class="params">(AnnotationMetadata annotationMetadata)</span> &#123;</span><br><span class="line">  	<span class="comment">//åˆ¤æ–­æ˜¯å¦å¼€å¯äº†è‡ªåŠ¨é…ç½®ï¼Œæ˜¯çš„ï¼Œè‡ªåŠ¨é…ç½®å¯ä»¥å…³</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      	<span class="comment">//æ ¹æ®æ³¨è§£å®šä¹‰è·å–ä¸€äº›å±æ€§</span></span><br><span class="line">        <span class="type">AnnotationAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> <span class="built_in">this</span>.getAttributes(annotationMetadata);</span><br><span class="line">      	<span class="comment">//å¾—åˆ°spring.factoriesæ–‡ä»¶ä¸­æ‰€æœ‰éœ€è¦è‡ªåŠ¨é…ç½®çš„ç±»</span></span><br><span class="line">        List&lt;String&gt; configurations = <span class="built_in">this</span>.getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">        ... è¿™é‡Œå…ˆçœ‹å‰åŠéƒ¨åˆ†</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯spring.factoriesæ–‡ä»¶ä¸­æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»éƒ½ä¼šè¢«åŠ è½½ï¼Œå®ƒä¼šæ ¹æ®@Conditionæ³¨è§£çš„æ¡ä»¶è¿›è¡ŒåŠ è½½ã€‚è¿™æ ·å°±èƒ½å®ç°æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ¨¡å—æ·»åŠ å¯¹åº”ä¾èµ–å°±å¯ä»¥å®ç°è‡ªåŠ¨é…ç½®äº†ã€‚</p>
<p>æ‰€æœ‰çš„æºç çœ‹ä¸æ‡‚ï¼Œéƒ½æºè‡ªäºä½ çš„å¿ƒä¸­æ²¡æœ‰å½¢æˆä¸€ä¸ªå®Œæ•´çš„é—­ç¯ï¼ä¸€æ—¦ä¸€æ¡çº¿æ¨åˆ°å¤´ï¼Œé—­ç¯å½¢æˆï¼Œæ‰€æœ‰ç–‘æƒ‘è¿åˆƒè€Œè§£ã€‚</p>
<h3 id="è‡ªå®šä¹‰Starter"><a href="#è‡ªå®šä¹‰Starter" class="headerlink" title="è‡ªå®šä¹‰Starter"></a>è‡ªå®šä¹‰Starter</h3><p>æˆ‘ä»¬ä»¿ç…§Mybatisæ¥ç¼–å†™ä¸€ä¸ªè‡ªå·±çš„starterï¼ŒMybatisçš„starteråŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  starteræœ¬èº«åªåšä¾èµ–é›†ä¸­ç®¡ç†ï¼Œä¸ç¼–å†™ä»»ä½•ä»£ç   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module.name</span>&gt;</span>org.mybatis.spring.boot.starter<span class="tag">&lt;/<span class="name">module.name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  ç¼–å†™çš„ä¸“ç”¨é…ç½®æ¨¡å—   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å› æ­¤æˆ‘ä»¬ä¹Ÿå°†æˆ‘ä»¬è‡ªå·±çš„starterè¿™æ ·è®¾è®¡ï¼š</p>
<p>æˆ‘ä»¬è®¾è®¡ä¸‰ä¸ªæ¨¡å—ï¼š</p>
<ul>
<li>spring-boot-helloï¼šåŸºç¡€ä¸šåŠ¡åŠŸèƒ½æ¨¡å—</li>
<li>spring-boot-starter-helloï¼šå¯åŠ¨å™¨</li>
<li>spring-boot-autoconifgurer-helloï¼šè‡ªåŠ¨é…ç½®ä¾èµ–</li>
</ul>
<p>é¦–å…ˆæ˜¯åŸºç¡€ä¸šåŠ¡åŠŸèƒ½æ¨¡å—ï¼Œè¿™é‡Œæˆ‘ä»¬éšä¾¿åˆ›å»ºä¸€ä¸ªç±»å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldService</span> &#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨å™¨ä¸»è¦åšä¾èµ–ç®¡ç†ï¼Œè¿™é‡Œå°±ä¸å†™ä»»ä½•ä»£ç ï¼Œåªå†™pomæ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigurer-hello<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¯¼å…¥autoconfigureræ¨¡å—ä½œä¸ºä¾èµ–å³å¯ï¼Œæ¥ç€æˆ‘ä»¬å»ç¼–å†™autoconfigureræ¨¡å—ï¼Œé¦–å…ˆå¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-hello<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€åˆ›å»ºä¸€ä¸ªHelloWorldAutoConfigurationä½œä¸ºè‡ªåŠ¨é…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(HelloWorldService.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(HelloWorldProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(<span class="built_in">this</span>.getClass().getName());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    HelloWorldProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HelloWorldService <span class="title function_">helloWorldService</span><span class="params">()</span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;è‡ªå®šä¹‰starteré¡¹ç›®å·²å¯åŠ¨ï¼&quot;</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;è¯»å–åˆ°è‡ªå®šä¹‰é…ç½®ï¼š&quot;</span>+properties.getValue());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HelloWorldService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„é…ç½®è¯»å–ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;hello.world&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åå†ç¼–å†™<code>spring.factories</code>æ–‡ä»¶ï¼Œå¹¶å°†æˆ‘ä»¬çš„è‡ªåŠ¨é…ç½®ç±»æ·»åŠ å³å¯ï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">  com.hello.autoconfigurer.HelloWorldAutoConfiguration</span></span><br></pre></td></tr></table></figure>

<p>æœ€åå†Mavenæ ¹é¡¹ç›®æ‰§è¡Œ<code>install</code>å®‰è£…åˆ°æœ¬åœ°ä»“åº“ï¼Œå®Œæˆã€‚æ¥ç€å°±å¯ä»¥åœ¨å…¶ä»–é¡¹ç›®ä¸­ä½¿ç”¨æˆ‘ä»¬ç¼–å†™çš„è‡ªå®šä¹‰starteräº†ã€‚</p>
<h3 id="Runneræ¥å£"><a href="#Runneræ¥å£" class="headerlink" title="Runneræ¥å£"></a>Runneræ¥å£</h3><p>åœ¨é¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®å¯åŠ¨å®Œæˆä¹‹åï¼Œç´§æ¥ç€æ‰§è¡Œä¸€æ®µä»£ç ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç¼–å†™è‡ªå®šä¹‰çš„ApplicationRunneræ¥è§£å†³ï¼Œå®ƒä¼šåœ¨é¡¹ç›®å¯åŠ¨å®Œæˆåæ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯è‡ªå®šä¹‰æ‰§è¡Œï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨CommandLineRunnerï¼Œå®ƒä¹Ÿæ”¯æŒä½¿ç”¨@Orderæˆ–æ˜¯å®ç°Orderedæ¥å£æ¥æ”¯æŒä¼˜å…ˆçº§æ‰§è¡Œã€‚</p>
<p>å®é™…ä¸Šå®ƒå°±æ˜¯runæ–¹æ³•çš„æœ€åï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title function_">run</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    ....</span><br><span class="line"></span><br><span class="line">        listeners.started(context, timeTakenToStartup);</span><br><span class="line">  			<span class="comment">//è¿™é‡Œå·²ç»å®Œæˆæ•´ä¸ªSpringBooté¡¹ç›®å¯åŠ¨ï¼Œæ‰€ä»¥æ‰§è¡Œæ‰€æœ‰çš„Runner</span></span><br><span class="line">        <span class="built_in">this</span>.callRunners(context, applicationArguments);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var12) &#123;</span><br><span class="line">        <span class="built_in">this</span>.handleRunFailure(context, var12, listeners);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(var12);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Duration</span> <span class="variable">timeTakenToReady</span> <span class="operator">=</span> Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">        listeners.ready(context, timeTakenToReady);</span><br><span class="line">        <span class="keyword">return</span> context;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var11) &#123;</span><br><span class="line">        <span class="built_in">this</span>.handleRunFailure(context, var11, (SpringApplicationRunListeners)<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(var11);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†ç»§ç»­è®²è§£å‡ ä¹ç¨‹åºå‘˜å¿…ä¼šçš„Gitç‰ˆæœ¬æ§åˆ¶ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>springBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>springBootç¬”è®°-2</title>
    <url>/2022/04/26/SpringBoot%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<h1 id="Gitç‰ˆæœ¬æ§åˆ¶"><a href="#Gitç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="Gitç‰ˆæœ¬æ§åˆ¶"></a>Gitç‰ˆæœ¬æ§åˆ¶</h1><p><strong>æ³¨æ„ï¼š</strong>å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œç¡®ä¿è‡ªå·±çš„ç½‘ç»œå¯ä»¥ç•…é€šçš„è¿æ¥Githubï¼š<a href="https://github.com,è¿™ä¸ªæ˜¯ä¸€ä¸ªå›½å¤–ç½‘ç«™,è¿èµ·æ¥ç‰¹åˆ«å¡,è‡³äºç”¨ä»€ä¹ˆæ–¹å¼å®ç°æµç•…è®¿é—®,æ‡‚çš„éƒ½æ‡‚./">https://github.comï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªå›½å¤–ç½‘ç«™ï¼Œè¿èµ·æ¥ç‰¹åˆ«å¡ï¼Œè‡³äºç”¨ä»€ä¹ˆæ–¹å¼å®ç°æµç•…è®¿é—®ï¼Œæ‡‚çš„éƒ½æ‡‚ã€‚</a></p>
<span id="more"></span>

<p>å…¶å®ç‰ˆæœ¬æ§åˆ¶åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­æ— å¤„ä¸åœ¨ï¼Œæ¯”å¦‚ä½ çš„æœŸæœ«æˆ–æ˜¯æ¯•ä¸šç­”è¾©è®ºæ–‡ï¼Œç”±äºä½ å†™å¾—ä¸è§„èŒƒæˆ–æ˜¯è€å¸ˆä¸æ»¡æ„ï¼Œä½ çš„è€å¸ˆå¯èƒ½ä¼šè®©ä½ æ”¹äº†åˆæ”¹ï¼Œäºæ˜¯å°±ä¼šå‡ºç°ä¸‹é¢è¿™ç§æƒ…å†µï¼š</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20200417%2F1e63ac0f4d8442cb8c9ab1cb73f510c4.jpeg&refer=http%3A%2F%2F5b0988e595225.cdn.sohucs.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1644370473&t=fa8742db0b4f8db635ec003e37bca76c" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>æˆ‘ä»¬æ‰‹é‡Œçš„è®ºæ–‡å¯èƒ½ä¼šç»è¿‡å¤šæ¬¡ç‰ˆæœ¬è¿­ä»£ï¼Œæœ€ç»ˆæˆ‘ä»¬ä¼šé€‰å–ä¸€ä¸ªæœ€å¥½çš„ç‰ˆæœ¬ä½œä¸ºæœ€ç»ˆæäº¤çš„è®ºæ–‡ã€‚ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ä¸ä»…ä»…æ˜¯ä¸ºäº†å»è®°å½•ç‰ˆæœ¬è¿­ä»£å†å²ï¼Œæ›´æ˜¯ä¸ºäº†èƒ½å¤Ÿéšæ—¶å›é€€åˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå®ç°æ—¶é—´å›æº¯ã€‚åŒæ—¶ï¼Œå¯èƒ½æˆ‘ä»¬çš„è®ºæ–‡æ˜¯å¤šä¸ªäººä¸€åŒå®Œæˆï¼Œé‚£ä¹ˆå¤šä¸ªäººå¦‚ä½•å»å®ç°åŒæ­¥ï¼Œå¦‚ä½•ä¿è¯æ¯ä¸ªäººæäº¤çš„æ›´æ”¹éƒ½èƒ½å¤Ÿæ­£å¸¸æ±‡æ€»ï¼Œå¦‚ä½•è§£å†³å†²çªï¼Œè¿™äº›é—®é¢˜éƒ½éœ€è¦ä¸€ä¸ªä¼˜ç§€çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¥è§£å†³ã€‚</p>
<h2 id="èµ°è¿›Git"><a href="#èµ°è¿›Git" class="headerlink" title="èµ°è¿›Git"></a>èµ°è¿›Git</h2><p>æˆ‘ä»¬å¼€å‘çš„é¡¹ç›®ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªåˆé€‚çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¥ååŠ©æˆ‘ä»¬æ›´å¥½åœ°ç®¡ç†ç‰ˆæœ¬è¿­ä»£ï¼Œè€ŒGitæ­£æ˜¯å› æ­¤è€Œè¯ç”Ÿçš„ï¼ˆæœ‰å…³Gitçš„å†å²ï¼Œè¿™é‡Œå°±ä¸å¤šåšé˜è¿°äº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œäº†è§£ï¼Œæ˜¯ä¸€ä½é¡¶çº§å¤§ä½¬åœ¨ä¸€æ€’ä¹‹ä¸‹åªèŠ±äº†2å‘¨æ—¶é—´ç”¨Cè¯­è¨€å¼€å‘çš„ï¼Œä¹‹åçš„ç« èŠ‚è¿˜ä¼šé‡åˆ°ä»–ï¼‰</p>
<p>é¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹Gitæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg2020.cnblogs.com%2Fblog%2F932856%2F202004%2F932856-20200423143251346-796113044.jpg&refer=http%3A%2F%2Fimg2020.cnblogs.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1644374894&t=7c2044128f7851ecd92de3c01f0187ca" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒå¤§è‡´åˆ†ä¸º4ä¸ªæ¿å—ï¼š</p>
<ul>
<li>å·¥ä½œç›®å½•ï¼šå­˜æ”¾æˆ‘ä»¬æ­£åœ¨å†™çš„ä»£ç ï¼ˆå½“æˆ‘ä»¬æ–°ç‰ˆæœ¬å¼€å‘å®Œæˆä¹‹åï¼Œå°±å¯ä»¥è¿›è¡Œæ–°ç‰ˆæœ¬çš„æäº¤ï¼‰</li>
<li>æš‚å­˜åŒºï¼šæš‚æ—¶ä¿å­˜å¾…æäº¤çš„å†…å®¹ï¼ˆæ–°ç‰ˆæœ¬æäº¤åä¼šå­˜æ”¾åˆ°æœ¬åœ°ä»“åº“ï¼‰</li>
<li>æœ¬åœ°ä»“åº“ï¼šä½äºæˆ‘ä»¬ç”µè„‘ä¸Šçš„ä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶ä»“åº“ï¼ˆå­˜æ”¾çš„å°±æ˜¯å½“å‰é¡¹ç›®å„ä¸ªç‰ˆæœ¬ä»£ç çš„å¢åˆ ä¿¡æ¯ï¼‰</li>
<li>è¿œç¨‹ä»“åº“ï¼šä½äºæœåŠ¡å™¨ä¸Šçš„ç‰ˆæœ¬æ§åˆ¶ä»“åº“ï¼ˆæœåŠ¡å™¨ä¸Šçš„ç‰ˆæœ¬ä¿¡æ¯å¯ä»¥ç”±æœ¬åœ°ä»“åº“æ¨é€ä¸Šå»ï¼Œä¹Ÿå¯ä»¥ä»æœåŠ¡å™¨æŠ“å–åˆ°æœ¬åœ°ä»“åº“ï¼‰</li>
</ul>
<p>å®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ§åˆ¶ç³»ç»Ÿï¼Œå› æ­¤ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ¯ä¸ªäººçš„ç”µè„‘ä¸Šéƒ½æœ‰ä¸€ä¸ªæœ¬åœ°ä»“åº“ï¼Œç”±å¤§å®¶å…±åŒå‘è¿œç¨‹ä»“åº“å»æ¨é€ç‰ˆæœ¬è¿­ä»£ä¿¡æ¯ã€‚</p>
<p>é€šè¿‡è¿™ä¸€ç³»åˆ—æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°æ¯å¼€å‘å®Œä¸€ä¸ªç‰ˆæœ¬æˆ–æ˜¯ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æäº¤ä¸€æ¬¡æ–°ç‰ˆæœ¬ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶é¡¹ç›®çš„ç‰ˆæœ¬è¿­ä»£ï¼Œæƒ³å›é€€åˆ°ä¹‹å‰çš„ç‰ˆæœ¬éšæ—¶éƒ½å¯ä»¥å›é€€ï¼Œæƒ³æŸ¥çœ‹æ–°ç‰ˆæœ¬æ·»åŠ æˆ–æ˜¯åˆ é™¤äº†ä»€ä¹ˆä»£ç ï¼Œéšæ—¶éƒ½å¯ä»¥æŸ¥çœ‹ã€‚</p>
<h2 id="å®‰è£…Git"><a href="#å®‰è£…Git" class="headerlink" title="å®‰è£…Git"></a>å®‰è£…Git</h2><p>é¦–å…ˆè¯·å‰å¾€Gitå®˜ç½‘å»ä¸‹è½½æœ€æ–°çš„å®‰è£…åŒ…ï¼š<a href="https://git-scm.com/download/win">https://git-scm.com/download/win</a></p>
<p>è¿™æ‰‹æŠŠæ‰‹æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•å®‰è£…Gitç¯å¢ƒã€‚</p>
<p>å®‰è£…å®Œæˆåï¼Œéœ€è¦è®¾å®šç”¨æˆ·åå’Œé‚®ç®±æ¥åŒºåˆ†ä¸åŒçš„ç”¨æˆ·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git config --global user.name &quot;Your Name&quot;</span><br><span class="line">git config --global user.email &quot;email@example.com&quot;</span><br></pre></td></tr></table></figure>

<h2 id="åŸºæœ¬å‘½ä»¤ä»‹ç»"><a href="#åŸºæœ¬å‘½ä»¤ä»‹ç»" class="headerlink" title="åŸºæœ¬å‘½ä»¤ä»‹ç»"></a>åŸºæœ¬å‘½ä»¤ä»‹ç»</h2><h3 id="åˆ›å»ºæœ¬åœ°ä»“åº“"><a href="#åˆ›å»ºæœ¬åœ°ä»“åº“" class="headerlink" title="åˆ›å»ºæœ¬åœ°ä»“åº“"></a>åˆ›å»ºæœ¬åœ°ä»“åº“</h3><p>æˆ‘ä»¬å¯ä»¥å°†ä»»æ„ä¸€ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºä¸€ä¸ªæœ¬åœ°ä»“åº“ï¼Œè¾“å…¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥åï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª<code>.git</code>ç›®å½•ï¼Œæ³¨æ„è¿™ä¸ªç›®å½•æ˜¯ä¸€ä¸ªéšè—ç›®å½•ï¼Œè€Œå½“å‰ç›®å½•å°±æ˜¯æˆ‘ä»¬çš„å·¥ä½œç›®å½•ã€‚</p>
<p>åˆ›å»ºæˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹å½“å‰çš„ä¸€ä¸ªçŠ¶æ€ï¼Œè¾“å…¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå·²ç»æˆåŠŸé…ç½®ä¸ºGitæœ¬åœ°ä»“åº“ï¼Œé‚£ä¹ˆè¾“å…¥åå¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">No commits yet</span><br></pre></td></tr></table></figure>

<p>è¿™è¡¨ç¤ºæˆ‘ä»¬è¿˜æ²¡æœ‰å‘ä»“åº“ä¸­æäº¤ä»»ä½•å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç©ºçš„çŠ¶æ€ã€‚</p>
<h3 id="æ·»åŠ å’Œæäº¤"><a href="#æ·»åŠ å’Œæäº¤" class="headerlink" title="æ·»åŠ å’Œæäº¤"></a>æ·»åŠ å’Œæäº¤</h3><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå¦‚ä½•ä½¿ç”¨gitæ¥ç®¡ç†æˆ‘ä»¬æ–‡æ¡£çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–‡æœ¬æ–‡æ¡£ï¼Œéšä¾¿å†™å…¥ä¸€ç‚¹å†…å®¹ï¼Œæ¥ç€è¾“å…¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¼šå¾—åˆ°å¦‚ä¸‹æç¤ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	hello.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­Untracked filesæ˜¯æœªè¿½è¸ªæ–‡ä»¶çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶å¤„äºæœªè¿½è¸ªçŠ¶æ€ï¼Œé‚£ä¹ˆgitä¸ä¼šè®°å½•å®ƒçš„å˜åŒ–ï¼Œå§‹ç»ˆå°†å…¶å½“åšä¸€ä¸ªæ–°åˆ›å»ºçš„æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å°†å…¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œé‚£ä¹ˆå®ƒä¼šè‡ªåŠ¨å˜ä¸ºè¢«è¿½è¸ªçŠ¶æ€ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git add hello.txt #ä¹Ÿå¯ä»¥ add . ä¸€æ¬¡æ€§æ·»åŠ ç›®å½•ä¸‹æ‰€æœ‰çš„</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡æŸ¥çœ‹å½“å‰çŠ¶æ€ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">&quot;git rm --cached &lt;file&gt;...&quot;</span> to unstage)</span><br><span class="line">	new file:   hello.txt</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æ–‡ä»¶åç§°çš„é¢œè‰²å˜æˆäº†ç»¿è‰²ï¼Œå¹¶ä¸”æ˜¯å¤„äºChanges to be committedä¸‹é¢ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬çš„hello.txtç°åœ¨å·²ç»è¢«æ·»åŠ åˆ°æš‚å­˜åŒºäº†ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥å°è¯•å°†å…¶æäº¤åˆ°Gitæœ¬åœ°ä»“åº“ä¸­ï¼Œæ³¨æ„éœ€è¦è¾“å…¥æäº¤çš„æè¿°ä»¥ä¾¿åç»­æŸ¥çœ‹ï¼Œæ¯”å¦‚ä½ è¿™æ¬¡æäº¤ä¿®æ”¹äº†æˆ–æ˜¯æ–°å¢äº†å“ªäº›å†…å®¹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git commit -m <span class="string">&#x27;Hello World&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬çš„æäº¤è®°å½•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br><span class="line">git <span class="built_in">log</span> --graph</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡å˜æ›´çš„è¯¦ç»†å†…å®¹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git show [ä¹Ÿå¯ä»¥åŠ ä¸Šcommit IDæŸ¥çœ‹æŒ‡å®šçš„æäº¤è®°å½•]</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡æŸ¥çœ‹å½“å‰çŠ¶æ€ï¼Œå·²ç»æ˜¯æ¸…ç©ºçŠ¶æ€äº†ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å¯ä»¥å°è¯•ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„æ–‡æœ¬æ–‡æ¡£ï¼Œç”±äºå½“å‰æ–‡ä»¶å·²ç»æ˜¯è¢«è¿½è¸ªçŠ¶æ€ï¼Œé‚£ä¹ˆgitä¼šå»è·Ÿè¸ªå®ƒçš„å˜åŒ–ï¼Œå¦‚æœè¯´æ–‡ä»¶å‘ç”Ÿäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ¬¡æŸ¥çœ‹çŠ¶æ€ä¼šå¾—åˆ°ä¸‹é¢çš„ç»“æœï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">&quot;git restore &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">	modified:   hello.txt</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ç°åœ¨æ­¤æ–‡ä»¶æ˜¯å¤„äºå·²ä¿®æ”¹çŠ¶æ€ï¼Œæˆ‘ä»¬å¦‚æœä¿®æ”¹å¥½äº†ï¼Œå°±å¯ä»¥æäº¤æˆ‘ä»¬çš„æ–°ç‰ˆæœ¬åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&#x27;Modify Text&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥æŸ¥è¯¢ä¸€ä¸‹æäº¤è®°å½•ï¼Œå¯ä»¥çœ‹åˆ°ä¸€å…±æœ‰ä¸¤æ¬¡æäº¤è®°å½•ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>.gitignore</code>æ–‡ä»¶æ¥ç¡®å®šä¸€ä¸ªæ–‡ä»¶å¿½ç•¥åˆ—è¡¨ï¼Œå¦‚æœå¿½ç•¥åˆ—è¡¨ä¸­çš„æ–‡ä»¶å­˜åœ¨ä¸”ä¸æ˜¯è¢«è¿½è¸ªçŠ¶æ€ï¼Œé‚£ä¹ˆgitä¸ä¼šå¯¹å…¶è¿›è¡Œä»»ä½•æ£€æŸ¥ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿™æ ·å°±ä¼šåŒ¹é…æ‰€æœ‰ä»¥txtç»“å°¾çš„æ–‡ä»¶</span></span><br><span class="line"><span class="string">*.txt</span></span><br><span class="line"><span class="comment"># è™½ç„¶ä¸Šé¢æ’é™¤äº†æ‰€æœ‰txtç»“å°¾çš„æ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªä¸æ’é™¤</span></span><br><span class="line"><span class="type">!666.txt</span></span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å°†å…¨éƒ¨å¿½ç•¥</span></span><br><span class="line"><span class="string">test/</span></span><br><span class="line"><span class="comment"># ç›®å½•ä¸­æ‰€æœ‰ä»¥txtç»“å°¾çš„æ–‡ä»¶ï¼Œä½†ä¸åŒ…æ‹¬å­ç›®å½•</span></span><br><span class="line"><span class="string">xxx/*.txt</span></span><br><span class="line"><span class="comment"># ç›®å½•ä¸­æ‰€æœ‰ä»¥txtç»“å°¾çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬å­ç›®å½•</span></span><br><span class="line"><span class="string">xxx/**/*.txt</span></span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºåï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯å¦è¿˜ä¼šæ£€æµ‹åˆ°æˆ‘ä»¬å¿½ç•¥çš„æ–‡ä»¶ã€‚</p>
<h3 id="å›æ»š"><a href="#å›æ»š" class="headerlink" title="å›æ»š"></a>å›æ»š</h3><p>å½“æˆ‘ä»¬æƒ³è¦å›é€€åˆ°è¿‡å»çš„ç‰ˆæœ¬æ—¶ï¼Œå°±å¯ä»¥æ‰§è¡Œå›æ»šæ“ä½œï¼Œæ‰§è¡Œåï¼Œå¯ä»¥å°†å·¥ä½œç©ºé—´çš„å†…å®¹æ¢å¤åˆ°æŒ‡å®šæäº¤çš„çŠ¶æ€ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git reset --hard commitID</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œåï¼Œä¼šç›´æ¥é‡ç½®ä¸ºé‚£ä¸ªæ—¶å€™çš„çŠ¶æ€ã€‚å†æ¬¡æŸ¥çœ‹æäº¤æ—¥å¿—ï¼Œæˆ‘ä»¬å‘ç°ä¹‹åçš„æ—¥å¿—å…¨éƒ¨æ¶ˆå¤±äº†ã€‚</p>
<p>é‚£ä¹ˆè¦æ˜¯ç°åœ¨æˆ‘åˆæƒ³å›å»å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯çš„æ‰€æœ‰æ“ä½œè®°å½•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git reflog</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±èƒ½æ‰¾åˆ°ä¹‹å‰çš„commitIDï¼Œå†æ¬¡é‡ç½®å³å¯ã€‚</p>
<h2 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h2><p>åˆ†æ”¯å°±åƒæˆ‘ä»¬æ ‘ä¸Šçš„ä¸€ä¸ªæ ‘æä¸€æ ·ï¼Œå®ƒä»¬å¯èƒ½ä¸€å¼€å§‹çš„æ—¶å€™æ˜¯åŒä¸€æ ¹æ ‘æï¼Œä½†æ˜¯é•¿ç€é•¿ç€å°±å¼€å§‹åˆ†é“æ‰¬é•³äº†ï¼Œè¿™å°±æ˜¯åˆ†æ”¯ã€‚æˆ‘ä»¬çš„ä»£ç ä¹Ÿæ˜¯è¿™æ ·ï¼Œå¯èƒ½ä¸€å¼€å§‹å†™åŸºç¡€åŠŸèƒ½çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯å•ä¸ªåˆ†æ”¯ï¼Œä½†æ˜¯æŸä¸€å¤©æˆ‘ä»¬å¸Œæœ›åŸºäºè¿™äº›åŸºç¡€çš„åŠŸèƒ½ï¼ŒæŠŠæˆ‘ä»¬çš„é¡¹ç›®åšæˆä¸¤ä¸ªä¸åŒæ–¹å‘çš„é¡¹ç›®ï¼Œæ¯”å¦‚ä¸€ä¸ªæ–¹å‘åšWebç½‘ç«™ï¼Œå¦ä¸€ä¸ªæ–¹å‘åšæ¸¸æˆæœåŠ¡ç«¯ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªä¸»å¹²ä¸Šåˆ†å‡ºNä¸ªåˆ†æ”¯ï¼Œåˆ†åˆ«å¯¹å¤šä¸ªåˆ†æ”¯çš„ä»£ç è¿›è¡Œç»´æŠ¤ã€‚</p>
<h3 id="åˆ›å»ºåˆ†æ”¯"><a href="#åˆ›å»ºåˆ†æ”¯" class="headerlink" title="åˆ›å»ºåˆ†æ”¯"></a>åˆ›å»ºåˆ†æ”¯</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ä»“åº“ä¸­å­˜åœ¨çš„åˆ†æ”¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æœ‰ä¸€ä¸ªmasteråˆ†æ”¯çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬ä½¿ç”¨çš„ä¹Ÿæ˜¯masteråˆ†æ”¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹masteråˆ†æ”¯éƒ½æ˜¯æ­£å¼ç‰ˆæœ¬çš„æ›´æ–°ï¼Œè€Œå…¶ä»–åˆ†æ”¯ä¸€èˆ¬æ˜¯å¼€å‘ä¸­æ‰é¢‘ç¹æ›´æ–°çš„ã€‚æˆ‘ä»¬æ¥ç€æ¥åŸºäºå½“å‰åˆ†æ”¯åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git branch <span class="built_in">test</span></span><br><span class="line"><span class="comment"># å¯¹åº”çš„åˆ é™¤åˆ†æ”¯æ˜¯</span></span><br><span class="line">git branch -d yyds</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹æ–‡ä»¶ï¼Œæäº¤ï¼Œå†æŸ¥çœ‹ä¸€ä¸‹æäº¤æ—¥å¿—ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git commit -a -m <span class="string">&#x27;branch master commit&#x27;</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ·»åŠ -aæ¥è‡ªåŠ¨å°†æœªæ”¾å…¥æš‚å­˜åŒºçš„å·²ä¿®æ”¹æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒºå¹¶æ‰§è¡Œæäº¤æ“ä½œã€‚æŸ¥çœ‹æ—¥å¿—ï¼Œæˆ‘ä»¬å‘ç°ç°åœ¨æˆ‘ä»¬çš„æäº¤åªç”Ÿæ•ˆäºmasteråˆ†æ”¯ï¼Œè€Œæ–°åˆ›å»ºçš„åˆ†æ”¯å¹¶æ²¡æœ‰å‘ç”Ÿä¿®æ”¹ã€‚</p>
<p>æˆ‘ä»¬å°†åˆ†æ”¯åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git checkout <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œæ–‡ä»¶å˜æˆäº†æ­¤åˆ†æ”¯åˆ›å»ºçš„æ—¶çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸åŒåˆ†æ”¯ä¸‹æˆ‘ä»¬çš„æ–‡ä»¶å†…å®¹æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨å†æ¥æäº¤ä¸€æ¬¡å˜æ›´ï¼Œä¼šå‘ç°å®ƒåªç”Ÿæ•ˆåœ¨yydsåˆ†æ”¯ä¸Šã€‚æˆ‘ä»¬å¯ä»¥çœ‹çœ‹å½“å‰çš„åˆ†æ”¯çŠ¶æ€ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">log</span> --all --graph</span><br></pre></td></tr></table></figure>

<h3 id="åˆå¹¶åˆ†æ”¯"><a href="#åˆå¹¶åˆ†æ”¯" class="headerlink" title="åˆå¹¶åˆ†æ”¯"></a>åˆå¹¶åˆ†æ”¯</h3><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ä¸¤ä¸ªåˆ†æ”¯æ›´æ–°çš„å†…å®¹æœ€ç»ˆåˆå¹¶åˆ°åŒä¸€ä¸ªåˆ†æ”¯ä¸Šï¼Œæˆ‘ä»¬å…ˆåˆ‡æ¢å›ä¸»åˆ†æ”¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git checkout master</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ä½¿ç”¨åˆ†æ”¯åˆå¹¶å‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git merge <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>ä¼šå¾—åˆ°å¦‚ä¸‹æç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Auto-merging hello.txt</span><br><span class="line">CONFLICT (content): Merge conflict in hello.txt</span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result.</span><br></pre></td></tr></table></figure>

<p>åœ¨åˆå¹¶è¿‡ç¨‹ä¸­äº§ç”Ÿäº†å†²çªï¼Œå› ä¸ºä¸¤ä¸ªåˆ†æ”¯éƒ½å¯¹hello.txtæ–‡ä»¶è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆç°åœ¨è¦åˆå¹¶åœ¨ä¸€èµ·ï¼Œåˆ°åº•ä¿ç•™è°çš„helloæ–‡ä»¶å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹æ˜¯å“ªé‡Œå‘ç”Ÿäº†å†²çªï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œç°åœ¨æˆ‘ä»¬å°†masteråˆ†æ”¯çš„ç‰ˆæœ¬å›é€€åˆ°ä¿®æ”¹hello.txtä¹‹å‰æˆ–æ˜¯ç›´æ¥ä¿®æ”¹ä¸ºæœ€æ–°ç‰ˆæœ¬çš„å†…å®¹ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰å†²çªäº†ï¼Œæ¥ç€å†æ‰§è¡Œä¸€æ¬¡åˆå¹¶æ“ä½œï¼Œç°åœ¨ä¸¤ä¸ªåˆ†æ”¯æˆåŠŸåˆå¹¶ä¸ºåŒä¸€ä¸ªåˆ†æ”¯ã€‚</p>
<h3 id="å˜åŸºåˆ†æ”¯"><a href="#å˜åŸºåˆ†æ”¯" class="headerlink" title="å˜åŸºåˆ†æ”¯"></a>å˜åŸºåˆ†æ”¯</h3><p>é™¤äº†ç›´æ¥åˆå¹¶åˆ†æ”¯ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿›è¡Œå˜åŸºæ“ä½œï¼Œå®ƒè·Ÿåˆå¹¶ä¸åŒï¼Œåˆå¹¶æ˜¯åˆ†æ”¯å›åˆ°ä¸»å¹²çš„è¿‡ç¨‹ï¼Œè€Œå˜åŸºæ˜¯ç›´æ¥ä¿®æ”¹åˆ†æ”¯å¼€å§‹çš„ä½ç½®ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›å°†yydså˜åŸºåˆ°masterä¸Šï¼Œé‚£ä¹ˆyydsä¼šå°†åˆ†æ”¯èµ·ç‚¹ç§»åŠ¨åˆ°masteræœ€åä¸€æ¬¡æäº¤ä½ç½®ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git rebase master</span><br></pre></td></tr></table></figure>

<p>å˜åŸºåï¼Œyydsåˆ†æ”¯ç›¸å½“äºåŒæ­¥äº†æ­¤å‰masteråˆ†æ”¯çš„å…¨éƒ¨æäº¤ã€‚</p>
<h3 id="ä¼˜é€‰"><a href="#ä¼˜é€‰" class="headerlink" title="ä¼˜é€‰"></a>ä¼˜é€‰</h3><p>æˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©å…¶å°†ä»–åˆ†æ”¯ä¸Šçš„æäº¤ä½œç”¨äºå½“å‰åˆ†æ”¯ä¸Šï¼Œè¿™ç§æ“ä½œç§°ä¸ºcherrypickï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git cherry-pick &lt;commit <span class="built_in">id</span>&gt;:å•ç‹¬åˆå¹¶ä¸€ä¸ªæäº¤</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬åœ¨masteråˆ†æ”¯ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œæäº¤æ­¤æ¬¡æ›´æ–°ï¼Œæ¥ç€é€šè¿‡cherry-pickçš„æ–¹å¼å°†æ­¤æ¬¡æ›´æ–°ä½œç”¨äºteståˆ†æ”¯ä¸Šã€‚</p>
<hr>
<h2 id="ä½¿ç”¨IDEAç‰ˆæœ¬æ§åˆ¶"><a href="#ä½¿ç”¨IDEAç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="ä½¿ç”¨IDEAç‰ˆæœ¬æ§åˆ¶"></a>ä½¿ç”¨IDEAç‰ˆæœ¬æ§åˆ¶</h2><p>è™½ç„¶å‰é¢æˆ‘ä»¬åŸºæœ¬è®²è§£äº†gitçš„å‘½ä»¤è¡Œä½¿ç”¨æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªå›¾å½¢åŒ–ç•Œé¢ï¼Œå§‹ç»ˆä¼šæ„Ÿè§‰åˆ°å¾ˆæŠ½è±¡ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨IDEAæ¥æ¼”ç¤ºï¼ŒIDEAå†…éƒ¨é›†æˆäº†gitæ¨¡å—ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬çš„gitç‰ˆæœ¬ç®¡ç†å›¾å½¢åŒ–æ˜¾ç¤ºï¼Œå½“ç„¶é™¤äº†IDEAä¹Ÿæœ‰ä¸€äº›ç‹¬ç«‹çš„è½¯ä»¶æ¯”å¦‚ï¼šSourceTreeï¼ˆæŒºå¥½ç”¨ï¼‰</p>
<p>æ‰“å¼€IDEAåï¼Œæ‰¾åˆ°ç‰ˆæœ¬æ§æ¨¡å—ï¼Œæˆ‘ä»¬ç›´æ¥ç‚¹å‡»åˆ›å»ºæœ¬åœ°ä»“åº“ï¼Œå®ƒä¼šè‡ªåŠ¨å°†å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•ä½œä¸ºæˆ‘ä»¬çš„æœ¬åœ°ä»“åº“ï¼Œè€Œæˆ‘ä»¬ç¼–å†™çš„æ‰€æœ‰ä»£ç å’Œé¡¹ç›®ç›®å½•ä¸‹å…¶ä»–çš„æ–‡ä»¶éƒ½å¯ä»¥è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚</p>
<p>æˆ‘ä»¬å‘ç°æ‰€æœ‰é¡¹ç›®ä¸­æ­£åœ¨ç¼–å†™çš„ç±»æ–‡ä»¶å…¨éƒ¨å˜çº¢äº†ï¼Œä¹Ÿå°±æ˜¯å¤„äºæœªè¿½è¸ªçŠ¶æ€ï¼Œæ¥ç€æˆ‘ä»¬è¿›è¡Œç¬¬ä¸€æ¬¡åˆå§‹åŒ–æäº¤ï¼Œæäº¤ä¹‹åæˆ‘ä»¬å¯ä»¥åœ¨ä¸‹æ–¹çœ‹åˆ°æ‰€æœ‰çš„æœ¬åœ°ä»“åº“æäº¤è®°å½•ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥æ•´åˆä¸€ä¸‹Webç¯å¢ƒï¼Œåˆ›å»ºæ–°çš„ç±»ä¹‹åï¼ŒIDEAä¼šæç¤ºæˆ‘ä»¬æ˜¯å¦å°†æ–‡ä»¶æ·»åŠ åˆ°Gitï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦æ”¾å…¥æš‚å­˜åŒºå¹¶å¼€å¯è¿½è¸ªï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹æ¯”ä¸¤æ¬¡ä»£ç çš„ç›¸åŒå’Œä¸åŒä¹‹å¤„ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥æ¼”ç¤ºä¸€ä¸‹åˆ†æ”¯åˆ›å»ºå’Œåˆ†æ”¯ç®¡ç†ã€‚</p>
<hr>
<h2 id="è¿œç¨‹ä»“åº“"><a href="#è¿œç¨‹ä»“åº“" class="headerlink" title="è¿œç¨‹ä»“åº“"></a>è¿œç¨‹ä»“åº“</h2><p>è¿œç¨‹ä»“åº“å®é™…ä¸Šå°±æ˜¯ä½äºæœåŠ¡å™¨ä¸Šçš„ä»“åº“ï¼Œå®ƒèƒ½åœ¨è¿œç«¯ä¿å­˜æˆ‘ä»¬çš„ç‰ˆæœ¬å†å²ï¼Œå¹¶ä¸”å¯ä»¥å®ç°å¤šäººåŒæ—¶åˆä½œç¼–å†™é¡¹ç›®ï¼Œæ¯ä¸ªäººéƒ½èƒ½å¤ŸåŒæ­¥ä»–äººçš„ç‰ˆæœ¬ï¼Œèƒ½å¤Ÿçœ‹åˆ°ä»–äººçš„ç‰ˆæœ¬æäº¤ï¼Œç›¸å½“äºå°†æˆ‘ä»¬çš„ä»£ç æ”¾åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œæ‰˜ç®¡ã€‚</p>
<p>è¿œç¨‹ä»“åº“æœ‰å…¬æœ‰å’Œç§æœ‰çš„ï¼Œå…¬æœ‰çš„è¿œç¨‹ä»“åº“æœ‰GitHubã€ç äº‘ã€Codingç­‰ï¼Œä»–ä»¬éƒ½æ˜¯å¯¹å¤–å¼€æ”¾çš„ï¼Œæˆ‘ä»¬æ³¨å†Œè´¦å·ä¹‹åå°±å¯ä»¥ä½¿ç”¨è¿œç¨‹ä»“åº“è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå…¶ä¸­æœ€å¤§çš„å°±æ˜¯GitHubï¼Œä½†æ˜¯å®ƒæœåŠ¡å™¨åœ¨å›½å¤–ï¼Œæˆ‘ä»¬å›½å†…è¿æ¥å¯èƒ½ä¼šæœ‰ä¸€ç‚¹å¡ã€‚ç§æœ‰çš„ä¸€èˆ¬æ˜¯GitLabè¿™ç§è‡ªä¸»æ­å»ºçš„è¿œç¨‹ä»“åº“ç§æœï¼Œåœ¨å…¬å¸ä¸­æ¯”è¾ƒå¸¸ç”¨ï¼Œå®ƒåªå¯¹å…¬å¸å†…éƒ¨å¼€æ”¾ï¼Œä¸å¯¹å¤–å¼€æ”¾ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä»¥GitHubåšè®²è§£ï¼Œå®˜ç½‘ï¼š<a href="https://github.com,é¦–å…ˆå®Œæˆç”¨æˆ·æ³¨å†Œ./">https://github.comï¼Œé¦–å…ˆå®Œæˆç”¨æˆ·æ³¨å†Œã€‚</a></p>
<h3 id="è¿œç¨‹è´¦æˆ·è®¤è¯å’Œæ¨é€"><a href="#è¿œç¨‹è´¦æˆ·è®¤è¯å’Œæ¨é€" class="headerlink" title="è¿œç¨‹è´¦æˆ·è®¤è¯å’Œæ¨é€"></a>è¿œç¨‹è´¦æˆ·è®¤è¯å’Œæ¨é€</h3><p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„è¿œç¨‹ä»“åº“äº†ã€‚</p>
<p>åˆ›å»ºä»“åº“åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¨é€æ¥å°†æœ¬åœ°ä»“åº“ä¸­çš„å†…å®¹æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git remote add åç§° è¿œç¨‹ä»“åº“åœ°å€</span><br><span class="line">git push è¿œç¨‹ä»“åº“åç§° æœ¬åœ°åˆ†æ”¯åç§°[:è¿œç«¯åˆ†æ”¯åç§°]</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„<code>push</code>åé¢ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯è¿œç«¯åç§°ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯æœ¬åœ°åˆ†æ”¯åç§°ï¼Œä½†æ˜¯å¦‚æœæœ¬åœ°åˆ†æ”¯åç§°å’Œè¿œç«¯åˆ†æ”¯åç§°ä¸€è‡´ï¼Œé‚£ä¹ˆä¸ç”¨æŒ‡å®šè¿œç«¯åˆ†æ”¯åç§°ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å¸Œæœ›æ¨é€çš„åˆ†æ”¯åœ¨è¿œç«¯æ²¡æœ‰åŒåçš„ï¼Œé‚£ä¹ˆéœ€è¦é¢å¤–æŒ‡å®šã€‚æ¨é€å‰éœ€è¦ç™»é™†è´¦æˆ·ï¼ŒGitHubç°åœ¨ä¸å…è®¸ä½¿ç”¨ç”¨æˆ·åå¯†ç éªŒè¯ï¼Œåªå…è®¸ä½¿ç”¨ä¸ªäººAccessTokenæ¥éªŒè¯èº«ä»½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå»ç”Ÿæˆä¸€ä¸ªTokenæ‰å¯ä»¥ã€‚</p>
<p>æ¨é€åï¼Œæˆ‘ä»¬å‘ç°è¿œç¨‹ä»“åº“ä¸­çš„å†…å®¹å·²ç»ä¸æˆ‘ä»¬æœ¬åœ°ä»“åº“ä¸­çš„å†…å®¹ä¿æŒä¸€è‡´äº†ï¼Œæ³¨æ„ï¼Œè¿œç¨‹ä»“åº“ä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šä¸ªåˆ†æ”¯ã€‚</p>
<p>ä½†æ˜¯è¿™æ ·æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬æ¯æ¬¡éƒ½éœ€è¦å»è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œæœ‰æ²¡æœ‰ä¸€åŠ³æ°¸é€¸çš„æ–¹æ³•å‘¢ï¼Ÿå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨SSHæ¥å®ç°ä¸€æ¬¡æ€§æ ¡éªŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°ç”Ÿæˆä¸€ä¸ªrsaå…¬é’¥ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line"><span class="built_in">cat</span> ~/.ssh/github.pub</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨GitHubä¸Šä¸Šä¼ æˆ‘ä»¬çš„å…¬é’¥ï¼Œå½“æˆ‘ä»¬å†æ¬¡å»è®¿é—®GitHubæ—¶ï¼Œä¼šè‡ªåŠ¨éªŒè¯ï¼Œå°±æ— éœ€è¿›è¡Œç™»å½•äº†ï¼Œä¹‹ååœ¨Linuxéƒ¨åˆ†æˆ‘ä»¬ä¼šè¯¦ç»†è®²è§£SSHçš„åŸç†ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹å·¥ä½œåŒºçš„å†…å®¹ï¼Œæäº¤åˆ°æœ¬åœ°ä»“åº“åï¼Œå†æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œæäº¤çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬æ³¨æ„è§‚å¯Ÿæäº¤è®°å½•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git commit -a -m <span class="string">&#x27;Modify files&#x27;</span></span><br><span class="line">git <span class="built_in">log</span> --all --oneline --graph</span><br><span class="line">git push origin master </span><br><span class="line">git <span class="built_in">log</span> --all --oneline --graph</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å°†è¿œç«¯å’Œæœ¬åœ°çš„åˆ†æ”¯è¿›è¡Œç»‘å®šï¼Œç»‘å®šåå°±ä¸éœ€è¦æŒ‡å®šåˆ†æ”¯åç§°äº†ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git push --set-upstream origin master:master</span><br><span class="line">git push origin</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸€ä¸ªæœ¬åœ°ä»“åº“å¯¹åº”ä¸€ä¸ªè¿œç¨‹ä»“åº“çš„æƒ…å†µä¸‹ï¼Œè¿œç¨‹ä»“åº“åŸºæœ¬ä¸Šå°±æ˜¯çº¯ç²¹çš„ä»£ç æ‰˜ç®¡äº†ï¼ˆäº‘ç›˜é‚£ç§æ„Ÿè§‰ï¼Œå°±çº¯ç²¹æ˜¯å­˜ä½ ä»£ç çš„ï¼‰</p>
<h3 id="å…‹éš†é¡¹ç›®"><a href="#å…‹éš†é¡¹ç›®" class="headerlink" title="å…‹éš†é¡¹ç›®"></a>å…‹éš†é¡¹ç›®</h3><p>å¦‚æœæˆ‘ä»¬å·²ç»å­˜åœ¨ä¸€ä¸ªè¿œç¨‹ä»“åº“çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿œç¨‹ä»“åº“çš„ä»£ç ä¸Šç»§ç»­ç¼–å†™ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…‹éš†æ“ä½œæ¥å°†è¿œç«¯ä»“åº“çš„å†…å®¹å…¨éƒ¨å¤åˆ¶åˆ°æœ¬åœ°ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> è¿œç¨‹ä»“åº“åœ°å€</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æœ¬åœ°å°±èƒ½å¤Ÿç›´æ¥ä¸è¿œç¨‹ä¿æŒåŒæ­¥ã€‚</p>
<h3 id="æŠ“å–ã€æ‹‰å–å’Œå†²çªè§£å†³"><a href="#æŠ“å–ã€æ‹‰å–å’Œå†²çªè§£å†³" class="headerlink" title="æŠ“å–ã€æ‹‰å–å’Œå†²çªè§£å†³"></a>æŠ“å–ã€æ‹‰å–å’Œå†²çªè§£å†³</h3><p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œå‡ºç°å¤šä¸ªæœ¬åœ°ä»“åº“å¯¹åº”ä¸€ä¸ªè¿œç¨‹ä»“åº“çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ä¸€ä¸ªå›¢é˜Ÿé‡Œé¢ï¼ŒNä¸ªäººéƒ½åœ¨ä½¿ç”¨åŒä¸€ä¸ªè¿œç¨‹ä»“åº“ï¼Œä½†æ˜¯ä»–ä»¬å„è‡ªåªè´Ÿè´£ç¼–å†™å’Œæ¨é€è‡ªå·±ä¸šåŠ¡éƒ¨åˆ†çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ååŒå·¥ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦åè°ƒã€‚</p>
<p>æ¯”å¦‚ç¨‹åºå‘˜Aå®Œæˆäº†ä»–çš„æ¨¡å—ï¼Œé‚£ä¹ˆä»–å°±å¯ä»¥æäº¤ä»£ç å¹¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œè¿™æ—¶ç¨‹åºå‘˜Bä¹Ÿè¦å¼€å§‹å†™ä»£ç äº†ï¼Œç”±äºè¿œç¨‹ä»“åº“æœ‰å…¶ä»–ç¨‹åºå‘˜çš„æäº¤è®°å½•ï¼Œå› æ­¤ç¨‹åºå‘˜Bçš„æœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“ä¸ä¸€è‡´ï¼Œè¿™æ—¶å°±éœ€è¦æœ‰å…ˆè¿›è¡Œpullæ“ä½œï¼Œè·å–è¿œç¨‹ä»“åº“ä¸­æœ€æ–°çš„æäº¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git fetch è¿œç¨‹ä»“åº“ <span class="comment">#æŠ“å–ï¼šåªè·å–ä½†ä¸åˆå¹¶è¿œç«¯åˆ†æ”¯ï¼Œåé¢éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆå¹¶æ‰èƒ½æäº¤</span></span><br><span class="line">git pull è¿œç¨‹ä»“åº“ <span class="comment">#æ‹‰å–ï¼šè·å–+åˆå¹¶</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç¨‹åºå‘˜Bæ‹‰å–äº†æœ€æ–°çš„ç‰ˆæœ¬åï¼Œå†ç¼–å†™è‡ªå·±çš„ä»£ç ç„¶åæäº¤å°±å¯ä»¥å®ç°å¤šäººåˆä½œç¼–å†™é¡¹ç›®äº†ï¼Œå¹¶ä¸”åœ¨æ‹‰å–è¿‡ç¨‹ä¸­å°±èƒ½å°†åˆ«äººæäº¤çš„å†…å®¹åŒæ­¥åˆ°æœ¬åœ°ï¼Œå¼€å‘æ•ˆç‡å¤§å¤§æå‡ã€‚</p>
<p>å¦‚æœå·¥ä½œä¸­å­˜åœ¨ä¸åè°ƒçš„åœ°æ–¹ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬æœ¬åœ°æœ‰ä¸¤ä¸ªä»“åº“ï¼Œä¸€ä¸ªä»“åº“å»ä¿®æ”¹hello.txtå¹¶ç›´æ¥æäº¤ï¼Œå¦ä¸€ä¸ªä»“åº“ä¹Ÿä¿®æ”¹hello.txtå¹¶ç›´æ¥æäº¤ï¼Œä¼šå¾—åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">To https://github.com/xx/xxx.git</span><br><span class="line"> ! [rejected]        master -&gt; master (fetch first)</span><br><span class="line">error: failed to push some refs to &#x27;https://github.com/xx/xxx.git&#x27;</span><br><span class="line">hint: Updates were rejected because the remote contains work that you do</span><br><span class="line">hint: not have locally. This is usually caused by another repository pushing</span><br><span class="line">hint: to the same ref. You may want to first integrate the remote changes</span><br><span class="line">hint: (e.g., &#x27;git pull ...&#x27;) before pushing again.</span><br><span class="line">hint: See the &#x27;Note about fast-forwards&#x27; in &#x27;git push --help&#x27; for details.</span><br></pre></td></tr></table></figure>

<p>ä¸€æ—¦ä¸€ä¸ªæœ¬åœ°ä»“åº“æ¨é€äº†ä»£ç ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªæœ¬åœ°ä»“åº“çš„æ¨é€ä¼šè¢«æ‹’ç»ï¼ŒåŸå› æ˜¯å½“å‰æ–‡ä»¶å·²ç»è¢«å…¶ä»–çš„æ¨é€ç»™ä¿®æ”¹äº†ï¼Œæˆ‘ä»¬è¿™è¾¹ç›¸å½“äºæ˜¯å¦ä¸€ä¸ªç‰ˆæœ¬ï¼Œå’Œä¹‹å‰ä¸¤ä¸ªåˆ†æ”¯åˆå¹¶ä¸€æ ·ï¼Œäº§ç”Ÿäº†å†²çªï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½å»è§£å†³å†²çªé—®é¢˜ã€‚</p>
<p>å¦‚æœè¿œç¨‹ä»“åº“ä¸­çš„æäº¤å’Œæœ¬åœ°ä»“åº“ä¸­çš„æäº¤æ²¡æœ‰å»ç¼–å†™åŒä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥æ‹‰å–ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git pull è¿œç¨‹ä»“åº“</span><br></pre></td></tr></table></figure>

<p>æ‹‰å–åä¼šè‡ªåŠ¨è¿›è¡Œåˆå¹¶ï¼Œåˆå¹¶å®Œæˆä¹‹åæˆ‘ä»¬å†æäº¤å³å¯ã€‚</p>
<p>ä½†æ˜¯å¦‚æœä¸¤æ¬¡æäº¤éƒ½ä¿®æ”¹äº†åŒä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šé‡åˆ°å’Œå¤šåˆ†æ”¯åˆå¹¶ä¸€æ ·çš„æƒ…å†µï¼Œåœ¨åˆå¹¶æ—¶ä¼šäº§ç”Ÿå†²çªï¼Œè¿™æ—¶å°±éœ€è¦æˆ‘ä»¬è‡ªå·±å»è§£å†³å†²çªäº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨IDEAä¸­æ¼”ç¤ºä¸€ä¸‹ï¼Œå®é™…å¼€å‘åœºæ™¯ä¸‹å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ã€‚</p>
<hr>
<p>è‡³æ­¤ï¼ŒGitç‰ˆæœ¬æ§åˆ¶å°±è®²è§£åˆ°è¿™é‡Œï¼Œä¸‹ä¸€ç« æˆ‘ä»¬ä¼šç»§ç»­è®¤è¯†ä¸€ä¸ªå…¨æ–°çš„æ•°æ®åº“ï¼šRedisã€‚</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-054d8ff6135b3638aca543eff7424f98_1200x500.jpg&refer=http%3A%2F%2Fpic4.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1644402012&t=79c30b8002d088850e33bd90492419b2" alt="ç‚¹å‡»æŸ¥çœ‹æºç½‘é¡µ"></p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>springBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>springBootç¬”è®°-5</title>
    <url>/2022/04/26/SpringBoot%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89/</url>
    <content><![CDATA[<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20171116%2F4f98ec55839b434cba335319b5ebf963.jpeg&refer=http%3A%2F%2F5b0988e595225.cdn.sohucs.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1645350734&t=099b0e4fb640617498cc40939e7e2070" alt="ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡æ¥æº"></p>
<h1 id="Linuxæ“ä½œç³»ç»Ÿä¸é¡¹ç›®éƒ¨ç½²"><a href="#Linuxæ“ä½œç³»ç»Ÿä¸é¡¹ç›®éƒ¨ç½²" class="headerlink" title="Linuxæ“ä½œç³»ç»Ÿä¸é¡¹ç›®éƒ¨ç½²"></a>Linuxæ“ä½œç³»ç»Ÿä¸é¡¹ç›®éƒ¨ç½²</h1><p><strong>æ³¨æ„ï¼š</strong>æœ¬ç‰ˆå—ä¼šæ¶‰åŠåˆ°<code>æ“ä½œç³»ç»Ÿ</code>ç›¸å…³çŸ¥è¯†ã€‚</p>
<p>ç°åœ¨ï¼Œå‡ ä¹æ‰€æœ‰æ™ºèƒ½è®¾å¤‡éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„æ“ä½œç³»ç»Ÿï¼Œæ¯”å¦‚æˆ‘ä»¬çš„å®¶ç”¨ä¸ªäººç”µè„‘ï¼ŒåŸºæœ¬éƒ½æ˜¯é¢„è£…Windowsæ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬çš„æ‰‹æœºä¹Ÿæœ‰Androidå’ŒiOSæ“ä½œç³»ç»Ÿï¼Œè¿˜æœ‰ç¨‹åºå‘˜æ¯”è¾ƒé’ççš„MacBookï¼Œé¢„è£…MacOSæ“ä½œç³»ç»Ÿï¼Œç”šè‡³è¿Macbookçš„Touchbaréƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„å°å‹æ“ä½œç³»ç»Ÿã€‚</p>
<span id="more"></span>

<blockquote>
<p>æ“ä½œç³»ç»Ÿæ˜¯ç®¡ç†è®¡ç®—æœºç¡¬ä»¶ä¸è½¯ä»¶èµ„æºçš„è®¡ç®—æœºç¨‹åºï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥å¯¹è®¡ç®—æœºç³»ç»Ÿçš„å„é¡¹èµ„æºæ¿å—å¼€å±•è°ƒåº¦å·¥ä½œï¼Œè¿ç”¨è®¡ç®—æœºæ“ä½œç³»ç»Ÿå¯ä»¥å‡å°‘äººå·¥èµ„æºåˆ†é…çš„å·¥ä½œå¼ºåº¦ã€‚</p>
</blockquote>
<p>åœ¨æˆ‘ä»¬çš„ç”µè„‘æ²¡æœ‰æ“ä½œç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œå®ƒå°±æ˜¯ä¸€å †ç”µå­å…ƒå™¨ä»¶ç»„åˆè€Œæˆçš„æœºå™¨ï¼Œå°±åƒæˆ‘ä»¬æœ‰äº†ä¸€å…·å®Œæ•´çš„èº«ä½“ï¼Œä½†æ˜¯ç°åœ¨ç¼ºå°‘çš„æ˜¯ä¸€ä¸ªå¤§è„‘ï¼Œæ¥æ§åˆ¶æˆ‘ä»¬çš„èº«ä½“åšå‡ºå„ç§åŠ¨ä½œå’Œè¡Œä¸ºï¼Œè€Œå®‰è£…äº†æ“ä½œç³»ç»Ÿï¼Œå°±åƒä¸ºç”µè„‘æ³¨å…¥äº†çµé­‚ï¼Œæ“ä½œç³»ç»Ÿä¼šå¸®åŠ©æˆ‘ä»¬å¯¹æ‰€æœ‰çš„ç¡¬ä»¶è¿›è¡Œè°ƒåº¦å’Œç®¡ç†ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ€å¸¸ç”¨çš„Windowsæ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­åšå„ç§å„æ ·çš„äº‹æƒ…ï¼ŒåŒ…æ‹¬æ¸¸æˆã€çœ‹ç‰‡ã€å­¦ä¹ ã€ç¼–ç¨‹ç­‰ï¼Œè€Œæ‰€æœ‰çš„ç¨‹åºæ­£æ˜¯åŸºäºæ“ä½œç³»ç»Ÿä¹‹ä¸Šè¿è¡Œçš„ï¼Œæ“ä½œç³»ç»Ÿå¸®åŠ©æˆ‘ä»¬ä¸åº•å±‚ç¡¬ä»¶è¿›è¡Œäº¤äº’ï¼Œè€Œåœ¨ç¨‹åºä¸­æˆ‘ä»¬åªéœ€è¦å‘Šè¯‰æ“ä½œç³»ç»Ÿæˆ‘ä»¬éœ€è¦åšä»€ä¹ˆå°±å¯ä»¥äº†ï¼Œæ“ä½œç³»ç»ŸçŸ¥é“è¯¥å¦‚ä½•ä½¿ç”¨å’Œè°ƒåº¦åº•å±‚çš„ç¡¬ä»¶ï¼Œæ¥å®Œæˆæˆ‘ä»¬ç¨‹åºä¸­æŒ‡å®šçš„ä»»åŠ¡ã€‚</p>
<p>ï¼ˆå¦‚æœä½ åœ¨è‡ªå·±ç”µè„‘ä¸Šå®‰è£…è¿‡Windowsæ“ä½œç³»ç»Ÿï¼Œç”šè‡³è‡ªå·±æ‰“è¿‡é©±åŠ¨ç¨‹åºï¼Œæˆ–æ˜¯ä½¿ç”¨å®‰è£…è¿‡Linuxä»»æ„å‘è¡Œç‰ˆæœ¬ï¼Œé‚£ä¹ˆæœ¬ç« å­¦ä¹ èµ·æ¥ä¼šæ¯”è¾ƒè½»æ¾ï¼‰</p>
<h2 id="å‘å±•ç®€å²"><a href="#å‘å±•ç®€å²" class="headerlink" title="å‘å±•ç®€å²"></a>å‘å±•ç®€å²</h2><p>è¿™æ˜¯æ•´ä¸ªSpringBooté˜¶æ®µçš„æœ€åéƒ¨åˆ†äº†ï¼Œä¸ºäº†ä¸è®©å­¦ä¹ é‚£ä¹ˆæ¯ç‡¥ï¼Œæˆ‘ä»¬å…ˆæ¥è®²ç‚¹å°æ•…äº‹ã€‚</p>
<p>åœ¨1965å¹´ï¼Œå½“æ—¶è¿˜å¤„äºæ‰¹å¤„ç†æ“ä½œç³»ç»Ÿçš„æ—¶ä»£ï¼Œä½†æ˜¯å®ƒåªèƒ½åŒæ—¶ä¾›ä¸€ä¸ªç”¨æˆ·ä½¿ç”¨ï¼Œè€Œå½“æ—¶äººä»¬æ­£å¸Œæœ›èƒ½å¤Ÿå¼€å‘ä¸€ç§äº¤äº’å¼çš„ã€å…·æœ‰å¤šé“ç¨‹åºå¤„ç†èƒ½åŠ›çš„åˆ†æ—¶æ“ä½œç³»ç»Ÿã€‚äºæ˜¯ï¼Œè´å°”å®éªŒå®¤ã€ç¾å›½éº»çœç†å·¥å­¦é™¢å’Œé€šç”¨ç”µæ°”å…¬å¸è”åˆå‘èµ·äº†ä¸€é¡¹åä¸º Multics çš„å·¥ç¨‹è®¡åˆ’ï¼Œè€Œç›®çš„ä¹Ÿæ˜¯å¸Œæœ›èƒ½å¤Ÿå¼€å‘å‡ºè¿™æ ·çš„ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œä½†æ˜¯æœ€ç»ˆç”±äºå„ç§åŸå› ä»¥å¤±è´¥å‘Šç»ˆã€‚</p>
<p>ä»¥è‚¯â€¢æ±¤æ™®æ£®ä¸ºé¦–çš„è´å°”å®éªŒå®¤ç ”ç©¶äººå‘˜å¸å–äº† Multics å·¥ç¨‹è®¡åˆ’å¤±è´¥çš„ç»éªŒæ•™è®­ï¼Œäº 1969 å¹´å®ç°äº†åˆ†æ—¶æ“ä½œç³»ç»Ÿçš„é›å½¢ï¼Œåœ¨1970 å¹´è¯¥æ“ä½œç³»ç»Ÿæ­£å¼å–åä¸º<strong>UNIX</strong>ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¤šç”¨æˆ·ã€å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿï¼Œæ”¯æŒå¤šç§å¤„ç†å™¨æ¶æ„ï¼Œ1973 å¹´ï¼Œä¹Ÿå°±æ˜¯Cè¯­è¨€é—®ä¸–ä¸ä¹…åï¼ŒUNIXæ“ä½œç³»ç»Ÿçš„ç»å¤§éƒ¨åˆ†æºä»£ç éƒ½ç”¨Cè¯­è¨€è¿›è¡Œäº†é‡å†™ã€‚</p>
<p>ä»è¿™ä¹‹åï¼Œå¤§é‡çš„UNIXå‘è¡Œç‰ˆæœ¬æ¶Œç°ï¼ˆåŸºäºUnixè¿›è¡Œå®Œå–„çš„ç³»ç»Ÿï¼‰æ¯”å¦‚ FreeBSD å°±æ˜¯ç¾å›½åŠ åˆ©ç¦å°¼äºšå¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡å¼€å‘çš„ UNIX ç‰ˆæœ¬ï¼Œå®ƒç”±æ¥è‡ªä¸–ç•Œå„åœ°çš„å¿—æ„¿è€…å¼€å‘å’Œç»´æŠ¤ï¼Œä¸ºä¸åŒæ¶æ„çš„è®¡ç®—æœºç³»ç»Ÿæä¾›äº†ä¸åŒç¨‹åº¦çš„æ”¯æŒã€‚</p>
<p> è€Œåæ¥1984å¹´è‹¹æœå…¬å¸å‘å¸ƒçš„çš„MacOSï¼ˆåœ¨Macintoshç”µè„‘ä¸Šæ­è½½ï¼‰æ“ä½œç³»ç»Ÿï¼Œæ­£æ˜¯åœ¨ FreeBSD åŸºç¡€ä¹‹ä¸Šå¼€å‘çš„å…¨æ–°æ“ä½œç³»ç»Ÿï¼Œè¿™æ˜¯é¦–æ¬¡è®¡ç®—æœºæ­£å¼è·¨è¿›å›¾å½¢åŒ–æ—¶ä»£ï¼Œå…·æœ‰é‡Œç¨‹ç¢‘çš„æ„ä¹‰ã€‚</p>
<p><img src="https://www.webdesignerdepot.com/cdn-origin/uploads/2009/03/mac-os-1.gif" alt="Mac OS"></p>
<p>åŒå¹´ï¼Œä¹”å¸ƒæ–¯éå¸¸é«˜å…´åœ°å°†è‡ªå®¶çš„å›¾å½¢åŒ–MacOSç•Œé¢å±•ç¤ºç»™å¾®è½¯åˆ›å§‹äººæ¯”å°”ç›–èŒ¨ï¼Œå¹¶ä¸”å¸Œæœ›å¾®è½¯å¯ä»¥ä¸ºMacOSå¼€å‘ä¸€äº›è½¯ä»¶ã€‚æ¯”å°”ç›–èŒ¨ä¸€çœ‹ï¼Œwocï¼Œè¿™ç©æ„ç‰›é€¼å•Šï¼Œå’±ä»¬è‡ªå·±ä¹Ÿç»™å®‰æ’ä¸€ä¸ªã€‚äºæ˜¯ï¼Œåœ¨1985å¹´ï¼Œå¾®è½¯ä»¿é€ MacOSå¹¶åŸºäºMS-DOSæ“ä½œç³»ç»Ÿï¼Œå¼€å‘å‡ºäº†åä¸ºWindowsçš„æ“ä½œç³»ç»Ÿï¼š</p>
<p><img src="https://pics5.baidu.com/feed/b7003af33a87e950dd561c8ef220e945faf2b4ab.jpeg?token=b2063459ad19e976ed42754e5f9caea8" alt="img"></p>
<p>Windowsæ“ä½œç³»ç»Ÿçš„é—®ä¸–ï¼Œæ— ç–‘æ˜¯å¯¹MacOSçš„ä¸€æ¬¡æ‰“å‡»ï¼Œå› ä¸ºMacOSåªèƒ½æ­è½½åœ¨Macä¸Šï¼Œä½†æ˜¯å”®ä»·å®åœ¨å¤ªè´µï¼Œå¹¶ä¸”è½¯ä»¶ç”Ÿæ€ä¹Ÿä¸å°½äººæ„ï¼ŒåŒæ—¶ä»£çš„Windowså´èƒ½å¤Ÿå®‰è£…åˆ°å„ç§å„æ ·çš„DIYç”µè„‘ä¸Šï¼Œç§°å…¶ä¸ºPCï¼Œå°¤å…¶æ˜¯åæ¥çš„Windows95ï¼Œå‡ ä¹æ˜¯å°ç¥çš„å­˜åœ¨ï¼Œå„ç§å„æ ·åŸºäºWindowsçš„è½¯ä»¶ã€æ¸¸æˆå±‚å‡ºä¸ç©·ï¼Œä»¥è‡³äºåˆ°ä»Šå¤©ä¸ºæ­¢ï¼ŒMacOSçš„å¸‚åœºå æœ‰ç‡ä¾ç„¶è¿œä½äºWindowsï¼Œä¸è¿‡Appleè¿™åå‡ å¹´ä¸€ç›´åœ¨æ³¨é‡è‡ªå®¶è½¯ä»¶ç”Ÿæ€çš„å‘å±•ï¼Œæ€»ä½“æ¥è¯´åœ¨åŠå…¬é¢†åŸŸä½“éªŒæ„Ÿå…¶å®å’ŒWindowså·®ä¸å¤šï¼Œç”šè‡³å¯èƒ½è¿˜æ›´å¥½ï¼Œä½†æ˜¯æ‰“æ¸¸æˆï¼Œåˆ«æƒ³äº†ã€‚</p>
<p>è¯´äº†è¿™ä¹ˆå¤šï¼ŒLinuxå‘¢ï¼Œæ€ä¹ˆä¸€å¥éƒ½æ²¡æå®ƒå‘¢ï¼Ÿæœ€ç‰›é€¼çš„å½“ç„¶æ”¾æœ€åè¯´ï¼ˆä¸æ˜¯</p>
<p>Unixè™½ç„¶å¼ºå¤§ä½†æ˜¯æœ‰ç€æ˜‚è´µçš„æˆæƒè´¹ç”¨ï¼Œå¹¶ä¸”ä¸å¼€æ”¾æºä»£ç ï¼Œäºæ˜¯æœ‰äººå‘èµ·äº†GNUè¿åŠ¨ï¼ˆGNU IS NOT UNIXï¼Œå¸¦æœ‰é‚£ä¹ˆä¸€ä¸å˜²è®½ï¼‰ï¼Œæ¨¡ä»¿ Unix çš„ç•Œé¢å’Œä½¿ç”¨æ–¹å¼ï¼Œä»å¤´åšä¸€ä¸ªå¼€æºçš„ç‰ˆæœ¬ã€‚åœ¨1987å¹´è·å…°æœ‰ä¸ªå¤§å­¦æ•™æˆå®‰å¾·é²å†™äº†ä¸€ä¸ªMinixï¼Œç±»ä¼¼äºUnixï¼Œä¸“ç”¨äºæ•™å­¦ã€‚å½“Minixæµä¼ å¼€æ¥ä¹‹åï¼Œä¸–ç•Œå„åœ°çš„é»‘å®¢ä»¬çº·çº·å¼€å§‹ä½¿ç”¨å¹¶æ”¹è¿›ï¼Œå¸Œæœ›æŠŠæ”¹è¿›çš„ä¸œè¥¿åˆå¹¶åˆ°Minixä¸­ï¼Œä½†æ˜¯å®‰å¾·é²è§‰å¾—ä»–çš„ç³»ç»Ÿæ˜¯ç”¨äºæ•™å­¦çš„ï¼Œä¸èƒ½ç ´åçº¯å‡€æ€§ï¼Œäºæ˜¯æ‹’ç»äº†ã€‚</p>
<p>åœ¨1991å¹´ï¼Œæ—çº³æ–¯.æ‰˜ç“¦å…¹ï¼ˆLinus Torvaldsï¼‰è®¤ä¸ºMinixä¸å¤Ÿå¼€æ”¾ï¼Œè‡ªå·±åˆå†™äº†ä¸€ä¸ªå…¨æ–°çš„å¼€æºæ“ä½œç³»ç»Ÿï¼Œå®ƒå¸Œæœ›è¿™ä¸ªç³»ç»Ÿç”±å…¨ä¸–ç•Œçš„çˆ±å¥½è€…ä¸€åŒå‚ä¸å¼€å‘ï¼Œå¹¶ä¸”ä¸æ”¶è´¹ï¼Œäºæ˜¯Linuxå†…æ ¸å°±è¢«å…¬å¼€å‘å¸ƒåˆ°äº’è”ç½‘ä¸Šã€‚ä¸€ç»å‘å¸ƒï¼Œä¾¿å¼•èµ·äº†ç¤¾ä¼šå¼ºçƒˆçš„åå“ï¼Œåœ¨å¤§å®¶çš„åŠªåŠ›ä¸‹ï¼Œäº1994å¹´Linuxçš„1.0ç‰ˆæœ¬æ­£å¼å‘å¸ƒã€‚ç»“åˆå½“æ—¶çš„GNUè¿åŠ¨ï¼Œæœ€ç»ˆåˆåœ¨ä¸€èµ·ç§°ä¸ºäº†GNU/Linuxï¼Œä»¥ä¸€åªä¼é¹…Tuxä½œä¸ºå‰ç¥¥ç‰©ã€‚</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fnimg.ws.126.net%2F%3Furl%3Dhttp%3A%2F%2Fdingyue.ws.126.net%2F2021%2F0914%2F1833179ap00qzeyx5000cc000go009qg.png%26thumbnail%3D650x2147483647%26quality%3D80%26type%3Djpg&refer=http%3A%2F%2Fnimg.ws.126.net&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1645451358&t=082f4539e97a1a3c9dc8002847e9ad5a" alt="ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡æ¥æº"></p>
<p>æ²¡é”™ï¼ŒGitä¹Ÿæ˜¯æ—çº³æ–¯.æ‰˜ç“¦å…¹åªèŠ±äº†2å‘¨æ—¶é—´å¼€å‘çš„ã€‚ä¸è¿‡æ—çº³æ–¯éå¸¸è®¨åŒC++ï¼Œä»–è®¤ä¸ºC++åªä¼šè®©ä¸€ä¸ªé¡¹ç›®å˜å¾—æ··ä¹±ã€‚</p>
<p>ä»æ­¤ä»¥åï¼Œå„å¼å„æ ·çš„åŸºäºLinuxå‘è¡Œç‰ˆå°±å¼€å§‹å‡ºç°ï¼š</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fqnam.smzdm.com%2F202002%2F08%2F5e3e59003360f5288.jpg_e680.jpg&refer=http%3A%2F%2Fqnam.smzdm.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1645451543&t=f2471b52851d92920194d2ef2acbab6f" alt="ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡æ¥æº"></p>
<p>è¿™äº›å‘è¡Œç‰ˆéƒ½æ˜¯åœ¨Linuxå†…æ ¸çš„åŸºç¡€ä¹‹ä¸Šï¼Œæ·»åŠ äº†å¤§é‡çš„é¢å¤–åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¼€å‘ç¯å¢ƒã€å›¾å½¢åŒ–æ¡Œé¢ã€åŒ…ç®¡ç†ç­‰ã€‚åŒ…æ‹¬æˆ‘ä»¬çš„å®‰å“ç³»ç»Ÿï¼Œä¹Ÿæ˜¯åŸºäºLinuxä¹‹ä¸Šçš„ï¼Œè€Œæˆ‘ä»¬è¦é‡ç‚¹ä»‹ç»çš„å°±æ˜¯åŸºäºDebianä¹‹ä¸Šçš„Ubuntuæ“ä½œç³»ç»Ÿã€‚</p>
<p>æœ€åï¼Œ2022å¹´äº†ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹å„å¤§æ“ä½œç³»ç»Ÿçš„å¸‚åœºå æœ‰ç‡ï¼š</p>
<ul>
<li>Windows11/10/7ï¼š80%</li>
<li>MacOSï¼š11%</li>
<li>Linuxï¼š5%</li>
<li>å…¶ä»–ï¼š4%</li>
</ul>
<p>Windowsæ— ç–‘æ˜¯ç°åœ¨æœ€å¹¿æ³›çš„æ“ä½œç³»ç»Ÿï¼Œå°¤å…¶æ˜¯Windows XPï¼Œæ˜¯å¤šå°‘00åçš„é’æ˜¥ï¼Œå¾ˆå¤šæ¸¸æˆéƒ½æ˜¯åŸºäºWindowså¹³å°ã€‚å½“ç„¶ï¼Œå¦‚æœä½ å·²ç»åŒå€¦äº†æ¸¸æˆï¼Œä¸€å¿ƒåªè¯»åœ£è´¤ä¹¦çš„è¯ï¼Œé‚£ä¹ˆè¿˜æ˜¯å»ºè®®ç›´æ¥ä½¿ç”¨ä»»æ„Linuxæ¡Œé¢ç‰ˆæˆ–æ˜¯Macï¼Œå› ä¸ºå®ƒä»¬èƒ½å¤Ÿä¸ºä½ æä¾›æè‡´å’Œçº¯ç²¹çš„å¼€å‘ä½“éªŒï¼ˆè²Œä¼¼ä¹‹å‰åä¸ºä¹Ÿå‡ºè¿‡Linuxç¬”è®°æœ¬ï¼Ÿï¼‰</p>
<hr>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fwww.iasptk.com%2Fwp-content%2Fuploads%2Fsites%2F12%2F2017%2F03%2FUbuntu-02804350.jpg&refer=http%3A%2F%2Fwww.iasptk.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1645453389&t=d7908bc10978585c9ce374cc8013ff64" alt="ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡æ¥æº"></p>
<h2 id="å®‰è£…Ubuntuç³»ç»Ÿ"><a href="#å®‰è£…Ubuntuç³»ç»Ÿ" class="headerlink" title="å®‰è£…Ubuntuç³»ç»Ÿ"></a>å®‰è£…Ubuntuç³»ç»Ÿ</h2><p>è¿™é‡Œæˆ‘ä»¬å°±ä»¥å®‰è£…è™šæ‹Ÿæœºçš„æ–¹å¼åœ¨æˆ‘ä»¬çš„ç”µè„‘ä¸Šå®‰è£…Linuxæ“ä½œç³»ç»Ÿï¼Œæˆ‘ä»¬é€‰ç”¨Ubuntuä½œä¸ºæ•™ç¨‹ï¼Œå¦‚æœæœ‰ç»æµå®åŠ›ï¼Œå¯ä»¥åœ¨è…¾è®¯äº‘ã€é˜¿é‡Œäº‘ä¹‹ç±»çš„æœåŠ¡å•†è´­ä¹°ä¸€å°äº‘æœåŠ¡å™¨ï¼Œå¹¶é€‰æ‹©é¢„è£…Ubuntuç³»ç»Ÿï¼›å¦‚æœä½ è¿˜æƒ³æåµŒå…¥å¼å¼€å‘ä¹‹ç±»çš„å·¥ä½œï¼Œå¯ä»¥è´­ä¹°ä¸€å°æ ‘è“æ´¾æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸Šé¢å®‰è£…Ubuntuç³»ç»Ÿï¼Œç›¸å½“äºä¸€å°è¿·ä½ ä¸»æœºã€‚åœ¨ä½ å·²ç»æœ‰äº‘æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡è™šæ‹Ÿæœºå®‰è£…æ•™å­¦ã€‚</p>
<p>å®˜ç½‘ä¸‹è½½ï¼š<a href="https://cn.ubuntu.com/download/server/step1">https://cn.ubuntu.com/download/server/step1</a></p>
<p>æ³¨æ„æ˜¯ä¸‹è½½æœåŠ¡å™¨ç‰ˆæœ¬ï¼Œä¸æ˜¯æ¡Œé¢ç‰ˆæœ¬ã€‚</p>
<h3 id="åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…"><a href="#åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…" class="headerlink" title="åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…"></a>åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…</h3><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨VMwareè¿›è¡Œå®‰è£…ï¼ŒVMwareæ˜¯ä¸€ä¸ªè™šæ‹ŸåŒ–åº”ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥åœ¨æˆ‘ä»¬å½“å‰è¿è¡Œçš„æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼Œåˆ›å»ºä¸€ä¸ªè™šçº¿çš„ä¸»æœºï¼Œç›¸å½“äºåˆ›å»ºäº†ä¸€å°ç”µè„‘ï¼Œè€Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™å°ç”µè„‘ä¸Šå®‰è£…å„ç§å„æ ·çš„æ“ä½œç³»ç»Ÿï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥è‡ªç”±ä¸ºå…¶åˆ†é…CPUæ ¸å¿ƒå’Œå†…å­˜ä»¥åŠç¡¬ç›˜å®¹é‡ï¼ˆå¦‚æœä½ æ¥è§¦è¿‡äº‘è®¡ç®—ç›¸å…³å†…å®¹ï¼Œåº”è¯¥ä¼šå¯¹è™šæ‹ŸåŒ–æŠ€æœ¯æœ‰æ‰€äº†è§£ï¼‰</p>
<p>å®˜ç½‘ä¸‹è½½ï¼š<a href="https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html">https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html</a></p>
<p>å®‰è£…å®Œæˆåï¼Œä¼šå‡ºç°ä¸€ä¸ªç±»ä¼¼äºCMDçš„å‘½ä»¤çª—å£ï¼Œè€Œæˆ‘ä»¬å°±æ˜¯é€šè¿‡è¾“å…¥å‘½ä»¤æ¥æ“ä½œæˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿã€‚</p>
<h3 id="ä½¿ç”¨SSHè¿œç¨‹è¿æ¥"><a href="#ä½¿ç”¨SSHè¿œç¨‹è¿æ¥" class="headerlink" title="ä½¿ç”¨SSHè¿œç¨‹è¿æ¥"></a>ä½¿ç”¨SSHè¿œç¨‹è¿æ¥</h3><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ ‘è“æ´¾æˆ–æ˜¯äº‘æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä½ ä¼šå¾—åˆ°ä¸€ä¸ªå…¬ç½‘çš„IPåœ°å€ï¼Œä»¥åŠé»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç”±äºæœåŠ¡å™¨å®‰è£…çš„Ubuntuå¹¶ä¸æ˜¯åœ¨æˆ‘ä»¬çš„ç”µè„‘ä¸Šè¿è¡Œçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå»è¿œç¨‹æ“ä½œå‘¢ï¼Ÿ</p>
<p>æ¯”å¦‚æˆ‘ä»¬è¦è¿œç¨‹æ“ä½œä¸€å°Windowsç”µè„‘ï¼Œç›´æ¥ä½¿ç”¨è¿œç¨‹æ¡Œé¢è¿æ¥å³å¯ï¼Œä½†æ˜¯Ubuntuä¸Šæ¥å°±æ˜¯å‘½ä»¤è¡Œï¼Œè¿™ç§æƒ…å†µä¸‹è¦å®ç°è¿œç¨‹è¿æ¥å°±åªèƒ½ä½¿ç”¨SSHç»ˆç«¯ã€‚</p>
<p>SSHæ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œç”¨äºè®¡ç®—æœºä¹‹é—´çš„åŠ å¯†ç™»å½•ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·ä»æœ¬åœ°è®¡ç®—æœºï¼Œä½¿ç”¨SSHåè®®ç™»å½•å¦ä¸€å°è¿œç¨‹è®¡ç®—æœºï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸ºï¼Œè¿™ç§ç™»å½•æ˜¯å®‰å…¨çš„ï¼Œå³ä½¿è¢«ä¸­é€”æˆªè·ï¼Œå¯†ç ä¹Ÿä¸ä¼šæ³„éœ²ã€‚æœ€æ—©çš„æ—¶å€™ï¼Œäº’è”ç½‘é€šä¿¡éƒ½æ˜¯æ˜æ–‡é€šä¿¡ï¼Œä¸€æ—¦è¢«æˆªè·ï¼Œå†…å®¹å°±æš´éœ²æ— ç–‘ã€‚1995å¹´ï¼ŒèŠ¬å…°å­¦è€…Tatu Ylonenè®¾è®¡äº†SSHåè®®ï¼Œå°†ç™»å½•ä¿¡æ¯å…¨éƒ¨åŠ å¯†ï¼Œæˆä¸ºäº’è”ç½‘å®‰å…¨çš„ä¸€ä¸ªåŸºæœ¬è§£å†³æ–¹æ¡ˆï¼Œè¿…é€Ÿåœ¨å…¨ä¸–ç•Œè·å¾—æ¨å¹¿ï¼Œç›®å‰å·²ç»æˆä¸ºLinuxç³»ç»Ÿçš„æ ‡å‡†é…ç½®ã€‚</p>
<p>äº‘æœåŠ¡å™¨ä¸Šå®‰è£…çš„Ubuntué»˜è®¤éƒ½æ˜¯è‡ªå¸¦äº†OpenSSHæœåŠ¡ç«¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿æ¥ï¼Œå¦‚æœä½ çš„UbuntuæœåŠ¡å™¨ä¸Šæ²¡æœ‰å®‰è£…OpenSSHæœåŠ¡å™¨ç«¯ï¼Œé‚£ä¹ˆå¯ä»¥è¾“å…¥å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install openssh-server</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¾“å…¥åè¿˜éœ€è¦ä½ è¾“å…¥å½“å‰ç”¨æˆ·çš„å¯†ç æ‰å¯ä»¥æ‰§è¡Œï¼Œè‡³äºä¸ºä»€ä¹ˆæˆ‘ä»¬åé¢ä¼šè¯´</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨XShellæ¥è¿›è¡ŒSSHç™»é™†ï¼Œå®˜ç½‘ï¼š<a href="https://www.netsarang.com/zh/free-for-home-school/">https://www.netsarang.com/zh/free-for-home-school/</a></p>
<h3 id="æ–‡ä»¶ç³»ç»Ÿä»‹ç»"><a href="#æ–‡ä»¶ç³»ç»Ÿä»‹ç»" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿä»‹ç»"></a>æ–‡ä»¶ç³»ç»Ÿä»‹ç»</h3><p>åœ¨Windowsä¸‹ï¼Œæˆ‘ä»¬çš„æ•´ä¸ªç¡¬ç›˜å®é™…ä¸Šå¯ä»¥è¢«åˆ†ä¸ºå¤šä¸ªç£ç›˜é©±åŠ¨å™¨ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/20190415191752939.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æˆ‘ä»¬ä¸€èˆ¬ä¹ æƒ¯å°†è½¯ä»¶è£…åˆ°Dç›˜ï¼Œæ–‡ä»¶æ•°æ®å­˜åœ¨Eç›˜ï¼Œç³»ç»Ÿå’Œä¸€äº›ç¯å¢ƒå®‰è£…åœ¨Cç›˜ï¼Œæ ¹æ®ä¸åŒçš„ç›˜ç¬¦è¿›è¡Œåˆ’åˆ†ï¼Œå¹¶ä¸”æ¯ä¸ªç›˜éƒ½æœ‰å„è‡ªçš„å­˜å‚¨å®¹é‡å¤§å°ã€‚è€Œåœ¨Linuxä¸­ï¼Œæ²¡æœ‰è¿™ä¸ªæ¦‚å¿µï¼Œæ‰€æœ‰çš„æ–‡ä»¶éƒ½æ˜¯ä½äºæ ¹ç›®å½•ä¸‹çš„ï¼š</p>
<p><img src="https://upload-images.jianshu.io/upload_images/17163728-8d41eb59e5cfb7ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/904" alt="img"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ ¹ç›®å½•ä¸‹æœ‰å¾ˆå¤šä¸ªæ–‡ä»¶å¤¹ï¼Œå®ƒä»¬éƒ½æœ‰ç€å„è‡ªçš„åˆ’åˆ†ï¼š</p>
<ul>
<li>/bin å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ç›®å½•ï¼Œå¦‚å¸¸ç”¨çš„å‘½ä»¤ lsã€tarã€mvã€cat ç­‰å®é™…ä¸Šéƒ½æ˜¯ä¸€äº›å°çš„åº”ç”¨ç¨‹åº</li>
<li>/home æ™®é€šç”¨æˆ·çš„ä¸»ç›®å½•ï¼Œå¯¹åº”Windowsä¸‹çš„C:/Users/ç”¨æˆ·å/</li>
<li>/root rootç”¨æˆ·çš„ä¸»ç›®å½•ï¼ˆrootç”¨æˆ·æ˜¯å…·æœ‰æœ€é«˜æƒé™çš„ç”¨æˆ·ï¼Œä¹‹åä¼šè®²ï¼‰</li>
<li>/boot å†…æ ¸æ–‡ä»¶çš„å¼•å¯¼ç›®å½•, æ”¾ç½® linux ç³»ç»Ÿå¯åŠ¨æ—¶ç”¨åˆ°çš„ä¸€äº›æ–‡ä»¶</li>
<li>/sbing è¶…çº§ç”¨æˆ·ä½¿ç”¨çš„æŒ‡ä»¤æ–‡ä»¶</li>
<li>/tmp ä¸´æ—¶æ–‡ä»¶ç›®å½•ï¼Œä¸€èˆ¬ç”¨æˆ·æˆ–æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºä¸´æ—¶å­˜æ”¾æ–‡ä»¶çš„ç›®å½•ï¼Œä»»ä½•äººéƒ½å¯ä»¥è®¿é—®ï¼Œé‡è¦æ•°æ®ä¸å¯æ”¾ç½®åœ¨æ­¤ç›®å½•ä¸‹ã€‚</li>
<li>/dev è®¾å¤‡æ–‡ä»¶ç›®å½•ï¼Œåœ¨Linuxä¸­ä¸‡ç‰©çš†æ–‡ä»¶ï¼Œå®é™…ä¸Šä½ æ’å…¥çš„Uç›˜ç­‰è®¾å¤‡éƒ½ä¼šåœ¨devç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°é€šè¿‡æ–‡ä»¶IOæ–¹å¼å»æ“ä½œå¤–è®¾ï¼Œå¯¹åµŒå…¥å¼å¼€å‘æä¸ºå‹å¥½ã€‚</li>
<li>/lib å…±äº«åº“ï¼Œç³»ç»Ÿä½¿ç”¨çš„å‡½æ•°åº“çš„ç›®å½•ï¼Œç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦è°ƒç”¨ä¸€äº›é¢å¤–çš„å‚æ•°æ—¶éœ€è¦å‡½æ•°åº“çš„ååŠ©ã€‚</li>
<li>/usr ç¬¬ä¸‰æ–¹ ç¨‹åºç›®å½•</li>
<li>/etc é…ç½®ç¨‹åºç›®å½•ï¼Œç³»ç»Ÿé…ç½®æ–‡ä»¶å­˜æ”¾çš„ç›®å½•</li>
<li>/var å¯å˜æ–‡ä»¶ï¼Œæ”¾ç½®ç³»ç»Ÿæ‰§è¡Œè¿‡ç¨‹ä¸­ç»å¸¸å˜åŒ–çš„æ–‡ä»¶</li>
<li>/opt ç”¨æˆ·ä½¿ç”¨ç›®å½•ï¼Œç»™ä¸»æœºé¢å¤–å®‰è£…è½¯ä»¶æ‰€æ‘†æ”¾çš„ç›®å½•ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥è¾“å…¥å‘½ä»¤æ¥æŸ¥çœ‹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åªæ˜¾ç¤ºæ–‡ä»¶åç§°ï¼Œä¸”ä¸æ˜¾ç¤ºéšè—æ–‡ä»¶</span></span><br><span class="line">ls</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ˜¾ç¤ºéšè—æ–‡ä»¶ä»¥åŠæ–‡ä»¶è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">ll</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ‰èƒ½åƒWindowsé‚£æ ·æ–¹ä¾¿çš„ç®¡ç†Linuxä¸­çš„æ–‡ä»¶å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨FTPç®¡ç†å·¥å…·ï¼Œé»˜è®¤æƒ…å†µä¸‹Ubuntuæ˜¯å®‰è£…äº†SFTPæœåŠ¡å™¨çš„ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Xftpæ¥è¿›è¡Œç®¡ç†ï¼Œå®˜ç½‘ï¼š<a href="https://www.netsarang.com/zh/free-for-home-school/">https://www.netsarang.com/zh/free-for-home-school/</a></p>
<hr>
<h2 id="ç”¨æˆ·å’Œç”¨æˆ·ç»„"><a href="#ç”¨æˆ·å’Œç”¨æˆ·ç»„" class="headerlink" title="ç”¨æˆ·å’Œç”¨æˆ·ç»„"></a>ç”¨æˆ·å’Œç”¨æˆ·ç»„</h2><p>æˆ‘ä»¬æ•´ä¸ªLinuxé˜¶æ®µçš„å­¦ä¹ ä¸»è¦æ˜¯ä»¥å®æ“ä¸ºä¸»ï¼Œå¤§é‡çš„å‘½ä»¤éœ€è¦å¤§é‡çš„ä½¿ç”¨æ‰èƒ½è®°å¾—æ›´ç‰¢å›ºã€‚</p>
<p>Linuxç³»ç»Ÿæ˜¯ä¸€ä¸ªå¤šç”¨æˆ·å¤šä»»åŠ¡çš„åˆ†æ—¶æ“ä½œç³»ç»Ÿï¼Œä»»ä½•ä¸€ä¸ªè¦ä½¿ç”¨ç³»ç»Ÿçš„ç”¨æˆ·ï¼Œéƒ½å¿…é¡»ç”³è¯·ä¸€ä¸ªè´¦å·ï¼Œç„¶åä»¥è¿™ä¸ªè´¦å·çš„èº«ä»½è¿›å…¥ç³»ç»Ÿã€‚æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰å°±æ˜¯ä½¿ç”¨æˆ‘ä»¬åœ¨åˆ›å»ºæœåŠ¡å™¨æ—¶ç”³è¯·çš„åˆå§‹ç”¨æˆ·testï¼Œé€šè¿‡è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•åˆ°ç³»ç»Ÿä¸­ï¼Œä¹‹åæ‰èƒ½ä½¿ç”¨å„ç§å‘½ä»¤è¿›è¡Œæ“ä½œã€‚å…¶å®ç”¨æˆ·æœºåˆ¶å’Œæˆ‘ä»¬çš„Windowsæ¯”è¾ƒç±»ä¼¼ã€‚ä¸€èˆ¬çš„æ™®é€šç”¨æˆ·åªèƒ½åšä¸€äº›æ¯”è¾ƒåŸºæœ¬çš„æ“ä½œï¼Œå¹¶ä¸”åªèƒ½åœ¨è‡ªå·±çš„ç›®å½•ï¼ˆå¦‚/home/testï¼‰ä¸­è¿›è¡Œæ–‡ä»¶çš„åˆ›å»ºå’Œåˆ é™¤æ“ä½œã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰çŠ¶æ€ä¿¡æ¯åˆ†ä¸ºä¸‰æ®µï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$</span><br></pre></td></tr></table></figure>

<p>æ ¼å¼ä¸ºï¼šç”¨æˆ·å@æœåŠ¡å™¨åç§°:å½“å‰æ‰€å¤„çš„ç›®å½•$ï¼Œå…¶ä¸­~ä»£è¡¨ç”¨æˆ·ç›®å½•ï¼Œå¦‚æœä¸æ˜¯ç”¨æˆ·ç›®å½•ï¼Œä¼šæ˜¾ç¤ºå½“å‰çš„ç»å¯¹è·¯å¾„åœ°å€ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>pwd</code>å‘½ä»¤æ¥ç›´æ¥æŸ¥çœ‹å½“å‰æ‰€å¤„çš„ç›®å½•ã€‚</p>
<p>åœ¨Linuxä¸­é»˜è®¤å­˜åœ¨ä¸€ä¸ªè¶…çº§ç”¨æˆ·rootï¼Œè€Œæ­¤ç”¨æˆ·æ‹¥æœ‰æœ€é«˜æ‰§è¡Œæƒé™ï¼Œå®ƒèƒ½å¤Ÿä¿®æ”¹ä»»ä½•çš„å†…å®¹ï¼Œç”šè‡³å¯ä»¥åˆ é™¤æ•´ä¸ªLinuxå†…æ ¸ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¸ä¼šä½¿ç”¨rootç”¨æˆ·è¿›è¡Œç™»é™†ï¼Œåªæœ‰åœ¨ç‰¹æ®Šæƒ…å†µä¸‹æ‰ä¼šä½¿ç”¨rootç”¨æˆ·æ¥è¿›è¡Œä¸€äº›æ“ä½œï¼Œrootç”¨æˆ·éå¸¸å±é™©ï¼Œå“ªæ€•ä¸€ä¸ªå°å°çš„å‘½ä»¤éƒ½èƒ½å¤Ÿæ¯æ‰æ•´ä¸ªLinuxç³»ç»Ÿï¼Œæ¯”å¦‚<code>rm -rf /*</code>ï¼Œæ„Ÿå…´è¶£çš„è¯æˆ‘ä»¬å¯ä»¥æ”¾åœ¨æœ€åæ¥æ¼”ç¤ºï¼ˆåœ¨ä»¥å‰è€æ˜¯å¬è¯´å®‰å“æ‰‹æœºrootï¼Œå®é™…ä¸Šå°±æ˜¯è·å–å®‰å“ç³»ç»Ÿåº•å±‚Linuxç³»ç»Ÿçš„rootæƒé™ï¼Œä»¥å®ç°ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶çš„ç›®çš„ï¼‰</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>sudo -s</code>å¹¶è¾“å…¥å½“å‰ç”¨æˆ·çš„å¯†ç åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œå¯ä»¥çœ‹åˆ°å‡ºç°äº†ä¸€äº›å˜åŒ–ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:/home/test#</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°<code>$</code>ç¬¦å·å˜æˆäº†<code>#</code>ç¬¦å·ï¼Œæ³¨æ„æ­¤ç¬¦å·è¡¨ç¤ºå½“å‰çš„ç”¨æˆ·æƒé™ç­‰çº§ï¼Œå¹¶ä¸”testä¹Ÿå˜ä¸ºäº†rootï¼Œåœ¨æ­¤ç”¨æˆ·ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥éšæ„ä¿®æ”¹testç”¨æˆ·æ–‡ä»¶å¤¹ä»¥å¤–çš„å†…å®¹ï¼Œè€Œtestç”¨æˆ·ä¸‹åˆ™æ— æ³•ä¿®æ”¹ã€‚å¦‚æœéœ€è¦é€€å‡ºrootç”¨æˆ·ï¼Œç›´æ¥è¾“å…¥<code>exit</code>å³å¯ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•è¿›è¡Œç”¨æˆ·çš„ç®¡ç†æ“ä½œï¼Œè¿›è¡Œç”¨æˆ·ç®¡ç†ï¼ŒåŒ…æ‹¬æ·»åŠ ç”¨æˆ·å’Œåˆ é™¤ç”¨æˆ·éƒ½éœ€è¦rootæƒé™æ‰å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬æ˜¯testç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤å‰é¢æ·»åŠ <code>sudo</code>æ¥æš‚æ—¶ä»¥ç®¡ç†å‘˜èº«ä»½æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ç°åœ¨æƒ³è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ç”¨æˆ·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo useradd study</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>study</code>å°±æ˜¯æˆ‘ä»¬æƒ³è¦åˆ›å»ºçš„æ–°ç”¨æˆ·ï¼Œ<code>useradd</code>å‘½ä»¤å°±æ˜¯åˆ›å»ºæ–°ç”¨æˆ·çš„å‘½ä»¤ï¼ŒåŒæ ·çš„ï¼Œåˆ é™¤ç”¨æˆ·ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo userdel study</span><br></pre></td></tr></table></figure>

<p>Linuxä¸­çš„å‘½ä»¤ä¸€èˆ¬éƒ½å¯ä»¥æºå¸¦ä¸€äº›å‚æ•°æ¥ä»¥æ›´å¤šç‰¹åœ°çš„æ–¹å¼æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºç”¨æˆ·æ—¶ï¼Œæ·»åŠ ä¸€äº›é¢å¤–çš„å‚æ•°æ¥è¿›è¡Œæ›´å¤šé«˜çº§æ“ä½œï¼š</p>
<ul>
<li>-d&lt;ç™»å½•ç›®å½•&gt; ã€€æŒ‡å®šç”¨æˆ·ç™»å½•æ—¶çš„èµ·å§‹ç›®å½•ã€‚</li>
<li>-g&lt;ç¾¤ç»„&gt; ã€€æŒ‡å®šç”¨æˆ·æ‰€å±çš„ç¾¤ç»„ã€‚</li>
<li>-G&lt;ç¾¤ç»„&gt; ã€€æŒ‡å®šç”¨æˆ·æ‰€å±çš„é™„åŠ ç¾¤ç»„ã€‚</li>
<li>-m ã€€è‡ªåŠ¨å»ºç«‹ç”¨æˆ·çš„ç™»å…¥ç›®å½•ã€‚</li>
<li>-M ã€€ä¸è¦è‡ªåŠ¨å»ºç«‹ç”¨æˆ·çš„ç™»å…¥ç›®å½•ã€‚</li>
<li>-s  æŒ‡å®šShellï¼Œä¸€èˆ¬æŒ‡å®šä¸º/bin/bash</li>
</ul>
<p>å¦‚æœè¿˜æƒ³æŸ¥çœ‹æ›´å¤šå‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>man</code>æ¥æŸ¥çœ‹å‘½ä»¤çš„è¯¦ç»†å‚æ•°åˆ—è¡¨ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">man useradd</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦åœ¨ç”¨æˆ·åˆ›å»ºæ—¶é¡ºä¾¿åˆ›å»ºç”¨æˆ·çš„æ–‡ä»¶å¤¹ï¼Œå¹¶æŒ‡å®šshellï¼ˆä»»æ„ä¸€ç§å‘½ä»¤è§£é‡Šç¨‹åºï¼Œç”¨äºå¤„ç†æˆ‘ä»¬è¾“å…¥çš„å‘½ä»¤ï¼‰ä¸ºbashï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo useradd study -m -s /bin/bash</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å·²ç»è‡ªåŠ¨åœ¨homeç›®å½•ä¸‹åˆ›å»ºäº†studyæ–‡ä»¶å¤¹ï¼ˆè¿™é‡Œ..è¡¨ç¤ºä¸Šä¸€çº§ç›®å½•ï¼Œ.è¡¨ç¤ºå½“å‰ç›®å½•ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ ls ..</span><br><span class="line">study  test</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·åˆ›å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ­¤ç”¨æˆ·è®¾å®šå¯†ç ï¼ˆå¦‚æœä¸æŒ‡å®šç”¨æˆ·ï¼Œé‚£ä¹ˆä¼šè®¾ç½®å½“å‰ç”¨æˆ·çš„å¯†ç ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo passwd study</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥å¯†ç ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤æ¥åˆ‡æ¢ç”¨æˆ·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ su - study</span><br><span class="line">Password: </span><br><span class="line">study@ubuntu-server:~$ </span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œåˆ‡æ¢ç”¨æˆ·ååç§°å·²ç»ä¿®æ”¹ä¸ºstudyäº†ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>exit</code>å³å¯é€€å‡ºå½“å‰ç”¨æˆ·å›åˆ°testã€‚</p>
<p>è¾“å…¥<code>who</code>å¯ä»¥æŸ¥çœ‹å½“å‰ç™»å½•è´¦å·ï¼ˆæ³¨æ„æ˜¯ç™»å½•çš„è´¦å·ï¼‰è¾“å…¥<code>whoami</code>å¯ä»¥æŸ¥çœ‹å½“å‰çš„æ“ä½œè´¦å·ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ su study</span><br><span class="line">Password: </span><br><span class="line">study@ubuntu-server:/home/test$ cd ~</span><br><span class="line">study@ubuntu-server:~$ who</span><br><span class="line">test     pts/0        2022-01-24 03:57 (192.168.10.3)</span><br><span class="line">study@ubuntu-server:~$ whoami</span><br><span class="line">study</span><br><span class="line">study@ubuntu-server:~$ </span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ç”¨æˆ·ç»„ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªç”¨æˆ·ç»„ï¼Œç³»ç»Ÿå¯ä»¥å¯¹ä¸€ä¸ªç”¨æˆ·ç»„ä¸­çš„æ‰€æœ‰ç”¨æˆ·è¿›è¡Œé›†ä¸­ç®¡ç†ã€‚æˆ‘ä»¬å¯ä»¥è¾“å…¥<code>groups</code>æ¥æŸ¥çœ‹å½“å‰ç”¨æˆ·æ‰€æœ‰çš„ç”¨æˆ·ç»„ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">groups</span></span><br><span class="line"><span class="built_in">test</span> adm cdrom sudo dip plugdev lxd</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥è¾“å…¥<code>id</code>æ¥æŸ¥çœ‹ç”¨æˆ·æ‰€å±çš„ç”¨æˆ·ç›¸å…³ä¿¡æ¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">id</span></span><br><span class="line">uid=1000(<span class="built_in">test</span>) gid=1000(<span class="built_in">test</span>) <span class="built_in">groups</span>=1000(<span class="built_in">test</span>),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lxd)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°testç”¨æˆ·é»˜è®¤æƒ…å†µä¸‹ä¸»è¦ç”¨æˆ·ç»„ä¸ºåŒåçš„testç”¨æˆ·ç»„ï¼Œå¹¶ä¸”è¿˜å±äºä¸€äº›å…¶ä»–çš„ç”¨æˆ·ç»„ï¼Œå…¶ä¸­sudoç”¨æˆ·ç»„å°±è¡¨ç¤ºå¯ä»¥æ‰§è¡Œ<code>sudo</code>å‘½ä»¤ï¼Œæˆ‘ä»¬å‘ç°æˆ‘ä»¬åˆ›å»ºçš„studyç”¨æˆ·æ²¡æœ‰sudoçš„æ‰§è¡Œæƒé™ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">study@ubuntu-server:~$ sudo -s</span><br><span class="line">[sudo] password <span class="keyword">for</span> study: </span><br><span class="line">study is not <span class="keyword">in</span> the sudoers file.  This incident will be reported.</span><br></pre></td></tr></table></figure>

<p>æ­£æ˜¯å› ä¸ºæ²¡æœ‰åŠ å…¥åˆ°sudoç”¨æˆ·ç»„ï¼Œè¿™é‡Œæˆ‘ä»¬æ¥å°è¯•å°†å…¶æ·»åŠ åˆ°sudoç”¨æˆ·ç»„ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">id</span> study</span><br><span class="line">uid=1001(study) gid=1001(study) <span class="built_in">groups</span>=1001(study)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<code>usermod</code>å‘½ä»¤æ¥å¯¹ç”¨æˆ·çš„ç›¸å…³è®¾ç½®è¿›è¡Œä¿®æ”¹ï¼Œå‚æ•°ä¸useraddå¤§è‡´ç›¸åŒï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ sudo usermod study -G sudo</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">id</span> study</span><br><span class="line">uid=1001(study) gid=1001(study) <span class="built_in">groups</span>=1001(study),27(sudo)</span><br></pre></td></tr></table></figure>

<p>æ¥ç€åˆ‡æ¢åˆ°studyç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨sudoå‘½ä»¤äº†ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">To run a <span class="built_in">command</span> as administrator (user <span class="string">&quot;root&quot;</span>), use <span class="string">&quot;sudo &lt;command&gt;&quot;</span>.</span><br><span class="line">See <span class="string">&quot;man sudo_root&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line"></span><br><span class="line">study@ubuntu-server:/home/test$ sudo -s</span><br><span class="line">[sudo] password <span class="keyword">for</span> study: </span><br><span class="line">root@ubuntu-server:/home/test<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„ç”¨æˆ·ä¿¡æ¯æ˜¯å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­çš„ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´äº†ï¼Œé…ç½®æ–‡ä»¶ä¸€èˆ¬éƒ½æ”¾åœ¨etcç›®å½•ä¸‹ï¼Œè€Œç”¨æˆ·å’Œç”¨æˆ·ç»„ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œå­˜æ”¾åœ¨<code>/etc/passwd</code>å’Œ<code>/etc/group</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨catå‘½ä»¤å°†æ–‡ä»¶å†…å®¹æ‰“å°åˆ°æ§åˆ¶å°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">cat</span> /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line"><span class="built_in">sync</span>:x:4:65534:<span class="built_in">sync</span>:/bin:/bin/sync</span><br></pre></td></tr></table></figure>

<p>æ ¼å¼ä¸ºï¼š<code>æ³¨å†Œå:å£ä»¤:ç”¨æˆ·æ ‡è¯†å·:ç»„æ ‡è¯†å·:ç”¨æˆ·å:ç”¨æˆ·ä¸»ç›®å½•:å‘½ä»¤è§£é‡Šç¨‹åº </code>ï¼Œè€Œæˆ‘ä»¬çš„å¯†ç åˆ™å­˜æ”¾åœ¨<code>/etc/shadow</code>ä¸­ï¼Œæ˜¯ä»¥åŠ å¯†å½¢å¼å­˜å‚¨çš„ï¼Œå¹¶ä¸”éœ€è¦rootæƒé™æ‰èƒ½æŸ¥çœ‹ã€‚</p>
<hr>
<h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Linuxç³»ç»Ÿä¸­ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤ã€‚</p>
<h3 id="æ–‡ä»¶æ“ä½œ"><a href="#æ–‡ä»¶æ“ä½œ" class="headerlink" title="æ–‡ä»¶æ“ä½œ"></a>æ–‡ä»¶æ“ä½œ</h3><p>æ–‡ä»¶æ˜¯æœ€åŸºæœ¬çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨lså‘½ä»¤åˆ—å‡ºå½“å‰ç›®å½•ä¸­æ‰€æœ‰çš„æ–‡ä»¶ï¼Œå‚æ•°-aè¡¨ç¤ºåŒ…å«æ‰€æœ‰çš„éšè—æ–‡ä»¶ï¼Œ-lè¡¨ç¤ºåˆ—å‡ºè¯¦ç»†ä¿¡æ¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span> -al</span><br><span class="line">total 44</span><br><span class="line">drwxr-xr-x 4 <span class="built_in">test</span> <span class="built_in">test</span> 4096 Jan 24 08:55 .</span><br><span class="line">drwxr-xr-x 4 root root 4096 Jan 24 04:24 ..</span><br><span class="line">-rw------- 1 <span class="built_in">test</span> <span class="built_in">test</span> 2124 Jan 24 04:29 .bash_history</span><br><span class="line">-rw-r--r-- 1 <span class="built_in">test</span> <span class="built_in">test</span>  220 Feb 25  2020 .bash_logout</span><br><span class="line">-rw-r--r-- 1 <span class="built_in">test</span> <span class="built_in">test</span> 3771 Feb 25  2020 .bashrc</span><br><span class="line">drwx------ 2 <span class="built_in">test</span> <span class="built_in">test</span> 4096 Jan 21 15:48 .cache</span><br><span class="line">drwx------ 3 <span class="built_in">test</span> <span class="built_in">test</span> 4096 Jan 23 14:49 .config</span><br><span class="line">-rw-r--r-- 1 <span class="built_in">test</span> <span class="built_in">test</span>  807 Feb 25  2020 .profile</span><br><span class="line">-rw------- 1 <span class="built_in">test</span> <span class="built_in">test</span>   34 Jan 24 04:17 .python_history</span><br><span class="line">-rw-r--r-- 1 <span class="built_in">test</span> <span class="built_in">test</span>    0 Jan 21 15:52 .sudo_as_admin_successful</span><br><span class="line">-rw------- 1 <span class="built_in">test</span> <span class="built_in">test</span> 7201 Jan 24 08:55 .viminfo</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å½“å‰ç›®å½•ä¸‹çš„æ•´ä¸ªæ–‡ä»¶åˆ—è¡¨ï¼Œé‚£ä¹ˆè¿™äº›ä¿¡æ¯å„ç§ä»£è¡¨ä»€ä¹ˆæ„æ€å‘¢ï¼Œå°¤å…¶æ˜¯æœ€å‰é¢é‚£ä¸€æ ç±»ä¼¼äº<code>drwxr-xr-x</code>çš„å­—ç¬¦ä¸²ã€‚</p>
<p>å®ƒè¡¨ç¤ºæ–‡ä»¶çš„å±æ€§ï¼Œå…¶ä¸­ç¬¬1ä¸ªå­—ç¬¦è¡¨ç¤ºæ­¤æ–‡ä»¶çš„ç±»å‹ï¼š<code>-</code>è¡¨ç¤ºæ™®é€šæ–‡ä»¶ï¼Œ<code>l</code>ä¸ºé“¾æ¥æ–‡ä»¶ï¼Œ<code>d</code>è¡¨ç¤ºç›®å½•ï¼ˆæ–‡ä»¶å¤¹ï¼‰ï¼Œ<code>c</code>è¡¨ç¤ºå­—ç¬¦è®¾å¤‡ã€<code>b</code>è¡¨ç¤ºå—è®¾å¤‡ï¼Œè¿˜æœ‰<code>p</code>æœ‰åç®¡é“ã€<code>f</code>å †æ ˆæ–‡ä»¶ã€<code>s</code>å¥—æ¥å­—ç­‰ï¼Œè¿™äº›ä¸€èˆ¬éƒ½æ˜¯ç”¨äºè¿›ç¨‹ä¹‹é—´é€šä¿¡ä½¿ç”¨çš„ã€‚</p>
<p>ç¬¬2-4ä¸ªå­—ç¬¦è¡¨ç¤ºæ–‡ä»¶çš„æ‹¥æœ‰è€…ï¼ˆUserï¼‰å¯¹è¯¥æ–‡ä»¶çš„æƒé™ï¼Œç¬¬5-7ä¸ªå­—ç¬¦è¡¨ç¤ºæ–‡ä»¶æ‰€å±ç”¨æˆ·ç»„ï¼ˆGroupï¼‰å†…ç”¨æˆ·å¯¹è¯¥æ–‡ä»¶çš„æƒé™ï¼Œæœ€å8-10ä¸ªå­—ç¬¦è¡¨ç¤ºå…¶ä»–ç”¨æˆ·ï¼ˆOtherï¼‰å¯¹è¯¥æ–‡ä»¶çš„æƒé™ã€‚å…¶ä¸­<code>r</code>ä¸ºè¯»æƒé™ã€<code>w</code>ä¸ºå†™æƒé™ã€<code>x</code>ä¸ºæ‰§è¡Œæƒé™ï¼Œä¸ºäº†æ–¹ä¾¿è®°å¿†ï¼Œç›´æ¥è®°UGOå°±è¡Œäº†ã€‚</p>
<p>æ¯”å¦‚<code>drwxr-xr-x</code>å°±è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç›®å½•ï¼Œæ–‡ä»¶çš„æ‹¥æœ‰è€…å¯ä»¥åœ¨ç›®å½•ä¸­è¯»ã€å†™å’Œæ‰§è¡Œï¼Œè€ŒåŒä¸€ç”¨æˆ·ç»„çš„å…¶ä»–ç”¨æˆ·åªèƒ½è¯»å’Œæ‰§è¡Œï¼Œå…¶ä»–ç”¨æˆ·ä¹Ÿæ˜¯ä¸€æ ·ã€‚</p>
<p>ç¬¬äºŒæ æ•°æ®å¯ä»¥çœ‹åˆ°æ˜¯ä¸€åˆ—æ•°å­—ï¼Œå®ƒè¡¨ç¤ºæ–‡ä»¶åˆ›å»ºçš„é“¾æ¥æ–‡ä»¶ï¼ˆå¿«æ·æ–¹å¼ï¼‰æ•°é‡ï¼Œä¸€èˆ¬åªæœ‰1è¡¨ç¤ºåªæœ‰å½“å‰æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•åˆ›å»ºä¸€ä¸ªé“¾æ¥æ–‡ä»¶ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ln</span> .bash_logout kk</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºåï¼Œä¼šç”Ÿæˆä¸€ä¸ªåä¸ºkkçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯¹æ­¤æ–‡ä»¶çš„æ“ä½œç›¸å½“äºç›´æ¥æ“ä½œ.bash_logoutï¼Œè·ŸWindowsä¸­çš„å¿«æ·æ–¹å¼æ¯”è¾ƒç±»ä¼¼ï¼Œäº†è§£ä¸€ä¸‹å³å¯ã€‚å†æ¬¡æ‰§è¡Œ<code>ll</code>å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°.bash_logoutçš„é“¾æ¥æ•°å˜æˆäº†2ã€‚</p>
<p>ç¬¬ä¸‰æ æ•°æ®ä¸ºè¯¥æ–‡ä»¶æˆ–æ˜¯ç›®å½•çš„æ‹¥æœ‰è€…ã€‚</p>
<p>ç¬¬å››æ æ•°æ®è¡¨ç¤ºæ‰€å±çš„ç»„ã€‚</p>
<p>ç¬¬äº”æ æ•°æ®è¡¨ç¤ºæ–‡ä»¶å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚</p>
<p>ç¬¬å…­æ æ•°æ®ä¸ºæ–‡ä»¶çš„æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´</p>
<p>æœ€åä¸€æ å°±æ˜¯æ–‡ä»¶åç§°äº†ï¼Œå°±ä¸å¤šè¯´äº†ï¼Œå†æ¬¡æåŠ..è¡¨ç¤ºä¸Šçº§ç›®å½•ï¼Œ.è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œæœ€å‰é¢æœ‰ä¸€ä¸ª.å¼€å¤´çš„æ–‡ä»¶ä¸ºéšè—æ–‡ä»¶ã€‚å¯ä»¥çœ‹åˆ°ä¸Šçº§ç›®å½•ï¼ˆä¹Ÿå°±æ˜¯/homeç›®å½•ï¼‰æ‰€æœ‰è€…ä¸ºrootï¼Œå¹¶ä¸”érootç”¨æˆ·æ— æ³•è¿›è¡Œå†™æ“ä½œï¼Œåªèƒ½æ‰§è¡Œè¯»æ“ä½œï¼Œè€Œå½“å‰ç›®å½•ä»¥åŠç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶åˆ™å±äºtestç”¨æˆ·ï¼Œtestç”¨æˆ·å¯ä»¥éšæ„è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>åœ¨äº†è§£äº†Linuxçš„æ–‡ä»¶æŸ¥çœ‹ä¹‹åå†å»çœ‹Windowsçš„æ–‡ä»¶ç®¡ç†ï¼Œä¼šè§‰å¾—Windowsçš„å¤ªæ‹‰äº†ï¼š</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg0.pconline.com.cn%2Fpconline%2F2107%2F02%2F14306786_05_thumb.jpg&refer=http%3A%2F%2Fimg0.pconline.com.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1645608268&t=75ea125c46cb38b22268156794b986d4" alt="img"></p>
<p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›å¯¹æ–‡ä»¶çš„å±æ€§è¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å¸Œæœ›å°†æŸä¸ªæ–‡ä»¶çš„å†™æƒé™ç»™å…³é—­ï¼Œå¯ä»¥ä½¿ç”¨<code>chmod</code>å‘½ä»¤æ¥è¿›è¡Œæ–‡ä»¶å±æ€§ä¿®æ”¹ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªtestæ–‡ä»¶ï¼Œä½¿ç”¨<code>touch</code>å‘½ä»¤æ¥åˆ›å»ºæ–‡ä»¶ï¼Œä½¿ç”¨<code>mkdir</code>å‘½ä»¤æ¥åˆ›å»ºç›®å½•ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ touch test</span><br><span class="line">test@ubuntu-server:~$ ll test</span><br><span class="line">-rw-rw-r-- 1 test test 0 Jan 24 09:32 test</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æ–‡ä»¶åˆ›å»ºä¹‹åçš„é»˜è®¤æƒé™ä¸ºå¯è¯»å¯å†™ï¼Œæ¥ç€æˆ‘ä»¬æ¥å°†å…¶ä¿®æ”¹ä¸ºåªè¯»ï¼Œchmodçš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>chmod (u/g/o/a)(+/-)(r/w/x) æ–‡ä»¶åç§°</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ä»ugoä¸­é€‰æ‹©æˆ–æ˜¯ç›´æ¥aè¡¨ç¤ºæ‰€æœ‰ï¼Œ+å’Œ-è¡¨ç¤ºæ·»åŠ å’Œåˆ é™¤æƒé™ï¼Œæœ€årwxä¸ç”¨æˆ‘è¯´äº†å§</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">chmod</span> a-w <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ ll <span class="built_in">test</span></span><br><span class="line">-r--r--r-- 1 <span class="built_in">test</span> <span class="built_in">test</span> 0 Jan 24 09:32 <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>é™¤äº†è¿™ç§æ–¹å¼ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°å­—æ¥ä»£æ›¿ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘è¦ç»™å‰ä¸¤ä¸ªæ·»åŠ è¯»æƒé™ï¼Œé‚£ä¹ˆï¼š</p>
<p>çº¦å®šï¼šr=4ï¼Œw=2ï¼Œx=1ï¼Œéœ€è¦ä»€ä¹ˆæƒé™å°±è®©å¯¹åº”æƒé™çš„æ•°å­—ç›¸åŠ ï¼Œä¸€ä¸ªæ•°å­—è¡¨ç¤ºä¸€ä¸ªrwxçš„æƒé™çŠ¶æ€ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³ä¿®æ”¹ä¸º<code>-rw-rw-r--</code>ï¼Œé‚£ä¹ˆå¯¹åº”çš„æ•°å­—å°±æ˜¯<code>664</code>ï¼Œå¯¹åº”çš„å‘½ä»¤ä¸ºï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">chmod</span> 664 <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ ll <span class="built_in">test</span></span><br><span class="line">-rw-rw-r-- 1 <span class="built_in">test</span> <span class="built_in">test</span> 0 Jan 24 09:32 <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬æƒ³ä¿®æ”¹æ–‡ä»¶çš„æ‹¥æœ‰è€…æˆ–æ˜¯æ‰€å±ç»„ï¼Œå¯ä»¥ä½¿ç”¨<code>chown</code>å’Œ<code>chgrp</code>å‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ sudo <span class="built_in">chown</span> root <span class="built_in">test</span> </span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span> -l</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r-- 1 root <span class="built_in">test</span> 0 Jan 24 10:43 <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ sudo <span class="built_in">chgrp</span> root <span class="built_in">test</span> </span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span> -l</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r-- 1 root root 0 Jan 24 10:43 <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>å†æ¬¡æ“ä½œè¯¥æ–‡ä»¶ï¼Œä¼šå‘ç°æ²¡æƒé™ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">chmod</span> 777 <span class="built_in">test</span> </span><br><span class="line"><span class="built_in">chmod</span>: changing permissions of <span class="string">&#x27;test&#x27;</span>: Operation not permitted</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹æ–‡ä»¶çš„å¤åˆ¶ã€ç§»åŠ¨å’Œåˆ é™¤ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•å¹¶è¿›å…¥åˆ°æ­¤ç›®å½•ç”¨äºæ“ä½œï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">mkdir</span> study</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">cd</span> study</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~/study$</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæˆ‘ä»¬æ¼”ç¤ºæ–‡ä»¶çš„å¤åˆ¶æ“ä½œï¼Œæ–‡ä»¶çš„å¤åˆ¶ä½¿ç”¨<code>cp</code>å‘½ä»¤ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬æƒ³æŠŠä¸Šä¸€çº§ç›®å½•ä¸­çš„testæ–‡ä»¶å¤åˆ¶åˆ°å½“å‰ç›®å½•ä¸­ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~/study$ <span class="built_in">cp</span> ../test <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~/study$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³è¦å°†ä¸€æ•´ä¸ªç›®å½•è¿›è¡Œå¤åˆ¶å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ª<code>-r</code>å‚æ•°è¡¨ç¤ºå°†ç›®å½•ä¸­çš„æ–‡ä»¶é€’å½’å¤åˆ¶ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~/study$ <span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">cp</span> -r study study_copied</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span> -l</span><br><span class="line">total 8</span><br><span class="line">drwxrwxr-x 2 <span class="built_in">test</span> <span class="built_in">test</span> 4096 Jan 24 10:16 study</span><br><span class="line">drwxrwxr-x 2 <span class="built_in">test</span> <span class="built_in">test</span> 4096 Jan 24 10:20 study_copied</span><br><span class="line">-rw-rw-r-- 1 <span class="built_in">test</span> <span class="built_in">test</span>    0 Jan 24 09:32 <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ•´ä¸ªç›®å½•ä¸­æ‰€æœ‰çš„æ–‡ä»¶ä¹Ÿä¸€èµ·è¢«å¤åˆ¶äº†ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ç§»åŠ¨æ“ä½œï¼Œç›¸å½“äºæ˜¯ç›´æ¥å°†ä¸€ä¸ªæ–‡ä»¶è½¬ç§»åˆ°å¦ä¸€ä¸ªç›®å½•ä¸­äº†ï¼Œæˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªç›®å½•ç”¨äºæ–‡ä»¶çš„ç§»åŠ¨ï¼Œå¹¶å°†testæ–‡ä»¶ç§»åŠ¨åˆ°æ­¤ç›®å½•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>mv</code>å‘½ä»¤è¿›è¡Œæ–‡ä»¶çš„ç§»åŠ¨ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">mkdir</span> study2</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">mv</span> <span class="built_in">test</span> study2</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span></span><br><span class="line">study  study2  study_copied</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">cd</span> study2</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~/study2$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æƒ³è¦ç§»åŠ¨ä¸ªç›®å½•åˆ°å¦ä¸€ä¸ªç›®å½•ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³å°†studyç›®å½•ç§»åŠ¨åˆ°study2ç›®å½•ä¸­ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">mv</span> study study2</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span></span><br><span class="line">study2  study_copied</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">cd</span> study2</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~/study2$ <span class="built_in">ls</span></span><br><span class="line">study  <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p><code>mv</code>å‘½ä»¤ä¸ä»…èƒ½å®ç°æ–‡ä»¶çš„ç§»åŠ¨ï¼Œè¿˜å¯ä»¥å®ç°å¯¹æ–‡ä»¶é‡å‘½åæ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³å°†æ–‡ä»¶testé‡å‘½åä¸ºyydsï¼Œé‚£ä¹ˆç›´æ¥å°†å…¶è¿›è¡Œç§»åŠ¨æ“ä½œå³å¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~/study2$ <span class="built_in">ls</span></span><br><span class="line">study  <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~/study2$ <span class="built_in">mv</span> <span class="built_in">test</span> yyds</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~/study2$ <span class="built_in">ls</span></span><br><span class="line">study  yyds</span><br></pre></td></tr></table></figure>

<p>æœ€åå°±æ˜¯åˆ é™¤å‘½ä»¤äº†ï¼Œä½¿ç”¨<code>rm</code>è¿›è¡Œåˆ é™¤æ“ä½œï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬æƒ³åˆ é™¤study2ç›®å½•ï¼ˆæ³¨æ„éœ€è¦æ·»åŠ -rå‚æ•°è¡¨ç¤ºé€’å½’åˆ é™¤æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ï¼‰ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">rm</span> -r study2</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span></span><br><span class="line">study_copied</span><br></pre></td></tr></table></figure>

<p>è€Œæœ€å¸¸æåˆ°çš„<code>rm -rf /*</code>æ­£æ˜¯åˆ é™¤æ ¹ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ï¼ˆéå¸¸å±é™©çš„æ“ä½œï¼‰ï¼Œ-fè¡¨ç¤ºå¿½ç•¥ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œä¸è¿›è¡Œä»»ä½•æç¤ºï¼Œ*æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œè¡¨ç¤ºä»»æ„æ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹åˆ é™¤æ‰€æœ‰.txtç»“å°¾çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">touch</span> 1.txt 2.txt 3.txt</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span></span><br><span class="line">1.txt  2.txt  3.txt</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">rm</span> *.txt</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ </span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å†æ¥çœ‹æ–‡ä»¶çš„æœç´¢ï¼Œæˆ‘ä»¬ä½¿ç”¨findå‘½ä»¤æ¥è¿›è¡Œæœç´¢ï¼Œæ¯”å¦‚æˆ‘æƒ³æœç´¢/etcç›®å½•ä¸‹åä¸ºpasswdçš„æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ sudo find /etc -name passwd</span><br><span class="line">[sudo] password for test: </span><br><span class="line">/etc/pam.d/passwd</span><br><span class="line">/etc/passwd</span><br></pre></td></tr></table></figure>

<p>å®ƒè¿˜æ”¯æŒé€šé…ç¬¦ï¼Œæ¯”å¦‚æœç´¢ä»¥så¼€å¤´çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ sudo find /etc -name s*</span><br><span class="line">/etc/subuid</span><br><span class="line">/etc/screenrc</span><br><span class="line">/etc/sensors3.conf</span><br><span class="line">/etc/sysctl.conf</span><br><span class="line">/etc/sudoers</span><br><span class="line">/etc/shadow</span><br><span class="line">/etc/skel</span><br><span class="line">/etc/pam.d/su</span><br><span class="line">/etc/pam.d/sshd</span><br><span class="line">/etc/pam.d/sudo</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="ç³»ç»Ÿç®¡ç†"><a href="#ç³»ç»Ÿç®¡ç†" class="headerlink" title="ç³»ç»Ÿç®¡ç†"></a>ç³»ç»Ÿç®¡ç†</h3><p>æ¥ç€æˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€äº›ç³»ç»Ÿç®¡ç†ç›¸å…³çš„å‘½ä»¤ï¼Œæ¯”å¦‚æˆ‘ä»¬Windowsä¸­çš„ä»»åŠ¡ç®¡ç†å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>top</code>å‘½ä»¤æ¥æ‰“å¼€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">top - 10:48:46 up  5:52,  1 user,  load average: 0.00, 0.00, 0.00</span><br><span class="line">Tasks: 191 total,   2 running, 189 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  0.0 us,  0.2 sy,  0.0 ni, 99.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">MiB Mem :   3919.1 total,   2704.2 free,    215.0 used,    999.9 buff/cache</span><br><span class="line">MiB Swap:   3923.0 total,   3923.0 free,      0.0 used.   3521.4 avail Mem </span><br><span class="line"></span><br><span class="line">    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                       </span><br><span class="line">  10528 test      20   0    8944   3072   2652 R   0.7   0.1   0:00.07 top                           </span><br><span class="line">   9847 root      20   0       0      0      0 I   0.3   0.0   0:00.87 kworker/0:0-events            </span><br><span class="line">      1 root      20   0  102760  10456   7120 S   0.0   0.3   0:02.02 systemd                       </span><br><span class="line">      2 root      20   0       0      0      0 S   0.0   0.0   0:00.01 kthreadd                      </span><br><span class="line">      3 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 rcu_gp                        </span><br><span class="line">      4 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 rcu_par_gp                    </span><br><span class="line">      6 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/0:0H-kblockd          </span><br><span class="line">      8 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 mm_percpu_wq                  </span><br><span class="line">      9 root      20   0       0      0      0 S   0.0   0.0   0:00.15 ksoftirqd/0                   </span><br><span class="line">     10 root      20   0       0      0      0 R   0.0   0.0   0:01.49 rcu_sched                     </span><br><span class="line">     11 root      rt   0       0      0      0 S   0.0   0.0   0:00.24 migration/0                   </span><br><span class="line">     12 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/0                 </span><br><span class="line">     14 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/0                       </span><br><span class="line">     15 root      20   0       0      0      0 S   0.0   0.0   0:00.00 cpuhp/1                       </span><br><span class="line">     16 root     -51   0       0      0      0 S   0.0   0.0   0:00.00 idle_inject/1                 </span><br><span class="line">     17 root      rt   0       0      0      0 S   0.0   0.0   0:00.30 migration/1                   </span><br><span class="line">     18 root      20   0       0      0      0 S   0.0   0.0   0:00.07 ksoftirqd/1                   </span><br><span class="line">     20 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker/1:0H-kblockd  </span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°å½“å‰CPUçš„ä½¿ç”¨æƒ…å†µä»¥åŠå†…å­˜çš„å ç”¨æƒ…å†µã€‚</p>
<p>æŒ‰ä¸‹æ•°å­—é”®1ï¼Œå¯ä»¥å±•ç¤ºæ‰€æœ‰CPUæ ¸å¿ƒçš„ä½¿ç”¨æƒ…å†µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%Cpu0  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">%Cpu1  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br></pre></td></tr></table></figure>

<p>æŒ‰ä¸‹fé”®å¯ä»¥è®¾ç½®ä»¥å“ªä¸€åˆ—è¿›è¡Œæ’åºæˆ–æ˜¯æ˜¾ç¤ºé‚£äº›å‚æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Fields Management for window 1:Def, whose current sort field is %MEM</span><br><span class="line">   Navigate with Up/Dn, Right selects for move then &lt;Enter&gt; or Left commits,</span><br><span class="line">   &#x27;d&#x27; or &lt;Space&gt; toggles display, &#x27;s&#x27; sets sort.  Use &#x27;q&#x27; or &lt;Esc&gt; to end!</span><br></pre></td></tr></table></figure>

<p>æŒ‰ä¸‹qé”®å³å¯é€€å‡ºç›‘æ§ç•Œé¢ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥è¾“å…¥freeå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3919         212        2706           1         999        3523</span><br><span class="line">Swap:          3922           0        3922</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­-mè¡¨ç¤ºä»¥Mä¸ºå•ä½ï¼Œä¹Ÿå¯ä»¥-gè¡¨ç¤ºä»¥Gä¸ºå•ä½ï¼Œé»˜è®¤æ˜¯kbä¸ºå•ä½ã€‚</p>
<p>æœ€åå°±æ˜¯ç£ç›˜å®¹é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>lsblk</code>æ¥æŸ¥çœ‹æ‰€æœ‰å—è®¾å¤‡çš„ä¿¡æ¯ï¼Œå…¶ä¸­å°±åŒ…æ‹¬æˆ‘ä»¬çš„ç¡¬ç›˜ã€å…‰é©±ç­‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ lsblk</span><br><span class="line">NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">loop0                       7:0    0 48.9M  1 loop /snap/core18/2127</span><br><span class="line">loop1                       7:1    0 28.1M  1 loop /snap/snapd/12707</span><br><span class="line">loop2                       7:2    0   62M  1 loop /snap/lxd/21032</span><br><span class="line">sr0                        11:0    1 1024M  0 rom  </span><br><span class="line">nvme0n1                   259:0    0   20G  0 disk </span><br><span class="line">â”œâ”€nvme0n1p1               259:1    0  512M  0 part /boot/efi</span><br><span class="line">â”œâ”€nvme0n1p2               259:2    0    1G  0 part /boot</span><br><span class="line">â””â”€nvme0n1p3               259:3    0 18.5G  0 part </span><br><span class="line">  â””â”€ubuntu--vg-ubuntu--lv 253:0    0 18.5G  0 lvm  /</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°nvmeå¼€å¤´çš„å°±æ˜¯æˆ‘ä»¬çš„ç¡¬ç›˜ï¼ˆè¿™ä¸ªå› äººè€Œå¼‚ï¼Œå¯èƒ½ä½ ä»¬çš„æ˜¯sdaï¼Œç£ç›˜ç±»å‹ä¸åŒåç§°å°±ä¸åŒï¼‰å¯ä»¥çœ‹åˆ°<code>nvme0n1  </code>å®¹é‡ä¸º20Gï¼Œå¹¶ä¸”512Mç”¨ä½œå­˜æ”¾EFIæ–‡ä»¶ï¼Œ1Gå­˜æ”¾å¯åŠ¨æ–‡ä»¶ï¼Œå‰©ä½™å®¹é‡å°±æ˜¯å­˜æ”¾ç³»ç»Ÿæ–‡ä»¶å’Œæˆ‘ä»¬çš„ç”¨æˆ·ç›®å½•ã€‚</p>
<p>è¿™é‡Œè¦æåˆ°ä¸€ä¸ªæŒ‚è½½çš„æ¦‚å¿µï¼š</p>
<blockquote>
<p>æŒ‚è½½ï¼ŒæŒ‡çš„å°±æ˜¯å°†è®¾å¤‡æ–‡ä»¶ä¸­çš„é¡¶çº§ç›®å½•è¿æ¥åˆ° Linux æ ¹ç›®å½•ä¸‹çš„æŸä¸€ç›®å½•ï¼ˆæœ€å¥½æ˜¯ç©ºç›®å½•ï¼‰ï¼Œè®¿é—®æ­¤ç›®å½•å°±ç­‰åŒäºè®¿é—®è®¾å¤‡æ–‡ä»¶ã€‚</p>
</blockquote>
<p>æ¯”å¦‚æˆ‘ä»¬çš„ä¸»ç¡¬ç›˜ï¼ŒæŒ‚è½½ç‚¹å°±è¢«è®¾å®šä¸º<code>/</code>æ ¹ç›®å½•ï¼Œè€Œæˆ‘ä»¬æ‰€æœ‰ä¿å­˜çš„æ–‡ä»¶éƒ½ä¼šå­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ï¼Œå¦‚æœä½ æœ‰Uç›˜ï¼ˆæœ€å¥½å°†Uç›˜çš„æ–‡ä»¶æ ¼å¼æ”¹ä¸ºExFatï¼Œå¯ä»¥ç›´æ¥åœ¨Windowsä¸­è¿›è¡Œæ ¼å¼åŒ–ï¼Œç„¶åéšä¾¿æ”¾å…¥ä¸€äº›æ–‡ä»¶å³å¯ï¼‰ä¹‹ç±»çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å¯ä»¥æ¼”ç¤ºä¸€ä¸‹å¯¹Uç›˜è¿›è¡ŒæŒ‚è½½ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ sudo fdisk -l</span><br><span class="line">...</span><br><span class="line">Disk /dev/sda: 60 GiB, 64424509440 bytes, 125829120 sectors</span><br><span class="line">Disk model: USB DISK        </span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x4a416279</span><br><span class="line"></span><br><span class="line">Device     Boot     Start       End   Sectors  Size Id Type</span><br><span class="line">/dev/sda1  *       614400 125214719 124600320 59.4G  7 HPFS/NTFS/exFAT</span><br><span class="line">/dev/sda2       125214720 125825022    610303  298M  6 FAT16</span><br></pre></td></tr></table></figure>

<p>å°†Uç›˜æ’å…¥ç”µè„‘ï¼Œé€‰æ‹©è¿æ¥åˆ°Linuxï¼Œè¾“å…¥<code>sudo fdisk -l</code>å‘½ä»¤æ¥æŸ¥çœ‹ç¡¬ç›˜å®ä½“æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªUSB DISKè®¾å¤‡ï¼Œæ³¨æ„è§‚å¯Ÿä¸€ä¸‹æ˜¯ä¸æ˜¯å’Œè‡ªå·±çš„Uç›˜å®¹é‡ä¸€è‡´ï¼Œå¯ä»¥çœ‹åˆ°è®¾å¤‡åç§°ä¸º<code>/dev/sda1</code>ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬è®¾å¤‡æŒ‚è½½åˆ°ä¸€ä¸ªç›®å½•ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">mkdir</span> u-test</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ sudo mount /dev/sda1 u-test/</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">cd</span> u-test/</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~/u-test$ <span class="built_in">ls</span></span><br><span class="line"> CGI</span><br><span class="line"> cn_windows_10_enterprise_ltsc_2019_x64_dvd_9c09ff24.iso</span><br><span class="line"> cn_windows_7_professional_x64_dvd_x15-65791.iso</span><br><span class="line"> cn_windows_8.1_enterprise_with_update_x64_dvd_6050374.iso</span><br><span class="line"> cn_windows_8.1_professional_vl_with_update_x64_dvd_4050293.iso</span><br><span class="line"> cn_windows_server_2019_updated_july_2020_x64_dvd_2c9b67da.iso</span><br><span class="line"><span class="string">&#x27;System Volume Information&#x27;</span></span><br><span class="line"> zh-cn_windows_10_consumer_editions_version_21h1_updated_sep_2021_x64_dvd_991b822f.iso</span><br><span class="line"> zh-cn_windows_11_consumer_editions_x64_dvd_904f13e4.iso</span><br></pre></td></tr></table></figure>

<p>æœ€åè¿›å…¥åˆ°æ­¤ç›®å½•ä¸­ï¼Œå°±èƒ½çœ‹åˆ°ä½ Uç›˜ä¸­çš„æ–‡ä»¶äº†ï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨Uç›˜äº†ï¼Œå¯ä»¥ç›´æ¥å–æ¶ˆæŒ‚è½½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~/u-test$ cd ..</span><br><span class="line">test@ubuntu-server:~$ sudo umount /dev/sda1</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>df</code>å‘½ä»¤æŸ¥çœ‹å½“å‰ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ df -m</span><br><span class="line">Filesystem                        1M-blocks  Used Available Use% Mounted on</span><br><span class="line">udev                                   1900     0      1900   0% /dev</span><br><span class="line">tmpfs                                   392     2       391   1% /run</span><br><span class="line">/dev/mapper/ubuntu--vg-ubuntu--lv     18515  6544     11009  38% /</span><br><span class="line">tmpfs                                  1960     0      1960   0% /dev/shm</span><br><span class="line">tmpfs                                     5     0         5   0% /run/lock</span><br><span class="line">tmpfs                                  1960     0      1960   0% /sys/fs/cgroup</span><br><span class="line">/dev/nvme0n1p2                          976   109       800  12% /boot</span><br><span class="line">/dev/nvme0n1p1                          511     4       508   1% /boot/efi</span><br><span class="line">/dev/loop0                               49    49         0 100% /snap/core18/2127</span><br><span class="line">/dev/loop1                               29    29         0 100% /snap/snapd/12707</span><br><span class="line">/dev/loop2                               62    62         0 100% /snap/lxd/21032</span><br><span class="line">tmpfs                                   392     0       392   0% /run/user/1000</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥<code>ps</code>å¯ä»¥æŸ¥çœ‹å½“å‰è¿è¡Œçš„ä¸€äº›è¿›ç¨‹ï¼Œå…¶å®å’Œtopæœ‰ç‚¹ç±»ä¼¼ï¼Œä½†æ˜¯æ²¡æœ‰ç›‘æ§åŠŸèƒ½ï¼Œåªèƒ½æ˜¾ç¤ºå½“å‰çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ ps</span><br><span class="line">    PID TTY          TIME CMD</span><br><span class="line">  11438 pts/0    00:00:00 bash</span><br><span class="line">  11453 pts/0    00:00:00 ps</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ -efæŸ¥çœ‹æ‰€æœ‰çš„è¿›ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ ps -ef</span><br><span class="line">UID          PID    PPID  C STIME TTY          TIME CMD</span><br><span class="line">root           1       0  0 04:55 ?        00:00:02 /sbin/init</span><br><span class="line">root           2       0  0 04:55 ?        00:00:00 [kthreadd]</span><br><span class="line">root           3       2  0 04:55 ?        00:00:00 [rcu_gp]</span><br><span class="line">root           4       2  0 04:55 ?        00:00:00 [rcu_par_gp]</span><br><span class="line">root           6       2  0 04:55 ?        00:00:00 [kworker/0:0H-kblockd]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„è¿›ç¨‹IDï¼ˆPIDï¼‰ï¼Œä½¿ç”¨killå‘½ä»¤å°†å…¶å¼ºåˆ¶ç»ˆæ­¢ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ ps</span><br><span class="line">    PID TTY          TIME CMD</span><br><span class="line">  11438 pts/0    00:00:00 bash</span><br><span class="line">  11455 pts/0    00:00:00 ps</span><br><span class="line">test@ubuntu-server:~$ kill -9 11438</span><br><span class="line">Connection to 192.168.10.6 closed.</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å°†å½“å‰ä¼šè¯çš„bashç»™æ€æ­»ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æˆ‘ä»¬çš„è¿æ¥ç›´æ¥æ–­å¼€ï¼Œå…¶ä¸­-9æ˜¯ä¸€ä¸ªä¿¡å·ï¼Œè¡¨ç¤ºæ€æ­»è¿›ç¨‹ï¼š</p>
<ul>
<li>1 (HUP)ï¼šé‡æ–°åŠ è½½è¿›ç¨‹ã€‚</li>
<li>9 (KILL)ï¼šæ€æ­»ä¸€ä¸ªè¿›ç¨‹ã€‚</li>
<li>15 (TERM)ï¼šæ­£å¸¸åœæ­¢ä¸€ä¸ªè¿›ç¨‹ã€‚</li>
</ul>
<p>æœ€åå¦‚æœæˆ‘ä»¬æƒ³è¦æ­£å¸¸å…³æœºï¼Œåªéœ€è¦è¾“å…¥shutdownå³å¯ï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªå…³æœºè®¡åˆ’ï¼Œå¹¶åœ¨æŒ‡å®šæ—¶é—´å…³æœºï¼Œæˆ–æ˜¯æ·»åŠ nowè¡¨ç¤ºç«‹å³å…³æœºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ sudo shutdown</span><br><span class="line">[sudo] password for test: </span><br><span class="line">Shutdown scheduled for Mon 2022-01-24 11:46:18 UTC, use &#x27;shutdown -c&#x27; to cancel.</span><br><span class="line">test@ubuntu-server:~$ sudo shutdown now</span><br><span class="line">Connection to 192.168.10.6 closed by remote host.</span><br><span class="line">Connection to 192.168.10.6 closed.</span><br></pre></td></tr></table></figure>

<h3 id="å‹ç¼©è§£å‹"><a href="#å‹ç¼©è§£å‹" class="headerlink" title="å‹ç¼©è§£å‹"></a>å‹ç¼©è§£å‹</h3><p>æ¯”è¾ƒå¸¸ç”¨çš„å‹ç¼©å’Œè§£å‹ä¹Ÿæ˜¯é‡ç‚¹ï¼Œæˆ‘ä»¬åœ¨Windowsä¸­ç»å¸¸éœ€è¦ä¸‹è½½ä¸€äº›å‹ç¼©åŒ…ï¼Œå¹¶ä¸”å°†å‹ç¼©åŒ…è§£å‹æ‰èƒ½è·å¾—é‡Œé¢çš„æ–‡ä»¶ï¼Œè€ŒLinuxä¸­ä¹Ÿæ”¯æŒæ–‡ä»¶çš„å‹ç¼©å’Œè§£å‹ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>tar</code>å‘½ä»¤æ¥å®Œæˆæ–‡ä»¶äºšç´¢å’Œè§£å‹æ“ä½œï¼Œåœ¨Linuxä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯gzipæ ¼å¼ï¼Œåç¼€åä¸€èˆ¬ä¸º.gzï¼Œtarå‘½ä»¤çš„å‚æ•°-cè¡¨ç¤ºå¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œåˆ›å»ºæ–°çš„å‹ç¼©æ–‡ä»¶ï¼Œ-xè¡¨ç¤ºè¿›è¡Œè§£å‹æ“ä½œï¼Œ-zè¡¨ç¤ºä»¥gzipæ ¼å¼è¿›è¡Œæ“ä½œï¼Œ-vå¯ä»¥åœ¨å¤„ç†è¿‡ç¨‹ä¸­è¾“å‡ºä¸€äº›æ—¥å¿—ä¿¡æ¯ï¼Œ-fè¡¨ç¤ºå¯¹æ™®é€šæ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¹¶å¯¹è¿™ä¸‰ä¸ªæ–‡ä»¶è¿›è¡Œæ‰“åŒ…ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ tar -zcvf test.tar.gz *.txt</span><br><span class="line">1.txt</span><br><span class="line">2.txt</span><br><span class="line">3.txt</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span></span><br><span class="line">1.txt  2.txt  3.txt  test.tar.gz</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ </span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åˆ é™¤åˆšåˆšä¸‰ä¸ªæ–‡ä»¶ï¼Œå†æ‰§è¡Œè§£å‹æ“ä½œï¼Œå¾—åˆ°å‹ç¼©åŒ…ä¸­æ–‡ä»¶ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">rm</span> *.txt</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span></span><br><span class="line">test.tar.gz</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ tar -zxvf test.tar.gz </span><br><span class="line">1.txt</span><br><span class="line">2.txt</span><br><span class="line">3.txt</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span></span><br><span class="line">1.txt  2.txt  3.txt  test.tar.gz</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹ä¸€ä¸ªæ–‡ä»¶å¤¹è¿›è¡Œæ‰“åŒ…ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">mv</span> *.txt <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ tar -zcvf test.tar.gz <span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">test</span>/1.txt</span><br><span class="line"><span class="built_in">test</span>/2.txt</span><br><span class="line"><span class="built_in">test</span>/3.txt</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">rm</span> -r <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span></span><br><span class="line">test.tar.gz </span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ tar -zxvf test.tar.gz </span><br><span class="line"><span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">test</span>/1.txt</span><br><span class="line"><span class="built_in">test</span>/2.txt</span><br><span class="line"><span class="built_in">test</span>/3.txt</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">test</span>  test.tar.gz</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ <span class="built_in">ls</span> <span class="built_in">test</span></span><br><span class="line">1.txt  2.txt  3.txt</span><br></pre></td></tr></table></figure>

<p>åˆ°æ­¤ï¼ŒLinuxçš„ä¸€äº›åŸºæœ¬å‘½ä»¤å°±è®²è§£ä¸ºæ­¢ã€‚</p>
<hr>
<h2 id="vimæ–‡æœ¬ç¼–è¾‘å™¨"><a href="#vimæ–‡æœ¬ç¼–è¾‘å™¨" class="headerlink" title="vimæ–‡æœ¬ç¼–è¾‘å™¨"></a>vimæ–‡æœ¬ç¼–è¾‘å™¨</h2><p>å’ŒWindowsä¸­çš„è®°äº‹æœ¬ä¸€æ ·ï¼ŒLinuxä¸­ä¹Ÿæœ‰æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå«åšViç¼–è¾‘å™¨ï¼ŒUbuntuä¸­å†…ç½®äº†Viç¼–è¾‘å™¨çš„å‡çº§ç‰ˆVimï¼Œæˆ‘ä»¬è¿™é‡Œå°±è®²è§£Vimç¼–è¾‘å™¨çš„ä½¿ç”¨ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥è¾“å…¥<code>vim æ–‡ä»¶åç§°</code>æ¥ä½¿ç”¨Vimç¼–è¾‘å™¨å¯¹æ–‡æœ¬æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ vim hello.txt</span><br></pre></td></tr></table></figure>

<p>è¿›å…¥ç¼–è¾‘å™¨ä¹‹åï¼Œæˆ‘ä»¬å‘ç°ç•Œé¢å˜æˆäº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">~                                                                                                                                                                                         </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">&quot;hello.txt&quot; [New File]                                                            0,0-1         All</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶æˆ‘ä»¬ç›´æ¥è¾“å…¥å†…å®¹æ˜¯æ— æ³•å®Œæˆçš„ï¼Œå› ä¸ºé»˜è®¤è¿›å…¥ä¹‹åä¸º<code>å‘½ä»¤æ¨¡å¼</code>ï¼ŒVimç¼–è¾‘å™¨é»˜è®¤æœ‰ä¸‰ç§æ¨¡å¼ï¼š</p>
<p><img src="http://c.biancheng.net/uploads/allimg/180914/1-1P9141F35R32.jpg" alt="img"></p>
<ul>
<li>å‘½ä»¤æ¨¡å¼ï¼šæ­¤æ¨¡å¼ä¸‹å¯ä»¥è¾“å…¥ä»»æ„çš„å‘½ä»¤è¿›è¡Œæ“ä½œï¼Œæ‰€æœ‰çš„è¾“å…¥éƒ½è¢«çœ‹åšæ˜¯å‘½ä»¤è¾“å…¥ï¼Œè€Œä¸æ˜¯æ–‡æœ¬ç¼–è¾‘è¾“å…¥ã€‚</li>
<li>ç¼–è¾‘æ¨¡å¼ï¼šæ­¤æ¨¡å¼ä¸‹è¾“å…¥çš„ä»»ä½•å†…å®¹éƒ½ä¼šä»¥æ–‡æœ¬ç¼–è¾‘æ–¹å¼å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œå°±åƒæˆ‘ä»¬ç›´æ¥åœ¨Windowsçš„è®°äº‹æœ¬ä¸­å†™å†…å®¹ä¸€æ ·ã€‚</li>
<li>æœ«è¡Œæ¨¡å¼ï¼šæ­¤æ¨¡å¼ä¸‹ç”¨äºè¾“å…¥ä¸€äº›å¤æ‚å‘½ä»¤ï¼Œä¼šåœ¨æœ€åä¸€è¡Œè¿›è¡Œå¤æ‚å‘½ä»¤çš„è¾“å…¥ã€‚</li>
</ul>
<p>åœ¨å‘½ä»¤æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŒ‰ä¸‹é”®ç›˜ä¸Šçš„<code>i</code>ï¼Œæ­¤å‘½ä»¤è¡¨ç¤ºè¿›è¡Œæ’å…¥æ“ä½œï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼ï¼Œè¿™æ—¶å¯ä»¥çœ‹åˆ°æœ€ä¸‹æ–¹å˜ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">~                                                                                                   </span><br><span class="line">-- INSERT --                                                                      1,1           All</span><br></pre></td></tr></table></figure>

<p>è€Œè¿™æ—¶æˆ‘ä»¬æ‰€æœ‰çš„è¾“å…¥å†…å®¹éƒ½å¯ä»¥ç›´æ¥å†™åˆ°æ–‡ä»¶ä¸­äº†ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å›åˆ°å‘½ä»¤æ¨¡å¼ï¼ŒæŒ‰ä¸‹<code>Esc</code>é”®å³å¯ã€‚</p>
<p>é™¤äº†<code>i</code>ä»¥å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‰ä¸‹<code>a</code>è¡¨ç¤ºä»å½“å‰å…‰æ ‡æ‰€åœ¨ä½ç½®ä¹‹åç»§ç»­å†™ï¼Œä¸<code>i</code>ä¸åŒçš„æ˜¯ï¼Œ<code>i</code>ä¼šåœ¨å…‰æ ‡ä¹‹å‰ç»§ç»­å†™ï¼Œ<code>o</code>ä¼šç›´æ¥è·³åˆ°ä¸‹ä¸€è¡Œï¼Œè€Œ<code>A</code>è¡¨ç¤ºåœ¨å½“å‰è¡Œçš„æœ€åç»§ç»­å†™å…¥ï¼Œ<code>I</code>è¡¨ç¤ºåœ¨å½“å‰è¡Œçš„æœ€å‰é¢ç»§ç»­å†™å…¥ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬éšä¾¿ç²˜è´´ä¸€æ®µæ–‡æœ¬ä¿¡æ¯è¿›å»ï¼ˆä¸è¦ç”¨Ctrl+Vï¼ŒLinuxä¸­æ²¡è¿™æ“ä½œï¼ŒXShellå³é”®ç‚¹ç²˜è´´ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">I was hard on people sometimes, probably harder than I needed to be. </span><br><span class="line">I remember the time when Reed was six years old, coming home, and I had just fired somebody that day.</span><br><span class="line">And I imagined what it was like for that person to tell his family and his young son that he had lost his job. </span><br><span class="line">It was hard. </span><br><span class="line">Butã€€somebodyâ€™s got to do it. </span><br><span class="line">I figured that it was always my job to make sure that the team was excellent, and if I didnâ€™t do it, nobody was going to do it.</span><br><span class="line">You always have to keep pushing to innovate.</span><br><span class="line">Dylan could have sung protest songs forever and probably made a lot of money, but he didnâ€™t. </span><br><span class="line">He had to move on, and when he did, by going electric in 1965, he alienated a lot of people.</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘ä»¬ç¼–è¾‘å®Œæˆä¹‹åï¼Œéœ€è¦è¿›å…¥åˆ°æœ«è¡Œæ¨¡å¼è¿›è¡Œæ–‡ä»¶çš„ä¿å­˜å¹¶é€€å‡ºï¼ŒæŒ‰ä¸‹<code>:</code>è¿›å…¥æœ«è¡Œæ¨¡å¼ï¼Œå†è¾“å…¥wqå³å¯ä¿å­˜é€€å‡ºã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤ï¼Œé¦–å…ˆæ˜¯å‘½ä»¤æ¨¡å¼ä¸‹çš„å…‰æ ‡ç§»åŠ¨å‘½ä»¤ï¼š</p>
<ul>
<li>^   ç›´æ¥è°ƒåˆ°æœ¬è¡Œæœ€å‰é¢</li>
<li>$   ç›´æ¥è·³åˆ°æœ¬è¡Œæœ€åé¢</li>
<li>gg  ç›´æ¥è·³åˆ°ç¬¬ä¸€è¡Œ</li>
<li>[N]G    è·³è½¬åˆ°ç¬¬Nè¡Œ</li>
<li>[N]æ–¹å‘é”®    å‘ä¸€ä¸ªæ–¹å‘è·³è½¬Nä¸ªå­—ç¬¦</li>
</ul>
<p>åœ¨æœ«è¡Œæ¨¡å¼ä¸‹ï¼Œå¸¸ç”¨çš„å¤æ‚å‘½ä»¤æœ‰ï¼š</p>
<ul>
<li>:set number    å¼€å¯è¡Œå·</li>
<li>:w    ä¿å­˜</li>
<li>:wqæˆ–:x    ä¿å­˜å¹¶å…³é—­</li>
<li>:q    å…³é—­</li>
<li>:q!    å¼ºåˆ¶å…³é—­</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥è¾“å…¥<code>/</code>æˆ–æ˜¯<code>?</code>åœ¨æœ«è¡Œæ¨¡å¼ä¸­ä½¿ç”¨æœç´¢åŠŸèƒ½ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦æœç´¢å•è¯<code>it</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/it  </span><br></pre></td></tr></table></figure>

<p>æ¥ç€ä¼šåœ¨æ–‡æœ¬ä¸­å‡ºç°é«˜äº®ï¼ŒæŒ‰<code>n</code>è·³è½¬åˆ°ä¸‹ä¸€ä¸ªæœç´¢ç»“æœï¼Œ?æ˜¯ä»åå‘å‰æœç´¢ï¼Œ/æ˜¯ä»å‰å‘åæœç´¢ã€‚</p>
<p>å®ƒè¿˜æ”¯æŒæ›¿æ¢åŠŸèƒ½ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥ç¨å¾®æ¯”è¾ƒå¤æ‚ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">:[addr]s/æºå­—ç¬¦ä¸²/ç›®çš„å­—ç¬¦ä¸²/[option]</span><br></pre></td></tr></table></figure>

<p>addrè¡¨ç¤ºç¬¬å‡ è¡Œæˆ–æ˜¯ä¸€ä¸ªèŒƒå›´ï¼Œoptionè¡¨ç¤ºæ“ä½œç±»å‹ï¼š</p>
<ul>
<li>g: globe,è¡¨ç¤ºå…¨å±€æ›¿æ¢</li>
<li>c: confirm,è¡¨ç¤ºè¿›è¡Œç¡®è®¤</li>
<li>p: è¡¨ç¤ºæ›¿ä»£ç»“æœé€è¡Œæ˜¾ç¤º(Ctrl + Læ¢å¤å±å¹•)</li>
<li>i:  ignore,ä¸åŒºåˆ†å¤§å°å†™</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬è¦å°†å½“å‰è¡Œä¸­çš„<code>it</code>å…¨éƒ¨æ›¿æ¢ä¸º<code>he</code>ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">:s/it/he/g</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šé™¤äº†ä»¥ä¸Šä¸‰ç§æ¨¡å¼å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ¨¡å¼å«åšå¯è§†åŒ–æ¨¡å¼ï¼ŒæŒ‰ä¸‹é”®ç›˜ä¸Šçš„<code>v</code>å³å¯è¿›å…¥ï¼Œå®ƒèƒ½å¤Ÿæ”¯æŒé€‰å–ä¸€æ®µæ–‡æœ¬ï¼Œé€‰å–åï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æŒ‡å®šæ®µè½çš„æ–‡æœ¬å†…å®¹å¿«é€Ÿè¿›è¡Œå¤åˆ¶ã€å‰ªåˆ‡ã€åˆ é™¤ã€æ’å…¥ç­‰æ“ä½œï¼Œéå¸¸æ–¹ä¾¿ã€‚åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šä¸‹å·¦å³é”®è¿›è¡Œé€‰å–ï¼Œä»¥è¿›å…¥å¯è§†åŒ–æ¨¡å¼æ—¶çš„ä½ç½®ä½œä¸ºåŸºæœ¬ä½ç½®ï¼Œé€šè¿‡ç§»åŠ¨å¦ä¸€ç«¯æ¥è¿›è¡Œé€‰å–ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¯¹é€‰ä¸­åŒºåŸŸè¿›è¡Œå„ç§æ“ä½œï¼š</p>
<ul>
<li>y   å¤åˆ¶é€‰ä¸­åŒºåŸŸ</li>
<li>d/x   å‰ªåˆ‡ï¼ˆåˆ é™¤ï¼‰é€‰ä¸­åŒºåŸŸ</li>
<li>p  ç²˜è´´</li>
<li>u  æ’¤é”€ä¸Šä¸€æ­¥</li>
</ul>
<p>å½“ç„¶ï¼Œè¿™äº›å‘½ä»¤åœ¨å‘½ä»¤æ¨¡å¼ä¸‹ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å¯è§†åŒ–æ¨¡å¼ä¸‹ä½¿ç”¨æ›´é€‚åˆä¸€äº›ã€‚</p>
<hr>
<h2 id="ç¯å¢ƒå®‰è£…å’Œé¡¹ç›®éƒ¨ç½²"><a href="#ç¯å¢ƒå®‰è£…å’Œé¡¹ç›®éƒ¨ç½²" class="headerlink" title="ç¯å¢ƒå®‰è£…å’Œé¡¹ç›®éƒ¨ç½²"></a>ç¯å¢ƒå®‰è£…å’Œé¡¹ç›®éƒ¨ç½²</h2><p>åœ¨å­¦ä¹ å®Œäº†Linuxæ“ä½œç³»ç»Ÿçš„ä¸€äº›åŸºæœ¬æ“ä½œä¹‹åï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•è¿›è¡Œé¡¹ç›®çš„ç¯å¢ƒå®‰è£…å’Œéƒ¨ç½²ï¼ŒåŒ…æ‹¬å®‰è£…JDKã€NginxæœåŠ¡å™¨ï¼Œä»¥åŠä¸Šä¼ æˆ‘ä»¬çš„SpringBooté¡¹ç›®å¹¶è¿è¡Œã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨aptè¿›è¡Œè½¯ä»¶çš„å®‰è£…ï¼Œå®ƒæ˜¯ä¸€ä¸ªé«˜çº§çš„å®‰è£…åŒ…ç®¡ç†å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¯»æ‰¾å¯¹åº”çš„è½¯ä»¶è¿›è¡Œå®‰è£…ï¼Œæ— éœ€å†å»å®˜ç½‘è¿›è¡Œä¸‹è½½ï¼Œéå¸¸æ–¹ä¾¿ï¼Œè½¯ä»¶ä»“åº“ä¸­é»˜è®¤å·²ç»å¸®åŠ©æˆ‘ä»¬å­˜æ”¾äº†å¤§é‡å®ç”¨è½¯ä»¶çš„å®‰è£…åŒ…ï¼Œåªéœ€è¦ä¸€ä¸ªå®‰è£…å‘½ä»¤å°±å¯ä»¥è¿›è¡Œå®‰è£…äº†ã€‚</p>
<p>å®é™…ä¸ŠUbuntuç³»ç»Ÿå·²ç»ä¸ºæˆ‘ä»¬è‡ªå¸¦äº†ä¸€äº›ç¯å¢ƒäº†ï¼Œæ¯”å¦‚Python3ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ python3</span><br><span class="line">Python 3.8.10 (default, Nov 26 2021, 20:14:08) </span><br><span class="line">[GCC 9.3.0] on linux</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">&gt;&gt;&gt; print(&quot;HelloWorldï¼&quot;)</span><br><span class="line">HelloWorldï¼</span><br><span class="line">&gt;&gt;&gt; exit()</span><br></pre></td></tr></table></figure>

<p>Cè¯­è¨€çš„ç¼–è¯‘å·¥å…·GCCå¯ä»¥é€šè¿‡APTè¿›è¡Œå®‰è£…ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt install gcc</span><br></pre></td></tr></table></figure>

<p>å®‰è£…åï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„Cè¯­è¨€ç¨‹åºå¹¶ä¸”ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ vim hello.c</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ gcc hello.c -o hello</span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ ./hello </span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure>

<p>è€ŒJDKå®é™…ä¸Šå®‰è£…ä¹Ÿéå¸¸ç®€å•ï¼Œé€šè¿‡APTå³å¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ sudo apt install openjdk-8-j</span><br><span class="line">openjdk-8-jdk           openjdk-8-jre           openjdk-8-jre-zero      </span><br><span class="line">openjdk-8-jdk-headless  openjdk-8-jre-headless  </span><br><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ sudo apt install openjdk-8-jdk</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ç¼–è¯‘å’Œè¿è¡Œï¼Œé¦–å…ˆç¼–å†™ä¸€ä¸ªJavaç¨‹åºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ vim Main.java</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public class Main&#123;</span><br><span class="line">        public static void main(String[] args)&#123;</span><br><span class="line">                System.out.println(&quot;Hello Worldï¼&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ javac Main.java </span><br><span class="line">test@ubuntu-server:~$ ls</span><br><span class="line">Main.class  Main.java</span><br><span class="line">test@ubuntu-server:~$ java Main </span><br><span class="line">Hello Worldï¼</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥éƒ¨ç½²ä¸€ä¸‹RedisæœåŠ¡å™¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ sudo apt install redis</span><br></pre></td></tr></table></figure>

<p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>redis-cli</code>å‘½ä»¤æ‰“å¼€Rediså®¢æˆ·ç«¯è¿æ¥æœ¬åœ°çš„æœåŠ¡å™¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ redis-cli</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or set)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å’Œä¹‹å‰Windowsä¸‹æ²¡æœ‰åŒºåˆ«ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬å®‰è£…ä¸€ä¸‹MySQLæœåŠ¡å™¨ï¼ŒåŒæ ·çš„ï¼Œç›´æ¥ä½¿ç”¨aptå³å¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt install mysql-server-8.0 </span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ç›´æ¥ç›´æ¥ç™»å½•MySQLæœåŠ¡å™¨ï¼Œæ³¨æ„è¦åœ¨rootæƒé™ä¸‹ä½¿ç”¨ï¼Œè¿™æ ·å°±ä¸ç”¨è¾“å…¥å¯†ç äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo mysql -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 11</span><br><span class="line">Server version: 8.0.27-0ubuntu0.20.04.1 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°å®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨Windowsçš„CMDä¸­ä½¿ç”¨çš„æ ·å­ï¼Œæ¥ç€æˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨çš„æ•°æ®åº“ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; create database book_manage;</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| book_manage        |</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ¥ä½¿ç”¨è¿™ä¸ªæ•°æ®ï¼Œä¸€ä¼šæˆ‘ä»¬å°±å¯ä»¥å°†SpringBooté…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹å¹¶ç›´æ¥æ”¾åˆ°æ­¤æœåŠ¡å™¨ä¸Šè¿›è¡Œéƒ¨ç½²ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; create user test identified by &#x27;123456&#x27;;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on book_manage.* to test;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè§‰å¾—è¿™æ ·å¾ˆéº»çƒ¦ä¸æ˜¯å¯è§†åŒ–çš„ï¼Œå¯ä»¥ä½¿ç”¨Navicatè¿æ¥è¿›è¡Œæ“ä½œï¼Œæ³¨æ„å¼€å¯ä¸€ä¸‹MySQLçš„å¤–ç½‘è®¿é—®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ mysql -u test -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 13</span><br><span class="line">Server version: 8.0.27-0ubuntu0.20.04.1 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2021, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| book_manage        |</span><br><span class="line">| information_schema |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨testç”¨æˆ·ç™»å½•ä¹‹åï¼ŒæŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨ï¼Œæœ‰book_manageå°±OKäº†ã€‚</p>
<p>æœ€åæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹SpringBooté¡¹ç›®çš„ç”Ÿäº§ç¯å¢ƒé…ç½®å³å¯ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.163.com</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">javastudy111@163.com</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">TKPGLAPDSWKGJOWK</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/book_manage</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line"><span class="attr">springfox:</span></span><br><span class="line">  <span class="attr">documentation:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯åŠ¨æˆ‘ä»¬çš„é¡¹ç›®ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu-server:~$ java -jar springboot-project-0.0.1-SNAPSHOT.jar </span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å°†å‰ç«¯é¡µé¢çš„APIè®¿é—®åœ°å€ä¿®æ”¹ä¸ºæˆ‘ä»¬çš„SpringBootæœåŠ¡å™¨åœ°å€ï¼Œå³å¯æ­£å¸¸ä½¿ç”¨äº†ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æˆ‘ä»¬çš„é™æ€èµ„æºä½¿ç”¨NginxæœåŠ¡å™¨è¿›è¡Œä»£ç†ï¼š</p>
<blockquote>
<p>Nginx(â€œengine xâ€)æ˜¯ä¸€æ¬¾æ˜¯ç”±ä¿„ç½—æ–¯çš„ç¨‹åºè®¾è®¡å¸ˆIgor Sysoevæ‰€å¼€å‘é«˜æ€§èƒ½çš„ Webå’Œ åå‘ä»£ç† æœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª IMAP/POP3/SMTP ä»£ç†æœåŠ¡å™¨ã€‚ åœ¨é«˜è¿æ¥å¹¶å‘çš„æƒ…å†µä¸‹ï¼ŒNginxæ˜¯ApacheæœåŠ¡å™¨ä¸é”™çš„æ›¿ä»£å“ã€‚</p>
</blockquote>
<p>Nginxéå¸¸å¼ºå¤§ï¼Œå®ƒèƒ½å¤Ÿé€šæä¾›éå¸¸æ–¹ä¾¿çš„åå‘ä»£ç†æœåŠ¡ï¼Œå¹¶ä¸”æ”¯æŒè´Ÿè½½å‡è¡¡ï¼Œä¸è¿‡æˆ‘ä»¬è¿™é‡Œç”¨ä¸€ä¸‹åå‘ä»£ç†å°±å¯ä»¥äº†ï¼Œå®é™…ä¸Šå°±æ˜¯ä»£ç†æˆ‘ä»¬çš„å‰ç«¯é¡µé¢ï¼Œç„¶åæˆ‘ä»¬è®¿é—®NginxæœåŠ¡å™¨å³å¯è®¿é—®åˆ°é™æ€èµ„æºï¼Œè¿™æ ·æˆ‘ä»¬å‰åç«¯éƒ½æ”¾åœ¨äº†æœåŠ¡å™¨ä¸Šï¼ˆä½ ä¹Ÿå¯ä»¥æä¸¤å°æœåŠ¡å™¨ï¼Œä¸€å°æŒ‚é™æ€èµ„æºä¸€å°æŒ‚SpringBootæœåŠ¡å™¨ï¼Œå®ç°çœŸæ­£æ„ä¹‰ä¸Šçš„åˆ†ç¦»ï¼Œæœ‰æ¡ä»¶çš„è¿˜èƒ½ä¸Šä¸ªåŸŸåå’Œè¯ä¹¦å•¥çš„ï¼‰ã€‚</p>
<p>å®‰è£…å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ sudo apt install nginx</span><br></pre></td></tr></table></figure>

<p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®ï¼š<a href="http://192.168.10.4/%EF%BC%8C%E8%83%BD%E5%A4%9F%E5%87%BA%E7%8E%B0Nginx%E9%A1%B5%E9%9D%A2%E8%A1%A8%E7%A4%BA%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F%EF%BC%81">http://192.168.10.4/ï¼Œèƒ½å¤Ÿå‡ºç°Nginxé¡µé¢è¡¨ç¤ºå®‰è£…æˆåŠŸï¼</a></p>
<p>æ¥ç€æˆ‘ä»¬å°†é™æ€èµ„æºä¸Šä¼ åˆ°LinuxæœåŠ¡å™¨ä¸­ï¼Œç„¶åå¯¹Nginxè¿›è¡Œåå‘ä»£ç†é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">test@ubuntu-server:~$ cd /etc/nginx/</span><br><span class="line">test@ubuntu-server:/etc/nginx$ ls</span><br><span class="line">conf.d		koi-utf     modules-available  proxy_params	sites-enabled  win-utf</span><br><span class="line">fastcgi.conf	koi-win     modules-enabled    scgi_params	snippets</span><br><span class="line">fastcgi_params	mime.types  nginx.conf	       sites-available	uwsgi_params</span><br><span class="line">test@ubuntu-server:/etc/nginx$ sudo vim nginx.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">                listen       80;</span><br><span class="line">                server_name  192.168.10.4;</span><br><span class="line">                add_header Access-Control-Allow-Origin *;</span><br><span class="line">                location / &#123;</span><br><span class="line">                        root /home/test/static;</span><br><span class="line">                        charset utf-8;</span><br><span class="line">                        add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">                        add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;;</span><br><span class="line">                        add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;*&#x27;;</span><br><span class="line">                        add_header &#x27;Access-Control-Allow-Headers&#x27; &#x27;Content-Type,*&#x27;;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¯ä»¥ç›´æ¥è®¿é—®åˆ°æˆ‘ä»¬çš„å‰ç«¯é¡µé¢äº†ï¼Œè¿™æ—¶å†å¼€å¯SpringBootæœåŠ¡å™¨å³å¯ï¼Œå¯ä»¥åœ¨æœ€åæ·»åŠ &amp;ç¬¦å·è¡¨ç¤ºåå°å¯åŠ¨ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>springBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringCloudç¬”è®°ï¼ˆå››ï¼‰</title>
    <url>/2022/05/30/SpringCloud%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/</url>
    <content><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1ahsb4tmsj21sk09iwfi.jpg" alt="image-20220415163559986"></p>
<h1 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h1><p>ç»è¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†æˆ‘ä»¬ä¹‹å‰çš„æŠ€æœ¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åº”ç”¨ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹æœ€åä¸€ç« çš„å†…å®¹ã€‚ </p>
<p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—å‘¢ï¼Ÿ </p>
<p>æˆ‘ä»¬ä¹‹å‰å¦‚æœéœ€è¦è¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œé‚£ä¹ˆä¸€èˆ¬å¯ä»¥é€šè¿‡å‘é€HTTPè¯·æ±‚æ¥å®Œæˆï¼Œè€Œç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒèƒ½å¤Ÿå°†å‘é€æ–¹å‘é€çš„ä¿¡æ¯æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œå½“æ–°çš„æ¶ˆæ¯å…¥é˜Ÿæ—¶ï¼Œä¼šé€šçŸ¥æ¥æ”¶æ–¹è¿›è¡Œå¤„ç†ï¼Œä¸€èˆ¬æ¶ˆæ¯å‘é€æ–¹ç§°ä¸ºç”Ÿäº§è€…ï¼Œæ¥æ”¶æ–¹ç§°ä¸ºæ¶ˆè´¹è€…ã€‚</p>
<span id="more"></span>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1aifat4bgj21qy0g6abi.jpg" alt="image-20220415165805716"></p>
<p>è¿™æ ·æˆ‘ä»¬æ‰€æœ‰çš„è¯·æ±‚ï¼Œéƒ½å¯ä»¥ç›´æ¥ä¸¢åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå†ç”±æ¶ˆè´¹è€…å–å‡ºï¼Œä¸å†æ˜¯ç›´æ¥è¿æ¥æ¶ˆè´¹è€…çš„å½¢å¼äº†ï¼Œè€Œæ˜¯åŠ äº†ä¸€ä¸ªä¸­é—´å•†ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„è§£è€¦æ–¹æ¡ˆï¼Œå¹¶ä¸”åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œç”±äºæ¶ˆè´¹è€…èƒ½åŠ›æœ‰é™ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿèƒ½èµ·åˆ°ä¸€ä¸ªå‰Šå³°å¡«è°·çš„ä½œç”¨ï¼Œå †ç§¯ä¸€éƒ¨åˆ†çš„è¯·æ±‚ï¼Œå†ç”±æ¶ˆè´¹è€…æ¥æ…¢æ…¢å¤„ç†ï¼Œè€Œä¸ä¼šåƒç›´æ¥è°ƒç”¨é‚£æ ·è¯·æ±‚èœ‚æ‹¥è€Œè‡³ã€‚</p>
<p>é‚£ä¹ˆï¼Œæ¶ˆæ¯é˜Ÿåˆ—å…·ä½“å®ç°æœ‰å“ªäº›å‘¢ï¼š</p>
<ul>
<li>RabbitMQ  -  æ€§èƒ½å¾ˆå¼ºï¼Œååé‡å¾ˆé«˜ï¼Œæ”¯æŒå¤šç§åè®®ï¼Œé›†ç¾¤åŒ–ï¼Œæ¶ˆæ¯çš„å¯é æ‰§è¡Œç‰¹æ€§ç­‰ä¼˜åŠ¿ï¼Œå¾ˆé€‚åˆä¼ä¸šçš„å¼€å‘ã€‚</li>
<li>Kafka - æä¾›äº†è¶…é«˜çš„ååé‡ï¼Œmsçº§åˆ«çš„å»¶è¿Ÿï¼Œæé«˜çš„å¯ç”¨æ€§ä»¥åŠå¯é æ€§ï¼Œè€Œä¸”åˆ†å¸ƒå¼å¯ä»¥ä»»æ„æ‰©å±•ã€‚</li>
<li>RocketMQ  -  é˜¿é‡Œå·´å·´æ¨å‡ºçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç»å†è¿‡åŒåä¸€çš„è€ƒéªŒï¼Œå•æœºååé‡é«˜ï¼Œæ¶ˆæ¯çš„é«˜å¯é æ€§ï¼Œæ‰©å±•æ€§å¼ºï¼Œæ”¯æŒäº‹åŠ¡ç­‰ï¼Œä½†æ˜¯åŠŸèƒ½ä¸å¤Ÿå®Œæ•´ï¼Œè¯­è¨€æ”¯æŒæ€§è¾ƒå·®ã€‚</li>
</ul>
<p>æˆ‘ä»¬è¿™é‡Œï¼Œä¸»è¦è®²è§£çš„æ˜¯RabbitMQæ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>
<h2 id="RabbitMQ-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#RabbitMQ-æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—"></a>RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—</h2><p><strong>å®˜æ–¹ç½‘ç«™ï¼š</strong><a href="https://www.rabbitmq.com/">https://www.rabbitmq.com</a></p>
<blockquote>
<p>RabbitMQæ‹¥æœ‰æ•°ä¸‡è®¡çš„ç”¨æˆ·ï¼Œæ˜¯æœ€å—æ¬¢è¿çš„å¼€æºæ¶ˆæ¯é˜Ÿåˆ—ä¹‹ä¸€ï¼Œä»<a href="https://www.youtube.com/watch?v=1qcTu2QUtrU">T-Mobile</a>åˆ°<a href="https://medium.com/@runtastic/messagebus-handling-dead-letters-in-rabbitmq-using-a-dead-letter-exchange-f070699b952b">Runtastic</a>ï¼ŒRabbitMQåœ¨å…¨çƒèŒƒå›´å†…ç”¨äºå°å‹åˆåˆ›ä¼ä¸šå’Œå¤§å‹ä¼ä¸šã€‚</p>
<p>RabbitMQè½»é‡çº§ï¼Œæ˜“äºåœ¨æœ¬åœ°å’Œäº‘ç«¯éƒ¨ç½²ï¼Œå®ƒæ”¯æŒå¤šç§æ¶ˆæ¯åè®®ã€‚RabbitMQå¯ä»¥éƒ¨ç½²åœ¨åˆ†å¸ƒå¼å’Œè”åˆé…ç½®ä¸­ï¼Œä»¥æ»¡è¶³å¤§è§„æ¨¡ã€é«˜å¯ç”¨æ€§è¦æ±‚ã€‚</p>
<p>RabbitMQåœ¨è®¸å¤šæ“ä½œç³»ç»Ÿå’Œäº‘ç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶ä¸º<a href="https://www.rabbitmq.com/devtools.html">å¤§å¤šæ•°æµè¡Œè¯­è¨€</a>æä¾›äº†<a href="https://www.rabbitmq.com/devtools.html">å¹¿æ³›çš„å¼€å‘è€…å·¥å…·</a>ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬é¦–å…ˆè¿˜æ˜¯æ¥çœ‹çœ‹å¦‚ä½•è¿›è¡Œå®‰è£…ã€‚</p>
<h3 id="å®‰è£…æ¶ˆæ¯é˜Ÿåˆ—"><a href="#å®‰è£…æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="å®‰è£…æ¶ˆæ¯é˜Ÿåˆ—"></a>å®‰è£…æ¶ˆæ¯é˜Ÿåˆ—</h3><p><strong>ä¸‹è½½åœ°å€ï¼š</strong><a href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a></p>
<p>ç”±äºé™¤äº†æ¶ˆæ¯é˜Ÿåˆ—æœ¬èº«ä¹‹å¤–è¿˜éœ€è¦Erlangç¯å¢ƒï¼ˆRabbitMQå°±æ˜¯è¿™ä¸ªè¯­è¨€å¼€å‘çš„ï¼‰æ‰€ä»¥æˆ‘ä»¬å°±åœ¨æˆ‘ä»¬çš„UbuntuæœåŠ¡å™¨ä¸Šè¿›è¡Œå®‰è£…ã€‚</p>
<p>é¦–å…ˆæ˜¯Erlangï¼Œæ¯”è¾ƒå¤§ï¼Œ1GBå·¦å³ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt install erlang</span><br></pre></td></tr></table></figure>

<p>æ¥ç€å®‰è£…RabbitMQï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt install rabbitmq-server</span><br></pre></td></tr></table></figure>

<p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥è¾“å…¥ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo rabbitmqctl status</span><br></pre></td></tr></table></figure>

<p>æ¥æŸ¥çœ‹å½“å‰çš„RabbitMQè¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬è¿è¡Œç¯å¢ƒã€å†…å­˜å ç”¨ã€æ—¥å¿—æ–‡ä»¶ç­‰ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Runtime</span><br><span class="line"></span><br><span class="line">OS PID: 13718</span><br><span class="line">OS: Linux</span><br><span class="line">Uptime (seconds): 65</span><br><span class="line">Is under maintenance?: false</span><br><span class="line">RabbitMQ version: 3.8.9</span><br><span class="line">Node name: rabbit@ubuntu-server-2</span><br><span class="line">Erlang configuration: Erlang/OTP 23 [erts-11.1.8] [source] [64-bit] [smp:2:2] [ds:2:2:10] [async-threads:64]</span><br><span class="line">Erlang processes: 280 used, 1048576 limit</span><br><span class="line">Scheduler run queue: 1</span><br><span class="line">Cluster heartbeat timeout (net_ticktime): 60</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æˆ‘ä»¬çš„RabbitMQæœåŠ¡å™¨å°±å®‰è£…å®Œæˆäº†ï¼Œè¦çœäº‹è¿˜å¾—æ˜¯Ubuntuå•Šã€‚</p>
<p>å¯ä»¥çœ‹åˆ°é»˜è®¤æœ‰ä¸¤ä¸ªç«¯å£åè¢«ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Listeners</span><br><span class="line"></span><br><span class="line">Interface: [::], port: 25672, protocol: clustering, purpose: inter-node and CLI tool communication</span><br><span class="line">Interface: [::], port: 5672, protocol: amqp, purpose: AMQP 0-9-1 and AMQP 1.0</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸€ä¼šä¸»è¦ä½¿ç”¨çš„å°±æ˜¯amqpåè®®çš„é‚£ä¸ªç«¯å£<code>5672</code>æ¥è¿›è¡Œè¿æ¥ï¼Œ25672æ˜¯é›†ç¾¤åŒ–ç«¯å£ï¼Œä¹‹åæˆ‘ä»¬ä¹Ÿä¼šç”¨åˆ°ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬è¿˜å¯ä»¥å°†RabbitMQçš„ç®¡ç†é¢æ¿å¼€å¯ï¼Œè¿™æ ·è¯å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè¿›è¡Œå®æ—¶è®¿é—®å’Œç›‘æ§äº†ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡æŸ¥çœ‹çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ªç®¡ç†é¢æ¿ï¼Œä½¿ç”¨çš„æ˜¯HTTPåè®®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Listeners</span><br><span class="line"></span><br><span class="line">Interface: [::], port: 25672, protocol: clustering, purpose: inter-node and CLI tool communication</span><br><span class="line">Interface: [::], port: 5672, protocol: amqp, purpose: AMQP 0-9-1 and AMQP 1.0</span><br><span class="line">Interface: [::], port: 15672, protocol: http, purpose: HTTP API</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ç›´æ¥è®¿é—®ä¸€ä¸‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1aooi1nvwj21q20ea75e.jpg" alt="image-20220415203431587"></p>
<p>å¯ä»¥çœ‹åˆ°éœ€è¦æˆ‘ä»¬è¿›è¡Œç™»å½•æ‰å¯ä»¥è¿›å…¥ï¼Œæˆ‘ä»¬è¿™é‡Œè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ‰å¯ä»¥ï¼Œè¿™é‡Œå°±éƒ½ç”¨adminï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo rabbitmqctl add_user ç”¨æˆ·å å¯†ç </span><br></pre></td></tr></table></figure>

<p>å°†ç®¡ç†å‘˜æƒé™ç»™äºˆæˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„ç”¨æˆ·ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo rabbitmqctl set_user_tags admin administrator</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç™»å½•ä¸€ä¸‹é¡µé¢ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1aorkpn72j225s0u0wj3.jpg" alt="image-20220415203728664"></p>
<p>è¿›å…¥äº†ä¹‹åä¼šæ˜¾ç¤ºå½“å‰çš„æ¶ˆæ¯é˜Ÿåˆ—æƒ…å†µï¼ŒåŒ…æ‹¬ç‰ˆæœ¬å·ã€Erlangç‰ˆæœ¬ç­‰ï¼Œè¿™é‡Œéœ€è¦ä»‹ç»ä¸€ä¸‹RabbitMQçš„è®¾è®¡æ¶æ„ï¼Œè¿™æ ·æˆ‘ä»¬å°±çŸ¥é“å„ä¸ªæ¨¡å—ç®¡ç†çš„æ˜¯ä»€ä¹ˆå†…å®¹äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1bcul1hzzj21r40iogq3.jpg" alt="image-20220416103043845"></p>
<ul>
<li><strong>ç”Ÿäº§è€…ï¼ˆPublisherï¼‰å’Œæ¶ˆè´¹è€…ï¼ˆConsumerï¼‰ï¼š</strong>ä¸ç”¨å¤šè¯´äº†å§ã€‚</li>
<li><strong>Channelï¼š</strong>æˆ‘ä»¬çš„å®¢æˆ·ç«¯è¿æ¥éƒ½ä¼šä½¿ç”¨ä¸€ä¸ªChannelï¼Œå†é€šè¿‡Channelå»è®¿é—®åˆ°RabbitMQæœåŠ¡å™¨ï¼Œæ³¨æ„é€šä¿¡åè®®ä¸æ˜¯httpï¼Œè€Œæ˜¯amqpåè®®ã€‚</li>
<li><strong>Exchangeï¼š</strong>ç±»ä¼¼äºäº¤æ¢æœºä¸€æ ·çš„å­˜åœ¨ï¼Œä¼šæ ¹æ®æˆ‘ä»¬çš„è¯·æ±‚ï¼Œè½¬å‘ç»™ç›¸åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—éƒ½å¯ä»¥ç»‘å®šåˆ°Exchangeä¸Šï¼Œè¿™æ ·Exchangeå°±å¯ä»¥å°†æ•°æ®è½¬å‘ç»™é˜Ÿåˆ—äº†ï¼Œå¯ä»¥å­˜åœ¨å¾ˆå¤šä¸ªï¼Œä¸åŒçš„Exchangeç±»å‹å¯ä»¥ç”¨äºå®ç°ä¸åŒæ¶ˆæ¯çš„æ¨¡å¼ã€‚</li>
<li><strong>Queueï¼š</strong>æ¶ˆæ¯é˜Ÿåˆ—æœ¬ä½“ï¼Œç”Ÿäº§è€…æ‰€æœ‰çš„æ¶ˆæ¯éƒ½å­˜æ”¾åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…å–å‡ºã€‚</li>
<li><strong>Virtual Hostï¼š</strong>æœ‰ç‚¹ç±»ä¼¼äºç¯å¢ƒéš”ç¦»ï¼Œä¸åŒç¯å¢ƒéƒ½å¯ä»¥å•ç‹¬é…ç½®ä¸€ä¸ªVirtual Hostï¼Œæ¯ä¸ªVirtual Hostå¯ä»¥åŒ…å«å¾ˆå¤šä¸ªExchangeå’ŒQueueï¼Œæ¯ä¸ªVirtual Hostç›¸äº’ä¹‹é—´ä¸å½±å“ã€‚</li>
</ul>
<h3 id="ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—"><a href="#ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—"></a>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</h3><p>æˆ‘ä»¬å°±ä»æœ€ç®€çš„çš„æ¨¡å‹å¼€å§‹è®²èµ·ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1cin640c8j21fg06ajrh.jpg" alt="image-20220417103647609"></p>
<p>ï¼ˆä¸€ä¸ªç”Ÿäº§è€… -&gt; æ¶ˆæ¯é˜Ÿåˆ— -&gt; ä¸€ä¸ªæ¶ˆè´¹è€…ï¼‰</p>
<p>ç”Ÿäº§è€…åªéœ€è¦å°†æ•°æ®ä¸¢è¿›æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œæ¶ˆè´¹è€…åªéœ€è¦å°†æ•°æ®ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºï¼Œè¿™æ ·å°±å®ç°äº†ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„æ¶ˆæ¯äº¤äº’ã€‚æˆ‘ä»¬ç°åœ¨æ¥æ¼”ç¤ºä¸€ä¸‹ï¼Œé¦–å…ˆè¿›å…¥åˆ°æˆ‘ä»¬çš„ç®¡ç†é¡µé¢ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å®éªŒç¯å¢ƒï¼Œåªéœ€è¦æ–°å»ºä¸€ä¸ªVirtual Hostå³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f0mpm7o2j22cw0kaq5s.jpg" alt="image-20220419143014974"></p>
<p>æ·»åŠ æ–°çš„è™šæ‹Ÿä¸»æœºä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰adminç”¨æˆ·çš„ä¸»æœºè®¿é—®æƒé™ä¸­æ–°å¢äº†æˆ‘ä»¬åˆšåˆšæ·»åŠ çš„ç¯å¢ƒï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f0nrhztlj22cu0eqjt5.jpg" alt="image-20220419143115507"></p>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹äº¤æ¢æœºï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f0q92geqj21x70u0wix.jpg" alt="image-20220419143338487"></p>
<p>äº¤æ¢æœºåˆ—è¡¨ä¸­è‡ªåŠ¨ä¸ºæˆ‘ä»¬æ–°å¢äº†åˆšåˆšåˆ›å»ºå¥½çš„è™šæ‹Ÿä¸»æœºç›¸å…³çš„é¢„è®¾äº¤æ¢æœºï¼Œä¸€å…±7ä¸ªï¼Œè¿™é‡Œæˆ‘ä»¬é¦–å…ˆä»‹ç»ä¸€ä¸‹å‰é¢ä¸¤ä¸ª<code>direct</code>ç±»å‹çš„äº¤æ¢æœºï¼Œä¸€ä¸ªæ˜¯<code>ï¼ˆAMQP defaultï¼‰</code>è¿˜æœ‰ä¸€ä¸ªæ˜¯<code>amq.direct</code>ï¼Œå®ƒä»¬éƒ½æ˜¯ç›´è¿æ¨¡å¼çš„äº¤æ¢æœºï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬ä¸€ä¸ªï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f0sx1l24j22cm0j80v9.jpg" alt="image-20220419143612318"></p>
<p>ç¬¬ä¸€ä¸ªäº¤æ¢æœºæ˜¯æ‰€æœ‰è™šæ‹Ÿä¸»æœºéƒ½ä¼šè‡ªå¸¦çš„ä¸€ä¸ªé»˜è®¤äº¤æ¢æœºï¼Œå¹¶ä¸”æ­¤äº¤æ¢æœºä¸å¯åˆ é™¤ï¼Œæ­¤äº¤æ¢æœºé»˜è®¤ç»‘å®šåˆ°æ‰€æœ‰çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æœæ˜¯é€šè¿‡é»˜è®¤äº¤æ¢æœºå‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆä¼šæ ¹æ®æ¶ˆæ¯çš„<code>routingKey</code>ï¼ˆä¹‹åæˆ‘ä»¬å‘æ¶ˆæ¯éƒ½ä¼šæŒ‡å®šï¼‰å†³å®šå‘é€ç»™å“ªä¸ªåŒåçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¹Ÿä¸èƒ½æ˜¾ç¤ºåœ°å°†æ¶ˆæ¯é˜Ÿåˆ—ç»‘å®šæˆ–è§£ç»‘åˆ°æ­¤äº¤æ¢æœºã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¯¦ç»†ä¿¡æ¯ä¸­ï¼Œå½“å‰äº¤æ¢æœºç‰¹æ€§æ˜¯æŒä¹…åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å°±ç®—æœºå™¨é‡å¯ï¼Œé‚£ä¹ˆæ­¤äº¤æ¢æœºä¹Ÿä¼šä¿ç•™ï¼Œå¦‚æœä¸æ˜¯æŒä¹…åŒ–ï¼Œé‚£ä¹ˆä¸€æ—¦é‡å¯å°±ä¼šæ¶ˆå¤±ã€‚å®é™…ä¸Šæˆ‘ä»¬åœ¨åˆ—è¡¨ä¸­çœ‹åˆ°<code>D</code>çš„å­—æ ·ï¼Œå°±è¡¨ç¤ºæ­¤äº¤æ¢æœºæ˜¯æŒä¹…åŒ–çš„ï¼ŒåŒ…å«ä¸€ä¼šæˆ‘ä»¬è¦è®²è§£çš„æ¶ˆæ¯é˜Ÿåˆ—åˆ—è¡¨ä¹Ÿæ˜¯è¿™æ ·ï¼Œæ‰€æœ‰è‡ªåŠ¨ç”Ÿæˆçš„äº¤æ¢æœºéƒ½æ˜¯æŒä¹…åŒ–çš„ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹ç¬¬äºŒä¸ªäº¤æ¢æœºï¼Œè¿™ä¸ªäº¤æ¢æœºæ˜¯ä¸€ä¸ªæ™®é€šçš„ç›´è¿äº¤æ¢æœºï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f0yya0xgj22810u0412.jpg" alt="image-20220419144200533"></p>
<p>è¿™ä¸ªäº¤æ¢æœºå’Œæˆ‘ä»¬åˆšåˆšä»‹ç»çš„é»˜è®¤äº¤æ¢æœºç±»å‹ä¸€è‡´ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æŒä¹…åŒ–çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒæ˜¯å…·æœ‰ç»‘å®šå…³ç³»çš„ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šçš„æ¶ˆæ¯é˜Ÿåˆ—ç»‘å®šåˆ°æ­¤äº¤æ¢æœºä¸Šï¼Œé‚£ä¹ˆè¿™ä¸ªäº¤æ¢æœºæ— æ³•æ­£å¸¸å°†ä¿¡æ¯å­˜æ”¾åˆ°æŒ‡å®šçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œä¹Ÿæ˜¯æ ¹æ®<code>routingKey</code>å¯»æ‰¾æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä½†æ˜¯å¯ä»¥è‡ªå®šä¹‰ï¼‰</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸‹é¢ç›´æ¥æ“ä½œï¼Œè®©æŸä¸ªé˜Ÿåˆ—ç»‘å®šï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆä¸è¿›è¡Œæ“ä½œã€‚</p>
<p>ä»‹ç»å®Œäº†ä¸¤ä¸ªæœ€åŸºæœ¬çš„äº¤æ¢æœºä¹‹åï¼ˆå…¶ä»–ç±»å‹çš„äº¤æ¢æœºæˆ‘ä»¬ä¼šåœ¨åé¢è¿›è¡Œä»‹ç»ï¼‰ï¼Œæˆ‘ä»¬æ¥ç€æ¥çœ‹æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f127q11qj22em0deta1.jpg" alt="image-20220419144508881"></p>
<p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯é˜Ÿåˆ—åˆ—è¡¨ä¸­æ²¡æœ‰ä»»ä½•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥æ¥å°è¯•æ·»åŠ ä¸€ä¸ªæ–°çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f12zs6hxj22cg0i60uv.jpg" alt="image-20220419144553817"></p>
<p>ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬é€‰æ‹©æˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„è™šæ‹Ÿä¸»æœºï¼Œåœ¨è¿™ä¸ªè™šæ‹Ÿä¸»æœºä¸‹åˆ›å»ºæ­¤æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥ç€æˆ‘ä»¬å°†å…¶ç±»å‹å®šä¹‰ä¸º<code>Classic</code>ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ç»å…¸ç±»å‹ï¼ˆå…¶ä»–ç±»å‹æˆ‘ä»¬ä¼šåœ¨åé¢é€æ­¥ä»‹ç»ï¼‰åç§°éšä¾¿èµ·ä¸€ä¸ªï¼Œç„¶åæŒä¹…åŒ–æˆ‘ä»¬é€‰æ‹©<code>Transient</code>æš‚æ—¶çš„ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æŒä¹…åŒ–ï¼Œçœ‹ä½ è‡ªå·±ï¼‰è‡ªåŠ¨åˆ é™¤æˆ‘ä»¬é€‰æ‹©<code>No</code>ï¼ˆéœ€è¦è‡³å°‘æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è¿æ¥åˆ°è¿™ä¸ªé˜Ÿåˆ—ï¼Œä¹‹åï¼Œä¸€æ—¦æ‰€æœ‰ä¸è¿™ä¸ªé˜Ÿåˆ—è¿æ¥çš„æ¶ˆè´¹è€…éƒ½æ–­å¼€æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—ï¼‰æœ€ä¸‹é¢çš„å‚æ•°æˆ‘ä»¬æš‚æ—¶ä¸è¿›è¡Œä»»ä½•è®¾ç½®ï¼ˆä¹‹åä¼šç”¨åˆ°ï¼‰</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±åˆ›å»ºå¥½äº†ä¸€ä¸ªç»å…¸çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f18gv4xoj22d80dy40j.jpg" alt="image-20220419145109450"></p>
<p>ç‚¹å‡»æ­¤é˜Ÿåˆ—çš„åç§°ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1a07outj22cu0o6tc5.jpg" alt="image-20220419145238458"></p>
<p>è¯¦ç»†ç›¸ä¿¡ä¸­åŒ…æ‹¬é˜Ÿåˆ—çš„å½“å‰è´Ÿè½½çŠ¶æ€ã€å±æ€§ã€æ¶ˆæ¯é˜Ÿåˆ—å ç”¨çš„å†…å­˜ï¼Œæ¶ˆæ¯æ•°é‡ç­‰ï¼Œä¸€ä¼šæˆ‘ä»¬å‘é€æ¶ˆæ¯æ—¶å¯ä»¥è¿›ä¸€æ­¥è¿›è¡Œè§‚å¯Ÿã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦å°†æ­¤æ¶ˆæ¯é˜Ÿåˆ—ç»‘å®šåˆ°ä¸Šé¢çš„ç¬¬äºŒä¸ªç›´è¿äº¤æ¢æœºï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ­¤äº¤æ¢æœºå‘æ­¤æ¶ˆæ¯é˜Ÿåˆ—å‘é€æ¶ˆæ¯äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1ctvnhmj22da0im75w.jpg" alt="image-20220419145520844"></p>
<p>è¿™é‡Œå¡«å†™ä¹‹å‰ç¬¬äºŒä¸ªäº¤æ¢æœºçš„åç§°è¿˜æœ‰æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>routingKey</code>ï¼ˆæœ€å¥½è¿˜æ˜¯å’Œæ¶ˆæ¯é˜Ÿåˆ—åç§°ä¸€è‡´ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†ä¸€ä¼šæ¼”ç¤ºä¸¤ä¸ªäº¤æ¢æœºåŒºåˆ«ç”¨ï¼‰æˆ‘ä»¬ç›´æ¥ç‚¹å‡»ç»‘å®šå³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1e42r9cj21rg0bumxv.jpg" alt="image-20220419145635179"></p>
<p>ç»‘å®šä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“å‰é˜Ÿåˆ—å·²ç»ç»‘å®šå¯¹åº”çš„äº¤æ¢æœºäº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å‰å¾€äº¤æ¢æœºå¯¹æ­¤æ¶ˆæ¯é˜Ÿåˆ—å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1ez7m11j22da0os0v4.jpg" alt="image-20220419145725499"></p>
<p>å›åˆ°äº¤æ¢æœºä¹‹åï¼Œå¯ä»¥å¡åˆ°è¿™è¾¹ä¹Ÿæ˜¯åŒæ­¥äº†å½“å‰çš„ç»‘å®šä¿¡æ¯ï¼Œåœ¨ä¸‹æ–¹ï¼Œæˆ‘ä»¬ç›´æ¥å‘æ­¤æ¶ˆæ¯é˜Ÿåˆ—å‘é€ä¿¡æ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1fq3w0zj22e40l6abl.jpg" alt="image-20220419145808450"></p>
<p>ç‚¹å‡»å‘é€ä¹‹åï¼Œæˆ‘ä»¬å›åˆ°åˆšåˆšçš„äº¤æ¢æœºè¯¦ç»†é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æœ‰ä¸€æ¡æ–°çš„æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1gojajxj22cw0lo0vh.jpg" alt="image-20220419145903723"></p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ¶ˆæ¯é˜Ÿåˆ—è¿™è¾¹è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œæ‰¾åˆ°ä¸‹æ–¹çš„Get messageé€‰é¡¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1h8qcnhj21q80ccmy4.jpg" alt="image-20220419145936160"></p>
<p>å¯ä»¥çœ‹åˆ°æœ‰ä¸‰ä¸ªé€‰æ‹©ï¼Œé¦–å…ˆç¬¬ä¸€ä¸ªAck Modeï¼Œè¿™ä¸ªæ˜¯åº”ç­”æ¨¡å¼é€‰æ‹©ï¼Œä¸€å…±æœ‰4ä¸ªé€‰é¡¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1im04y6j214g05a3yv.jpg" alt="image-20220419150053926"></p>
<ul>
<li>Nack message requeue trueï¼šæ‹’ç»æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šå°†æ¶ˆæ¯ä»æ¶ˆæ¯é˜Ÿåˆ—å–å‡ºï¼Œå¹¶ä¸”é‡æ–°æ’é˜Ÿï¼Œä¸€æ¬¡å¯ä»¥æ‹’ç»å¤šä¸ªæ¶ˆæ¯ã€‚</li>
<li>Ack message requeue falseï¼šç¡®è®¤åº”ç­”ï¼Œç¡®è®¤åæ¶ˆæ¯ä¼šä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œä¸€æ¬¡å¯ä»¥ç¡®è®¤å¤šä¸ªæ¶ˆæ¯ã€‚</li>
<li>Reject message requeue true/falseï¼šä¹Ÿæ˜¯æ‹’ç»æ­¤æ¶ˆæ¯ï¼Œä½†æ˜¯å¯ä»¥æŒ‡å®šæ˜¯å¦é‡æ–°æ’é˜Ÿã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨é»˜è®¤çš„å°±å¯ä»¥äº†ï¼Œè¿™æ ·åªä¼šæŸ¥çœ‹æ¶ˆæ¯æ˜¯å•¥ï¼Œä½†æ˜¯ä¸ä¼šå–å‡ºï¼Œæ¶ˆæ¯ä¾ç„¶å­˜åœ¨äºæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç¼–ç æ ¼å¼ï¼Œä½¿ç”¨é»˜è®¤çš„å°±å¯ä»¥äº†ï¼Œæœ€åå°±æ˜¯è¦ç”Ÿæ•ˆçš„æ“ä½œæ•°é‡ï¼Œé€‰æ‹©1å°±è¡Œï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1p61hjcj21l20di758.jpg" alt="image-20220419150712314"></p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšåˆšçš„æ¶ˆæ¯å·²ç»æˆåŠŸè¯»å–åˆ°ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å†å»ç¬¬ä¸€ä¸ªé»˜è®¤äº¤æ¢æœºä¸­å°è¯•å‘é€æ¶ˆæ¯è¯•è¯•çœ‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1r9rzvbj21ha07m74n.jpg" alt="image-20220419150913859"></p>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¹‹å‰è‡ªå®šä¹‰çš„<code>routingKey</code>ï¼Œä¼šæ˜¾ç¤ºæ²¡æœ‰è·¯ç”±ï¼Œè¿™æ˜¯å› ä¸ºé»˜è®¤çš„äº¤æ¢æœºåªä¼šæ‰¾å¯¹åº”åç§°çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬ç°åœ¨å‘<code>yyds</code>å‘é€ä¸€ä¸‹è¯•è¯•çœ‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1sdaa6bj21dk064wek.jpg" alt="image-20220419151016735"></p>
<p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯æˆåŠŸå‘å¸ƒäº†ï¼Œæˆ‘ä»¬æ¥æ¥æ”¶ä¸€ä¸‹çœ‹çœ‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1t2qdtmj221c0lymz8.jpg" alt="image-20220419151058659"></p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸå‘é€åˆ°æ­¤æ¶ˆæ¯é˜Ÿåˆ—ä¸­äº†ã€‚</p>
<p>å½“ç„¶é™¤äº†åœ¨äº¤æ¢æœºå‘é€æ¶ˆæ¯ç»™æ¶ˆæ¯é˜Ÿåˆ—ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ¶ˆæ¯é˜Ÿåˆ—è¿™é‡Œå‘ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1u2nhz7j21xc0lwq4g.jpg" alt="image-20220419151155264"></p>
<p>æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œæ³¨æ„è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ˜¯å¦å°†æ¶ˆæ¯æŒä¹…åŒ–ï¼Œå¦‚æœæ˜¯æŒä¹…åŒ–æ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±ç®—æœåŠ¡å™¨é‡å¯ï¼Œæ­¤æ¶ˆæ¯ä¹Ÿä¼šä¿å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</p>
<p>æœ€åå¦‚æœæˆ‘ä»¬ä¸éœ€è¦å†ä½¿ç”¨æ­¤æ¶ˆæ¯é˜Ÿåˆ—äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å¯¹å…¶è¿›è¡Œåˆ é™¤æˆ–æ˜¯æ¸…ç©ºï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f1y44f9dj21lu096t90.jpg" alt="image-20220419151548923"></p>
<p>ç‚¹å‡»Delete Queueåˆ é™¤æˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„<code>yyds</code>é˜Ÿåˆ—ï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹åº”æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€äº›ç®€å•ä½¿ç”¨ï¼Œå°±è®²è§£å®Œæ¯•äº†ã€‚</p>
<h3 id="ä½¿ç”¨Javaæ“ä½œæ¶ˆæ¯é˜Ÿåˆ—"><a href="#ä½¿ç”¨Javaæ“ä½œæ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="ä½¿ç”¨Javaæ“ä½œæ¶ˆæ¯é˜Ÿåˆ—"></a>ä½¿ç”¨Javaæ“ä½œæ¶ˆæ¯é˜Ÿåˆ—</h3><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡Javaè¿æ¥åˆ°RabbitMQæœåŠ¡å™¨å¹¶ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œæ¶ˆæ¯å‘é€ï¼ˆè¿™é‡Œä¸€èµ·è®²è§£ï¼ŒåŒ…æ‹¬JavaåŸºç¡€ç‰ˆæœ¬å’ŒSpringBootç‰ˆæœ¬ï¼‰ï¼Œé¦–å…ˆæˆ‘ä»¬ä½¿ç”¨æœ€åŸºæœ¬çš„Javaå®¢æˆ·ç«¯è¿æ¥æ–¹å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.14.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¾èµ–å¯¼å…¥ä¹‹åï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œé¦–å…ˆæ˜¯ç”Ÿäº§è€…ï¼Œç”Ÿäº§è€…è´Ÿè´£å°†ä¿¡æ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//ä½¿ç”¨ConnectionFactoryæ¥åˆ›å»ºè¿æ¥</span></span><br><span class="line">    <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾å®šè¿æ¥ä¿¡æ¯ï¼ŒåŸºæ“</span></span><br><span class="line">    factory.setHost(<span class="string">&quot;192.168.0.12&quot;</span>);</span><br><span class="line">    factory.setPort(<span class="number">5672</span>);  <span class="comment">//æ³¨æ„è¿™é‡Œå†™5672ï¼Œæ˜¯amqpåè®®ç«¯å£</span></span><br><span class="line">    factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    factory.setVirtualHost(<span class="string">&quot;/test&quot;</span>);</span><br><span class="line">  </span><br><span class="line"> 		<span class="comment">//åˆ›å»ºè¿æ¥</span></span><br><span class="line">    <span class="keyword">try</span>(<span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection())&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ç¨‹åºä¸­å®šä¹‰å¹¶åˆ›å»ºæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå®é™…ä¸Šæ˜¯å’Œæˆ‘ä»¬åœ¨ç®¡ç†é¡µé¢åˆ›å»ºä¸€æ ·çš„æ•ˆæœï¼‰å®¢æˆ·ç«¯éœ€è¦é€šè¿‡è¿æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„é€šé“ï¼ˆChannelï¼‰ï¼ŒåŒä¸€ä¸ªè¿æ¥ä¸‹å¯ä»¥æœ‰å¾ˆå¤šä¸ªé€šé“ï¼Œè¿™æ ·å°±ä¸ç”¨åˆ›å»ºå¾ˆå¤šä¸ªè¿æ¥ä¹Ÿèƒ½æ”¯æŒåˆ†å¼€å‘é€äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>(<span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel())&#123;   <span class="comment">//é€šè¿‡Connectionåˆ›å»ºæ–°çš„Channel</span></span><br><span class="line">  	<span class="comment">//å£°æ˜é˜Ÿåˆ—ï¼Œå¦‚æœæ­¤é˜Ÿåˆ—ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line">    channel.queueDeclare(<span class="string">&quot;yyds&quot;</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">  	<span class="comment">//å°†é˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢æœº</span></span><br><span class="line">    channel.queueBind(<span class="string">&quot;yyds&quot;</span>, <span class="string">&quot;amq.direct&quot;</span>, <span class="string">&quot;my-yyds&quot;</span>);</span><br><span class="line">  	<span class="comment">//å‘å¸ƒæ–°çš„æ¶ˆæ¯ï¼Œæ³¨æ„æ¶ˆæ¯éœ€è¦è½¬æ¢ä¸ºbyte[]</span></span><br><span class="line">    channel.basicPublish(<span class="string">&quot;amq.direct&quot;</span>, <span class="string">&quot;my-yyds&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;Hello World!&quot;</span>.getBytes());</span><br><span class="line">&#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>queueDeclare</code>æ–¹æ³•çš„å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>queueï¼šé˜Ÿåˆ—çš„åç§°ï¼ˆé»˜è®¤åˆ›å»ºåroutingKeyå’Œé˜Ÿåˆ—åç§°ä¸€è‡´ï¼‰</li>
<li>durableï¼šæ˜¯å¦æŒä¹…åŒ–ã€‚</li>
<li>exclusiveï¼šæ˜¯å¦æ’ä»–ï¼Œå¦‚æœä¸€ä¸ªé˜Ÿåˆ—è¢«å£°æ˜ä¸ºæ’ä»–é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä»…å¯¹é¦–æ¬¡å£°æ˜å®ƒçš„è¿æ¥å¯è§ï¼Œå¹¶åœ¨è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤ã€‚æ’ä»–é˜Ÿåˆ—æ˜¯åŸºäºConnectionå¯è§ï¼ŒåŒä¸€ä¸ªConnectionçš„ä¸åŒChannelæ˜¯å¯ä»¥åŒæ—¶è®¿é—®åŒä¸€ä¸ªè¿æ¥åˆ›å»ºçš„æ’ä»–é˜Ÿåˆ—ï¼Œå¹¶ä¸”ï¼Œå¦‚æœä¸€ä¸ªConnectionå·²ç»å£°æ˜äº†ä¸€ä¸ªæ’ä»–é˜Ÿåˆ—ï¼Œå…¶ä»–çš„Connectionæ˜¯ä¸å…è®¸å»ºç«‹åŒåçš„æ’ä»–é˜Ÿåˆ—çš„ï¼Œå³ä½¿è¯¥é˜Ÿåˆ—æ˜¯æŒä¹…åŒ–çš„ï¼Œä¸€æ—¦Connectionå…³é—­æˆ–è€…å®¢æˆ·ç«¯é€€å‡ºï¼Œè¯¥æ’ä»–é˜Ÿåˆ—éƒ½ä¼šè‡ªåŠ¨è¢«åˆ é™¤ã€‚</li>
<li>autoDeleteï¼šæ˜¯å¦è‡ªåŠ¨åˆ é™¤ã€‚</li>
<li>argumentsï¼šè®¾ç½®é˜Ÿåˆ—çš„å…¶ä»–ä¸€äº›å‚æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬æš‚æ—¶ä¸éœ€è¦ä»€ä¹ˆå…¶ä»–å‚æ•°ã€‚</li>
</ul>
<p>å…¶ä¸­<code>queueBind</code>æ–¹æ³•å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>queueï¼šéœ€è¦ç»‘å®šçš„é˜Ÿåˆ—åç§°ã€‚</li>
<li>exchangeï¼šéœ€è¦ç»‘å®šçš„äº¤æ¢æœºåç§°ã€‚</li>
<li>routingKeyï¼šä¸ç”¨å¤šè¯´äº†å§ã€‚</li>
</ul>
<p>å…¶ä¸­<code>basicPublish</code>æ–¹æ³•çš„å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>exchange: å¯¹åº”çš„Exchangeåç§°ï¼Œæˆ‘ä»¬è¿™é‡Œå°±ä½¿ç”¨ç¬¬äºŒä¸ªç›´è¿äº¤æ¢æœºã€‚</li>
<li>routingKeyï¼šè¿™é‡Œæˆ‘ä»¬å¡«å†™ç»‘å®šæ—¶æŒ‡å®šçš„routingKeyï¼Œå…¶å®å’Œä¹‹å‰åœ¨ç®¡ç†é¡µé¢æ“ä½œä¸€æ ·ã€‚</li>
<li>propsï¼šå…¶ä»–çš„é…ç½®ã€‚</li>
<li>bodyï¼šæ¶ˆæ¯æœ¬ä½“ã€‚</li>
</ul>
<p>æ‰§è¡Œå®Œæˆåï¼Œå¯ä»¥åœ¨ç®¡ç†é¡µé¢ä¸­çœ‹åˆ°æˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„æ¶ˆæ¯é˜Ÿåˆ—äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f2jnj0jzj22dc0de0ui.jpg" alt="image-20220419153630431"></p>
<p>å¹¶ä¸”æ­¤æ¶ˆæ¯é˜Ÿåˆ—å·²ç»æˆåŠŸä¸<code>amq.direct</code>äº¤æ¢æœºè¿›è¡Œç»‘å®šï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f2tup1pmj21pa0bowf9.jpg" alt="image-20220419154618613"></p>
<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­å·²ç»å­˜åœ¨æ•°æ®äº†ï¼Œæ€ä¹ˆå°†å…¶è¯»å–å‡ºæ¥å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">    <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">    factory.setHost(<span class="string">&quot;10.37.129.4&quot;</span>);</span><br><span class="line">    factory.setPort(<span class="number">5672</span>);</span><br><span class="line">    factory.setUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    factory.setPassword(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    factory.setVirtualHost(<span class="string">&quot;/test&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™é‡Œä¸ä½¿ç”¨try-with-resourceï¼Œå› ä¸ºæ¶ˆè´¹è€…æ˜¯ä¸€ç›´ç­‰å¾…æ–°çš„æ¶ˆæ¯åˆ°æ¥ï¼Œç„¶åæŒ‰ç…§</span></span><br><span class="line">    <span class="comment">//æˆ‘ä»¬è®¾å®šçš„é€»è¾‘è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½åœ¨å®šä¹‰å®Œæˆä¹‹åå°±å…³é—­è¿æ¥</span></span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„æ¶ˆè´¹è€…</span></span><br><span class="line">    channel.basicConsume(<span class="string">&quot;yyds&quot;</span>, <span class="literal">false</span>, (s, delivery) -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(delivery.getBody()));</span><br><span class="line">        <span class="comment">//basicAckæ˜¯ç¡®è®¤åº”ç­”ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å½“å‰çš„æ¶ˆæ¯æ ‡ç­¾ï¼Œåé¢çš„å‚æ•°æ˜¯</span></span><br><span class="line">        <span class="comment">//æ˜¯å¦æ‰¹é‡å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„æ¶ˆæ¯ï¼Œå¦‚æœä¸ºfalseè¡¨ç¤ºåªå¤„ç†å½“å‰æ¶ˆæ¯</span></span><br><span class="line">        channel.basicAck(delivery.getEnvelope().getDeliveryTag(), <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//basicNackæ˜¯æ‹’ç»åº”ç­”ï¼Œæœ€åä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦å°†å½“å‰æ¶ˆæ¯æ”¾å›é˜Ÿåˆ—ï¼Œå¦‚æœ</span></span><br><span class="line">        <span class="comment">//ä¸ºfalseï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¼šè¢«ä¸¢å¼ƒ</span></span><br><span class="line">        <span class="comment">//channel.basicNack(delivery.getEnvelope().getDeliveryTag(), false, false);</span></span><br><span class="line">        <span class="comment">//è·Ÿä¸Šé¢ä¸€æ ·ï¼Œæœ€åä¸€ä¸ªå‚æ•°ä¸ºfalseï¼Œåªä¸è¿‡è¿™é‡Œçœäº†</span></span><br><span class="line">        <span class="comment">//channel.basicReject(delivery.getEnvelope().getDeliveryTag(), false);</span></span><br><span class="line">    &#125;, s -&gt; &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>basicConsume</code>æ–¹æ³•å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>queue  -  æ¶ˆæ¯é˜Ÿåˆ—åç§°ï¼Œç›´æ¥æŒ‡å®šã€‚</li>
<li>autoAck - è‡ªåŠ¨åº”ç­”ï¼Œæ¶ˆè´¹è€…ä»æ¶ˆæ¯é˜Ÿåˆ—å–å‡ºæ•°æ®åï¼Œéœ€è¦è·ŸæœåŠ¡å™¨è¿›è¡Œç¡®è®¤åº”ç­”ï¼Œå½“æœåŠ¡å™¨æ”¶åˆ°ç¡®è®¤åï¼Œä¼šè‡ªåŠ¨å°†æ¶ˆæ¯åˆ é™¤ï¼Œå¦‚æœå¼€å¯è‡ªåŠ¨åº”ç­”ï¼Œé‚£ä¹ˆæ¶ˆæ¯å‘å‡ºåä¼šç›´æ¥åˆ é™¤ã€‚</li>
<li>deliver  -  æ¶ˆæ¯æ¥æ”¶åçš„å‡½æ•°å›è°ƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å›è°ƒä¸­å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œæˆåï¼Œéœ€è¦ç»™æœåŠ¡å™¨ç¡®è®¤åº”ç­”ã€‚</li>
<li>cancel  -  å½“æ¶ˆè´¹è€…å–æ¶ˆè®¢é˜…æ—¶è¿›è¡Œçš„å‡½æ•°å›è°ƒï¼Œè¿™é‡Œæš‚æ—¶ç”¨ä¸åˆ°ã€‚</li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬å¯åŠ¨ä¸€ä¸‹æ¶ˆè´¹è€…ï¼Œå¯ä»¥çœ‹åˆ°ç«‹å³è¯»å–åˆ°æˆ‘ä»¬åˆšåˆšæ’å…¥åˆ°é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1f37pxs0pj21h207q40k.jpg" alt="image-20220419155938158"></p>
<p>æˆ‘ä»¬ç°åœ¨ç»§ç»­åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’å…¥æ–°çš„æ•°æ®ï¼Œè¿™é‡Œç›´æ¥åœ¨ç½‘é¡µä¸Šè¿›è¡Œæ“ä½œå°±è¡Œäº†ï¼ŒåŒæ ·çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ¶ˆè´¹è€…ç«¯æ¥å—å¹¶è¿›è¡Œå¤„ç†ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æŠŠåˆšåˆšåˆ›å»ºå¥½çš„æ¶ˆæ¯é˜Ÿåˆ—åˆ é™¤ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-amqp/docs/current/reference/html/">https://docs.spring.io/spring-amqp/docs/current/reference/html/</a></p>
<p>å‰é¢æˆ‘ä»¬å·²ç»å®Œæˆäº†RabbitMQçš„å®‰è£…å’Œç®€å•ä½¿ç”¨ï¼Œå¹¶ä¸”é€šè¿‡Javaè¿æ¥åˆ°æœåŠ¡å™¨ã€‚ç°åœ¨æˆ‘ä»¬æ¥å°è¯•åœ¨SpringBootä¸­æ•´åˆæ¶ˆæ¯é˜Ÿåˆ—å®¢æˆ·ç«¯ï¼Œé¦–å…ˆæ˜¯ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦é…ç½®RabbitMQçš„åœ°å€ç­‰ä¿¡æ¯ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">addresses:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.4</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/test</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†æœ€åŸºæœ¬ä¿¡æ¯é…ç½®ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•åƒä¹‹å‰ä¸€æ ·å»å£°æ˜ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªé…ç½®ç±»å°±è¡Œäº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean(&quot;directExchange&quot;)</span>  <span class="comment">//å®šä¹‰äº¤æ¢æœºBeanï¼Œå¯ä»¥å¾ˆå¤šä¸ª</span></span><br><span class="line">    <span class="keyword">public</span> Exchange <span class="title function_">exchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.directExchange(<span class="string">&quot;amq.direct&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;yydsQueue&quot;)</span>     <span class="comment">//å®šä¹‰æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder</span><br><span class="line">          				.nonDurable(<span class="string">&quot;yyds&quot;</span>)   <span class="comment">//éæŒä¹…åŒ–ç±»å‹</span></span><br><span class="line">          				.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;binding&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">binding</span><span class="params">(<span class="meta">@Qualifier(&quot;directExchange&quot;)</span> Exchange exchange,</span></span><br><span class="line"><span class="params">                           <span class="meta">@Qualifier(&quot;yydsQueue&quot;)</span> Queue queue)</span>&#123;</span><br><span class="line">      	<span class="comment">//å°†æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®š</span></span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(queue)   <span class="comment">//ç»‘å®šé˜Ÿåˆ—</span></span><br><span class="line">                .to(exchange)  <span class="comment">//åˆ°äº¤æ¢æœº</span></span><br><span class="line">                .with(<span class="string">&quot;my-yyds&quot;</span>)   <span class="comment">//ä½¿ç”¨è‡ªå®šä¹‰çš„routingKey</span></span><br><span class="line">                .noargs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ç¼–å†™åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringCloudMqApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//RabbitTemplateä¸ºæˆ‘ä»¬å°è£…äº†å¤§é‡çš„RabbitMQæ“ä½œï¼Œå·²ç»ç”±Starteræä¾›ï¼Œå› æ­¤ç›´æ¥æ³¨å…¥ä½¿ç”¨å³å¯</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RabbitTemplate template;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">publisher</span><span class="params">()</span> &#123;</span><br><span class="line">      	<span class="comment">//ä½¿ç”¨convertAndSendæ–¹æ³•ä¸€æ­¥åˆ°ä½ï¼Œå‚æ•°åŸºæœ¬å’Œä¹‹å‰æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">      	<span class="comment">//æœ€åä¸€ä¸ªæ¶ˆæ¯æœ¬ä½“å¯ä»¥æ˜¯Objectç±»å‹ï¼ŒçœŸæ˜¯å¤§å¤§çš„æ–¹ä¾¿</span></span><br><span class="line">        template.convertAndSend(<span class="string">&quot;amq.direct&quot;</span>, <span class="string">&quot;my-yyds&quot;</span>, <span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸‹è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1fe1qms43j219c03kgme.jpg" alt="image-20220419221426545"></p>
<p>å¯ä»¥çœ‹åˆ°åå°è‡ªåŠ¨å£°æ˜äº†æˆ‘ä»¬åˆšåˆšå®šä¹‰å¥½çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œäº¤æ¢æœºä»¥åŠå¯¹åº”çš„ç»‘å®šå…³ç³»ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„æ•°æ®ä¹Ÿæ˜¯æˆåŠŸæ’å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1fe2uj02vj21wu0fkmyf.jpg" alt="image-20220419221532673"></p>
<p>ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå› ä¸ºæ¶ˆè´¹è€…å®é™…ä¸Šå°±æ˜¯ä¸€ç›´ç­‰å¾…æ¶ˆæ¯ç„¶åè¿›è¡Œå¤„ç†çš„è§’è‰²ï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨å°±è¡Œäº†ï¼Œå®ƒä¼šä¸€ç›´ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ç„¶åå†è¿›è¡Œå¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>  <span class="comment">//æ³¨å†Œä¸ºBean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;yyds&quot;)</span>   <span class="comment">//å®šä¹‰æ­¤æ–¹æ³•ä¸ºé˜Ÿåˆ—yydsçš„ç›‘å¬å™¨ï¼Œä¸€æ—¦ç›‘å¬åˆ°æ–°çš„æ¶ˆæ¯ï¼Œå°±ä¼šæ¥å—å¹¶å¤„ç†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å¯åŠ¨æœåŠ¡å™¨ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1fffku7l0j228w0faaip.jpg" alt="image-20220419230223151"></p>
<p>å¯ä»¥çœ‹åˆ°æ§åˆ¶å°æˆåŠŸè¾“å‡ºäº†æˆ‘ä»¬ä¹‹å‰æ”¾å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”ç®¡ç†é¡µé¢ä¸­ä¹Ÿæ˜¾ç¤ºæ­¤æ¶ˆè´¹è€…å·²ç»è¿æ¥äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1ffghhmdyj21wg05ogmh.jpg" alt="image-20220419230315376"></p>
<p>æ¥ç€æˆ‘ä»¬å†é€šè¿‡ç®¡ç†é¡µé¢æ·»åŠ æ–°çš„æ¶ˆæ¯çœ‹çœ‹ï¼Œä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸è¿›è¡Œæ¥å—çš„ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ç¡®ä¿æ¶ˆæ¯èƒ½å¤Ÿè¢«æ¶ˆè´¹è€…æ¥å—å¹¶å¤„ç†ï¼Œç„¶åå¾—åˆ°æ¶ˆè´¹è€…çš„åé¦ˆï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">publisher</span><span class="params">()</span> &#123;</span><br><span class="line">  	<span class="comment">//ä¼šç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹ç„¶åè¿”å›å“åº”ç»“æœ</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">res</span> <span class="operator">=</span> template.convertSendAndReceive(<span class="string">&quot;amq.direct&quot;</span>, <span class="string">&quot;my-yyds&quot;</span>, <span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ”¶åˆ°æ¶ˆè´¹è€…å“åº”ï¼š&quot;</span>+res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¶ˆè´¹è€…è¿™è¾¹åªéœ€è¦è¿”å›ä¸€ä¸ªå¯¹åº”çš„ç»“æœå³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;yyds&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">receiver</span><span class="params">(String data)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸€å·æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å™¨ &quot;</span>+data);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æ”¶åˆ°!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•æ²¡æœ‰é—®é¢˜ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hbp9t5wsj21ce066gmt.jpg" alt="image-20220421142425891"></p>
<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬éœ€è¦ç›´æ¥æ¥æ”¶ä¸€ä¸ªJSONæ ¼å¼çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”å¸Œæœ›ç›´æ¥è·å–åˆ°å®ä½“ç±»å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConfiguration</span> &#123;</span><br><span class="line">  	...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;jacksonConverter&quot;)</span>   <span class="comment">//ç›´æ¥åˆ›å»ºä¸€ä¸ªç”¨äºJSONè½¬æ¢çš„Bean</span></span><br><span class="line">    <span class="keyword">public</span> Jackson2JsonMessageConverter <span class="title function_">converter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åªéœ€è¦æŒ‡å®šè½¬æ¢å™¨å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> &#123;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//æŒ‡å®šmessageConverterä¸ºæˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„Beanåç§°</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;yyds&quot;, messageConverter = &quot;jacksonConverter&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiver</span><span class="params">(User user)</span>&#123;  <span class="comment">//ç›´æ¥æ¥æ”¶Userç±»å‹</span></span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬ç›´æ¥åœ¨ç®¡ç†é¡µé¢å‘é€ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;LB&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1byhcakabj221m0lwac0.jpg" alt="image-20220416225912100"></p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸå®Œæˆäº†è½¬æ¢ï¼Œå¹¶è¾“å‡ºäº†ç”¨æˆ·ä¿¡æ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1byglk5pmj21ji04imyp.jpg" alt="image-20220416225829807"></p>
<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å‘é€Userï¼Œå› ä¸ºæˆ‘ä»¬åˆšåˆšå·²ç»é…ç½®äº†Jackson2JsonMessageConverterä¸ºBeanï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">publisher</span><span class="params">()</span> &#123;</span><br><span class="line">    template.convertAndSend(<span class="string">&quot;amq.direct&quot;</span>, <span class="string">&quot;yyds&quot;</span>, <span class="keyword">new</span> <span class="title class_">User</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°åå°çš„æ•°æ®ç±»å‹ä¸ºï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1fg5g2h6xj21k20gmmyl.jpg" alt="image-20220419232715025"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1bz013oa7j21c804q755.jpg" alt="image-20220416231709750"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±é€šè¿‡SpringBootå®ç°äº†RabbitMQçš„ç®€å•ä½¿ç”¨ã€‚</p>
<h3 id="æ­»ä¿¡é˜Ÿåˆ—"><a href="#æ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="æ­»ä¿¡é˜Ÿåˆ—"></a>æ­»ä¿¡é˜Ÿåˆ—</h3><p>æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œå¦‚æœè¿Ÿè¿Ÿæ²¡æœ‰æ¶ˆè´¹è€…æ¥å¤„ç†ï¼Œé‚£ä¹ˆå°±ä¼šä¸€ç›´å ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„ç©ºé—´ã€‚æ¯”å¦‚æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹æŠ¢è½¦ç¥¨çš„åœºæ™¯ï¼Œç”¨æˆ·ä¸‹å•é«˜é“ç¥¨ä¹‹åï¼Œä¼šè¿›è¡ŒæŠ¢åº§ï¼Œç„¶åå†è¿›è¡Œä»˜æ¬¾ï¼Œä½†æ˜¯å¦‚æœç”¨æˆ·ä¸‹å•ä¹‹åå¹¶æ²¡æœ‰åŠæ—¶çš„ä»˜æ¬¾ï¼Œè¿™å¼ ç¥¨ä¸å¯èƒ½ä¸€ç›´è®©è¿™ä¸ªç”¨æˆ·å ç”¨ç€ï¼Œå› ä¸ºä½ ä¸ä¹°åˆ«äººè¿˜è¦ä¹°å‘¢ï¼Œæ‰€ä»¥ä¼šåœ¨ä¸€æ®µæ—¶é—´åè¶…æ—¶ï¼Œè®©è¿™å¼ ç¥¨å¯ä»¥ç»§ç»­è¢«å…¶ä»–äººè´­ä¹°ã€‚</p>
<p>è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—ï¼Œå°†é‚£äº›ç”¨æˆ·è¶…æ—¶æœªä»˜æ¬¾çš„æˆ–æ˜¯ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆçš„è®¢å•ï¼Œè¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œä»¥ä¸‹ç±»å‹çš„æ¶ˆæ¯éƒ½ä¼šè¢«åˆ¤å®šä¸ºæ­»ä¿¡ï¼š</p>
<ul>
<li>æ¶ˆæ¯è¢«æ‹’ç»(basic.reject / basic.nack)ï¼Œå¹¶ä¸”requeue = false</li>
<li>æ¶ˆæ¯TTLè¿‡æœŸ</li>
<li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ev8hxtm7j21do07g0tn.jpg" alt="image-20220419112336088"></p>
<p>é‚£ä¹ˆå¦‚ä½•æ„å»ºè¿™æ ·çš„ä¸€ç§ä½¿ç”¨æ¨¡å¼å‘¢ï¼Ÿå®é™…ä¸Šæœ¬è´¨å°±æ˜¯ä¸€ä¸ªæ­»ä¿¡äº¤æ¢æœº+ç»‘å®šçš„æ­»ä¿¡é˜Ÿåˆ—ï¼Œå½“æ­£å¸¸é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯è¢«åˆ¤å®šä¸ºæ­»ä¿¡æ—¶ï¼Œä¼šè¢«å‘é€åˆ°å¯¹åº”çš„æ­»ä¿¡äº¤æ¢æœºï¼Œç„¶åå†é€šè¿‡äº¤æ¢æœºå‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œæ­»ä¿¡é˜Ÿåˆ—ä¹Ÿæœ‰å¯¹åº”çš„æ¶ˆè´¹è€…å»å¤„ç†æ¶ˆæ¯ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥åœ¨é…ç½®ç±»ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œå¹¶è¿›è¡Œç»‘å®šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;directDlExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Exchange <span class="title function_">dlExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.directExchange(<span class="string">&quot;dlx.direct&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;yydsDlQueue&quot;)</span>   <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">dlQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder</span><br><span class="line">                .nonDurable(<span class="string">&quot;dl-yyds&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;dlBinding&quot;)</span>   <span class="comment">//æ­»ä¿¡äº¤æ¢æœºå’Œæ­»ä¿¡é˜Ÿåˆ—è¿›ç»‘å®š</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">dlBinding</span><span class="params">(<span class="meta">@Qualifier(&quot;directDlExchange&quot;)</span> Exchange exchange,</span></span><br><span class="line"><span class="params">                           <span class="meta">@Qualifier(&quot;yydsDlQueue&quot;)</span> Queue queue)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(queue)</span><br><span class="line">                .to(exchange)</span><br><span class="line">                .with(<span class="string">&quot;dl-yyds&quot;</span>)</span><br><span class="line">                .noargs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">		...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;yydsQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder</span><br><span class="line">                .nonDurable(<span class="string">&quot;yyds&quot;</span>)</span><br><span class="line">                .deadLetterExchange(<span class="string">&quot;dlx.direct&quot;</span>)   <span class="comment">//æŒ‡å®šæ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">                .deadLetterRoutingKey(<span class="string">&quot;dl-yyds&quot;</span>)   <span class="comment">//æŒ‡å®šæ­»ä¿¡RoutingKey</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å°†ç›‘å¬å™¨ä¿®æ”¹ä¸ºæ­»ä¿¡é˜Ÿåˆ—ç›‘å¬ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;dl-yyds&quot;, messageConverter = &quot;jacksonConverter&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiver</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬æ¥å°è¯•å¯åŠ¨ä¸€ä¸‹å§ï¼Œæ³¨æ„å¯åŠ¨ä¹‹å‰è®°å¾—æŠŠä¹‹å‰çš„é˜Ÿåˆ—ç»™åˆ äº†ï¼Œè¿™é‡Œè¦é‡æ–°å®šä¹‰ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1fzk61bo9j21pu06wdgy.jpg" alt="image-20220420103846981"></p>
<p>é˜Ÿåˆ—åˆ—è¡¨ä¸­å·²ç»å‡ºç°äº†æˆ‘ä»¬åˆšåˆšå®šä¹‰å¥½çš„æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¹¶ä¸”yydsé˜Ÿåˆ—ä¹Ÿæ”¯æŒæ­»ä¿¡é˜Ÿåˆ—å‘é€åŠŸèƒ½äº†ï¼Œç°åœ¨æˆ‘ä»¬å°è¯•å‘æ­¤é˜Ÿåˆ—å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œä½†æ˜¯æˆ‘ä»¬å°†å…¶æ‹’ç»ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1g000aphbj21ri08yaau.jpg" alt="image-20220420105359931"></p>
<p>å¯ä»¥çœ‹åˆ°æ‹’ç»åï¼Œå¦‚æœä¸è®©æ¶ˆæ¯é‡æ–°æ’é˜Ÿï¼Œé‚£ä¹ˆå°±ä¼šå˜æˆæ­»ä¿¡ï¼Œç›´æ¥è¢«ä¸¢è¿›æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ‹’ç»åï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1g00ywpelj21lk03q75w.jpg" alt="image-20220420105455291"></p>
<p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬äºŒç§æƒ…å†µï¼ŒRabbitMQæ”¯æŒå°†è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡è¢«æ¶ˆè´¹çš„æ¶ˆæ¯è‡ªåŠ¨åˆ é™¤ï¼Œè¿™éœ€è¦æ¶ˆæ¯é˜Ÿåˆ—è®¾å®šTTLå€¼ï¼Œå¦‚æœæ¶ˆæ¯çš„å­˜æ´»æ—¶é—´è¶…è¿‡äº†Time To Liveå€¼ï¼Œå°±ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œè‡ªåŠ¨åˆ é™¤åçš„æ¶ˆæ¯å¦‚æœæœ‰æ­»ä¿¡é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±ä¼šè¿›å…¥åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å°†yydsæ¶ˆæ¯é˜Ÿåˆ—è®¾å®šTTLå€¼ï¼ˆæ¯«ç§’ä¸ºå•ä½ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;yydsQueue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">queue</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> QueueBuilder</span><br><span class="line">            .nonDurable(<span class="string">&quot;yyds&quot;</span>)</span><br><span class="line">            .deadLetterExchange(<span class="string">&quot;dlx.direct&quot;</span>)</span><br><span class="line">            .deadLetterRoutingKey(<span class="string">&quot;dl-yyds&quot;</span>)</span><br><span class="line">            .ttl(<span class="number">5000</span>)   <span class="comment">//å¦‚æœ5ç§’æ²¡å¤„ç†ï¼Œå°±è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬é‡å¯æµ‹è¯•ä¸€ä¸‹ï¼Œæ³¨æ„ä¿®æ”¹äº†ä¹‹åè®°å¾—åˆ é™¤ä¹‹å‰çš„yydsé˜Ÿåˆ—ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1g09oljcsj21lw06agmx.jpg" alt="image-20220420110317997"></p>
<p>å¯ä»¥çœ‹åˆ°ç°åœ¨yydsé˜Ÿåˆ—å·²ç»å…·æœ‰TTLç‰¹æ€§äº†ï¼Œæˆ‘ä»¬ç°åœ¨æ¥æ’å…¥ä¸€ä¸ªæ–°çš„æ¶ˆæ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1g0bin3whj21lk08mjs4.jpg" alt="image-20220420110504022"></p>
<p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯5ç§’é’Ÿä¹‹åå°±ä¸è§äº†ï¼Œè€Œæ˜¯è¢«ä¸¢è¿›äº†æ­»ä¿¡é˜Ÿåˆ—ä¸­ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å½“æ¶ˆæ¯é˜Ÿåˆ—é•¿åº¦è¾¾åˆ°æœ€å¤§çš„æƒ…å†µï¼Œç°åœ¨æˆ‘ä»¬å°†æ¶ˆæ¯é˜Ÿåˆ—çš„é•¿åº¦è¿›è¡Œé™åˆ¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;yydsQueue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">queue</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> QueueBuilder</span><br><span class="line">            .nonDurable(<span class="string">&quot;yyds&quot;</span>)</span><br><span class="line">            .deadLetterExchange(<span class="string">&quot;dlx.direct&quot;</span>)</span><br><span class="line">            .deadLetterRoutingKey(<span class="string">&quot;dl-yyds&quot;</span>)</span><br><span class="line">            .maxLength(<span class="number">3</span>)   <span class="comment">//å°†æœ€å¤§é•¿åº¦è®¾å®šä¸º3</span></span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬é‡å¯ä¸€ä¸‹ï¼Œç„¶åå°è¯•è¿ç»­æ’å…¥4ä¸ªæ¶ˆæ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1g56k0whnj21l008awfp.jpg" alt="image-20220420135316458"></p>
<p>å¯ä»¥çœ‹åˆ°yydsæ¶ˆæ¯é˜Ÿåˆ—æ–°å¢äº†Limitç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯é™å®šé•¿åº¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">publisher</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) </span><br><span class="line">        template.convertAndSend(<span class="string">&quot;amq.direct&quot;</span>, <span class="string">&quot;my-yyds&quot;</span>, <span class="keyword">new</span> <span class="title class_">User</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1g57n6wlpj21r4032wfx.jpg" alt="image-20220420135419673"></p>
<p>å¯ä»¥çœ‹åˆ°å› ä¸ºé•¿åº¦é™åˆ¶ä¸º3ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªæ¶ˆæ¯ç›´æ¥è¢«ä¸¢è¿›äº†æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œä¸ºäº†èƒ½å¤Ÿæ›´ç›´è§‚åœ°è§‚å¯Ÿæ¶ˆæ¯é˜Ÿåˆ—çš„æœºåˆ¶ï¼Œæˆ‘ä»¬ä¸ºUserç±»æ–°å¢ä¸€ä¸ªæ—¶é—´å­—æ®µï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>().toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æ¯éš”ä¸€ç§’é’Ÿæ’å…¥ä¸€ä¸ªï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">publisher</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        template.convertAndSend(<span class="string">&quot;amq.direct&quot;</span>, <span class="string">&quot;my-yyds&quot;</span>, <span class="keyword">new</span> <span class="title class_">User</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡è¿›è¡Œä¸Šè¿°å®éªŒï¼Œå¯ä»¥å‘ç°å¦‚æœåˆ°è¾¾é˜Ÿåˆ—é•¿åº¦é™åˆ¶ï¼Œé‚£ä¹ˆæ¯æ¬¡æ’å…¥éƒ½ä¼šæŠŠä½äºé˜Ÿé¦–çš„æ¶ˆæ¯ä¸¢è¿›æ­»ä¿¡é˜Ÿåˆ—ï¼Œæ¥è…¾å‡ºç©ºé—´ç»™æ–°æ¥çš„æ¶ˆæ¯ã€‚</p>
<h3 id="å·¥ä½œé˜Ÿåˆ—æ¨¡å¼"><a href="#å·¥ä½œé˜Ÿåˆ—æ¨¡å¼" class="headerlink" title="å·¥ä½œé˜Ÿåˆ—æ¨¡å¼"></a>å·¥ä½œé˜Ÿåˆ—æ¨¡å¼</h3><p><strong>æ³¨æ„ï¼š</strong>XXæ¨¡å¼åªæ˜¯ä¸€ç§è®¾è®¡æ€è·¯ï¼Œå¹¶ä¸æ˜¯æŒ‡çš„å…·ä½“çš„æŸç§å®ç°ï¼Œå¯ä»¥ç†è§£ä¸ºå®ç°XXæ¨¡å¼éœ€è¦æ€ä¹ˆå»å†™ã€‚</p>
<p>å‰é¢æˆ‘ä»¬äº†è§£äº†æœ€ç®€çš„ä¸€ä¸ªæ¶ˆè´¹è€…ä¸€ä¸ªç”Ÿäº§è€…çš„æ¨¡å¼ï¼Œæ¥ç€æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ä¸€ä¸ªç”Ÿäº§è€…å¤šä¸ªæ¶ˆè´¹è€…çš„æƒ…å†µï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1g7hh8h18j21he06mt8x.jpg" alt="image-20220420151258324"></p>
<p>å®é™…ä¸Šè¿™ç§æ¨¡å¼å°±éå¸¸é€‚åˆå¤šä¸ªå·¥äººç­‰å¾…æ–°çš„ä»»åŠ¡åˆ°æ¥çš„åœºæ™¯ï¼Œæˆ‘ä»¬çš„ä»»åŠ¡æœ‰å¾ˆå¤šä¸ªï¼Œä¸€ä¸ªä¸€ä¸ªä¸¢è¿›æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œæ­¤æ—¶å·¥äººæœ‰å¾ˆå¤šä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†è¿™äº›ä»»åŠ¡åˆ†é…ä¸ªå„ä¸ªå·¥äººï¼Œè®©ä»–ä»¬å„è‡ªè´Ÿè´£ä¸€äº›ä»»åŠ¡ï¼Œå¹¶ä¸”åšçš„å¿«çš„å·¥äººè¿˜å¯ä»¥åšå®Œæˆä¸€äº›ï¼ˆèƒ½è€…å¤šåŠ³ï¼‰ã€‚</p>
<p>éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸¤ä¸ªç›‘å¬å™¨å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;yyds&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiver</span><span class="params">(String data)</span>&#123;   <span class="comment">//è¿™é‡Œç›´æ¥æ¥æ”¶Stringç±»å‹çš„æ•°æ®</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸€å·æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å™¨ &quot;</span>+data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;yyds&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiver2</span><span class="params">(String data)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;äºŒå·æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å™¨ &quot;</span>+data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œè½®è¯¢åˆ†å‘ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1g8fw63klj21f406gzl5.jpg" alt="image-20220420154602883"></p>
<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä¸€å¼€å§‹å°±åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ”¾å…¥ä¸€éƒ¨åˆ†æ¶ˆæ¯åœ¨å¼€å¯æ¶ˆè´¹è€…å‘¢ï¼Ÿ</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1g8gs2duqj21fe05s74x.jpg" alt="image-20220420154654901"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ˜¯ä¸€å¼€å§‹å°±å­˜åœ¨æ¶ˆæ¯ï¼Œä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…ä¸€æ¬¡æ€§å…¨éƒ¨æ¶ˆè€—ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å¯¹æ¶ˆè´¹è€…çš„Prefetch countï¼ˆé¢„è·å–æ•°é‡ï¼Œä¸€æ¬¡æ€§è·å–æ¶ˆæ¯çš„æœ€å¤§æ•°é‡ï¼‰è¿›è¡Œé™åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ç°åœ¨å¸Œæœ›çš„æ˜¯æ¶ˆè´¹è€…ä¸€æ¬¡åªèƒ½æ‹¿ä¸€ä¸ªæ¶ˆæ¯ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰çš„æ¶ˆæ¯å…¨éƒ¨éƒ½è·å–ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1g8xeq182j21fo05qt9x.jpg" alt="image-20220420160253144"></p>
<p>å› æ­¤æˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªæ•°é‡è¿›è¡Œä¸€äº›é…ç½®ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®ç±»ä¸­å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„ListenerContainerFactoryï¼Œå¯ä»¥åœ¨è¿™é‡Œè®¾å®šæ¶ˆè´¹è€…Channelçš„PrefetchCountçš„å¤§å°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> CachingConnectionFactory connectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean(name = &quot;listenerContainer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> SimpleRabbitListenerContainerFactory <span class="title function_">listenerContainer</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">SimpleRabbitListenerContainerFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleRabbitListenerContainerFactory</span>();</span><br><span class="line">    factory.setConnectionFactory(connectionFactory);</span><br><span class="line">    factory.setPrefetchCount(<span class="number">1</span>);   <span class="comment">//å°†PrefetchCountè®¾å®šä¸º1è¡¨ç¤ºä¸€æ¬¡åªèƒ½å–ä¸€ä¸ª</span></span><br><span class="line">    <span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åœ¨ç›‘å¬å™¨è¿™è¾¹æŒ‡å®šå³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;yyds&quot;,  containerFactory = &quot;listenerContainer&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiver</span><span class="params">(String data)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸€å·æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å™¨ &quot;</span>+data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;yyds&quot;, containerFactory = &quot;listenerContainer&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiver2</span><span class="params">(String data)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;äºŒå·æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å™¨ &quot;</span>+data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å†æ¬¡å¯åŠ¨æœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°PrefetchCountè¢«é™å®šä¸º1äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ga7d3x42j21m006sdh7.jpg" alt="image-20220420164702864"></p>
<p>å†æ¬¡é‡å¤ä¸Šè¿°çš„å®ç°ï¼Œå¯ä»¥çœ‹åˆ°æ¶ˆæ¯ä¸ä¼šè¢«ä¸€å·æ¶ˆè´¹è€…ç»™å…¨éƒ¨æŠ¢èµ°äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1ga8tuajtj21la05sgmd.jpg" alt="image-20220420164827502"></p>
<p>å½“ç„¶é™¤äº†å»å®šä¹‰ä¸¤ä¸ªç›¸åŒçš„ç›‘å¬å™¨ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ³¨è§£ä¸­å®šä¹‰ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦10ä¸ªåŒæ ·çš„æ¶ˆè´¹è€…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;yyds&quot;,  containerFactory = &quot;listenerContainer&quot;, concurrency = &quot;10&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiver</span><span class="params">(String data)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸€å·æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å™¨ &quot;</span>+data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°åœ¨ç®¡ç†é¡µé¢ä¸­å‡ºç°äº†10ä¸ªæ¶ˆè´¹è€…ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1gaotg34ij21qg0fuaeh.jpg" alt="image-20220420170349298"></p>
<p>è‡³æ­¤ï¼Œæœ‰å…³å·¥ä½œé˜Ÿåˆ—æ¨¡å¼å°±è®²åˆ°è¿™é‡Œã€‚</p>
<h3 id="å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼</h3><p>å‰é¢æˆ‘ä»¬å·²ç»äº†è§£äº†RabbitMQå®¢æˆ·ç«¯çš„ä¸€äº›åŸºæœ¬æ“ä½œï¼ŒåŒ…æ‹¬æ™®é€šçš„æ¶ˆæ¯æ¨¡å¼ï¼Œæ¥ç€æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹å…¶ä»–çš„æ¨¡å¼ï¼Œé¦–å…ˆæ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå®ƒæ”¯æŒå¤šç§æ–¹å¼ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h1gb8mwfc9j21gy08emxj.jpg" alt="image-20220420172252440"></p>
<p>æ¯”å¦‚æˆ‘ä»¬åœ¨é˜¿é‡Œäº‘ä¹°äº†äº‘æœåŠ¡å™¨ï¼Œä½†æ˜¯æœ€è¿‘å¿«åˆ°æœŸäº†ï¼Œé‚£ä¹ˆå°±ä¼šç»™ä½ çš„æ‰‹æœºã€é‚®ç®±å‘é€æ¶ˆæ¯ï¼Œå‘Šè¯‰ä½ éœ€è¦å»ç»­è´¹äº†ï¼Œä½†æ˜¯æ‰‹æœºçŸ­ä¿¡å’Œé‚®ä»¶å‘é€å¹¶ä¸ä¸€å®šæ˜¯åŒä¸€ä¸ªä¸šåŠ¡æä¾›çš„ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬åˆå¸Œæœ›èƒ½å¤Ÿéƒ½å»æ‰§è¡Œï¼Œæ‰€ä»¥å°±å¯ä»¥ç”¨åˆ°å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼Œå‘å¸ƒä¸€æ¬¡ï¼Œæ¶ˆè´¹å¤šä¸ªã€‚</p>
<p>å®ç°è¿™ç§æ¨¡å¼å…¶å®ä¹Ÿéå¸¸ç®€å•ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨æˆ‘ä»¬ä¹‹å‰çš„ç›´è¿äº¤æ¢æœºï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦ç”¨åˆ°å¦ä¸€ç§ç±»å‹çš„äº¤æ¢æœºï¼Œå«åš<code>fanout</code>ï¼ˆæ‰‡å‡ºï¼‰ç±»å‹ï¼Œè¿™æ—¶ä¸€ç§å¹¿æ’­ç±»å‹ï¼Œæ¶ˆæ¯ä¼šè¢«å¹¿æ’­åˆ°æ‰€æœ‰ä¸æ­¤äº¤æ¢æœºç»‘å®šçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1gks5vbsxj20za020t8p.jpg" alt="image-20220420225300171"></p>
<p>è¿™ä¸ªäº¤æ¢æœºæ˜¯ä¸€ä¸ª<code>fanout</code>ç±»å‹çš„äº¤æ¢æœºï¼Œæˆ‘ä»¬å°±æ˜¯è¦å®ƒå°±è¡Œäº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;fanoutExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Exchange <span class="title function_">exchange</span><span class="params">()</span>&#123;</span><br><span class="line">      	<span class="comment">//æ³¨æ„è¿™é‡Œæ˜¯fanoutExchange</span></span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.fanoutExchange(<span class="string">&quot;amq.fanout&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;yydsQueue1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.nonDurable(<span class="string">&quot;yyds1&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;binding&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">binding</span><span class="params">(<span class="meta">@Qualifier(&quot;fanoutExchange&quot;)</span> Exchange exchange,</span></span><br><span class="line"><span class="params">                           <span class="meta">@Qualifier(&quot;yydsQueue1&quot;)</span> Queue queue)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(queue)</span><br><span class="line">                .to(exchange)</span><br><span class="line">                .with(<span class="string">&quot;yyds1&quot;</span>)</span><br><span class="line">                .noargs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;yydsQueue2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queue2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.nonDurable(<span class="string">&quot;yyds2&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;binding2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">binding2</span><span class="params">(<span class="meta">@Qualifier(&quot;fanoutExchange&quot;)</span> Exchange exchange,</span></span><br><span class="line"><span class="params">                           <span class="meta">@Qualifier(&quot;yydsQueue2&quot;)</span> Queue queue)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(queue)</span><br><span class="line">                .to(exchange)</span><br><span class="line">                .with(<span class="string">&quot;yyds2&quot;</span>)</span><br><span class="line">                .noargs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬å°†ä¸¤ä¸ªé˜Ÿåˆ—éƒ½ç»‘å®šåˆ°æ­¤äº¤æ¢æœºä¸Šï¼Œæˆ‘ä»¬å…ˆå¯åŠ¨çœ‹çœ‹æ•ˆæœï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1gl9px6doj21tc0bimxv.jpg" alt="image-20220420230954785"></p>
<p>ç»‘å®šæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ¥ç€æˆ‘ä»¬æä¸¤ä¸ªç›‘å¬å™¨ï¼Œç›‘å¬ä¸€ä¸‹è¿™ä¸¤ä¸ªé˜Ÿåˆ—ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestListener</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;yyds1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiver</span><span class="params">(String data)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸€å·æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å™¨ &quot;</span>+data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;yyds2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiver2</span><span class="params">(String data)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;äºŒå·æ¶ˆæ¯é˜Ÿåˆ—ç›‘å¬å™¨ &quot;</span>+data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬é€šè¿‡äº¤æ¢æœºå‘é€æ¶ˆæ¯ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯ä¸¤ä¸ªç›‘å¬å™¨éƒ½ä¼šæ¥æ”¶åˆ°æ¶ˆæ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1glb33v3wj21ky0k80ts.jpg" alt="image-20220420231113658"></p>
<p>å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯ä¸¤ä¸ªæ¶ˆæ¯é˜Ÿåˆ—éƒ½èƒ½å¤Ÿæ¥å—åˆ°æ­¤æ¶ˆæ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1glbn729uj21be03umxp.jpg" alt="image-20220420231145578"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†å‘å¸ƒè®¢é˜…æ¨¡å¼ã€‚</p>
<h3 id="è·¯ç”±æ¨¡å¼"><a href="#è·¯ç”±æ¨¡å¼" class="headerlink" title="è·¯ç”±æ¨¡å¼"></a>è·¯ç”±æ¨¡å¼</h3><p>è·¯ç”±æ¨¡å¼å®é™…ä¸Šæˆ‘ä»¬ä¸€å¼€å§‹å°±å·²ç»å®ç°äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»‘å®šæ—¶æŒ‡å®šæƒ³è¦çš„<code>routingKey</code>åªæœ‰ç”Ÿäº§è€…å‘é€æ—¶æŒ‡å®šäº†å¯¹åº”çš„<code>routingKey</code>æ‰èƒ½åˆ°è¾¾å¯¹åº”çš„é˜Ÿåˆ—ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1glt0bescj21dk08mjru.jpg" alt="image-20220420232826848"></p>
<p>å½“ç„¶é™¤äº†æˆ‘ä»¬ä¹‹å‰çš„ä¸€æ¬¡ç»‘å®šä¹‹å¤–ï¼ŒåŒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å¤šæ¬¡ç»‘å®šåˆ°äº¤æ¢æœºï¼Œå¹¶ä¸”ä½¿ç”¨ä¸åŒçš„<code>routingKey</code>ï¼Œè¿™æ ·åªè¦æ»¡è¶³å…¶ä¸­ä¸€ä¸ªéƒ½å¯ä»¥è¢«å‘é€åˆ°æ­¤æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;directExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Exchange <span class="title function_">exchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.directExchange(<span class="string">&quot;amq.direct&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;yydsQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.nonDurable(<span class="string">&quot;yyds&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;binding&quot;)</span>   <span class="comment">//ä½¿ç”¨yyds1ç»‘å®š</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">binding</span><span class="params">(<span class="meta">@Qualifier(&quot;directExchange&quot;)</span> Exchange exchange,</span></span><br><span class="line"><span class="params">                           <span class="meta">@Qualifier(&quot;yydsQueue&quot;)</span> Queue queue)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(queue)</span><br><span class="line">                .to(exchange)</span><br><span class="line">                .with(<span class="string">&quot;yyds1&quot;</span>)</span><br><span class="line">                .noargs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;binding2&quot;)</span>   <span class="comment">//ä½¿ç”¨yyds2ç»‘å®š</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">binding2</span><span class="params">(<span class="meta">@Qualifier(&quot;directExchange&quot;)</span> Exchange exchange,</span></span><br><span class="line"><span class="params">                           <span class="meta">@Qualifier(&quot;yydsQueue&quot;)</span> Queue queue)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(queue)</span><br><span class="line">                .to(exchange)</span><br><span class="line">                .with(<span class="string">&quot;yyds2&quot;</span>)</span><br><span class="line">                .noargs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç®¡ç†é¢æ¿ä¸­å‡ºç°äº†ä¸¤ä¸ªç»‘å®šå…³ç³»ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1gm0zb3hej21kq0eagmk.jpg" alt="image-20220420233606749"></p>
<p>è¿™é‡Œå¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼Œéšä¾¿ä½¿ç”¨å“ªä¸ª<code>routingKey</code>éƒ½å¯ä»¥ã€‚</p>
<h3 id="ä¸»é¢˜æ¨¡å¼"><a href="#ä¸»é¢˜æ¨¡å¼" class="headerlink" title="ä¸»é¢˜æ¨¡å¼"></a>ä¸»é¢˜æ¨¡å¼</h3><p>å®é™…ä¸Šè¿™ç§æ¨¡å¼å°±æ˜¯ä¸€ç§æ¨¡ç³ŠåŒ¹é…çš„æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>routingKey</code>ä»¥æ¨¡ç³ŠåŒ¹é…çš„æ–¹å¼å»è¿›è¡Œè½¬å‘ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1gm29nni5j21fs08874r.jpg" alt="image-20220420233721239"></p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>*</code>æˆ–<code>#</code>æ¥è¡¨ç¤ºï¼š</p>
<ul>
<li>* - è¡¨ç¤ºä»»æ„çš„ä¸€ä¸ªå•è¯</li>
<li># - è¡¨ç¤º0ä¸ªæˆ–å¤šä¸ªå•è¯</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;topicExchange&quot;)</span>  <span class="comment">//è¿™é‡Œä½¿ç”¨é¢„ç½®çš„Topicç±»å‹äº¤æ¢æœº</span></span><br><span class="line">    <span class="keyword">public</span> Exchange <span class="title function_">exchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.topicExchange(<span class="string">&quot;amq.topic&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;yydsQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.nonDurable(<span class="string">&quot;yyds&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;binding&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">binding2</span><span class="params">(<span class="meta">@Qualifier(&quot;topicExchange&quot;)</span> Exchange exchange,</span></span><br><span class="line"><span class="params">                           <span class="meta">@Qualifier(&quot;yydsQueue&quot;)</span> Queue queue)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(queue)</span><br><span class="line">                .to(exchange)</span><br><span class="line">                .with(<span class="string">&quot;*.test.*&quot;</span>)</span><br><span class="line">                .noargs();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨é¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°åªè¦æ˜¯æ»¡è¶³é€šé…ç¬¦æ¡ä»¶çš„éƒ½å¯ä»¥æˆåŠŸè½¬å‘åˆ°å¯¹åº”çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1h55kezhaj21jk0ke0to.jpg" alt="image-20220421103753962"></p>
<p>æ¥ç€æˆ‘ä»¬å¯ä»¥å†è¯•è¯•çœ‹<code>#</code>é€šé…ç¬¦ã€‚</p>
<p>é™¤äº†æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„é»˜è®¤ä¸»é¢˜äº¤æ¢æœºä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå«åš<code>amq.rabbitmq.trace</code>çš„äº¤æ¢æœºï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1h58cwa5oj20z6024jrf.jpg" alt="image-20220421104035463"></p>
<p>å¯ä»¥çœ‹åˆ°å®ƒä¹Ÿæ˜¯<code>topic</code>ç±»å‹çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªäº¤æ¢æœºæ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿå®é™…ä¸Šè¿™æ˜¯ç”¨äºå¸®åŠ©æˆ‘ä»¬è®°å½•å’Œè¿½è¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„äº¤æ¢æœºï¼Œå®ƒæ˜¯ä¸€ä¸ªå†…éƒ¨çš„äº¤æ¢æœºï¼Œé‚£ä¹ˆå¦‚æœä½¿ç”¨å‘¢ï¼Ÿé¦–å…ˆåˆ›å»ºä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ç”¨äºæ¥æ”¶è®°å½•ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1h5ebv4vnj21f407wt9u.jpg" alt="image-20220421104619325"></p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨æ§åˆ¶å°å°†è™šæ‹Ÿä¸»æœº<code>/test</code>çš„è¿½è¸ªåŠŸèƒ½å¼€å¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo rabbitmqctl trace_on -p /test</span><br></pre></td></tr></table></figure>

<p>å¼€å¯åï¼Œæˆ‘ä»¬å°†æ­¤é˜Ÿåˆ—ç»‘å®šåˆ°ä¸Šé¢çš„äº¤æ¢æœºä¸Šï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1h5gtqdrlj21gk09st9f.jpg" alt="image-20220421104843224"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1h5jwqqf1j21cc09kdgg.jpg" alt="image-20220421105141144"></p>
<p>ç”±äºå‘é€åˆ°æ­¤äº¤æ¢æœºä¸Šçš„<code>routingKey</code>ä¸ºrouting keyä¸º publish.äº¤æ¢æœºåç§° å’Œ deliver.é˜Ÿåˆ—åç§°ï¼Œåˆ†åˆ«å¯¹åº”ç”Ÿäº§è€…æŠ•é€’åˆ°äº¤æ¢æœºçš„æ¶ˆæ¯ï¼Œå’Œæ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸Šè·å–çš„æ¶ˆæ¯ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨<code>#</code>é€šé…ç¬¦è¿›è¡Œç»‘å®šã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæ¯”å¦‚è¿˜æ˜¯å¾€yydsé˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1h5kz432vj21ks080mxw.jpg" alt="image-20220421105242770"></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”æ¶ˆè´¹è€…å·²ç»å¤„ç†ä¹‹åï¼Œ<code>trace</code>é˜Ÿåˆ—ä¸­æ–°å¢äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹éƒ½æ˜¯äº›ä»€ä¹ˆæ¶ˆæ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1h5nunf9kj21jg0m0jth.jpg" alt="image-20220421105528532"></p>
<p>é€šè¿‡è¿½è¸ªï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ˜ç¡®åœ°å¾—çŸ¥æ¶ˆæ¯å‘é€çš„äº¤æ¢æœºã€routingKeyã€ç”¨æˆ·ç­‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¿¡æ¯æœ¬èº«ï¼ŒåŒæ ·çš„ï¼Œæ¶ˆè´¹è€…åœ¨å–å‡ºæ•°æ®æ—¶ä¹Ÿæœ‰è®°å½•ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1h5p26b1oj21nc0k440e.jpg" alt="image-20220421105638715"></p>
<p>æˆ‘ä»¬å¯ä»¥æ˜ç¡®æ¶ˆè´¹è€…çš„åœ°å€ã€ç«¯å£ã€å…·ä½“æ“ä½œçš„é˜Ÿåˆ—ä»¥åŠå–å‡ºçš„æ¶ˆæ¯ä¿¡æ¯ç­‰ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å·²ç»äº†è§£äº†3ç§ç±»å‹çš„äº¤æ¢æœºã€‚</p>
<h3 id="ç¬¬å››ç§äº¤æ¢æœºç±»å‹"><a href="#ç¬¬å››ç§äº¤æ¢æœºç±»å‹" class="headerlink" title="ç¬¬å››ç§äº¤æ¢æœºç±»å‹"></a>ç¬¬å››ç§äº¤æ¢æœºç±»å‹</h3><p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†ä¸‰ç§äº¤æ¢æœºç±»å‹ï¼Œç°åœ¨æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹ç¬¬å››ç§äº¤æ¢æœºç±»å‹<code>header</code>ï¼Œå®ƒæ˜¯æ ¹æ®å¤´éƒ¨ä¿¡æ¯æ¥å†³å®šçš„ï¼Œåœ¨æˆ‘ä»¬å‘é€çš„æ¶ˆæ¯ä¸­æ˜¯å¯ä»¥æºå¸¦ä¸€äº›å¤´éƒ¨ä¿¡æ¯çš„ï¼ˆç±»ä¼¼äºHTTPï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™äº›å¤´éƒ¨ä¿¡æ¯æ¥å†³å®šè·¯ç”±åˆ°å“ªä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;headerExchange&quot;)</span>  <span class="comment">//æ³¨æ„è¿™é‡Œè¿”å›çš„æ˜¯HeadersExchange</span></span><br><span class="line">    <span class="keyword">public</span> HeadersExchange <span class="title function_">exchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder</span><br><span class="line">                .headersExchange(<span class="string">&quot;amq.headers&quot;</span>)  <span class="comment">//RabbitMQä¸ºæˆ‘ä»¬é¢„ç½®äº†ä¸¤ä¸ªï¼Œè¿™é‡Œç”¨ç¬¬ä¸€ä¸ªå°±è¡Œ</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;yydsQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.nonDurable(<span class="string">&quot;yyds&quot;</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;binding&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">binding2</span><span class="params">(<span class="meta">@Qualifier(&quot;headerExchange&quot;)</span> HeadersExchange exchange,  //è¿™é‡Œå’Œä¸Šé¢ä¸€æ ·çš„ç±»å‹</span></span><br><span class="line"><span class="params">                           <span class="meta">@Qualifier(&quot;yydsQueue&quot;)</span> Queue queue)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(queue)</span><br><span class="line">                .to(exchange)   <span class="comment">//ä½¿ç”¨HeadersExchangeçš„toæ–¹æ³•ï¼Œå¯ä»¥è¿›è¡Œè¿›ä¸€æ­¥é…ç½®</span></span><br><span class="line">          			<span class="comment">//.whereAny(&quot;a&quot;, &quot;b&quot;).exist();   è¿™ä¸ªæ˜¯åªè¦å­˜åœ¨ä»»æ„ä¸€ä¸ªæŒ‡å®šçš„å¤´éƒ¨Keyå°±è¡Œ</span></span><br><span class="line">                <span class="comment">//.whereAll(&quot;a&quot;, &quot;b&quot;).exist();   è¿™ä¸ªæ˜¯å¿…é¡»å­˜åœ¨æ‰€æœ‰æŒ‡å®šçš„çš„å¤´éƒ¨Key</span></span><br><span class="line">                .where(<span class="string">&quot;test&quot;</span>).matches(<span class="string">&quot;hello&quot;</span>);   <span class="comment">//æ¯”å¦‚æˆ‘ä»¬ç°åœ¨éœ€è¦æ¶ˆæ¯çš„å¤´éƒ¨ä¿¡æ¯ä¸­åŒ…å«testï¼Œå¹¶ä¸”å€¼ä¸ºhelloæ‰èƒ½è½¬å‘ç»™æˆ‘ä»¬çš„æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">      					<span class="comment">//.whereAny(Collections.singletonMap(&quot;test&quot;, &quot;hello&quot;)).match();  ä¼ å…¥Mapä¹Ÿè¡Œï¼Œæ‰¹é‡æŒ‡å®šé”®å€¼å¯¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æ¥å¯åŠ¨ä¸€ä¸‹è¯•è¯•çœ‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1h62dn6msj21zk0moq4k.jpg" alt="image-20220421110926077"></p>
<p>ç»“æœå‘ç°ï¼Œæ¶ˆæ¯å¯ä»¥æˆåŠŸå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™å°±æ˜¯ä½¿ç”¨å¤´éƒ¨ä¿¡æ¯è¿›è¡Œè·¯ç”±ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä»‹ç»å®Œäº†æ‰€æœ‰å››ç§ç±»å‹çš„äº¤æ¢æœºã€‚</p>
<h3 id="é›†ç¾¤æ­å»º"><a href="#é›†ç¾¤æ­å»º" class="headerlink" title="é›†ç¾¤æ­å»º"></a>é›†ç¾¤æ­å»º</h3><p>å‰é¢æˆ‘ä»¬å¯¹äºRabbitMQçš„ç›¸å…³å†…å®¹å·²ç»åŸºæœ¬è®²è§£å®Œæ¯•äº†ï¼Œæœ€åæˆ‘ä»¬æ¥å°è¯•æ­å»ºä¸€ä¸ªé›†ç¾¤ï¼Œè®©RabbitMQä¹‹é—´è¿›è¡Œæ•°æ®å¤åˆ¶ï¼ˆé•œåƒæ¨¡å¼ï¼‰ç¨å¾®æœ‰ç‚¹éº»çƒ¦ï¼Œè·Ÿç€è§†é¢‘èµ°å§ã€‚</p>
<p>å¯èƒ½ä¼šç”¨åˆ°çš„ä¸€äº›å‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo rabbitmqctl stop_app</span><br><span class="line">sudo rabbitmqctl join_cluster rabbit@ubuntu-server</span><br><span class="line">sudo rabbitmqctl start_app</span><br></pre></td></tr></table></figure>

<p>å®ç°å¤åˆ¶å³å¯ã€‚</p>
<hr>
<h2 id="SpringCloud-æ¶ˆæ¯ç»„ä»¶"><a href="#SpringCloud-æ¶ˆæ¯ç»„ä»¶" class="headerlink" title="SpringCloud æ¶ˆæ¯ç»„ä»¶"></a>SpringCloud æ¶ˆæ¯ç»„ä»¶</h2><p>å‰é¢æˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨RabbitMQæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¥ç€æˆ‘ä»¬æ¥ç®€å•ä»‹ç»ä¸€ä¸‹SpringCloudä¸ºæˆ‘ä»¬æä¾›çš„ä¸€äº›æ¶ˆæ¯ç»„ä»¶ã€‚</p>
<h3 id="SpringCloud-Stream"><a href="#SpringCloud-Stream" class="headerlink" title="SpringCloud Stream"></a>SpringCloud Stream</h3><p><strong>å®˜æ–¹æ–‡æ¡£ï¼š</strong><a href="https://docs.spring.io/spring-cloud-stream/docs/3.2.2/reference/html/">https://docs.spring.io/spring-cloud-stream/docs/3.2.2/reference/html/</a></p>
<p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†RabbitMQï¼Œäº†è§£äº†æ¶ˆæ¯é˜Ÿåˆ—ç›¸å…³çš„ä¸€äº›æ“ä½œï¼Œä½†æ˜¯å¯èƒ½æˆ‘ä»¬ä¼šé‡åˆ°ä¸åŒçš„ç³»ç»Ÿåœ¨ç”¨ä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¯”å¦‚ç³»ç»ŸAç”¨çš„Kafkaã€ç³»ç»ŸBç”¨çš„RabbitMQï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨åˆæ²¡æœ‰å­¦ä¹ è¿‡Kafkaï¼Œé‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿæœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼åƒJDBCä¸€æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒSQLå’Œä¸šåŠ¡æœ¬èº«ï¼Œè€Œä¸ç”¨å…³å¿ƒæ•°æ®åº“çš„å…·ä½“å®ç°å‘¢ï¼Ÿ</p>
<p>SpringCloud Streamèƒ½å¤Ÿåšåˆ°ï¼Œå®ƒèƒ½å¤Ÿå±è”½åº•å±‚å®ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨ç»Ÿä¸€çš„æ¶ˆæ¯é˜Ÿåˆ—æ“ä½œæ–¹å¼å°±èƒ½æ“ä½œå¤šç§ä¸åŒç±»å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hqdnqlqsj21iu0l0myd.jpg" alt="image-20220421225215709"></p>
<p>å®ƒå±è”½äº†RabbitMQåº•å±‚æ“ä½œï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ç»Ÿä¸€çš„Inputå’ŒOutputå½¢å¼ï¼Œä»¥Binderä¸ºä¸­é—´ä»¶ï¼Œè¿™æ ·å°±ç®—æˆ‘ä»¬åˆ‡æ¢äº†ä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¹Ÿæ— éœ€ä¿®æ”¹ä»£ç ï¼Œè€Œå…·ä½“æŸç§æ¶ˆæ¯é˜Ÿåˆ—çš„åº•å±‚å®ç°æ˜¯äº¤ç»™Streamåœ¨åšçš„ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hoqprxzxj21mm0bmtbx.jpg" alt="image-20220421215534386"></p>
<p>ä¾èµ–å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  RabbitMQçš„Streamå®ç°  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-stream-rabbit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸‹ç”Ÿäº§è€…ï¼Œé¦–å…ˆæ˜¯é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">      <span class="attr">binders:</span>   <span class="comment">#æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">        <span class="attr">local-server:</span> <span class="comment">#ç»‘å®šåç§°ï¼Œéšä¾¿èµ·ä¸€ä¸ªå°±è¡Œ</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">rabbit</span> <span class="comment">#æ¶ˆæ¯ç»„ä»¶ç±»å‹ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯RabbitMQï¼Œå°±å¡«å†™rabbit</span></span><br><span class="line">          <span class="attr">environment:</span>  <span class="comment">#æœåŠ¡å™¨ç›¸å…³ä¿¡æ¯ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ–¹å¼å¡«å†™å°±è¡Œï¼Œçˆ†çº¢åˆ«ç®¡</span></span><br><span class="line">            <span class="attr">spring:</span></span><br><span class="line">              <span class="attr">rabbitmq:</span></span><br><span class="line">                <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.6</span></span><br><span class="line">                <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">                <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">                <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">                <span class="attr">virtual-host:</span> <span class="string">/test</span></span><br><span class="line">       <span class="attr">bindings:</span></span><br><span class="line">        <span class="attr">test-out-0:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">test.exchange</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªControllerï¼Œä¸€ä¼šè®¿é—®ä¸€æ¬¡è¿™ä¸ªæ¥å£ï¼Œå°±å‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€ä¸€ä¸ªæ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PublishController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    StreamBridge bridge;  <span class="comment">//é€šè¿‡bridgeæ¥å‘é€æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/publish&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">publish</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°å…¶å®å°±æ˜¯RabbitMQçš„äº¤æ¢æœºåç§°ï¼ˆæ•°æ®ä¼šå‘é€ç»™è¿™ä¸ªäº¤æ¢æœºï¼Œåˆ°è¾¾å“ªä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸ç”±æˆ‘ä»¬å†³å®šï¼‰</span></span><br><span class="line">      	<span class="comment">//è¿™ä¸ªäº¤æ¢æœºçš„å‘½åç¨å¾®æœ‰ä¸€äº›è§„åˆ™:</span></span><br><span class="line">      	<span class="comment">//è¾“å…¥:    &lt;åç§°&gt; + -in- + &lt;index&gt;</span></span><br><span class="line">      	<span class="comment">//è¾“å‡º:    &lt;åç§°&gt; + -out- + &lt;index&gt;</span></span><br><span class="line">      	<span class="comment">//è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è¾“å‡ºçš„æ–¹å¼ï¼Œæ¥å°†æ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ³¨æ„è¿™é‡Œçš„åç§°ä¼šå’Œä¹‹åçš„æ¶ˆè´¹è€…Beanåç§°è¿›è¡Œå¯¹åº”</span></span><br><span class="line">        bridge.send(<span class="string">&quot;test-out-0&quot;</span>, <span class="string">&quot;HelloWorld!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ¶ˆæ¯å‘é€æˆåŠŸï¼&quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æ¥å°†ç”Ÿäº§è€…å¯åŠ¨ä¸€ä¸‹ï¼Œè®¿é—®ä¸€ä¸‹æ¥å£ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hp5m6t34j21fk06ggmc.jpg" alt="image-20220421220955906"></p>
<p>å¯ä»¥çœ‹åˆ°æ¶ˆæ¯æˆåŠŸå‘é€ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹RabbitMQè¿™è¾¹çš„æƒ…å†µï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hp65svdxj21bg02it8r.jpg" alt="image-20220421221027145"></p>
<p>æ–°å¢äº†ä¸€ä¸ª<code>test-in-0</code>äº¤æ¢æœºï¼Œå¹¶ä¸”æ­¤äº¤æ¢æœºæ˜¯topicç±»å‹çš„ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hp6umeypj218w07a0st.jpg" alt="image-20220421221107547"></p>
<p>ä½†æ˜¯ç›®å‰æ²¡æœ‰ä»»ä½•é˜Ÿåˆ—ç»‘å®šåˆ°æ­¤äº¤æ¢æœºä¸Šï¼Œå› æ­¤æˆ‘ä»¬åˆšåˆšå‘é€çš„æ¶ˆæ¯å®é™…ä¸Šæ˜¯æ²¡æœ‰ç»™åˆ°ä»»ä½•é˜Ÿåˆ—çš„ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸‹æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…çš„ç¼–å†™æ–¹å¼æ¯”è¾ƒç‰¹åˆ«ï¼Œåªéœ€è¦å®šä¹‰ä¸€ä¸ªConsumerå°±å¯ä»¥äº†ï¼Œå…¶ä»–é…ç½®ä¿æŒä¸€è‡´ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;test&quot;)</span>   <span class="comment">//æ³¨æ„è¿™é‡Œéœ€è¦å¡«å†™æˆ‘ä»¬å‰é¢äº¤æ¢æœºåç§°ä¸­&quot;åç§°&quot;ï¼Œè¿™æ ·ç”Ÿäº§è€…å‘é€çš„æ•°æ®æ‰ä¼šæ­£ç¡®åˆ°è¾¾</span></span><br><span class="line">    <span class="keyword">public</span> Consumer&lt;String&gt; <span class="title function_">consumer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> System.out::println;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®ä¸­éœ€è¦ä¿®æ”¹ä¸€ä¸‹ç›®æ ‡äº¤æ¢æœºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8002</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">stream:</span></span><br><span class="line">    	<span class="string">...</span></span><br><span class="line">      <span class="attr">bindings:</span></span><br><span class="line">      	<span class="comment">#å› ä¸ºæ¶ˆè´¹è€…æ˜¯è¾“å…¥ï¼Œé»˜è®¤åç§°ä¸º æ–¹æ³•å-in-indexï¼Œè¿™é‡Œæˆ‘ä»¬å°†å…¶æŒ‡å®šä¸ºæˆ‘ä»¬åˆšåˆšå®šä¹‰çš„äº¤æ¢æœº</span></span><br><span class="line">        <span class="attr">test-in-0:</span></span><br><span class="line">          <span class="attr">destination:</span> <span class="string">test.exchange</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬ç›´æ¥å¯åŠ¨å°±å¯ä»¥äº†ï¼Œå¯ä»¥çœ‹åˆ°å¯åŠ¨ä¹‹åï¼Œè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„é˜Ÿåˆ—ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hpdjthrqj21sy05mdgw.jpg" alt="image-20220421221733723"></p>
<p>è€Œè¿™ä¸ªé˜Ÿåˆ—å®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬æ¶ˆè´¹è€…ç­‰å¾…æ•°æ®åˆ°è¾¾çš„é˜Ÿåˆ—ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hpe5c8o3j21q00h4q4p.jpg" alt="image-20220421221807577"></p>
<p>å¯ä»¥çœ‹åˆ°å½“å‰é˜Ÿåˆ—ç›´æ¥ç»‘å®šåˆ°äº†æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„äº¤æ¢æœºä¸Šï¼Œå¹¶ä¸”<code>routingKey</code>æ˜¯ç›´æ¥å†™çš„<code>#</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¼šæ¶ˆæ¯ä¼šç›´æ¥è¿‡æ¥ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å†æ¥è®¿é—®ä¸€äº›æ¶ˆæ¯å‘é€æ¥å£ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hpfpyn57j212m05y3z4.jpg" alt="image-20220421221938730"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hpfyqu94j21na09kwg3.jpg" alt="image-20220421221952663"></p>
<p>å¯ä»¥çœ‹åˆ°æ¶ˆè´¹è€…æˆåŠŸåœ°è¿›è¡Œæ¶ˆè´¹äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hpgb6zgej218605qq4d.jpg" alt="image-20220421222011924"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±é€šè¿‡ä½¿ç”¨SpringCloud Streamæ¥å±è”½æ‰åº•å±‚RabbitMQæ¥ç›´æ¥è¿›è¡Œæ¶ˆæ¯çš„æ“ä½œäº†ã€‚</p>
<h3 id="SpringCloud-Bus"><a href="#SpringCloud-Bus" class="headerlink" title="SpringCloud Bus"></a>SpringCloud Bus</h3><p><strong>å®˜æ–¹æ–‡æ¡£ï¼š</strong><a href="https://cloud.spring.io/spring-cloud-bus/reference/html/">https://cloud.spring.io/spring-cloud-bus/reference/html/</a></p>
<p>å®é™…ä¸Šå®ƒå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªæ¶ˆæ¯æ€»çº¿ï¼Œå¯ç”¨äºå‘å„ä¸ªæœåŠ¡å¹¿æ’­æŸäº›çŠ¶æ€çš„æ›´æ”¹ï¼ˆæ¯”å¦‚äº‘ç«¯é…ç½®æ›´æ”¹ï¼Œå¯ä»¥ç»“åˆConfigç»„ä»¶å®ç°åŠ¨æ€æ›´æ–°é…ç½®ï¼Œå½“ç„¶æˆ‘ä»¬å‰é¢å­¦ä¹ çš„Nacoså…¶å®å·²ç»åŒ…å«è¿™ä¸ªåŠŸèƒ½äº†ï¼‰æˆ–å…¶ä»–ç®¡ç†æŒ‡ä»¤ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä¹Ÿæ˜¯ç®€å•ä½¿ç”¨ä¸€ä¸‹å§ï¼ŒBuséœ€è¦åŸºäºä¸€ä¸ªå…·ä½“çš„æ¶ˆæ¯é˜Ÿåˆ—å®ç°ï¼Œæ¯”å¦‚RabbitMQæˆ–æ˜¯Kafkaï¼Œè¿™é‡Œæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨RabbitMQã€‚</p>
<p>æˆ‘ä»¬å°†æœ€å¼€å§‹çš„å¾®æœåŠ¡æ‹†åˆ†é¡¹ç›®ç»§ç»­ä½¿ç”¨ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬å¸Œæœ›å€Ÿé˜…æœåŠ¡çš„æŸä¸ªæ¥å£è°ƒç”¨æ—¶ï¼Œèƒ½å¤Ÿç»™ç”¨æˆ·æœåŠ¡å’Œå›¾ä¹¦æœåŠ¡å‘é€ä¸€ä¸ªé€šçŸ¥ï¼Œé¦–å…ˆæ˜¯ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å°†RabbitMQçš„ç›¸å…³ä¿¡æ¯é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">addresses:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.6</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/test</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span>    <span class="comment">#æš´éœ²ç«¯ç‚¹ï¼Œä¸€ä¼šç”¨äºæé†’åˆ·æ–°</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯åŠ¨æˆ‘ä»¬çš„ä¸‰ä¸ªæœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ç®¡ç†é¢æ¿ä¸­ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hr7w6mluj210m01qq2x.jpg" alt="image-20220421232118952"></p>
<p>æ–°å¢äº†springCloudBugè¿™æ ·ä¸€ä¸ªäº¤æ¢æœºï¼Œå¹¶ä¸”ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hr8d3b38j21uo084411.jpg" alt="image-20220421232146646"></p>
<p>è‡ªåŠ¨ç”Ÿæˆäº†å„è‡ªçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™æ ·å°±å¯ä»¥ç›‘å¬å¹¶æ¥æ”¶åˆ°æ¶ˆæ¯äº†ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬è®¿é—®ä¸€ä¸ªç«¯å£ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hrj15tx4j227m0k0gqo.jpg" alt="image-20220421233200950"></p>
<p>æ­¤ç«¯å£æ˜¯ç”¨äºé€šçŸ¥åˆ«äººè¿›è¡Œåˆ·æ–°ï¼Œå¯ä»¥çœ‹åˆ°è°ƒç”¨ä¹‹åï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­æˆåŠŸå‡ºç°äº†ä¸€æ¬¡æ¶ˆè´¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1hrk3h5xrj21rk0aegna.jpg" alt="image-20220421233302328"></p>
<p>ç°åœ¨æˆ‘ä»¬ç»“åˆä¹‹å‰ä½¿ç”¨çš„Configé…ç½®ä¸­å¿ƒï¼Œæ¥çœ‹çœ‹æ˜¯ä¸æ˜¯å¯ä»¥åšåˆ°é€šçŸ¥ä¹‹åæ‰€æœ‰çš„é…ç½®åŠ¨æ€åˆ·æ–°äº†ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>spring cloud</tag>
      </tags>
  </entry>
  <entry>
    <title>springBootç¬”è®°-4</title>
    <url>/2022/04/26/SpringBoot%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89/</url>
    <content><![CDATA[<h1 id="SpringBootå…¶ä»–æ¡†æ¶"><a href="#SpringBootå…¶ä»–æ¡†æ¶" class="headerlink" title="SpringBootå…¶ä»–æ¡†æ¶"></a>SpringBootå…¶ä»–æ¡†æ¶</h1><p>é€šè¿‡äº†è§£å…¶ä»–çš„SpringBootæ¡†æ¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æˆ‘ä»¬è‡ªå·±çš„WebæœåŠ¡å™¨ä¸Šå®ç°æ›´å¤šæ›´é«˜çº§çš„åŠŸèƒ½ã€‚</p>
<h2 id="é‚®ä»¶å‘é€ï¼šMail"><a href="#é‚®ä»¶å‘é€ï¼šMail" class="headerlink" title="é‚®ä»¶å‘é€ï¼šMail"></a>é‚®ä»¶å‘é€ï¼šMail</h2><p>æˆ‘ä»¬åœ¨æ³¨å†Œå¾ˆå¤šçš„ç½‘ç«™æ—¶ï¼Œéƒ½ä¼šé‡åˆ°é‚®ä»¶æˆ–æ˜¯æ‰‹æœºå·éªŒè¯ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä½ çš„é‚®ç®±æˆ–æ˜¯æ‰‹æœºçŸ­ä¿¡å»æ¥å—ç½‘ç«™å‘ç»™ä½ çš„æ³¨å†ŒéªŒè¯ä¿¡æ¯ï¼Œå¡«å†™éªŒè¯ç ä¹‹åï¼Œå°±å¯ä»¥å®Œæˆæ³¨å†Œäº†ï¼ŒåŒæ—¶ï¼Œç½‘ç«™ä¹Ÿä¼šç»‘å®šä½ çš„æ‰‹æœºå·æˆ–æ˜¯é‚®ç®±ã€‚</p>
<p>é‚£ä¹ˆï¼Œåƒè¿™æ ·çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¦‚ä½•å®ç°å‘¢ï¼ŸSpringBootå·²ç»ç»™æˆ‘ä»¬æä¾›äº†å°è£…å¥½çš„é‚®ä»¶æ¨¡å—ä½¿ç”¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="é‚®ä»¶å‘é€"><a href="#é‚®ä»¶å‘é€" class="headerlink" title="é‚®ä»¶å‘é€"></a>é‚®ä»¶å‘é€</h3><span id="more"></span>

<p>åœ¨å­¦ä¹ é‚®ä»¶å‘é€ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç”µå­é‚®ä»¶ã€‚</p>
<p>ç”µå­é‚®ä»¶ä¹Ÿæ˜¯ä¸€ç§é€šä¿¡æ–¹å¼ï¼Œæ˜¯äº’è”ç½‘åº”ç”¨æœ€å¹¿çš„æœåŠ¡ã€‚é€šè¿‡ç½‘ç»œçš„ç”µå­é‚®ä»¶ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥ä»¥éå¸¸ä½å»‰çš„ä»·æ ¼ï¼ˆä¸ç®¡å‘é€åˆ°å“ªé‡Œï¼Œéƒ½åªéœ€è´Ÿæ‹…ç½‘è´¹ï¼Œå®é™…ä¸Šå°±æ˜¯æŠŠä¿¡æ¯å‘é€åˆ°å¯¹æ–¹æœåŠ¡å™¨è€Œå·²ï¼‰ã€éå¸¸å¿«é€Ÿçš„æ–¹å¼ï¼Œä¸ä¸–ç•Œä¸Šä»»ä½•ä¸€ä¸ªåœ°æ–¹çš„ç”µå­é‚®ç®±ç”¨æˆ·è”ç³»ã€‚</p>
<p>è™½è¯´æ–¹ä¾¿å€’æ˜¯æ–¹ä¾¿ï¼Œè™½ç„¶æ˜¯æ›¾ç»çš„éœ¸ä¸»ï¼Œä¸è¿‡ç°åœ¨è¿™ä¸ªæ—¶ä»£ï¼ŒQQå¾®ä¿¡æ¨ªè¡Œï¼Œæ‰‹æœºçŸ­ä¿¡å’Œç”µå­é‚®ç®±è²Œä¼¼å°±åªå‰©æ”¶éªŒè¯ç è¿™ä¸€ä¸ªåŠŸèƒ½äº†ã€‚</p>
<p>è¦åœ¨Internetä¸Šæä¾›ç”µå­é‚®ä»¶åŠŸèƒ½ï¼Œå¿…é¡»æœ‰ä¸“é—¨çš„ç”µå­é‚®ä»¶æœåŠ¡å™¨ã€‚ä¾‹å¦‚ç°åœ¨Internetå¾ˆå¤šæä¾›é‚®ä»¶æœåŠ¡çš„å‚å•†ï¼šæ–°æµªã€æœç‹ã€163ã€QQé‚®ç®±ç­‰ï¼Œä»–ä»¬éƒ½æœ‰è‡ªå·±çš„é‚®ä»¶æœåŠ¡å™¨ã€‚è¿™äº›æœåŠ¡å™¨ç±»ä¼¼äºç°å®ç”Ÿæ´»ä¸­çš„é‚®å±€ï¼Œå®ƒä¸»è¦è´Ÿè´£æ¥æ”¶ç”¨æˆ·æŠ•é€’è¿‡æ¥çš„é‚®ä»¶ï¼Œå¹¶æŠŠé‚®ä»¶æŠ•é€’åˆ°é‚®ä»¶æ¥æ”¶è€…çš„ç”µå­é‚®ç®±ä¸­ã€‚</p>
<p>æ‰€æœ‰çš„ç”¨æˆ·éƒ½å¯ä»¥åœ¨ç”µå­é‚®ä»¶æœåŠ¡å™¨ä¸Šç”³è¯·ä¸€ä¸ªè´¦å·ç”¨äºé‚®ä»¶å‘é€å’Œæ¥æ”¶ï¼Œé‚£ä¹ˆé‚®ä»¶æ˜¯ä»¥ä»€ä¹ˆæ ·çš„æ ¼å¼å‘é€çš„å‘¢ï¼Ÿå®é™…ä¸Šå’ŒHttpä¸€æ ·ï¼Œé‚®ä»¶å‘é€ä¹Ÿæœ‰è‡ªå·±çš„åè®®ï¼Œä¹Ÿå°±æ˜¯çº¦å®šé‚®ä»¶æ•°æ®é•¿å•¥æ ·ä»¥åŠå¦‚ä½•é€šä¿¡ã€‚</p>
<p><img src="https://images2015.cnblogs.com/blog/851491/201612/851491-20161202143243756-1715308358.png" alt="img"></p>
<p>æ¯”è¾ƒå¸¸ç”¨çš„åè®®æœ‰ä¸¤ç§ï¼š</p>
<ol>
<li>SMTPåè®®ï¼ˆä¸»è¦ç”¨äºå‘é€é‚®ä»¶ Simple Mail Transfer Protocolï¼‰</li>
<li>POP3åè®®ï¼ˆä¸»è¦ç”¨äºæ¥æ”¶é‚®ä»¶ Post Office Protocol 3ï¼‰</li>
</ol>
<p>æ•´ä¸ªå‘é€/æ¥æ”¶æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<p><img src="https://img2.baidu.com/it/u=3675146129,445744702&fm=253&fmt=auto&app=138&f=JPG?w=812&h=309" alt="img"></p>
<p>å®é™…ä¸Šæ¯ä¸ªé‚®ç®±æœåŠ¡å™¨éƒ½æœ‰ä¸€ä¸ªsmtpå‘é€æœåŠ¡å™¨å’Œpop3æ¥æ”¶æœåŠ¡å™¨ï¼Œæ¯”å¦‚è¦ä»QQé‚®ç®±å‘é€é‚®ä»¶åˆ°163é‚®ç®±ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦é€šè¿‡QQé‚®ç®±å®¢æˆ·ç«¯å‘ŠçŸ¥QQé‚®ç®±çš„smtpæœåŠ¡å™¨æˆ‘ä»¬éœ€è¦å‘é€é‚®ä»¶ï¼Œä»¥åŠé‚®ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼Œç„¶åQQé‚®ç®±çš„smtpæœåŠ¡å™¨å°±ä¼šå¸®åŠ©æˆ‘ä»¬å‘é€åˆ°163é‚®ç®±çš„pop3æœåŠ¡å™¨ä¸Šï¼Œ163é‚®ç®±ä¼šé€šè¿‡163é‚®ç®±å®¢æˆ·ç«¯å‘ŠçŸ¥å¯¹åº”ç”¨æˆ·æ”¶åˆ°ä¸€å°æ–°é‚®ä»¶ã€‚</p>
<p>è€Œæˆ‘ä»¬å¦‚æœæƒ³è¦å®ç°ç»™åˆ«äººå‘é€é‚®ä»¶ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿æ¥åˆ°å¯¹åº”ç”µå­é‚®ç®±çš„smtpæœåŠ¡å™¨ä¸Šï¼Œå¹¶å‘ŠçŸ¥å…¶æˆ‘ä»¬è¦å‘é€é‚®ä»¶ã€‚è€ŒSpringBootå·²ç»å¸®åŠ©æˆ‘ä»¬å°†æœ€åŸºæœ¬çš„åº•å±‚é€šä¿¡å…¨éƒ¨å®ç°äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒsmtpæœåŠ¡å™¨çš„åœ°å€ä»¥åŠæˆ‘ä»¬è¦å‘é€çš„é‚®ä»¶é•¿å•¥æ ·å³å¯ã€‚</p>
<p>è¿™é‡Œä»¥163é‚®ç®± <a href="https://mail.163.com/">https://mail.163.com</a> ä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å‘Šè¯‰SpringBootMailæˆ‘ä»¬çš„smtpæœåŠ¡å™¨çš„åœ°å€ä»¥åŠä½ çš„é‚®ç®±è´¦å·å’Œå¯†ç ï¼Œé¦–å…ˆæˆ‘ä»¬è¦å»è®¾ç½®ä¸­å¼€å¯smtp/pop3æœåŠ¡æ‰å¯ä»¥ï¼Œå¼€å¯åä¼šå¾—åˆ°ä¸€ä¸ªéšæœºç”Ÿæˆçš„å¯†é’¥ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„å¯†ç ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">  	<span class="comment"># 163é‚®ç®±çš„åœ°å€ä¸ºsmtp.163.comï¼Œç›´æ¥å¡«å†™å³å¯</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.163.com</span></span><br><span class="line">    <span class="comment"># ä½ ç”³è¯·çš„163é‚®ç®±</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">javastudy111@163.com</span></span><br><span class="line">    <span class="comment"># æ³¨æ„å¯†ç æ˜¯åœ¨å¼€å¯smtp/pop3æ—¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè®°å¾—ä¿å­˜ä¸€ä¸‹ï¼Œä¸ç„¶å°±æ‰¾ä¸åˆ°äº†</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">AZJTOAWZESLMHTNI</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œæˆåï¼Œæ¥ç€æˆ‘ä»¬æ¥è¿›è¡Œä¸€ä¸‹æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringBootTestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//JavaMailSenderæ˜¯ä¸“é—¨ç”¨äºå‘é€é‚®ä»¶çš„å¯¹è±¡ï¼Œè‡ªåŠ¨é…ç½®ç±»å·²ç»æä¾›äº†Bean</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JavaMailSender sender;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">      	<span class="comment">//SimpleMailMessageæ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€æ˜“çš„é‚®ä»¶å°è£…ï¼Œæ”¯æŒè®¾ç½®ä¸€äº›æ¯”è¾ƒç®€å•å†…å®¹</span></span><br><span class="line">        <span class="type">SimpleMailMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleMailMessage</span>();</span><br><span class="line">      	<span class="comment">//è®¾ç½®é‚®ä»¶æ ‡é¢˜</span></span><br><span class="line">        message.setSubject(<span class="string">&quot;ã€ç”µå­ç§‘æŠ€å¤§å­¦æ•™åŠ¡å¤„ã€‘å…³äºè¿‘æœŸå­¦æ ¡å¯¹æ‚¨çš„å¤„åˆ†å†³å®š&quot;</span>);</span><br><span class="line">      	<span class="comment">//è®¾ç½®é‚®ä»¶å†…å®¹</span></span><br><span class="line">        message.setText(<span class="string">&quot;XXXåŒå­¦æ‚¨å¥½ï¼Œç»ç›‘æ§å’Œæ•™åŠ¡å·¡æŸ¥å‘ç°ï¼Œæ‚¨è¿‘æœŸå­˜åœ¨æ—·è¯¾ã€è¿Ÿåˆ°ã€æ—©é€€ã€ä¸Šè¯¾åˆ·æŠ–éŸ³è¡Œä¸ºï¼Œ&quot;</span> +</span><br><span class="line">                <span class="string">&quot;ç°å·²é€šçŸ¥ç›¸å…³è¾…å¯¼å‘˜ï¼Œè¯·æ‰‹å†™5000å­—ä¹¦é¢æ£€è®¨ï¼Œå¹¶åœ¨2022å¹´4æœˆ1æ—¥17ç‚¹å‰äº¤åˆ°è¾…å¯¼å‘˜åŠå…¬å®¤ã€‚&quot;</span>);</span><br><span class="line">      	<span class="comment">//è®¾ç½®é‚®ä»¶å‘é€ç»™è°ï¼Œå¯ä»¥å¤šä¸ªï¼Œè¿™é‡Œå°±å‘ç»™ä½ çš„QQé‚®ç®±</span></span><br><span class="line">        message.setTo(<span class="string">&quot;ä½ çš„QQå·@qq.com&quot;</span>);</span><br><span class="line">      	<span class="comment">//é‚®ä»¶å‘é€è€…ï¼Œè¿™é‡Œè¦ä¸é…ç½®æ–‡ä»¶ä¸­çš„ä¿æŒä¸€è‡´</span></span><br><span class="line">        message.setFrom(<span class="string">&quot;javastudy111@163.com&quot;</span>);</span><br><span class="line">      	<span class="comment">//OKï¼Œä¸‡äº‹ä¿±å¤‡åªæ¬ å‘é€</span></span><br><span class="line">        sender.send(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœéœ€è¦æ·»åŠ é™„ä»¶ç­‰æ›´å¤šåŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨MimeMessageHelperæ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> MessagingException &#123;</span><br><span class="line">  	<span class="comment">//åˆ›å»ºä¸€ä¸ªMimeMessage</span></span><br><span class="line">    <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> sender.createMimeMessage();</span><br><span class="line">  	<span class="comment">//ä½¿ç”¨MimeMessageHelperæ¥å¸®æˆ‘ä»¬ä¿®æ”¹MimeMessageä¸­çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>);</span><br><span class="line">    helper.setSubject(<span class="string">&quot;Test&quot;</span>);</span><br><span class="line">    helper.setText(<span class="string">&quot;lbwnb&quot;</span>);</span><br><span class="line">    helper.setTo(<span class="string">&quot;ä½ çš„QQå·@qq.com&quot;</span>);</span><br><span class="line">    helper.setFrom(<span class="string">&quot;javastudy111@163.com&quot;</span>);</span><br><span class="line">  	<span class="comment">//å‘é€ä¿®æ”¹å¥½çš„MimeMessage</span></span><br><span class="line">    sender.send(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é‚®ä»¶æ³¨å†Œ"><a href="#é‚®ä»¶æ³¨å†Œ" class="headerlink" title="é‚®ä»¶æ³¨å†Œ"></a>é‚®ä»¶æ³¨å†Œ</h3><p>æ—¢ç„¶æˆ‘ä»¬å·²ç»äº†è§£äº†é‚®ä»¶å‘é€ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­å®ç°é‚®ä»¶éªŒè¯ã€‚</p>
<p>é¦–å…ˆæ˜ç¡®éªŒè¯æµç¨‹ï¼šè¯·æ±‚éªŒè¯ç  -&gt; ç”ŸæˆéªŒè¯ç ï¼ˆä¸´æ—¶æœ‰æ•ˆï¼Œæ³¨æ„è®¾å®šè¿‡æœŸæ—¶é—´ï¼‰ -&gt; ç”¨æˆ·è¾“å…¥éªŒè¯ç å¹¶å¡«å†™æ³¨å†Œä¿¡æ¯ -&gt; éªŒè¯é€šè¿‡æ³¨å†ŒæˆåŠŸï¼</p>
<hr>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic1.zhimg.com%2Fv2-6f0b9bb234b2534ec295ff195bad183a_1440w.jpg%3Fsource%3D172ae18b&refer=http%3A%2F%2Fpic1.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1645108924&t=d40aa5dc6be398725b4ff21ef5895454" alt="ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡æ¥æº"></p>
<h2 id="æŒä¹…å±‚æ¡†æ¶ï¼šJPA"><a href="#æŒä¹…å±‚æ¡†æ¶ï¼šJPA" class="headerlink" title="æŒä¹…å±‚æ¡†æ¶ï¼šJPA"></a>æŒä¹…å±‚æ¡†æ¶ï¼šJPA</h2><ul>
<li>ç”¨äº†Mybatisä¹‹åï¼Œä½ çœ‹é‚£ä¸ªJDBCï¼ŒçœŸæ˜¯å¤ªé€Šäº†ã€‚</li>
<li>è¿™ä¹ˆè¯´ï¼Œä½ çš„é¡¹ç›®å¾ˆå‹‡å“¦ï¼Ÿ</li>
<li>å¼€ç©ç¬‘ï¼Œæˆ‘çš„å†™ä»£ç è¶…å‹‡çš„å¥½ä¸å¥½ã€‚</li>
<li>é˜¿ä¼Ÿï¼Œä½ å¯æ›¾å¹»æƒ³è¿‡æœ‰ä¸€å¤©ä½ çš„é¡¹ç›®é‡Œä¸å†æœ‰SQLè¯­å¥ï¼Ÿ</li>
<li>ä¸å†æœ‰SQLè¯­å¥ï¼Ÿé‚£æˆ‘æ€ä¹ˆå’Œæ•°æ®åº“äº¤äº’å•Šï¼Ÿ</li>
<li>æˆ‘çœ‹ä½ æ˜¯å®Œå…¨ä¸æ‡‚å“¦</li>
<li>æ‡‚ï¼Œæ‡‚ä»€ä¹ˆå•Šï¼Ÿ</li>
<li>ä½ æƒ³æ‡‚ï¼Ÿæ¥ï¼Œåˆ°æˆ‘é¡¹ç›®é‡Œæ¥ï¼Œæˆ‘ç»™ä½ çœ‹ç‚¹å¥½åº·çš„ã€‚</li>
<li>å¥½åº·ï¼Ÿæ˜¯ä»€ä¹ˆæ–°æ¡†æ¶å“¦ï¼Ÿ</li>
<li>ä»€ä¹ˆæ–°æ¡†æ¶ï¼Œæ¯”æ–°æ¡†æ¶è¿˜åˆºæ¿€ï¼Œè¿˜å¯ä»¥è®©ä½ çš„é¡¹ç›®ç™»duangéƒå“¦ã€‚</li>
<li>å“‡ï¼Œæ°å“¥ï¼Œä½ é¡¹ç›®é‡Œé¢éƒ½æ²¡SQLè¯­å¥è¯¶ï¼Œè¿™æ˜¯ç”¨çš„ä»€ä¹ˆæ¡†æ¶å•Šï¼Ÿ</li>
</ul>
<p>åœ¨æˆ‘ä»¬ä¹‹å‰ç¼–å†™çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œå®é™…ä¸Šå¤§éƒ¨åˆ†çš„æ•°æ®åº“äº¤äº’æ“ä½œï¼Œåˆ°æœ€åéƒ½åªä¼šåšä¸€ä¸ªäº‹æƒ…ï¼Œé‚£å°±æ˜¯æŠŠæ•°æ®åº“ä¸­çš„æ•°æ®æ˜ å°„ä¸ºJavaä¸­çš„å¯¹è±¡ã€‚æ¯”å¦‚æˆ‘ä»¬è¦é€šè¿‡ç”¨æˆ·åå»æŸ¥æ‰¾å¯¹åº”çš„ç”¨æˆ·ï¼Œæˆ–æ˜¯é€šè¿‡IDæŸ¥æ‰¾å¯¹åº”çš„å­¦ç”Ÿä¿¡æ¯ï¼Œåœ¨ä½¿ç”¨Mybatisæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™æ­£ç¡®çš„SQLè¯­å¥å°±å¯ä»¥ç›´æ¥å°†è·å–çš„æ•°æ®æ˜ å°„ä¸ºå¯¹åº”çš„Javaå¯¹è±¡ï¼Œé€šè¿‡è°ƒç”¨Mapperä¸­çš„æ–¹æ³•å°±èƒ½ç›´æ¥è·å¾—å®ä½“ç±»ï¼Œè¿™æ ·å°±æ–¹ä¾¿æˆ‘ä»¬åœ¨Javaä¸­æ•°æ®åº“è¡¨ä¸­çš„ç›¸å…³ä¿¡æ¯äº†ã€‚</p>
<p>ä½†æ˜¯ä»¥ä¸Šè¿™äº›æ“ä½œéƒ½æœ‰ä¸€ä¸ªå…±æ€§ï¼Œé‚£å°±æ˜¯å®ƒä»¬éƒ½æ˜¯é€šè¿‡æŸç§æ¡ä»¶å»è¿›è¡ŒæŸ¥è¯¢ï¼Œè€Œæœ€åçš„æŸ¥è¯¢ç»“æœï¼Œéƒ½æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼Œæ‰€ä»¥ä½ ä¼šå‘ç°ä½ å†™çš„å¾ˆå¤šSQLè¯­å¥éƒ½æ˜¯ä¸€ä¸ªå¥—è·¯<code>select * from xxx where xxx=xxx</code>ï¼Œé‚£ä¹ˆèƒ½å¦æœ‰ä¸€ç§æ¡†æ¶ï¼Œå¸®æˆ‘ä»¬æŠŠè¿™äº›ç›¸åŒçš„å¥—è·¯ç»™å°è£…èµ·æ¥ï¼Œç›´æ¥æŠŠè¿™ç±»ç›¸ä¼¼çš„SQLè¯­å¥ç»™å±è”½æ‰ï¼Œä¸å†ç”±æˆ‘ä»¬ç¼–å†™ï¼Œè€Œæ˜¯è®©æ¡†æ¶è‡ªå·±å»ç»„åˆæ‹¼æ¥ã€‚</p>
<h3 id="è®¤è¯†SpringDataJPA"><a href="#è®¤è¯†SpringDataJPA" class="headerlink" title="è®¤è¯†SpringDataJPA"></a>è®¤è¯†SpringDataJPA</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå›½å¤–çš„ç»Ÿè®¡ï¼š</p>
<p>![image-20220119140326867](/Users/nagocoler/Library/Application Support/typora-user-images/image-20220119140326867.png)</p>
<p>ä¸å¯¹å§ï¼Œä¸ºä»€ä¹ˆMybatisè¿™ä¹ˆå¥½ç”¨ï¼Œè¿™ä¹ˆå¼ºå¤§ï¼Œå´åªæœ‰10%çš„äººå–œæ¬¢å‘¢ï¼Ÿç„¶è€Œäº‹å®å°±æ˜¯ï¼Œåœ¨å›½å¤–JPAå‡ ä¹å æ®äº†ä¸»å¯¼åœ°ä½ï¼Œè€ŒMybatiså¹¶ä¸åƒå›½å†…é‚£æ ·å—å¾…è§ï¼Œæ‰€ä»¥ä½ ä¼šå‘ç°ï¼ŒJPAéƒ½æœ‰SpringBootçš„å®˜æ–¹ç›´æ¥æä¾›çš„starterï¼Œè€ŒMybatisæ²¡æœ‰ã€‚</p>
<p>è‡³äºä¸ºå•¥SSMé˜¶æ®µä¸è®²è¿™ä¸ªï¼Œè€Œæ˜¯æ”¾åˆ°ç°åœ¨æ¥è®²ä¹Ÿæ˜¯å› ä¸ºï¼Œåœ¨å¾®æœåŠ¡åœºæ™¯ä¸‹å®ƒçš„ä¼˜åŠ¿æ‰èƒ½æ›´å¤šçš„å‘æŒ¥å‡ºæ¥ã€‚</p>
<p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯JPAï¼Ÿ</p>
<p>JPAï¼ˆJava Persistence APIï¼‰å’ŒJDBCç±»ä¼¼ï¼Œä¹Ÿæ˜¯å®˜æ–¹å®šä¹‰çš„ä¸€ç»„æ¥å£ï¼Œä½†æ˜¯å®ƒç›¸æ¯”ä¼ ç»Ÿçš„JDBCï¼Œå®ƒæ˜¯ä¸ºäº†å®ç°ORMè€Œç”Ÿçš„ï¼Œå³Object-Relationl Mappingï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨å…³ç³»å‹æ•°æ®åº“å’Œå¯¹è±¡ä¹‹é—´å½¢æˆä¸€ä¸ªæ˜ å°„ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬åœ¨å…·ä½“çš„æ“ä½œæ•°æ®åº“çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦å†å»å’Œå¤æ‚çš„SQLè¯­å¥æ‰“äº¤é“ï¼Œåªè¦åƒå¹³æ—¶æ“ä½œå¯¹è±¡ä¸€æ ·æ“ä½œå®ƒå°±å¯ä»¥äº†ã€‚</p>
<p>åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨JDBCæˆ–æ˜¯Mybatisæ¥æ“ä½œæ•°æ®ï¼Œé€šè¿‡ç›´æ¥ç¼–å†™å¯¹åº”çš„SQLè¯­å¥æ¥å®ç°æ•°æ®è®¿é—®ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°å®é™…ä¸Šæˆ‘ä»¬åœ¨Javaä¸­å¤§éƒ¨åˆ†æ“ä½œæ•°æ®åº“çš„æƒ…å†µéƒ½æ˜¯è¯»å–æ•°æ®å¹¶å°è£…ä¸ºä¸€ä¸ªå®ä½“ç±»ï¼Œå› æ­¤ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å°†å®ä½“ç±»ç›´æ¥å¯¹åº”åˆ°ä¸€ä¸ªæ•°æ®åº“è¡¨å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€å¼ è¡¨é‡Œé¢æœ‰ä»€ä¹ˆå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å¯¹è±¡å°±æœ‰ä»€ä¹ˆå±æ€§ï¼Œæ‰€æœ‰å±æ€§è·Ÿæ•°æ®åº“é‡Œé¢çš„å­—æ®µä¸€ä¸€å¯¹åº”ï¼Œè€Œè¯»å–æ•°æ®æ—¶ï¼Œåªéœ€è¦è¯»å–ä¸€è¡Œçš„æ•°æ®å¹¶å°è£…ä¸ºæˆ‘ä»¬å®šä¹‰å¥½çš„å®ä½“ç±»æ—¢å¯ä»¥ï¼Œè€Œå…·ä½“çš„SQLè¯­å¥æ‰§è¡Œï¼Œå®Œå…¨å¯ä»¥äº¤ç»™æ¡†æ¶æ ¹æ®æˆ‘ä»¬å®šä¹‰çš„æ˜ å°„å…³ç³»å»ç”Ÿæˆï¼Œä¸å†ç”±æˆ‘ä»¬å»ç¼–å†™ï¼Œå› ä¸ºè¿™äº›SQLå®é™…ä¸Šéƒ½æ˜¯åƒç¯‡ä¸€å¾‹çš„ã€‚</p>
<p>è€Œå®ç°JPAè§„èŒƒçš„æ¡†æ¶ä¸€èˆ¬æœ€å¸¸ç”¨çš„å°±æ˜¯<code>Hibernate</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªé‡é‡çº§æ¡†æ¶ï¼Œå­¦ä¹ éš¾åº¦ç›¸æ¯”Mybatisä¹Ÿæ›´é«˜ä¸€äº›ï¼Œè€ŒSpringDataJPAä¹Ÿæ˜¯é‡‡ç”¨Hibernateæ¡†æ¶ä½œä¸ºåº•å±‚å®ç°ï¼Œå¹¶å¯¹å…¶åŠ ä»¥å°è£…ã€‚</p>
<p>å®˜ç½‘ï¼š<a href="https://spring.io/projects/spring-data-jpa">https://spring.io/projects/spring-data-jpa</a></p>
<h3 id="ä½¿ç”¨JPA"><a href="#ä½¿ç”¨JPA" class="headerlink" title="ä½¿ç”¨JPA"></a>ä½¿ç”¨JPA</h3><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¼å…¥staterä¾èµ–å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªç±»ï¼Œæ¯”å¦‚è´¦æˆ·ç±»ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠä¸€ä¸ªè´¦å·å¯¹åº”çš„å±æ€§å…¨éƒ¨å®šä¹‰å¥½å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String username;</span><br><span class="line">    String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨è§£å½¢å¼ï¼Œåœ¨å±æ€§ä¸Šæ·»åŠ æ•°æ®åº“æ˜ å°„å…³ç³»ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè®©JPAçŸ¥é“æˆ‘ä»¬çš„å®ä½“ç±»å¯¹åº”çš„æ•°æ®åº“è¡¨é•¿å•¥æ ·ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span>   <span class="comment">//è¡¨ç¤ºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªå®ä½“ç±»</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;)</span>    <span class="comment">//å¯¹åº”çš„æ•°æ®åº“ä¸­è¡¨åç§°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>   <span class="comment">//ç”Ÿæˆç­–ç•¥ï¼Œè¿™é‡Œé…ç½®ä¸ºè‡ªå¢</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span>    <span class="comment">//å¯¹åº”è¡¨ä¸­idè¿™ä¸€åˆ—</span></span><br><span class="line">    <span class="meta">@Id</span>     <span class="comment">//æ­¤å±æ€§ä¸ºä¸»é”®</span></span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;username&quot;)</span>   <span class="comment">//å¯¹åº”è¡¨ä¸­usernameè¿™ä¸€åˆ—</span></span><br><span class="line">    String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;password&quot;)</span>   <span class="comment">//å¯¹åº”è¡¨ä¸­passwordè¿™ä¸€åˆ—</span></span><br><span class="line">    String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">		<span class="comment">#å¼€å¯SQLè¯­å¥æ‰§è¡Œæ—¥å¿—ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">    	<span class="comment">#é…ç½®ä¸ºè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">create</span></span><br></pre></td></tr></table></figure>

<p><code>ddl-auto</code>å±æ€§ç”¨äºè®¾ç½®è‡ªåŠ¨è¡¨å®šä¹‰ï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åœ¨æ•°æ®åº“ä¸­ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œè¡¨çš„ç»“æ„ä¼šæ ¹æ®æˆ‘ä»¬å®šä¹‰çš„å®ä½“ç±»å†³å®šï¼Œå®ƒæœ‰4ç§</p>
<ul>
<li>create å¯åŠ¨æ—¶åˆ æ•°æ®åº“ä¸­çš„è¡¨ï¼Œç„¶ååˆ›å»ºï¼Œé€€å‡ºæ—¶ä¸åˆ é™¤æ•°æ®è¡¨ </li>
<li>create-drop å¯åŠ¨æ—¶åˆ æ•°æ®åº“ä¸­çš„è¡¨ï¼Œç„¶ååˆ›å»ºï¼Œé€€å‡ºæ—¶åˆ é™¤æ•°æ®è¡¨ å¦‚æœè¡¨ä¸å­˜åœ¨æŠ¥é”™ </li>
<li>update å¦‚æœå¯åŠ¨æ—¶è¡¨æ ¼å¼ä¸ä¸€è‡´åˆ™æ›´æ–°è¡¨ï¼ŒåŸæœ‰æ•°æ®ä¿ç•™ </li>
<li>validate é¡¹ç›®å¯åŠ¨è¡¨ç»“æ„è¿›è¡Œæ ¡éªŒ å¦‚æœä¸ä¸€è‡´åˆ™æŠ¥é”™</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æ—¥å¿—ä¸­å‘ç°ï¼Œåœ¨å¯åŠ¨æ—¶æ‰§è¡Œäº†å¦‚ä¸‹SQLè¯­å¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Hibernate: create table users (id integer not null auto_increment, password varchar(255), username varchar(255), primary key (id)) engine=InnoDB</span><br></pre></td></tr></table></figure>

<p>è€Œæˆ‘ä»¬çš„æ•°æ®åº“ä¸­å¯¹åº”çš„è¡¨å·²ç»åˆ›å»ºå¥½äº†ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•è®¿é—®æˆ‘ä»¬çš„è¡¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªRepositoryå®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Account, Integer&gt; &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„JpaRepositoryæœ‰ä¸¤ä¸ªæ³›å‹ï¼Œå‰è€…æ˜¯å…·ä½“æ“ä½œçš„å¯¹è±¡å®ä½“ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”çš„è¡¨ï¼Œåè€…æ˜¯IDçš„ç±»å‹ï¼Œæ¥å£ä¸­å·²ç»å®šä¹‰äº†æ¯”è¾ƒå¸¸ç”¨çš„æ•°æ®åº“æ“ä½œã€‚ç¼–å†™æ¥å£ç»§æ‰¿å³å¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ³¨å…¥æ­¤æ¥å£è·å¾—å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JpaTestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    AccountRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">      	<span class="comment">//ç›´æ¥æ ¹æ®IDæŸ¥æ‰¾</span></span><br><span class="line">        repository.findById(<span class="number">1</span>).ifPresent(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œåï¼ŒæˆåŠŸå¾—åˆ°æŸ¥è¯¢ç»“æœã€‚æˆ‘ä»¬æ¥ç€æ¥æµ‹è¯•å¢åˆ æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">addAccount</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Account</span>();</span><br><span class="line">    account.setUsername(<span class="string">&quot;Admin&quot;</span>);</span><br><span class="line">    account.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    account = repository.save(account);  <span class="comment">//è¿”å›çš„ç»“æœä¼šåŒ…å«è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®å€¼</span></span><br><span class="line">    System.out.println(<span class="string">&quot;æ’å…¥æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®IDä¸ºï¼š&quot;</span>+account.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteAccount</span><span class="params">()</span>&#123;</span><br><span class="line">    repository.deleteById(<span class="number">2</span>);   <span class="comment">//æ ¹æ®IDåˆ é™¤å¯¹åº”è®°å½•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">pageAccount</span><span class="params">()</span> &#123;</span><br><span class="line">    repository.findAll(PageRequest.of(<span class="number">0</span>, <span class="number">1</span>)).forEach(System.out::println);  <span class="comment">//ç›´æ¥åˆ†é¡µ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œä½¿ç”¨äº†JPAä¹‹åï¼Œæ•´ä¸ªé¡¹ç›®çš„ä»£ç ä¸­æ²¡æœ‰å‡ºç°ä»»ä½•çš„SQLè¯­å¥ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸æ–¹ä¾¿äº†ï¼ŒJPAä¾é æˆ‘ä»¬æä¾›çš„æ³¨è§£ä¿¡æ¯è‡ªåŠ¨å®Œæˆäº†æ‰€æœ‰ä¿¡æ¯çš„æ˜ å°„å’Œå…³è”ã€‚</p>
<p>ç›¸æ¯”Mybatisï¼ŒJPAå‡ ä¹å°±æ˜¯ä¸€ä¸ªå…¨è‡ªåŠ¨çš„ORMæ¡†æ¶ï¼Œè€ŒMybatisåˆ™é¡¶å¤šç®—æ˜¯åŠè‡ªåŠ¨ORMæ¡†æ¶ã€‚</p>
<h3 id="æ–¹æ³•åç§°æ‹¼æ¥è‡ªå®šä¹‰SQL"><a href="#æ–¹æ³•åç§°æ‹¼æ¥è‡ªå®šä¹‰SQL" class="headerlink" title="æ–¹æ³•åç§°æ‹¼æ¥è‡ªå®šä¹‰SQL"></a>æ–¹æ³•åç§°æ‹¼æ¥è‡ªå®šä¹‰SQL</h3><p>è™½ç„¶æ¥å£é¢„ç½®çš„æ–¹æ³•ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦è¿›è¡Œæ¡ä»¶æŸ¥è¯¢ç­‰æ“ä½œæˆ–æ˜¯ä¸€äº›åˆ¤æ–­ï¼Œå°±éœ€è¦è‡ªå®šä¹‰ä¸€äº›æ–¹æ³•æ¥å®ç°ï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç¼–å†™SQLè¯­å¥ï¼Œè€Œæ˜¯é€šè¿‡æ–¹æ³•åç§°çš„æ‹¼æ¥æ¥å®ç°æ¡ä»¶åˆ¤æ–­ï¼Œè¿™é‡Œåˆ—å‡ºäº†æ‰€æœ‰æ”¯æŒçš„æ¡ä»¶åˆ¤æ–­åç§°ï¼š</p>
<table>
<thead>
<tr>
<th><code>Distinct</code></th>
<th><code>findDistinctByLastnameAndFirstname</code></th>
<th><code>select distinct â€¦ where x.lastname = ?1 and x.firstname = ?2</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>And</code></td>
<td><code>findByLastnameAndFirstname</code></td>
<td><code>â€¦ where x.lastname = ?1 and x.firstname = ?2</code></td>
</tr>
<tr>
<td><code>Or</code></td>
<td><code>findByLastnameOrFirstname</code></td>
<td><code>â€¦ where x.lastname = ?1 or x.firstname = ?2</code></td>
</tr>
<tr>
<td><code>Is</code>ï¼Œ<code>Equals</code></td>
<td><code>findByFirstname</code>,<code>findByFirstnameIs</code>,<code>findByFirstnameEquals</code></td>
<td><code>â€¦ where x.firstname = ?1</code></td>
</tr>
<tr>
<td><code>Between</code></td>
<td><code>findByStartDateBetween</code></td>
<td><code>â€¦ where x.startDate between ?1 and ?2</code></td>
</tr>
<tr>
<td><code>LessThan</code></td>
<td><code>findByAgeLessThan</code></td>
<td><code>â€¦ where x.age &lt; ?1</code></td>
</tr>
<tr>
<td><code>LessThanEqual</code></td>
<td><code>findByAgeLessThanEqual</code></td>
<td><code>â€¦ where x.age &lt;= ?1</code></td>
</tr>
<tr>
<td><code>GreaterThan</code></td>
<td><code>findByAgeGreaterThan</code></td>
<td><code>â€¦ where x.age &gt; ?1</code></td>
</tr>
<tr>
<td><code>GreaterThanEqual</code></td>
<td><code>findByAgeGreaterThanEqual</code></td>
<td><code>â€¦ where x.age &gt;= ?1</code></td>
</tr>
<tr>
<td><code>After</code></td>
<td><code>findByStartDateAfter</code></td>
<td><code>â€¦ where x.startDate &gt; ?1</code></td>
</tr>
<tr>
<td><code>Before</code></td>
<td><code>findByStartDateBefore</code></td>
<td><code>â€¦ where x.startDate &lt; ?1</code></td>
</tr>
<tr>
<td><code>IsNull</code>ï¼Œ<code>Null</code></td>
<td><code>findByAge(Is)Null</code></td>
<td><code>â€¦ where x.age is null</code></td>
</tr>
<tr>
<td><code>IsNotNull</code>ï¼Œ<code>NotNull</code></td>
<td><code>findByAge(Is)NotNull</code></td>
<td><code>â€¦ where x.age not null</code></td>
</tr>
<tr>
<td><code>Like</code></td>
<td><code>findByFirstnameLike</code></td>
<td><code>â€¦ where x.firstname like ?1</code></td>
</tr>
<tr>
<td><code>NotLike</code></td>
<td><code>findByFirstnameNotLike</code></td>
<td><code>â€¦ where x.firstname not like ?1</code></td>
</tr>
<tr>
<td><code>StartingWith</code></td>
<td><code>findByFirstnameStartingWith</code></td>
<td><code>â€¦ where x.firstname like ?1</code>ï¼ˆå‚æ•°ä¸é™„åŠ <code>%</code>ç»‘å®šï¼‰</td>
</tr>
<tr>
<td><code>EndingWith</code></td>
<td><code>findByFirstnameEndingWith</code></td>
<td><code>â€¦ where x.firstname like ?1</code>ï¼ˆå‚æ•°ä¸å‰ç¼€<code>%</code>ç»‘å®šï¼‰</td>
</tr>
<tr>
<td><code>Containing</code></td>
<td><code>findByFirstnameContaining</code></td>
<td><code>â€¦ where x.firstname like ?1</code>ï¼ˆå‚æ•°ç»‘å®šä»¥<code>%</code>åŒ…è£…ï¼‰</td>
</tr>
<tr>
<td><code>OrderBy</code></td>
<td><code>findByAgeOrderByLastnameDesc</code></td>
<td><code>â€¦ where x.age = ?1 order by x.lastname desc</code></td>
</tr>
<tr>
<td><code>Not</code></td>
<td><code>findByLastnameNot</code></td>
<td><code>â€¦ where x.lastname &lt;&gt; ?1</code></td>
</tr>
<tr>
<td><code>In</code></td>
<td><code>findByAgeIn(Collection&lt;Age&gt; ages)</code></td>
<td><code>â€¦ where x.age in ?1</code></td>
</tr>
<tr>
<td><code>NotIn</code></td>
<td><code>findByAgeNotIn(Collection&lt;Age&gt; ages)</code></td>
<td><code>â€¦ where x.age not in ?1</code></td>
</tr>
<tr>
<td><code>True</code></td>
<td><code>findByActiveTrue()</code></td>
<td><code>â€¦ where x.active = true</code></td>
</tr>
<tr>
<td><code>False</code></td>
<td><code>findByActiveFalse()</code></td>
<td><code>â€¦ where x.active = false</code></td>
</tr>
<tr>
<td><code>IgnoreCase</code></td>
<td><code>findByFirstnameIgnoreCase</code></td>
<td><code>â€¦ where UPPER(x.firstname) = UPPER(?1)</code></td>
</tr>
</tbody></table>
<p>æ¯”å¦‚æˆ‘ä»¬æƒ³è¦å®ç°æ ¹æ®ç”¨æˆ·åæ¨¡ç³ŠåŒ¹é…æŸ¥æ‰¾ç”¨æˆ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Account, Integer&gt; &#123;</span><br><span class="line">		<span class="comment">//æŒ‰ç…§è¡¨ä¸­çš„è§„åˆ™è¿›è¡Œåç§°æ‹¼æ¥ï¼Œä¸ç”¨åˆ»æ„å»è®°ï¼ŒIDEAä¼šæœ‰æç¤º</span></span><br><span class="line">    List&lt;Account&gt; <span class="title function_">findAllByUsernameLike</span><span class="params">(String str)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    repository.findAllByUsernameLike(<span class="string">&quot;%T%&quot;</span>).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆæ¯”å¦‚æˆ‘ä»¬æƒ³åŒæ—¶æ ¹æ®ç”¨æˆ·åå’ŒIDä¸€èµ·æŸ¥è¯¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Account, Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    Account <span class="title function_">findByIdAndUsername</span><span class="params">(<span class="type">int</span> id, String username)</span>;</span><br><span class="line">  <span class="comment">//å¯ä»¥ä½¿ç”¨Optionalç±»è¿›è¡ŒåŒ…è£…ï¼ŒOptional&lt;Account&gt; findByIdAndUsername(int id, String username);</span></span><br><span class="line">    </span><br><span class="line">    List&lt;Account&gt; <span class="title function_">findAllByUsernameLike</span><span class="params">(String str)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(repository.findByIdAndUsername(<span class="number">1</span>, <span class="string">&quot;Test&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚æˆ‘ä»¬æƒ³åˆ¤æ–­æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªIDçš„ç”¨æˆ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Account, Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    Account <span class="title function_">findByIdAndUsername</span><span class="params">(<span class="type">int</span> id, String username)</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;Account&gt; <span class="title function_">findAllByUsernameLike</span><span class="params">(String str)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">existsAccountById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(repository.existsAccountByUsername(<span class="string">&quot;Test&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„è‡ªå®šä¹‰æ¡ä»¶æ“ä½œçš„æ–¹æ³•åç§°ä¸€å®šè¦éµå¾ªè§„åˆ™ï¼Œä¸ç„¶ä¼šå‡ºç°å¼‚å¸¸ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Caused by: org.springframework.data.repository.query.QueryCreationException: Could not create query for public abstract  ...</span><br></pre></td></tr></table></figure>

<h3 id="å…³è”æŸ¥è¯¢"><a href="#å…³è”æŸ¥è¯¢" class="headerlink" title="å…³è”æŸ¥è¯¢"></a>å…³è”æŸ¥è¯¢</h3><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæ¯”è¾ƒå¸¸è§çš„åœºæ™¯è¿˜æœ‰å…³è”æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼šåœ¨è¡¨ä¸­æ·»åŠ ä¸€ä¸ªå¤–é”®å­—æ®µï¼Œè€Œæ­¤å¤–é”®å­—æ®µåˆæŒ‡å‘äº†å¦ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œå½“æˆ‘ä»¬æŸ¥è¯¢æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šéœ€è¦å°†å…³è”æ•°æ®ä¹Ÿä¸€å¹¶è·å–ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¸€èˆ¬ç”¨æˆ·ç®€ç•¥ä¿¡æ¯ä¼šå•ç‹¬å­˜æ”¾ä¸€ä¸ªè¡¨ï¼Œè€Œç”¨æˆ·è¯¦ç»†ä¿¡æ¯ä¼šå•ç‹¬å­˜æ”¾åœ¨å¦ä¸€ä¸ªè¡¨ä¸­ã€‚å½“ç„¶ï¼Œé™¤äº†ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ä¹‹å¤–ï¼Œå¯èƒ½åœ¨æŸäº›ç”µå•†å¹³å°è¿˜ä¼šæœ‰ç”¨æˆ·çš„è´­ä¹°è®°å½•ã€ç”¨æˆ·çš„è´­ç‰©è½¦ï¼Œäº¤æµç¤¾åŒºä¸­çš„ç”¨æˆ·å¸–å­ã€ç”¨æˆ·è¯„è®ºç­‰ï¼Œè¿™äº›éƒ½æ˜¯éœ€è¦æ ¹æ®ç”¨æˆ·ä¿¡æ¯è¿›è¡Œå…³è”æŸ¥è¯¢çš„å†…å®¹ã€‚</p>
<p><img src="https://img1.baidu.com/it/u=292198351,4011695440&fm=253&fmt=auto&app=138&f=JPEG?w=404&h=436" alt="img"></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨JPAä¸­ï¼Œæ¯å¼ è¡¨å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå®ä½“ç±»çš„æ˜ å°„ï¼Œè€Œè¡¨ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œä¹Ÿå¯ä»¥çœ‹ä½œå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ¯”å¦‚ç”¨æˆ·è¡¨ä¸­åŒ…å«äº†ç”¨æˆ·è¯¦ç»†ä¿¡æ¯çš„IDå­—æ®µä½œä¸ºå¤–é”®ï¼Œé‚£ä¹ˆå®é™…ä¸Šå°±æ˜¯ç”¨æˆ·è¡¨å®ä½“ä¸­åŒ…æ‹¬äº†ç”¨æˆ·è¯¦ç»†ä¿¡æ¯å®ä½“å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users_detail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountDetail</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;address&quot;)</span></span><br><span class="line">    String address;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;email&quot;)</span></span><br><span class="line">    String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;phone&quot;)</span></span><br><span class="line">    String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;real_name&quot;)</span></span><br><span class="line">    String realName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œç”¨æˆ·ä¿¡æ¯å’Œç”¨æˆ·è¯¦ç»†ä¿¡æ¯ä¹‹é—´å½¢æˆäº†ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œé‚£ä¹ˆè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨ç±»ä¸­æŒ‡å®šè¿™ç§å…³ç³»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;username&quot;)</span></span><br><span class="line">    String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;password&quot;)</span></span><br><span class="line">    String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;detail_id&quot;)</span>   <span class="comment">//æŒ‡å®šå­˜å‚¨å¤–é”®çš„å­—æ®µåç§°</span></span><br><span class="line">    <span class="meta">@OneToOne</span>    <span class="comment">//å£°æ˜ä¸ºä¸€å¯¹ä¸€å…³ç³»</span></span><br><span class="line">    AccountDetail detail;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¿®æ”¹å®ä½“ç±»ä¿¡æ¯åï¼Œæˆ‘ä»¬å‘ç°åœ¨å¯åŠ¨æ—¶ä¹Ÿè¿›è¡Œäº†æ›´æ–°ï¼Œæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Hibernate: alter table users add column detail_id integer</span><br><span class="line">Hibernate: create table users_detail (id integer not null auto_increment, address varchar(255), email varchar(255), phone varchar(255), real_name varchar(255), primary key (id)) engine=InnoDB</span><br><span class="line">Hibernate: alter table users add constraint FK7gb021edkxf3mdv5bs75ni6jd foreign key (detail_id) references users_detail (id)</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸æ˜¯æ„Ÿè§‰éå¸¸æ–¹ä¾¿ï¼éƒ½æ‡’å¾—å»æ‰‹åŠ¨æ”¹è¡¨ç»“æ„äº†ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬å¾€ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ä¸­æ·»åŠ ä¸€äº›æ•°æ®ï¼Œä¸€ä¼šæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿›è¡ŒæŸ¥è¯¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">pageAccount</span><span class="params">()</span> &#123;</span><br><span class="line">    repository.findById(<span class="number">1</span>).ifPresent(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢åï¼Œå¯ä»¥å‘ç°ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Hibernate: select account0_.id as id1_0_0_, account0_.detail_id as detail_i4_0_0_, account0_.password as password2_0_0_, account0_.username as username3_0_0_, accountdet1_.id as id1_1_1_, accountdet1_.address as address2_1_1_, accountdet1_.email as email3_1_1_, accountdet1_.phone as phone4_1_1_, accountdet1_.real_name as real_nam5_1_1_ from users account0_ left outer join users_detail accountdet1_ on account0_.detail_id=accountdet1_.id where account0_.id=?</span><br><span class="line">Account(id=1, username=Test, password=123456, detail=AccountDetail(id=1, address=å››å·çœæˆéƒ½å¸‚é’ç¾ŠåŒº, email=8371289@qq.com, phone=1234567890, realName=æœ¬ä¼Ÿ))</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯ï¼Œåœ¨å»ºç«‹å…³ç³»ä¹‹åï¼Œæˆ‘ä»¬æŸ¥è¯¢Accountå¯¹è±¡æ—¶ï¼Œä¼šè‡ªåŠ¨å°†å…³è”æ•°æ®çš„ç»“æœä¹Ÿä¸€å¹¶è¿›è¡ŒæŸ¥è¯¢ã€‚</p>
<p>é‚£è¦æ˜¯æˆ‘ä»¬åªæƒ³è¦Accountçš„æ•°æ®ï¼Œä¸æƒ³è¦ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æ•°æ®æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘å¸Œæœ›åœ¨æˆ‘è¦ç”¨çš„æ—¶å€™å†è·å–è¯¦ç»†ä¿¡æ¯ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœä¸€äº›ç½‘ç»œå¼€é”€ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æ‡’åŠ è½½ï¼Œè¿™æ ·åªæœ‰åœ¨éœ€è¦æ—¶æ‰ä¼šå‘æ•°æ®åº“è·å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JoinColumn(name = &quot;detail_id&quot;)</span></span><br><span class="line"><span class="meta">@OneToOne(fetch = FetchType.LAZY)</span>    <span class="comment">//å°†è·å–ç±»å‹æ”¹ä¸ºLAZY</span></span><br><span class="line">AccountDetail detail;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>   <span class="comment">//æ‡’åŠ è½½å±æ€§éœ€è¦åœ¨äº‹åŠ¡ç¯å¢ƒä¸‹è·å–ï¼Œå› ä¸ºrepositoryæ–¹æ³•è°ƒç”¨å®ŒåSessionä¼šç«‹å³å…³é—­</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">pageAccount</span><span class="params">()</span> &#123;</span><br><span class="line">    repository.findById(<span class="number">1</span>).ifPresent(account -&gt; &#123;</span><br><span class="line">        System.out.println(account.getUsername());   <span class="comment">//è·å–ç”¨æˆ·å</span></span><br><span class="line">        System.out.println(account.getDetail());  <span class="comment">//è·å–è¯¦ç»†ä¿¡æ¯ï¼ˆæ‡’åŠ è½½ï¼‰</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹æ§åˆ¶å°è¾“å‡ºäº†ä»€ä¹ˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Hibernate: select account0_.id as id1_0_0_, account0_.detail_id as detail_i4_0_0_, account0_.password as password2_0_0_, account0_.username as username3_0_0_ from users account0_ where account0_.id=?</span><br><span class="line">Test</span><br><span class="line">Hibernate: select accountdet0_.id as id1_1_0_, accountdet0_.address as address2_1_0_, accountdet0_.email as email3_1_0_, accountdet0_.phone as phone4_1_0_, accountdet0_.real_name as real_nam5_1_0_ from users_detail accountdet0_ where accountdet0_.id=?</span><br><span class="line">AccountDetail(id=1, address=å››å·çœæˆéƒ½å¸‚é’ç¾ŠåŒº, email=8371289@qq.com, phone=1234567890, realName=å¢æœ¬)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè·å–ç”¨æˆ·åä¹‹å‰ï¼Œå¹¶æ²¡æœ‰å»æŸ¥è¯¢ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œè€Œæ˜¯å½“æˆ‘ä»¬è·å–è¯¦ç»†ä¿¡æ¯æ—¶æ‰è¿›è¡ŒæŸ¥è¯¢å¹¶è¿”å›AccountDetailå¯¹è±¡ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦ä¹Ÿå¯ä»¥åœ¨æ·»åŠ æ•°æ®æ—¶ï¼Œåˆ©ç”¨å®ä½“ç±»ä¹‹é—´çš„å…³è”ä¿¡æ¯ï¼Œä¸€æ¬¡æ€§æ·»åŠ ä¸¤å¼ è¡¨çš„æ•°æ®å‘¢ï¼Ÿå¯ä»¥ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹çº§è”å…³è”æ“ä½œè®¾å®šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JoinColumn(name = &quot;detail_id&quot;)</span></span><br><span class="line"><span class="meta">@OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)</span> <span class="comment">//è®¾ç½®å…³è”æ“ä½œä¸ºALL</span></span><br><span class="line">AccountDetail detail;</span><br></pre></td></tr></table></figure>

<ul>
<li>ALLï¼šæ‰€æœ‰æ“ä½œéƒ½è¿›è¡Œå…³è”æ“ä½œ</li>
<li>PERSISTï¼šæ’å…¥æ“ä½œæ—¶æ‰è¿›è¡Œå…³è”æ“ä½œ</li>
<li>REMOVEï¼šåˆ é™¤æ“ä½œæ—¶æ‰è¿›è¡Œå…³è”æ“ä½œ</li>
<li>MERGEï¼šä¿®æ”¹æ“ä½œæ—¶æ‰è¿›è¡Œå…³è”æ“ä½œ</li>
</ul>
<p>å¯ä»¥å¤šä¸ªå¹¶å­˜ï¼Œæ¥ç€æˆ‘ä»¬æ¥è¿›è¡Œä¸€ä¸‹æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">addAccount</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Account</span>();</span><br><span class="line">    account.setUsername(<span class="string">&quot;Nike&quot;</span>);</span><br><span class="line">    account.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="type">AccountDetail</span> <span class="variable">detail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountDetail</span>();</span><br><span class="line">    detail.setAddress(<span class="string">&quot;é‡åº†å¸‚æ¸ä¸­åŒºè§£æ”¾ç¢‘&quot;</span>);</span><br><span class="line">    detail.setPhone(<span class="string">&quot;1234567890&quot;</span>);</span><br><span class="line">    detail.setEmail(<span class="string">&quot;73281937@qq.com&quot;</span>);</span><br><span class="line">    detail.setRealName(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">  	account.setDetail(detail);</span><br><span class="line">    account = repository.save(account);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ’å…¥æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®IDä¸ºï¼š&quot;</span>+account.getId()+<span class="string">&quot;ï¼Œå¤–é”®IDä¸ºï¼š&quot;</span>+account.getDetail().getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æ—¥å¿—ç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Hibernate: insert into users_detail (address, email, phone, real_name) values (?, ?, ?, ?)</span><br><span class="line">Hibernate: insert into users (detail_id, password, username) values (?, ?, ?)</span><br><span class="line">æ’å…¥æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®IDä¸ºï¼š6ï¼Œå¤–é”®IDä¸ºï¼š3</span><br></pre></td></tr></table></figure>

<p>ç»“æŸåä¼šå‘ç°æ•°æ®åº“ä¸­ä¸¤å¼ è¡¨éƒ½åŒæ—¶å­˜åœ¨æ•°æ®ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸€å¯¹å¤šå…³è”ï¼Œæ¯”å¦‚æ¯ä¸ªç”¨æˆ·çš„æˆç»©ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JoinColumn(name = &quot;uid&quot;)</span>  <span class="comment">//æ³¨æ„è¿™é‡Œçš„nameæŒ‡çš„æ˜¯Scoreè¡¨ä¸­çš„uidå­—æ®µå¯¹åº”çš„å°±æ˜¯å½“å‰çš„ä¸»é”®ï¼Œä¼šå°†uidå¤–é”®è®¾ç½®ä¸ºå½“å‰çš„ä¸»é”®</span></span><br><span class="line"><span class="meta">@OneToMany(fetch = FetchType.LAZY, cascade = CascadeType.REMOVE)</span>   <span class="comment">//åœ¨ç§»é™¤Accountæ—¶ï¼Œä¸€å¹¶ç§»é™¤æ‰€æœ‰çš„æˆç»©ä¿¡æ¯ï¼Œä¾ç„¶ä½¿ç”¨æ‡’åŠ è½½</span></span><br><span class="line">List&lt;Score&gt; scoreList;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users_score&quot;)</span>   <span class="comment">//æˆç»©è¡¨ï¼Œæ³¨æ„åªå­˜æˆç»©ï¼Œä¸å­˜å­¦ç§‘ä¿¡æ¯ï¼Œå­¦ç§‘ä¿¡æ¯idåšå¤–é”®</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Score</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne</span>   <span class="comment">//ä¸€å¯¹ä¸€å¯¹åº”åˆ°å­¦ç§‘ä¸Š</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;cid&quot;)</span></span><br><span class="line">    Subject subject;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;socre&quot;)</span></span><br><span class="line">    <span class="type">double</span> score;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;uid&quot;)</span></span><br><span class="line">    <span class="type">int</span> uid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;subjects&quot;)</span>   <span class="comment">//å­¦ç§‘ä¿¡æ¯è¡¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;cid&quot;)</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="type">int</span> cid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;name&quot;)</span></span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;teacher&quot;)</span></span><br><span class="line">    String teacher;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;time&quot;)</span></span><br><span class="line">    <span class="type">int</span> time;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ•°æ®åº“ä¸­å¡«å†™ç›¸åº”æ•°æ®ï¼Œæ¥ç€æˆ‘ä»¬å°±å¯ä»¥æŸ¥è¯¢ç”¨æˆ·çš„æˆç»©ä¿¡æ¯äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    repository.findById(<span class="number">1</span>).ifPresent(account -&gt; &#123;</span><br><span class="line">        account.getScoreList().forEach(System.out::println);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸå¾—åˆ°ç”¨æˆ·æ‰€æœ‰çš„æˆç»©ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¾—åˆ†å’Œå­¦ç§‘ä¿¡æ¯ã€‚</p>
<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†å¯¹åº”æˆç»©ä¸­çš„æ•™å¸ˆä¿¡æ¯å•ç‹¬åˆ†å‡ºä¸€å¼ è¡¨å­˜å‚¨ï¼Œå¹¶å»ºç«‹å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œå› ä¸ºå¤šé—¨è¯¾ç¨‹å¯èƒ½ç”±åŒä¸€ä¸ªè€å¸ˆæ•™æˆï¼ˆåƒä¸‡åˆ«ææ™•äº†ï¼Œä¸€å®šè¦ç†æ¸…æ¥šå…³è”å…³ç³»ï¼ŒåŒæ—¶ä¹Ÿæ˜¯è€ƒéªŒä½ çš„åŸºç¡€æ‰ä¸æ‰å®ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line"><span class="meta">@JoinColumn(name = &quot;tid&quot;)</span>   <span class="comment">//å­˜å‚¨æ•™å¸ˆIDçš„å­—æ®µï¼Œå’Œä¸€å¯¹ä¸€æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿä¼šå½“å‰è¡¨ä¸­åˆ›ä¸ªå¤–é”®</span></span><br><span class="line">Teacher teacher;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€å°±æ˜¯æ•™å¸ˆå®ä½“ç±»äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;teachers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;name&quot;)</span></span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;sex&quot;)</span></span><br><span class="line">    String sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å†è¿›è¡Œä¸€ä¸‹æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    repository.findById(<span class="number">3</span>).ifPresent(account -&gt; &#123;</span><br><span class="line">        account.getScoreList().forEach(score -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¯¾ç¨‹åç§°ï¼š&quot;</span>+score.getSubject().getName());</span><br><span class="line">            System.out.println(<span class="string">&quot;å¾—åˆ†ï¼š&quot;</span>+score.getScore());</span><br><span class="line">            System.out.println(<span class="string">&quot;ä»»è¯¾æ•™å¸ˆï¼š&quot;</span>+score.getSubject().getTeacher().getName());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸå¾—åˆ°å¤šå¯¹ä¸€çš„æ•™å¸ˆä¿¡æ¯ã€‚</p>
<p>æœ€åæˆ‘ä»¬å†æ¥çœ‹æœ€å¤æ‚çš„æƒ…å†µï¼Œç°åœ¨æˆ‘ä»¬ä¸€é—¨è¯¾ç¨‹å¯ä»¥ç”±å¤šä¸ªè€å¸ˆæ•™æˆï¼Œè€Œä¸€ä¸ªè€å¸ˆä¹Ÿå¯ä»¥æ•™æˆå¤šä¸ªè¯¾ç¨‹ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µå°±æ˜¯å¾ˆæ˜æ˜¾çš„å¤šå¯¹å¤šåœºæ™¯ï¼Œç°åœ¨åˆè¯¥å¦‚ä½•å®šä¹‰å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åƒä¹‹å‰ä¸€æ ·ï¼Œæ’å…¥ä¸€å¼ ä¸­é—´è¡¨è¡¨ç¤ºæ•™æˆå…³ç³»ï¼Œè¿™ä¸ªè¡¨ä¸­ä¸“é—¨å­˜å‚¨å“ªä¸ªè€å¸ˆæ•™å“ªä¸ªç§‘ç›®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ManyToMany(fetch = FetchType.LAZY)</span>   <span class="comment">//å¤šå¯¹å¤šåœºæ™¯</span></span><br><span class="line"><span class="meta">@JoinTable(name = &quot;teach_relation&quot;,     //å¤šå¯¹å¤šä¸­é—´å…³è”è¡¨</span></span><br><span class="line"><span class="meta">        joinColumns = @JoinColumn(name = &quot;cid&quot;),    //å½“å‰å®ä½“ä¸»é”®åœ¨å…³è”è¡¨ä¸­çš„å­—æ®µåç§°</span></span><br><span class="line"><span class="meta">        inverseJoinColumns = @JoinColumn(name = &quot;tid&quot;)   //æ•™å¸ˆå®ä½“ä¸»é”®åœ¨å…³è”è¡¨ä¸­çš„å­—æ®µåç§°</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line">List&lt;Teacher&gt; teacher;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ï¼ŒJPAä¼šè‡ªåŠ¨åˆ›å»ºä¸€å¼ ä¸­é—´è¡¨ï¼Œå¹¶è‡ªåŠ¨è®¾ç½®å¤–é”®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å¤šå¯¹å¤šå…³è”ä¿¡æ¯ç¼–å†™åœ¨å…¶ä¸­äº†ã€‚</p>
<h3 id="JPQLè‡ªå®šä¹‰SQLè¯­å¥"><a href="#JPQLè‡ªå®šä¹‰SQLè¯­å¥" class="headerlink" title="JPQLè‡ªå®šä¹‰SQLè¯­å¥"></a>JPQLè‡ªå®šä¹‰SQLè¯­å¥</h3><p>è™½ç„¶SpringDataJPAèƒ½å¤Ÿç®€åŒ–å¤§éƒ¨åˆ†æ•°æ®è·å–åœºæ™¯ï¼Œä½†æ˜¯éš¾å…ä¼šæœ‰ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ï¼Œéœ€è¦ä½¿ç”¨å¤æ‚æŸ¥è¯¢æ‰èƒ½å¤Ÿå»å®Œæˆï¼Œè¿™æ—¶ä½ åˆä¼šå‘ç°ï¼Œå¦‚æœè¦å®ç°ï¼Œåªèƒ½ç”¨å›Mybatisäº†ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è‡ªå·±æ‰‹åŠ¨ç¼–å†™SQLè¯­å¥ï¼Œè¿‡åº¦ä¾èµ–SpringDataJPAä¼šä½¿å¾—SQLè¯­å¥ä¸å¯æ§ã€‚</p>
<p>ä½¿ç”¨JPAï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åƒMybatisé‚£æ ·ï¼Œç›´æ¥ç¼–å†™SQLè¯­å¥ï¼Œä¸è¿‡å®ƒæ˜¯JPQLè¯­è¨€ï¼Œä¸åŸç”ŸSQLè¯­å¥å¾ˆç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæ˜¯é¢å‘å¯¹è±¡çš„ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç¼–å†™åŸç”ŸSQLè¯­å¥ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬è¦æ›´æ–°ç”¨æˆ·è¡¨ä¸­æŒ‡å®šIDç”¨æˆ·çš„å¯†ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Account, Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span>    <span class="comment">//DMLæ“ä½œéœ€è¦äº‹åŠ¡ç¯å¢ƒï¼Œå¯ä»¥ä¸åœ¨è¿™é‡Œå£°æ˜ï¼Œä½†æ˜¯è°ƒç”¨æ—¶ä¸€å®šè¦å¤„äºäº‹åŠ¡ç¯å¢ƒä¸‹</span></span><br><span class="line">    <span class="meta">@Modifying</span>     <span class="comment">//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªDMLæ“ä½œ</span></span><br><span class="line">    <span class="meta">@Query(&quot;update Account set password = ?2 where id = ?1&quot;)</span> <span class="comment">//è¿™é‡Œæ“ä½œçš„æ˜¯ä¸€ä¸ªå®ä½“ç±»å¯¹åº”çš„è¡¨ï¼Œå‚æ•°ä½¿ç”¨?ä»£è¡¨ï¼Œåé¢æ¥ç¬¬nä¸ªå‚æ•°</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updatePasswordById</span><span class="params">(<span class="type">int</span> id, String newPassword)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateAccount</span><span class="params">()</span>&#123;</span><br><span class="line">    repository.updatePasswordById(<span class="number">1</span>, <span class="string">&quot;654321&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘æƒ³ä½¿ç”¨åŸç”ŸSQLæ¥å®ç°æ ¹æ®ç”¨æˆ·åç§°ä¿®æ”¹å¯†ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Query(value = &quot;update users set password = :pwd where username = :name&quot;, nativeQuery = true)</span> <span class="comment">//ä½¿ç”¨åŸç”ŸSQLï¼Œå’ŒMybatisä¸€æ ·ï¼Œè¿™é‡Œä½¿ç”¨ :åç§° è¡¨ç¤ºå‚æ•°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç»§ç»­ç”¨ä¸Šé¢é‚£ç§æ–¹å¼ã€‚</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">updatePasswordByUsername</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String username,   //æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<span class="meta">@Param</span>æŒ‡å®šåç§°</span></span><br><span class="line"><span class="params">                             <span class="meta">@Param(&quot;pwd&quot;)</span> String newPassword)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateAccount</span><span class="params">()</span>&#123;</span><br><span class="line">    repository.updatePasswordByUsername(<span class="string">&quot;Admin&quot;</span>, <span class="string">&quot;654321&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ç¼–å†™åŸç”ŸSQLï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¼¥è¡¥äº†SQLä¸å¯æ§çš„é—®é¢˜ã€‚</p>
<p>è™½ç„¶JPAèƒ½å¤Ÿä¸ºæˆ‘ä»¬å¸¦æ¥éå¸¸ä¾¿æ·çš„å¼€å‘ä½“éªŒï¼Œä½†æ˜¯æ­£å¼å› ä¸ºå¤ªä¾¿æ·äº†ï¼Œä¿å§†çº§çš„ä½“éªŒæœ‰æ—¶ä¹Ÿä¼šé€‚å¾—å…¶åï¼Œå¯èƒ½é¡¹ç›®å¼€å‘åˆ°åæœŸç‰¹åˆ«åºå¤§æ—¶ï¼Œå°±åªèƒ½ä»åº•å±‚SQLè¯­å¥å¼€å§‹è¿›è¡Œä¼˜åŒ–ï¼Œè€Œç”±äºJPAå°½å¯èƒ½åœ°åœ¨å±è”½æˆ‘ä»¬å¯¹SQLè¯­å¥çš„ç¼–å†™ï¼Œæ‰€ä»¥åæœŸä¼˜åŒ–æ˜¯ä¸ªå¤§é—®é¢˜ï¼Œå¹¶ä¸”Hibernateç›¸å¯¹äºMybatisæ¥è¯´ï¼Œæ›´åŠ é‡é‡çº§ã€‚ä¸è¿‡ï¼Œåœ¨å¾®æœåŠ¡çš„æ—¶ä»£ï¼Œå•ä½“é¡¹ç›®ä¸€èˆ¬ä¸ä¼šå¤ªå¤§ï¼Œè€ŒJPAçš„åŠ£åŠ¿å¹¶æ²¡æœ‰å¤ªæ˜æ˜¾åœ°ä½“ç°å‡ºæ¥ã€‚</p>
<p>æœ‰å…³Mybatiså’ŒJPAçš„å¯¹æ¯”ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://blog.csdn.net/u010253246/article/details/105731204">https://blog.csdn.net/u010253246/article/details/105731204</a></p>
<hr>
<h2 id="Extra-å‰åç«¯åˆ†ç¦»è·¨åŸŸå¤„ç†"><a href="#Extra-å‰åç«¯åˆ†ç¦»è·¨åŸŸå¤„ç†" class="headerlink" title="Extra. å‰åç«¯åˆ†ç¦»è·¨åŸŸå¤„ç†"></a>Extra. å‰åç«¯åˆ†ç¦»è·¨åŸŸå¤„ç†</h2><p>æˆ‘ä»¬çš„é¡¹ç›®å·²ç»å¤„äºå‰åç«¯åˆ†ç¦»çŠ¶æ€äº†ï¼Œé‚£ä¹ˆå‰åç«¯åˆ†ç¦»çŠ¶æ€å’Œæˆ‘ä»¬ä¹‹å‰çš„çŠ¶æ€æœ‰ä»€ä¹ˆåŒºåˆ«çš„å‘¢ï¼Ÿ</p>
<ul>
<li><strong>ä¸åˆ†ç¦»ï¼š</strong>å‰ç«¯é¡µé¢çœ‹åˆ°çš„éƒ½æ˜¯ç”±åç«¯æ§åˆ¶ï¼Œç”±åç«¯æ¸²æŸ“é¡µé¢æˆ–é‡å®šå‘ï¼Œåç«¯éœ€è¦æ§åˆ¶å‰ç«¯çš„å±•ç¤ºï¼Œå‰ç«¯ä¸åç«¯çš„è€¦åˆåº¦å¾ˆé«˜ã€‚æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰éƒ½æ˜¯ä½¿ç”¨åç«¯æ¥æ‰§è¡Œé‡å®šå‘æ“ä½œæˆ–æ˜¯ä½¿ç”¨Thymeleafæ¥å¡«å……æ•°æ®ï¼Œè€Œæœ€ç»ˆè¿”å›çš„æ˜¯æ•´ä¸ªæ¸²æŸ“å¥½çš„é¡µã€‚</li>
</ul>
<p><img src="https://img2018.cnblogs.com/blog/1394466/201809/1394466-20180916231510365-285933655.png" alt="img"></p>
<ul>
<li><strong>åˆ†ç¦»ï¼š</strong>åç«¯ä»…è¿”å›å‰ç«¯æ‰€éœ€çš„æ•°æ®ï¼Œä¸å†æ¸²æŸ“HTMLé¡µé¢ï¼Œä¸å†æ§åˆ¶å‰ç«¯çš„æ•ˆæœã€‚è‡³äºå‰ç«¯ç”¨æˆ·çœ‹åˆ°ä»€ä¹ˆæ•ˆæœï¼Œä»åç«¯è¯·æ±‚çš„æ•°æ®å¦‚ä½•åŠ è½½åˆ°å‰ç«¯ä¸­ï¼Œéƒ½ç”±å‰ç«¯é€šè¿‡JSç­‰è¿›è¡ŒåŠ¨æ€æ•°æ®å¡«å……å’Œæ¸²æŸ“ã€‚è¿™æ ·åç«¯åªè¿”å›JSONæ•°æ®ï¼Œå‰ç«¯å¤„ç†JSONæ•°æ®å¹¶å±•ç¤ºï¼Œè¿™æ ·å‰åç«¯çš„èŒè´£å°±éå¸¸æ˜ç¡®äº†ã€‚</li>
</ul>
<p><img src="https://img2018.cnblogs.com/blog/1394466/201809/1394466-20180916231716242-1862208927.png" alt="img"></p>
<p>å®ç°å‰åç«¯åˆ†ç¦»æœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯ç›´æ¥æ”¾å…¥SpringBootçš„èµ„æºæ–‡ä»¶å¤¹ä¸‹ï¼Œä½†æ˜¯è¿™æ ·å®é™…ä¸Šè¿˜æ˜¯åœ¨ä¾é SpringBootå†…åµŒçš„TomcatæœåŠ¡å™¨è¿›è¡Œé¡µé¢å’Œé™æ€èµ„æºçš„å‘é€ï¼Œæˆ‘ä»¬ç°åœ¨å°±æ˜¯è¿™ç§æ–¹æ¡ˆã€‚</p>
<p>å¦ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ç›´æ¥å°†æ‰€æœ‰çš„é¡µé¢å’Œé™æ€èµ„æºå•ç‹¬æ”¾åˆ°ä»£ç†æœåŠ¡å™¨ä¸Šï¼ˆå¦‚Nginxï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬åç«¯æœåŠ¡å™¨å°±ä¸å¿…å†å¤„ç†é™æ€èµ„æºå’Œé¡µé¢äº†ï¼Œä¸“å¿ƒè¿”å›æ•°æ®å³å¯ï¼Œè€Œå‰ç«¯é¡µé¢å°±éœ€è¦è®¿é—®å¦ä¸€ä¸ªæœåŠ¡å™¨æ¥è·å–ï¼Œè™½ç„¶é€»è¾‘å’Œæ˜ç¡®ï¼Œä½†æ˜¯è¿™æ ·ä¼šå‡ºç°è·¨åŸŸé—®é¢˜ï¼Œå®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œä¸ºäº†é˜²æ­¢è¿™ç§ä¸å®‰å…¨çš„è¡Œä¸ºå‘ç”Ÿï¼Œæ‰€ä»¥å¯¹å¼‚æ­¥è¯·æ±‚ä¼šè¿›è¡Œä¸€å®šçš„é™åˆ¶ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬å°†å‰ç«¯é¡µé¢å’Œåç«¯é¡µé¢ç›´æ¥åˆ†ç¦»è¿›è¡Œæµ‹è¯•ï¼Œåœ¨ç™»é™†æ—¶å¾—åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Access to XMLHttpRequest at &#x27;http://localhost:8080/api/auth/login&#x27; from origin &#x27;http://localhost:63342&#x27; has been blocked by CORS policy: No &#x27;Access-Control-Allow-Origin&#x27; header is present on the requested resource.</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ï¼Œåœ¨Ajaxå‘é€å¼‚æ­¥è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬çš„è¯·æ±‚è¢«é˜»æ­¢ï¼ŒåŸå› æ˜¯åœ¨å“åº”å¤´ä¸­æ²¡æœ‰åŒ…å«<code>Access-Control-Allow-Origin</code>ï¼Œä¹Ÿå°±è¡¨ç¤ºï¼Œå¦‚æœæœåŠ¡ç«¯å…è®¸è·¨åŸŸè¯·æ±‚ï¼Œé‚£ä¹ˆä¼šåœ¨å“åº”å¤´ä¸­æ·»åŠ ä¸€ä¸ª<code>Access-Control-Allow-Origin</code>å­—æ®µï¼Œå¦‚æœä¸å…è®¸è·¨åŸŸï¼Œå°±åƒç°åœ¨è¿™æ ·ã€‚é‚£ä¹ˆï¼Œä»€ä¹ˆæ‰ç®—æ˜¯è·¨åŸŸå‘¢ï¼š</p>
<ol>
<li>è¯·æ±‚åè®®<code>å¦‚httpã€https</code>ä¸åŒ</li>
<li>è¯·æ±‚çš„åœ°å€/åŸŸåä¸åŒ</li>
<li>ç«¯å£ä¸åŒ</li>
</ol>
<p>å› ä¸ºæˆ‘ä»¬ç°åœ¨ç›¸å½“äºå‰ç«¯é¡µé¢è®¿é—®çš„æ˜¯é™æ€èµ„æºæœåŠ¡å™¨ï¼Œè€Œåç«¯æ•°æ®æ˜¯ç”±æˆ‘ä»¬çš„SpringBooté¡¹ç›®æä¾›ï¼Œå®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥åœ¨å®æœåŠ¡å™¨è¯·æ±‚èµ„æºæ—¶ï¼Œä¼šè¢«åˆ¤æ–­ä¸ºå­˜åœ¨å®‰å…¨é£é™©ã€‚</p>
<p>ä½†æ˜¯ç°åœ¨ï¼Œç”±äºæˆ‘ä»¬å‰åç«¯æ˜¯åˆ†ç¦»çŠ¶æ€ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯èƒ½å¤Ÿå®ç°è·¨åŸŸè¯·æ±‚ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦æ·»åŠ ä¸€ä¸ªè¿‡æ»¤å™¨æ¥å¤„ç†è·¨åŸŸé—®é¢˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CorsFilter <span class="title function_">corsFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºCorsConfigurationå¯¹è±¡åæ·»åŠ é…ç½®</span></span><br><span class="line">    <span class="type">CorsConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">    <span class="comment">//è®¾ç½®æ”¾è¡Œå“ªäº›åŸå§‹åŸŸï¼Œè¿™é‡Œç›´æ¥è®¾ç½®ä¸ºæ‰€æœ‰</span></span><br><span class="line">    config.addAllowedOriginPattern(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">  	<span class="comment">//ä½ å¯ä»¥å•ç‹¬è®¾ç½®æ”¾è¡Œå“ªäº›åŸå§‹åŸŸ config.addAllowedOrigin(&quot;http://localhost:2222&quot;);</span></span><br><span class="line">    <span class="comment">//æ”¾è¡Œå“ªäº›åŸå§‹è¯·æ±‚å¤´éƒ¨ä¿¡æ¯</span></span><br><span class="line">    config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">    <span class="comment">//æ”¾è¡Œå“ªäº›è¯·æ±‚æ–¹å¼ï¼Œ*ä»£è¡¨æ‰€æœ‰</span></span><br><span class="line">    config.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">    <span class="comment">//æ˜¯å¦å…è®¸å‘é€Cookieï¼Œå¿…é¡»è¦å¼€å¯ï¼Œå› ä¸ºæˆ‘ä»¬çš„JSESSIONIDéœ€è¦åœ¨Cookieä¸­æºå¸¦</span></span><br><span class="line">    config.setAllowCredentials(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">//æ˜ å°„è·¯å¾„</span></span><br><span class="line">    <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">corsConfigurationSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">    corsConfigurationSource.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line">    <span class="comment">//è¿”å›CorsFilter</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsFilter</span>(corsConfigurationSource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„SpringBooté¡¹ç›®å°±æ”¯æŒè·¨åŸŸè®¿é—®äº†ï¼Œæ¥ç€æˆ‘ä»¬å†æ¥å°è¯•è¿›è¡Œç™»é™†ï¼Œå¯ä»¥å‘ç°å·²ç»èƒ½å¤Ÿæ­£å¸¸è®¿é—®äº†ï¼Œå¹¶ä¸”å“åº”å¤´ä¸­åŒ…å«äº†ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Vary: Access-Control-Request-Method</span><br><span class="line">Vary: Access-Control-Request-Headers</span><br><span class="line">Access-Control-Allow-Origin: http://localhost:63342</span><br><span class="line">Access-Control-Expose-Headers: *</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å½“å‰è®¿é—®çš„åŸå§‹åŸŸå·²ç»è¢«æ”¾è¡Œäº†ã€‚</p>
<p>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„Ajaxè¯·æ±‚ä¸­æ²¡æœ‰æºå¸¦Cookieä¿¡æ¯ï¼ˆè¿™ä¸ªæŒ‰ç†è¯´å±äºå‰ç«¯çŸ¥è¯†äº†ï¼‰è¿™é‡Œæˆ‘ä»¬ç¨å¾®æ”¹ä¸€ä¸‹ï¼Œä¸ç„¶æˆ‘ä»¬çš„è¯·æ±‚æ— æ³•ç¡®è®¤èº«ä»½ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">url, success</span>)&#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="attr">async</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">        <span class="attr">xhrFields</span>: &#123;</span><br><span class="line">            <span class="attr">withCredentials</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">success</span>: success</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">post</span>(<span class="params">url, data, success</span>)&#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="attr">async</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">data</span>: data,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">        <span class="attr">xhrFields</span>: &#123;</span><br><span class="line">            <span class="attr">withCredentials</span>: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">success</span>: success</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ä¸¤ä¸ªå°è£…å¥½çš„æ–¹æ³•ï¼Œå¹¶ä¸”å°†<code>withCredentials</code>å¼€å¯ï¼Œè¿™æ ·åœ¨å‘é€å¼‚æ­¥è¯·æ±‚æ—¶ï¼Œå°±ä¼šæºå¸¦Cookieä¿¡æ¯äº†ã€‚</p>
<p> åœ¨å­¦ä¹ å®ŒæˆLinuxä¹‹åï¼Œæˆ‘ä»¬ä¼šè®²è§£å¦‚ä½•åœ¨LinuxæœåŠ¡å™¨ä¸Šéƒ¨ç½²Nginxåå‘ä»£ç†æœåŠ¡å™¨ã€‚</p>
<hr>
<h2 id="æ¥å£ç®¡ç†ï¼šSwagger"><a href="#æ¥å£ç®¡ç†ï¼šSwagger" class="headerlink" title="æ¥å£ç®¡ç†ï¼šSwagger"></a>æ¥å£ç®¡ç†ï¼šSwagger</h2><p>åœ¨å‰åç«¯åˆ†ç¦»é¡¹ç›®ä¸­ï¼Œå‰ç«¯äººå‘˜éœ€è¦çŸ¥é“æˆ‘ä»¬åç«¯ä¼šæä¾›ä»€ä¹ˆæ•°æ®ï¼Œæ ¹æ®åç«¯æä¾›çš„æ•°æ®æ¥è¿›è¡Œå‰ç«¯é¡µé¢æ¸²æŸ“ï¼ˆåœ¨ä¹‹å‰æˆ‘ä»¬ä¹Ÿæ¼”ç¤ºè¿‡ï¼‰è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ç¼–å†™ä¸€ä¸ªAPIæ–‡æ¡£ï¼Œä»¥ä¾¿å‰ç«¯äººå‘˜éšæ—¶æŸ¥é˜…ã€‚</p>
<p>ä½†æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ–‡æ¡£ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¯èƒ½å•ç‹¬å†™ä¸€ä¸ªé¡¹ç›®å»è¿›è¡Œç»´æŠ¤ï¼Œå¹¶ä¸”éšç€æˆ‘ä»¬çš„åç«¯é¡¹ç›®ä¸æ–­æ›´æ–°ï¼Œæ–‡æ¡£ä¹Ÿéœ€è¦è·Ÿéšæ›´æ–°ï¼Œè¿™æ˜¾ç„¶æ˜¯å¾ˆéº»çƒ¦çš„ä¸€ä»¶äº‹æƒ…ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆå‘¢ï¼Ÿ</p>
<p>å½“ç„¶æœ‰ï¼Œé‚£å°±æ˜¯ä¸è¢œå“¥ï¼šSwagger</p>
<h3 id="èµ°è¿›Swagger"><a href="#èµ°è¿›Swagger" class="headerlink" title="èµ°è¿›Swagger"></a>èµ°è¿›Swagger</h3><p>Swaggerçš„ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ”¯æŒ API è‡ªåŠ¨ç”ŸæˆåŒæ­¥çš„åœ¨çº¿æ–‡æ¡£ï¼šä½¿ç”¨ Swagger åå¯ä»¥ç›´æ¥é€šè¿‡ä»£ç ç”Ÿæˆæ–‡æ¡£ï¼Œä¸å†éœ€è¦è‡ªå·±æ‰‹åŠ¨ç¼–å†™æ¥å£æ–‡æ¡£äº†ï¼Œå¯¹ç¨‹åºå‘˜æ¥è¯´éå¸¸æ–¹ä¾¿ï¼Œå¯ä»¥èŠ‚çº¦å†™æ–‡æ¡£çš„æ—¶é—´å»å­¦ä¹ æ–°æŠ€æœ¯ã€‚</li>
<li>æä¾› Web é¡µé¢åœ¨çº¿æµ‹è¯• APIï¼šå…‰æœ‰æ–‡æ¡£è¿˜ä¸å¤Ÿï¼ŒSwagger ç”Ÿæˆçš„æ–‡æ¡£è¿˜æ”¯æŒåœ¨çº¿æµ‹è¯•ã€‚å‚æ•°å’Œæ ¼å¼éƒ½å®šå¥½äº†ï¼Œç›´æ¥åœ¨ç•Œé¢ä¸Šè¾“å…¥å‚æ•°å¯¹åº”çš„å€¼å³å¯åœ¨çº¿æµ‹è¯•æ¥å£ã€‚</li>
</ul>
<p>ç»“åˆSpringæ¡†æ¶ï¼ˆSpring-foxï¼‰ï¼ŒSwaggerå¯ä»¥å¾ˆè½»æ¾åœ°åˆ©ç”¨æ³¨è§£ä»¥åŠæ‰«ææœºåˆ¶ï¼Œæ¥å¿«é€Ÿç”Ÿæˆåœ¨çº¿æ–‡æ¡£ï¼Œä»¥å®ç°å½“æˆ‘ä»¬é¡¹ç›®å¯åŠ¨ä¹‹åï¼Œå‰ç«¯å¼€å‘äººå‘˜å°±å¯ä»¥æ‰“å¼€Swaggeræä¾›çš„å‰ç«¯é¡µé¢ï¼ŒæŸ¥çœ‹å’Œæµ‹è¯•æ¥å£ã€‚ä¾èµ–å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>SpringBoot 2.6ä»¥ä¸Šç‰ˆæœ¬ä¿®æ”¹äº†è·¯å¾„åŒ¹é…è§„åˆ™ï¼Œä½†æ˜¯Swagger3è¿˜ä¸æ”¯æŒï¼Œè¿™é‡Œæ¢å›ä¹‹å‰çš„ï¼Œä¸ç„¶å¯åŠ¨ç›´æ¥æŠ¥é”™ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">mvc:</span></span><br><span class="line">		<span class="attr">pathmatch:</span></span><br><span class="line">      <span class="attr">matching-strategy:</span> <span class="string">ant_path_matcher</span></span><br></pre></td></tr></table></figure>

<p>é¡¹ç›®å¯åŠ¨åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰“å¼€ï¼š<a href="http://localhost:8080/swagger-ui/index.html%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%A1%B5%E9%9D%A2%EF%BC%88%E8%A6%81%E6%98%AF%E8%A7%89%E5%BE%97%E4%B8%91%EF%BC%8CUI%E6%98%AF%E5%8F%AF%E4%BB%A5%E6%8D%A2%E7%9A%84%EF%BC%8C%E6%94%AF%E6%8C%81%E7%AC%AC%E4%B8%89%E6%96%B9%EF%BC%89%E4%BC%9A%E6%98%BE%E7%A4%BA%E6%89%80%E6%9C%89%E7%9A%84API%E6%96%87%E6%A1%A3%EF%BC%8C%E5%8C%85%E6%8B%AC%E6%8E%A5%E5%8F%A3%E7%9A%84%E8%B7%AF%E5%BE%84%E3%80%81%E6%94%AF%E6%8C%81%E7%9A%84%E6%96%B9%E6%B3%95%E3%80%81%E6%8E%A5%E5%8F%A3%E7%9A%84%E6%8F%8F%E8%BF%B0%E7%AD%89%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E5%AF%B9API%E6%8E%A5%E5%8F%A3%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95%EF%BC%8C%E9%9D%9E%E5%B8%B8%E6%96%B9%E4%BE%BF%E3%80%82">http://localhost:8080/swagger-ui/index.htmlï¼Œè¿™ä¸ªé¡µé¢ï¼ˆè¦æ˜¯è§‰å¾—ä¸‘ï¼ŒUIæ˜¯å¯ä»¥æ¢çš„ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹ï¼‰ä¼šæ˜¾ç¤ºæ‰€æœ‰çš„APIæ–‡æ¡£ï¼ŒåŒ…æ‹¬æ¥å£çš„è·¯å¾„ã€æ”¯æŒçš„æ–¹æ³•ã€æ¥å£çš„æè¿°ç­‰ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹APIæ¥å£è¿›è¡Œæµ‹è¯•ï¼Œéå¸¸æ–¹ä¾¿ã€‚</a></p>
<p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªé…ç½®ç±»å»é…ç½®é¡µé¢çš„ç›¸å…³ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.OAS_30).apiInfo(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                        .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;ä½ çš„åå­—&quot;</span>, <span class="string">&quot;https://www.bilibili.com&quot;</span>, <span class="string">&quot;javastudy111*@163.com&quot;</span>))</span><br><span class="line">                        .title(<span class="string">&quot;å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ - åœ¨çº¿APIæ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line">                        .build()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ¥å£ä¿¡æ¯é…ç½®"><a href="#æ¥å£ä¿¡æ¯é…ç½®" class="headerlink" title="æ¥å£ä¿¡æ¯é…ç½®"></a>æ¥å£ä¿¡æ¯é…ç½®</h3><p>è™½ç„¶Swaggerçš„UIç•Œé¢å·²ç»å¯ä»¥å¾ˆå¥½åœ°å±•ç¤ºåç«¯æä¾›çš„æ¥å£ä¿¡æ¯äº†ï¼Œä½†æ˜¯éå¸¸çš„æ··ä¹±ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é…ç½®æ¥å£çš„ä¸€äº›æè¿°ä¿¡æ¯ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬çš„é¡µé¢ä¸­å®Œå…¨ä¸éœ€è¦æ˜¾ç¤ºErrorControllerç›¸å…³çš„APIï¼Œæ‰€ä»¥æˆ‘ä»¬é…ç½®ä¸€ä¸‹é€‰æ‹©å“ªäº›Controlleræ‰ä¼šç”ŸæˆAPIä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ApiInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">            .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;ä½ çš„åå­—&quot;</span>, <span class="string">&quot;https://www.bilibili.com&quot;</span>, <span class="string">&quot;javastudy111@163.com&quot;</span>))</span><br><span class="line">            .title(<span class="string">&quot;å›¾ä¹¦ç®¡ç†ç³»ç»Ÿ - åœ¨çº¿APIæ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªå›¾ä¹¦ç®¡ç†ç³»ç»Ÿçš„åç«¯APIæ–‡æ¡£ï¼Œæ¬¢è¿å‰ç«¯äººå‘˜æŸ¥é˜…ï¼&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.OAS_30)</span><br><span class="line">            .apiInfo(info)</span><br><span class="line">            .select()       <span class="comment">//å¯¹é¡¹ç›®ä¸­çš„æ‰€æœ‰APIæ¥å£è¿›è¡Œé€‰æ‹©</span></span><br><span class="line">            .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.example.controller&quot;</span>))</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä¸ºä¸€ä¸ªControllerç¼–å†™APIæè¿°ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;è´¦æˆ·éªŒè¯æ¥å£&quot;, description = &quot;åŒ…æ‹¬ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€éªŒè¯ç è¯·æ±‚ç­‰æ“ä½œã€‚&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/auth&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthApiController</span> &#123;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ç±»åç§°ä¸Šé¢æ·»åŠ <code>@Api</code>æ³¨è§£ï¼Œå¹¶å¡«å†™ç›¸å…³ä¿¡æ¯ï¼Œæ¥ä¸ºå½“å‰çš„Controllerè®¾ç½®æè¿°ä¿¡æ¯ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬å¯ä»¥ä¸ºæ‰€æœ‰çš„è¯·æ±‚æ˜ å°„é…ç½®æè¿°ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">        @ApiResponse(code = 200, message = &quot;é‚®ä»¶å‘é€æˆåŠŸ&quot;),  </span></span><br><span class="line"><span class="meta">        @ApiResponse(code = 500, message = &quot;é‚®ä»¶å‘é€å¤±è´¥&quot;)   //ä¸åŒè¿”å›çŠ¶æ€ç æè¿°</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;è¯·æ±‚é‚®ä»¶éªŒè¯ç &quot;)</span>   <span class="comment">//æ¥å£æè¿°</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/verify-code&quot;)</span></span><br><span class="line"><span class="keyword">public</span> RestBean&lt;Void&gt; <span class="title function_">verifyCode</span><span class="params">(<span class="meta">@ApiParam(&quot;é‚®ç®±åœ°å€&quot;)</span>   //è¯·æ±‚å‚æ•°çš„æè¿°</span></span><br><span class="line"><span class="params">                                 <span class="meta">@RequestParam(&quot;email&quot;)</span> String email)</span>&#123;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiIgnore</span>     <span class="comment">//å¿½ç•¥æ­¤è¯·æ±‚æ˜ å°„</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/login-success&quot;)</span></span><br><span class="line"><span class="keyword">public</span> RestBean&lt;Void&gt; <span class="title function_">loginSuccess</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestBean</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;ç™»é™†æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºå®ä½“ç±»é…ç½®ç›¸å…³çš„æè¿°ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;å“åº”å®ä½“å°è£…ç±»&quot;)</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestBean</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;çŠ¶æ€ç &quot;)</span></span><br><span class="line">    <span class="type">int</span> code;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;çŠ¶æ€ç æè¿°&quot;)</span></span><br><span class="line">    String reason;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;æ•°æ®å®ä½“&quot;)</span></span><br><span class="line">    T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RestBean</span><span class="params">(<span class="type">int</span> code, String reason)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.reason = reason;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ–‡æ¡£ä¸­æŸ¥çœ‹å®ä½“ç±»ç®€ä»‹ä»¥åŠå„ä¸ªå±æ€§çš„ä»‹ç»äº†ã€‚</p>
<p>æœ€åæˆ‘ä»¬å†é…ç½®ä¸€ä¸‹å¤šç¯å¢ƒï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">environment</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>false<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">environment</span>&gt;</span>prod<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>application*.yaml<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>application.yaml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>application-$&#123;environment&#125;.yaml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆåœ¨Mavenä¸­æ·»åŠ ä¸¤ä¸ªç¯å¢ƒï¼Œæ¥ç€æˆ‘ä»¬é…ç½®ä¸€ä¸‹ä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line"><span class="attr">springfox:</span></span><br><span class="line">  <span class="attr">documentation:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬é€‰æ‹©ä¸å¼€å¯Swaggeræ–‡æ¡£ä»¥åŠJPAçš„æ•°æ®åº“æ“ä½œæ—¥å¿—ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®æƒ…å†µé€‰æ‹©ä¸¤å¥—ç¯å¢ƒäº†ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>springBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2021/12/29/hello-world/</url>
    <content><![CDATA[<p>å—¨ï¼è¿™é‡Œæ˜¯ <a href="https://fchuan-d.github.io/">æ¨Šå·</a> â€˜s blog! æ¬¢è¿ä½ å“¦ï¼è™½ç„¶è¿™ä¸ªåšå®¢è¿˜å¾ˆç¨šå«©ï¼Œä½†æ˜¯æˆ‘ä¼šæ…¢æ…¢å®Œå–„å®ƒçš„åŠŸèƒ½ï¼Œä¹Ÿä¼šéšç¼˜æ›´æ–°å­¦ä¹ æ€»ç»“å’Œæ—¥å¸¸ç”Ÿæ´»ã€‚æ¬¢è¿å¤§å®¶å¸¸æ¥â˜ºï¼ï¼ </p>
]]></content>
  </entry>
  <entry>
    <title>Typora</title>
    <url>/2022/04/18/Typora/</url>
    <content><![CDATA[<p><em><strong>Typora</strong></em></p>
<p>çœŸå¥½ç”¨å•Šï¼Œä½¿ç”¨èµ·æ¥å¾ˆæ¸…çˆ½ï¼</p>
]]></content>
      <categories>
        <category>æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>åˆ†äº«</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown</title>
    <url>/2021/12/31/markdown/</url>
    <content><![CDATA[<p><em>ä½¿ç”¨htmlæ¥å¼•ç”¨æ’å…¥çš„å›¾ç‰‡ï¼Œå›ºå®šå›¾ç‰‡å¤§å°ï¼šwidth=256,height=256è®¾ç½®çš„æ˜¯æ˜¾ç¤ºå›¾åƒçš„å°ºå¯¸ï¼Œsrcåé¢æ¥çš„å°±æ˜¯<u>å›¾åƒå¯¹è±¡</u></em></p>
<pre><code>&lt;img src=&quot;å›¾ç‰‡è·¯å¾„&quot; width=256 height=256 /&gt;
</code></pre>
<p><em>è¿˜å¯ä»¥ä½¿ç”¨<u>ç™¾åˆ†æ¯”</u>çš„æ–¹å¼æ¥ç»™width,heightä¼ å‚</em></p>
<span id="more"></span>
<pre><code>&lt;img src=&quot;/images/mine.jpg&quot; width=&quot;50%&quot; height=&quot;50%&quot; /&gt;
</code></pre>
<p><em>å¦‚æœæƒ³ç»™å›¾åƒåŠ ä¸ªæ ‡æ³¨ï¼Œå¯ä»¥è¿™ä¹ˆåš</em></p>
<pre><code>&lt;center&gt;
&lt;img src=&quot;/images/mine.jpg&quot; width=&quot;25%&quot; height=&quot;25%&quot; /&gt;
Figure 1. xx
&lt;/center&gt;
&lt;center&gt;
&lt;img src=&quot;/images/mine.jpg&quot; width=&quot;10%&quot; height=&quot;10%&quot; /&gt;
&lt;/center&gt;
</code></pre>
<p><em>å¦‚æœæƒ³è®©å›¾å’Œæ ‡æ³¨é—´è·ç¦»å¢å¤§ï¼Œå¯ä»¥è¿™ä¹ˆåš</em></p>
<pre><code>&lt;center&gt;
&lt;img src=&quot;/images/mine.jpg&quot; width=&quot;25%&quot; height=&quot;25%&quot; /&gt;
$ $
Figure 1. xx
&lt;/center&gt;
</code></pre>
<p>  <strong>Markdown èœé¸Ÿæ•™ç¨‹</strong><br>  <a href="https://www.runoob.com/markdown/md-tutorial.html">https://www.runoob.com/markdown/md-tutorial.html</a><br>  <strong>å¸¸ç”¨</strong><br>  <a href="https://blog.csdn.net/u011732358/article/details/83098211">https://blog.csdn.net/u011732358/article/details/83098211</a></p>
]]></content>
      <categories>
        <category>è¯­è¨€</category>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>htmlæ’å›¾</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringCloudç¬”è®°ï¼ˆä¸€ï¼‰</title>
    <url>/2022/05/30/SpringCloud%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0d0lfurfij21o40d275h.jpg" alt="image-20220317173734208"></p>
<h1 id="å¾®æœåŠ¡åŸºç¡€"><a href="#å¾®æœåŠ¡åŸºç¡€" class="headerlink" title="å¾®æœåŠ¡åŸºç¡€"></a>å¾®æœåŠ¡åŸºç¡€</h1><p><strong>æ³¨æ„ï¼š</strong>æ­¤é˜¶æ®µå­¦ä¹ æ¨èçš„ç”µè„‘é…ç½®ï¼Œè‡³å°‘é…å¤‡4æ ¸å¿ƒCPUï¼ˆä¸»é¢‘3.0Ghzä»¥ä¸Šï¼‰+16GBå†…å­˜ï¼Œå¦åˆ™å¡åˆ°ä½ æ€€ç–‘äººç”Ÿã€‚ </p>
<p>å‰é¢æˆ‘ä»¬è®²è§£äº†SpringBootæ¡†æ¶ï¼Œé€šè¿‡ä½¿ç”¨SpringBootæ¡†æ¶ï¼Œæˆ‘ä»¬çš„é¡¹ç›®å¼€å‘é€Ÿåº¦å¯ä»¥è¯´æ˜¯å¾—åˆ°äº†è´¨çš„æå‡ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¯¹äºé¡¹ç›®çš„ç»´æŠ¤å’Œç†è§£ï¼Œä¹Ÿä¼šæ›´åŠ çš„è½»æ¾ã€‚å¯è§ï¼ŒSpringBootä¸ºæˆ‘ä»¬çš„å¼€å‘å¸¦æ¥äº†å·¨å¤§ä¾¿æ·ã€‚è€Œè¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†åŸºäºSpringBootï¼Œç»§ç»­æ·±å…¥åˆ°ä¼ä¸šå®é™…åœºæ™¯ï¼Œæ¢è®¨å¾®æœåŠ¡æ¶æ„ä¸‹çš„SpringCloudã€‚è¿™ä¸ªéƒ¨åˆ†æˆ‘ä»¬ä¼šæ›´åŠ æ³¨é‡äºæ¶æ„è®¾è®¡ä¸Šçš„è®²è§£ï¼Œå¼±åŒ–å®ç°åŸç†æ–¹é¢çš„ç ”ç©¶ã€‚</p>
<span id="more"></span>

<h2 id="ä¼ ç»Ÿé¡¹ç›®è½¬å‹"><a href="#ä¼ ç»Ÿé¡¹ç›®è½¬å‹" class="headerlink" title="ä¼ ç»Ÿé¡¹ç›®è½¬å‹"></a>ä¼ ç»Ÿé¡¹ç›®è½¬å‹</h2><p>è¦è¯´è¿‘å‡ å¹´æœ€ç«çƒ­çš„è¯é¢˜ï¼Œé‚£è¿˜å¾—æ˜¯å¾®æœåŠ¡ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯å¾®æœåŠ¡å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥å…ˆä»æŠ€æœ¯çš„æ¼”å˜å¼€å§‹çœ‹èµ·ï¼Œåœ¨æˆ‘ä»¬å­¦ä¹ JavaWebä¹‹åï¼Œä¸€èˆ¬çš„ç½‘ç«™å¼€å‘æ¨¡å¼ä¸ºServlet+JSPï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬åœ¨å­¦ä¹ äº†SSMä¹‹åï¼Œä¼šå‘ç°è¿™ç§æ¨¡å¼å·²ç»è¿œè¿œè½åäº†ï¼Œç¬¬ä¸€ï¼Œä¸€ä¸ªå…¬å¸ä¸å¯èƒ½å»æ‹›é‚£ä¹ˆå¤šåŒæ—¶ä¼šå‰ç«¯+åç«¯çš„å¼€å‘äººå‘˜ï¼Œå°±ç®—æ‹›åˆ°ï¼Œä¹Ÿå¹¶ä¸ä¸€å®šèƒ½ä¿è¯ä¸¤ä¸ªæ–¹é¢éƒ½æ¯”è¾ƒæ“…é•¿ï¼Œç›¸æ¯”å‰åç«¯åˆ†å¼€å­¦ä¹ çš„å¼€å‘äººå‘˜ï¼Œæ˜¾ç„¶åè€…çš„å­¦ä¹ æˆæœ¬æ›´ä½ï¼Œä¸“æ³¨åº¦æ›´é«˜ã€‚å› æ­¤å‰åç«¯åˆ†ç¦»æˆä¸ºäº†ä¸€ç§æ–°çš„è¶‹åŠ¿ã€‚é€šè¿‡ä½¿ç”¨SpringBootï¼Œæˆ‘ä»¬å‡ ä¹å¯ä»¥å¾ˆå¿«é€Ÿåœ°å¼€å‘ä¸€ä¸ªé«˜æ€§èƒ½çš„å•ä½“åº”ç”¨ï¼Œåªéœ€è¦å¯åŠ¨ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œæˆ‘ä»¬æ•´ä¸ªé¡¹ç›®å°±å¼€å§‹è¿è¡Œäº†ï¼Œå„é¡¹åŠŸèƒ½èäºä¸€ä½“ï¼Œå¼€å‘èµ·æ¥ä¹Ÿæ›´åŠ è½»æ¾ã€‚</p>
<p>ä½†æ˜¯éšç€æˆ‘ä»¬é¡¹ç›®çš„ä¸æ–­æ‰©å¤§ï¼Œå•ä½“åº”ç”¨ä¼¼ä¹æ˜¾å¾—æœ‰ç‚¹ä¹åŠ›äº†ã€‚</p>
<p>éšç€è¶Šæ¥è¶Šå¤šçš„åŠŸèƒ½ä¸æ–­åœ°åŠ å…¥åˆ°ä¸€ä¸ªSpringBooté¡¹ç›®ä¸­ï¼Œéšç€æ¥å£ä¸æ–­å¢åŠ ï¼Œæ•´ä¸ªç³»ç»Ÿå°±è¦åœ¨åŒä¸€æ—¶é—´å†…å“åº”æ›´å¤šç±»å‹çš„è¯·æ±‚ï¼Œæ˜¾ç„¶ï¼Œè¿™ç§æ‰©å±•æ–¹å¼æ˜¯ä¸å¯èƒ½æ— é™ä½¿ç”¨ä¸‹å»çš„ï¼Œæ€»æœ‰ä¸€å¤©ï¼Œè¿™ä¸ªSpringBooté¡¹ç›®ä¼šåºå¤§åˆ°è¿è¡Œç¼“æ…¢ã€‚å¹¶ä¸”æ‰€æœ‰çš„åŠŸèƒ½å¦‚æœéƒ½é›†æˆåœ¨å•ç«¯ä¸Šï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šå…¨éƒ¨æ±‡é›†åˆ°ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå¯¹æ­¤æœåŠ¡å™¨é€ æˆå·¨å¤§å‹åŠ›ã€‚</p>
<p>å¯ä»¥è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„ç”µè„‘å·²ç»å‡çº§åˆ°i9-12900Kï¼Œä½†æ˜¯ä¾ç„¶åœ¨è¿è¡Œé¡¹ç›®çš„æ—¶å€™ç¼“æ…¢ï¼Œæ— æ³•åŒä¸€æ—¶é—´å“åº”æˆåƒä¸Šä¸‡çš„è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜å°±å·²ç»ä¸æ˜¯å•çº¯å‡çº§æœºå™¨é…ç½®å¯ä»¥è§£å†³çš„äº†ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ghpknvdvj21zg0go78r.jpg" alt="image-20220320174622739"></p>
<p>ä¼ ç»Ÿå•ä½“æ¶æ„åº”ç”¨éšç€é¡¹ç›®è§„æ¨¡çš„æ‰©å¤§ï¼Œå®é™…ä¸Šä¼šæš´éœ²è¶Šæ¥è¶Šå¤šçš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯ä¸€å°æœåŠ¡å™¨æ— æ³•æ‰¿å—åºå¤§çš„å•ä½“åº”ç”¨éƒ¨ç½²ï¼Œå¹¶ä¸”å•ä½“åº”ç”¨çš„ç»´æŠ¤ä¹Ÿä¼šè¶Šæ¥è¶Šå›°éš¾ï¼Œæˆ‘ä»¬å¾—å¯»æ‰¾ä¸€ç§æ–°çš„å¼€å‘æ¶æ„æ¥è§£å†³è¿™äº›é—®é¢˜äº†ã€‚</p>
<blockquote>
<p> In short, the microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery. There is a bare minimum of centralized management of these services, which may be written in different programming languages and use different data storage technologies.</p>
</blockquote>
<p>Martin Fowleråœ¨2014å¹´æå‡ºäº†â€œå¾®æœåŠ¡â€æ¶æ„ï¼Œå®ƒæ˜¯ä¸€ç§å…¨æ–°çš„æ¶æ„é£æ ¼ã€‚</p>
<ul>
<li>å¾®æœåŠ¡æŠŠä¸€ä¸ªåºå¤§çš„å•ä½“åº”ç”¨æ‹†åˆ†ä¸ºä¸€ä¸ªä¸ªçš„å°å‹æœåŠ¡ï¼Œæ¯”å¦‚æˆ‘ä»¬åŸæ¥çš„å›¾ä¹¦ç®¡ç†é¡¹ç›®ä¸­ï¼Œæœ‰ç™»å½•ã€æ³¨å†Œã€æ·»åŠ ã€åˆ é™¤ã€æœç´¢ç­‰åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†è¿™äº›åŠŸèƒ½å•ç‹¬åšæˆä¸€ä¸ªä¸ªå°å‹çš„SpringBooté¡¹ç›®ï¼Œç‹¬ç«‹è¿è¡Œã€‚</li>
<li>æ¯ä¸ªå°å‹çš„å¾®æœåŠ¡ï¼Œéƒ½å¯ä»¥ç‹¬ç«‹éƒ¨ç½²å’Œå‡çº§ï¼Œè¿™æ ·ï¼Œå°±ç®—æ•´ä¸ªç³»ç»Ÿå´©æºƒï¼Œé‚£ä¹ˆä¹Ÿåªä¼šå½±å“ä¸€ä¸ªæœåŠ¡çš„è¿è¡Œã€‚</li>
<li>å¾®æœåŠ¡ä¹‹é—´ä½¿ç”¨HTTPè¿›è¡Œæ•°æ®äº¤äº’ï¼Œä¸å†æ˜¯å•ä½“åº”ç”¨å†…éƒ¨äº¤äº’äº†ï¼Œè™½ç„¶è¿™æ ·ä¼šæ˜¾å¾—æ›´éº»çƒ¦ï¼Œä½†æ˜¯å¸¦æ¥çš„å¥½å¤„ä¹Ÿæ˜¯å¾ˆç›´æ¥çš„ï¼Œç”šè‡³èƒ½çªç ´è¯­è¨€é™åˆ¶ï¼Œä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€è¿›è¡Œå¾®æœåŠ¡å¼€å‘ï¼Œåªéœ€è¦ä½¿ç”¨HTTPè¿›è¡Œæ•°æ®äº¤äº’å³å¯ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥åŒæ—¶è´­ä¹°å¤šå°ä¸»æœºæ¥åˆ†åˆ«éƒ¨ç½²è¿™äº›å¾®æœåŠ¡ï¼Œè¿™æ ·ï¼Œå•æœºçš„å‹åŠ›å°±è¢«åˆ†æ•£åˆ°å¤šå°æœºå™¨ï¼Œå¹¶ä¸”æ¯å°æœºå™¨çš„é…ç½®ä¸ä¸€å®šéœ€è¦å¤ªé«˜ï¼Œè¿™æ ·å°±èƒ½èŠ‚çœå¤§é‡çš„æˆæœ¬ï¼ŒåŒæ—¶å®‰å…¨æ€§ä¹Ÿå¾—åˆ°å¾ˆå¤§çš„ä¿è¯ã€‚</li>
<li>ç”šè‡³åŒä¸€ä¸ªå¾®æœåŠ¡å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªï¼Œè¿™æ ·å½“å…¶ä¸­ä¸€ä¸ªæœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œå…¶ä»–æœåŠ¡å™¨ä¹Ÿåœ¨è¿è¡ŒåŒæ ·çš„å¾®æœåŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ä¸€ä¸ªå¾®æœåŠ¡çš„é«˜å¯ç”¨ã€‚</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0idyqgp12j21m00im0wa.jpg" alt="image-20220322090754438"></p>
<p>å½“ç„¶ï¼Œè¿™é‡Œåªæ˜¯ç®€å•çš„æ¼”ç¤ºä¸€ä¸‹å¾®æœåŠ¡æ¶æ„ï¼Œå®é™…å¼€å‘ä¸­è‚¯å®šæ˜¯æ¯”è¿™ä¸ªå¤æ‚å¾—å¤šçš„ã€‚</p>
<p>å¯è§ï¼Œé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œæ›´åŠ èƒ½å¤Ÿåº”å¯¹å½“ä»Šæ—¶ä»£ä¸‹çš„ç§ç§è€ƒéªŒï¼Œä¼ ç»Ÿé¡¹ç›®çš„å¼€å‘æ¨¡å¼ï¼Œéœ€è¦è¿›è¡Œæ¶æ„ä¸Šçš„å‡çº§ã€‚</p>
<h2 id="èµ°è¿›SpringCloud"><a href="#èµ°è¿›SpringCloud" class="headerlink" title="èµ°è¿›SpringCloud"></a>èµ°è¿›SpringCloud</h2><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†å¾®æœåŠ¡æ¶æ„çš„ä¼˜ç‚¹ï¼Œé‚£ä¹ˆåŒæ ·çš„ï¼Œè¿™äº›ä¼˜ç‚¹çš„èƒŒåä¹Ÿå­˜åœ¨ç€è¯¸å¤šçš„é—®é¢˜ï¼š</p>
<ul>
<li>è¦å®ç°å¾®æœåŠ¡å¹¶ä¸æ˜¯è¯´åªéœ€è¦ç®€å•åœ°å°†é¡¹ç›®è¿›è¡Œæ‹†åˆ†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘å¯¹å„ä¸ªå¾®æœåŠ¡è¿›è¡Œç®¡ç†ã€ç›‘æ§ç­‰ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½å¤ŸåŠæ—¶åœ°å¯»æ‰¾å’Œæ’æŸ¥é—®é¢˜ã€‚å› æ­¤å¾®æœåŠ¡å¾€å¾€éœ€è¦çš„æ˜¯ä¸€æ•´å¥—è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æœåŠ¡æ³¨å†Œå’Œå‘ç°ã€å®¹ç¾å¤„ç†ã€è´Ÿè½½å‡è¡¡ã€é…ç½®ç®¡ç†ç­‰ã€‚</li>
<li>å®ƒä¸åƒå•ä½“æ¶æ„é‚£ç§æ–¹ä¾¿ç»´æŠ¤ï¼Œç”±äºéƒ¨ç½²åœ¨å¤šä¸ªæœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¸å¾—ä¸å»ä¿è¯å„ä¸ªå¾®æœåŠ¡èƒ½å¤Ÿç¨³å®šè¿è¡Œï¼Œåœ¨ç®¡ç†éš¾åº¦ä¸Šè‚¯å®šæ˜¯é«˜äºä¼ ç»Ÿå•ä½“åº”ç”¨çš„ã€‚</li>
<li>åœ¨åˆ†å¸ƒå¼çš„ç¯å¢ƒä¸‹ï¼Œå•ä½“åº”ç”¨çš„æŸäº›åŠŸèƒ½å¯èƒ½ä¼šå˜å¾—æ¯”è¾ƒéº»çƒ¦ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œä¸ºäº†æ›´å¥½åœ°è§£å†³è¿™äº›é—®é¢˜ï¼ŒSpringCloudæ­£å¼ç™»åœºã€‚</p>
<p>SpringCloudæ˜¯Springæä¾›çš„ä¸€å¥—åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œé›†åˆäº†ä¸€äº›å¤§å‹äº’è”ç½‘å…¬å¸çš„å¼€æºäº§å“ï¼ŒåŒ…æ‹¬è¯¸å¤šç»„ä»¶ï¼Œå…±åŒç»„æˆSpringCloudæ¡†æ¶ã€‚å¹¶ä¸”ï¼Œå®ƒåˆ©ç”¨Spring Bootçš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚æœåŠ¡å‘ç°æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­æœºåˆ¶ã€æ•°æ®ç›‘æ§ç­‰ï¼Œéƒ½å¯ä»¥ç”¨Spring Bootçš„å¼€å‘é£æ ¼åšåˆ°ä¸€é”®å¯åŠ¨å’Œéƒ¨ç½²ã€‚</p>
<p>ç”±äºä¸­å°å‹å…¬å¸æ²¡æœ‰ç‹¬ç«‹å¼€å‘è‡ªå·±çš„åˆ†å¸ƒå¼åŸºç¡€è®¾æ–½çš„èƒ½åŠ›ï¼Œä½¿ç”¨SpringCloudè§£å†³æ–¹æ¡ˆèƒ½å¤Ÿä»¥æœ€ä½çš„æˆæœ¬åº”å¯¹å½“å‰æ—¶ä»£çš„ä¸šåŠ¡å‘å±•ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0ig93rk52j21ss0nytbj.jpg" alt="image-20220322102706256"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒSpringCloudæ•´ä½“æ¶æ„çš„äº®ç‚¹æ˜¯éå¸¸æ˜æ˜¾çš„ï¼Œåˆ†å¸ƒå¼æ¶æ„ä¸‹çš„å„ä¸ªåœºæ™¯ï¼Œéƒ½æœ‰å¯¹åº”çš„ç»„ä»¶æ¥å¤„ç†ï¼Œæ¯”å¦‚åŸºäºNetflixï¼ˆå¥ˆé£ï¼‰çš„å¼€æºåˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆæä¾›çš„ç»„ä»¶ï¼š</p>
<ul>
<li>Eureka  -  å®ç°æœåŠ¡æ²»ç†ï¼ˆæœåŠ¡æ³¨å†Œä¸å‘ç°ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰çš„å¾®æœåŠ¡è¿›è¡Œé›†ä¸­ç®¡ç†ï¼ŒåŒ…æ‹¬ä»–ä»¬çš„è¿è¡ŒçŠ¶æ€ã€ä¿¡æ¯ç­‰ã€‚</li>
<li>Ribbon  -  ä¸ºæœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨æä¾›è´Ÿè½½å‡è¡¡ç®—æ³•ï¼ˆç°åœ¨è¢«SpringCloudLoadBalancerå–ä»£ï¼‰</li>
<li>Hystrix  -  æ–­è·¯å™¨ï¼Œä¿æŠ¤ç³»ç»Ÿï¼Œæ§åˆ¶æ•…éšœèŒƒå›´ã€‚æš‚æ—¶å¯ä»¥è·Ÿå®¶é‡Œç”µé—¸çš„ä¿é™©ä¸ç±»æ¯”ï¼Œå½“è§¦ç”µå±é™©å‘ç”Ÿæ—¶èƒ½å¤Ÿé˜²æ­¢è¿›ä¸€æ­¥çš„å‘å±•ã€‚</li>
<li>Zuul   -     apiç½‘å…³ï¼Œè·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡ç­‰å¤šç§ä½œç”¨ï¼Œå°±åƒæˆ‘ä»¬çš„è·¯ç”±å™¨ï¼Œå¯èƒ½æœ‰å¾ˆå¤šä¸ªè®¾å¤‡éƒ½è¿æ¥äº†è·¯ç”±å™¨ï¼Œä½†æ˜¯æ•°æ®åŒ…è¦è½¬å‘ç»™è°åˆ™æ˜¯ç”±è·¯ç”±å™¨åœ¨è¿›è¡Œï¼ˆå·²ç»è¢«SpringCloudGatewayå–ä»£ï¼‰</li>
<li>Config  -  é…ç½®ç®¡ç†ï¼Œå¯ä»¥å®ç°é…ç½®æ–‡ä»¶é›†ä¸­ç®¡ç†</li>
</ul>
<p>å½“ç„¶ï¼Œè¿™é‡Œåªæ˜¯è¿›è¡Œç®€å•çš„äº†è§£å³å¯ï¼Œå®é™…ä¸Šå¾®æœåŠ¡çš„ç©æ³•éå¸¸å¤šï¼Œæˆ‘ä»¬åé¢çš„å­¦ä¹ ä¸­å°†ä¼šé€æ­¥è¿›è¡Œæ¢ç´¢ã€‚</p>
<p>é‚£ä¹ˆé¦–å…ˆï¼Œæˆ‘ä»¬å°±ä»æ³¨å†Œä¸­å¿ƒå¼€å§‹è¯´èµ·ã€‚</p>
<hr>
<h2 id="Eureka-æ³¨å†Œä¸­å¿ƒ"><a href="#Eureka-æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="Eureka æ³¨å†Œä¸­å¿ƒ"></a>Eureka æ³¨å†Œä¸­å¿ƒ</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-cloud-netflix/docs/current/reference/html/">https://docs.spring.io/spring-cloud-netflix/docs/current/reference/html/</a></p>
<p><strong>å°è´´å£«ï¼š</strong>å„ä½å°ä¼™ä¼´åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­è§‰å¾—æœ‰ä»€ä¹ˆç–‘æƒ‘çš„å¯ä»¥ç›´æ¥æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘ä»¬ä¼šåœ¨æ¯ä¸€ä¸ªæŠ€æœ¯å¼€å§‹ä¹‹å‰è´´ä¸Šå®˜æ–¹æ–‡æ¡£çš„åœ°å€ï¼Œæ–¹ä¾¿å„ä½è¿›è¡ŒæŸ¥é˜…ï¼ŒåŒæ—¶åœ¨æˆ‘ä»¬çš„è¯¾ç¨‹ä¸­å¹¶ä¸ä¸€å®šä¼šå®Œå®Œæ•´æ•´åœ°è®²å®Œæ•´ä¸ªæ¡†æ¶çš„å†…å®¹ï¼Œæœ‰å…³è¯¦ç»†çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•æ–‡æ¡£ä¸­ä¹Ÿæ˜¯å†™çš„éå¸¸æ¸…æ¥šçš„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥æ·±å…¥å­¦ä¹ å“¦ã€‚</p>
<h3 id="å¾®æœåŠ¡é¡¹ç›®ç»“æ„"><a href="#å¾®æœåŠ¡é¡¹ç›®ç»“æ„" class="headerlink" title="å¾®æœåŠ¡é¡¹ç›®ç»“æ„"></a>å¾®æœåŠ¡é¡¹ç›®ç»“æ„</h3><p>ç°åœ¨æˆ‘ä»¬é‡æ–°è®¾è®¡ä¸€ä¸‹ä¹‹å‰çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿé¡¹ç›®ï¼Œå°†åŸæœ‰çš„å¤§å‹ï¼ˆä¹Ÿè®¸ é¡¹ç›®è¿›è¡Œæ‹†åˆ†ï¼Œæ³¨æ„é¡¹ç›®æ‹†åˆ†ä¸€å®šè¦å°½å¯èƒ½ä¿è¯å•ä¸€èŒè´£ï¼Œç›¸åŒçš„ä¸šåŠ¡ä¸è¦åœ¨å¤šä¸ªå¾®æœåŠ¡ä¸­é‡å¤å‡ºç°ï¼Œå¦‚æœå‡ºç°éœ€è¦å€ŸåŠ©å…¶ä»–ä¸šåŠ¡å®Œæˆçš„æœåŠ¡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨æœåŠ¡ä¹‹é—´ç›¸äº’è°ƒç”¨çš„å½¢å¼æ¥å®ç°ï¼ˆä¹‹åä¼šä»‹ç»ï¼‰ï¼š</p>
<ul>
<li>ç™»å½•éªŒè¯æœåŠ¡ï¼šç”¨äºå¤„ç†ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€å¯†ç é‡ç½®ç­‰ï¼Œåæ­£å°±æ˜¯ä¸€åˆ‡ä¸è´¦æˆ·ç›¸å…³çš„å†…å®¹ï¼ŒåŒ…æ‹¬ç”¨æˆ·ä¿¡æ¯è·å–ç­‰ã€‚</li>
<li>å›¾ä¹¦ç®¡ç†æœåŠ¡ï¼šç”¨äºè¿›è¡Œå›¾ä¹¦æ·»åŠ ã€åˆ é™¤ã€æ›´æ–°ç­‰æ“ä½œï¼Œå›¾ä¹¦ç®¡ç†ç›¸å…³çš„æœåŠ¡ï¼ŒåŒ…æ‹¬å›¾ä¹¦çš„å­˜å‚¨ç­‰å’Œä¿¡æ¯è·å–ã€‚</li>
<li>å›¾ä¹¦å€Ÿé˜…æœåŠ¡ï¼šäº¤äº’æ€§æ¯”è¾ƒå¼ºçš„æœåŠ¡ï¼Œéœ€è¦å’Œç™»é™†éªŒè¯æœåŠ¡å’Œå›¾ä¹¦ç®¡ç†æœåŠ¡è¿›è¡Œäº¤äº’ã€‚</li>
</ul>
<p>é‚£ä¹ˆæ—¢ç„¶è¦å°†å•ä½“åº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ªå°å‹æœåŠ¡ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡æ–°è®¾è®¡ä¸€ä¸‹æ•´ä¸ªé¡¹ç›®ç›®å½•ç»“æ„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±åˆ›å»ºå¤šä¸ªå­é¡¹ç›®ï¼Œæ¯ä¸€ä¸ªå­é¡¹ç›®éƒ½æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ ·ç”±çˆ¶é¡¹ç›®ç»Ÿä¸€ç®¡ç†ä¾èµ–ï¼Œå°±æ— éœ€æ¯ä¸ªå­é¡¹ç›®éƒ½å»å•ç‹¬ç®¡ç†ä¾èµ–äº†ï¼Œä¹Ÿæ›´æ–¹ä¾¿ä¸€ç‚¹ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ™®é€šçš„SpringBooté¡¹ç›®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jmp0yg1lj21zh0u0q8t.jpg" alt="image-20220323105531867"></p>
<p>ç„¶åä¸éœ€è¦å‹¾é€‰ä»»ä½•ä¾èµ–ï¼Œç›´æ¥åˆ›å»ºå³å¯ï¼Œé¡¹ç›®åˆ›å»ºå®Œæˆå¹¶åˆå§‹åŒ–åï¼Œæˆ‘ä»¬åˆ é™¤çˆ¶å·¥ç¨‹çš„æ— ç”¨æ–‡ä»¶ï¼Œåªä¿ç•™å¿…è¦æ–‡ä»¶ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jmsk8wcrj21rw0lojt4.jpg" alt="image-20220323105859454"></p>
<p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§æˆ‘ä»¬åˆ’åˆ†çš„æœåŠ¡ï¼Œè¿›è¡Œå­å·¥ç¨‹åˆ›å»ºäº†ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„Mavené¡¹ç›®ï¼Œæ³¨æ„çˆ¶é¡¹ç›®è¦æŒ‡å®šä¸ºæˆ‘ä»¬ä¸€å¼€å§‹åˆ›å»ºçš„çš„é¡¹ç›®ï¼Œå­é¡¹ç›®å‘½åéšæ„ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jmv8tewij21rc0f640q.jpg" alt="image-20220323110133466"></p>
<p>å­é¡¹ç›®åˆ›å»ºå¥½ä¹‹åï¼Œæ¥ç€æˆ‘ä»¬åœ¨å­é¡¹ç›®ä¸­åˆ›å»ºSpringBootçš„å¯åŠ¨ä¸»ç±»ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jn1w0ru4j21ra0kedkk.jpg" alt="image-20220323110756722"></p>
<p>æ¥ç€æˆ‘ä»¬ç‚¹å‡»è¿è¡Œï¼Œå³å¯å¯åŠ¨å­é¡¹ç›®äº†ï¼Œå®é™…ä¸Šè¿™ä¸ªå­é¡¹ç›®å°±ä¸€ä¸ªæœ€ç®€å•çš„SpringBoot webé¡¹ç›®ï¼Œæ³¨æ„å¯åŠ¨ä¹‹åæœ€ä¸‹æ–¹æœ‰å¼¹çª—ï¼Œæˆ‘ä»¬ç‚¹å‡»â€ä½¿ç”¨ æœåŠ¡â€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®æ—¶æŸ¥çœ‹å½“å‰æ•´ä¸ªå¤§é¡¹ç›®ä¸­æœ‰å“ªäº›å¾®æœåŠ¡äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jn3ah2t1j21by078t9h.jpg" alt="image-20220323110917997"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jn50f7aqj22po0kygus.jpg" alt="image-20220323111056940"></p>
<p>æ¥ç€æˆ‘ä»¬ä»¥åŒæ ·çš„æ–¹æ³•ï¼Œåˆ›å»ºå…¶ä»–çš„å­é¡¹ç›®ï¼Œæ³¨æ„æˆ‘ä»¬æœ€å¥½å°†å…¶ä»–å­é¡¹ç›®çš„ç«¯å£è®¾ç½®å¾—ä¸ä¸€æ ·ï¼Œä¸ç„¶ä¼šå¯¼è‡´ç«¯å£å ç”¨ï¼Œæˆ‘ä»¬åˆ†åˆ«ä¸ºå®ƒä»¬åˆ›å»º<code>application.yml</code>æ–‡ä»¶ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jnbw1wi8j22ci0i2778.jpg" alt="image-20220323111733605"></p>
<p>æ¥ç€æˆ‘ä»¬æ¥å°è¯•å¯åŠ¨ä¸€ä¸‹è¿™ä¸‰ä¸ªæœåŠ¡ï¼Œæ­£å¸¸æƒ…å†µä¸‹éƒ½æ˜¯å¯ä»¥ç›´æ¥å¯åŠ¨çš„ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jnd7uz99j22q40ks7dw.jpg" alt="image-20220323111849846"></p>
<p>å¯ä»¥çœ‹åˆ°å®ƒä»¬åˆ†åˆ«è¿è¡Œåœ¨ä¸åŒçš„ç«¯å£ä¸Šï¼Œè¿™æ ·ï¼Œå°±æ–¹ä¾¿ä¸åŒçš„ç¨‹åºå‘˜ç¼–å†™ä¸åŒçš„æœåŠ¡äº†ï¼Œæäº¤å½“å‰é¡¹ç›®ä»£ç æ—¶çš„å†²çªç‡ä¹Ÿä¼šé™ä½ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸‹æ•°æ®åº“ï¼Œè¿™é‡Œè¿˜æ˜¯è€æ ·å­ï¼Œåˆ›å»ºä¸‰ä¸ªè¡¨å³å¯ï¼Œå½“ç„¶å®é™…ä¸Šæ¯ä¸ªå¾®æœåŠ¡å•ç‹¬ä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºæŒ‰ç…§å•ä¸€èŒè´£æœåŠ¡åªä¼šæ“ä½œè‡ªå·±å¯¹åº”çš„è¡¨ï¼Œè¿™é‡ŒUPä¸»æ¯”è¾ƒç©·ï¼Œå°±åªç”¨ä¸€ä¸ªæ•°æ®åº“æ¼”ç¤ºäº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jni9lpt1j214w09w3zd.jpg" alt="image-20220323112340995"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jnkydk2mj214y090t9h.jpg" alt="image-20220323112616538"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jnnhmt9vj214a072t99.jpg" alt="image-20220323112842758"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jnmlc81qj214806a0th.jpg" alt="image-20220323112750936"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jnn6v8jrj214o04y3yw.jpg" alt="image-20220323112825430"></p>
<p>åˆ›å»ºå¥½ä¹‹åï¼Œç»“æœå¦‚ä¸‹ï¼Œä¸€å…±ä¸‰å¼ è¡¨ï¼Œå„ä½å¯ä»¥è‡ªè¡Œæ·»åŠ ä¸€äº›æ•°æ®åˆ°é‡Œé¢ï¼Œè¿™å°±ä¸è´´å‡ºæ¥äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0jno6ge9hj21go07mab1.jpg" alt="image-20220323112922396"></p>
<p>å¦‚æœå„ä½å«Œéº»çƒ¦çš„è¯å¯ä»¥ä¸‹è½½<code>.sql</code>æ–‡ä»¶è‡ªè¡Œå¯¼å…¥ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥ç¨å¾®å†™ä¸€ç‚¹ä¸šåŠ¡ï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢ä¸šåŠ¡ï¼Œæˆ‘ä»¬å…ˆæŠŠæ•°æ®åº“ç›¸å…³çš„ä¾èµ–è¿›è¡Œå¯¼å…¥ï¼Œè¿™é‡Œä¾ç„¶ä½¿ç”¨Mybatisæ¡†æ¶ï¼Œé¦–å…ˆåœ¨çˆ¶é¡¹ç›®ä¸­æ·»åŠ MySQLé©±åŠ¨å’ŒLombokä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºä¸æ˜¯æ‰€æœ‰çš„å­é¡¹ç›®éƒ½éœ€è¦ç”¨åˆ°Mybatisï¼Œæˆ‘ä»¬åœ¨çˆ¶é¡¹ç›®ä¸­åªè¿›è¡Œç‰ˆæœ¬ç®¡ç†å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥åœ¨ç”¨æˆ·æœåŠ¡å­é¡¹ç›®ä¸­æ·»åŠ æ­¤ä¾èµ–äº†ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æ·»åŠ æ•°æ®æºä¿¡æ¯ï¼ˆUPç”¨åˆ°æ˜¯é˜¿é‡Œäº‘çš„MySQLäº‘æ•°æ®åº“ï¼Œå„ä½æ³¨æ„ä¿®æ”¹ä¸€ä¸‹æ•°æ®åº“åœ°å€ï¼‰ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://cloudstudy.mysql.cn-chengdu.rds.aliyuncs.com:3306/cloudstudy</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥å†™ç”¨æˆ·æŸ¥è¯¢ç›¸å…³çš„ä¸šåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="type">int</span> uid;</span><br><span class="line">    String name;</span><br><span class="line">    String sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from DB_USER where uid = #&#123;uid&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="type">int</span> uid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="type">int</span> uid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mapper.getUserById(uid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserService service;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™é‡Œä»¥RESTFulé£æ ¼ä¸ºä¾‹</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getUserById(uid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬è®¿é—®å³å¯æ‹¿åˆ°æ•°æ®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jredurecj213m06s74p.jpg" alt="image-20220323133820304"></p>
<p>åŒæ ·çš„æ–¹å¼ï¼Œæˆ‘ä»¬å®Œæˆä¸€ä¸‹å›¾ä¹¦æŸ¥è¯¢ä¸šåŠ¡ï¼Œæ³¨æ„ç°åœ¨æ˜¯åœ¨å›¾ä¹¦ç®¡ç†å¾®æœåŠ¡ä¸­ç¼–å†™ï¼ˆåˆ«å¿˜äº†å¯¼å…¥Mybatisä¾èµ–ä»¥åŠé…ç½®æ•°æ®æºï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="type">int</span> bid;</span><br><span class="line">    String title;</span><br><span class="line">    String desc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from DB_BOOK where bid = #&#123;bid&#125;&quot;)</span></span><br><span class="line">    Book <span class="title function_">getBookById</span><span class="params">(<span class="type">int</span> bid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    Book <span class="title function_">getBookById</span><span class="params">(<span class="type">int</span> bid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BookMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getBookById</span><span class="params">(<span class="type">int</span> bid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mapper.getBookById(bid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BookService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/&#123;bid&#125;&quot;)</span></span><br><span class="line">    Book <span class="title function_">findBookById</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> bid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getBookById(bid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·è¿›è¡Œä¸€ä¸‹æµ‹è¯•ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jro4g42vj215006sdgg.jpg" alt="image-20220323134742618"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬ä¸€ä¸ªå®Œæ•´é¡¹ç›®çš„å°±æ‹†åˆ†æˆäº†å¤šä¸ªå¾®æœåŠ¡ï¼Œä¸åŒå¾®æœåŠ¡ä¹‹é—´æ˜¯ç‹¬ç«‹è¿›è¡Œå¼€å‘å’Œéƒ¨ç½²çš„ã€‚</p>
<h3 id="æœåŠ¡é—´è°ƒç”¨"><a href="#æœåŠ¡é—´è°ƒç”¨" class="headerlink" title="æœåŠ¡é—´è°ƒç”¨"></a>æœåŠ¡é—´è°ƒç”¨</h3><p>å‰é¢æˆ‘ä»¬å®Œæˆäº†ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢å’Œå›¾ä¹¦ä¿¡æ¯æŸ¥è¯¢ï¼Œç°åœ¨æˆ‘ä»¬æ¥æ¥ç€å®Œæˆå€Ÿé˜…æœåŠ¡ã€‚</p>
<p>å€Ÿé˜…æœåŠ¡æ˜¯ä¸€ä¸ªå…³è”æ€§æ¯”è¾ƒå¼ºçš„æœåŠ¡ï¼Œå®ƒä¸ä»…ä»…éœ€è¦æŸ¥è¯¢å€Ÿé˜…ä¿¡æ¯ï¼ŒåŒæ—¶å¯èƒ½è¿˜éœ€è¦è·å–å€Ÿé˜…ä¿¡æ¯ä¸‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚å…·ä½“é‚£ä¸ªç”¨æˆ·å€Ÿé˜…äº†å“ªæœ¬ä¹¦ï¼Œå¹¶ä¸”ç”¨æˆ·å’Œä¹¦ç±çš„è¯¦æƒ…ä¹Ÿéœ€è¦åŒæ—¶å‡ºç°ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦å»è®¿é—®é™¤äº†å€Ÿé˜…è¡¨ä»¥å¤–çš„ç”¨æˆ·è¡¨å’Œå›¾ä¹¦è¡¨ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0js1udjp6j21oa0aw40q.jpg" alt="image-20220323140053749"></p>
<p>ä½†æ˜¯è¿™æ˜¾ç„¶æ˜¯è¿åæˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„å•ä¸€èŒè´£çš„ï¼Œç›¸åŒçš„ä¸šåŠ¡åŠŸèƒ½ä¸åº”è¯¥é‡å¤å‡ºç°ï¼Œä½†æ˜¯ç°åœ¨ç”±éœ€è¦åœ¨æ­¤æœåŠ¡ä¸­æŸ¥è¯¢ç”¨æˆ·çš„ä¿¡æ¯å’Œå›¾ä¹¦ä¿¡æ¯ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è®©ä¸€ä¸ªæœåŠ¡å»è°ƒç”¨å¦ä¸€ä¸ªæœåŠ¡æ¥è·å–ä¿¡æ¯ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0js4et40uj21q20agq52.jpg" alt="image-20220323140322502"></p>
<p>è¿™æ ·ï¼Œå›¾ä¹¦ç®¡ç†å¾®æœåŠ¡å’Œç”¨æˆ·ç®¡ç†å¾®æœåŠ¡ç›¸å¯¹äºå€Ÿé˜…è®°å½•ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å…³ç³»ï¼Œå‰è€…æ˜¯ç”Ÿäº§è€…ï¼Œåè€…ä¾¿æ˜¯æ¶ˆè´¹è€…ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å…ˆå°†å€Ÿé˜…å…³è”ä¿¡æ¯æŸ¥è¯¢å®Œå–„äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Borrow</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    <span class="type">int</span> uid;</span><br><span class="line">    <span class="type">int</span> bid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BorrowMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from DB_BORROW where uid = #&#123;uid&#125;&quot;)</span></span><br><span class="line">    List&lt;Borrow&gt; <span class="title function_">getBorrowsByUid</span><span class="params">(<span class="type">int</span> uid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from DB_BORROW where bid = #&#123;bid&#125;&quot;)</span></span><br><span class="line">    List&lt;Borrow&gt; <span class="title function_">getBorrowsByBid</span><span class="params">(<span class="type">int</span> bid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from DB_BORROW where bid = #&#123;bid&#125; and uid = #&#123;uid&#125;&quot;)</span></span><br><span class="line">    Borrow <span class="title function_">getBorrow</span><span class="params">(<span class="type">int</span> uid, <span class="type">int</span> bid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦æŸ¥è¯¢ç”¨æˆ·çš„å€Ÿé˜…è¯¦ç»†ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦æŸ¥è¯¢æŸä¸ªç”¨æˆ·å…·ä½“å€Ÿäº†é‚£äº›ä¹¦ï¼Œå¹¶ä¸”éœ€è¦æ­¤ç”¨æˆ·çš„ä¿¡æ¯å’Œæ‰€æœ‰å·²å€Ÿé˜…çš„ä¹¦ç±ä¿¡æ¯ä¸€èµ·è¿”å›ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥è®¾è®¡ä¸€ä¸‹è¿”å›å®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserBorrowDetail</span> &#123;</span><br><span class="line">    User user;</span><br><span class="line">    List&lt;Book&gt; bookList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‘ç°Userå’ŒBookå®ä½“å®é™…ä¸Šæ˜¯åœ¨å¦å¤–ä¸¤ä¸ªå¾®æœåŠ¡ä¸­å®šä¹‰çš„ï¼Œç›¸å½“äºå½“å‰é¡¹ç›®å¹¶æ²¡æœ‰å®šä¹‰è¿™äº›å®ä½“ç±»ï¼Œé‚£ä¹ˆæ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰æœåŠ¡éœ€è¦ç”¨åˆ°çš„å®ä½“ç±»å•ç‹¬æ”¾å…¥å¦ä¸€ä¸ªä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œç„¶åè®©è¿™äº›é¡¹ç›®å¼•ç”¨é›†ä¸­å­˜æ”¾å®ä½“ç±»çš„é‚£ä¸ªé¡¹ç›®ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æ¯ä¸ªå¾®æœåŠ¡çš„å®ä½“ç±»ä¿¡æ¯éƒ½å¯ä»¥å…±ç”¨äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jsl18z1fj221e0bi0w1.jpg" alt="image-20220323141919836"></p>
<p>ç„¶ååªéœ€è¦åœ¨å¯¹åº”çš„ç±»ä¸­å¼•ç”¨æ­¤é¡¹ç›®ä½œä¸ºä¾èµ–å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæ–°çš„å…¬å…±å®ä½“ç±»éƒ½å¯ä»¥åœ¨<code>commons</code>é¡¹ç›®ä¸­è¿›è¡Œå®šä¹‰äº†ï¼Œç°åœ¨æˆ‘ä»¬æ¥ç€æ¥å®Œæˆåˆšåˆšçš„éœ€æ±‚ï¼Œå…ˆå®šä¹‰æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BorrowService</span> &#123;</span><br><span class="line"></span><br><span class="line">    UserBorrowDetail <span class="title function_">getUserBorrowDetailByUid</span><span class="params">(<span class="type">int</span> uid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BorrowService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getUserBorrowDetailByUid</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrow = mapper.getBorrowsByUid(uid);</span><br><span class="line">        <span class="comment">//é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç°åœ¨æ‹¿åˆ°å€Ÿé˜…å…³è”ä¿¡æ¯äº†ï¼Œæ€ä¹ˆè°ƒç”¨å…¶ä»–æœåŠ¡è·å–ä¿¡æ¯å‘¢ï¼Ÿ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>éœ€è¦è¿›è¡ŒæœåŠ¡è¿œç¨‹è°ƒç”¨æˆ‘ä»¬éœ€è¦ç”¨åˆ°<code>RestTemplate</code>æ¥è¿›è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BorrowService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getUserBorrowDetailByUid</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrow = mapper.getBorrowsByUid(uid);</span><br><span class="line">        <span class="comment">//RestTemplateæ”¯æŒå¤šç§æ–¹å¼çš„è¿œç¨‹è°ƒç”¨</span></span><br><span class="line">        <span class="type">RestTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">        <span class="comment">//è¿™é‡Œé€šè¿‡è°ƒç”¨getForObjectæ¥è¯·æ±‚å…¶ä»–æœåŠ¡ï¼Œå¹¶å°†ç»“æœè‡ªåŠ¨è¿›è¡Œå°è£…</span></span><br><span class="line">        <span class="comment">//è·å–Userä¿¡æ¯</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> template.getForObject(<span class="string">&quot;http://localhost:8082/user/&quot;</span>+uid, User.class);</span><br><span class="line">        <span class="comment">//è·å–æ¯ä¸€æœ¬ä¹¦çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">        List&lt;Book&gt; bookList = borrow</span><br><span class="line">                .stream()</span><br><span class="line">                .map(b -&gt; template.getForObject(<span class="string">&quot;http://localhost:8080/book/&quot;</span>+b.getBid(), Book.class))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(user, bookList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å†æœ€åå®Œå–„ä¸€ä¸‹Controllerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow/&#123;uid&#125;&quot;)</span></span><br><span class="line">    UserBorrowDetail <span class="title function_">findUserBorrows</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getUserBorrowDetailByUid(uid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ•°æ®åº“ä¸­æ·»åŠ ä¸€ç‚¹å€Ÿé˜…ä¿¡æ¯ï¼Œæµ‹è¯•çœ‹çœ‹èƒ½ä¸èƒ½æ­£å¸¸è·å–ï¼ˆæ³¨æ„ä¸€å®šè¦ä¿è¯ä¸‰ä¸ªæœåŠ¡éƒ½å¤„äºå¼€å¯çŠ¶æ€ï¼Œå¦åˆ™è¿œç¨‹è°ƒç”¨ä¼šå¤±è´¥ï¼‰ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jt4ccuywj226i06wdh5.jpg" alt="image-20220323143753567"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç»“æœæ­£å¸¸ï¼Œæ²¡æœ‰é—®é¢˜ï¼Œè¿œç¨‹è°ƒç”¨æˆåŠŸã€‚</p>
<p>è¿™æ ·ï¼Œä¸€ä¸ªç®€æ˜“çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿçš„åˆ†å¸ƒå¼é¡¹ç›®å°±æ­å»ºå®Œæˆäº†ï¼Œ<strong>è¿™é‡Œè®°å¾—æŠŠæ•´ä¸ªé¡¹ç›®å‹ç¼©æ‰“åŒ…å¤‡ä»½ä¸€ä¸‹</strong>ï¼Œä¸‹ä¸€ç« å­¦ä¹ SpringCloud Alibabaä¹Ÿéœ€è¦è¿›è¡Œé…ç½®ã€‚</p>
<h3 id="æœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#æœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="æœåŠ¡æ³¨å†Œä¸å‘ç°"></a>æœåŠ¡æ³¨å†Œä¸å‘ç°</h3><p>å‰é¢æˆ‘ä»¬äº†è§£äº†å¦‚ä½•å¯¹å•ä½“åº”ç”¨è¿›è¡Œæ‹†åˆ†ï¼Œå¹¶ä¸”ä¹Ÿå­¦ä¹ äº†å¦‚ä½•è¿›è¡ŒæœåŠ¡ä¹‹é—´çš„ç›¸äº’è°ƒç”¨ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è™½ç„¶æœåŠ¡æ‹†åˆ†å®Œæˆï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„ç®¡ç†æœºåˆ¶ï¼Œå¦‚æœå•çº¯åªæ˜¯è¿™æ ·ç¼–å†™ï¼Œåœ¨éƒ¨ç½²å’Œç»´æŠ¤èµ·æ¥ï¼Œè‚¯å®šæ˜¯å¾ˆéº»çƒ¦çš„ã€‚å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæŸä¸€å¤©è¿™äº›å¾®æœåŠ¡çš„ç«¯å£æˆ–æ˜¯åœ°å€å¤§è§„æ¨¡åœ°å‘ç”Ÿæ”¹å˜ï¼Œæˆ‘ä»¬å°±ä¸å¾—ä¸å°†æœåŠ¡ä¹‹é—´çš„è°ƒç”¨è·¯å¾„å¤§è§„æ¨¡çš„åŒæ­¥è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ˜¯å¤šä¹ˆå¯æ€•çš„äº‹æƒ…ã€‚æˆ‘ä»¬éœ€è¦å‰Šå¼±è¿™ç§æœåŠ¡ä¹‹é—´çš„å¼ºå…³è”æ€§ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé›†ä¸­ç®¡ç†å¾®æœåŠ¡çš„å¹³å°ï¼Œè¿™æ—¶å°±è¦å€ŸåŠ©æˆ‘ä»¬è¿™ä¸€éƒ¨åˆ†çš„ä¸»è§’äº†ã€‚</p>
<p>Eurekaèƒ½å¤Ÿè‡ªåŠ¨æ³¨å†Œå¹¶å‘ç°å¾®æœåŠ¡ï¼Œç„¶åå¯¹æœåŠ¡çš„çŠ¶æ€ã€ä¿¡æ¯è¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œè¿™æ ·å½“æˆ‘ä»¬éœ€è¦è·å–å…¶ä»–æœåŠ¡çš„ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Eurekaè¿›è¡ŒæŸ¥è¯¢å°±å¯ä»¥äº†ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jthur4u0j21lu0dytam.jpg" alt="image-20220323145051821"></p>
<p>åƒè¿™æ ·çš„è¯ï¼ŒæœåŠ¡ä¹‹é—´çš„å¼ºå…³è”æ€§å°±ä¼šè¢«è¿›ä¸€æ­¥å‰Šå¼±ã€‚</p>
<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬å°±æ¥æ­å»ºä¸€ä¸ªEurekaæœåŠ¡å™¨ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„Mavené¡¹ç›®å³å¯ï¼Œç„¶åæˆ‘ä»¬éœ€è¦åœ¨çˆ¶å·¥ç¨‹ä¸­æ·»åŠ ä¸€ä¸‹SpringCloudçš„ä¾èµ–ï¼Œè¿™é‡Œé€‰ç”¨<code>2021.0.1</code>ç‰ˆæœ¬ï¼ˆSpring Cloud æœ€æ–°çš„ç‰ˆæœ¬å‘½åæ–¹å¼å˜æ›´äº†ï¼Œç°åœ¨æ˜¯ <em><strong>YEAR.x</strong></em> è¿™ç§å‘½åæ–¹å¼ï¼Œå…·ä½“å¯ä»¥åœ¨å®˜ç½‘æŸ¥çœ‹ï¼š<a href="https://spring.io/projects/spring-cloud#learn%EF%BC%89%EF%BC%9A">https://spring.io/projects/spring-cloud#learnï¼‰ï¼š</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬ä¸ºæ–°åˆ›å»ºçš„é¡¹ç›®æ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½å†…å®¹æœ‰ç‚¹å¤šï¼Œé¦–æ¬¡å¯¼å…¥è¯·è€å¿ƒç­‰å¾…ä¸€ä¸‹ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥åˆ›å»ºä¸»ç±»ï¼Œè¿˜æ˜¯ä¸€æ ·çš„æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaServerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EurekaServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ«ç€æ€¥å¯åŠ¨ï¼ï¼ï¼æ¥ç€æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8888</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">	<span class="comment"># å¼€å¯ä¹‹å‰éœ€è¦ä¿®æ”¹ä¸€ä¸‹å®¢æˆ·ç«¯è®¾ç½®ï¼ˆè™½ç„¶æ˜¯æœåŠ¡ç«¯</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">  	<span class="comment"># ç”±äºæˆ‘ä»¬æ˜¯ä½œä¸ºæœåŠ¡ç«¯è§’è‰²ï¼Œæ‰€ä»¥ä¸éœ€è¦è·å–æœåŠ¡ç«¯ï¼Œæ”¹ä¸ºfalseï¼Œé»˜è®¤ä¸ºtrue</span></span><br><span class="line">		<span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">		<span class="comment"># æš‚æ—¶ä¸éœ€è¦å°†è‡ªå·±ä¹Ÿæ³¨å†Œåˆ°Eureka</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># å°†eurekaæœåŠ¡ç«¯æŒ‡å‘è‡ªå·±</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8888/eureka</span></span><br></pre></td></tr></table></figure>

<p>å¥½äº†ï¼Œç°åœ¨å·®ä¸å¤šå¯ä»¥å¯åŠ¨äº†ï¼Œå¯åŠ¨å®Œæˆåï¼Œç›´æ¥è¾“å…¥åœ°å€+ç«¯å£å³å¯è®¿é—®Eurekaçš„ç®¡ç†åå°ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jui0bzpvj21l60u0wi1.jpg" alt="image-20220323152537322"></p>
<p>å¯ä»¥çœ‹åˆ°ç›®å‰è¿˜æ²¡æœ‰ä»»ä½•çš„æœåŠ¡æ³¨å†Œåˆ°Eurekaï¼Œæˆ‘ä»¬æ¥ç€æ¥é…ç½®ä¸€ä¸‹æˆ‘ä»¬çš„ä¸‰ä¸ªå¾®æœåŠ¡ï¼Œé¦–å…ˆè¿˜æ˜¯éœ€è¦å¯¼å…¥Eurekaä¾èµ–ï¼ˆæ³¨æ„åˆ«å¯¼é”™äº†ï¼Œåç§°é‡Œé¢æœ‰ä¸ªstarterçš„æ‰æ˜¯ï¼‰ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">  	<span class="comment"># è·Ÿä¸Šé¢ä¸€æ ·ï¼Œéœ€è¦æŒ‡å‘EurekaæœåŠ¡ç«¯åœ°å€ï¼Œè¿™æ ·æ‰èƒ½è¿›è¡Œæ³¨å†Œ</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8888/eureka</span></span><br></pre></td></tr></table></figure>

<p>OKï¼Œæ— éœ€åœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼Œç›´æ¥å¯åŠ¨å°±å¯ä»¥äº†ï¼Œç„¶åæ‰“å¼€Eurekaçš„æœåŠ¡ç®¡ç†é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšåˆšå¼€å¯çš„æœåŠ¡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jv4mtugqj22lm0ec40f.jpg" alt="image-20220323154722373"></p>
<p>å¯ä»¥çœ‹åˆ°<code>8082</code>ç«¯å£ä¸Šçš„æœåŠ¡å™¨ï¼Œå·²ç»æˆåŠŸæ³¨å†Œåˆ°Eurekaäº†ï¼Œä½†æ˜¯è¿™ä¸ªæœåŠ¡åç§°æ€ä¹ˆä¼šæ˜¾ç¤ºä¸ºUNKNOWNï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jval83b7j22ls0c60ul.jpg" alt="image-20220323155305545"></p>
<p>å½“æˆ‘ä»¬çš„æœåŠ¡å¯åŠ¨ä¹‹åï¼Œä¼šæ¯éš”ä¸€æ®µæ—¶é—´è·ŸEurekaå‘é€ä¸€æ¬¡å¿ƒè·³åŒ…ï¼Œè¿™æ ·Eurekaå°±èƒ½å¤Ÿæ„ŸçŸ¥åˆ°æˆ‘ä»¬çš„æœåŠ¡æ˜¯å¦å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œå°†å¦å¤–ä¸¤ä¸ªå¾®æœåŠ¡ä¹Ÿæ³¨å†Œè¿›æ¥ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jvhkpma7j22m80c2mzo.jpg" alt="image-20220323155948425"></p>
<p>é‚£ä¹ˆï¼Œç°åœ¨æˆ‘ä»¬æ€ä¹ˆå®ç°æœåŠ¡å‘ç°å‘¢ï¼Ÿ</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¹‹å‰å¦‚æœéœ€è¦å¯¹å…¶ä»–å¾®æœåŠ¡è¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦çŸ¥é“å…¶ä»–æœåŠ¡çš„åœ°å€ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> template.getForObject(<span class="string">&quot;http://localhost:8082/user/&quot;</span>+uid, User.class);</span><br></pre></td></tr></table></figure>

<p>è€Œç°åœ¨æœ‰äº†Eurekaä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å‘å…¶è¿›è¡ŒæŸ¥è¯¢ï¼Œå¾—åˆ°å¯¹åº”çš„å¾®æœåŠ¡åœ°å€ï¼Œè¿™é‡Œç›´æ¥å°†æœåŠ¡åç§°æ›¿æ¢å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BorrowService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    RestTemplate template;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getUserBorrowDetailByUid</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrow = mapper.getBorrowsByUid(uid);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™é‡Œä¸ç”¨å†å†™IPï¼Œç›´æ¥å†™æœåŠ¡åç§°userservice</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> template.getForObject(<span class="string">&quot;http://userservice/user/&quot;</span>+uid, User.class);</span><br><span class="line">        <span class="comment">//è¿™é‡Œä¸ç”¨å†å†™IPï¼Œç›´æ¥å†™æœåŠ¡åç§°bookservice</span></span><br><span class="line">        List&lt;Book&gt; bookList = borrow</span><br><span class="line">                .stream()</span><br><span class="line">                .map(b -&gt; template.getForObject(<span class="string">&quot;http://bookservice/book/&quot;</span>+b.getBid(), Book.class))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(user, bookList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ‰‹åŠ¨å°†RestTemplateå£°æ˜ä¸ºä¸€ä¸ªBeanï¼Œç„¶åæ·»åŠ <code>@LoadBalanced</code>æ³¨è§£ï¼Œè¿™æ ·Eurekaå°±ä¼šå¯¹æœåŠ¡çš„è°ƒç”¨è¿›è¡Œè‡ªåŠ¨å‘ç°ï¼Œå¹¶æä¾›è´Ÿè½½å‡è¡¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    RestTemplate <span class="title function_">template</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æ­£å¸¸è°ƒç”¨äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jw0nxoykj22720bqjsw.jpg" alt="image-20220323161809122"></p>
<p>ä¸å¯¹å•Šï¼Œä¸æ˜¯è¯´æœ‰è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›å—ï¼Œæ€ä¹ˆä¸ªè´Ÿè½½å‡è¡¡å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ï¼ŒåŒä¸€ä¸ªæœåŠ¡å™¨å®é™…ä¸Šæ˜¯å¯ä»¥æ³¨å†Œå¾ˆå¤šä¸ªçš„ï¼Œä½†æ˜¯å®ƒä»¬çš„ç«¯å£ä¸åŒï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œåˆ›å»ºå¤šä¸ªç”¨æˆ·æŸ¥è¯¢æœåŠ¡ï¼Œæˆ‘ä»¬ç°åœ¨å°†åŸæœ‰çš„ç«¯å£é…ç½®ä¿®æ”¹ä¸€ä¸‹ï¼Œç”±IDEAä¸­è®¾å®šå¯åŠ¨å‚æ•°æ¥å†³å®šï¼Œè¿™æ ·å°±å¯ä»¥å¤šåˆ›å»ºå‡ ä¸ªä¸åŒç«¯å£çš„å¯åŠ¨é¡¹äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jwbxq00pj21ue0rcgqf.jpg" alt="image-20220323162858616"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jwch1eb2j21ng08ead5.jpg" alt="image-20220323162926482"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨Eurekaä¸­ï¼ŒåŒä¸€ä¸ªæœåŠ¡å‡ºç°äº†ä¸¤ä¸ªå®ä¾‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jwd5r9bgj21w00c8mz4.jpg" alt="image-20220323163010052"></p>
<p>ç°åœ¨æˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ç”¨æˆ·æŸ¥è¯¢ï¼Œç„¶åè¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œçœ‹çœ‹è¯·æ±‚æ˜¯ä¸æ˜¯å‡åŒ€åœ°åˆ†é…åˆ°è¿™ä¸¤ä¸ªæœåŠ¡ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserService service;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘è¢«è°ƒç”¨æ‹‰ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> service.getUserById(uid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jwgqas0qj22ci0batb0.jpg" alt="image-20220323163335257"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªå®ä¾‹éƒ½èƒ½å¤Ÿå‡åŒ€åœ°è¢«åˆ†é…è¯·æ±‚ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jwi0a3yhj21tk0gqq9l.jpg" alt="image-20220323163448765"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0jwi5kezyj21me0hmq83.jpg" alt="image-20220323163457877"></p>
<p>è¿™æ ·ï¼ŒæœåŠ¡è‡ªåŠ¨å‘ç°ä»¥åŠç®€å•çš„è´Ÿè½½å‡è¡¡å°±å®ç°å®Œæˆäº†ï¼Œå¹¶ä¸”ï¼Œå¦‚æœæŸä¸ªå¾®æœåŠ¡æŒ‚æ‰äº†ï¼Œåªè¦å­˜åœ¨å…¶ä»–åŒæ ·çš„å¾®æœåŠ¡å®ä¾‹åœ¨è¿è¡Œï¼Œé‚£ä¹ˆå°±ä¸ä¼šå¯¼è‡´æ•´ä¸ªå¾®æœåŠ¡ä¸å¯ç”¨ï¼Œæå¤§åœ°ä¿è¯äº†å®‰å…¨æ€§ã€‚</p>
<h3 id="æ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨"><a href="#æ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨" class="headerlink" title="æ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨"></a>æ³¨å†Œä¸­å¿ƒé«˜å¯ç”¨</h3><p>å„ä½å¯å¦æƒ³è¿‡è¿™æ ·çš„ä¸€ä¸ªé—®é¢˜ï¼Ÿè™½ç„¶Eurekaèƒ½å¤Ÿå®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼Œä½†æ˜¯å¦‚æœEurekaæœåŠ¡å™¨å´©æºƒäº†ï¼Œå²‚ä¸æ˜¯æ‰€æœ‰éœ€è¦ç”¨åˆ°æœåŠ¡å‘ç°çš„å¾®æœåŠ¡å°±GGäº†ï¼Ÿ</p>
<p>ä¸ºäº†é¿å…ï¼Œè¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åƒä¸Šé¢é‚£æ ·ï¼Œæ­å»ºEurekaé›†ç¾¤ï¼Œå­˜åœ¨å¤šä¸ªEurekaæœåŠ¡å™¨ï¼Œè¿™æ ·å°±ç®—æŒ‚æ‰å…¶ä¸­ä¸€ä¸ªï¼Œå…¶ä»–çš„ä¹Ÿè¿˜åœ¨æ­£å¸¸è¿è¡Œï¼Œå°±ä¸ä¼šä½¿å¾—æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸å¯ç”¨ã€‚å½“ç„¶ï¼Œè¦æ˜¯ç‰©ç†é»‘å®¢ç›´æ¥ç‚¸äº†æ•´ä¸ªæœºæˆ¿ï¼Œé‚£è¿˜æ˜¯ç®—äº†å§ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0k41ady28j21jy0iwmzt.jpg" alt="image-20220323205531185"></p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•æ­å»ºEurekaé›†ç¾¤ï¼Œè¿™é‡Œç”±äºæœºå™¨é…ç½®ä¸é«˜ï¼Œå°±æ­å»ºä¸¤ä¸ªEurekaæœåŠ¡å™¨ç»„æˆé›†ç¾¤ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹EurekaæœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8801</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eurekaserver</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">  	<span class="comment"># ç”±äºä¸æ”¯æŒå¤šä¸ªlocalhostçš„EurekaæœåŠ¡å™¨ï¼Œä½†æ˜¯åˆåªæœ‰æœ¬åœ°æµ‹è¯•ç¯å¢ƒï¼Œæ‰€ä»¥å°±åªèƒ½è‡ªå®šä¹‰ä¸»æœºåç§°äº†</span></span><br><span class="line">  	<span class="comment"># ä¸»æœºåç§°æ”¹ä¸ºeureka01</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka01</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># å»æ‰register-with-eurekaé€‰é¡¹ï¼Œè®©EurekaæœåŠ¡å™¨è‡ªå·±æ³¨å†Œåˆ°å…¶ä»–EurekaæœåŠ¡å™¨ï¼Œè¿™æ ·æ‰èƒ½ç›¸äº’å¯ç”¨</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">    	<span class="comment"># æ³¨æ„è¿™é‡Œå¡«å†™å…¶ä»–EurekaæœåŠ¡å™¨çš„åœ°å€ï¼Œä¸ç”¨å†™è‡ªå·±çš„</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka01:8801/eureka</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8802</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eurekaserver</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka02</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://eureka01:8801/eureka</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”±äºæˆ‘ä»¬ä¿®æ”¹æˆè‡ªå®šä¹‰çš„åœ°å€ï¼Œéœ€è¦åœ¨hostsæ–‡ä»¶ä¸­å°†å…¶è§£æåˆ°172.0.0.1æ‰èƒ½å›åˆ°localhostï¼ŒMacä¸‹æ–‡ä»¶è·¯å¾„ä¸º<code>/etc/hosts</code>ï¼ŒWindowsä¸‹ä¸º<code>C:\Windows\system32\drivers\etc\hosts</code>ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0k48bkgyoj212q07a0te.jpg" alt="image-20220323210218653"></p>
<p>å¯¹åˆ›å»ºçš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶åˆ†åˆ«æ·»åŠ å¯åŠ¨é…ç½®ï¼Œç›´æ¥ä½¿ç”¨<code>spring.profiles.active</code>æŒ‡å®šå¯ç”¨çš„é…ç½®æ–‡ä»¶å³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0k4u09lpxj22aw0py0y5.jpg" alt="image-20220323212308857"></p>
<p>æ¥ç€å¯åŠ¨è¿™ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œè¿™ä¸¤ä¸ªEurekaç®¡ç†é¡µé¢éƒ½å¯ä»¥è¢«è®¿é—®ï¼Œæˆ‘ä»¬è®¿é—®å…¶ä¸­ä¸€ä¸ªï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0k4fxnlxtj21yk0cytao.jpg" alt="image-20220323210937341"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0k4chvjv8j21rq07it9k.jpg" alt="image-20220323210619533"></p>
<p>å¯ä»¥çœ‹åˆ°ä¸‹æ–¹<code>replicas</code>ä¸­å·²ç»åŒ…å«äº†å¦ä¸€ä¸ªEurekaæœåŠ¡å™¨çš„åœ°å€ï¼Œå¹¶ä¸”æ˜¯å¯ç”¨çŠ¶æ€ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„å¾®æœåŠ¡é…ç½®ä¹Ÿè¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">    	<span class="comment"># å°†ä¸¤ä¸ªEurekaçš„åœ°å€éƒ½åŠ å…¥ï¼Œè¿™æ ·å°±ç®—æœ‰ä¸€ä¸ªEurekaæŒ‚æ‰ï¼Œä¹Ÿèƒ½å®Œæˆæ³¨å†Œ</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8801/eureka,</span> <span class="string">http://localhost:8802/eureka</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å…¨éƒ¨æˆåŠŸæ³¨å†Œï¼Œå¹¶ä¸”ä¸¤ä¸ªEurekaæœåŠ¡ç«¯éƒ½æ˜¾ç¤ºä¸ºå·²æ³¨å†Œï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0k4gvpxdtj21vc0dm41j.jpg" alt="image-20220323211032311"></p>
<p>æ¥ç€æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹ï¼Œå°†å…¶ä¸­ä¸€ä¸ªEurekaæœåŠ¡å™¨å…³é—­æ‰ï¼Œå¯ä»¥çœ‹åˆ°å®ƒä¼šç›´æ¥å˜æˆä¸å¯ç”¨çŠ¶æ€ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0k4ke207fj21rm06w75k.jpg" alt="image-20220323211354516"></p>
<p>å½“ç„¶ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æˆ‘ä»¬é‡å¯åˆšåˆšå…³é—­çš„EurekaæœåŠ¡å™¨ï¼Œä¼šè‡ªåŠ¨åŒæ­¥å…¶ä»–EurekaæœåŠ¡å™¨çš„æ•°æ®ã€‚</p>
<hr>
<h2 id="LoadBalancer-è´Ÿè½½å‡è¡¡"><a href="#LoadBalancer-è´Ÿè½½å‡è¡¡" class="headerlink" title="LoadBalancer è´Ÿè½½å‡è¡¡"></a>LoadBalancer è´Ÿè½½å‡è¡¡</h2><p>å‰é¢æˆ‘ä»¬è®²è§£äº†å¦‚ä½•å¯¹æœåŠ¡è¿›è¡Œæ‹†åˆ†ã€å¦‚ä½•é€šè¿‡EurekaæœåŠ¡å™¨è¿›è¡ŒæœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå®ƒçš„è´Ÿè½½å‡è¡¡åˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå®é™…ä¸Šä¹‹å‰æ¼”ç¤ºçš„è´Ÿè½½å‡è¡¡æ˜¯ä¾é LoadBalancerå®ç°çš„ã€‚</p>
<p>åœ¨2020å¹´å‰çš„SpringCloudç‰ˆæœ¬æ˜¯é‡‡ç”¨Ribbonä½œä¸ºè´Ÿè½½å‡è¡¡å®ç°ï¼Œä½†æ˜¯2020å¹´çš„ç‰ˆæœ¬ä¹‹åSpringCloudæŠŠRibbonç§»é™¤äº†ï¼Œè¿›è€Œç”¨è‡ªå·±ç¼–å†™çš„LoadBalanceræ›¿ä»£ã€‚</p>
<p>é‚£ä¹ˆï¼Œè´Ÿè½½å‡è¡¡æ˜¯å¦‚ä½•è¿›è¡Œçš„å‘¢ï¼Ÿ</p>
<h3 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h3><p>å®é™…ä¸Šï¼Œåœ¨æ·»åŠ <code>@LoadBalanced</code>æ³¨è§£ä¹‹åï¼Œä¼šå¯ç”¨æ‹¦æˆªå™¨å¯¹æˆ‘ä»¬å‘èµ·çš„æœåŠ¡è°ƒç”¨è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼ˆæ³¨æ„è¿™é‡Œæ˜¯é’ˆå¯¹æˆ‘ä»¬å‘èµ·çš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼‰ï¼Œå«åš<code>LoadBalancerInterceptor</code>ï¼Œå®ƒå®ç°<code>ClientHttpRequestInterceptor</code>æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ClientHttpRequestInterceptor</span> &#123;</span><br><span class="line">    ClientHttpResponse <span class="title function_">intercept</span><span class="params">(HttpRequest request, <span class="type">byte</span>[] body, ClientHttpRequestExecution execution)</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ˜¯å¯¹<code>intercept</code>æ–¹æ³•çš„å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ClientHttpResponse <span class="title function_">intercept</span><span class="params">(<span class="keyword">final</span> HttpRequest request, <span class="keyword">final</span> <span class="type">byte</span>[] body, <span class="keyword">final</span> ClientHttpRequestExecution execution)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">URI</span> <span class="variable">originalUri</span> <span class="operator">=</span> request.getURI();</span><br><span class="line">    <span class="type">String</span> <span class="variable">serviceName</span> <span class="operator">=</span> originalUri.getHost();</span><br><span class="line">    Assert.state(serviceName != <span class="literal">null</span>, <span class="string">&quot;Request URI does not contain a valid hostname: &quot;</span> + originalUri);</span><br><span class="line">    <span class="keyword">return</span> (ClientHttpResponse)<span class="built_in">this</span>.loadBalancer.execute(serviceName, <span class="built_in">this</span>.requestFactory.createRequest(request, body, execution));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æ‰“ä¸ªæ–­ç‚¹çœ‹çœ‹å®é™…æ˜¯æ€ä¹ˆåœ¨æ‰§è¡Œçš„ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0k61wb6pxj222y0cm77n.jpg" alt="image-20220323220519463"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0k62dm3knj21yi0fgwiz.jpg" alt="image-20220323220548051"></p>
<p>æœåŠ¡ç«¯ä¼šåœ¨å‘èµ·è¯·æ±‚æ—¶æ‰§è¡Œè¿™äº›æ‹¦æˆªå™¨ã€‚</p>
<p>é‚£ä¹ˆè¿™ä¸ªæ‹¦æˆªå™¨åšäº†ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Œé¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ï¼Œæˆ‘ä»¬ç»™è¿‡æ¥çš„è¯·æ±‚åœ°å€ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ä¸»æœºåç§°ï¼Œè€Œæ˜¯æœåŠ¡åç§°ï¼Œé‚£ä¹ˆæ€ä¹ˆæ‰èƒ½å¾—åˆ°çœŸæ­£éœ€è¦è®¿é—®çš„ä¸»æœºåç§°å‘¢ï¼Œè‚¯å®šæ˜¯å¾—æ‰¾Eurekaè·å–çš„ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹<code>loadBalancer.execute()</code>åšäº†ä»€ä¹ˆï¼Œå®ƒçš„å…·ä½“å®ç°ä¸º<code>BlockingLoadBalancerClient</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä»ä¸Šé¢ç»™è¿›æ¥äº†æœåŠ¡çš„åç§°å’Œå…·ä½“çš„è¯·æ±‚å®ä½“</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(String serviceId, LoadBalancerRequest&lt;T&gt; request)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">hint</span> <span class="operator">=</span> <span class="built_in">this</span>.getHint(serviceId);</span><br><span class="line">    LoadBalancerRequestAdapter&lt;T, DefaultRequestContext&gt; lbRequest = <span class="keyword">new</span> <span class="title class_">LoadBalancerRequestAdapter</span>(request, <span class="keyword">new</span> <span class="title class_">DefaultRequestContext</span>(request, hint));</span><br><span class="line">    Set&lt;LoadBalancerLifecycle&gt; supportedLifecycleProcessors = <span class="built_in">this</span>.getSupportedLifecycleProcessors(serviceId);</span><br><span class="line">    supportedLifecycleProcessors.forEach((lifecycle) -&gt; &#123;</span><br><span class="line">        lifecycle.onStart(lbRequest);</span><br><span class="line">    &#125;);</span><br><span class="line">  	<span class="comment">//å¯ä»¥çœ‹åˆ°åœ¨è¿™é‡Œä¼šè°ƒç”¨chooseæ–¹æ³•è‡ªåŠ¨è·å–å¯¹åº”çš„æœåŠ¡å®ä¾‹ä¿¡æ¯</span></span><br><span class="line">    <span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> <span class="built_in">this</span>.choose(serviceId, lbRequest);</span><br><span class="line">    <span class="keyword">if</span> (serviceInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">        supportedLifecycleProcessors.forEach((lifecycle) -&gt; &#123;</span><br><span class="line">            lifecycle.onComplete(<span class="keyword">new</span> <span class="title class_">CompletionContext</span>(Status.DISCARD, lbRequest, <span class="keyword">new</span> <span class="title class_">EmptyResponse</span>()));</span><br><span class="line">        &#125;);</span><br><span class="line">      	<span class="comment">//æ²¡æœ‰å‘ç°ä»»ä½•æ­¤æœåŠ¡çš„å®ä¾‹å°±æŠ›å¼‚å¸¸ï¼ˆä¹‹å‰çš„æµ‹è¯•ä¸­å¯èƒ½å·²ç»é‡åˆ°äº†ï¼‰</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;No instances available for &quot;</span> + serviceId);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      	<span class="comment">//æˆåŠŸè·å–åˆ°å¯¹åº”æœåŠ¡çš„å®ä¾‹ï¼Œè¿™æ—¶å°±å¯ä»¥å‘èµ·HTTPè¯·æ±‚è·å–ä¿¡æ¯äº†</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.execute(serviceId, serviceInstance, lbRequest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ï¼Œå®é™…ä¸Šåœ¨è¿›è¡Œè´Ÿè½½å‡è¡¡çš„æ—¶å€™ï¼Œä¼šå‘Eurekaå‘èµ·è¯·æ±‚ï¼Œé€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„å¯¹åº”æœåŠ¡ï¼Œç„¶åä¼šè¿”å›æ­¤æœåŠ¡çš„ä¸»æœºåœ°å€ç­‰ä¿¡æ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0kuedkhinj221e0jin2y.jpg" alt="image-20220324120741736"></p>
<h3 id="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</h3><p>LoadBalanceré»˜è®¤æä¾›äº†ä¸¤ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼š</p>
<ul>
<li>RandomLoadBalancer  -  éšæœºåˆ†é…ç­–ç•¥</li>
<li><strong>(é»˜è®¤)</strong> RoundRobinLoadBalancer  -  è½®è¯¢åˆ†é…ç­–ç•¥</li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬å¸Œæœ›ä¿®æ”¹é»˜è®¤çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¯ä»¥è¿›è¡ŒæŒ‡å®šï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å¸Œæœ›ç”¨æˆ·æœåŠ¡é‡‡ç”¨éšæœºåˆ†é…ç­–ç•¥ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºéšæœºåˆ†é…ç­–ç•¥çš„é…ç½®ç±»ï¼ˆä¸ç”¨åŠ <code>@Configuration</code>ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoadBalancerConfig</span> &#123;</span><br><span class="line">  	<span class="comment">//å°†å®˜æ–¹æä¾›çš„ RandomLoadBalancer æ³¨å†Œä¸ºBean</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ReactorLoadBalancer&lt;ServiceInstance&gt; <span class="title function_">randomLoadBalancer</span><span class="params">(Environment environment, LoadBalancerClientFactory loadBalancerClientFactory)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomLoadBalancer</span>(loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦ä¸ºå¯¹åº”çš„æœåŠ¡æŒ‡å®šè´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œç›´æ¥ä½¿ç”¨æ³¨è§£å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@LoadBalancerClient(value = &quot;userservice&quot;,      //æŒ‡å®šä¸º userservice æœåŠ¡ï¼Œåªè¦æ˜¯è°ƒç”¨æ­¤æœåŠ¡éƒ½ä¼šä½¿ç”¨æˆ‘ä»¬æŒ‡å®šçš„ç­–ç•¥</span></span><br><span class="line"><span class="meta">                    configuration = LoadBalancerConfig.class)</span>   <span class="comment">//æŒ‡å®šæˆ‘ä»¬åˆšåˆšå®šä¹‰å¥½çš„é…ç½®ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    RestTemplate <span class="title function_">template</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åœ¨<code>BlockingLoadBalancerClient</code>ä¸­æ·»åŠ æ–­ç‚¹ï¼Œè§‚å¯Ÿæ˜¯å¦é‡‡ç”¨æˆ‘ä»¬æŒ‡å®šçš„ç­–ç•¥è¿›è¡Œè¯·æ±‚ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0lc17or9aj221y07swhq.jpg" alt="image-20220324221750289"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0lc0mbsmqj21ye07yjuh.jpg" alt="image-20220324221713964"></p>
<p>å‘ç°è®¿é—®userserviceæœåŠ¡çš„ç­–ç•¥å·²ç»æ›´æ”¹ä¸ºæˆ‘ä»¬æŒ‡å®šçš„ç­–ç•¥äº†ã€‚</p>
<h3 id="OpenFeignå®ç°è´Ÿè½½å‡è¡¡"><a href="#OpenFeignå®ç°è´Ÿè½½å‡è¡¡" class="headerlink" title="OpenFeignå®ç°è´Ÿè½½å‡è¡¡"></a>OpenFeignå®ç°è´Ÿè½½å‡è¡¡</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/">https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/</a></p>
<p>Feignå’ŒRestTemplateä¸€æ ·ï¼Œä¹Ÿæ˜¯HTTPå®¢æˆ·ç«¯è¯·æ±‚å·¥å…·ï¼Œä½†æ˜¯å®ƒçš„ä½¿ç”¨æ–¹å¼æ›´åŠ ä¾¿æ·ã€‚é¦–å…ˆæ˜¯ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€åœ¨å¯åŠ¨ç±»æ·»åŠ <code>@EnableFeignClients</code>æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BorrowApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬éœ€è¦è°ƒç”¨å…¶ä»–å¾®æœåŠ¡æä¾›çš„æ¥å£ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘ä»¬ç›´æ¥åˆ›å»ºä¸€ä¸ªå¯¹åº”æœåŠ¡çš„æ¥å£ç±»å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;)</span>   <span class="comment">//å£°æ˜ä¸ºuserserviceæœåŠ¡çš„HTTPè¯·æ±‚å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬ç›´æ¥åˆ›å»ºæ‰€éœ€ç±»å‹çš„æ–¹æ³•ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">RestTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> template.getForObject(<span class="string">&quot;http://userservice/user/&quot;</span>+uid, User.class);</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å¯ä»¥ç›´æ¥å†™æˆè¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//è·¯å¾„ä¿è¯å’Œå…¶ä»–å¾®æœåŠ¡æä¾›çš„ä¸€è‡´å³å¯</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/&#123;uid&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>;  <span class="comment">//å‚æ•°å’Œè¿”å›å€¼ä¹Ÿä¿æŒä¸€è‡´</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬ç›´æ¥æ³¨å…¥ä½¿ç”¨ï¼ˆæœ‰Mybatisé‚£å‘³äº†ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">UserClient userClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> UserBorrowDetail <span class="title function_">getUserBorrowDetailByUid</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">    List&lt;Borrow&gt; borrow = mapper.getBorrowsByUid(uid);</span><br><span class="line">    </span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userClient.getUserById(uid);</span><br><span class="line">    <span class="comment">//è¿™é‡Œä¸ç”¨å†å†™IPï¼Œç›´æ¥å†™æœåŠ¡åç§°bookservice</span></span><br><span class="line">    List&lt;Book&gt; bookList = borrow</span><br><span class="line">            .stream()</span><br><span class="line">            .map(b -&gt; template.getForObject(<span class="string">&quot;http://bookservice/book/&quot;</span>+b.getBid(), Book.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(user, bookList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°ç»“æœä¾ç„¶æ˜¯æ­£ç¡®çš„ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0l51tto72j229e080dhe.jpg" alt="image-20220324181614387"></p>
<p>å¹¶ä¸”æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä¸€ä¸‹ä¸¤ä¸ªç”¨æˆ·å¾®æœåŠ¡çš„è°ƒç”¨æƒ…å†µï¼Œä¹Ÿæ˜¯ä»¥è´Ÿè½½å‡è¡¡çš„å½¢å¼è¿›è¡Œçš„ã€‚</p>
<p>æŒ‰ç…§åŒæ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ç€å°†å›¾ä¹¦ç®¡ç†æœåŠ¡çš„è°ƒç”¨ä¹Ÿæ”¹æˆæ¥å£å½¢å¼ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0l53boxmlj21j60bgq51.jpg" alt="image-20220324181740566"></p>
<p>æœ€åæˆ‘ä»¬çš„Serviceä»£ç å°±å˜æˆäº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BorrowService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserClient userClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BookClient bookClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getUserBorrowDetailByUid</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrow = mapper.getBorrowsByUid(uid);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userClient.getUserById(uid);</span><br><span class="line">        List&lt;Book&gt; bookList = borrow</span><br><span class="line">                .stream()</span><br><span class="line">                .map(b -&gt; bookClient.getBookById(b.getBid()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(user, bookList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­è®¿é—®è¿›è¡Œæµ‹è¯•ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0l54vuecvj226206igmz.jpg" alt="image-20220324181910173"></p>
<p>OKï¼Œæ­£å¸¸ã€‚</p>
<p>å½“ç„¶ï¼ŒFeignä¹Ÿæœ‰å¾ˆå¤šçš„å…¶ä»–é…ç½®é€‰é¡¹ï¼Œè¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ï¼Œè¯¦ç»†è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚</p>
<hr>
<h2 id="Hystrix-æœåŠ¡ç†”æ–­"><a href="#Hystrix-æœåŠ¡ç†”æ–­" class="headerlink" title="Hystrix æœåŠ¡ç†”æ–­"></a>Hystrix æœåŠ¡ç†”æ–­</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/1.3.5.RELEASE/single/spring-cloud-netflix.html#_circuit_breaker_hystrix_clients">https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/1.3.5.RELEASE/single/spring-cloud-netflix.html#_circuit_breaker_hystrix_clients</a></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œå¾®æœåŠ¡ä¹‹é—´æ˜¯å¯ä»¥è¿›è¡Œç›¸äº’è°ƒç”¨çš„ï¼Œé‚£ä¹ˆå¦‚æœå‡ºç°äº†ä¸‹é¢çš„æƒ…å†µä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ky07zn6tj219g07adgz.jpg" alt="image-20220324141230070"></p>
<p>ç”±äºä½äºæœ€åº•ç«¯çš„æœåŠ¡æä¾›è€…Eå‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆæ­¤æ—¶ä¼šç›´æ¥å¯¼è‡´æœåŠ¡ABCDå…¨çº¿å´©æºƒï¼Œå°±åƒé›ªå´©äº†ä¸€æ ·ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ky50sw4jj219s07yabg.jpg" alt="image-20220324141706946"></p>
<p>è¿™ç§é—®é¢˜å®é™…ä¸Šæ˜¯ä¸å¯é¿å…çš„ï¼Œç”±äºå¤šç§å› ç´ ï¼Œæ¯”å¦‚ç½‘ç»œå¡é¡¿ã€ç³»ç»Ÿæ•…éšœã€ç¡¬ä»¶é—®é¢˜ç­‰ï¼Œéƒ½å­˜åœ¨ä¸€å®šå¯èƒ½ï¼Œä¼šå¯¼è‡´è¿™ç§æç«¯çš„æƒ…å†µå‘ç”Ÿã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯»æ‰¾ä¸€ä¸ªåº”å¯¹è¿™ç§æç«¯æƒ…å†µçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä¸ºäº†è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿçš„é›ªå´©é—®é¢˜ï¼ŒSpringCloudæä¾›äº†Hystrixç†”æ–­å™¨ç»„ä»¶ï¼Œä»–å°±åƒæˆ‘ä»¬å®¶ä¸­çš„ä¿é™©ä¸ä¸€æ ·ï¼Œå½“ç”µæµè¿‡è½½å°±ä¼šç›´æ¥ç†”æ–­ï¼Œé˜²æ­¢å±é™©è¿›ä¸€æ­¥å‘ç”Ÿï¼Œä»è€Œä¿è¯å®¶åº­ç”¨ç”µå®‰å…¨ã€‚å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ•´æ¡é“¾è·¯ä¸Šçš„æœåŠ¡å·²ç»å…¨çº¿å´©æºƒï¼Œè¿™æ—¶è¿˜åœ¨ä¸æ–­åœ°æœ‰å¤§é‡çš„è¯·æ±‚åˆ°è¾¾ï¼Œéœ€è¦å„ä¸ªæœåŠ¡è¿›è¡Œå¤„ç†ï¼Œè‚¯å®šæ˜¯ä¼šä½¿å¾—æƒ…å†µè¶Šæ¥è¶Šç³Ÿç³•çš„ã€‚</p>
<p>æˆ‘ä»¬æ¥è¯¦ç»†çœ‹çœ‹å®ƒçš„å·¥ä½œæœºåˆ¶ã€‚</p>
<h3 id="æœåŠ¡é™çº§"><a href="#æœåŠ¡é™çº§" class="headerlink" title="æœåŠ¡é™çº§"></a>æœåŠ¡é™çº§</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹æœåŠ¡é™çº§ï¼Œæ³¨æ„ä¸€å®šè¦åŒºåˆ†å¼€æœåŠ¡é™çº§å’ŒæœåŠ¡ç†”æ–­çš„åŒºåˆ«ï¼ŒæœåŠ¡é™çº§å¹¶ä¸ä¼šç›´æ¥è¿”å›é”™è¯¯ï¼Œè€Œæ˜¯å¯ä»¥æä¾›ä¸€ä¸ªè¡¥æ•‘æªæ–½ï¼Œæ­£å¸¸å“åº”ç»™è¯·æ±‚è€…ã€‚è¿™æ ·ç›¸å½“äºæœåŠ¡ä¾ç„¶å¯ç”¨ï¼Œä½†æ˜¯æœåŠ¡èƒ½åŠ›è‚¯å®šæ˜¯ä¸‹é™äº†çš„ã€‚</p>
<p>æˆ‘ä»¬å°±åŸºäºå€Ÿé˜…ç®¡ç†æœåŠ¡æ¥è¿›è¡Œè®²è§£ï¼Œæˆ‘ä»¬ä¸å¼€å¯ç”¨æˆ·æœåŠ¡å’Œå›¾ä¹¦æœåŠ¡ï¼Œè¡¨ç¤ºç”¨æˆ·æœåŠ¡å’Œå›¾ä¹¦æœåŠ¡å·²ç»æŒ‚æ‰äº†ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å¯¼å…¥Hystrixçš„ä¾èµ–ï¼ˆæ­¤é¡¹ç›®å·²ç»åœæ­¢ç»´æŠ¤ï¼ŒSpringCloudä¾èµ–ä¸­å·²ç»ä¸è‡ªå¸¦äº†ï¼Œæ‰€ä»¥è¯´éœ€è¦è‡ªå·±å•ç‹¬å¯¼å…¥ï¼‰ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£å¼€å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrix</span>   <span class="comment">//å¯ç”¨Hystrix</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BorrowApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆç°åœ¨ï¼Œç”±äºç”¨æˆ·æœåŠ¡å’Œå›¾ä¹¦æœåŠ¡ä¸å¯ç”¨ï¼Œæ‰€ä»¥æŸ¥è¯¢å€Ÿé˜…ä¿¡æ¯çš„è¯·æ±‚è‚¯å®šæ˜¯æ²¡åŠæ³•æ­£å¸¸å“åº”çš„ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªå¤‡é€‰æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯è¯´å½“æœåŠ¡å‡ºç°å¼‚å¸¸æ—¶ï¼Œè¿”å›æˆ‘ä»¬çš„å¤‡é€‰æ–¹æ¡ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;onError&quot;)</span>    <span class="comment">//ä½¿ç”¨@HystrixCommandæ¥æŒ‡å®šå¤‡é€‰æ–¹æ¡ˆ</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow/&#123;uid&#125;&quot;)</span></span><br><span class="line">    UserBorrowDetail <span class="title function_">findUserBorrows</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getUserBorrowDetailByUid(uid);</span><br><span class="line">    &#125;</span><br><span class="line">		</span><br><span class="line">  	<span class="comment">//å¤‡é€‰æ–¹æ¡ˆï¼Œè¿™é‡Œç›´æ¥è¿”å›ç©ºåˆ—è¡¨äº†</span></span><br><span class="line">  	<span class="comment">//æ³¨æ„å‚æ•°å’Œè¿”å›å€¼è¦å’Œä¸Šé¢çš„ä¸€è‡´</span></span><br><span class="line">    UserBorrowDetail <span class="title function_">onError</span><span class="params">(<span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(<span class="literal">null</span>, Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶æˆ‘ä»¬çš„æœåŠ¡æ— æ³•æ­£å¸¸è¿è¡Œäº†ï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥ç»™æµè§ˆå™¨æ­£å¸¸è¿”å›å“åº”æ•°æ®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0kzgnuv0ej21x406ujvb.jpg" alt="image-20220324150253610"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0kzgygdd3j218s06qjru.jpg" alt="image-20220324150310955"></p>
<p>æœåŠ¡é™çº§æ˜¯ä¸€ç§æ¯”è¾ƒæ¸©æŸ”çš„è§£å†³æ–¹æ¡ˆï¼Œè™½ç„¶æœåŠ¡æœ¬èº«çš„ä¸å¯ç”¨ï¼Œä½†æ˜¯èƒ½å¤Ÿä¿è¯æ­£å¸¸å“åº”æ•°æ®ã€‚</p>
<h3 id="æœåŠ¡ç†”æ–­"><a href="#æœåŠ¡ç†”æ–­" class="headerlink" title="æœåŠ¡ç†”æ–­"></a>æœåŠ¡ç†”æ–­</h3><p>ç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯ä¿æŠ¤æœºåˆ¶ï¼Œå½“æ£€æµ‹å‡ºé“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡ä¸å¯ç”¨æˆ–è€…å“åº”æ—¶é—´å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡ŒæœåŠ¡çš„é™çº§ï¼Œè¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹å¾®æœåŠ¡çš„è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å›â€é”™è¯¯â€çš„å“åº”ä¿¡æ¯ã€‚å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡å“åº”æ­£å¸¸åæ¢å¤è°ƒç”¨é“¾è·¯ã€‚</p>
<p>å®é™…ä¸Šï¼Œç†”æ–­å°±æ˜¯åœ¨é™çº§çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥å‡çº§å½¢æˆçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…å¤šæ¬¡è°ƒç”¨å¤±è´¥ï¼Œé‚£ä¹ˆå°±ç›´æ¥å‡çº§ä¸ºç†”æ–­ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸¤æ¡è¾“å‡ºè¯­å¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;onError&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow/&#123;uid&#125;&quot;)</span></span><br><span class="line">    UserBorrowDetail <span class="title function_">findUserBorrows</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼€å§‹å‘å…¶ä»–æœåŠ¡è·å–ä¿¡æ¯&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> service.getUserBorrowDetailByUid(uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    UserBorrowDetail <span class="title function_">onError</span><span class="params">(<span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡é”™è¯¯ï¼Œè¿›å…¥å¤‡é€‰æ–¹æ³•ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(<span class="literal">null</span>, Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­ç–¯ç‹‚ç‚¹å‡»åˆ·æ–°æŒ‰é’®ï¼Œå¯¹æ­¤æœåŠ¡ç–¯ç‹‚å‘èµ·è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°åå°ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0kzz87azgj21960hwwhz.jpg" alt="image-20220324152044551"></p>
<p>ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œä¼šæ­£å¸¸åœ°å»è°ƒç”¨Controllerå¯¹åº”çš„æ–¹æ³•<code>findUserBorrows</code>ï¼Œå‘ç°å¤±è´¥ç„¶åè¿›å…¥å¤‡é€‰æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°åœ¨æŒç»­è¯·æ±‚ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæ²¡æœ‰å†è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨å¤‡é€‰æ–¹æ¡ˆï¼Œè¿™ä¾¿æ˜¯å‡çº§åˆ°äº†ç†”æ–­çŠ¶æ€ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç»§ç»­ä¸æ–­ç‚¹å‡»ï¼Œç»§ç»­ä¸æ–­åœ°å‘èµ·è¯·æ±‚ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0l06mgm5yj21uy0b0gns.jpg" alt="image-20220324152750797"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œä¼šå°è¯•æ­£å¸¸æ‰§è¡Œä¸€æ¬¡<code>findUserBorrows</code>ï¼Œä½†æ˜¯ä¾ç„¶æ˜¯å¤±è´¥çŠ¶æ€ï¼Œæ‰€ä»¥ç»§ç»­ä¿æŒç†”æ–­çŠ¶æ€ã€‚</p>
<p>æ‰€ä»¥å¾—åˆ°ç»“è®ºï¼Œå®ƒèƒ½å¤Ÿå¯¹ä¸€æ®µæ—¶é—´å†…å‡ºç°çš„é”™è¯¯è¿›è¡Œä¾¦æµ‹ï¼Œå½“ä¾¦æµ‹åˆ°å‡ºé”™æ¬¡æ•°è¿‡å¤šæ—¶ï¼Œç†”æ–­å™¨ä¼šæ‰“å¼€ï¼Œæ‰€æœ‰çš„è¯·æ±‚ä¼šç›´æ¥å“åº”å¤±è´¥ï¼Œä¸€æ®µæ—¶é—´åï¼Œåªæ‰§è¡Œä¸€å®šæ•°é‡çš„è¯·æ±‚ï¼Œå¦‚æœè¿˜æ˜¯å‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆåˆ™ç»§ç»­ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œå¦åˆ™è¯´æ˜æœåŠ¡æ¢å¤æ­£å¸¸è¿è¡Œï¼Œå…³é—­ç†”æ–­å™¨ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼Œå¼€å¯å¦å¤–ä¸¤ä¸ªæœåŠ¡ä¹‹åï¼Œç»§ç»­ç‚¹å‡»ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0l09mmg95j21ue0eatb5.jpg" alt="image-20220324153044583"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å¦å¤–ä¸¤ä¸ªæœåŠ¡æ­£å¸¸è¿è¡Œä¹‹åï¼Œå½“å†æ¬¡å°è¯•è°ƒç”¨<code>findUserBorrows</code>ä¹‹åä¼šæˆåŠŸï¼Œäºæ˜¯ç†”æ–­æœºåˆ¶å°±å…³é—­äº†ï¼ŒæœåŠ¡æ¢å¤è¿è¡Œã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0l0iulmatj21rc0ba0vj.jpg" alt="image-20220324153935858"></p>
<h3 id="OpenFeignå®ç°é™çº§"><a href="#OpenFeignå®ç°é™çº§" class="headerlink" title="OpenFeignå®ç°é™çº§"></a>OpenFeignå®ç°é™çº§</h3><p>Hystrixä¹Ÿå¯ä»¥é…åˆFeignè¿›è¡Œé™çº§ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹åº”æ¥å£ä¸­å®šä¹‰çš„è¿œç¨‹è°ƒç”¨å•ç‹¬è¿›è¡Œé™çº§æ“ä½œã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬è¿˜æ˜¯ä»¥ç”¨æˆ·æœåŠ¡æŒ‚æ‰ä¸ºä¾‹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™è‚¯å®šæ˜¯ä¼šè¿œç¨‹è°ƒç”¨å¤±è´¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„Controllerä¸­çš„æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿›è€Œè¢«Hystrixç›‘æ§åˆ°å¹¶è¿›è¡ŒæœåŠ¡é™çº§ã€‚</p>
<p>è€Œå®é™…ä¸Šå¯¼è‡´æ–¹æ³•æ‰§è¡Œå¼‚å¸¸çš„æ ¹æºå°±æ˜¯è¿œç¨‹è°ƒç”¨å¤±è´¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¢ä¸ªæ€è·¯ï¼Œæ—¢ç„¶ç”¨æˆ·æœåŠ¡è°ƒç”¨å¤±è´¥ï¼Œé‚£ä¹ˆæˆ‘å°±ç»™è¿™ä¸ªè¿œç¨‹è°ƒç”¨æ·»åŠ ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼Œå¦‚æœæ­¤è¿œç¨‹è°ƒç”¨å¤±è´¥ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä¸Šæ›¿ä»£æ–¹æ¡ˆã€‚é‚£ä¹ˆæ€ä¹ˆå®ç°æ›¿ä»£æ–¹æ¡ˆå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“Feignéƒ½æ˜¯ä»¥æ¥å£çš„å½¢å¼æ¥å£°æ˜è¿œç¨‹è°ƒç”¨ï¼Œé‚£ä¹ˆæ—¢ç„¶è¿œç¨‹è°ƒç”¨å·²ç»å¤±æ•ˆï¼Œæˆ‘ä»¬å°±è‡ªè¡Œå¯¹å…¶è¿›è¡Œå®ç°ï¼Œåˆ›å»ºä¸€ä¸ªå®ç°ç±»ï¼Œå¯¹åŸæœ‰çš„æ¥å£æ–¹æ³•è¿›è¡Œæ›¿ä»£æ–¹æ¡ˆå®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>   <span class="comment">//æ³¨æ„ï¼Œéœ€è¦å°†å…¶æ³¨å†Œä¸ºBeanï¼ŒFeignæ‰èƒ½è‡ªåŠ¨æ³¨å…¥</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserFallbackClient</span> <span class="keyword">implements</span> <span class="title class_">UserClient</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(<span class="type">int</span> uid)</span> &#123;   <span class="comment">//è¿™é‡Œæˆ‘ä»¬è‡ªè¡Œå¯¹å…¶è¿›è¡Œå®ç°ï¼Œå¹¶è¿”å›æˆ‘ä»¬çš„æ›¿ä»£æ–¹æ¡ˆ</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;æˆ‘æ˜¯æ›¿ä»£æ–¹æ¡ˆ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ç°å®Œæˆåï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨åŸæœ‰çš„æ¥å£ä¸­æŒ‡å®šå¤±è´¥æ›¿ä»£å®ç°å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//fallbackå‚æ•°æŒ‡å®šä¸ºæˆ‘ä»¬åˆšåˆšç¼–å†™çš„å®ç°ç±»</span></span><br><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;, fallback = UserFallbackClient.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/&#123;uid&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å»æ‰<code>BorrowController</code>çš„<code>@HystrixCommand</code>æ³¨è§£å’Œå¤‡é€‰æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow/&#123;uid&#125;&quot;)</span></span><br><span class="line">    UserBorrowDetail <span class="title function_">findUserBorrows</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getUserBorrowDetailByUid(uid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ç†”æ–­æ”¯æŒï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">circuitbreaker:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æœåŠ¡ï¼Œè°ƒç”¨æ¥å£è¯•è¯•çœ‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0m0k7jve9j21zq03kdi6.jpg" alt="image-20220325122629016"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0m0gmj8ayj229c07q75v.jpg" alt="image-20220325122301779"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨å·²ç»é‡‡ç”¨æˆ‘ä»¬çš„æ›¿ä»£æ–¹æ¡ˆä½œä¸ºç»“æœã€‚</p>
<h3 id="ç›‘æ§é¡µé¢éƒ¨ç½²"><a href="#ç›‘æ§é¡µé¢éƒ¨ç½²" class="headerlink" title="ç›‘æ§é¡µé¢éƒ¨ç½²"></a>ç›‘æ§é¡µé¢éƒ¨ç½²</h3><p>é™¤äº†å¯¹æœåŠ¡çš„é™çº§å’Œç†”æ–­å¤„ç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œå®æ—¶ç›‘æ§ï¼Œåªéœ€è¦å®‰è£…ç›‘æ§é¡µé¢å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œå¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æ·»åŠ é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8900</span></span><br><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">  <span class="attr">dashboard:</span></span><br><span class="line">    <span class="comment"># å°†localhostæ·»åŠ åˆ°ç™½åå•ï¼Œé»˜è®¤æ˜¯ä¸å…è®¸çš„</span></span><br><span class="line">    <span class="attr">proxy-stream-allow-list:</span> <span class="string">&quot;localhost&quot;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€åˆ›å»ºä¸»ç±»ï¼Œæ³¨æ„éœ€è¦æ·»åŠ <code>@EnableHystrixDashboard</code>æ³¨è§£å¼€å¯ç®¡ç†é¡µé¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HystrixDashBoardApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(HystrixDashBoardApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨Hystrixç®¡ç†é¡µé¢æœåŠ¡ï¼Œç„¶åæˆ‘ä»¬éœ€è¦åœ¨è¦è¿›è¡Œç›‘æ§çš„æœåŠ¡ä¸­æ·»åŠ Actuatorä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Actuatoræ˜¯SpringBootç¨‹åºçš„ç›‘æ§ç³»ç»Ÿï¼Œå¯ä»¥å®ç°å¥åº·æ£€æŸ¥ï¼Œè®°å½•ä¿¡æ¯ç­‰ã€‚åœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦å¼•å…¥spring-boot-starter-actuatorï¼Œå¹¶åšç®€å•çš„é…ç½®å³å¯ã€‚</p>
</blockquote>
<p>æ·»åŠ æ­¤ä¾èµ–åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨IDEAä¸­æŸ¥çœ‹è¿è¡Œæƒ…å†µï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ld5ia0z8j21uw0e6god.jpg" alt="image-20220324225633805"></p>
<p>ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®Actuatoræ·»åŠ æš´éœ²ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ‰“å¼€åˆšåˆšå¯åŠ¨çš„ç®¡ç†é¡µé¢ï¼Œåœ°å€ä¸ºï¼š<a href="http://localhost:8900/hystrix/">http://localhost:8900/hystrix/</a></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ld6jtiijj22ij0u042v.jpg" alt="image-20220324225733550"></p>
<p>åœ¨ä¸­é—´å¡«å†™è¦ç›‘æ§çš„æœåŠ¡ï¼šæ¯”å¦‚å€Ÿé˜…æœåŠ¡ï¼š<a href="http://localhost:8301/actuator/hystrix.stream%EF%BC%8C%E6%B3%A8%E6%84%8F%E5%90%8E%E9%9D%A2%E8%A6%81%E6%B7%BB%E5%8A%A0%60/actuator/hystrix.stream%60%EF%BC%8C%E7%84%B6%E5%90%8E%E7%82%B9%E5%87%BBMonitor">http://localhost:8301/actuator/hystrix.streamï¼Œæ³¨æ„åé¢è¦æ·»åŠ `/actuator/hystrix.stream`ï¼Œç„¶åç‚¹å‡»Monitor</a> Streamå³å¯è¿›å…¥ç›‘æ§é¡µé¢ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ldejq3n0j22ly0puwhu.jpg" alt="image-20220324230515009"></p>
<p>å¯ä»¥çœ‹åˆ°ç°åœ¨éƒ½æ˜¯LoadingçŠ¶æ€ï¼Œè¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰å¼€å§‹ç»Ÿè®¡ï¼Œæˆ‘ä»¬ç°åœ¨å°è¯•è°ƒç”¨å‡ æ¬¡æˆ‘ä»¬çš„æœåŠ¡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ldfbaoi5j22660bqgnc.jpg" alt="image-20220324230559068"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è°ƒç”¨ä¹‹åï¼Œç›‘æ§é¡µé¢å‡ºç°äº†ä¿¡æ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ldgfihczj21wq0ksn03.jpg" alt="image-20220324230703600"></p>
<p>å¯ä»¥çœ‹åˆ°5æ¬¡è®¿é—®éƒ½æ˜¯æ­£å¸¸çš„ï¼Œæ‰€ä»¥æ˜¾ç¤ºä¸ºç»¿è‰²ï¼Œæ¥ç€æˆ‘ä»¬æ¥å°è¯•å°†å›¾ä¹¦æœåŠ¡å…³é—­ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æœåŠ¡é™çº§ç”šè‡³ç†”æ–­ï¼Œç„¶åå†å¤šæ¬¡è®¿é—®æ­¤æœåŠ¡çœ‹çœ‹ç›‘æ§ä¼šå¦‚ä½•å˜åŒ–ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ldiuq9naj222a0l2whx.jpg" alt="image-20220324230923472"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé”™è¯¯ç‡ç›´æ¥é£™å‡åˆ°100%ï¼Œå¹¶ä¸”ä¸€æ®µæ—¶é—´å†…æŒç»­å‡ºç°é”™è¯¯ï¼Œä¸­å¿ƒçš„åœ†åœˆä¹Ÿå˜æˆäº†çº¢è‰²ï¼Œæˆ‘ä»¬ç»§ç»­è¿›è¡Œè®¿é—®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ldjvo0ppj21j20iy0v3.jpg" alt="image-20220324231022133"></p>
<p>åœ¨å‡ºç°å¤§é‡é”™è¯¯çš„æƒ…å†µä¸‹ä¿æŒæŒç»­è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶å·²ç»å°†æœåŠ¡ç†”æ–­ï¼Œ<code>Circuit</code>æ›´æ”¹ä¸ºOpençŠ¶æ€ï¼Œå¹¶ä¸”å›¾ä¸­çš„åœ†åœˆä¹Ÿå˜å¾—æ›´å¤§ï¼Œè¡¨ç¤ºå‹åŠ›åœ¨æŒç»­ä¸Šå‡ã€‚</p>
<hr>
<h2 id="Gateway-è·¯ç”±ç½‘å…³"><a href="#Gateway-è·¯ç”±ç½‘å…³" class="headerlink" title="Gateway è·¯ç”±ç½‘å…³"></a>Gateway è·¯ç”±ç½‘å…³</h2><p>å®˜ç½‘åœ°å€ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/</a></p>
<p>è¯´åˆ°è·¯ç”±ï¼Œæƒ³å¿…å„ä½ä¸€å®šæœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯å®¶é‡Œçš„è·¯ç”±å™¨äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®¶é‡Œçš„è·¯ç”±å™¨å……å½“çš„æ˜¯ä¸€ä¸ªä»€ä¹ˆè§’è‰²å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è¿æ¥äº’è”ç½‘ï¼Œé‚£ä¹ˆå°±éœ€è¦å°†æ‰‹æœºæˆ–æ˜¯ç”µè„‘è¿æ¥åˆ°å®¶é‡Œçš„è·¯ç”±å™¨æ‰å¯ä»¥ï¼Œè€Œè·¯ç”±å™¨åˆ™è¿æ¥å…‰çŒ«ï¼Œå…‰çŒ«å†é€šè¿‡å…‰çº¤è¿æ¥åˆ°äº’è”ç½‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œäº’è”ç½‘æ–¹å‘å‘é€è¿‡æ¥çš„æ•°æ®ï¼Œéœ€è¦ç»è¿‡è·¯ç”±å™¨æ‰èƒ½åˆ°è¾¾æˆ‘ä»¬çš„è®¾å¤‡ã€‚è€Œè·¯ç”±å™¨å……å½“çš„å°±æ˜¯æ•°æ®åŒ…ä¸­è½¬ç«™ï¼Œæ‰€æœ‰çš„å±€åŸŸç½‘è®¾å¤‡éƒ½æ— æ³•ç›´æ¥ä¸äº’è”ç½‘è¿æ¥ï¼Œè€Œæ˜¯éœ€è¦ç»è¿‡è·¯ç”±å™¨è¿›è¡Œä¸­è½¬ï¼Œæˆ‘ä»¬ä¸€èˆ¬è¯´è·¯ç”±å™¨ä¸‹çš„ç½‘ç»œæ˜¯å†…ç½‘ï¼Œè€Œäº’è”ç½‘é‚£ä¸€ç«¯æ˜¯å¤–ç½‘ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0l2ejn70ej21di0b4wfr.jpg" alt="image-20220324164439809"></p>
<p>æˆ‘ä»¬çš„å±€åŸŸç½‘è®¾å¤‡ï¼Œæ— æ³•è¢«äº’è”ç½‘ä¸Šçš„å…¶ä»–è®¾å¤‡ç›´æ¥è®¿é—®ï¼Œè‚¯å®šæ˜¯èƒ½å¤Ÿä¿è¯åˆ°å®‰å…¨æ€§çš„ã€‚å¹¶äº’è”ç½‘å‘é€è¿‡æ¥çš„æ•°æ®ï¼Œéœ€è¦ç»è¿‡è·¯ç”±å™¨è¿›è¡Œè§£æï¼Œè¯†åˆ«åˆ°åº•æ˜¯å“ªä¸€ä¸ªè®¾å¤‡çš„æ•°æ®åŒ…ï¼Œç„¶åå†å‘é€ç»™å¯¹åº”çš„è®¾å¤‡ã€‚</p>
<p>è€Œæˆ‘ä»¬çš„å¾®æœåŠ¡ä¹Ÿæ˜¯è¿™æ ·ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯èƒ½å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¾®æœåŠ¡éƒ½éœ€è¦ç›´æ¥æš´éœ²ç»™å¤–éƒ¨è°ƒç”¨ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è·¯ç”±æœºåˆ¶ï¼Œæ·»åŠ ä¸€å±‚é˜²æŠ¤ï¼Œè®©æ‰€æœ‰çš„è¯·æ±‚å…¨éƒ¨é€šè¿‡è·¯ç”±æ¥è½¬å‘åˆ°å„ä¸ªå¾®æœåŠ¡ï¼Œå¹¶ä¸”è½¬å‘ç»™å¤šä¸ªç›¸åŒå¾®æœåŠ¡å®ä¾‹ä¹Ÿå¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0m1kz3kycj21iq0huwhb.jpg" alt="image-20220325130147758"></p>
<p>åœ¨ä¹‹å‰ï¼Œè·¯ç”±çš„å®ç°ä¸€èˆ¬ä½¿ç”¨Zuulï¼Œä½†æ˜¯å·²ç»åœæ›´ï¼Œè€Œç°åœ¨æ–°å‡ºç°äº†ç”±SpringCloudå®˜æ–¹å¼€å‘çš„Gatewayè·¯ç”±ï¼Œå®ƒç›¸æ¯”Zuulä¸ä»…æ€§èƒ½ä¸Šå¾—åˆ°äº†ä¸€å®šçš„æå‡ï¼Œå¹¶ä¸”æ˜¯å®˜æ–¹æ¨å‡ºï¼Œå¥‘åˆæ€§ä¹Ÿä¼šæ›´å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå°±ä¸»è¦è®²è§£Gatewayã€‚</p>
<h3 id="éƒ¨ç½²ç½‘å…³"><a href="#éƒ¨ç½²ç½‘å…³" class="headerlink" title="éƒ¨ç½²ç½‘å…³"></a>éƒ¨ç½²ç½‘å…³</h3><p>ç°åœ¨æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œä½œä¸ºæˆ‘ä»¬çš„ç½‘å…³ï¼Œè¿™é‡Œéœ€è¦æ·»åŠ ä¸¤ä¸ªä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªä¾èµ–å°±æ˜¯ç½‘å…³çš„ä¾èµ–ï¼Œè€Œç¬¬äºŒä¸ªåˆ™è·Ÿå…¶ä»–å¾®æœåŠ¡ä¸€æ ·ï¼Œéœ€è¦æ³¨å†Œåˆ°Eurekaæ‰èƒ½ç”Ÿæ•ˆï¼Œæ³¨æ„åˆ«æ·»åŠ Webä¾èµ–ï¼Œä½¿ç”¨çš„æ˜¯WebFluxæ¡†æ¶ã€‚</p>
<p>ç„¶åæˆ‘ä»¬æ¥å®Œå–„ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8801/eureka,</span> <span class="string">http://localhost:8802/eureka</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å°±å¯ä»¥å¯åŠ¨äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0l34rlri8j22dw0b80ve.jpg" alt="image-20220324170951878"></p>
<p>ä½†æ˜¯ç°åœ¨è¿˜æ²¡æœ‰é…ç½®ä»»ä½•çš„è·¯ç”±åŠŸèƒ½ï¼Œæˆ‘ä»¬æ¥ç€å°†è·¯ç”±åŠŸèƒ½è¿›è¡Œé…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">    	<span class="comment"># é…ç½®è·¯ç”±ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸€é¡¹éƒ½åŒ…å«äº†å¾ˆå¤šä¿¡æ¯</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">borrow-service</span>   <span class="comment"># è·¯ç”±åç§°</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://borrowservice</span>  <span class="comment"># è·¯ç”±çš„åœ°å€ï¼Œlbè¡¨ç¤ºä½¿ç”¨è´Ÿè½½å‡è¡¡åˆ°å¾®æœåŠ¡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨httpæ­£å¸¸è½¬å‘</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># è·¯ç”±è§„åˆ™ï¼Œæ–­è¨€ä»€ä¹ˆè¯·æ±‚ä¼šè¢«è·¯ç”±</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/borrow/**</span>  <span class="comment"># åªè¦æ˜¯è®¿é—®çš„è¿™ä¸ªè·¯å¾„ï¼Œä¸€å¾‹éƒ½è¢«è·¯ç”±åˆ°ä¸Šé¢æŒ‡å®šçš„æœåŠ¡</span></span><br></pre></td></tr></table></figure>

<p>è·¯ç”±è§„åˆ™çš„è¯¦ç»†åˆ—è¡¨ï¼ˆæ–­è¨€å·¥å‚åˆ—è¡¨ï¼‰åœ¨è¿™é‡Œï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8C%87%E5%AE%9A%E5%A4%9A%E7%A7%8D%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%8C%85%E6%8B%AC%E6%8C%87%E5%AE%9A%E6%97%B6%E9%97%B4%E6%AE%B5%E3%80%81Cookie%E6%90%BA%E5%B8%A6%E6%83%85%E5%86%B5%E3%80%81Header%E6%90%BA%E5%B8%A6%E6%83%85%E5%86%B5%E3%80%81%E8%AE%BF%E9%97%AE%E7%9A%84%E5%9F%9F%E5%90%8D%E5%9C%B0%E5%9D%80%E3%80%81%E8%AE%BF%E9%97%AE%E7%9A%84%E6%96%B9%E6%B3%95%E3%80%81%E8%B7%AF%E5%BE%84%E3%80%81%E5%8F%82%E6%95%B0%E3%80%81%E8%AE%BF%E9%97%AE%E8%80%85IP%E7%AD%89%E3%80%82%E4%B9%9F%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE%E7%B1%BB%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%86%E6%98%AF%E8%BF%98%E6%98%AF%E6%8E%A8%E8%8D%90%E7%9B%B4%E6%8E%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E7%9C%81%E4%BA%8B%E3%80%82">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factoriesï¼Œå¯ä»¥æŒ‡å®šå¤šç§ç±»å‹ï¼ŒåŒ…æ‹¬æŒ‡å®šæ—¶é—´æ®µã€Cookieæºå¸¦æƒ…å†µã€Headeræºå¸¦æƒ…å†µã€è®¿é—®çš„åŸŸååœ°å€ã€è®¿é—®çš„æ–¹æ³•ã€è·¯å¾„ã€å‚æ•°ã€è®¿é—®è€…IPç­‰ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨é…ç½®ç±»è¿›è¡Œé…ç½®ï¼Œä½†æ˜¯è¿˜æ˜¯æ¨èç›´æ¥é…ç½®æ–‡ä»¶ï¼Œçœäº‹ã€‚</a></p>
<p>æ¥ç€å¯åŠ¨ç½‘å…³ï¼Œæ­è½½Armæ¶æ„èŠ¯ç‰‡çš„Macç”µè„‘å¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0m59qpakvj21og074q5a.jpg" alt="image-20220325150924472"></p>
<p>è¿™æ˜¯å› ä¸ºæ²¡æœ‰æ‰¾åˆ°é€‚ç”¨äºæ­¤æ¶æ„çš„åŠ¨æ€é“¾æ¥åº“ï¼Œä¸å½±å“ä½¿ç”¨ï¼Œæ— è§†å³å¯ï¼Œå¸Œæœ›ä»¥åçš„ç‰ˆæœ¬èƒ½ä¿®å¤å§ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ç›´æ¥é€šè¿‡è·¯ç”±æ¥è®¿é—®æˆ‘ä»¬çš„æœåŠ¡äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0l3cme88qj226g0a6abq.jpg" alt="image-20220324171724493"></p>
<p>æ³¨æ„æ­¤æ—¶ä¾ç„¶å¯ä»¥é€šè¿‡åŸæœ‰çš„æœåŠ¡åœ°å€è¿›è¡Œè®¿é—®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0l3efx1npj225c070400.jpg" alt="image-20220324171909828"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†ä¸éœ€è¦å¤–ç½‘ç›´æ¥è®¿é—®çš„å¾®æœåŠ¡å…¨éƒ¨æ”¾åˆ°å†…ç½‘ç¯å¢ƒä¸‹ï¼Œè€Œåªä¾é ç½‘å…³æ¥å¯¹å¤–è¿›è¡Œäº¤æ¶‰ã€‚</p>
<h3 id="è·¯ç”±è¿‡æ»¤å™¨"><a href="#è·¯ç”±è¿‡æ»¤å™¨" class="headerlink" title="è·¯ç”±è¿‡æ»¤å™¨"></a>è·¯ç”±è¿‡æ»¤å™¨</h3><p>è·¯ç”±è¿‡æ»¤å™¨æ”¯æŒä»¥æŸç§æ–¹å¼ä¿®æ”¹ä¼ å…¥çš„ HTTP è¯·æ±‚æˆ–ä¼ å‡ºçš„ HTTP å“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨çš„èŒƒå›´æ˜¯æŸä¸€ä¸ªè·¯ç”±ï¼Œè·Ÿä¹‹å‰çš„æ–­è¨€ä¸€æ ·ï¼ŒSpring Cloud Gateway ä¹ŸåŒ…å«è®¸å¤šå†…ç½®çš„è·¯ç”±è¿‡æ»¤å™¨å·¥å‚ï¼Œè¯¦ç»†åˆ—è¡¨ï¼š<a href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories</a></p>
<p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨å¸Œæœ›åœ¨è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ä¸€äº›ä¿¡æ¯å†è½¬å‘ç»™æˆ‘ä»¬çš„æœåŠ¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨è·¯ç”±è¿‡æ»¤å™¨æ¥å®Œæˆï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">borrow-service</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://borrowservice</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/borrow/**</span></span><br><span class="line">      <span class="comment"># ç»§ç»­æ·»åŠ æ–°çš„è·¯ç”±é…ç½®ï¼Œè¿™é‡Œå°±ä»¥ä¹¦ç±ç®¡ç†æœåŠ¡ä¸ºä¾‹</span></span><br><span class="line">      <span class="comment"># æ³¨æ„-è¦å¯¹é½routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">book-service</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://bookservice</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/book/**</span></span><br><span class="line">        <span class="attr">filters:</span>   <span class="comment"># æ·»åŠ è¿‡æ»¤å™¨</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=Test,</span> <span class="string">HelloWorld!</span></span><br><span class="line">        <span class="comment"># AddRequestHeader å°±æ˜¯æ·»åŠ è¯·æ±‚å¤´ä¿¡æ¯ï¼Œå…¶ä»–å·¥å‚è¯·æŸ¥é˜…å®˜ç½‘</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åœ¨BookControllerä¸­è·å–å¹¶è¾“å‡ºä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯æˆåŠŸæ·»åŠ äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BookService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/&#123;bid&#125;&quot;)</span></span><br><span class="line">    Book <span class="title function_">findBookById</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> bid,</span></span><br><span class="line"><span class="params">                      HttpServletRequest request)</span>&#123;</span><br><span class="line">        System.out.println(request.getHeader(<span class="string">&quot;Test&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> service.getBookById(bid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬é€šè¿‡Gatewayè®¿é—®æˆ‘ä»¬çš„å›¾ä¹¦ç®¡ç†æœåŠ¡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0m57rm7t4j21bq07kt9c.jpg" alt="image-20220325150730814"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0m5cstkq3j21v403q0ud.jpg" alt="image-20220325151220776"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡ŒæˆåŠŸè·å–åˆ°ç”±ç½‘å…³æ·»åŠ çš„è¯·æ±‚å¤´ä¿¡æ¯äº†ã€‚</p>
<p>é™¤äº†é’ˆå¯¹äºæŸä¸€ä¸ªè·¯ç”±é…ç½®è¿‡æ»¤å™¨ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œå®ƒèƒ½å¤Ÿä½œç”¨äºå…¨å±€ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦é€šè¿‡ä»£ç çš„æ–¹å¼è¿›è¡Œç¼–å†™ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦å®ç°æ‹¦æˆªæ²¡æœ‰æºå¸¦æŒ‡å®šè¯·æ±‚å‚æ•°çš„è¯·æ±‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>   <span class="comment">//éœ€è¦æ³¨å†Œä¸ºBean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;   <span class="comment">//åªéœ€è¦å®ç°æ­¤æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬ç¼–å†™åˆ¤æ–­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">    <span class="comment">//å…ˆè·å–ServerHttpRequestå¯¹è±¡ï¼Œæ³¨æ„ä¸æ˜¯HttpServletRequest</span></span><br><span class="line">    <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">    <span class="comment">//æ‰“å°ä¸€ä¸‹æ‰€æœ‰çš„è¯·æ±‚å‚æ•°</span></span><br><span class="line">    System.out.println(request.getQueryParams());</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦åŒ…å«testå‚æ•°ï¼Œä¸”å‚æ•°å€¼ä¸º1</span></span><br><span class="line">    List&lt;String&gt; value = request.getQueryParams().get(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(value != <span class="literal">null</span> &amp;&amp; value.contains(<span class="string">&quot;1&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">//å°†ServerWebExchangeå‘è¿‡æ»¤é“¾çš„ä¸‹ä¸€çº§ä¼ é€’ï¼ˆè·ŸJavaWebä¸­ä»‹ç»çš„è¿‡æ»¤å™¨å…¶å®æ˜¯å·®ä¸å¤šçš„ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//ç›´æ¥åœ¨è¿™é‡Œä¸å†å‘ä¸‹ä¼ é€’ï¼Œç„¶åè¿”å›å“åº”</span></span><br><span class="line">        <span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç»“æœï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0m6ahb0zvj21ak07qaah.jpg" alt="image-20220325154443063"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0m6axjl3oj21ai072t9h.jpg" alt="image-20220325154508853"></p>
<p>æˆåŠŸå®ç°è§„åˆ™åˆ¤æ–­å’Œæ‹¦æˆªæ“ä½œã€‚</p>
<p>å½“ç„¶ï¼Œè¿‡æ»¤å™¨è‚¯å®šæ˜¯å¯ä»¥å­˜åœ¨å¾ˆå¤šä¸ªçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æŒ‡å®šè¿‡æ»¤å™¨ä¹‹é—´çš„é¡ºåºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;   <span class="comment">//å®ç°Orderedæ¥å£</span></span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„Orderçš„å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¹¶ä¸”æ— è®ºæ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™çš„å•ä¸ªè·¯ç”±è¿‡æ»¤å™¨è¿˜æ˜¯å…¨å±€è·¯ç”±è¿‡æ»¤å™¨ï¼Œéƒ½ä¼šå—åˆ°Orderå€¼å½±å“ï¼ˆå•ä¸ªè·¯ç”±çš„è¿‡æ»¤å™¨Orderå€¼æŒ‰ä»ä¸Šå¾€ä¸‹çš„é¡ºåºä»1å¼€å§‹é€’å¢ï¼‰ï¼Œæœ€ç»ˆæ˜¯æŒ‰ç…§Orderå€¼å†³å®šå“ªä¸ªè¿‡æ»¤å™¨ä¼˜å…ˆæ‰§è¡Œï¼Œå½“Orderå€¼ä¸€æ ·æ—¶ å…¨å±€è·¯ç”±è¿‡æ»¤å™¨æ‰§è¡Œ <code>ä¼˜äº</code> å•ç‹¬çš„è·¯ç”±è¿‡æ»¤å™¨æ‰§è¡Œã€‚</p>
<hr>
<h2 id="Config-é…ç½®ä¸­å¿ƒ"><a href="#Config-é…ç½®ä¸­å¿ƒ" class="headerlink" title="Config é…ç½®ä¸­å¿ƒ"></a>Config é…ç½®ä¸­å¿ƒ</h2><p><strong>å®˜æ–¹æ–‡æ¡£ï¼š</strong><a href="https://docs.spring.io/spring-cloud-config/docs/current/reference/html/">https://docs.spring.io/spring-cloud-config/docs/current/reference/html/</a></p>
<p>ç»è¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨çš„æŠ€æœ¯é€‰å‹å’Œæ­å»ºå·²ç»äº†è§£å¾—æ¯”è¾ƒå¤šäº†ï¼Œä½†æ˜¯å„ä½æœ‰æ²¡æœ‰å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬çš„å¾®æœåŠ¡é¡¹ç›®éœ€è¦éƒ¨ç½²å¾ˆå¤šä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆé…ç½®æ–‡ä»¶æˆ‘ä»¬å²‚ä¸æ˜¯å¾—ä¸€ä¸ªä¸€ä¸ªå»æ”¹ï¼Œå¯èƒ½åå‡ ä¸ªå®ä¾‹è¿˜å¥½ï¼Œè¦æ˜¯æœ‰å‡ åä¸ªä¸Šç™¾ä¸ªå‘¢ï¼Ÿé‚£æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªå»é…ç½®ï¼Œå²‚ä¸ç›´æ¥çŒæ­»åœ¨å·¥ä½ä¸Šã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´åŠ é«˜çº§çš„é›†ä¸­åŒ–åœ°é…ç½®æ–‡ä»¶ç®¡ç†å·¥å…·ï¼Œé›†ä¸­åœ°å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ã€‚</p>
<blockquote>
<p>Spring Cloud Config ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨é…ç½®æä¾›æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯æ”¯æŒã€‚ä½¿ç”¨ Config Serverï¼Œæ‚¨å¯ä»¥é›†ä¸­ç®¡ç†æ‰€æœ‰ç¯å¢ƒä¸­åº”ç”¨ç¨‹åºçš„å¤–éƒ¨é…ç½®ã€‚</p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0m8zggbzyj21ha0csjt5.jpg" alt="image-20220325171754862"></p>
<p>å®é™…ä¸ŠSpring Cloud Configå°±æ˜¯ä¸€ä¸ªé…ç½®ä¸­å¿ƒï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½å¯ä»¥ä»é…ç½®ä¸­å¿ƒå–å‡ºé…ç½®ï¼Œè€Œé…ç½®ä¸­å¿ƒåˆå¯ä»¥ä»GitHubè¿œç¨‹ä»“åº“ä¸­è·å–äº‘ç«¯çš„é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€è¦ä¿®æ”¹GitHubä¸­çš„é…ç½®å³å¯å¯¹æ‰€æœ‰çš„æœåŠ¡è¿›è¡Œé…ç½®ç®¡ç†äº†ã€‚</p>
<h3 id="éƒ¨ç½²é…ç½®ä¸­å¿ƒ"><a href="#éƒ¨ç½²é…ç½®ä¸­å¿ƒ" class="headerlink" title="éƒ¨ç½²é…ç½®ä¸­å¿ƒ"></a>éƒ¨ç½²é…ç½®ä¸­å¿ƒ</h3><p>è¿™é‡Œæˆ‘ä»¬æ¥ç€åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œå¹¶å¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è€è§„çŸ©ï¼Œå¯åŠ¨ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConfigApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€å°±æ˜¯é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8700</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">configserver</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8801/eureka,</span> <span class="string">http://localhost:8802/eureka</span></span><br></pre></td></tr></table></figure>

<p>å…ˆå¯åŠ¨ä¸€æ¬¡çœ‹çœ‹ï¼Œèƒ½ä¸èƒ½æˆåŠŸï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0m9lyfoz2j226409uabs.jpg" alt="image-20220325173932623"></p>
<p>è¿™é‡Œæˆ‘ä»¬ä»¥æœ¬åœ°ä»“åº“ä¸ºä¾‹ï¼ˆå°±ä¸ç”¨GitHubäº†ï¼Œå¡åˆ°æ€€ç–‘äººç”Ÿäº†ï¼‰ï¼Œé¦–å…ˆåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæœ¬åœ°Gitä»“åº“ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œåœ¨æ¡Œé¢ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„æœ¬åœ°ä»“åº“ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0mhe24rhjj211q05cabb.jpg" alt="image-20220325220843990"></p>
<p>ç„¶åæˆ‘ä»¬åœ¨æ–‡ä»¶å¤¹ä¸­éšä¾¿åˆ›å»ºä¸€äº›é…ç½®æ–‡ä»¶ï¼Œæ³¨æ„åç§°æœ€å¥½æ˜¯{æœåŠ¡åç§°}-{ç¯å¢ƒ}.ymlï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0mhjqi2o6j216205gaan.jpg" alt="image-20220325221411834"></p>
<p>ç„¶åæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ æœ¬åœ°ä»“åº“çš„ä¸€äº›ä¿¡æ¯ï¼ˆè¿œç¨‹ä»“åº“åŒç†ï¼‰ï¼Œè¯¦ç»†ä½¿ç”¨æ•™ç¨‹ï¼š<a href="https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#_git_backend">https://docs.spring.io/spring-cloud-config/docs/current/reference/html/#_git_backend</a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">        	<span class="comment"># è¿™é‡Œå¡«å†™çš„æ˜¯æœ¬åœ°ä»“åº“åœ°å€ï¼Œè¿œç¨‹ä»“åº“ç›´æ¥å¡«å†™è¿œç¨‹ä»“åº“åœ°å€ http://git...</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">file://$&#123;user.home&#125;/Desktop/config-repo</span></span><br><span class="line">          <span class="comment"># é»˜è®¤åˆ†æ”¯è®¾å®šä¸ºä½ è‡ªå·±æœ¬åœ°æˆ–æ˜¯è¿œç¨‹åˆ†æ”¯çš„åç§°</span></span><br><span class="line">          <span class="attr">default-label:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯åŠ¨æˆ‘ä»¬çš„é…ç½®æœåŠ¡å™¨ï¼Œé€šè¿‡ä»¥ä¸‹æ ¼å¼è¿›è¡Œè®¿é—®ï¼š</p>
<ul>
<li><a href="http://localhost:8700/%7B%E6%9C%8D%E5%8A%A1%E5%90%8D%E7%A7%B0%7D/%7B%E7%8E%AF%E5%A2%83%7D/%7BGit%E5%88%86%E6%94%AF%7D">http://localhost:8700/{æœåŠ¡åç§°}/{ç¯å¢ƒ}/{Gitåˆ†æ”¯}</a></li>
<li><a href="http://localhost:8700/%7BGit%E5%88%86%E6%94%AF%7D/%7B%E6%9C%8D%E5%8A%A1%E5%90%8D%E7%A7%B0%7D-%7B%E7%8E%AF%E5%A2%83%7D.yml">http://localhost:8700/{Gitåˆ†æ”¯}/{æœåŠ¡åç§°}-{ç¯å¢ƒ}.yml</a></li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬è¦è®¿é—®å›¾ä¹¦æœåŠ¡çš„ç”Ÿäº§ç¯å¢ƒä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ <a href="http://localhost:8700/bookservice/prod/main">http://localhost:8700/bookservice/prod/main</a> é“¾æ¥ï¼Œå®ƒä¼šæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0mhpjeaiyj22is0cadjs.jpg" alt="image-20220325221946363"></p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <a href="http://localhost:8700/main/bookservice-prod.yml">http://localhost:8700/main/bookservice-prod.yml</a> é“¾æ¥ï¼Œå®ƒä»…æ˜¾ç¤ºé…ç½®æ–‡ä»¶åŸæ–‡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0mht1siqdj21ro0hu41a.jpg" alt="image-20220325222309095"></p>
<p>å½“ç„¶ï¼Œé™¤äº†ä½¿ç”¨Gitæ¥ä¿å­˜ä¹‹å¤–ï¼Œè¿˜æ”¯æŒä¸€äº›å…¶ä»–çš„æ–¹å¼ï¼Œè¯¦ç»†æƒ…å†µè¯·æŸ¥é˜…å®˜ç½‘ã€‚</p>
<h3 id="å®¢æˆ·ç«¯é…ç½®"><a href="#å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="å®¢æˆ·ç«¯é…ç½®"></a>å®¢æˆ·ç«¯é…ç½®</h3><p>æœåŠ¡ç«¯é…ç½®å®Œæˆä¹‹åï¼Œæˆ‘ä»¬æ¥ç€æ¥é…ç½®ä¸€ä¸‹å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬çš„æœåŠ¡æ—¢ç„¶éœ€è¦ä»æœåŠ¡å™¨è¯»å–é…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œä¸€äº›é…ç½®ï¼Œæˆ‘ä»¬åˆ é™¤åŸæ¥çš„<code>application.yml</code>æ–‡ä»¶ï¼ˆä¹Ÿå¯ä»¥ä¿ç•™ï¼Œæœ€åæ— è®ºæ˜¯è¿œç«¯é…ç½®è¿˜æ˜¯æœ¬åœ°é…ç½®éƒ½ä¼šè¢«åŠ è½½ï¼‰ï¼Œæ”¹ç”¨<code>bootstrap.yml</code>ï¼ˆåœ¨application.ymlä¹‹å‰åŠ è½½ï¼Œå¯ä»¥å®ç°é…ç½®æ–‡ä»¶è¿œç¨‹è·å–ï¼‰ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">    	<span class="comment"># åç§°ï¼Œå…¶å®å°±æ˜¯æ–‡ä»¶åç§°</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">bookservice</span></span><br><span class="line">      <span class="comment"># é…ç½®æœåŠ¡å™¨çš„åœ°å€</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://localhost:8700</span></span><br><span class="line">      <span class="comment"># ç¯å¢ƒ</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">prod</span></span><br><span class="line">      <span class="comment"># åˆ†æ”¯</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œæˆä¹‹åï¼Œå¯åŠ¨å›¾ä¹¦æœåŠ¡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0mii0tbegj22l208k43a.jpg" alt="image-20220325224708591"></p>
<p>å¯ä»¥çœ‹åˆ°å·²ç»ä»è¿œç«¯è·å–åˆ°äº†é…ç½®ï¼Œå¹¶è¿›è¡Œå¯åŠ¨ã€‚</p>
<hr>
<h2 id="å¾®æœåŠ¡CAPåŸåˆ™"><a href="#å¾®æœåŠ¡CAPåŸåˆ™" class="headerlink" title="å¾®æœåŠ¡CAPåŸåˆ™"></a>å¾®æœåŠ¡CAPåŸåˆ™</h2><p>ç»è¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹SpringCloud Netflixä»¥åŠSpringCloudå®˜æ–¹æ•´ä¸ªç”Ÿæ€ä¸‹çš„ç»„ä»¶è®¤è¯†ä¹Ÿå·®ä¸å¤šäº†ï¼Œå…¥é—¨æ•™å­¦å°±åˆ°æ­¤ä¸ºæ­¢ï¼Œä¸‹ä¸€ç« å°†å¼€å¯çœŸæ­£ç²¾å½©çš„æ­£ç‰‡éƒ¨åˆ†ï¼Œæœ¬ç« çš„æœ€åæˆ‘ä»¬è¿˜æ˜¯æ¥äº†è§£ä¸€äº›ç†è®ºä¸Šçš„çŸ¥è¯†ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0mj50oc1zj212e0jw756.jpg" alt="image-20220325230915356"></p>
<blockquote>
<p>CAPåŸåˆ™åˆç§°CAPå®šç†ï¼ŒæŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå­˜åœ¨Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€Availabilityï¼ˆå¯ç”¨æ€§ï¼‰ã€Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰ï¼Œä¸‰è€…ä¸å¯åŒæ—¶ä¿è¯ï¼Œæœ€å¤šåªèƒ½ä¿è¯å…¶ä¸­çš„ä¸¤è€…ã€‚   </p>
<p>ä¸€è‡´æ€§ï¼ˆCï¼‰ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å¤‡ä»½ï¼Œåœ¨åŒä¸€æ—¶åˆ»éƒ½æ˜¯åŒæ ·çš„å€¼ï¼ˆæ‰€æœ‰çš„èŠ‚ç‚¹æ— è®ºä½•æ—¶è®¿é—®éƒ½èƒ½æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼‰</p>
<p>å¯ç”¨æ€§ï¼ˆAï¼‰ï¼šç³»ç»Ÿä¸­éæ•…éšœèŠ‚ç‚¹æ”¶åˆ°çš„æ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»å¾—åˆ°å“åº”ï¼ˆæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æœåŠ¡é™çº§å’Œç†”æ–­ï¼Œå…¶å®å°±æ˜¯ä¸€ç§ç»´æŒå¯ç”¨æ€§çš„æªæ–½ï¼Œè™½ç„¶æœåŠ¡è¿”å›çš„æ˜¯æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰çš„æ•°æ®ï¼Œä½†æ˜¯ä¸è‡³äºç”¨æˆ·çš„è¯·æ±‚ä¼šè¢«æœåŠ¡å™¨å¿½ç•¥ï¼‰</p>
<p>åˆ†åŒºå®¹é”™æ€§ï¼ˆPï¼‰ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿé‡Œé¢ï¼ŒèŠ‚ç‚¹ä¹‹é—´ç»„æˆçš„ç½‘ç»œæœ¬æ¥åº”è¯¥æ˜¯è¿é€šçš„ï¼Œç„¶è€Œå¯èƒ½å› ä¸ºä¸€äº›æ•…éšœï¼ˆæ¯”å¦‚ç½‘ç»œä¸¢åŒ…ç­‰ï¼Œè¿™æ˜¯å¾ˆéš¾é¿å…çš„ï¼‰ï¼Œä½¿å¾—æœ‰äº›èŠ‚ç‚¹ä¹‹é—´ä¸è¿é€šäº†ï¼Œæ•´ä¸ªç½‘ç»œå°±åˆ†æˆäº†å‡ å—åŒºåŸŸï¼Œæ•°æ®å°±æ•£å¸ƒåœ¨äº†è¿™äº›ä¸è¿é€šçš„åŒºåŸŸä¸­ï¼ˆè¿™æ ·å°±å¯èƒ½å‡ºç°æŸäº›è¢«åˆ†åŒºèŠ‚ç‚¹å­˜æ”¾çš„æ•°æ®è®¿é—®å¤±è´¥ï¼Œæˆ‘ä»¬éœ€è¦æ¥å®¹å¿è¿™äº›ä¸å¯é çš„æƒ…å†µï¼‰</p>
</blockquote>
<p>æ€»çš„æ¥è¯´ï¼Œæ•°æ®å­˜æ”¾çš„èŠ‚ç‚¹æ•°è¶Šå¤šï¼Œåˆ†åŒºå®¹å¿æ€§å°±è¶Šé«˜ï¼Œä½†æ˜¯è¦å¤åˆ¶æ›´æ–°çš„æ¬¡æ•°å°±è¶Šå¤šï¼Œä¸€è‡´æ€§å°±è¶Šéš¾ä¿è¯ã€‚åŒæ—¶ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ›´æ–°æ‰€æœ‰èŠ‚ç‚¹æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œé‚£ä¹ˆå¯ç”¨æ€§å°±ä¼šé™ä½ã€‚</p>
<p>æ‰€ä»¥è¯´ï¼Œåªèƒ½å­˜åœ¨ä»¥ä¸‹ä¸‰ç§æ–¹æ¡ˆï¼š</p>
<h3 id="AC-å¯ç”¨æ€§-ä¸€è‡´æ€§"><a href="#AC-å¯ç”¨æ€§-ä¸€è‡´æ€§" class="headerlink" title="AC å¯ç”¨æ€§+ä¸€è‡´æ€§"></a>AC å¯ç”¨æ€§+ä¸€è‡´æ€§</h3><p>è¦åŒæ—¶ä¿è¯å¯ç”¨æ€§å’Œä¸€è‡´æ€§ï¼Œä»£è¡¨ç€æŸä¸ªèŠ‚ç‚¹æ•°æ®æ›´æ–°ä¹‹åï¼Œéœ€è¦ç«‹å³å°†ç»“æœé€šçŸ¥ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå¹¶ä¸”è¦å°½å¯èƒ½çš„å¿«ï¼Œè¿™æ ·æ‰èƒ½åŠæ—¶å“åº”ä¿è¯å¯ç”¨æ€§ï¼Œè¿™å°±å¯¹ç½‘ç»œçš„ç¨³å®šæ€§è¦æ±‚éå¸¸é«˜ï¼Œä½†æ˜¯å®é™…æƒ…å†µä¸‹ï¼Œç½‘ç»œå¾ˆå®¹æ˜“å‡ºç°ä¸¢åŒ…ç­‰æƒ…å†µï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå¯é çš„ä¼ è¾“ï¼Œå¦‚æœéœ€è¦é¿å…è¿™ç§é—®é¢˜ï¼Œå°±åªèƒ½å°†èŠ‚ç‚¹å…¨éƒ¨æ”¾åœ¨ä¸€èµ·ï¼Œä½†æ˜¯è¿™æ˜¾ç„¶è¿èƒŒäº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¦‚å¿µï¼Œæ‰€ä»¥å¯¹äºæˆ‘ä»¬çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œå¾ˆéš¾æ¥å—ã€‚</p>
<h3 id="CP-ä¸€è‡´æ€§-åˆ†åŒºå®¹é”™æ€§"><a href="#CP-ä¸€è‡´æ€§-åˆ†åŒºå®¹é”™æ€§" class="headerlink" title="CP ä¸€è‡´æ€§+åˆ†åŒºå®¹é”™æ€§"></a>CP ä¸€è‡´æ€§+åˆ†åŒºå®¹é”™æ€§</h3><p>ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå°±å¾—å°†æŸä¸ªèŠ‚ç‚¹çš„æœ€æ–°æ•°æ®å‘é€ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå¹¶ä¸”éœ€è¦ç­‰åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½å¾—åˆ°æ•°æ®æ‰èƒ½è¿›è¡Œå“åº”ï¼ŒåŒæ—¶æœ‰äº†åˆ†åŒºå®¹é”™æ€§ï¼Œé‚£ä¹ˆä»£è¡¨æˆ‘ä»¬å¯ä»¥å®¹å¿ç½‘ç»œçš„ä¸å¯é é—®é¢˜ï¼Œæ‰€ä»¥å°±ç®—ç½‘ç»œå‡ºç°å¡é¡¿ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡»ç­‰å¾…æ‰€æœ‰èŠ‚ç‚¹å®Œæˆæ•°æ®åŒæ­¥ï¼Œæ‰èƒ½è¿›è¡Œå“åº”ï¼Œå› æ­¤å°±ä¼šå¯¼è‡´æœåŠ¡åœ¨ä¸€æ®µæ—¶é—´å†…å®Œå…¨å¤±æ•ˆï¼Œæ‰€ä»¥å¯ç”¨æ€§æ˜¯æ— æ³•å¾—åˆ°ä¿è¯çš„ã€‚</p>
<h3 id="AP-å¯ç”¨æ€§-åˆ†åŒºå®¹é”™æ€§"><a href="#AP-å¯ç”¨æ€§-åˆ†åŒºå®¹é”™æ€§" class="headerlink" title="AP å¯ç”¨æ€§+åˆ†åŒºå®¹é”™æ€§"></a>AP å¯ç”¨æ€§+åˆ†åŒºå®¹é”™æ€§</h3><p>æ—¢ç„¶CPå¯èƒ½ä¼šå¯¼è‡´ä¸€æ®µæ—¶é—´å†…æœåŠ¡å¾—ä¸åˆ°ä»»ä½•å“åº”ï¼Œé‚£ä¹ˆè¦ä¿è¯å¯ç”¨æ€§ï¼Œå°±åªèƒ½æ”¾å¼ƒèŠ‚ç‚¹ä¹‹é—´æ•°æ®çš„é«˜åº¦ç»Ÿä¸€ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨æ•°æ®ä¸ç»Ÿä¸€çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œå“åº”ï¼Œå› æ­¤å°±æ— æ³•ä¿è¯ä¸€è‡´æ€§äº†ã€‚è™½ç„¶è¿™æ ·ä¼šå¯¼è‡´æ‹¿ä¸åˆ°æœ€æ–°çš„æ•°æ®ï¼Œä½†æ˜¯åªè¦æ•°æ®åŒæ­¥æ“ä½œåœ¨åå°ç»§ç»­è¿è¡Œï¼Œä¸€å®šèƒ½å¤Ÿåœ¨æŸä¸€æ—¶åˆ»å®Œæˆæ‰€æœ‰èŠ‚ç‚¹æ•°æ®çš„åŒæ­¥ï¼Œé‚£ä¹ˆå°±èƒ½å®ç°<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>ï¼Œæ‰€ä»¥APå®é™…ä¸Šæ˜¯æœ€èƒ½æ¥å—çš„ä¸€ç§æ–¹æ¡ˆã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬å®ç°çš„Eurekaé›†ç¾¤ï¼Œå®ƒä½¿ç”¨çš„å°±æ˜¯APæ–¹æ¡ˆï¼ŒEurekaå„ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¹³ç­‰çš„ï¼Œå°‘æ•°èŠ‚ç‚¹æŒ‚æ‰ä¸ä¼šå½±å“æ­£å¸¸èŠ‚ç‚¹çš„å·¥ä½œï¼Œå‰©ä½™çš„èŠ‚ç‚¹ä¾ç„¶å¯ä»¥æä¾›æ³¨å†Œå’ŒæŸ¥è¯¢æœåŠ¡ã€‚è€ŒEurekaå®¢æˆ·ç«¯åœ¨å‘æŸä¸ªEurekaæœåŠ¡ç«¯æ³¨å†Œæ—¶å¦‚æœå‘ç°è¿æ¥å¤±è´¥ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ‡æ¢è‡³å…¶ä»–èŠ‚ç‚¹ã€‚åªè¦æœ‰ä¸€å°EurekaæœåŠ¡å™¨æ­£å¸¸è¿è¡Œï¼Œé‚£ä¹ˆå°±èƒ½ä¿è¯æœåŠ¡å¯ç”¨<strong>ï¼ˆAï¼‰</strong>ï¼Œåªä¸è¿‡æŸ¥è¯¢åˆ°çš„ä¿¡æ¯å¯èƒ½ä¸æ˜¯æœ€æ–°çš„<strong>ï¼ˆCï¼‰</strong></p>
<p>åœ¨ä¹‹åçš„ç« èŠ‚ï¼Œæˆ‘ä»¬è¿˜ä¼šç»§ç»­äº†è§£è¿™äº›ç†è®ºçš„å…¶ä»–å®é™…åº”ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>spring cloud</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringCloudç¬”è®°ï¼ˆä¸‰ï¼‰</title>
    <url>/2022/05/30/SpringCloud%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    <content><![CDATA[<h1 id="å¾®æœåŠ¡åº”ç”¨"><a href="#å¾®æœåŠ¡åº”ç”¨" class="headerlink" title="å¾®æœåŠ¡åº”ç”¨"></a>å¾®æœåŠ¡åº”ç”¨</h1><p>å‰é¢æˆ‘ä»¬å·²ç»å®Œæˆäº†SpringCloudAlibabaçš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹ä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®çš„æ¶æ„ä½“ç³»å·²ç»æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œé‚£ä¹ˆæœ¬ç« æˆ‘ä»¬å°†åœ¨åº”ç”¨å±‚é¢ç»§ç»­æ¢è®¨å¾®æœåŠ¡ã€‚</p>
<span id="more"></span>

<h2 id="åˆ†å¸ƒå¼æƒé™æ ¡éªŒ"><a href="#åˆ†å¸ƒå¼æƒé™æ ¡éªŒ" class="headerlink" title="åˆ†å¸ƒå¼æƒé™æ ¡éªŒ"></a>åˆ†å¸ƒå¼æƒé™æ ¡éªŒ</h2><p>è™½ç„¶å®Œæˆå‰é¢çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥è‡ªå·±å»ç¼–å†™ä¸€ä¸ªæ¯”è¾ƒä¸­è§„ä¸­çŸ©çš„å¾®æœåŠ¡é¡¹ç›®äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æˆ‘ä»¬æ²¡æœ‰è§£å†³ï¼Œç™»å½•é—®é¢˜ã€‚å‡å¦‚ç°åœ¨è¦æ±‚ç”¨æˆ·ç™»å½•ä¹‹åï¼Œæ‰èƒ½è¿›è¡Œå›¾ä¹¦çš„æŸ¥è¯¢ã€å€Ÿé˜…ç­‰æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆè¯¥å¦‚ä½•è®¾è®¡è¿™ä¸ªç³»ç»Ÿå‘¢ï¼Ÿ</p>
<p>å›é¡¾æˆ‘ä»¬ä¹‹å‰è¿›è¡Œæƒé™æ ¡éªŒçš„åŸç†ï¼ŒæœåŠ¡å™¨æ˜¯å¦‚ä½•åˆ¤å®šä¸€ä¸ªè¯·æ±‚æ˜¯æ¥è‡ªå“ªä¸ªç”¨æˆ·çš„å‘¢ï¼Ÿ</p>
<ul>
<li>é¦–å…ˆæµè§ˆå™¨ä¼šå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œè®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ã€‚</li>
<li>æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œä¼šåˆ›å»ºä¸€ä¸ªSESSION IDï¼Œå¹¶æš‚æ—¶å­˜å‚¨åœ¨æœåŠ¡ç«¯ï¼Œç„¶åä¼šå‘é€ç»™æµè§ˆå™¨ä½œä¸ºCookieä¿å­˜ã€‚</li>
<li>ä¹‹åæµè§ˆå™¨ä¼šä¸€ç›´æºå¸¦æ­¤Cookieè®¿é—®æœåŠ¡å™¨ï¼Œè¿™æ ·åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œå°±èƒ½æ ¹æ®æºå¸¦çš„Cookieä¸­çš„SESSION IDåˆ¤æ–­æ˜¯å“ªä¸ªç”¨æˆ·äº†ã€‚</li>
<li>è¿™æ ·æœåŠ¡ç«¯å’Œæµè§ˆå™¨ä¹‹é—´å¯ä»¥è½»æ¾åœ°å»ºç«‹ä¼šè¯äº†ã€‚</li>
</ul>
<p>ä½†æ˜¯æˆ‘ä»¬æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç°åœ¨é‡‡ç”¨çš„æ˜¯åˆ†å¸ƒå¼çš„ç³»ç»Ÿï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·æœåŠ¡è¿›è¡Œç™»å½•ä¹‹åï¼Œå…¶ä»–æœåŠ¡æ¯”å¦‚å›¾ä¹¦æœåŠ¡å’Œå€Ÿé˜…æœåŠ¡ï¼Œå®ƒä»¬ä¼šçŸ¥é“ç”¨æˆ·ç™»å½•äº†å—ï¼Ÿ</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0uko0a27mj21ia08y0u9.jpg" alt="image-20220401220634827"></p>
<p>å®é™…ä¸Šæˆ‘ä»¬ç™»å½•åˆ°ç”¨æˆ·æœåŠ¡ä¹‹åï¼ŒSessionä¸­çš„ç”¨æˆ·æ•°æ®åªä¼šåœ¨ç”¨æˆ·æœåŠ¡çš„åº”ç”¨ä¸­ä¿å­˜ï¼Œè€Œåœ¨å…¶ä»–æœåŠ¡ä¸­ï¼Œå¹¶æ²¡æœ‰å¯¹åº”çš„ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘ä»¬ç°åœ¨å¸Œæœ›çš„æ˜¯ï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½èƒ½å¤ŸåŒæ­¥è¿™äº›Sessionä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½å®ç°åœ¨ç”¨æˆ·æœåŠ¡ç™»å½•ä¹‹åå…¶ä»–æœåŠ¡éƒ½èƒ½çŸ¥é“ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å®ç°Sessionçš„åŒæ­¥å‘¢ï¼Ÿ</p>
<ol>
<li>æˆ‘ä»¬å¯ä»¥åœ¨æ¯å°æœåŠ¡å™¨ä¸Šéƒ½å¤åˆ¶ä¸€ä»½Sessionï¼Œä½†æ˜¯è¿™æ ·æ˜¾ç„¶æ˜¯å¾ˆæµªè´¹æ—¶é—´çš„ï¼Œå¹¶ä¸”ç”¨æˆ·éªŒè¯æ•°æ®å ç”¨çš„å†…å­˜ä¼šæˆå€çš„å¢åŠ ã€‚</li>
<li>å°†Sessionç§»å‡ºæœåŠ¡å™¨ï¼Œç”¨ç»Ÿä¸€å­˜å‚¨æ¥å­˜æ”¾ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨Redisæˆ–æ˜¯MySQLä¸­å­˜æ”¾ç”¨æˆ·çš„Sessionä¿¡æ¯ï¼Œè¿™æ ·æ‰€æœ‰çš„æœåŠ¡å™¨åœ¨éœ€è¦è·å–Sessionä¿¡æ¯æ—¶ï¼Œç»Ÿä¸€è®¿é—®Redisæˆ–æ˜¯MySQLå³å¯ï¼Œè¿™æ ·å°±èƒ½ä¿è¯æ‰€æœ‰æœåŠ¡éƒ½å¯ä»¥åŒæ­¥Sessionäº†ï¼ˆæ˜¯ä¸æ˜¯è¶Šæ¥è¶Šæ„Ÿè§‰åªè¦æœ‰é—®é¢˜ï¼Œæ²¡æœ‰ä»€ä¹ˆæ˜¯åŠ ä¸€ä¸ªä¸­é—´ä»¶è§£å†³ä¸äº†çš„ï¼‰</li>
</ol>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0v7jwaum4j21qk0amq4h.jpg" alt="image-20220402111827054"></p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±ç€é‡æ¥ç ”ç©¶ä¸€ä¸‹ï¼Œç„¶åå®ç°2å·æ–¹æ¡ˆï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨Redisä½œä¸ºSessionç»Ÿä¸€å­˜å‚¨ï¼Œæˆ‘ä»¬æŠŠä¸€å¼€å§‹çš„å‹ç¼©åŒ…é‡æ–°è§£å‹ä¸€æ¬¡ï¼Œåˆæ¥ä»å¤´å¼€å§‹ç¼–å†™å§ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å°±åªä½¿ç”¨Nacoså°±è¡Œäº†ï¼Œå’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠNacosçš„åŒ…å¯¼å…¥ä¸€ä¸‹ï¼Œç„¶åè¿›è¡Œä¸€äº›é…ç½®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0v6vpkivcj22ca0baju3.jpg" alt="image-20220402105512397"></p>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡éƒ½æ·»åŠ éªŒè¯æœºåˆ¶ï¼Œé¦–å…ˆå¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--  SpringSession Redisæ”¯æŒ  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  æ·»åŠ Redisçš„Starter  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨SpringSecurityæ¡†æ¶ä½œä¸ºæƒé™æ ¡éªŒæ¡†æ¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åœ¨æ¯ä¸ªæœåŠ¡éƒ½ç¼–å†™ä¸€ä¸‹å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">session:</span></span><br><span class="line">  	<span class="comment"># å­˜å‚¨ç±»å‹ä¿®æ”¹ä¸ºredis</span></span><br><span class="line">    <span class="attr">store-type:</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">  	<span class="comment"># RedisæœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œè¯¥å’‹å†™å’‹å†™</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">1.14</span><span class="number">.121</span><span class="number">.107</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæœåŠ¡çš„æ¥å£éƒ½ä¼šè¢«SpringSecurityæ‰€ä¿æŠ¤ï¼Œåªæœ‰ç™»å½•æˆåŠŸä¹‹åï¼Œæ‰å¯ä»¥è¢«è®¿é—®ã€‚</p>
<p>æˆ‘ä»¬æ¥æ‰“å¼€Nacosçœ‹çœ‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0v6x7rkvuj22cm09sq4s.jpg" alt="image-20220402105638986"></p>
<p>å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªæœåŠ¡éƒ½æ­£å¸¸æ³¨å†Œäº†ï¼Œæ¥ç€æˆ‘ä»¬å»è®¿é—®å›¾ä¹¦æœåŠ¡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0v6yoo6hbj226g0jkjsy.jpg" alt="image-20220402105803658"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè®¿é—®å¤±è´¥ï¼Œç›´æ¥æŠŠæˆ‘ä»¬ç»™é‡å®šå‘åˆ°ç™»é™†é¡µé¢äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»ç™»é™†ä¹‹åæ‰èƒ½è®¿é—®ï¼ŒåŒæ ·çš„æ–¹å¼å»è®¿é—®å…¶ä»–æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœã€‚</p>
<p>ç”±äºç°åœ¨æ˜¯ç»Ÿä¸€Sessionå­˜å‚¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»æ„ä¸€ä¸ªæœåŠ¡ç™»å½•ä¹‹åï¼Œå…¶ä»–æœåŠ¡éƒ½å¯ä»¥æ­£å¸¸è®¿é—®ï¼Œç°åœ¨æˆ‘ä»¬åœ¨å½“å‰é¡µé¢ç™»å½•ï¼Œç™»å½•ä¹‹åå¯ä»¥çœ‹åˆ°å›¾ä¹¦æœåŠ¡èƒ½å¤Ÿæ­£å¸¸è®¿é—®äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0v73kpsaaj219u06a0tg.jpg" alt="image-20220402110245827"></p>
<p>åŒæ—¶ç”¨æˆ·æœåŠ¡ä¹Ÿèƒ½æ­£å¸¸è®¿é—®äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0v74bgewzj216m06874r.jpg" alt="image-20220402110328674"></p>
<p>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹RedisæœåŠ¡å™¨ä¸­æ˜¯ä¸æ˜¯å­˜å‚¨äº†æˆ‘ä»¬çš„Sessionä¿¡æ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0v754p9ihj20z8048aax.jpg" alt="image-20220402110416031"></p>
<p>è™½ç„¶çœ‹èµ·æ¥å¥½åƒç¡®å®æ²¡å•¥é—®é¢˜äº†ï¼Œä½†æ˜¯å€Ÿé˜…æœåŠ¡ç‚¸äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0v768pgt2j21sk096q7k.jpg" alt="image-20220402110519893"></p>
<p>åœ¨RestTemplateè¿›è¡Œè¿œç¨‹è°ƒç”¨çš„æ—¶å€™ï¼Œç”±äºæˆ‘ä»¬çš„è¯·æ±‚æ²¡æœ‰æºå¸¦å¯¹åº”SESSIONçš„Cookieï¼Œæ‰€ä»¥å¯¼è‡´éªŒè¯å¤±è´¥ï¼Œè®¿é—®ä¸æˆåŠŸï¼Œè¿”å›401ï¼Œæ‰€ä»¥è™½ç„¶è¿™ç§æ–¹æ¡ˆçœ‹èµ·æ¥æ¯”è¾ƒåˆç†ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„å®é™…ä½¿ç”¨ä¸­ï¼Œè¿˜æ˜¯å­˜åœ¨ä¸€äº›ä¸ä¾¿çš„ã€‚</p>
<hr>
<h2 id="OAuth-2-0-å®ç°å•ç‚¹ç™»å½•"><a href="#OAuth-2-0-å®ç°å•ç‚¹ç™»å½•" class="headerlink" title="OAuth 2.0 å®ç°å•ç‚¹ç™»å½•"></a>OAuth 2.0 å®ç°å•ç‚¹ç™»å½•</h2><p><strong>æ³¨æ„ï¼š</strong>ç¬¬ä¸€æ¬¡æ¥è§¦å¯èƒ½ä¼šæ¯”è¾ƒéš¾ï¼Œä¸å¤ªå¥½ç†è§£ï¼Œéœ€è¦å¤šå®è·µå’Œè§‚å¯Ÿã€‚</p>
<p>å‰é¢æˆ‘ä»¬è™½ç„¶ä½¿ç”¨äº†ç»Ÿä¸€å­˜å‚¨æ¥è§£å†³Sessionå…±äº«é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°å°±ç®—å®ç°äº†Sessionå…±äº«ï¼Œä¾ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œç”±äºæˆ‘ä»¬æ¯ä¸ªæœåŠ¡éƒ½æœ‰è‡ªå·±çš„éªŒè¯æ¨¡å—ï¼Œå®é™…ä¸Šæ•´ä¸ªç³»ç»Ÿæ˜¯å­˜åœ¨å†—ä½™åŠŸèƒ½çš„ã€åŒæ—¶è¿˜æœ‰æˆ‘ä»¬ä¸Šé¢å‡ºç°çš„é—®é¢˜ï¼Œé‚£ä¹ˆèƒ½å¦å®ç°åªåœ¨ä¸€ä¸ªæœåŠ¡è¿›è¡Œç™»å½•ï¼Œå°±å¯ä»¥è®¿é—®å…¶ä»–çš„æœåŠ¡å‘¢ï¼Ÿ</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h12or8uglrj21s20gawh8.jpg" alt="image-20220408223238760"></p>
<p>å®é™…ä¸Šä¹‹å‰çš„ç™»å½•æ¨¡å¼ç§°ä¸ºå¤šç‚¹ç™»å½•ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯å®ç°å•ç‚¹ç™»é™†ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¾—æ‰¾ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€ç§å…¨æ–°çš„ç™»å½•æ–¹å¼ï¼š<strong>OAuth 2.0</strong>ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ°ä¸€äº›ç½‘ç«™æ”¯æŒç¬¬ä¸‰æ–¹ç™»å½•ï¼Œæ¯”å¦‚æ·˜å®ã€å’¸é±¼æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ”¯ä»˜å®è¿›è¡Œç™»å½•ï¼Œè…¾è®¯æ¸¸æˆå¯ä»¥ç”¨QQæˆ–æ˜¯å¾®ä¿¡ç™»é™†ï¼Œä»¥åŠå¾®ä¿¡å°ç¨‹åºéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨å¾®ä¿¡è¿›è¡Œç™»å½•ã€‚æˆ‘ä»¬çŸ¥é“å®ƒä»¬å¹¶ä¸æ˜¯å±äºåŒä¸€ä¸ªç³»ç»Ÿï¼Œæ¯”å¦‚æ·˜å®å’Œå’¸é±¼éƒ½ä¸å±äºæ”¯ä»˜å®è¿™ä¸ªåº”ç”¨ï¼Œä½†æ˜¯ç”±äºéœ€è¦è·å–æ”¯ä»˜å®çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ OAuth2.0 æ¥å®ç°ç¬¬ä¸‰æ–¹æˆæƒï¼ŒåŸºäºç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®ç”¨æˆ·ä¿¡æ¯çš„æƒé™ï¼ˆæœ¬è´¨ä¸Šå°±æ˜¯ç»™åˆ«äººè°ƒç”¨è‡ªå·±æœåŠ¡æ¥å£çš„æƒé™ï¼‰ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p>
<h3 id="å››ç§æˆæƒæ¨¡å¼"><a href="#å››ç§æˆæƒæ¨¡å¼" class="headerlink" title="å››ç§æˆæƒæ¨¡å¼"></a>å››ç§æˆæƒæ¨¡å¼</h3><p>æˆ‘ä»¬è¿˜æ˜¯ä»ç†è®ºå¼€å§‹è®²è§£ï¼ŒOAuth 2.0ä¸€å…±æœ‰å››ç§æˆæƒæ¨¡å¼ï¼š</p>
<ol>
<li><p><strong>å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆClient Credentialsï¼‰</strong></p>
<p>è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å‘éªŒè¯æœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªTokenï¼ˆè¿™é‡Œå¯èƒ½æœ‰äº›å°ä¼™ä¼´å¯¹Tokençš„æ¦‚å¿µä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼ŒTokenç›¸å½“äºæ˜¯ä¸€ä¸ªä»¤ç‰Œï¼Œæˆ‘ä»¬éœ€è¦åœ¨éªŒè¯æœåŠ¡å™¨<strong>ï¼ˆUser Account And Authenticationï¼‰</strong>æœåŠ¡æ‹¿åˆ°ä»¤ç‰Œä¹‹åï¼Œæ‰èƒ½å»è®¿é—®èµ„æºï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ã€å€Ÿé˜…ä¿¡æ¯ç­‰ï¼Œè¿™æ ·èµ„æºæœåŠ¡å™¨æ‰èƒ½çŸ¥é“æˆ‘ä»¬æ˜¯è°ä»¥åŠæ˜¯å¦æˆåŠŸç™»å½•äº†ï¼‰</p>
<p>å½“ç„¶ï¼Œè¿™é‡Œçš„å‰ç«¯é¡µé¢åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå®ƒè¿˜å¯ä»¥æ˜¯å…¶ä»–ä»»ä½•ç±»å‹çš„<strong>å®¢æˆ·ç«¯</strong>ï¼Œæ¯”å¦‚Appã€å°ç¨‹åºç”šè‡³æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨çš„æœåŠ¡ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h13srxpu4pj21720940tz.jpg" alt="image-20220409213716233"></p>
<p>è™½ç„¶è¿™ç§æ¨¡å¼æ¯”è¾ƒç®€ä¾¿ï¼Œä½†æ˜¯å·²ç»å¤±å»äº†ç”¨æˆ·éªŒè¯çš„æ„ä¹‰ï¼Œå‹æ ¹å°±ä¸æ˜¯ç»™ç”¨æˆ·æ ¡éªŒå‡†å¤‡çš„ï¼Œè€Œæ˜¯æ›´é€‚ç”¨äºæœåŠ¡å†…éƒ¨è°ƒç”¨çš„åœºæ™¯ã€‚</p>
</li>
<li><p><strong>å¯†ç æ¨¡å¼ï¼ˆResource Owner Password Credentialsï¼‰</strong></p>
<p>å¯†ç æ¨¡å¼ç›¸æ¯”å®¢æˆ·ç«¯æ¨¡å¼ï¼Œå°±å¤šäº†ç”¨æˆ·åå’Œå¯†ç çš„ä¿¡æ¯ï¼Œç”¨æˆ·éœ€è¦æä¾›å¯¹åº”è´¦å·çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ‰èƒ½è·å–åˆ°Tokenã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h13srezf2xj218k09c0u6.jpg" alt="image-20220409213646255"></p>
<p>è™½ç„¶è¿™æ ·çœ‹èµ·æ¥æ¯”è¾ƒåˆç†ï¼Œä½†æ˜¯ä¼šç›´æ¥å°†è´¦å·å’Œå¯†ç æ³„éœ²ç»™å®¢æˆ·ç«¯ï¼Œéœ€è¦åå°å®Œå…¨ä¿¡ä»»å®¢æˆ·ç«¯ä¸ä¼šæ‹¿è´¦å·å¯†ç å»å¹²å…¶ä»–åäº‹ï¼Œæ‰€ä»¥è¿™ä¹Ÿä¸æ˜¯æˆ‘ä»¬å¸¸è§çš„ã€‚</p>
</li>
<li><p><strong>éšå¼æˆæƒæ¨¡å¼ï¼ˆImplicit Grantï¼‰</strong></p>
<p>é¦–å…ˆç”¨æˆ·è®¿é—®é¡µé¢æ—¶ï¼Œä¼šé‡å®šå‘åˆ°è®¤è¯æœåŠ¡å™¨ï¼Œæ¥ç€è®¤è¯æœåŠ¡å™¨ç»™ç”¨æˆ·ä¸€ä¸ªè®¤è¯é¡µé¢ï¼Œç­‰å¾…ç”¨æˆ·æˆæƒï¼Œç”¨æˆ·å¡«å†™ä¿¡æ¯å®Œæˆæˆæƒåï¼Œè®¤è¯æœåŠ¡å™¨è¿”å›Tokenã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h13s7a0nxzj21ey0da0uw.jpg" alt="image-20220409211722092"></p>
<p>å®ƒé€‚ç”¨äºæ²¡æœ‰æœåŠ¡ç«¯çš„ç¬¬ä¸‰æ–¹åº”ç”¨é¡µé¢ï¼Œå¹¶ä¸”ç›¸æ¯”å‰é¢ä¸€ç§å½¢å¼ï¼ŒéªŒè¯éƒ½æ˜¯åœ¨éªŒè¯æœåŠ¡å™¨è¿›è¡Œçš„ï¼Œæ•æ„Ÿä¿¡æ¯ä¸ä¼šè½»æ˜“æ³„éœ²ï¼Œä½†æ˜¯Tokenä¾ç„¶å­˜åœ¨æ³„éœ²çš„é£é™©ã€‚</p>
</li>
<li><p><strong>æˆæƒç æ¨¡å¼ï¼ˆAuthrization Codeï¼‰</strong></p>
<p>è¿™ç§æ¨¡å¼æ˜¯æœ€å®‰å…¨çš„ä¸€ç§æ¨¡å¼ï¼Œä¹Ÿæ˜¯æ¨èä½¿ç”¨çš„ä¸€ç§ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰‹æœºä¸Šçš„å¾ˆå¤šAppéƒ½æ˜¯ä½¿ç”¨çš„è¿™ç§æ¨¡å¼ã€‚</p>
<p>ç›¸æ¯”éšå¼æˆæƒæ¨¡å¼ï¼Œå®ƒå¹¶ä¸ä¼šç›´æ¥è¿”å›Tokenï¼Œè€Œæ˜¯è¿”å›æˆæƒç ï¼ŒçœŸæ­£çš„Tokenæ˜¯é€šè¿‡åº”ç”¨æœåŠ¡å™¨è®¿é—®éªŒè¯æœåŠ¡å™¨è·å¾—çš„ã€‚åœ¨ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œåº”ç”¨æœåŠ¡å™¨ï¼ˆå®¢æˆ·ç«¯é€šè¿‡è®¿é—®è‡ªå·±çš„åº”ç”¨æœåŠ¡å™¨æ¥è¿›è€Œè®¿é—®å…¶ä»–æœåŠ¡ï¼‰å’ŒéªŒè¯æœåŠ¡å™¨ä¹‹é—´ä¼šå…±äº«ä¸€ä¸ª<code>secret</code>ï¼Œè¿™ä¸ªä¸œè¥¿æ²¡æœ‰å…¶ä»–äººçŸ¥é“ï¼Œè€ŒéªŒè¯æœåŠ¡å™¨åœ¨ç”¨æˆ·éªŒè¯å®Œæˆä¹‹åï¼Œä¼šè¿”å›ä¸€ä¸ªæˆæƒç ï¼Œåº”ç”¨æœåŠ¡å™¨æœ€åå°†æˆæƒç å’Œ<code>secret</code>ä¸€èµ·äº¤ç»™éªŒè¯æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼Œå¹¶ä¸”Tokenä¹Ÿæ˜¯åœ¨æœåŠ¡ç«¯ä¹‹é—´ä¼ é€’ï¼Œä¸ä¼šç›´æ¥ç»™åˆ°å®¢æˆ·ç«¯ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h13ue89sjxj21dg0fq40y.jpg" alt="image-20220409223317823"></p>
<p>è¿™æ ·å°±ç®—æœ‰äººä¸­é€”çªƒå–äº†æˆæƒç ï¼Œä¹Ÿæ¯«æ— æ„ä¹‰ï¼Œå› ä¸ºï¼ŒTokençš„è·å–å¿…é¡»åŒæ—¶æºå¸¦æˆæƒç å’Œsecretï¼Œä½†æ˜¯<code>secret</code>ç¬¬ä¸‰æ–¹æ˜¯æ— æ³•å¾—çŸ¥çš„ï¼Œå¹¶ä¸”Tokenä¸ä¼šç›´æ¥ä¸¢ç»™å®¢æˆ·ç«¯ï¼Œå¤§å¤§å‡å°‘äº†æ³„éœ²çš„é£é™©ã€‚</p>
</li>
</ol>
<p>ä½†æ˜¯ä¹ä¸€çœ‹ï¼ŒOAuth 2.0ä¸åº”è¯¥æ˜¯é‚£ç§ç¬¬ä¸‰æ–¹åº”ç”¨ä¸ºäº†è¯·æ±‚æˆ‘ä»¬çš„æœåŠ¡è€Œä½¿ç”¨çš„å—ï¼Œè€Œæˆ‘ä»¬è¿™é‡Œéœ€è¦çš„åªæ˜¯å®ç°åŒä¸€ä¸ªåº”ç”¨å†…éƒ¨æœåŠ¡ä¹‹é—´çš„è®¤è¯ï¼Œå…¶å®æˆ‘ä¹Ÿå¯ä»¥åˆ©ç”¨ OAuth2.0 æ¥å®ç°å•ç‚¹ç™»å½•ï¼Œåªæ˜¯å°‘äº†èµ„æºæœåŠ¡å™¨è¿™ä¸€è§’è‰²ï¼Œå®¢æˆ·ç«¯å°±æ˜¯æˆ‘ä»¬çš„æ•´ä¸ªç³»ç»Ÿï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹ã€‚</p>
<h3 id="æ­å»ºéªŒè¯æœåŠ¡å™¨"><a href="#æ­å»ºéªŒè¯æœåŠ¡å™¨" class="headerlink" title="æ­å»ºéªŒè¯æœåŠ¡å™¨"></a>æ­å»ºéªŒè¯æœåŠ¡å™¨</h3><p>ç¬¬ä¸€æ­¥å°±æ˜¯æœ€é‡è¦çš„ï¼Œæˆ‘ä»¬éœ€è¦æ­å»ºä¸€ä¸ªéªŒè¯æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æˆ‘ä»¬è¿›è¡Œæƒé™æ ¡éªŒçš„æ ¸å¿ƒï¼ŒéªŒè¯æœåŠ¡å™¨æœ‰å¾ˆå¤šçš„ç¬¬ä¸‰æ–¹å®ç°ä¹Ÿæœ‰Springå®˜æ–¹æä¾›çš„å®ç°ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Springå®˜æ–¹æä¾›çš„éªŒè¯æœåŠ¡å™¨ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å°†æœ€å¼€å§‹ä¿å­˜å¥½çš„é¡¹ç›®è§£å‹ï¼Œå°±é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œé¦–å…ˆæˆ‘ä»¬åœ¨çˆ¶é¡¹ç›®ä¸­æ·»åŠ æœ€æ–°çš„SpringCloudä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€åˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å—<code>auth-service</code>ï¼Œæ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--  OAuth2.0ä¾èµ–ï¼Œä¸å†å†…ç½®äº†ï¼Œæ‰€ä»¥å¾—æˆ‘ä»¬è‡ªå·±æŒ‡å®šä¸€ä¸‹ç‰ˆæœ¬  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-oauth2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">  	<span class="comment">#ä¸ºäº†é˜²æ­¢ä¸€ä¼šåœ¨æœåŠ¡ä¹‹é—´è·³è½¬å¯¼è‡´Cookieæ‰“æ¶ï¼ˆå› ä¸ºæ‰€æœ‰æœåŠ¡åœ°å€éƒ½æ˜¯localhostï¼Œéƒ½ä¼šå­˜JSESSIONIDï¼‰</span></span><br><span class="line">  	<span class="comment">#è¿™é‡Œä¿®æ”¹ä¸€ä¸‹context-pathï¼Œè¿™æ ·ä¿å­˜çš„Cookieä¼šä½¿ç”¨æŒ‡å®šçš„è·¯å¾„ï¼Œå°±ä¸ä¼šå’Œå…¶ä»–æœåŠ¡æ‰“æ¶äº†</span></span><br><span class="line">  	<span class="comment">#ä½†æ˜¯æ³¨æ„ä¹‹åçš„è¯·æ±‚éƒ½å¾—åœ¨æœ€å‰é¢åŠ ä¸Šè¿™ä¸ªè·¯å¾„</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/sso</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸‹é…ç½®ç±»ï¼Œè¿™é‡Œéœ€è¦ä¸¤ä¸ªé…ç½®ç±»ï¼Œä¸€ä¸ªæ˜¯OAuth2çš„é…ç½®ç±»ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯SpringSecurityçš„é…ç½®ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .anyRequest().authenticated()  <span class="comment">//</span></span><br><span class="line">                .and()</span><br><span class="line">                .formLogin().permitAll();    <span class="comment">//ä½¿ç”¨è¡¨å•ç™»å½•</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">BCryptPasswordEncoder</span> <span class="variable">encoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">        auth</span><br><span class="line">                .inMemoryAuthentication()   <span class="comment">//ç›´æ¥åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œæ‡’å¾—ææ•°æ®åº“äº†</span></span><br><span class="line">                .passwordEncoder(encoder)</span><br><span class="line">                .withUser(<span class="string">&quot;test&quot;</span>).password(encoder.encode(<span class="string">&quot;123456&quot;</span>)).roles(<span class="string">&quot;USER&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  	<span class="meta">@Bean</span>   <span class="comment">//è¿™é‡Œéœ€è¦å°†AuthenticationManageræ³¨å†Œä¸ºBeanï¼Œåœ¨OAuthé…ç½®ä¸­ä½¿ç”¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManagerBean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableAuthorizationServer</span>   <span class="comment">//å¼€å¯éªŒè¯æœåŠ¡å™¨</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OAuth2Configuration</span> <span class="keyword">extends</span> <span class="title class_">AuthorizationServerConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager manager;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">BCryptPasswordEncoder</span> <span class="variable">encoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿™ä¸ªæ–¹æ³•æ˜¯å¯¹å®¢æˆ·ç«¯è¿›è¡Œé…ç½®ï¼Œä¸€ä¸ªéªŒè¯æœåŠ¡å™¨å¯ä»¥é¢„è®¾å¾ˆå¤šä¸ªå®¢æˆ·ç«¯ï¼Œ</span></span><br><span class="line"><span class="comment">     * ä¹‹åè¿™äº›æŒ‡å®šçš„å®¢æˆ·ç«¯å°±å¯ä»¥æŒ‰ç…§ä¸‹é¢æŒ‡å®šçš„æ–¹å¼è¿›è¡ŒéªŒè¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clients å®¢æˆ·ç«¯é…ç½®å·¥å…·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        clients</span><br><span class="line">                .inMemory()   <span class="comment">//è¿™é‡Œæˆ‘ä»¬ç›´æ¥ç¡¬ç¼–ç åˆ›å»ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åƒSecurityé‚£æ ·è‡ªå®šä¹‰æˆ–æ˜¯ä½¿ç”¨JDBCä»æ•°æ®åº“è¯»å–</span></span><br><span class="line">                .withClient(<span class="string">&quot;web&quot;</span>)   <span class="comment">//å®¢æˆ·ç«¯åç§°ï¼Œéšä¾¿èµ·å°±è¡Œ</span></span><br><span class="line">                .secret(encoder.encode(<span class="string">&quot;654321&quot;</span>))      <span class="comment">//åªä¸å®¢æˆ·ç«¯åˆ†äº«çš„secretï¼Œéšä¾¿å†™ï¼Œä½†æ˜¯æ³¨æ„è¦åŠ å¯†</span></span><br><span class="line">                .autoApprove(<span class="literal">false</span>)    <span class="comment">//è‡ªåŠ¨å®¡æ‰¹ï¼Œè¿™é‡Œå…³é—­ï¼Œè¦çš„å°±æ˜¯ä¸€ä¼šä½“éªŒé‚£ç§æ„Ÿè§‰</span></span><br><span class="line">                .scopes(<span class="string">&quot;book&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;borrow&quot;</span>)     <span class="comment">//æˆæƒèŒƒå›´ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å…¨éƒ¨all</span></span><br><span class="line">                .authorizedGrantTypes(<span class="string">&quot;client_credentials&quot;</span>, <span class="string">&quot;password&quot;</span>, <span class="string">&quot;implicit&quot;</span>, <span class="string">&quot;authorization_code&quot;</span>, <span class="string">&quot;refresh_token&quot;</span>);</span><br><span class="line">                <span class="comment">//æˆæƒæ¨¡å¼ï¼Œä¸€å…±æ”¯æŒ5ç§ï¼Œé™¤äº†ä¹‹å‰æˆ‘ä»¬ä»‹ç»çš„å››ç§ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªåˆ·æ–°Tokençš„æ¨¡å¼</span></span><br><span class="line">                <span class="comment">//è¿™é‡Œæˆ‘ä»¬ç›´æ¥æŠŠäº”ç§éƒ½å†™ä¸Šï¼Œæ–¹ä¾¿ä¸€ä¼šå®éªŒï¼Œå½“ç„¶å„ä½ä¹Ÿå¯ä»¥å•ç‹¬åªå†™ä¸€ç§ä¸€ä¸ªä¸€ä¸ªè¿›è¡Œæµ‹è¯•</span></span><br><span class="line">                <span class="comment">//ç°åœ¨æˆ‘ä»¬æŒ‡å®šçš„å®¢æˆ·ç«¯å°±æ”¯æŒè¿™äº”ç§ç±»å‹çš„æˆæƒæ–¹å¼äº†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthorizationServerSecurityConfigurer security)</span> &#123;</span><br><span class="line">        security</span><br><span class="line">                .passwordEncoder(encoder)    <span class="comment">//ç¼–ç å™¨è®¾å®šä¸ºBCryptPasswordEncoder</span></span><br><span class="line">                .allowFormAuthenticationForClients()  <span class="comment">//å…è®¸å®¢æˆ·ç«¯ä½¿ç”¨è¡¨å•éªŒè¯ï¼Œä¸€ä¼šæˆ‘ä»¬POSTè¯·æ±‚ä¸­ä¼šæºå¸¦è¡¨å•ä¿¡æ¯</span></span><br><span class="line">                .checkTokenAccess(<span class="string">&quot;permitAll()&quot;</span>);     <span class="comment">//å…è®¸æ‰€æœ‰çš„TokenæŸ¥è¯¢è¯·æ±‚</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> &#123;</span><br><span class="line">        endpoints</span><br><span class="line">                .authenticationManager(manager);</span><br><span class="line">        <span class="comment">//ç”±äºSpringSecurityæ–°ç‰ˆæœ¬çš„ä¸€äº›åº•å±‚æ”¹åŠ¨ï¼Œè¿™é‡Œéœ€è¦é…ç½®ä¸€ä¸‹authenticationManagerï¼Œæ‰èƒ½æ­£å¸¸ä½¿ç”¨passwordæ¨¡å¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨æœåŠ¡å™¨äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14iuwapslj220008ejx2.jpg" alt="image-20220410123941157"></p>
<p>ç„¶åæˆ‘ä»¬ä½¿ç”¨Postmanè¿›è¡Œæ¥å£æµ‹è¯•ï¼Œé¦–å…ˆæˆ‘ä»¬ä»æœ€ç®€å•çš„å®¢æˆ·ç«¯æ¨¡å¼è¿›è¡Œæµ‹è¯•ï¼Œå®¢æˆ·ç«¯æ¨¡å¼åªéœ€è¦æä¾›idå’Œsecretå³å¯ç›´æ¥æ‹¿åˆ°Tokenï¼Œæ³¨æ„éœ€è¦å†æ·»åŠ ä¸€ä¸ªgrant_typeæ¥è¡¨æ˜æˆ‘ä»¬çš„æˆæƒæ–¹å¼ï¼Œé»˜è®¤è¯·æ±‚è·¯å¾„ä¸º<a href="http://localhost:8500/sso/oauth/token%EF%BC%9A">http://localhost:8500/sso/oauth/tokenï¼š</a></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14jafpizcj21cw0eg76a.jpg" alt="image-20220410125437766"></p>
<p>å‘èµ·è¯·æ±‚åï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¾—åˆ°äº†Tokenï¼Œå®ƒæ˜¯ä»¥JSONæ ¼å¼ç»™åˆ°æˆ‘ä»¬çš„ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14jehayojj21cw0am0ty.jpg" alt="image-20220410125831300"></p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥è®¿é—® <a href="http://localhost:8500/sso/oauth/check_token">http://localhost:8500/sso/oauth/check_token</a> æ¥éªŒè¯æˆ‘ä»¬çš„Tokenæ˜¯å¦æœ‰æ•ˆï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14ji6rg42j21bk0cgmym.jpg" alt="image-20220410130204734"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14jiieikmj21bi0ew75d.jpg" alt="image-20220410130223312"></p>
<p>å¯ä»¥çœ‹åˆ°activeä¸ºtrueï¼Œè¡¨ç¤ºæˆ‘ä»¬åˆšåˆšç”³è¯·åˆ°çš„Tokenæ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ç¬¬äºŒç§passwordæ¨¡å¼ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æä¾›å…·ä½“çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæˆæƒæ¨¡å¼å®šä¹‰ä¸ºpasswordå³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14jqelib5j21bg0fg0u9.jpg" alt="image-20220410130958929"></p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ BasicéªŒè¯ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥å¡«å†™idå’Œsecretå³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14jooye3nj21b00d4q4n.jpg" alt="image-20220410130819980"></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨è¯·æ±‚å¤´ä¸­è‡ªåŠ¨ç”Ÿæˆäº†BasicéªŒè¯ç›¸å…³å†…å®¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14jq4t7y9j21a207s751.jpg" alt="image-20220410130942662"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14jra2ysyj21ay0bgta5.jpg" alt="image-20220410131048992"></p>
<p>å“åº”æˆåŠŸï¼Œå¾—åˆ°Tokenä¿¡æ¯ï¼Œå¹¶ä¸”è¿™é‡Œè¿˜å¤šå‡ºäº†ä¸€ä¸ªrefresh_tokenï¼Œè¿™æ˜¯ç”¨äºåˆ·æ–°Tokençš„ï¼Œæˆ‘ä»¬ä¹‹åä¼šè¿›è¡Œè®²è§£ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14jxemfuxj21d20fcjsq.jpg" alt="image-20220410131641887"></p>
<p>æŸ¥è¯¢Tokenä¿¡æ¯ä¹‹åè¿˜å¯ä»¥çœ‹åˆ°ç™»å½•çš„å…·ä½“ç”¨æˆ·ä»¥åŠè§’è‰²æƒé™ç­‰ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹éšå¼æˆæƒæ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æˆ‘ä»¬éœ€è¦åœ¨éªŒè¯æœåŠ¡å™¨ä¸Šè¿›è¡Œç™»å½•æ“ä½œï¼Œè€Œä¸æ˜¯ç›´æ¥è¯·æ±‚Tokenï¼ŒéªŒè¯ç™»å½•è¯·æ±‚åœ°å€ï¼š<a href="http://localhost:8500/sso/oauth/authorize?client_id=web&amp;response_type=token">http://localhost:8500/sso/oauth/authorize?client_id=web&amp;response_type=token</a></p>
<p>æ³¨æ„response_typeä¸€å®šè¦æ˜¯tokenç±»å‹ï¼Œè¿™æ ·æ‰ä¼šç›´æ¥è¿”å›Tokenï¼Œæµè§ˆå™¨å‘èµ·è¯·æ±‚åï¼Œå¯ä»¥çœ‹åˆ°ç†Ÿæ‚‰è€Œåˆé™Œç”Ÿçš„ç•Œé¢ï¼Œæ²¡é”™ï¼Œå®é™…ä¸Šè¿™é‡Œå°±æ˜¯ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰è®²è§£çš„SpringSecurityè¿›è¡Œç™»é™†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é…ç½®ä¸€ä¸‹è®°ä½æˆ‘ä¹‹ç±»çš„åŠŸèƒ½ï¼Œè¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14k666r5sj22aq0js0ue.jpg" alt="image-20220410132507626"></p>
<p>ä½†æ˜¯ç™»å½•ä¹‹åæˆ‘ä»¬å‘ç°å‡ºç°äº†ä¸€ä¸ªé”™è¯¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14k71g3joj21ae0a60u3.jpg" alt="image-20220410132557704"></p>
<p>è¿™æ˜¯å› ä¸ºç™»å½•æˆåŠŸä¹‹åï¼ŒéªŒè¯æœåŠ¡å™¨éœ€è¦å°†ç»“æœç»™å›å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥éœ€è¦æä¾›å®¢æˆ·ç«¯çš„å›è°ƒåœ°å€ï¼Œè¿™æ ·æµè§ˆå™¨å°±ä¼šè¢«é‡å®šå‘åˆ°æŒ‡å®šçš„å›è°ƒåœ°å€å¹¶ä¸”è¯·æ±‚ä¸­ä¼šæºå¸¦Tokenä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬éšä¾¿é…ç½®ä¸€ä¸ªå›è°ƒåœ°å€ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    clients</span><br><span class="line">            .inMemory()</span><br><span class="line">            .withClient(<span class="string">&quot;web&quot;</span>)</span><br><span class="line">            .secret(encoder.encode(<span class="string">&quot;654321&quot;</span>))</span><br><span class="line">            .autoApprove(<span class="literal">false</span>)</span><br><span class="line">            .scopes(<span class="string">&quot;book&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;borrow&quot;</span>)</span><br><span class="line">            .redirectUris(<span class="string">&quot;http://localhost:8201/login&quot;</span>)   <span class="comment">//å¯ä»¥å†™å¤šä¸ªï¼Œå½“æœ‰å¤šä¸ªæ—¶éœ€è¦åœ¨éªŒè¯è¯·æ±‚ä¸­æŒ‡å®šä½¿ç”¨å“ªä¸ªåœ°å€è¿›è¡Œå›è°ƒ</span></span><br><span class="line">            .authorizedGrantTypes(<span class="string">&quot;client_credentials&quot;</span>, <span class="string">&quot;password&quot;</span>, <span class="string">&quot;implicit&quot;</span>, <span class="string">&quot;authorization_code&quot;</span>, <span class="string">&quot;refresh_token&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€é‡å¯éªŒè¯æœåŠ¡å™¨ï¼Œå†æ¬¡è®¿é—®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14kaonj56j21fw0gw40h.jpg" alt="image-20220410132927907"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œä¼šè®©æˆ‘ä»¬é€‰æ‹©å“ªäº›èŒƒå›´è¿›è¡Œæˆæƒï¼Œå°±åƒæˆ‘ä»¬åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ç™»é™†ä¸€æ ·ï¼Œä¼šè®©æˆ‘ä»¬æˆäºˆç”¨æˆ·ä¿¡æ¯æƒé™ã€æ”¯ä»˜æƒé™ã€ä¿¡ç”¨æŸ¥è¯¢æƒé™ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±å†³å®šè¦ä¸è¦ç»™å®¢æˆ·ç«¯æˆäºˆè®¿é—®è¿™äº›èµ„æºçš„æƒé™ï¼Œè¿™é‡Œæˆ‘ä»¬å…¨éƒ¨é€‰æ‹©æˆäºˆï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14kcehaeej21ye08o758.jpg" alt="image-20220410133106639"></p>
<p>æˆäºˆä¹‹åï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨è¢«é‡å®šå‘åˆ°æˆ‘ä»¬åˆšåˆšæŒ‡å®šçš„å›è°ƒåœ°å€ä¸­ï¼Œå¹¶ä¸”æºå¸¦äº†Tokenä¿¡æ¯ï¼Œç°åœ¨æˆ‘ä»¬æ¥æ ¡éªŒä¸€ä¸‹çœ‹çœ‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14kdhpibjj21d00e675i.jpg" alt="image-20220410133210183"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒTokenä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹ç¬¬å››ç§æœ€å®‰å…¨çš„æˆæƒç æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼å…¶å®æµç¨‹å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è¯·æ±‚çš„æ˜¯codeç±»å‹ï¼š<a href="http://localhost:8500/sso/oauth/authorize?client_id=web&amp;response_type=code">http://localhost:8500/sso/oauth/authorize?client_id=web&amp;response_type=code</a></p>
<p>å¯ä»¥çœ‹åˆ°è®¿é—®ä¹‹åï¼Œä¾ç„¶ä¼šè¿›å…¥åˆ°å›è°ƒåœ°å€ï¼Œä½†æ˜¯è¿™æ—¶ç»™çš„å°±æ˜¯æˆæƒç äº†ï¼Œè€Œä¸æ˜¯ç›´æ¥ç»™Tokenï¼Œé‚£ä¹ˆè¿™ä¸ªTokenè¯¥æ€ä¹ˆè·å–å‘¢ï¼Ÿ</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14kflls50j2178066glw.jpg" alt="image-20220410133411554"></p>
<p>æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰è®²è§£çš„åŸç†ï¼Œæˆ‘ä»¬éœ€è¦æºå¸¦æˆæƒç å’Œsecretä¸€èµ·è¯·æ±‚ï¼Œæ‰èƒ½æ‹¿åˆ°Tokenï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯ç”±å›è°ƒçš„æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œæˆ‘ä»¬å°±åœ¨Postmanä¸­è¿›è¡Œï¼Œæˆ‘ä»¬å¤åˆ¶åˆšåˆšå¾—åˆ°çš„æˆæƒç ï¼Œæ¥å£ä¾ç„¶æ˜¯<code>localhost:8500/sso/oauth/token</code>ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14kike171j21ba0f8404.jpg" alt="image-20220410133702534"></p>
<p>å¯ä»¥çœ‹åˆ°ç»“æœä¹Ÿæ˜¯æ­£å¸¸è¿”å›äº†Tokenä¿¡æ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14klb6srtj21be0bmgn6.jpg" alt="image-20220410133940312"></p>
<p>è¿™æ ·æˆ‘ä»¬å››ç§æœ€åŸºæœ¬çš„Tokenè¯·æ±‚æ–¹å¼å°±å®ç°äº†ã€‚</p>
<p>æœ€åè¿˜æœ‰ä¸€ä¸ªæ˜¯åˆ·æ–°ä»¤ç‰Œä½¿ç”¨çš„ï¼Œå½“æˆ‘ä»¬çš„Tokenè¿‡æœŸæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªrefresh_tokenæ¥ç”³è¯·ä¸€ä¸ªæ–°çš„Tokenï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14lesf7waj21bc0giq4u.jpg" alt="image-20220410140759967"></p>
<p>ä½†æ˜¯æ‰§è¡Œä¹‹åæˆ‘ä»¬å‘ç°ä¼šç›´æ¥å‡ºç°ä¸€ä¸ªå†…éƒ¨é”™è¯¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14lf5oqckj217804mt8w.jpg" alt="image-20220410140822286"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14lffhh02j21w601qmy6.jpg" alt="image-20220410140838064"></p>
<p>æŸ¥çœ‹æ—¥å¿—å‘ç°ï¼Œè¿™é‡Œè¿˜éœ€è¦æˆ‘ä»¬å•ç‹¬é…ç½®ä¸€ä¸ªUserDetailsServiceï¼Œæˆ‘ä»¬ç›´æ¥æŠŠSecurityä¸­çš„å®ä¾‹æ³¨å†Œä¸ºBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> UserDetailsService <span class="title function_">userDetailsServiceBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.userDetailsServiceBean();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨Endpointä¸­è®¾ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">UserDetailsService service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> &#123;</span><br><span class="line">    endpoints</span><br><span class="line">            .userDetailsService(service)</span><br><span class="line">            .authenticationManager(manager);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åå†æ¬¡å°è¯•åˆ·æ–°Tokenï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14linq3lkj21bc0bumyp.jpg" alt="image-20220410141143519"></p>
<p>OKï¼ŒæˆåŠŸåˆ·æ–°Tokenï¼Œè¿”å›äº†ä¸€ä¸ªæ–°çš„ã€‚</p>
<h3 id="åŸºäº-EnableOAuth2Ssoå®ç°"><a href="#åŸºäº-EnableOAuth2Ssoå®ç°" class="headerlink" title="åŸºäº@EnableOAuth2Ssoå®ç°"></a>åŸºäº@EnableOAuth2Ssoå®ç°</h3><p>å‰é¢æˆ‘ä»¬å°†éªŒè¯æœåŠ¡å™¨å·²ç»æ­å»ºå®Œæˆäº†ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥å®ç°ä¸€ä¸‹å•ç‚¹ç™»é™†å§ï¼ŒSpringCloudä¸ºæˆ‘ä»¬æä¾›äº†å®¢æˆ·ç«¯çš„ç›´æ¥å®ç°ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªæ³¨è§£å’Œå°‘é‡é…ç½®å³å¯å°†æˆ‘ä»¬çš„æœåŠ¡ä½œä¸ºä¸€ä¸ªå•ç‚¹ç™»é™†åº”ç”¨ï¼Œä½¿ç”¨çš„æ˜¯ç¬¬å››ç§æˆæƒç æ¨¡å¼ã€‚</p>
<p>ä¸€å¥è¯æ¥è¯´å°±æ˜¯ï¼Œè¿™ç§æ¨¡å¼åªæ˜¯å°†éªŒè¯æ–¹å¼ç”±åŸæœ¬çš„é»˜è®¤ç™»å½•å½¢å¼æ”¹å˜ä¸ºäº†ç»Ÿä¸€åœ¨æˆæƒæœåŠ¡å™¨ç™»é™†çš„å½¢å¼ã€‚</p>
<p>é¦–å…ˆè¿˜æ˜¯ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-oauth2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åªéœ€è¦ç›´æ¥åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableOAuth2Sso</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BookApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸éœ€è¦è¿›è¡Œé¢å¤–çš„é…ç½®ç±»ï¼Œå› ä¸ºè¿™ä¸ªæ³¨è§£å·²ç»å¸®æˆ‘ä»¬åšäº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@EnableOAuth2Client</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;OAuth2SsoProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;OAuth2SsoDefaultConfiguration.class, OAuth2SsoCustomConfiguration.class, ResourceServerTokenServicesConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableOAuth2Sso &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å®ƒç›´æ¥æ³¨å†Œäº†OAuth2SsoDefaultConfigurationï¼Œè€Œè¿™ä¸ªç±»å°±æ˜¯å¸®åŠ©æˆ‘ä»¬å¯¹Securityè¿›è¡Œé…ç½®çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Conditional(&#123;NeedsWebSecurityCondition.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OAuth2SsoDefaultConfiguration</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">  	<span class="comment">//ç›´æ¥ç»§æ‰¿çš„WebSecurityConfigurerAdapterï¼Œå¸®æˆ‘ä»¬æŠŠéªŒè¯è®¾ç½®éƒ½å†™å¥½äº†</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OAuth2SsoDefaultConfiguration</span><span class="params">(ApplicationContext applicationContext)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®æˆ‘ä»¬çš„éªŒè¯æœåŠ¡å™¨ç›¸å…³ä¿¡æ¯ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="attr">oauth2:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">      <span class="comment">#ä¸å¤šè¯´äº†</span></span><br><span class="line">      <span class="attr">client-id:</span> <span class="string">web</span></span><br><span class="line">      <span class="attr">client-secret:</span> <span class="number">654321</span></span><br><span class="line">      <span class="comment">#Tokenè·å–åœ°å€</span></span><br><span class="line">      <span class="attr">access-token-uri:</span> <span class="string">http://localhost:8500/sso/oauth/token</span></span><br><span class="line">      <span class="comment">#éªŒè¯é¡µé¢åœ°å€</span></span><br><span class="line">      <span class="attr">user-authorization-uri:</span> <span class="string">http://localhost:8500/sso/oauth/authorize</span></span><br><span class="line">    <span class="attr">resource:</span></span><br><span class="line">      <span class="comment">#Tokenä¿¡æ¯è·å–å’Œæ ¡éªŒåœ°å€</span></span><br><span class="line">      <span class="attr">token-info-uri:</span> <span class="string">http://localhost:8500/sso/oauth/check_token</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å°±å¼€å¯å›¾ä¹¦æœåŠ¡ï¼Œè°ƒç”¨å›¾ä¹¦æ¥å£ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14mj9etfuj22730u0q8o.jpg" alt="image-20220410144654362"></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨å‘ç°æ²¡æœ‰ç™»å½•éªŒè¯æ—¶ï¼Œä¼šç›´æ¥è·³è½¬åˆ°æˆæƒé¡µé¢ï¼Œè¿›è¡Œæˆæƒç™»å½•ï¼Œä¹‹åæ‰å¯ä»¥ç»§ç»­è®¿é—®å›¾ä¹¦æœåŠ¡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14mkinbbyj219806mjs1.jpg" alt="image-20220410144806506"></p>
<p>é‚£ä¹ˆç”¨æˆ·ä¿¡æ¯å‘¢ï¼Ÿæ˜¯å¦ä¹Ÿä¸€å¹¶ä¿å­˜è¿‡æ¥äº†ï¼Ÿæˆ‘ä»¬è¿™é‡Œç›´æ¥è·å–ä¸€ä¸‹SpringSecurityçš„ContextæŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ï¼Œè·å–æ–¹å¼è·Ÿæˆ‘ä»¬ä¹‹å‰çš„è§†é¢‘ä¸­è®²è§£çš„æ˜¯ä¸€æ ·çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/book/&#123;bid&#125;&quot;)</span></span><br><span class="line">Book <span class="title function_">findBookById</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> bid)</span>&#123;</span><br><span class="line">  	<span class="comment">//é€šè¿‡SecurityContextHolderå°†ç”¨æˆ·ä¿¡æ¯å–å‡º</span></span><br><span class="line">    <span class="type">SecurityContext</span> <span class="variable">context</span> <span class="operator">=</span> SecurityContextHolder.getContext();</span><br><span class="line">    System.out.println(context.getAuthentication());</span><br><span class="line">    <span class="keyword">return</span> service.getBookById(bid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†æ¬¡è®¿é—®å›¾ä¹¦ç®¡ç†æ¥å£ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14moza8zuj220k01adge.jpg" alt="image-20220410145224153"></p>
<p>è¿™é‡Œä½¿ç”¨çš„ä¸æ˜¯ä¹‹å‰çš„UsernamePasswordAuthenticationTokenä¹Ÿä¸æ˜¯RememberMeAuthenticationTokenï¼Œè€Œæ˜¯æ–°çš„OAuth2Authenticationï¼Œå®ƒä¿å­˜äº†éªŒè¯æœåŠ¡å™¨çš„ä¸€äº›ä¿¡æ¯ï¼Œä»¥åŠç»è¿‡æˆ‘ä»¬ä¹‹å‰çš„ç™»é™†æµç¨‹ä¹‹åï¼ŒéªŒè¯æœåŠ¡å™¨å‘æ”¾ç»™å®¢æˆ·ç«¯çš„Tokenä¿¡æ¯ï¼Œå¹¶é€šè¿‡Tokenä¿¡æ¯åœ¨éªŒè¯æœåŠ¡å™¨è¿›è¡ŒéªŒè¯è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæœ€åä¿å­˜åˆ°Sessionä¸­ï¼Œè¡¨ç¤ºç”¨æˆ·å·²éªŒè¯ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè¿˜æ˜¯è¦ä¾èµ–æµè§ˆå™¨å­˜Cookieçš„ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ‰€æœ‰çš„æœåŠ¡éƒ½ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡ŒéªŒè¯ï¼Œåˆ«å¿˜äº†æŠŠé‡å®šå‘åœ°å€ç»™æ‰€æœ‰æœåŠ¡éƒ½åŠ ä¸Šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(ClientDetailsServiceConfigurer clients)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    clients</span><br><span class="line">            .inMemory()</span><br><span class="line">            .withClient(<span class="string">&quot;web&quot;</span>)</span><br><span class="line">            .secret(encoder.encode(<span class="string">&quot;654321&quot;</span>))</span><br><span class="line">            .autoApprove(<span class="literal">true</span>)   <span class="comment">//è¿™é‡ŒæŠŠè‡ªåŠ¨å®¡æ‰¹å¼€äº†ï¼Œå°±ä¸ç”¨å†å»æ‰‹åŠ¨é€‰åŒæ„äº†</span></span><br><span class="line">            .scopes(<span class="string">&quot;book&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;borrow&quot;</span>)</span><br><span class="line">            .redirectUris(<span class="string">&quot;http://localhost:8101/login&quot;</span>, <span class="string">&quot;http://localhost:8201/login&quot;</span>, <span class="string">&quot;http://localhost:8301/login&quot;</span>)</span><br><span class="line">            .authorizedGrantTypes(<span class="string">&quot;client_credentials&quot;</span>, <span class="string">&quot;password&quot;</span>, <span class="string">&quot;implicit&quot;</span>, <span class="string">&quot;authorization_code&quot;</span>, <span class="string">&quot;refresh_token&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®ç°åªåœ¨éªŒè¯æœåŠ¡å™¨ç™»é™†ï¼Œå¦‚æœç™»é™†è¿‡å…¶ä»–çš„æœåŠ¡éƒ½å¯ä»¥è®¿é—®äº†ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ç”±äºSESSIONä¸åŒæ­¥ï¼Œæ¯æ¬¡åˆ‡æ¢ä¸åŒçš„æœåŠ¡è¿›è¡Œè®¿é—®éƒ½ä¼šé‡æ–°å¯¼éªŒè¯æœåŠ¡å™¨å»éªŒè¯ä¸€æ¬¡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h14oue66ytj212606wq42.jpg" alt="image-20220410160648326"></p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š</p>
<ul>
<li>åƒä¹‹å‰ä¸€æ ·åšSESSIONç»Ÿä¸€å­˜å‚¨</li>
<li>è®¾ç½®context-pathè·¯å¾„ï¼Œæ¯ä¸ªæœåŠ¡å•ç‹¬è®¾ç½®ï¼Œå°±ä¸ä¼šæ‰“æ¶äº†</li>
</ul>
<p>ä½†æ˜¯è¿™æ ·ä¾ç„¶æ²¡æ³•è§£å†³æœåŠ¡é—´è°ƒç”¨çš„é—®é¢˜ï¼Œæ‰€ä»¥ä»…ä»…ä¾é å•ç‚¹ç™»é™†çš„æ¨¡å¼ä¸å¤ªè¡Œã€‚</p>
<h3 id="åŸºäº-EnableResourceServerå®ç°"><a href="#åŸºäº-EnableResourceServerå®ç°" class="headerlink" title="åŸºäº@EnableResourceServerå®ç°"></a>åŸºäº@EnableResourceServerå®ç°</h3><p>å‰é¢æˆ‘ä»¬è®²è§£äº†å°†æˆ‘ä»¬çš„æœåŠ¡ä½œä¸ºå•ç‚¹ç™»é™†åº”ç”¨ç›´æ¥å®ç°å•ç‚¹ç™»é™†ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¦‚æœæ˜¯ä»¥ç¬¬ä¸‰æ–¹åº”ç”¨è¿›è¡Œè®¿é—®å‘¢ï¼Ÿè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦å°†æˆ‘ä»¬çš„æœåŠ¡ä½œä¸ºèµ„æºæœåŠ¡äº†ï¼Œä½œä¸ºèµ„æºæœåŠ¡å°±ä¸ä¼šå†æä¾›éªŒè¯çš„è¿‡ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥è¦æ±‚è¯·æ±‚æ—¶æºå¸¦Tokenï¼Œè€ŒéªŒè¯è¿‡ç¨‹æˆ‘ä»¬è¿™é‡Œå°±ç»§ç»­ç”¨Postmanæ¥å®Œæˆï¼Œè¿™æ‰æ˜¯æˆ‘ä»¬å¸¸è§çš„æ¨¡å¼ã€‚</p>
<p>ä¸€å¥è¯æ¥è¯´ï¼Œè·Ÿä¸Šé¢ç›¸æ¯”ï¼Œæˆ‘ä»¬åªéœ€è¦æºå¸¦Tokenå°±èƒ½è®¿é—®è¿™äº›èµ„æºæœåŠ¡å™¨äº†ï¼Œå®¢æˆ·ç«¯è¢«ç‹¬ç«‹äº†å‡ºæ¥ï¼Œç”¨äºæºå¸¦Tokenå»è®¿é—®è¿™äº›æœåŠ¡ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿåªéœ€è¦æ·»åŠ ä¸€ä¸ªæ³¨è§£å’Œå°‘é‡é…ç½®å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableResourceServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BookApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®ä¸­åªéœ€è¦ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="attr">oauth2:</span></span><br><span class="line">    <span class="attr">client:</span></span><br><span class="line">    	<span class="comment">#åŸºæ“</span></span><br><span class="line">      <span class="attr">client-id:</span> <span class="string">web</span></span><br><span class="line">      <span class="attr">client-secret:</span> <span class="number">654321</span></span><br><span class="line">    <span class="attr">resource:</span></span><br><span class="line">    	<span class="comment">#å› ä¸ºèµ„æºæœåŠ¡å™¨å¾—éªŒè¯ä½ çš„Tokenæ˜¯å¦æœ‰è®¿é—®æ­¤èµ„æºçš„æƒé™ä»¥åŠç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥åªéœ€è¦ä¸€ä¸ªéªŒè¯åœ°å€</span></span><br><span class="line">      <span class="attr">token-info-uri:</span> <span class="string">http://localhost:8500/sso/oauth/check_token</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å¯åŠ¨æœåŠ¡å™¨ï¼Œç›´æ¥è®¿é—®ä¼šå‘ç°ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15iekw720j21mw0b0mz5.jpg" alt="image-20220411090932561"></p>
<p>è¿™æ˜¯ç”±äºæˆ‘ä»¬çš„è¯·æ±‚å¤´ä¸­æ²¡æœ‰æºå¸¦Tokenä¿¡æ¯ï¼Œç°åœ¨æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è®¿é—®æ­¤èµ„æºï¼š</p>
<ul>
<li>åœ¨URLåé¢æ·»åŠ <code>access_token</code>è¯·æ±‚å‚æ•°ï¼Œå€¼ä¸ºTokenå€¼</li>
<li>åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ <code>Authorization</code>ï¼Œå€¼ä¸º<code>Bearer +Tokenå€¼</code></li>
</ul>
<p>æˆ‘ä»¬å…ˆæ¥è¯•è¯•çœ‹æœ€ç®€çš„ä¸€ç§ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15ii54emij2176066wfi.jpg" alt="image-20220411091259795"></p>
<p>å¦ä¸€ç§æˆ‘ä»¬éœ€è¦ä½¿ç”¨Postmanæ¥å®Œæˆï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15ikgy886j21c60ikjty.jpg" alt="image-20220411091514501"></p>
<p>æ·»åŠ éªŒè¯ä¿¡æ¯åï¼Œä¼šå¸®åŠ©æˆ‘ä»¬è½¬æ¢æˆè¯·æ±‚å¤´ä¿¡æ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15im8lcwuj21b008cwfo.jpg" alt="image-20220411091655947"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15imovn8jj216m056aaa.jpg" alt="image-20220411091722652"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±å°†èµ„æºæœåŠ¡å™¨æ­å»ºå®Œæˆäº†ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ¥çœ‹å¦‚ä½•å¯¹èµ„æºæœåŠ¡å™¨è¿›è¡Œæ·±åº¦è‡ªå®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…¶ç¼–å†™ä¸€ä¸ªé…ç½®ç±»ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å¸Œæœ›ç”¨æˆ·æˆæƒäº†æŸä¸ªScopeæ‰å¯ä»¥è®¿é—®æ­¤æœåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourceConfiguration</span> <span class="keyword">extends</span> <span class="title class_">ResourceServerConfigurerAdapter</span> &#123; <span class="comment">//ç»§æ‰¿æ­¤ç±»è¿›è¡Œé«˜åº¦è‡ªå®šä¹‰</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;  <span class="comment">//è¿™é‡Œä¹Ÿæœ‰HttpSecurityå¯¹è±¡ï¼Œæ–¹ä¾¿æˆ‘ä»¬é…ç½®SpringSecurity</span></span><br><span class="line">        http</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .anyRequest().access(<span class="string">&quot;#oauth2.hasScope(&#x27;lbwnb&#x27;)&quot;</span>);  <span class="comment">//æ·»åŠ è‡ªå®šä¹‰è§„åˆ™</span></span><br><span class="line">      					<span class="comment">//Tokenå¿…é¡»è¦æœ‰æˆ‘ä»¬è‡ªå®šä¹‰scopeæˆæƒæ‰å¯ä»¥è®¿é—®æ­¤èµ„æº</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å½“æ²¡æœ‰å¯¹åº”çš„scopeæˆæƒæ—¶ï¼Œé‚£ä¹ˆä¼šç›´æ¥è¿”å›<code>insufficient_scope</code>é”™è¯¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15iynrm44j21d00acjth.jpg" alt="image-20220411092852367"></p>
<p>ä¸çŸ¥é“å„ä½æ˜¯å¦æœ‰å‘ç°ï¼Œå®é™…ä¸Šèµ„æºæœåŠ¡å™¨å®Œå…¨æ²¡æœ‰å¿…è¦å°†Securityçš„ä¿¡æ¯ä¿å­˜åœ¨Sessionä¸­äº†ï¼Œå› ä¸ºç°åœ¨åªéœ€è¦å°†Tokenå‘Šè¯‰èµ„æºæœåŠ¡å™¨ï¼Œé‚£ä¹ˆèµ„æºæœåŠ¡å™¨å°±å¯ä»¥è”ç³»éªŒè¯æœåŠ¡å™¨ï¼Œå¾—åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°±ä¸éœ€è¦ä½¿ç”¨ä¹‹å‰çš„Sessionå­˜å‚¨æœºåˆ¶äº†ï¼Œæ‰€ä»¥ä½ ä¼šå‘ç°HttpSessionä¸­æ²¡æœ‰<strong>SPRING_SECURITY_CONTEXT</strong>ï¼Œç°åœ¨Securityä¿¡æ¯éƒ½æ˜¯é€šè¿‡è¿æ¥èµ„æºæœåŠ¡å™¨è·å–ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬å°†æ‰€æœ‰çš„æœåŠ¡éƒ½</p>
<p>ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨RestTemplateè¿›è¡ŒæœåŠ¡é—´çš„è¿œç¨‹è°ƒç”¨æ—¶ï¼Œä¼šå¾—åˆ°ä»¥ä¸‹é”™è¯¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15nbvmhyqj21zo070n12.jpg" alt="image-20220411115958560"></p>
<p>å®é™…ä¸Šè¿™æ˜¯å› ä¸ºåœ¨æœåŠ¡è°ƒç”¨æ—¶æ²¡æœ‰æºå¸¦Tokenä¿¡æ¯ï¼Œæˆ‘ä»¬å¾—æƒ³ä¸ªåŠæ³•æŠŠç”¨æˆ·ä¼ æ¥çš„Tokenä¿¡æ¯åœ¨è¿›è¡Œè¿œç¨‹è°ƒç”¨æ—¶ä¹Ÿæºå¸¦ä¸Šï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨OAuth2RestTemplateï¼Œå®ƒä¼šåœ¨è¯·æ±‚å…¶ä»–æœåŠ¡æ—¶æºå¸¦å½“å‰è¯·æ±‚çš„Tokenä¿¡æ¯ã€‚å®ƒç»§æ‰¿è‡ªRestTemplateï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥å®šä¹‰ä¸€ä¸ªBeanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OAuth2ClientContext context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OAuth2RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OAuth2RestTemplate</span>(<span class="keyword">new</span> <span class="title class_">ClientCredentialsResourceDetails</span>(), context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬ç›´æ¥æ›¿æ¢æ‰ä¹‹å‰çš„RestTemplateå³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BorrowService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OAuth2RestTemplate template;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getUserBorrowDetailByUid</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrow = mapper.getBorrowsByUid(uid);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> template.getForObject(<span class="string">&quot;http://localhost:8101/user/&quot;</span>+uid, User.class);</span><br><span class="line">        <span class="comment">//è·å–æ¯ä¸€æœ¬ä¹¦çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">        List&lt;Book&gt; bookList = borrow</span><br><span class="line">                .stream()</span><br><span class="line">                .map(b -&gt; template.getForObject(<span class="string">&quot;http://localhost:8201/book/&quot;</span>+b.getBid(), Book.class))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(user, bookList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æœåŠ¡æˆåŠŸè°ƒç”¨äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15omvqe0nj21im06emyf.jpg" alt="image-20220411124509007"></p>
<p>ç°åœ¨æˆ‘ä»¬æ¥å°†NacosåŠ å…¥ï¼Œå¹¶é€šè¿‡Feignå®ç°è¿œç¨‹è°ƒç”¨ã€‚</p>
<p>ä¾èµ–è¿˜æ˜¯è´´ä¸€ä¸‹ï¼Œä¸ç„¶æ‰¾ä¸åˆ°ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ‰€æœ‰æœåŠ¡éƒ½å·²ç»æ³¨å†ŒæˆåŠŸäº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15pvei9c9j220w0cgdia.jpg" alt="image-20220411132756540"></p>
<p>æ¥ç€æˆ‘ä»¬é…ç½®ä¸€ä¸‹å€Ÿé˜…æœåŠ¡çš„è´Ÿè½½å‡è¡¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    OAuth2ClientContext context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@LoadBalanced</span>   <span class="comment">//å’ŒRestTemplateä¸€æ ·ç›´æ¥æ·»åŠ æ³¨è§£å°±è¡Œäº†</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OAuth2RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OAuth2RestTemplate</span>(<span class="keyword">new</span> <span class="title class_">ClientCredentialsResourceDetails</span>(), context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15q67k904j21ho06a75k.jpg" alt="image-20220411133819847"></p>
<p>ç°åœ¨æˆ‘ä»¬æ¥æŠŠå®ƒæ›¿æ¢ä¸ºFeignï¼Œè€æ ·å­ï¼Œä¸¤ä¸ªå®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;user-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/&#123;uid&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;book-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/&#123;bid&#125;&quot;)</span></span><br><span class="line">    Book <span class="title function_">getBookById</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> bid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯é…ç½®å®Œæˆä¹‹åï¼Œåˆå‡ºç°åˆšåˆšçš„é—®é¢˜äº†ï¼ŒOpenFeignä¹Ÿæ²¡æœ‰æºå¸¦Tokenè¿›è¡Œè®¿é—®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15qotlr59j21zq06s77b.jpg" alt="image-20220411135612728"></p>
<p>é‚£ä¹ˆæ€ä¹ˆé…ç½®Feignæºå¸¦Tokenè®¿é—®å‘¢ï¼Ÿé‡åˆ°è¿™ç§é—®é¢˜ç›´æ¥å»å®˜æ–¹æŸ¥ï¼š<a href="https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/#oauth2-support%EF%BC%8C%E9%9D%9E%E5%B8%B8%E7%AE%80%E5%8D%95%EF%BC%8C%E4%B8%A4%E4%B8%AA%E9%85%8D%E7%BD%AE%E5%B0%B1%E6%90%9E%E5%AE%9A%EF%BC%9A">https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/#oauth2-supportï¼Œéå¸¸ç®€å•ï¼Œä¸¤ä¸ªé…ç½®å°±æå®šï¼š</a></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">oauth2:</span></span><br><span class="line">  	<span class="comment">#å¼€å¯Oauthæ”¯æŒï¼Œè¿™æ ·å°±ä¼šåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦Tokenäº†</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#åŒæ—¶å¼€å¯è´Ÿè½½å‡è¡¡æ”¯æŒ</span></span><br><span class="line">    <span class="attr">load-balanced:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>é‡å¯æœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°ç»“æœOKäº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h15rupqldmj21ko07kmyl.jpg" alt="image-20220411143628451"></p>
<p>è¿™æ ·æˆ‘ä»¬å°±æˆåŠŸå°†ä¹‹å‰çš„ä¸‰ä¸ªæœåŠ¡ä½œä¸ºèµ„æºæœåŠ¡å™¨äº†ï¼Œæ³¨æ„å’Œæˆ‘ä»¬ä¸Šé¢çš„ä½œä¸ºå®¢æˆ·ç«¯æ˜¯ä¸åŒçš„ï¼Œå°†æœåŠ¡ç›´æ¥ä½œä¸ºå®¢æˆ·ç«¯ç›¸å½“äºåªéœ€è¦éªŒè¯é€šè¿‡å³å¯ï¼Œå¹¶ä¸”è¿˜æ˜¯è¦ä¿å­˜Sessionä¿¡æ¯ï¼Œç›¸å½“äºåªæ˜¯å°†ç™»å½•æµç¨‹æ¢åˆ°ç»Ÿä¸€çš„éªŒè¯æœåŠ¡å™¨ä¸Šè¿›è¡Œç½¢äº†ã€‚è€Œå°†å…¶ä½œä¸ºèµ„æºæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦å¦å¤–æ‰¾å®¢æˆ·ç«¯ï¼ˆå¯ä»¥æ˜¯æµè§ˆå™¨ã€å°ç¨‹åºã€Appã€ç¬¬ä¸‰æ–¹æœåŠ¡ç­‰ï¼‰æ¥è®¿é—®ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯éœ€è¦å…ˆè¿›è¡ŒéªŒè¯ç„¶åå†é€šè¿‡æºå¸¦Tokenè¿›è¡Œè®¿é—®ï¼Œè¿™ç§æ¨¡å¼æ˜¯æˆ‘ä»¬æ¯”è¾ƒå¸¸è§çš„æ¨¡å¼ã€‚</p>
<h3 id="ä½¿ç”¨jwtå­˜å‚¨Token"><a href="#ä½¿ç”¨jwtå­˜å‚¨Token" class="headerlink" title="ä½¿ç”¨jwtå­˜å‚¨Token"></a>ä½¿ç”¨jwtå­˜å‚¨Token</h3><p>å®˜ç½‘ï¼š<a href="https://jwt.io/">https://jwt.io</a></p>
<p>JSON Web Tokenä»¤ç‰Œï¼ˆJWTï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†ï¼ˆ<a href="https://tools.ietf.org/html/rfc7519">RFC 7519</a>ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘å’Œè‡ªæˆä¸€ä½“çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä½œä¸ºJSONå¯¹è±¡å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯æ•°å­—ç­¾åçš„ã€‚JWTå¯ä»¥ä½¿ç”¨å¯†é’¥ï¼ˆä½¿ç”¨<strong>HMAC</strong>ç®—æ³•ï¼‰æˆ–ä½¿ç”¨<strong>RSA</strong>æˆ–<strong>ECDSA</strong>è¿›è¡Œå…¬é’¥/ç§é’¥å¯¹è¿›è¡Œç­¾åã€‚</p>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¹‹å‰éƒ½æ˜¯æºå¸¦Tokenå‘èµ„æºæœåŠ¡å™¨å‘èµ·è¯·æ±‚åï¼Œèµ„æºæœåŠ¡å™¨ç”±äºä¸çŸ¥é“æˆ‘ä»¬Tokençš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦å‘éªŒè¯æœåŠ¡å™¨è¯¢é—®æ­¤Tokençš„è®¤è¯ä¿¡æ¯ï¼Œè¿™æ ·æ‰èƒ½å¾—åˆ°Tokenä»£è¡¨çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä½†æ˜¯å„ä½æ˜¯å¦è€ƒè™‘è¿‡ï¼Œå¦‚æœæ¯æ¬¡ç”¨æˆ·è¯·æ±‚éƒ½å»æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£ä¹ˆåœ¨å¤§é‡è¯·æ±‚ä¸‹ï¼ŒéªŒè¯æœåŠ¡å™¨çš„å‹åŠ›å¯èƒ½ä¼šéå¸¸çš„å¤§ã€‚è€Œä½¿ç”¨JWTä¹‹åï¼ŒTokenä¸­ä¼šç›´æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™æ ·èµ„æºæœåŠ¡å™¨å°±ä¸å†éœ€è¦è¯¢é—®éªŒè¯æœåŠ¡å™¨ï¼Œè‡ªè¡Œå°±å¯ä»¥å®Œæˆè§£æï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¸è”ç³»éªŒè¯æœåŠ¡å™¨å°±èƒ½ç›´æ¥å®ŒæˆéªŒè¯ã€‚</p>
<p>JWTä»¤ç‰Œçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h16n64387aj22b10u0wjb.jpg" alt="image-20220412083957167"></p>
<p>ä¸€ä¸ªJWTä»¤ç‰Œç”±3éƒ¨åˆ†ç»„æˆï¼šæ ‡å¤´(Header)ã€æœ‰æ•ˆè½½è·(Payload)å’Œç­¾å(Signature)ã€‚åœ¨ä¼ è¾“çš„æ—¶å€™ï¼Œä¼šå°†JWTçš„3éƒ¨åˆ†åˆ†åˆ«è¿›è¡ŒBase64ç¼–ç åç”¨<code>.</code>è¿›è¡Œè¿æ¥å½¢æˆæœ€ç»ˆéœ€è¦ä¼ è¾“çš„å­—ç¬¦ä¸²ã€‚</p>
<ul>
<li>æ ‡å¤´ï¼šåŒ…å«ä¸€äº›å…ƒæ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚JWTç­¾åæ‰€ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼Œè¿˜æœ‰ç±»å‹ï¼Œè¿™é‡Œç»Ÿä¸€éƒ½æ˜¯JWTã€‚</li>
<li>æœ‰æ•ˆè½½è·ï¼šåŒ…æ‹¬ç”¨æˆ·åç§°ã€ä»¤ç‰Œå‘å¸ƒæ—¶é—´ã€è¿‡æœŸæ—¶é—´ã€JWT IDç­‰ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ·»åŠ å­—æ®µï¼Œæˆ‘ä»¬çš„ç”¨æˆ·ä¿¡æ¯ä¸€èˆ¬éƒ½åœ¨è¿™é‡Œå­˜æ”¾ã€‚</li>
<li>ç­¾åï¼šé¦–å…ˆéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†é’¥ï¼Œè¯¥å¯†é’¥ä»…ä»…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œä¿è¯ä¸èƒ½è®©å…¶ä»–ç”¨æˆ·çŸ¥é“ã€‚ç„¶åä½¿ç”¨Headerä¸­æŒ‡å®šçš„ç®—æ³•å¯¹Headerå’ŒPayloadè¿›è¡Œbase64åŠ å¯†ä¹‹åçš„ç»“æœé€šè¿‡å¯†é’¥è®¡ç®—å“ˆå¸Œå€¼ï¼Œç„¶åå°±å¾—å‡ºä¸€ä¸ªç­¾åå“ˆå¸Œã€‚è¿™ä¸ªä¼šç”¨äºä¹‹åéªŒè¯å†…å®¹æ˜¯å¦è¢«ç¯¡æ”¹ã€‚</li>
</ul>
<p>è¿™é‡Œè¿˜æ˜¯è¡¥å……ä¸€ä¸‹ä¸€äº›æ¦‚å¿µï¼Œå› ä¸ºå¾ˆå¤šä¸œè¥¿éƒ½æ˜¯æˆ‘ä»¬ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡çš„ï¼š</p>
<ul>
<li><p><strong>Base64ï¼š</strong>å°±æ˜¯åŒ…æ‹¬å°å†™å­—æ¯a-zã€å¤§å†™å­—æ¯A-Zã€æ•°å­—0-9ã€ç¬¦å·â€+â€ã€â€/â€œä¸€å…±64ä¸ªå­—ç¬¦çš„å­—ç¬¦é›†ï¼ˆæœ«å°¾è¿˜æœ‰1ä¸ªæˆ–å¤šä¸ª<code>=</code>ç”¨æ¥å‡‘å¤Ÿå­—èŠ‚æ•°ï¼‰ï¼Œä»»ä½•çš„ç¬¦å·éƒ½å¯ä»¥è½¬æ¢æˆè¿™ä¸ªå­—ç¬¦é›†ä¸­çš„å­—ç¬¦ï¼Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹å°±å«åšBase64ç¼–ç ï¼Œç¼–ç ä¹‹åä¼šç”ŸæˆåªåŒ…å«ä¸Šè¿°64ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚ç›¸åï¼Œå¦‚æœéœ€è¦åŸæœ¬çš„å†…å®¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡ŒBase64è§£ç ï¼Œå›åˆ°åŸæœ‰çš„æ ·å­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;ä½ ä»¬å¯èƒ½ä¸çŸ¥é“åªç”¨20ä¸‡èµ¢åˆ°578ä¸‡æ˜¯ä»€ä¹ˆæ¦‚å¿µ&quot;</span>;</span><br><span class="line">  	<span class="comment">//Base64ä¸åªæ˜¯å¯ä»¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼–ç ï¼Œä»»ä½•byte[]æ•°æ®éƒ½å¯ä»¥ï¼Œç¼–ç ç»“æœå¯ä»¥æ˜¯byte[]ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">encodeStr</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(str.getBytes());</span><br><span class="line">    System.out.println(<span class="string">&quot;Base64ç¼–ç åçš„å­—ç¬¦ä¸²ï¼š&quot;</span>+encodeStr);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;è§£ç åçš„å­—ç¬¦ä¸²ï¼š&quot;</span>+<span class="keyword">new</span> <span class="title class_">String</span>(Base64.getDecoder().decode(encodeStr)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„Base64ä¸æ˜¯åŠ å¯†ç®—æ³•ï¼Œåªæ˜¯ä¸€ç§ä¿¡æ¯çš„ç¼–ç æ–¹å¼è€Œå·²ã€‚</p>
</li>
<li><p><strong>åŠ å¯†ç®—æ³•ï¼š</strong>åŠ å¯†ç®—æ³•åˆ†ä¸ºå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ï¼Œå…¶ä¸­<strong>å¯¹ç§°åŠ å¯†ï¼ˆSymmetric Cryptographyï¼‰</strong>æ¯”è¾ƒå¥½ç†è§£ï¼Œå°±åƒä¸€æŠŠé”é…äº†ä¸¤æŠŠé’¥åŒ™ä¸€æ ·ï¼Œè¿™ä¸¤æŠŠé’¥åŒ™ä½ å’Œåˆ«äººéƒ½æœ‰ä¸€æŠŠï¼Œç„¶åä½ ä»¬ç›´æ¥ä¼ é€’æ•°æ®ï¼Œéƒ½ä¼šæŠŠæ•°æ®ç”¨é”ç»™é”ä¸Šï¼Œå°±ç®—ä¼ é€’çš„é€”ä¸­æœ‰äººæŠŠæ•°æ®çªƒå–äº†ï¼Œä¹Ÿæ²¡åŠæ³•è§£å¯†ï¼Œå› ä¸ºé’¥åŒ™åªæœ‰ä½ å’Œå¯¹æ–¹æœ‰ï¼Œæ²¡æœ‰é’¥åŒ™æ— æ³•è¿›è¡Œè§£å¯†ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶è§£å¯†çš„å…³é”®åœ¨äºé’¥åŒ™æœ¬èº«ï¼Œé‚£ä¹ˆå¦‚æœæœ‰äººä¸ä»…çªƒå–äº†æ•°æ®ï¼Œè€Œä¸”å¯¹æ–¹é‚£è¾¹çš„æ²»å®‰ä¹Ÿä¸å¥½ï¼Œäºæ˜¯é¡ºæ‰‹å°±å·èµ°äº†é’¥åŒ™ï¼Œé‚£ä½ ä»¬ä¹‹é—´å‘çš„æ•°æ®ä¸å°±å‡‰å‡‰äº†å—ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>éå¯¹ç§°åŠ å¯†ï¼ˆAsymmetric Cryptographyï¼‰</strong>ç®—æ³•å‡ºç°äº†ï¼Œå®ƒå¹¶ä¸æ˜¯ç›´æ¥ç”Ÿæˆä¸€æŠŠé’¥åŒ™ï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªå…¬é’¥å’Œä¸€ä¸ªç§é’¥ï¼Œç§é’¥åªèƒ½ç”±ä½ ä¿ç®¡ï¼Œè€Œå…¬é’¥äº¤ç»™å¯¹æ–¹æˆ–æ˜¯ä½ è¦å‘é€çš„ä»»ä½•äººéƒ½è¡Œï¼Œç°åœ¨ä½ éœ€è¦æŠŠæ•°æ®ä¼ ç»™å¯¹æ–¹ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ç§é’¥è¿›è¡ŒåŠ å¯†ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªæ•°æ®åªèƒ½ä½¿ç”¨å¯¹åº”çš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œç›¸åï¼Œå¦‚æœå¯¹æ–¹éœ€è¦ç»™ä½ å‘é€æ•°æ®ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œè€Œæ•°æ®åªèƒ½ä½¿ç”¨ç§é’¥è¿›è¡Œè§£å¯†ï¼Œè¿™æ ·çš„è¯å°±ç®—å¯¹æ–¹çš„å…¬é’¥è¢«çªƒå–ï¼Œé‚£ä¹ˆåˆ«äººå‘ç»™ä½ çš„æ•°æ®ä¹Ÿæ²¡åŠæ³•è§£å¯†å‡ºæ¥ï¼Œå› ä¸ºéœ€è¦ç§é’¥æ‰èƒ½è§£å¯†ï¼Œè€Œåªæœ‰ä½ æ‰æœ‰ç§é’¥ã€‚</p>
<p>å› æ­¤ï¼Œéå¯¹ç§°åŠ å¯†çš„å®‰å…¨æ€§ä¼šæ›´é«˜ä¸€äº›ï¼ŒåŒ…æ‹¬HTTPSçš„éšç§ä¿¡æ¯æ­£æ˜¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†æ¥ä¿éšœä¼ è¾“æ•°æ®çš„å®‰å…¨ï¼ˆå½“ç„¶HTTPSå¹¶ä¸æ˜¯å•çº¯åœ°ä½¿ç”¨éå¯¹ç§°åŠ å¯†å®Œæˆçš„ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»äº†è§£ä¸€ä¸‹ï¼‰</p>
<p>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†éƒ½æœ‰å¾ˆå¤šçš„ç®—æ³•ï¼Œæ¯”å¦‚å¯¹ç§°åŠ å¯†ï¼Œå°±æœ‰ï¼šDESã€IDEAã€RC2ï¼Œéå¯¹ç§°åŠ å¯†æœ‰ï¼šRSAã€DASã€ECC</p>
</li>
<li><p><strong>ä¸å¯é€†åŠ å¯†ç®—æ³•ï¼š</strong>å¸¸è§çš„ä¸å¯é€†åŠ å¯†ç®—æ³•æœ‰MD5, HMAC, SHA-1, SHA-224, SHA-256, SHA-384, å’ŒSHA-512, å…¶ä¸­SHA-224ã€SHA-256ã€SHA-384ï¼Œå’ŒSHA-512æˆ‘ä»¬å¯ä»¥ç»Ÿç§°ä¸ºSHA2åŠ å¯†ç®—æ³•ï¼ŒSHAåŠ å¯†ç®—æ³•çš„å®‰å…¨æ€§è¦æ¯”MD5æ›´é«˜ï¼Œè€ŒSHA2åŠ å¯†ç®—æ³•æ¯”SHA1çš„è¦é«˜ï¼Œå…¶ä¸­SHAåé¢çš„æ•°å­—è¡¨ç¤ºçš„æ˜¯åŠ å¯†åçš„å­—ç¬¦ä¸²é•¿åº¦ï¼ŒSHA1é»˜è®¤ä¼šäº§ç”Ÿä¸€ä¸ª160ä½çš„ä¿¡æ¯æ‘˜è¦ã€‚ç»è¿‡ä¸å¯é€†åŠ å¯†ç®—æ³•å¾—åˆ°çš„åŠ å¯†ç»“æœï¼Œæ˜¯æ— æ³•è§£å¯†å›å»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åŠ å¯†å‡ºæ¥æ˜¯ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆäº†ã€‚æœ¬è´¨ä¸Šï¼Œå…¶å°±æ˜¯ä¸€ç§å“ˆå¸Œå‡½æ•°ï¼Œç”¨äºå¯¹ä¸€æ®µä¿¡æ¯äº§ç”Ÿæ‘˜è¦ï¼Œä»¥<strong>é˜²æ­¢è¢«ç¯¡æ”¹</strong>ã€‚</p>
<p>å®é™…ä¸Šè¿™ç§ç®—æ³•å°±å¸¸å¸¸è¢«ç”¨ä½œä¿¡æ¯æ‘˜è¦è®¡ç®—ï¼ŒåŒæ ·çš„æ•°æ®é€šè¿‡åŒæ ·çš„ç®—æ³•è®¡ç®—å¾—åˆ°çš„ç»“æœè‚¯å®šä¹Ÿä¸€æ ·ï¼Œè€Œå¦‚æœæ•°æ®è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆè®¡ç®—çš„ç»“æœè‚¯å®šå°±ä¸ä¸€æ ·äº†ã€‚</p>
</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨jwtï¼Œå°†æˆ‘ä»¬çš„Tokené‡‡ç”¨æ–°çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h16s4h08b9j21ku0dumz4.jpg" alt="image-20220412113124880"></p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœ€ç®€å•çš„ä¸€ç§æ–¹å¼ï¼Œå¯¹ç§°å¯†é’¥ï¼Œæˆ‘ä»¬éœ€è¦å¯¹éªŒè¯æœåŠ¡å™¨è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> JwtAccessTokenConverter <span class="title function_">tokenConverter</span><span class="params">()</span>&#123;  <span class="comment">//Tokenè½¬æ¢å™¨ï¼Œå°†å…¶è½¬æ¢ä¸ºJWT</span></span><br><span class="line">    <span class="type">JwtAccessTokenConverter</span> <span class="variable">converter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JwtAccessTokenConverter</span>();</span><br><span class="line">    converter.setSigningKey(<span class="string">&quot;lbwnb&quot;</span>);   <span class="comment">//è¿™ä¸ªæ˜¯å¯¹ç§°å¯†é’¥ï¼Œä¸€ä¼šèµ„æºæœåŠ¡å™¨é‚£è¾¹ä¹Ÿè¦æŒ‡å®šä¸ºè¿™ä¸ª</span></span><br><span class="line">    <span class="keyword">return</span> converter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> TokenStore <span class="title function_">tokenStore</span><span class="params">(JwtAccessTokenConverter converter)</span>&#123;  <span class="comment">//Tokenå­˜å‚¨æ–¹å¼ç°åœ¨æ”¹ä¸ºJWTå­˜å‚¨</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JwtTokenStore</span>(converter);  <span class="comment">//ä¼ å…¥åˆšåˆšå®šä¹‰å¥½çš„è½¬æ¢å™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line">TokenStore store;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line">JwtAccessTokenConverter converter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> AuthorizationServerTokenServices <span class="title function_">serverTokenServices</span><span class="params">()</span>&#123;  <span class="comment">//è¿™é‡Œå¯¹AuthorizationServerTokenServicesè¿›è¡Œä¸€ä¸‹é…ç½®</span></span><br><span class="line">    <span class="type">DefaultTokenServices</span> <span class="variable">services</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultTokenServices</span>();</span><br><span class="line">    services.setSupportRefreshToken(<span class="literal">true</span>);   <span class="comment">//å…è®¸Tokenåˆ·æ–°</span></span><br><span class="line">    services.setTokenStore(store);   <span class="comment">//æ·»åŠ åˆšåˆšçš„TokenStore</span></span><br><span class="line">    services.setTokenEnhancer(converter);   <span class="comment">//æ·»åŠ Tokenå¢å¼ºï¼Œå…¶å®å°±æ˜¯JwtAccessTokenConverterï¼Œå¢å¼ºæ˜¯æ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„æ•°æ®åˆ°JWTä¸­</span></span><br><span class="line">    <span class="keyword">return</span> services;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthorizationServerEndpointsConfigurer endpoints)</span> &#123;</span><br><span class="line">    endpoints</span><br><span class="line">            .tokenServices(serverTokenServices())   <span class="comment">//è®¾å®šä¸ºåˆšåˆšé…ç½®å¥½çš„AuthorizationServerTokenServices</span></span><br><span class="line">            .userDetailsService(service)</span><br><span class="line">            .authenticationManager(manager);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥é‡å¯éªŒè¯æœåŠ¡å™¨äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h16sxi8zk7j21c20dkdjy.jpg" alt="image-20220412115919019"></p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸè·å–äº†AccessTokenï¼Œä½†æ˜¯è¿™é‡Œçš„æ ¼å¼è·Ÿæˆ‘ä»¬ä¹‹å‰çš„æ ¼å¼å°±å¤§ä¸ç›¸åŒäº†ï¼Œå› ä¸ºç°åœ¨å®ƒæ˜¯JWTä»¤ç‰Œï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œä¸€ä¸‹Base64è§£ç ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h16szvyek8j22om0dsmzi.jpg" alt="image-20220412120136453"></p>
<p>å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„éªŒè¯ä¿¡æ¯åŒ…å«åœ¨å†…ï¼Œç°åœ¨æˆ‘ä»¬å¯¹èµ„æºæœåŠ¡å™¨è¿›è¡Œé…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="attr">oauth2:</span></span><br><span class="line">    <span class="attr">resource:</span></span><br><span class="line">      <span class="attr">jwt:</span></span><br><span class="line">        <span class="attr">key-value:</span> <span class="string">lbwnb</span> <span class="comment">#æ³¨æ„è¿™é‡Œè¦è·ŸéªŒè¯æœåŠ¡å™¨çš„å¯†é’¥ä¸€è‡´ï¼Œè¿™æ ·ç®—å‡ºæ¥çš„ç­¾åæ‰ä¼šä¸€è‡´</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå¯åŠ¨èµ„æºæœåŠ¡å™¨ï¼Œè¯·æ±‚ä¸€ä¸‹æ¥å£è¯•è¯•çœ‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h16t27q8g1j21b60foacd.jpg" alt="image-20220412120350331"></p>
<p>è¯·æ±‚æˆåŠŸï¼Œå¾—åˆ°æ•°æ®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h16t2o2neej21ca08074t.jpg" alt="image-20220412120417005"></p>
<p>æ³¨æ„å¦‚æœTokenæœ‰è¯¯ï¼Œé‚£ä¹ˆä¼šå¾—åˆ°ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h16t33dv9kj215m04uaab.jpg" alt="image-20220412120441794"></p>
<hr>
<h2 id="Redisä¸åˆ†å¸ƒå¼"><a href="#Redisä¸åˆ†å¸ƒå¼" class="headerlink" title="Redisä¸åˆ†å¸ƒå¼"></a>Redisä¸åˆ†å¸ƒå¼</h2><p>åœ¨SpringBooté˜¶æ®µï¼Œæˆ‘ä»¬å­¦ä¹ äº†Redisï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„é«˜æ€§èƒ½æ•°æ®åº“ï¼Œæˆ‘ä»¬å½“æ—¶å·²ç»å­¦ä¹ äº†åŒ…æ‹¬åŸºæœ¬æ“ä½œã€å¸¸ç”¨æ•°æ®ç±»å‹ã€æŒä¹…åŒ–ã€äº‹åŠ¡å’Œé”æœºåˆ¶ä»¥åŠä½¿ç”¨Javaä¸Redisè¿›è¡Œäº¤äº’ç­‰ï¼Œåˆ©ç”¨å®ƒçš„é«˜æ€§èƒ½ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨å®ƒæ¥åšMybatisçš„äºŒçº§ç¼“å­˜ã€ä»¥åŠTokençš„æŒä¹…åŒ–å­˜å‚¨ã€‚è€Œè¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ·±å…¥ï¼Œæ¢è®¨Redisåœ¨åˆ†å¸ƒå¼å¼€å‘åœºæ™¯ä¸‹çš„åº”ç”¨ã€‚</p>
<h3 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h3><p>åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘è®©Rediså®ç°ä¸»ä»æ¨¡å¼ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h170fqh9k0j21ao07gwf9.jpg" alt="image-20220412161901616"></p>
<p>ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(Master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(Slave)ï¼Œæ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚Masterä»¥å†™ä¸ºä¸»ï¼ŒSlave ä»¥è¯»ä¸ºä¸»ã€‚</p>
<p>è¿™æ ·çš„å¥½å¤„è‚¯å®šæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼š</p>
<ul>
<li>å®ç°äº†è¯»å†™åˆ†ç¦»ï¼Œæé«˜äº†æ€§èƒ½ã€‚</li>
<li>åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å®‰æ’å¾ˆå¤šä¸ªä»èŠ‚ç‚¹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿå¤§å¹…åº¦çš„åˆ†æ‹…å‹åŠ›ï¼Œå¹¶ä¸”å°±ç®—æŒ‚æ‰ä¸€ä¸ªï¼Œå…¶ä»–çš„ä¹Ÿèƒ½ä½¿ç”¨ã€‚</li>
</ul>
<p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±æ¥å°è¯•å®ç°ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯åœ¨Windowsä¸‹è¿›è¡Œæµ‹è¯•ï¼Œæ‰“å¼€Redisæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬è¦å¼€å¯ä¸¤ä¸ªRedisæœåŠ¡å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶<code>redis.windows.conf</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Accept connections on the specified port, default is 6379 (IANA #815344).</span><br><span class="line"># If port 0 is specified Redis will not listen on a TCP socket.</span><br><span class="line">port 6001</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªæœåŠ¡å™¨çš„ç«¯å£è®¾å®šä¸º6001ï¼Œå¤åˆ¶ä¸€ä»½ï¼Œå¦ä¸€ä¸ªçš„ç«¯å£ä¸º6002ï¼Œæ¥ç€æˆ‘ä»¬æŒ‡å®šé…ç½®æ–‡ä»¶è¿›è¡Œå¯åŠ¨ï¼Œæ‰“å¼€cmdï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17ycpqc7aj21ho0iytcq.jpg" alt="image-20220413115227344"></p>
<p>ç°åœ¨æˆ‘ä»¬çš„ä¸¤ä¸ªæœåŠ¡å™¨å°±å¯åŠ¨æˆåŠŸäº†ï¼Œæ¥ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å½“å‰æœåŠ¡å™¨çš„ä¸»ä»çŠ¶æ€ï¼Œæˆ‘ä»¬æ‰“å¼€å®¢æˆ·ç«¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17yfaen55j21ge0d6dj4.jpg" alt="image-20220413115458597"></p>
<p>è¾“å…¥<code>info replication</code>å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰çš„ä¸»ä»çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤çš„è§’è‰²ä¸ºï¼šmasterï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„æœåŠ¡å™¨åœ¨å¯åŠ¨ä¹‹åéƒ½æ˜¯ä¸»èŠ‚ç‚¹çš„çŠ¶æ€ã€‚é‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¸Œæœ›è®©6002ä½œä¸ºä»èŠ‚ç‚¹ï¼Œé€šè¿‡ä¸€ä¸ªå‘½ä»¤å³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17yhstlr6j21hk0k078p.jpg" alt="image-20220413115722765"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¾“å…¥<code>replicaof 127.0.0.1 6001</code>å‘½ä»¤åï¼Œå°±ä¼šå°†6001æœåŠ¡å™¨ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œè€Œå½“å‰èŠ‚ç‚¹ä½œä¸º6001çš„ä»èŠ‚ç‚¹ï¼Œå¹¶ä¸”è§’è‰²ä¹Ÿä¼šå˜æˆï¼šslaveï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹6001çš„æƒ…å†µï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17ykiln90j21cq0c4tbw.jpg" alt="image-20220413115959759"></p>
<p>å¯ä»¥çœ‹åˆ°ä»èŠ‚ç‚¹ä¿¡æ¯ä¸­å·²ç»å‡ºç°äº†6002æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨æˆ‘ä»¬çš„6001å’Œ6002å°±å½¢æˆäº†ä¸»ä»å…³ç³»ï¼ˆè¿˜åŒ…å«ä¸€ä¸ªåç§»é‡ï¼Œè¿™ä¸ªåç§»é‡ååº”çš„æ˜¯ä»èŠ‚ç‚¹çš„åŒæ­¥æƒ…å†µï¼‰</p>
<blockquote>
<p>ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡ï¼Œä¸»æœåŠ¡å™¨æ¯æ¬¡å‘ä»æœåŠ¡å™¨ä¸­ä¼ é€’ N ä¸ªå­—èŠ‚çš„æ—¶å€™ï¼Œä¼šå°†è‡ªå·±çš„å¤åˆ¶åç§»é‡åŠ ä¸Š Nã€‚ä»æœåŠ¡å™¨ä¸­æ”¶åˆ°ä¸»æœåŠ¡å™¨çš„ N ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå°±ä¼šå°†è‡ªå·±é¢å¤åˆ¶åç§»é‡åŠ ä¸Š Nï¼Œé€šè¿‡ä¸»ä»æœåŠ¡å™¨çš„åç§»é‡å¯¹æ¯”å¯ä»¥å¾ˆæ¸…æ¥šçš„çŸ¥é“ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®æ˜¯å¦å¤„äºä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±éœ€è¦è¿›è¡Œå¢é‡åŒæ­¥äº†ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å¯ä»¥æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œåœ¨ä¸»èŠ‚ç‚¹æ–°å¢æ•°æ®ï¼Œçœ‹çœ‹æ˜¯å¦ä¼šåŒæ­¥åˆ°ä»èŠ‚ç‚¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17ym5549oj219w06kjs4.jpg" alt="image-20220413120133934"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨6001æœåŠ¡å™¨æ’å…¥çš„<code>a</code>ï¼Œå¯ä»¥åœ¨ä»èŠ‚ç‚¹6002è¯»å–åˆ°ï¼Œé‚£ä¹ˆï¼Œä»èŠ‚ç‚¹æ–°å¢çš„æ•°æ®åœ¨ä¸»èŠ‚ç‚¹èƒ½å¾—åˆ°å—ï¼Ÿæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17yn7gu6zj20xy0323z1.jpg" alt="image-20220413120235138"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä»èŠ‚ç‚¹å‹æ ¹å°±æ²¡åŠæ³•è¿›è¡Œæ•°æ®æ’å…¥ï¼ŒèŠ‚ç‚¹çš„æ¨¡å¼ä¸ºåªè¯»æ¨¡å¼ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ç°åœ¨ä¸æƒ³è®©6002ä½œä¸º6001çš„ä»èŠ‚ç‚¹äº†å‘¢ï¼Ÿ</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17zqijbfmj21bu09s76d.jpg" alt="image-20220413124021549"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡è¾“å…¥<code>replicaof no one</code>ï¼Œå³å¯å˜å›Masterè§’è‰²ã€‚æ¥ç€æˆ‘ä»¬å†æ¥å¯åŠ¨ä¸€å°6003æœåŠ¡å™¨ï¼Œæµç¨‹æ˜¯ä¸€æ ·çš„ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17yypexpij215c062gmg.jpg" alt="image-20220413121338391"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿æ¥ä¹‹åï¼Œä¹Ÿä¼šç›´æ¥åŒæ­¥ä¸»èŠ‚ç‚¹çš„æ•°æ®ï¼Œå› æ­¤æ— è®ºæ˜¯å·²ç»å¤„äºä»èŠ‚ç‚¹çŠ¶æ€è¿˜æ˜¯åˆšåˆšå¯åŠ¨å®Œæˆçš„æœåŠ¡å™¨ï¼Œéƒ½ä¼šä»ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œå®é™…ä¸Šæ•´ä¸ªåŒæ­¥æµç¨‹ä¸ºï¼š</p>
<ol>
<li>ä»èŠ‚ç‚¹æ‰§è¡Œreplicaof ip portå‘½ä»¤åï¼Œä»èŠ‚ç‚¹ä¼šä¿å­˜ä¸»èŠ‚ç‚¹ç›¸å…³çš„åœ°å€ä¿¡æ¯ã€‚</li>
<li>ä»èŠ‚ç‚¹é€šè¿‡æ¯ç§’è¿è¡Œçš„å®šæ—¶ä»»åŠ¡å‘ç°é…ç½®äº†æ–°çš„ä¸»èŠ‚ç‚¹åï¼Œä¼šå°è¯•ä¸è¯¥èŠ‚ç‚¹å»ºç«‹ç½‘ç»œè¿æ¥ï¼Œä¸“é—¨ç”¨äºæ¥æ”¶ä¸»èŠ‚ç‚¹å‘é€çš„å¤åˆ¶å‘½ä»¤ã€‚</li>
<li>è¿æ¥æˆåŠŸåï¼Œç¬¬ä¸€æ¬¡ä¼šå°†ä¸»èŠ‚ç‚¹çš„æ•°æ®è¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œä¹‹åé‡‡ç”¨å¢é‡å¤åˆ¶ï¼ŒæŒç»­å°†æ–°æ¥çš„å†™å‘½ä»¤åŒæ­¥ç»™ä»èŠ‚ç‚¹ã€‚</li>
</ol>
<p>å½“æˆ‘ä»¬çš„ä¸»èŠ‚ç‚¹å…³é—­åï¼Œä»èŠ‚ç‚¹ä¾ç„¶å¯ä»¥è¯»å–æ•°æ®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17z9oo7bdj21ce0majw5.jpg" alt="image-20220413122411006"></p>
<p>ä½†æ˜¯ä»èŠ‚ç‚¹ä¼šç–¯ç‹‚æŠ¥é”™ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17zb0v187j21he032myo.jpg" alt="image-20220413122528096"></p>
<p>å½“ç„¶æ¯æ¬¡éƒ½å»æ•²ä¸ªå‘½ä»¤é…ç½®ä¸»ä»å¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œæ·»åŠ è¿™æ ·è¡Œå³å¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">replicaof 127.0.0.1 6001</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬ç»™6002å’Œ6003æœåŠ¡å™¨éƒ½é…ç½®ä¸€ä¸‹ï¼Œç°åœ¨æˆ‘ä»¬é‡å¯ä¸‰ä¸ªæœåŠ¡å™¨ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17zehyh4pj21hg0d6gu1.jpg" alt="image-20220413122848685"></p>
<p>å½“ç„¶ï¼Œé™¤äº†ä½œä¸ºMasterèŠ‚ç‚¹çš„ä»èŠ‚ç‚¹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†å…¶ä½œä¸ºä»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬è®©6003ä½œä¸º6002çš„ä»èŠ‚ç‚¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17zgkb251j216e09mq4n.jpg" alt="image-20220413123047711"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç°åœ¨å·®ä¸å¤šæ˜¯è¿™æ ·çš„çš„ä¸€ä¸ªæƒ…å†µï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h17zm1h2wpj21ja0ikjv0.jpg" alt="image-20220413123603650"></p>
<p>é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œä¼˜ç‚¹è‚¯å®šæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ•´ä¸ªä¼ æ’­é“¾è·¯ä¸€æ—¦ä¸­é€”å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åé¢çš„ä»èŠ‚ç‚¹æ— æ³•åŠæ—¶åŒæ­¥ã€‚</p>
<h3 id="å“¨å…µæ¨¡å¼"><a href="#å“¨å…µæ¨¡å¼" class="headerlink" title="å“¨å…µæ¨¡å¼"></a>å“¨å…µæ¨¡å¼</h3><p>å‰é¢æˆ‘ä»¬è®²è§£äº†Rediså®ç°ä¸»ä»å¤åˆ¶çš„ä¸€äº›åŸºæœ¬æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ç€æ¥çœ‹å“¨å…µæ¨¡å¼ã€‚</p>
<p>ç»è¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå®é™…ä¸Šæœ€å…³é”®çš„è¿˜æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå› ä¸ºä¸€æ—¦ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆæ•´ä¸ªä¸»ä»ç³»ç»Ÿå°†æ— æ³•å†™å…¥ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¾—æƒ³ä¸€ä¸ªåŠæ³•ï¼Œå¤„ç†ä¸€ä¸‹ä¸»èŠ‚ç‚¹æ•…éšœçš„æƒ…å†µã€‚å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å‚è€ƒä¹‹å‰çš„æœåŠ¡æ²»ç†æ¨¡å¼ï¼Œæ¯”å¦‚Nacoså’ŒEurekaï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½ä¼šè¢«å®æ—¶ç›‘æ§ï¼Œé‚£ä¹ˆåªè¦å‡ºç°é—®é¢˜ï¼Œè‚¯å®šæ˜¯å¯ä»¥åŠæ—¶å‘ç°çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿé‡‡å–å“åº”çš„è¡¥æ•‘æªæ–½ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å³å°†ä»‹ç»çš„å“¨å…µï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h184yisdi6j218i0dk405.jpg" alt="image-20220413154102800"></p>
<p>æ³¨æ„è¿™é‡Œçš„å“¨å…µä¸æ˜¯æˆ‘ä»¬ä¹‹å‰å­¦ä¹ SpringCloud Alibabaçš„é‚£ä¸ªï¼Œæ˜¯ä¸“ç”¨äºRedisçš„ã€‚å“¨å…µä¼šå¯¹æ‰€æœ‰çš„èŠ‚ç‚¹è¿›è¡Œç›‘æ§ï¼Œå¦‚æœå‘ç°ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆä¼šç«‹å³è®©ä»èŠ‚ç‚¹è¿›è¡ŒæŠ•ç¥¨ï¼Œé€‰ä¸¾ä¸€ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹å‡ºæ¥ï¼Œè¿™æ ·å°±ä¸ä¼šç”±äºä¸»èŠ‚ç‚¹çš„æ•…éšœå¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸å¯å†™ï¼ˆæ³¨æ„è¦å®ç°è¿™æ ·çš„åŠŸèƒ½æœ€å°çš„ç³»ç»Ÿå¿…é¡»æ˜¯ä¸€ä¸»ä¸€ä»ï¼Œå†å°çš„è¯å°±æ²¡æœ‰æ„ä¹‰äº†ï¼‰</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h185d16octj21940dawg5.jpg" alt="image-20220413155459399"></p>
<p>é‚£ä¹ˆæ€ä¹ˆå¯åŠ¨ä¸€ä¸ªå“¨å…µå‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶å³å¯ï¼Œè¿™é‡Œç›´æ¥åˆ é™¤å…¨éƒ¨å†…å®¹ï¼Œæ·»åŠ ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sentinel monitor lbwnb 127.0.0.1 6001 1</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªæ˜¯å›ºå®šï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¸ºç›‘æ§å¯¹è±¡åç§°ï¼Œéšæ„ï¼Œåé¢å°±æ˜¯ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬IPåœ°å€å’Œç«¯å£ï¼Œæœ€åä¸€ä¸ª1æˆ‘ä»¬æš‚æ—¶å…ˆä¸è¯´ï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨æ­¤é…ç½®æ–‡ä»¶å¯åŠ¨æœåŠ¡å™¨ï¼Œå¯ä»¥çœ‹åˆ°å¯åŠ¨åï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h185umqg2rj21fg0maq8l.jpg" alt="image-20220413161154185"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h185vv5uuvj217e03u40p.jpg" alt="image-20220413161306103"></p>
<p>å¯ä»¥çœ‹åˆ°ä»¥å“¨å…µæ¨¡å¼å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨ç›‘æ§ä¸»èŠ‚ç‚¹ï¼Œç„¶åè¿˜ä¼šæ˜¾ç¤ºé‚£äº›èŠ‚ç‚¹æ˜¯ä½œä¸ºä»èŠ‚ç‚¹å­˜åœ¨çš„ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬ç›´æ¥æŠŠä¸»èŠ‚ç‚¹å…³é—­ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1860g13toj21hg072n1k.jpg" alt="image-20220413161730035"></p>
<p>å¯ä»¥çœ‹åˆ°ä»èŠ‚ç‚¹è¿˜æ˜¯æ­£å¸¸çš„åœ¨æŠ¥é”™ï¼Œä¸€å¼€å§‹çš„æ—¶å€™ä¸ä¼šç›´æ¥é‡æ–°è¿›è¡Œé€‰ä¸¾è€Œæ˜¯ç»§ç»­å°è¯•é‡è¿ï¼ˆå› ä¸ºæœ‰å¯èƒ½åªæ˜¯ç½‘ç»œå°å¡ä¸€ä¸‹ï¼Œæ²¡å¿…è¦è¿™ä¹ˆæ•æ„Ÿï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´ä¹‹åï¼Œä¾ç„¶æ— æ³•è¿æ¥ï¼Œå“¨å…µè¾“å‡ºäº†ä»¥ä¸‹å†…å®¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1861pyd5uj21gs0jman3.jpg" alt="image-20220413161843439"></p>
<p>å¯ä»¥çœ‹åˆ°å“¨å…µå‘ç°ä¸»èŠ‚ç‚¹å·²ç»æœ‰ä¸€æ®µæ—¶é—´ä¸å¯ç”¨äº†ï¼Œé‚£ä¹ˆå°±ä¼šå¼€å§‹è¿›è¡Œé‡æ–°é€‰ä¸¾ï¼Œ6003èŠ‚ç‚¹è¢«é€‰ä¸ºäº†æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¹‹å‰çš„ä¸»èŠ‚ç‚¹6001å˜æˆäº†æ–°çš„ä¸»èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18665ksokj21hq05sjuu.jpg" alt="image-20220413162259056"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1866crze4j21f207kq5f.jpg" alt="image-20220413162310821"></p>
<p>å½“æˆ‘ä»¬å†æ¬¡å¯åŠ¨6001æ—¶ï¼Œä¼šå‘ç°ï¼Œå®ƒè‡ªåŠ¨å˜æˆäº†6003çš„ä»èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¼šå°†æ•°æ®åŒæ­¥è¿‡æ¥ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h186j4ul8mj21gu09qq8y.jpg" alt="image-20220413163527235"></p>
<p>é‚£ä¹ˆï¼Œè¿™ä¸ªé€‰ä¸¾è§„åˆ™æ˜¯æ€æ ·çš„å‘¢ï¼Ÿæ˜¯åœ¨æ‰€æœ‰çš„ä»èŠ‚ç‚¹ä¸­éšæœºé€‰å–è¿˜æ˜¯éµå¾ªæŸç§è§„åˆ™å‘¢ï¼Ÿ</p>
<ol>
<li>é¦–å…ˆä¼šæ ¹æ®ä¼˜å…ˆçº§è¿›è¡Œé€‰æ‹©ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œæ·»åŠ <code>replica-priority</code>é…ç½®é¡¹ï¼ˆé»˜è®¤æ˜¯100ï¼‰ï¼Œè¶Šå°è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ã€‚</li>
<li>å¦‚æœä¼˜å…ˆçº§ä¸€æ ·ï¼Œé‚£å°±é€‰æ‹©åç§»é‡æœ€å¤§çš„</li>
<li>è¦æ˜¯è¿˜é€‰ä¸å‡ºæ¥ï¼Œé‚£å°±é€‰æ‹©runidï¼ˆå¯åŠ¨æ—¶éšæœºç”Ÿæˆçš„ï¼‰æœ€å°çš„ã€‚</li>
</ol>
<p>è¦æ˜¯å“¨å…µä¹ŸæŒ‚äº†å’‹åŠï¼Ÿæ²¡äº‹ï¼Œå’±ä»¬å¯ä»¥å¤šå®‰æ’å‡ ä¸ªå“¨å…µï¼Œåªéœ€è¦æŠŠå“¨å…µçš„é…ç½®å¤åˆ¶ä¸€ä¸‹ï¼Œç„¶åä¿®æ”¹ç«¯å£ï¼Œè¿™æ ·å°±å¯ä»¥åŒæ—¶å¯åŠ¨å¤šä¸ªå“¨å…µäº†ï¼Œæˆ‘ä»¬å¯åŠ¨3ä¸ªå“¨å…µï¼ˆä¸€ä¸»äºŒä»ä¸‰å“¨å…µï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬å§æœ€åä¸€ä¸ªå€¼æ”¹ä¸º<code>2</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sentinel monitor lbwnb 192.168.0.8 6001 2</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå€¼å®é™…ä¸Šä»£è¡¨çš„æ˜¯å½“æœ‰å‡ ä¸ªå“¨å…µè®¤ä¸ºä¸»èŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œå°±åˆ¤æ–­ä¸»èŠ‚ç‚¹çœŸçš„æŒ‚æ‰äº†</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18csiah4ej21e60b8794.jpg" alt="image-20220413201201051"></p>
<p>ç°åœ¨æˆ‘ä»¬æŠŠ6001èŠ‚ç‚¹æŒ‚æ‰ï¼Œçœ‹çœ‹è¿™ä¸‰ä¸ªå“¨å…µä¼šæ€ä¹ˆæ ·ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18df6teykj21h60fk7d0.jpg" alt="image-20220413203351360"></p>
<p>å¯ä»¥çœ‹åˆ°éƒ½æ˜¾ç¤ºå°†masteråˆ‡æ¢ä¸º6002èŠ‚ç‚¹äº†ã€‚</p>
<p>é‚£ä¹ˆï¼Œåœ¨å“¨å…µé‡æ–°é€‰ä¸¾æ–°çš„ä¸»èŠ‚ç‚¹ä¹‹åï¼Œæˆ‘ä»¬Javaä¸­çš„Redisçš„å®¢æˆ·ç«¯æ€ä¹ˆæ„ŸçŸ¥åˆ°å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œé¦–å…ˆè¿˜æ˜¯å¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨JedisSentinelPoolæ¥è·å–MasterèŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">//éœ€è¦æŠŠä¸‰ä¸ªå“¨å…µçš„åœ°å€éƒ½å¡«å…¥</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">JedisSentinelPool</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisSentinelPool</span>(<span class="string">&quot;lbwnb&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(Arrays.asList(<span class="string">&quot;192.168.0.8:26741&quot;</span>, <span class="string">&quot;192.168.0.8:26740&quot;</span>, <span class="string">&quot;192.168.0.8:26739&quot;</span>)))) &#123;</span><br><span class="line">            <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> pool.getResource();   <span class="comment">//ç›´æ¥è¯¢é—®å¹¶å¾—åˆ°Jediså¯¹è±¡ï¼Œè¿™å°±æ˜¯è¿æ¥çš„MasterèŠ‚ç‚¹</span></span><br><span class="line">            jedis.set(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;114514&quot;</span>);    <span class="comment">//ç›´æ¥å†™å…¥å³å¯ï¼Œå®é™…ä¸Šå°±æ˜¯å‘MasterèŠ‚ç‚¹å†™å…¥</span></span><br><span class="line"></span><br><span class="line">            <span class="type">Jedis</span> <span class="variable">jedis2</span> <span class="operator">=</span> pool.getResource();   <span class="comment">//å†æ¬¡è·å–</span></span><br><span class="line">            System.out.println(jedis2.get(<span class="string">&quot;test&quot;</span>));   <span class="comment">//è¯»å–æ“ä½œ</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼ŒJediså¯¹è±¡å°±å¯ä»¥é€šè¿‡å“¨å…µæ¥è·å–ï¼Œå½“MasterèŠ‚ç‚¹æ›´æ–°åï¼Œä¹Ÿèƒ½å¾—åˆ°æœ€æ–°çš„ã€‚</p>
<h3 id="é›†ç¾¤æ­å»º"><a href="#é›†ç¾¤æ­å»º" class="headerlink" title="é›†ç¾¤æ­å»º"></a>é›†ç¾¤æ­å»º</h3><p>å¦‚æœæˆ‘ä»¬æœåŠ¡å™¨çš„å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬çš„Redisåˆéœ€è¦ç»§ç»­å­˜å‚¨å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åˆ©ç”¨é›†ç¾¤æ¥å®ç°æ‰©å®¹ã€‚</p>
<p>å› ä¸ºå•æœºçš„å†…å­˜å®¹é‡æœ€å¤§å°±é‚£ä¹ˆå¤šï¼Œå·²ç»æ²¡åŠæ³•å†ç»§ç»­æ‰©å±•äº†ï¼Œä½†æ˜¯ç°åœ¨åˆéœ€è¦å­˜å‚¨æ›´å¤šçš„å†…å®¹ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥è®©Nå°æœºå™¨ä¸Šçš„Redisæ¥åˆ†åˆ«å­˜å‚¨å„ä¸ªéƒ¨åˆ†çš„æ•°æ®ï¼ˆæ¯ä¸ªRediså¯ä»¥å­˜å‚¨1/Nçš„æ•°æ®é‡ï¼‰ï¼Œè¿™æ ·å°±å®ç°äº†å®¹é‡çš„æ¨ªå‘æ‰©å±•ã€‚åŒæ—¶æ¯å°Redisè¿˜å¯ä»¥é…ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥æ›´å¥½åœ°ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18eoii8ttj21c60homz7.jpg" alt="image-20220413211725149"></p>
<p>é‚£ä¹ˆé—®é¢˜æ¥ï¼Œç°åœ¨ç”¨æˆ·æ¥äº†ä¸€ä¸ªå†™å…¥çš„è¯·æ±‚ï¼Œæ•°æ®è¯¥å†™åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šå‘¢ï¼Ÿæˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹é›†ç¾¤çš„æœºåˆ¶ï¼š</p>
<p>é¦–å…ˆï¼Œä¸€ä¸ªRedisé›†ç¾¤åŒ…å«16384ä¸ªæ’æ§½ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªRedis å®ä¾‹è´Ÿè´£ç»´æŠ¤ä¸€éƒ¨åˆ†æ’æ§½ä»¥åŠæ’æ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªæ’æ§½æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>
<p>å®é™…ä¸Šï¼Œæ’æ§½å°±æ˜¯é”®çš„Hashè®¡ç®—åçš„ä¸€ä¸ªç»“æœï¼Œæ³¨æ„è¿™é‡Œå‡ºç°äº†<code>è®¡ç®—æœºç½‘ç»œ</code>ä¸­çš„CRCå¾ªç¯å†—ä½™æ ¡éªŒï¼Œè¿™é‡Œé‡‡ç”¨CRC16ï¼Œèƒ½å¾—åˆ°16ä¸ªbitä½çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ç®—å‡ºæ¥ä¹‹åç»“æœæ˜¯0-65535ä¹‹é—´ï¼Œå†è¿›è¡Œå–æ¨¡ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœï¼š</p>
<p><strong>Redis keyçš„è·¯ç”±è®¡ç®—å…¬å¼ï¼šslot = CRC16ï¼ˆkeyï¼‰ % 16384</strong></p>
<p>ç»“æœçš„å€¼æ˜¯å¤šå°‘ï¼Œå°±åº”è¯¥å­˜æ”¾åˆ°å¯¹åº”ç»´æŠ¤çš„Redisä¸‹ï¼Œæ¯”å¦‚RedisèŠ‚ç‚¹1è´Ÿè´£0-25565çš„æ’æ§½ï¼Œè€Œè¿™æ—¶å®¢æˆ·ç«¯æ’å…¥äº†ä¸€ä¸ªæ–°çš„æ•°æ®<code>a=10</code>ï¼Œaåœ¨Hashè®¡ç®—åç»“æœä¸º666ï¼Œé‚£ä¹ˆaå°±åº”è¯¥å­˜æ”¾åˆ°1å·RedisèŠ‚ç‚¹ä¸­ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡å“ˆå¸Œç®—æ³•å°†æ’å…¥çš„æ•°æ®åˆ†æ‘Šåˆ°å„ä¸ªèŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥è¯´å“ˆå¸Œç®—æ³•çœŸçš„æ˜¯å¤„å¤„éƒ½æœ‰ç”¨å•Šã€‚</p>
<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬å°±æ¥æ­å»ºä¸€ä¸ªç®€å•çš„Redisé›†ç¾¤ï¼Œè¿™é‡Œåˆ›å»º6ä¸ªé…ç½®ï¼Œæ³¨æ„å¼€å¯é›†ç¾¤æ¨¡å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Normal Redis instances can&#x27;t be part of a Redis Cluster; only nodes that are</span><br><span class="line"># started as cluster nodes can. In order to start a Redis instance as a</span><br><span class="line"># cluster node enable the cluster support uncommenting the following:</span><br><span class="line">#</span><br><span class="line">cluster-enabled yes</span><br></pre></td></tr></table></figure>

<p>æ¥ç€è®°å¾—æŠŠæ‰€æœ‰çš„æŒä¹…åŒ–æ–‡ä»¶å…¨éƒ¨åˆ é™¤ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹å†…å®¹å¿…é¡»æ˜¯ç©ºçš„ã€‚</p>
<p>ç„¶åè¾“å…¥<code>redis-cli.exe --cluster create --cluster-replicas 1 127.0.0.1:6001 127.0.0.1:6002 127.0.0.1:6003 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003</code>ï¼Œè¿™é‡Œçš„<code>--cluster-replicas 1</code>æŒ‡çš„æ˜¯æ¯ä¸ªèŠ‚ç‚¹é…ä¸€ä¸ªä»èŠ‚ç‚¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18fw9o0isj21hc0mw12l.jpg" alt="image-20220413215928157"></p>
<p>è¾“å…¥ä¹‹åï¼Œä¼šä¸ºä½ å±•ç¤ºå®¢æˆ·ç«¯é»˜è®¤åˆ†é…çš„æ–¹æ¡ˆï¼Œå¹¶ä¸”ä¼šè¯¢é—®ä½ å½“å‰çš„æ–¹æ¡ˆæ˜¯å¦åˆç†ã€‚å¯ä»¥çœ‹åˆ°6001/6002/6003éƒ½è¢«é€‰ä¸ºä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–çš„ä¸ºä»èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç›´æ¥è¾“å…¥yeså³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18fp8r1m9j21h605sabp.jpg" alt="image-20220413215243309"></p>
<p>æœ€ååˆ†é…æˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°æ’æ§½çš„åˆ†é…æƒ…å†µï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18fwsc8ecj21go0li467.jpg" alt="image-20220413215958201"></p>
<p>ç°åœ¨æˆ‘ä»¬éšä¾¿è¿æ¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°è¯•æ’å…¥ä¸€ä¸ªå€¼ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18g381vqlj2122030dgk.jpg" alt="image-20220413220609800"></p>
<p>åœ¨æ’å…¥æ—¶ï¼Œå‡ºç°äº†ä¸€ä¸ªé”™è¯¯ï¼Œå®é™…ä¸Šè¿™å°±æ˜¯å› ä¸ºaè®¡ç®—å‡ºæ¥çš„å“ˆå¸Œå€¼ï¼ˆæ’æ§½ï¼‰ï¼Œä¸å½’å½“å‰èŠ‚ç‚¹ç®¡ï¼Œæˆ‘ä»¬å¾—å»ç®¡è¿™ä¸ªæ’æ§½çš„èŠ‚ç‚¹æ‰§è¡Œï¼Œé€šè¿‡ä¸Šé¢çš„åˆ†é…æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°15495å±äºèŠ‚ç‚¹6003ç®¡ç†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18g5ccyqpj20y205e3z8.jpg" alt="image-20220413220811536"></p>
<p>åœ¨6003èŠ‚ç‚¹æ’å…¥æˆåŠŸï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨é›†ç¾¤æ–¹å¼è¿æ¥ï¼Œè¿™æ ·æˆ‘ä»¬æ— è®ºåœ¨å“ªä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ’å…¥ï¼Œåªéœ€è¦æ·»åŠ <code>-c</code>è¡¨ç¤ºä»¥é›†ç¾¤æ¨¡å¼è®¿é—®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18g6stccaj216y04uwfk.jpg" alt="image-20220413220935678"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨6001èŠ‚ç‚¹æˆåŠŸå¯¹açš„å€¼è¿›è¡Œäº†æ›´æ–°ï¼Œåªä¸è¿‡è¿˜æ˜¯è¢«é‡å®šå‘åˆ°äº†6003èŠ‚ç‚¹è¿›è¡Œæ’å…¥ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è¾“å…¥<code>cluster nodes</code>å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰æ‰€æœ‰èŠ‚ç‚¹çš„ä¿¡æ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18gir6s5mj21hk09mgs0.jpg" alt="image-20220413222104845"></p>
<p>é‚£ä¹ˆç°åœ¨å¦‚æœæˆ‘ä»¬è®©æŸä¸€ä¸ªä¸»èŠ‚ç‚¹æŒ‚æ‰ä¼šæ€ä¹ˆæ ·ï¼Ÿç°åœ¨æˆ‘ä»¬æŠŠ6001æŒ‚æ‰ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18gurtemjj21h808wwkx.jpg" alt="image-20220413223237962"></p>
<p>å¯ä»¥çœ‹åˆ°åŸæœ¬çš„6001ä»èŠ‚ç‚¹7001ï¼Œæ™‹å‡ä¸ºäº†æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œè€Œä¹‹å‰çš„6001å·²ç»æŒ‚äº†ï¼Œç°åœ¨æˆ‘ä»¬å°†6001é‡å¯è¯•è¯•çœ‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18gvstwbkj21hk04e76h.jpg" alt="image-20220413223337494"></p>
<p>å¯ä»¥çœ‹åˆ°6001å˜æˆäº†7001çš„ä»èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¦æ˜¯6001å’Œ7001éƒ½æŒ‚äº†å‘¢ï¼Ÿ</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18gzd1jxzj21ha0460v0.jpg" alt="image-20220413223702884"></p>
<p>è¿™æ—¶æˆ‘ä»¬å°è¯•æ’å…¥æ–°çš„æ•°æ®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18gzqibkqj20va03a74o.jpg" alt="image-20220413223724440"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å­˜åœ¨èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œä¼šæ— æ³•æ’å…¥æ–°çš„æ•°æ®ï¼Œç°åœ¨æˆ‘ä»¬å°†6001å’Œ7001æ¢å¤ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h18h0l5pcnj21gs07a77z.jpg" alt="image-20220413223813370"></p>
<p>å¯ä»¥çœ‹åˆ°æ¢å¤ä¹‹ååˆå¯ä»¥ç»§ç»­æ­£å¸¸ä½¿ç”¨äº†ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Javaè¿æ¥åˆ°é›†ç¾¤æ¨¡å¼ä¸‹çš„Redisï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°JedisClusterå¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//å’Œå®¢æˆ·ç«¯ä¸€æ ·ï¼Œéšä¾¿è¿ä¸€ä¸ªå°±è¡Œï¼Œä¹Ÿå¯ä»¥å¤šå†™å‡ ä¸ªï¼Œæ„é€ æ–¹æ³•æœ‰å¾ˆå¤šç§å¯ä»¥é€‰æ‹©</span></span><br><span class="line">        <span class="keyword">try</span>(<span class="type">JedisCluster</span> <span class="variable">cluster</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisCluster</span>(<span class="keyword">new</span> <span class="title class_">HostAndPort</span>(<span class="string">&quot;192.168.0.8&quot;</span>, <span class="number">6003</span>)))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;é›†ç¾¤å®ä¾‹æ•°é‡ï¼š&quot;</span>+cluster.getClusterNodes().size());</span><br><span class="line">            cluster.set(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;yyds&quot;</span>);</span><br><span class="line">            System.out.println(cluster.get(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ“ä½œåŸºæœ¬å’ŒJediså¯¹è±¡ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å¤šåšèµ˜è¿°äº†ã€‚</p>
<h3 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h3><p>åœ¨æˆ‘ä»¬çš„ä¼ ç»Ÿå•ä½“åº”ç”¨ä¸­ï¼Œç»å¸¸ä¼šç”¨åˆ°é”æœºåˆ¶ï¼Œç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å¤šçº¿ç¨‹ç«äº‰å¯¼è‡´çš„å¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œåˆè¯¥å¦‚ä½•å®ç°é”æœºåˆ¶å‘¢ï¼Ÿå¯èƒ½ä¸€æ¡é“¾è·¯ä¸Šæœ‰å¾ˆå¤šçš„åº”ç”¨ï¼Œå®ƒä»¬éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©Redisæ¥å®ç°åˆ†å¸ƒå¼é”ã€‚</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬ä¸Šä¸€ç« æœ€åæå‡ºçš„é—®é¢˜å—ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doBorrow</span><span class="params">(<span class="type">int</span> uid, <span class="type">int</span> bid)</span> &#123;</span><br><span class="line">  	<span class="comment">//1. åˆ¤æ–­å›¾ä¹¦å’Œç”¨æˆ·æ˜¯å¦éƒ½æ”¯æŒå€Ÿé˜…ï¼Œå¦‚æœæ­¤æ—¶æ¥äº†10ä¸ªçº¿ç¨‹ï¼Œéƒ½è¿›æ¥äº†ï¼Œé‚£ä¹ˆéƒ½èƒ½å¤Ÿåˆ¤æ–­ä¸ºå¯ä»¥å€Ÿé˜…</span></span><br><span class="line">    <span class="keyword">if</span>(bookClient.bookRemain(bid) &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å›¾ä¹¦æ•°é‡ä¸è¶³&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(userClient.userRemain(uid) &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·å€Ÿé˜…é‡ä¸è¶³&quot;</span>);</span><br><span class="line">  	<span class="comment">//2. é¦–å…ˆå°†å›¾ä¹¦çš„æ•°é‡-1ï¼Œç”±äºä¸Šé¢10ä¸ªçº¿ç¨‹åŒæ—¶è¿›æ¥ï¼ŒåŒæ—¶åˆ¤æ–­å¯ä»¥å€Ÿé˜…ï¼Œé‚£ä¹ˆè¿™ä¸ª10ä¸ªçº¿ç¨‹å°±åŒæ—¶å°†å›¾ä¹¦æ•°é‡-1ï¼Œé‚£åº“å­˜å²‚ä¸æ˜¯ç›´æ¥å˜æˆè´Ÿæ•°äº†ï¼Ÿï¼Ÿï¼Ÿ</span></span><br><span class="line">    <span class="keyword">if</span>(!bookClient.bookBorrow(bid))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åœ¨å€Ÿé˜…å›¾ä¹¦æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">  	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šåœ¨é«˜å¹¶å‘ä¸‹ï¼Œæˆ‘ä»¬çœ‹ä¼¼æ­£å¸¸çš„å€Ÿé˜…æµç¨‹ï¼Œä¼šå‡ºç°é—®é¢˜ï¼Œæ¯”å¦‚ç°åœ¨åŒæ—¶æ¥äº†10ä¸ªåŒå­¦è¦å€ŸåŒä¸€æœ¬ä¹¦ï¼Œä½†æ˜¯ç°åœ¨åªæœ‰3æœ¬ï¼Œè€Œæˆ‘ä»¬çš„åˆ¤æ–­è§„åˆ™æ˜¯ï¼Œé¦–å…ˆçœ‹ä¹¦å¤Ÿä¸å¤Ÿï¼Œå¦‚æœæ­¤æ—¶è¿™10ä¸ªè¯·æ±‚éƒ½å·²ç»èµ°åˆ°è¿™é‡Œï¼Œå¹¶ä¸”éƒ½åˆ¤å®šä¸ºå¯ä»¥è¿›è¡Œå€Ÿé˜…ï¼Œé‚£ä¹ˆé—®é¢˜å°±å‡ºç°äº†ï¼Œæ¥ä¸‹æ¥è¿™10ä¸ªè¯·æ±‚éƒ½å¼€å§‹è¿›è¡Œå€Ÿé˜…æ“ä½œï¼Œå¯¼è‡´åº“å­˜ç›´æ¥çˆ†è¡¨ï¼Œå½¢æˆè¶…å€Ÿé—®é¢˜ï¼ˆåœ¨ç”µå•†ç³»ç»Ÿä¸­ä¹Ÿå­˜åœ¨åŒæ ·çš„è¶…å–é—®é¢˜ï¼‰</p>
<p>å› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨åˆ†å¸ƒå¼é”æ¥å®ç°ã€‚é‚£ä¹ˆRediså¦‚ä½•å»å®ç°åˆ†å¸ƒå¼é”å‘¢ï¼Ÿ</p>
<p>åœ¨Rediså­˜åœ¨è¿™æ ·ä¸€ä¸ªå‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">setnx key value</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤çœ‹èµ·æ¥å’Œ<code>set</code>å‘½ä»¤å·®ä¸å¤šï¼Œä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªæœºåˆ¶ï¼Œå°±æ˜¯åªæœ‰å½“æŒ‡å®šçš„keyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰èƒ½è¿›è¡Œæ’å…¥ï¼Œå®é™…ä¸Šå°±æ˜¯<code>set if not exists</code>çš„ç¼©å†™ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h192d1jdakj214q07uab5.jpg" alt="image-20220414105646460"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“å®¢æˆ·ç«¯1è®¾å®šaä¹‹åï¼Œå®¢æˆ·ç«¯2ä½¿ç”¨<code>setnx</code>ä¼šç›´æ¥å¤±è´¥ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h192f9yztfj211g08i75i.jpg" alt="image-20220414105854959"></p>
<p>å½“å®¢æˆ·ç«¯1å°†aåˆ é™¤ä¹‹åï¼Œå®¢æˆ·ç«¯2å°±å¯ä»¥ä½¿ç”¨<code>setnx</code>æˆåŠŸæ’å…¥äº†ã€‚</p>
<p>åˆ©ç”¨è¿™ç§ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡ä¸­å®ç°åˆ†å¸ƒå¼é”ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œè¦æ˜¯æŸä¸ªæœåŠ¡åŠ äº†é”ä½†æ˜¯å¡é¡¿äº†å‘¢ï¼Œæˆ–æ˜¯ç›´æ¥å´©æºƒäº†ï¼Œé‚£è¿™æŠŠé”å²‚ä¸æ˜¯æ°¸è¿œæ— æ³•é‡Šæ”¾äº†ï¼Ÿå› æ­¤æˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘åŠ ä¸ªè¿‡æœŸæ—¶é—´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set a 666 EX 5 NX</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½¿ç”¨<code>set</code>å‘½ä»¤ï¼Œæœ€ååŠ ä¸€ä¸ªNXè¡¨ç¤ºæ˜¯ä½¿ç”¨<code>setnx</code>çš„æ¨¡å¼ï¼Œå’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡EXè®¾å®šè¿‡æœŸæ—¶é—´ï¼Œè¿™é‡Œè®¾ç½®ä¸º5ç§’ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœ5ç§’è¿˜æ²¡é‡Šæ”¾ï¼Œé‚£ä¹ˆå°±è‡ªåŠ¨åˆ é™¤ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h192qy0x9pj213w09ymyq.jpg" alt="image-20220414111008456"></p>
<p>å½“ç„¶ï¼Œæ·»åŠ äº†è¿‡æœŸæ—¶é—´ï¼Œå¸¦äº†çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿå¸¦æ¥äº†å¾ˆå¤šçš„éº»çƒ¦ï¼Œæˆ‘ä»¬æ¥è®¾æƒ³ä¸€ä¸‹è¿™ç§æƒ…å†µï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1935d9f0jj21im0cydi8.jpg" alt="image-20220414112359738"></p>
<p>å› æ­¤ï¼Œå•çº¯åªæ˜¯æ·»åŠ è¿‡æœŸæ—¶é—´ï¼Œä¼šå‡ºç°è¿™ç§æŠŠåˆ«äººåŠ çš„é”è°å¸äº†çš„æƒ…å†µï¼Œè¦è§£å†³è¿™ç§é—®é¢˜ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬ç°åœ¨çš„ç›®æ ‡å°±æ˜¯ä¿è¯ä»»åŠ¡åªèƒ½åˆ é™¤è‡ªå·±åŠ çš„é”ï¼Œå¦‚æœæ˜¯åˆ«äººåŠ çš„é”æ˜¯æ²¡æœ‰èµ„æ ¼åˆ çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å§açš„å€¼æŒ‡å®šä¸ºæˆ‘ä»¬ä»»åŠ¡ä¸“å±çš„å€¼ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨UUIDä¹‹ç±»çš„ï¼Œå¦‚æœåœ¨ä¸»åŠ¨åˆ é™¤é”çš„æ—¶å€™å‘ç°å€¼ä¸æ˜¯æˆ‘ä»¬å½“å‰ä»»åŠ¡æŒ‡å®šçš„ï¼Œé‚£ä¹ˆè¯´æ˜å¯èƒ½æ˜¯å› ä¸ºè¶…æ—¶ï¼Œå…¶ä»–ä»»åŠ¡å·²ç»åŠ é”äº†ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h193cc7opzj21hy0da40t.jpg" alt="image-20220414113041835"></p>
<p>å¦‚æœä½ åœ¨å­¦ä¹ æœ¬ç¯‡ä¹‹å‰å®Œæˆäº†JUCå¹¶å‘ç¼–ç¨‹ç¯‡çš„å­¦ä¹ ï¼Œé‚£ä¹ˆä¸€å®šä¼šæœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œå¦‚æœåœ¨è¶…æ—¶ä¹‹å‰é‚£ä¸€åˆ¹é‚£è¿›å…¥åˆ°é‡Šæ”¾é”çš„é˜¶æ®µï¼Œè·å–åˆ°å€¼è‚¯å®šè¿˜æ˜¯è‡ªå·±ï¼Œä½†æ˜¯åœ¨å³å°†æ‰§è¡Œåˆ é™¤ä¹‹å‰ï¼Œç”±äºè¶…æ—¶æœºåˆ¶å¯¼è‡´è¢«åˆ é™¤å¹¶ä¸”å…¶ä»–ä»»åŠ¡ä¹ŸåŠ é”äº†ï¼Œé‚£ä¹ˆè¿™æ—¶å†è¿›è¡Œåˆ é™¤ï¼Œä»ç„¶ä¼šå¯¼è‡´åˆ é™¤å…¶ä»–ä»»åŠ¡åŠ çš„é”ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h193j2b68fj21mw0d6mzv.jpg" alt="image-20220414113709773"></p>
<p>å®é™…ä¸Šæœ¬è´¨è¿˜æ˜¯å› ä¸ºé”çš„è¶…æ—¶æ—¶é—´ä¸å¤ªå¥½è¡¡é‡ï¼Œå¦‚æœè¶…æ—¶æ—¶é—´èƒ½å¤Ÿè®¾å®šåœ°æ¯”è¾ƒæ°å½“ï¼Œé‚£ä¹ˆå°±å¯ä»¥é¿å…è¿™ç§é—®é¢˜äº†ã€‚</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä¸€ä¸‹Redissonæ¡†æ¶ï¼Œå®ƒæ˜¯Rediså®˜æ–¹æ¨èçš„Javaç‰ˆçš„Rediså®¢æˆ·ç«¯ã€‚å®ƒæä¾›çš„åŠŸèƒ½éå¸¸å¤šï¼Œä¹Ÿéå¸¸å¼ºå¤§ï¼ŒRedissonå†…éƒ¨æä¾›äº†ä¸€ä¸ªç›‘æ§é”çš„çœ‹é—¨ç‹—ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨Redissonå®ä¾‹è¢«å…³é—­å‰ï¼Œä¸æ–­çš„å»¶é•¿é”çš„æœ‰æ•ˆæœŸï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šç§åˆ†å¸ƒå¼é”çš„å®ç°ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿç±»ä¼¼æˆ‘ä»¬åœ¨JUCä¸­å­¦ä¹ çš„é”ï¼Œè¿™é‡Œæˆ‘ä»¬å°è¯•ä½¿ç”¨ä¸€ä¸‹å®ƒçš„åˆ†å¸ƒå¼é”åŠŸèƒ½ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.redisson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redisson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.75.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ä¸åŠ é”çš„æƒ…å†µä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span>(<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.10&quot;</span>, <span class="number">6379</span>))&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">100</span>; j++) &#123;   <span class="comment">//æ¯ä¸ªå®¢æˆ·ç«¯è·å–aç„¶åå¢åŠ açš„å€¼å†å†™å›å»ï¼Œå¦‚æœä¸åŠ é”é‚£ä¹ˆè‚¯å®šä¼šå‡ºé—®é¢˜</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Integer.parseInt(jedis.get(<span class="string">&quot;a&quot;</span>)) + <span class="number">1</span>;</span><br><span class="line">                    jedis.set(<span class="string">&quot;a&quot;</span>, a+<span class="string">&quot;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ²¡æœ‰ç›´æ¥ç”¨<code>incr</code>è€Œæ˜¯æˆ‘ä»¬è‡ªå·±è¿›è¡Œè®¡ç®—ï¼Œæ–¹ä¾¿æ¨¡æ‹Ÿï¼Œå¯ä»¥çœ‹åˆ°è¿è¡Œç»“æŸä¹‹åaçš„å€¼å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h196vkaykrj21ce022dft.jpg" alt="image-20220414133258227"></p>
<p>ç°åœ¨æˆ‘ä»¬æ¥ç»™å®ƒåŠ ä¸€æŠŠé”ï¼Œæ³¨æ„è¿™ä¸ªé”æ˜¯åŸºäºRedisçš„ï¼Œä¸ä»…ä»…åªå¯ä»¥ç”¨äºå½“å‰åº”ç”¨ï¼Œæ˜¯èƒ½å¤Ÿå®ç³»ç»Ÿçš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Config</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line">    config.useSingleServer().setAddress(<span class="string">&quot;redis://192.168.0.10:6379&quot;</span>);   <span class="comment">//é…ç½®è¿æ¥çš„RedisæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šé›†ç¾¤</span></span><br><span class="line">    <span class="type">RedissonClient</span> <span class="variable">client</span> <span class="operator">=</span>  Redisson.create(config);   <span class="comment">//åˆ›å»ºRedissonClientå®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span>(<span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.0.10&quot;</span>, <span class="number">6379</span>))&#123;</span><br><span class="line">                <span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> client.getLock(<span class="string">&quot;testLock&quot;</span>);    <span class="comment">//æŒ‡å®šé”çš„åç§°ï¼Œæ‹¿åˆ°é”å¯¹è±¡</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">100</span>; j++) &#123;</span><br><span class="line">                    lock.lock();    <span class="comment">//åŠ é”</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Integer.parseInt(jedis.get(<span class="string">&quot;a&quot;</span>)) + <span class="number">1</span>;</span><br><span class="line">                    jedis.set(<span class="string">&quot;a&quot;</span>, a+<span class="string">&quot;&quot;</span>);</span><br><span class="line">                    lock.unlock();   <span class="comment">//è§£é”</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç»“æŸï¼&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç»“æœæ²¡æœ‰é—®é¢˜ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h196wp13naj215202caa3.jpg" alt="image-20220414133403403"></p>
<p>æ³¨æ„ï¼Œå¦‚æœç”¨äºå­˜æ”¾é”çš„RedisæœåŠ¡å™¨æŒ‚äº†ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯ä¼šå‡ºé—®é¢˜çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨RedLockï¼Œå®ƒçš„æ€è·¯æ˜¯ï¼Œåœ¨å¤šä¸ªRedisæœåŠ¡å™¨ä¸Šä¿å­˜é”ï¼Œåªéœ€è¦è¶…è¿‡åŠæ•°çš„RedisæœåŠ¡å™¨è·å–åˆ°é”ï¼Œé‚£ä¹ˆå°±çœŸçš„è·å–åˆ°é”äº†ï¼Œè¿™æ ·å°±ç®—æŒ‚æ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹ï¼Œä¹Ÿèƒ½ä¿è¯æ­£å¸¸è¿è¡Œï¼Œè¿™é‡Œå°±ä¸åšæ¼”ç¤ºäº†ã€‚</p>
<hr>
<h2 id="MySQLä¸åˆ†å¸ƒå¼"><a href="#MySQLä¸åˆ†å¸ƒå¼" class="headerlink" title="MySQLä¸åˆ†å¸ƒå¼"></a>MySQLä¸åˆ†å¸ƒå¼</h2><p>å‰é¢æˆ‘è®²è§£äº†Redisåœ¨åˆ†å¸ƒå¼åœºæ™¯çš„ä¸‹çš„ç›¸å…³åº”ç”¨ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹MySQLæ•°æ®åº“åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„åº”ç”¨ã€‚</p>
<h3 id="ä¸»ä»å¤åˆ¶-1"><a href="#ä¸»ä»å¤åˆ¶-1" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h3><p>å½“æˆ‘ä»¬ä½¿ç”¨MySQLçš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥é‡‡å–ä¸»ä»å¤åˆ¶çš„ç­–ç•¥ï¼Œå®ƒçš„å®ç°æ€è·¯åŸºæœ¬å’ŒRedisç›¸ä¼¼ï¼Œä¹Ÿæ˜¯é‡‡ç”¨å¢é‡å¤åˆ¶çš„æ–¹å¼ï¼ŒMySQLä¼šåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¼šè®°å½•äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæ‰€æœ‰çš„DMLå’ŒDDLæ“ä½œéƒ½ä¼šè¢«è®°å½•è¿›æ—¥å¿—ä¸­ï¼Œä¸»åº“åªéœ€è¦å°†è®°å½•çš„æ“ä½œå¤åˆ¶ç»™ä»åº“ï¼Œè®©ä»åº“ä¹Ÿè¿è¡Œä¸€æ¬¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®ç°ä¸»ä»å¤åˆ¶ã€‚ä½†æ˜¯æ³¨æ„å®ƒä¸ä¼šåœ¨ä¸€å¼€å§‹è¿›è¡Œå…¨é‡å¤åˆ¶ï¼Œæ‰€ä»¥æœ€å¥½å†å¼€å§‹ä¸»ä»ä¹‹å‰å°†æ•°æ®åº“çš„å†…å®¹ä¿æŒä¸€è‡´ã€‚</p>
<p>å’Œä¹‹å‰ä¸€æ ·ï¼Œä¸€æ—¦æˆ‘ä»¬å®ç°äº†ä¸»ä»å¤åˆ¶ï¼Œé‚£ä¹ˆå°±ç®—ä¸»åº“å‡ºç°æ•…éšœï¼Œä»åº“ä¹Ÿèƒ½æ­£å¸¸æä¾›æœåŠ¡ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å®ç°è¯»å†™åˆ†ç¦»ç­‰æ“ä½œã€‚è¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨ä¸¤å°ä¸»æœºæ¥æ­å»ºä¸€ä¸»ä¸€ä»çš„ç¯å¢ƒï¼Œé¦–å…ˆç¡®ä¿ä¸¤å°æœåŠ¡å™¨éƒ½å®‰è£…äº†MySQLæ•°æ®åº“å¹¶ä¸”éƒ½å·²ç»æ­£å¸¸è¿è¡Œäº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19bsu4pv1j21zq0dyn3r.jpg" alt="image-20220414162319865"></p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦åˆ›å»ºå¯¹åº”çš„è´¦å·ï¼Œä¸€ä¼šæ–¹ä¾¿ä»åº“è¿›è¡Œè®¿é—®çš„ç”¨æˆ·ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> test identified <span class="keyword">with</span> mysql_native_password <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å¼€å¯ä¸€ä¸‹å¤–ç½‘è®¿é—®ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># If MySQL is running as a replication slave, this should be</span></span><br><span class="line"><span class="comment"># changed. Ref https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_tmpdir</span></span><br><span class="line"><span class="comment"># tmpdir                = /tmp</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Instead of skip-networking the default is now to listen only on</span></span><br><span class="line"><span class="comment"># localhost which is more compatible and is not less secure.</span></span><br><span class="line"><span class="comment"># bind-address          = 127.0.0.1    è¿™é‡Œæ³¨é‡Šæ‰å°±è¡Œ</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬é‡å¯ä¸€ä¸‹MySQLæœåŠ¡ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo systemctl restart mysql.service </span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬é¦–å…ˆæ¥é…ç½®ä¸»åº“ï¼Œä¸»åº“åªéœ€è¦ä¸ºæˆ‘ä»¬åˆšåˆšåˆ›å»ºå¥½çš„ç”¨æˆ·åˆ†é…ä¸€ä¸ªä¸»ä»å¤åˆ¶çš„æƒé™å³å¯ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">grant</span> replication slave <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> test;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬å¯ä»¥è¾“å…¥å‘½ä»¤æ¥æŸ¥çœ‹ä¸»åº“çš„ç›¸å…³æƒ…å†µï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19ckapbrsj218206s3zi.jpg" alt="image-20220414164943974"></p>
<p>è¿™æ ·ä¸»åº“å°±æ­å»ºå®Œæˆäº†ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦å°†ä»åº“è¿›è¡Œé…ç½®ï¼Œé¦–å…ˆæ˜¯é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># The following can be used as easy to replay backup logs or for replication.</span></span><br><span class="line"><span class="comment"># <span class="doctag">note:</span> if you are setting up a replication slave, see README.Debian about</span></span><br><span class="line"><span class="comment">#       other settings you may need to change.</span></span><br><span class="line"><span class="comment"># è¿™é‡Œéœ€è¦å°†server-idé…ç½®ä¸ºå…¶ä»–çš„å€¼ï¼ˆé»˜è®¤æ˜¯1ï¼‰æ‰€æœ‰Mysqlä¸»ä»å®ä¾‹çš„idå¿…é¡»å”¯ä¸€ï¼Œä¸èƒ½æ‰“æ¶ï¼Œä¸ç„¶ä¸€ä¼šå¼€å¯ä¼šå¤±è´¥</span></span><br><span class="line"><span class="attr">server-id</span>               = <span class="string">2</span></span><br></pre></td></tr></table></figure>

<p>è¿›å…¥æ•°æ®åº“ï¼Œè¾“å…¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">change replication source <span class="keyword">to</span> SOURCE_HOST<span class="operator">=</span><span class="string">&#x27;192.168.0.8&#x27;</span>,SOURCE_USER<span class="operator">=</span><span class="string">&#x27;test&#x27;</span>,SOURCE_PASSWORD<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>,SOURCE_LOG_FILE<span class="operator">=</span><span class="string">&#x27;binlog.000004&#x27;</span>,SOURCE_LOG_POS<span class="operator">=</span><span class="number">591</span>;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åé¢çš„logfileå’Œposå°±æ˜¯æˆ‘ä»¬ä¸Šé¢ä»ä¸»åº“ä¸­æ˜¾ç¤ºçš„ä¿¡æ¯ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19cvd6eypj218m032my0.jpg" alt="image-20220414170022303"></p>
<p>æ‰§è¡Œå®Œæˆåï¼Œæ˜¾ç¤ºOKè¡¨ç¤ºæ²¡æœ‰é—®é¢˜ï¼Œæ¥ç€è¾“å…¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">start</span> replica;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬çš„ä»æœºå°±æ­£å¼å¯åŠ¨äº†ï¼Œç°åœ¨æˆ‘ä»¬è¾“å…¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> replica status\G;</span><br></pre></td></tr></table></figure>

<p>æ¥æŸ¥çœ‹å½“å‰ä»æœºçŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19gxft4iwj217i0d4jtm.jpg" alt="image-20220414192045320"></p>
<p>æœ€å…³é”®çš„æ˜¯ä¸‹é¢çš„Replica_IO_Runningå’ŒReplica_SQL_Runningå¿…é¡»åŒæ—¶ä¸ºYesæ‰å¯ä»¥ï¼Œå®é™…ä¸Šä»åº“ä¼šåˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹è´Ÿè´£ä¸ä¸»åº“è¿›è¡Œé€šä¿¡ï¼Œè·å–äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæš‚æ—¶å­˜æ”¾åˆ°ä¸€ä¸ªä¸­é—´è¡¨ï¼ˆRelay_Logï¼‰ä¸­ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åˆ™æ˜¯å°†ä¸­é—´è¡¨ä¿å­˜çš„äºŒè¿›åˆ¶æ—¥å¿—çš„ä¿¡æ¯è¿›è¡Œæ‰§è¡Œï¼Œç„¶åæ’å…¥åˆ°ä»åº“ä¸­ã€‚</p>
<p>æœ€åé…ç½®å®Œæˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹åœ¨ä¸»åº“è¿›è¡Œæ“ä½œä¼šä¸ä¼šåŒæ­¥åˆ°ä»åº“ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19h202nr3j21e00aimyl.jpg" alt="image-20220414192508849"></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨ä¸»åº“ä¸­åˆ›å»ºçš„æ•°æ®åº“ï¼Œè¢«åŒæ­¥åˆ°ä»åº“ä¸­äº†ï¼Œæˆ‘ä»¬å†æ¥è¯•è¯•çœ‹åˆ›å»ºè¡¨å’Œæ’å…¥æ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">use yyds;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test  (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  `passwd` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19h5hpocfj21dg0e8tbe.jpg" alt="image-20220414192829536"></p>
<p>ç°åœ¨æˆ‘ä»¬éšä¾¿æ’å…¥ä¸€ç‚¹æ•°æ®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19h6cxnxzj215c08s3zn.jpg" alt="image-20220414192920277"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„MySQLä¸»ä»å°±æ­å»ºå®Œæˆäº†ï¼Œé‚£ä¹ˆå¦‚æœä¸»æœºæ­¤æ—¶æŒ‚äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19i41l2flj211k03oq3b.jpg" alt="image-20220414200140191"></p>
<p>å¯ä»¥çœ‹åˆ°IOçº¿ç¨‹æ˜¯å¤„äºé‡è¿çŠ¶æ€ï¼Œä¼šç­‰å¾…ä¸»åº“é‡æ–°æ¢å¤è¿è¡Œã€‚</p>
<h3 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h3><p>åœ¨å¤§å‹çš„äº’è”ç½‘ç³»ç»Ÿä¸­ï¼Œå¯èƒ½å•å°MySQLçš„å­˜å‚¨å®¹é‡æ— æ³•æ»¡è¶³ä¸šåŠ¡çš„éœ€æ±‚ï¼Œè¿™æ—¶å€™å°±éœ€è¦è¿›è¡Œæ‰©å®¹äº†ã€‚</p>
<p>å’Œä¹‹å‰çš„é—®é¢˜ä¸€æ ·ï¼Œå•å°ä¸»æœºçš„ç¡¬ä»¶èµ„æºæ˜¯å­˜åœ¨ç“¶é¢ˆçš„ï¼Œä¸å¯èƒ½æ— é™åˆ¶åœ°çºµå‘æ‰©å±•ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¾—é€šè¿‡å¤šå°å®ä¾‹æ¥è¿›è¡Œå®¹é‡çš„æ¨ªå‘æ‰©å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®åˆ†æ•£å­˜å‚¨ï¼Œè®©å¤šå°ä¸»æœºå…±åŒæ¥ä¿å­˜æ•°æ®ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆä¸ªåˆ†æ•£æ³•ï¼Ÿ</p>
<ul>
<li><p><strong>å‚ç›´æ‹†åˆ†ï¼š</strong>æˆ‘ä»¬çš„è¡¨å’Œæ•°æ®åº“éƒ½å¯ä»¥è¿›è¡Œå‚ç›´æ‹†åˆ†ï¼Œæ‰€è°“å‚ç›´æ‹†åˆ†ï¼Œå°±æ˜¯å°†æ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨ï¼ŒæŒ‰ç…§ä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†åˆ°å„ä¸ªæ•°æ®åº“ä¸­ï¼ˆæ˜¯ä¸æ˜¯æ„Ÿè§‰è·Ÿå‰é¢ä¸¤ç« çš„å­¦ä¹ çš„æ¶æ„å¯¹åº”èµ·æ¥äº†ï¼‰è€Œå¯¹äºä¸€å¼ è¡¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤–é”®ä¹‹ç±»çš„æœºåˆ¶ï¼Œå°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ªè¡¨ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19jf8adocj21e60gyacl.jpg" alt="image-20220414204703883"></p>
</li>
<li><p><strong>æ°´å¹³æ‹†åˆ†ï¼š</strong>æ°´å¹³æ‹†åˆ†é’ˆå¯¹çš„ä¸æ˜¯è¡¨ï¼Œè€Œæ˜¯æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è®©å¾ˆå¤šä¸ªå…·æœ‰ç›¸åŒè¡¨çš„æ•°æ®åº“å­˜æ”¾ä¸€éƒ¨åˆ†æ•°æ®ï¼Œç›¸å½“äºæ˜¯å°†æ•°æ®åˆ†æ•£å­˜å‚¨åœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19jkrb2pkj21g80eu76c.jpg" alt="image-20220414205222383"></p>
</li>
</ul>
<p>é‚£ä¹ˆè¦å®ç°è¿™æ ·çš„æ‹†åˆ†æ“ä½œï¼Œæˆ‘ä»¬è‡ªè¡Œå»ç¼–å†™ä»£ç å·¥ä½œé‡è‚¯å®šæ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå› æ­¤ç›®å‰å®é™…ä¸Šå·²ç»æœ‰ä¸€äº›è§£å†³æ–¹æ¡ˆäº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨MyCatï¼ˆä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®åº“ä¸­é—´ä»¶ï¼Œç›¸å½“äºæŒ‚äº†ä¸€å±‚ä»£ç†ï¼Œå†é€šè¿‡MyCatè¿›è¡Œåˆ†åº“åˆ†è¡¨æ“ä½œæ•°æ®åº“ï¼Œåªéœ€è¦è¿æ¥å°±èƒ½ä½¿ç”¨ï¼Œç±»ä¼¼çš„è¿˜æœ‰ShardingSphere-Proxyï¼‰æˆ–æ˜¯Sharding JDBCï¼ˆåº”ç”¨ç¨‹åºä¸­ç›´æ¥å¯¹SQLè¯­å¥è¿›è¡Œåˆ†æï¼Œç„¶åè½¬æ¢æˆåˆ†åº“åˆ†è¡¨æ“ä½œï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–å†™ä¸€äº›é€»è¾‘ä»£ç ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬å°±è®²è§£ä¸€ä¸‹Sharding JDBCã€‚</p>
<h3 id="Sharding-JDBC"><a href="#Sharding-JDBC" class="headerlink" title="Sharding JDBC"></a>Sharding JDBC</h3><p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19l7msxooj21ps0iego7.jpg" alt="image-20220414214856875"></p>
<p><strong>å®˜æ–¹æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰ï¼š</strong><a href="https://shardingsphere.apache.org/document/5.1.0/cn/overview/#shardingsphere-jdbc">https://shardingsphere.apache.org/document/5.1.0/cn/overview/#shardingsphere-jdbc</a></p>
<p>å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ï¼Œå®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥ jar åŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„ JDBC é©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹ JDBC å’Œå„ç§ ORM æ¡†æ¶ã€‚</p>
<ul>
<li>é€‚ç”¨äºä»»ä½•åŸºäº JDBC çš„ ORM æ¡†æ¶ï¼Œå¦‚ï¼šJPA, Hibernate, Mybatis, Spring JDBC Template æˆ–ç›´æ¥ä½¿ç”¨ JDBCï¼›</li>
<li>æ”¯æŒä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, HikariCP ç­‰ï¼›</li>
<li>æ”¯æŒä»»æ„å®ç° JDBC è§„èŒƒçš„æ•°æ®åº“ï¼Œç›®å‰æ”¯æŒ MySQLï¼ŒPostgreSQLï¼ŒOracleï¼ŒSQLServer ä»¥åŠä»»ä½•å¯ä½¿ç”¨ JDBC è®¿é—®çš„æ•°æ®åº“ã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦æ¼”ç¤ºä¸€ä¸‹æ°´å¹³åˆ†è¡¨æ–¹å¼ï¼Œæˆ‘ä»¬ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„SpringBooté¡¹ç›®å³å¯ï¼Œä¾èµ–å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  	<span class="comment">&lt;!--  ShardingJDBCä¾èµ–ï¼Œé‚£å¿…é¡»å®‰æ’æœ€æ–°ç‰ˆå•Šï¼Œå¸Œæœ›ä½ ä»¬çœ‹è§†é¢‘çš„æ—¶å€™è¿˜æ˜¯5.Xç‰ˆæœ¬  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shardingsphere-jdbc-core-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ•°æ®åº“æˆ‘ä»¬è¿™é‡Œç›´æ¥ç”¨ä¸ŠèŠ‚è¯¾çš„å³å¯ï¼Œå› ä¸ºåªéœ€è¦ä¸¤ä¸ªè¡¨ç»“æ„ä¸€æ ·çš„æ•°æ®åº“å³å¯ï¼Œæ­£å¥½ä¸ŠèŠ‚è¯¾è¿›è¡Œäº†åŒæ­¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠŠä»åº“å˜å›æ­£å¸¸çŠ¶æ€å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">stop replica;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æŠŠä¸¤ä¸ªè¡¨çš„rootç”¨æˆ·å¯†ç æ”¹ä¸€ä¸‹ï¼Œä¸€ä¼šç”¨è¿™ä¸ªç”¨æˆ·è¿æ¥æ•°æ®åº“ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> authentication_string<span class="operator">=</span><span class="string">&#x27;&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> host <span class="operator">=</span> <span class="string">&#x27;%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> root identified <span class="keyword">with</span> mysql_native_password <span class="keyword">by</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ï¼Œå¦‚æœç›´æ¥å°è¯•å¼€å¯æœåŠ¡å™¨ï¼Œé‚£è‚¯å®šæ˜¯å¼€ä¸äº†çš„ï¼Œå› ä¸ºæˆ‘ä»¬è¦é…ç½®æ•°æ®æºï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19kif2dh4j21sk08en0j.jpg" alt="image-20220414212443482"></p>
<p>é‚£ä¹ˆæ•°æ®æºè¯¥æ€ä¹ˆé…ç½®å‘¢ï¼Ÿç°åœ¨æˆ‘ä»¬æ˜¯ä¸€ä¸ªåˆ†åº“åˆ†è¡¨çš„çŠ¶æ€ï¼Œéœ€è¦é…ç½®ä¸¤ä¸ªæ•°æ®æºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="comment"># æœ‰å‡ ä¸ªæ•°æ®å°±é…å‡ ä¸ªï¼Œè¿™é‡Œæ˜¯åç§°ï¼ŒæŒ‰ç…§ä¸‹é¢çš„æ ¼å¼ï¼Œåç§°+æ•°å­—çš„å½¢å¼</span></span><br><span class="line">      <span class="attr">names:</span> <span class="string">db0,db1</span></span><br><span class="line">      <span class="comment"># ä¸ºæ¯ä¸ªæ•°æ®æºå•ç‹¬è¿›è¡Œé…ç½®</span></span><br><span class="line">      <span class="attr">db0:</span></span><br><span class="line">      	<span class="comment"># æ•°æ®æºå®ç°ç±»ï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤çš„HikariDataSource</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">        <span class="comment"># æ•°æ®åº“é©±åŠ¨</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="comment"># ä¸ç”¨æˆ‘å¤šè¯´äº†å§</span></span><br><span class="line">        <span class="attr">jdbc-url:</span> <span class="string">jdbc:mysql://192.168.0.8:3306/yyds</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">db1:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">jdbc-url:</span> <span class="string">jdbc:mysql://192.168.0.13:3306/yyds</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå¯åŠ¨æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå°±æ˜¯é…ç½®æˆåŠŸäº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h19mebpqb7j21su0aqgre.jpg" alt="image-20220414222958901"></p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦å¯¹é¡¹ç›®è¿›è¡Œä¸€äº›ç¼–å†™ï¼Œæ·»åŠ æˆ‘ä»¬çš„ç”¨æˆ·å®ä½“ç±»å’ŒMapperï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    String name;</span><br><span class="line">    String passwd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from test where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into test(id, name, passwd) values(#&#123;id&#125;, #&#123;name&#125;, #&#123;passwd&#125;)&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">addUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šè¿™äº›æ“ä½œéƒ½æ˜¯å¸¸è§„æ“ä½œï¼Œåœ¨ç¼–å†™ä»£ç æ—¶å…³æ³¨ç‚¹ä¾ç„¶æ”¾åœ¨ä¸šåŠ¡æœ¬èº«ä¸Šï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ShardingJDBCè¦å¦‚ä½•è¿›è¡Œåˆ†ç‰‡ï¼Œé¦–å…ˆæ˜ç¡®ï¼šç°åœ¨æ˜¯ä¸¤ä¸ªæ•°æ®åº“éƒ½æœ‰testè¡¨å­˜æ”¾ç”¨æˆ·æ•°æ®ï¼Œæˆ‘ä»¬ç›®æ ‡æ˜¯å°†ç”¨æˆ·ä¿¡æ¯åˆ†åˆ«å­˜æ”¾åˆ°è¿™ä¸¤ä¸ªæ•°æ®åº“çš„è¡¨ä¸­ã€‚</p>
<p>ä¸åºŸè¯äº†ï¼Œç›´æ¥ä¸Šé…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="attr">sharding:</span></span><br><span class="line">        <span class="attr">tables:</span></span><br><span class="line">        	<span class="comment">#è¿™é‡Œå¡«å†™è¡¨åç§°ï¼Œç¨‹åºä¸­å¯¹è¿™å¼ è¡¨çš„æ‰€æœ‰æ“ä½œï¼Œéƒ½ä¼šé‡‡ç”¨ä¸‹é¢çš„è·¯ç”±æ–¹æ¡ˆ</span></span><br><span class="line">        	<span class="comment">#æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢Mybatiså°±æ˜¯å¯¹testè¡¨è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥ä¼šèµ°ä¸‹é¢çš„è·¯ç”±æ–¹æ¡ˆ</span></span><br><span class="line">          <span class="attr">test:</span></span><br><span class="line">          	<span class="comment">#è¿™é‡Œå¡«å†™å®é™…çš„è·¯ç”±èŠ‚ç‚¹ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬è¦åˆ†ä¸¤ä¸ªåº“ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠä¸¤ä¸ªåº“éƒ½å†™ä¸Šï¼Œä»¥åŠå¯¹åº”çš„è¡¨</span></span><br><span class="line">          	<span class="comment">#ä¹Ÿå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ä¸‹é¢çš„å¯ä»¥ç®€å†™ä¸º db$-&gt;&#123;0..1&#125;.test</span></span><br><span class="line">            <span class="attr">actual-data-nodes:</span> <span class="string">db0.test,db1.test</span></span><br><span class="line">            <span class="comment">#è¿™é‡Œæ˜¯åˆ†åº“ç­–ç•¥é…ç½®</span></span><br><span class="line">            <span class="attr">database-strategy:</span></span><br><span class="line">            	<span class="comment">#è¿™é‡Œé€‰æ‹©æ ‡å‡†ç­–ç•¥ï¼Œä¹Ÿå¯ä»¥é…ç½®å¤æ‚ç­–ç•¥ï¼ŒåŸºäºå¤šä¸ªé”®è¿›è¡Œåˆ†ç‰‡</span></span><br><span class="line">              <span class="attr">standard:</span></span><br><span class="line">              	<span class="comment">#å‚ä¸åˆ†ç‰‡è¿ç®—çš„å­—æ®µï¼Œä¸‹é¢çš„ç®—æ³•ä¼šæ ¹æ®è¿™é‡Œæä¾›çš„å­—æ®µè¿›è¡Œè¿ç®—</span></span><br><span class="line">                <span class="attr">sharding-column:</span> <span class="string">id</span></span><br><span class="line">                <span class="comment">#è¿™é‡Œå¡«å†™æˆ‘ä»¬ä¸‹é¢è‡ªå®šä¹‰çš„ç®—æ³•åç§°</span></span><br><span class="line">                <span class="attr">sharding-algorithm-name:</span> <span class="string">my-alg</span></span><br><span class="line">        <span class="attr">sharding-algorithms:</span></span><br><span class="line">        	<span class="comment">#è‡ªå®šä¹‰ä¸€ä¸ªæ–°çš„ç®—æ³•ï¼Œåç§°éšæ„</span></span><br><span class="line">          <span class="attr">my-alg:</span></span><br><span class="line">          	<span class="comment">#ç®—æ³•ç±»å‹ï¼Œå®˜æ–¹å†…ç½®äº†å¾ˆå¤šç§ï¼Œè¿™é‡Œæ¼”ç¤ºæœ€ç®€å•çš„ä¸€ç§</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">MOD</span></span><br><span class="line">            <span class="attr">props:</span></span><br><span class="line">              <span class="attr">sharding-count:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">    	<span class="comment">#å¼€å¯æ—¥å¿—ï¼Œä¸€ä¼šæ–¹ä¾¿æˆ‘ä»¬è§‚å¯Ÿ</span></span><br><span class="line">			<span class="attr">sql-show:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œåˆ†ç‰‡ç®—æ³•æœ‰å¾ˆå¤šå†…ç½®çš„ï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥è¯¢ï¼š<a href="https://shardingsphere.apache.org/document/5.1.0/cn/user-manual/shardingsphere-jdbc/builtin-algorithm/sharding/%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E4%BD%BF%E7%94%A8%E7%9A%84%E6%98%AFMOD%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%8F%96%E6%A8%A1%E5%88%86%E7%89%87%E7%AE%97%E6%B3%95%EF%BC%8C%E5%AE%83%E4%BC%9A%E6%A0%B9%E6%8D%AE%E4%B8%BB%E9%94%AE%E7%9A%84%E5%80%BC%E8%BF%9B%E8%A1%8C%E5%8F%96%E6%A8%A1%E8%BF%90%E7%AE%97%EF%BC%8C%E6%AF%94%E5%A6%82%E6%88%91%E4%BB%AC%E8%BF%99%E9%87%8C%E5%A1%AB%E5%86%99%E7%9A%84%E6%98%AF2%EF%BC%8C%E9%82%A3%E4%B9%88%E5%B0%B1%E8%A1%A8%E7%A4%BA%E5%AF%B9%E4%B8%BB%E9%94%AE%E8%BF%9B%E8%A1%8C%E6%A8%A12%E8%BF%90%E7%AE%97%EF%BC%8C%E6%A0%B9%E6%8D%AE%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E5%90%8D%E7%A7%B0%EF%BC%8C%E6%AF%94%E5%A6%82db0%E5%B0%B1%E6%98%AF%E5%8F%96%E6%A8%A1%E5%90%8E%E4%B8%BA0%EF%BC%8Cdb1%E5%B0%B1%E6%98%AF%E5%8F%96%E6%A8%A1%E5%90%8E%E4%B8%BA1%EF%BC%88%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E6%8F%8F%E8%BF%B0%E7%9A%84%E5%B9%B6%E4%B8%8D%E6%98%AF%E5%BE%88%E6%B8%85%E6%A5%9A%EF%BC%89%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%AF%B4%EF%BC%8C%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%95%88%E6%9E%9C%E5%B0%B1%E6%98%AF%E5%8D%95%E6%95%B0%E6%94%BE%E5%9C%A8%60db1%60%EF%BC%8C%E5%8F%8C%E6%95%B0%E6%94%BE%E5%9C%A8%60db0%60%EF%BC%8C%E5%BD%93%E7%84%B6%E5%AE%83%E8%BF%98%E6%94%AF%E6%8C%81%E4%B8%80%E4%BA%9B%E5%85%B6%E4%BB%96%E7%9A%84%E7%AE%97%E6%B3%95%EF%BC%8C%E8%BF%99%E9%87%8C%E5%B0%B1%E4%B8%8D%E5%A4%9A%E4%BB%8B%E7%BB%8D%E4%BA%86%E3%80%82">https://shardingsphere.apache.org/document/5.1.0/cn/user-manual/shardingsphere-jdbc/builtin-algorithm/sharding/ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯MODï¼Œä¹Ÿå°±æ˜¯å–æ¨¡åˆ†ç‰‡ç®—æ³•ï¼Œå®ƒä¼šæ ¹æ®ä¸»é”®çš„å€¼è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œå¡«å†™çš„æ˜¯2ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºå¯¹ä¸»é”®è¿›è¡Œæ¨¡2è¿ç®—ï¼Œæ ¹æ®æ•°æ®æºçš„åç§°ï¼Œæ¯”å¦‚db0å°±æ˜¯å–æ¨¡åä¸º0ï¼Œdb1å°±æ˜¯å–æ¨¡åä¸º1ï¼ˆå®˜æ–¹æ–‡æ¡£æè¿°çš„å¹¶ä¸æ˜¯å¾ˆæ¸…æ¥šï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€ç»ˆå®ç°çš„æ•ˆæœå°±æ˜¯å•æ•°æ”¾åœ¨`db1`ï¼ŒåŒæ•°æ”¾åœ¨`db0`ï¼Œå½“ç„¶å®ƒè¿˜æ”¯æŒä¸€äº›å…¶ä»–çš„ç®—æ³•ï¼Œè¿™é‡Œå°±ä¸å¤šä»‹ç»äº†ã€‚</a></p>
<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ¥çœ‹çœ‹ï¼Œæ˜¯å¦èƒ½å¤ŸæŒ‰ç…§æˆ‘ä»¬ä¸Šé¢çš„è§„åˆ™è¿›è¡Œè·¯ç”±ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShardingJdbcTestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//è¿™é‡ŒIDè‡ªåŠ¨ç”Ÿæˆ1-10ï¼Œç„¶åæ’å…¥æ•°æ®åº“</span></span><br><span class="line">            mapper.addUser(<span class="keyword">new</span> <span class="title class_">User</span>(i, <span class="string">&quot;xxx&quot;</span>, <span class="string">&quot;ccc&quot;</span>));   </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹è¿è¡Œäº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1a7m3cjm6j21qe0b6aej.jpg" alt="image-20220415104401263"></p>
<p>æµ‹è¯•é€šè¿‡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ•°æ®åº“é‡Œé¢æ˜¯ä¸æ˜¯æŒ‰ç…§æˆ‘ä»¬çš„è§„åˆ™è¿›è¡Œæ•°æ®æ’å…¥çš„ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1a7mx6u30j217g0d075w.jpg" alt="image-20220415104449502"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸¤å¼ è¡¨ï¼Œéƒ½æˆåŠŸæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„è·¯ç”±è§„åˆ™è¿›è¡Œæ’å…¥äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¯¦ç»†çš„è·¯ç”±æƒ…å†µï¼Œé€šè¿‡æ§åˆ¶å°è¾“å‡ºçš„SQLå°±å¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1a7vvcqsij21g20amgpd.jpg" alt="image-20220415105325917"></p>
<p>å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„SQLè¯­å¥éƒ½æœ‰ä¸€ä¸ªLogic SQLï¼ˆè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬åœ¨Mybatisé‡Œé¢å†™çš„ï¼Œæ˜¯ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆï¼‰ç´§æ¥ç€ä¸‹é¢å°±æ˜¯Actual SQLï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªé€»è¾‘SQLæœ€ç»ˆä¼šæ ¹æ®æˆ‘ä»¬çš„ç­–ç•¥è½¬æ¢ä¸ºå®é™…SQLï¼Œæ¯”å¦‚ç¬¬ä¸€æ¡æ•°æ®ï¼Œå®ƒçš„idæ˜¯0ï¼Œé‚£ä¹ˆå®é™…è½¬æ¢å‡ºæ¥çš„SQLä¼šåœ¨db0è¿™ä¸ªæ•°æ®æºè¿›è¡Œæ’å…¥ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±å¾ˆè½»æ¾åœ°å®ç°äº†åˆ†åº“ç­–ç•¥ã€‚</p>
<p>åˆ†åº“å®Œæˆä¹‹åï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹åˆ†è¡¨ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬çš„æ•°æ®åº“ä¸­æœ‰<code>test_0</code>å’Œ<code>test_1</code>ä¸¤å¼ è¡¨ï¼Œè¡¨ç»“æ„ä¸€æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿæ˜¯å¸Œæœ›èƒ½å¤Ÿæ ¹æ®idå–æ¨¡è¿ç®—çš„ç»“æœåˆ†åˆ«æ”¾åˆ°è¿™ä¸¤ä¸ªä¸åŒçš„è¡¨ä¸­ï¼Œå®ç°æ€è·¯å…¶å®æ˜¯å·®ä¸å¤šçš„ï¼Œè¿™é‡Œé¦–å…ˆéœ€è¦ä»‹ç»ä¸€ä¸‹ä¸¤ç§è¡¨æ¦‚å¿µï¼š</p>
<ul>
<li><strong>é€»è¾‘è¡¨ï¼š</strong>ç›¸åŒç»“æ„çš„æ°´å¹³æ‹†åˆ†æ•°æ®åº“ï¼ˆè¡¨ï¼‰çš„é€»è¾‘åç§°ï¼Œæ˜¯ SQL ä¸­è¡¨çš„é€»è¾‘æ ‡è¯†ã€‚ ä¾‹ï¼šè®¢å•æ•°æ®æ ¹æ®ä¸»é”®å°¾æ•°æ‹†åˆ†ä¸º 10 å¼ è¡¨ï¼Œåˆ†åˆ«æ˜¯ <code>t_order_0</code> åˆ° <code>t_order_9</code>ï¼Œä»–ä»¬çš„é€»è¾‘è¡¨åä¸º <code>t_order</code></li>
<li><strong>çœŸå®è¡¨ï¼š</strong>åœ¨æ°´å¹³æ‹†åˆ†çš„æ•°æ®åº“ä¸­çœŸå®å­˜åœ¨çš„ç‰©ç†è¡¨ã€‚ å³ä¸Šä¸ªç¤ºä¾‹ä¸­çš„ <code>t_order_0</code> åˆ° <code>t_order_9</code></li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬å°±ä»¥ä¸€å·æ•°æ®åº“ä¸ºä¾‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨é‡Œé¢åˆ›å»ºä¸Šé¢æåˆ°çš„ä¸¤å¼ è¡¨ï¼Œä¹‹å‰çš„é‚£ä¸ª<code>test</code>è¡¨åˆ ä¸åˆ éƒ½å¯ä»¥ï¼Œå°±å½“åšä¸å­˜åœ¨å°±è¡Œäº†ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_0  (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  `passwd` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_1  (</span><br><span class="line">  `id` <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  `passwd` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1a8681w2ej211608u3z0.jpg" alt="image-20220415110322981"></p>
<p>æ¥ç€æˆ‘ä»¬ä¸è¦å»ä¿®æ”¹ä»»ä½•çš„ä¸šåŠ¡ä»£ç ï¼ŒMybatisé‡Œé¢å†™çš„æ˜¯ä»€ä¹ˆä¾ç„¶ä¿æŒåŸæ ·ï¼Œå³ä½¿æˆ‘ä»¬çš„è¡¨åå·²ç»å˜äº†ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯é€šè¿‡è·¯ç”±æ¥ä¿®æ”¹åŸæœ‰çš„SQLï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="attr">sharding:</span></span><br><span class="line">        <span class="attr">tables:</span></span><br><span class="line">          <span class="attr">test:</span></span><br><span class="line">            <span class="attr">actual-data-nodes:</span> <span class="string">db0.test_$-&gt;&#123;0..1&#125;</span></span><br><span class="line">            <span class="comment">#ç°åœ¨æˆ‘ä»¬æ¥é…ç½®ä¸€ä¸‹åˆ†è¡¨ç­–ç•¥ï¼Œæ³¨æ„è¿™é‡Œæ˜¯table-strategyä¸Šé¢æ˜¯database-strategy</span></span><br><span class="line">            <span class="attr">table-strategy:</span></span><br><span class="line">            	<span class="comment">#åŸºæœ¬éƒ½è·Ÿä¹‹å‰æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">              <span class="attr">standard:</span></span><br><span class="line">                <span class="attr">sharding-column:</span> <span class="string">id</span></span><br><span class="line">                <span class="attr">sharding-algorithm-name:</span> <span class="string">my-alg</span></span><br><span class="line">        <span class="attr">sharding-algorithms:</span></span><br><span class="line">          <span class="attr">my-alg:</span></span><br><span class="line">          	<span class="comment">#è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹INLINEæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªè¡Œç¼–å†™è¡¨è¾¾å¼æ¥å†³å®š</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">INLINE</span></span><br><span class="line">            <span class="attr">props:</span></span><br><span class="line">            	<span class="comment">#æ¯”å¦‚æˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›è¿›è¡Œæ¨¡2è®¡ç®—å¾—åˆ°æ•°æ®è¯¥å»çš„è¡¨</span></span><br><span class="line">            	<span class="comment">#åªéœ€è¦ç»™ä¸€ä¸ªæœ€ç»ˆçš„è¡¨åç§°å°±è¡Œäº†test_ï¼Œåé¢çš„æ•°å­—æ˜¯è¡¨è¾¾å¼å–æ¨¡ç®—å‡ºçš„</span></span><br><span class="line">            	<span class="comment">#å®é™…ä¸Šè¿™æ ·å†™å’ŒMODæ¨¡å¼ä¸€æ¨¡ä¸€æ ·</span></span><br><span class="line">              <span class="attr">algorithm-expression:</span> <span class="string">test_$-&gt;&#123;id</span> <span class="string">%</span> <span class="number">2</span><span class="string">&#125;</span></span><br><span class="line">              <span class="comment">#æ²¡é”™ï¼ŒæŸ¥è¯¢ä¹Ÿä¼šæ ¹æ®åˆ†ç‰‡ç­–ç•¥æ¥è¿›è¡Œï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯èŒƒå›´æŸ¥è¯¢ï¼Œé‚£ä¹ˆä¾ç„¶ä¼šè¿›è¡Œå…¨é‡æŸ¥è¯¢</span></span><br><span class="line">              <span class="comment">#è¿™ä¸ªæˆ‘ä»¬åé¢ç´§æ¥ç€ä¼šè®²ï¼Œè¿™é‡Œå…ˆå†™ä¸Šå§</span></span><br><span class="line">              <span class="attr">allow-range-query-with-inline-sharding:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹ä¼šä¸ä¼šæŒ‰ç…§æˆ‘ä»¬çš„ç­–ç•¥è¿›è¡Œåˆ†è¡¨æ’å…¥ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1a8w0j0ubj21q80bkgq4.jpg" alt="image-20220415112809843"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®æˆ‘ä»¬çš„ç®—æ³•ï¼ŒåŸæœ¬çš„é€»è¾‘è¡¨è¢«ä¿®æ”¹ä¸ºäº†æœ€ç»ˆè¿›è¡Œåˆ†è¡¨è®¡ç®—åçš„ç»“æœï¼Œæˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹æ•°æ®åº“ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1a8x1l1coj21800lqgnj.jpg" alt="image-20220415112908760"></p>
<p>æ’å…¥æˆ‘ä»¬äº†è§£å®Œæ¯•äº†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æŸ¥è¯¢å‘¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShardingJdbcTestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(mapper.getUserById(<span class="number">0</span>));</span><br><span class="line">        System.out.println(mapper.getUserById(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1a8znk6tuj21j408uacr.jpg" alt="image-20220415113139917"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®æˆ‘ä»¬é…ç½®çš„ç­–ç•¥ï¼ŒæŸ¥è¯¢ä¹Ÿä¼šè‡ªåŠ¨é€‰æ‹©å¯¹åº”çš„è¡¨è¿›è¡Œï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰å†…å‘³äº†ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœæ˜¯èŒƒå›´æŸ¥è¯¢å‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from test where id between #&#123;start&#125; and #&#123;end&#125;&quot;)</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">getUsersByIdRange</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShardingJdbcTestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(mapper.getUsersByIdRange(<span class="number">3</span>, <span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¥çœ‹çœ‹æ‰§è¡Œç»“æœä¼šæ€ä¹ˆæ ·ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1a93ntucij21qa07wwim.jpg" alt="image-20220415113530971"></p>
<p>å¯ä»¥çœ‹åˆ°INLINEç®—æ³•é»˜è®¤æ˜¯ä¸æ”¯æŒè¿›è¡Œå…¨é‡æŸ¥è¯¢çš„ï¼Œæˆ‘ä»¬å¾—å°†ä¸Šé¢çš„é…ç½®é¡¹æ”¹æˆtrueï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">allow-range-query-with-inline-sharding:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>å†æ¬¡è¿›è¡Œæµ‹è¯•ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1a952ev2ej21rq04wwg8.jpg" alt="image-20220415113652038"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆå‡ºæ¥çš„SQLè¯­å¥æ˜¯ç›´æ¥å¯¹ä¸¤ä¸ªè¡¨éƒ½è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åæ±‚å‡ºä¸€ä¸ªå¹¶é›†å‡ºæ¥ä½œä¸ºæœ€åçš„ç»“æœã€‚</p>
<p>å½“ç„¶é™¤äº†åˆ†ç‰‡ä¹‹å¤–ï¼Œè¿˜æœ‰å¹¿æ’­è¡¨å’Œç»‘å®šè¡¨æœºåˆ¶ï¼Œç”¨äºå¤šç§ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œè¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ï¼Œè¯¦ç»†è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h3 id="åˆ†å¸ƒå¼åºåˆ—ç®—æ³•"><a href="#åˆ†å¸ƒå¼åºåˆ—ç®—æ³•" class="headerlink" title="åˆ†å¸ƒå¼åºåˆ—ç®—æ³•"></a>åˆ†å¸ƒå¼åºåˆ—ç®—æ³•</h3><p>å‰é¢æˆ‘ä»¬è®²è§£äº†å¦‚ä½•è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹åˆ†å¸ƒå¼åºåˆ—ç®—æ³•ã€‚</p>
<p>åœ¨å¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç‰¹åˆ«æ˜¯å¾®æœæ„æ¶ä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹å¤§é‡çš„æ•°æ®å’Œæ¶ˆæ¯è¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚éšç€ç³»ç»Ÿçš„å¤æ‚ï¼Œæ•°æ®çš„å¢å¤šï¼Œåˆ†åº“åˆ†è¡¨æˆä¸ºäº†å¸¸è§çš„æ–¹æ¡ˆï¼Œå¯¹æ•°æ®åˆ†åº“åˆ†è¡¨åéœ€è¦æœ‰ä¸€ä¸ªå”¯ä¸€IDæ¥æ ‡è¯†ä¸€æ¡æ•°æ®æˆ–æ¶ˆæ¯ï¼ˆå¦‚è®¢å•å·ã€äº¤æ˜“æµæ°´ã€äº‹ä»¶ç¼–å·ç­‰ï¼‰ï¼Œæ­¤æ—¶ä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆå…¨å±€å”¯ä¸€IDçš„ç³»ç»Ÿæ˜¯éå¸¸å¿…è¦çš„ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬ä¹‹å‰åˆ›å»ºè¿‡å­¦ç”Ÿä¿¡æ¯è¡¨ã€å›¾ä¹¦å€Ÿé˜…è¡¨ã€å›¾ä¹¦ç®¡ç†è¡¨ï¼Œæ‰€æœ‰çš„ä¿¡æ¯éƒ½ä¼šæœ‰ä¸€ä¸ªIDä½œä¸ºä¸»é”®ï¼Œå¹¶ä¸”è¿™ä¸ªIDæœ‰ä»¥ä¸‹è¦æ±‚ï¼š</p>
<ul>
<li>ä¸ºäº†åŒºåˆ«äºå…¶ä»–çš„æ•°æ®ï¼Œè¿™ä¸ªIDå¿…é¡»æ˜¯å…¨å±€å”¯ä¸€çš„ã€‚</li>
<li>ä¸»é”®åº”è¯¥å°½å¯èƒ½çš„ä¿æŒæœ‰åºï¼Œè¿™æ ·ä¼šå¤§å¤§æå‡ç´¢å¼•çš„æŸ¥è¯¢æ•ˆç‡ã€‚</li>
</ul>
<p>é‚£ä¹ˆæˆ‘ä»¬åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ï¼Œå¦‚ä½•ä¿è¯IDçš„ç”Ÿæˆæ»¡è¶³ä¸Šé¢çš„éœ€æ±‚å‘¢ï¼Ÿ</p>
<ol>
<li><p><strong>ä½¿ç”¨UUIDï¼š</strong>UUIDæ˜¯ç”±ä¸€ç»„32ä½æ•°çš„16è¿›åˆ¶æ•°å­—éšæœºæ„æˆçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨JDKä¸ºæˆ‘ä»¬æä¾›çš„UUIDç±»æ¥åˆ›å»ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">    System.out.println(uuid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æœä¸º<code>73d5219b-dc0f-4282-ac6e-8df17bcd5860</code>ï¼Œç”Ÿæˆé€Ÿåº¦éå¸¸å¿«ï¼Œå¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯èƒ½å¤Ÿä¿è¯å”¯ä¸€æ€§ï¼Œå› ä¸ºæ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œè€Œä¸”è¿™ä¹ˆé•¿ä¸€ä¸²é‚£é‡å¤çš„æ¦‚ç‡çœŸçš„æ˜¯å°çš„å¯æ€œã€‚</p>
<p>ä½†æ˜¯å®ƒå¹¶ä¸æ»¡è¶³æˆ‘ä»¬ä¸Šé¢çš„ç¬¬äºŒä¸ªè¦æ±‚ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦å°½å¯èƒ½çš„ä¿è¯æœ‰åºï¼Œè€Œè¿™é‡Œæˆ‘ä»¬å¾—åˆ°çš„éƒ½æ˜¯ä¸€äº›æ— åºçš„IDã€‚</p>
</li>
<li><p><strong>é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰ï¼š</strong></p>
<p>æˆ‘ä»¬æ¥çœ‹é›ªèŠ±ç®—æ³•ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ªä¸€ä¸ª64bitå¤§å°çš„æ•´å‹çš„IDï¼Œintè‚¯å®šæ˜¯è£…ä¸ä¸‹äº†ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1af7y9xpyj213609kwf6.jpg" alt="image-20220415150713707"></p>
<p>å¯ä»¥çœ‹åˆ°å®ƒä¸»è¦æ˜¯ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œæ—¶é—´+å·¥ä½œæœºå™¨ID+åºåˆ—å·ï¼Œæ—¶é—´ä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œ41ä¸ªbitä½èƒ½è¡¨ç¤ºçº¦70å¹´çš„æ—¶é—´ï¼Œæ—¶é—´çºªå…ƒä»2016å¹´11æœˆ1æ—¥é›¶ç‚¹å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨åˆ°2086å¹´ï¼Œå·¥ä½œæœºå™¨IDå…¶å®å°±æ˜¯èŠ‚ç‚¹IDï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„IDéƒ½ä¸ç›¸åŒï¼Œé‚£ä¹ˆå°±å¯ä»¥åŒºåˆ†å‡ºæ¥ï¼Œ10ä¸ªbitä½å¯ä»¥è¡¨ç¤ºæœ€å¤š1024ä¸ªèŠ‚ç‚¹ï¼Œæœ€å12ä½å°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¸‹çš„åºåˆ—å·ï¼Œå› æ­¤æ¯å°æœºå™¨æ¯æ¯«ç§’å°±å¯ä»¥æœ‰4096ä¸ªç³»åˆ—å·ã€‚</p>
<p>è¿™æ ·ï¼Œå®ƒå°±å…¼å…·äº†ä¸Šé¢æ‰€è¯´çš„å”¯ä¸€æ€§å’Œæœ‰åºæ€§äº†ï¼Œä½†æ˜¯ä¾ç„¶æ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ—¶é—´é—®é¢˜ï¼Œå¦‚æœæœºå™¨æ—¶é—´å‡ºç°å€’é€€ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´ç”Ÿæˆé‡å¤çš„IDï¼Œå¹¶ä¸”èŠ‚ç‚¹å®¹é‡åªæœ‰1024ä¸ªï¼Œå¦‚æœæ˜¯è¶…å¤§è§„æ¨¡é›†ç¾¤ï¼Œä¹Ÿæ˜¯å­˜åœ¨éšæ‚£çš„ã€‚</p>
</li>
</ol>
<p>ShardingJDBCæ”¯æŒä»¥ä¸Šä¸¤ç§ç®—æ³•ä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”ŸæˆIDï¼Œæ–‡æ¡£ï¼š<a href="https://shardingsphere.apache.org/document/5.1.0/cn/user-manual/shardingsphere-jdbc/builtin-algorithm/keygen/">https://shardingsphere.apache.org/document/5.1.0/cn/user-manual/shardingsphere-jdbc/builtin-algorithm/keygen/</a></p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬å°±æ˜¯è¦ShardingJDBCæ¥è®©æˆ‘ä»¬çš„ä¸»é”®IDä»¥é›ªèŠ±ç®—æ³•è¿›è¡Œç”Ÿæˆï¼Œé¦–å…ˆæ˜¯é…ç½®æ•°æ®åº“ï¼Œå› ä¸ºæˆ‘ä»¬é»˜è®¤çš„idæ˜¯intç±»å‹ï¼Œè£…ä¸ä¸‹64ä½çš„ï¼Œæ”¹ä¸€ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `yyds`.`test` MODIFY <span class="keyword">COLUMN</span> `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">FIRST</span>;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹Mybatisçš„æ’å…¥è¯­å¥ï¼Œå› ä¸ºç°åœ¨idæ˜¯ç”±ShardingJDBCè‡ªåŠ¨ç”Ÿæˆï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦è‡ªå·±åŠ äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;insert into test(name, passwd) values(#&#123;name&#125;, #&#123;passwd&#125;)&quot;)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">addUser</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å°†æˆ‘ä»¬çš„ç®—æ³•å†™ä¸Šï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">sharding:</span></span><br><span class="line">        <span class="attr">tables:</span></span><br><span class="line">          <span class="attr">test:</span></span><br><span class="line">            <span class="attr">actual-data-nodes:</span> <span class="string">db0.test,db1.test</span></span><br><span class="line">            <span class="comment">#è¿™é‡Œè¿˜æ˜¯ä½¿ç”¨åˆ†åº“ç­–ç•¥</span></span><br><span class="line">            <span class="attr">database-strategy:</span></span><br><span class="line">              <span class="attr">standard:</span></span><br><span class="line">                <span class="attr">sharding-column:</span> <span class="string">id</span></span><br><span class="line">                <span class="attr">sharding-algorithm-name:</span> <span class="string">my-alg</span></span><br><span class="line">            <span class="comment">#è¿™é‡Œä½¿ç”¨è‡ªå®šä¹‰çš„ä¸»é”®ç”Ÿæˆç­–ç•¥</span></span><br><span class="line">            <span class="attr">key-generate-strategy:</span></span><br><span class="line">              <span class="attr">column:</span> <span class="string">id</span></span><br><span class="line">              <span class="attr">key-generator-name:</span> <span class="string">my-gen</span></span><br><span class="line">        <span class="attr">key-generators:</span></span><br><span class="line">        	<span class="comment">#è¿™é‡Œå†™æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸»é”®ç”Ÿæˆç®—æ³•</span></span><br><span class="line">          <span class="attr">my-gen:</span></span><br><span class="line">          	<span class="comment">#ä½¿ç”¨é›ªèŠ±ç®—æ³•</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">SNOWFLAKE</span></span><br><span class="line">            <span class="attr">props:</span></span><br><span class="line">            	<span class="comment">#å·¥ä½œæœºå™¨IDï¼Œä¿è¯å”¯ä¸€å°±è¡Œ</span></span><br><span class="line">              <span class="attr">worker-id:</span> <span class="number">666</span></span><br><span class="line">        <span class="attr">sharding-algorithms:</span></span><br><span class="line">          <span class="attr">my-alg:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">MOD</span></span><br><span class="line">            <span class="attr">props:</span></span><br><span class="line">              <span class="attr">sharding-count:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShardingJdbcTestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            mapper.addUser(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;bbb&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æ—¥å¿—ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1agbo7cqhj21fi0ein3c.jpg" alt="image-20220415154524545"></p>
<p>åœ¨æ’å…¥çš„æ—¶å€™ï¼Œå°†æˆ‘ä»¬çš„SQLè¯­å¥è‡ªè¡Œæ·»åŠ äº†ä¸€ä¸ªidå­—æ®µï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯é›ªèŠ±ç®—æ³•ç”Ÿæˆçš„å€¼ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯æ ¹æ®æˆ‘ä»¬çš„åˆ†åº“ç­–ç•¥åœ¨è¿›è¡Œæ’å…¥æ“ä½œã€‚</p>
<h3 id="è¯»å†™åˆ†ç¦»"><a href="#è¯»å†™åˆ†ç¦»" class="headerlink" title="è¯»å†™åˆ†ç¦»"></a>è¯»å†™åˆ†ç¦»</h3><p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹è¯»å†™åˆ†ç¦»ï¼Œæˆ‘ä»¬ä¹‹å‰å®ç°äº†MySQLçš„ä¸»ä»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†ä¸»åº“ä½œä¸ºè¯»ï¼Œä»åº“ä½œä¸ºå†™ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1agpivkf5j21og0ge76c.jpg" alt="image-20220415155842834"></p>
<p>è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯å°†æ•°æ®åº“å˜å›ä¸»ä»çŠ¶æ€ï¼Œç›´æ¥åˆ é™¤å½“å‰çš„è¡¨ï¼Œæˆ‘ä»¬é‡æ–°æ¥è¿‡ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> test;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦å°†ä»åº“å¼€å¯åªè¯»æ¨¡å¼ï¼Œåœ¨MySQLé…ç½®ä¸­è¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">read-only</span>    = <span class="string">1</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä»åº“å°±åªèƒ½è¯»æ•°æ®äº†ï¼ˆä½†æ˜¯rootè´¦å·è¿˜æ˜¯å¯ä»¥å†™æ•°æ®ï¼‰ï¼Œæ¥ç€æˆ‘ä»¬é‡å¯æœåŠ¡å™¨ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo systemctl restart mysql.service</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿›å…¥ä¸»åº“ï¼Œçœ‹çœ‹çŠ¶æ€ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1agtsg7urj217k07s0tx.jpg" alt="image-20220415160249024"></p>
<p>ç°åœ¨æˆ‘ä»¬é…ç½®ä¸€ä¸‹ä»åº“ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">change replication source <span class="keyword">to</span> SOURCE_HOST<span class="operator">=</span><span class="string">&#x27;192.168.0.13&#x27;</span>,SOURCE_USER<span class="operator">=</span><span class="string">&#x27;test&#x27;</span>,SOURCE_PASSWORD<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>,SOURCE_LOG_FILE<span class="operator">=</span><span class="string">&#x27;binlog.000007&#x27;</span>,SOURCE_LOG_POS<span class="operator">=</span><span class="number">19845</span>;</span><br><span class="line"><span class="keyword">start</span> replica;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬åœ¨ä¸»åº“åˆ›å»ºè¡¨ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test  (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">primary</span> key,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  `passwd` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥é…ç½®ShardingJDBCäº†ï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">    	<span class="comment">#é…ç½®è¯»å†™åˆ†ç¦»</span></span><br><span class="line">      <span class="attr">readwrite-splitting:</span></span><br><span class="line">        <span class="attr">data-sources:</span></span><br><span class="line">        	<span class="comment">#åç§°éšä¾¿å†™</span></span><br><span class="line">          <span class="attr">user-db:</span></span><br><span class="line">          	<span class="comment">#ä½¿ç”¨é™æ€ç±»å‹ï¼ŒåŠ¨æ€Dynamicç±»å‹å¯ä»¥è‡ªåŠ¨å‘ç°auto-aware-data-source-nameï¼Œè¿™é‡Œä¸æ¼”ç¤º</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">Static</span></span><br><span class="line">            <span class="attr">props:</span></span><br><span class="line">            	<span class="comment">#é…ç½®å†™åº“ï¼ˆåªèƒ½ä¸€ä¸ªï¼‰</span></span><br><span class="line">              <span class="attr">write-data-source-name:</span> <span class="string">db0</span></span><br><span class="line">              <span class="comment">#é…ç½®ä»åº“ï¼ˆå¤šä¸ªï¼Œé€—å·éš”å¼€ï¼‰</span></span><br><span class="line">              <span class="attr">read-data-source-names:</span> <span class="string">db1</span></span><br><span class="line">              <span class="comment">#è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¯ä»¥è‡ªå®šä¹‰</span></span><br><span class="line">              <span class="attr">load-balancer-name:</span> <span class="string">my-load</span></span><br><span class="line">        <span class="attr">load-balancers:</span></span><br><span class="line">        	<span class="comment">#è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥</span></span><br><span class="line">          <span class="attr">my-load:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">ROUND_ROBIN</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„æŠŠä¹‹å‰æ”¹çš„ç”¨æˆ·å®ä½“ç±»å’ŒMapperæ”¹å›å»ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸ç”¨è‡ªåŠ¨ç”ŸæˆIDçš„äº†ã€‚æ‰€æœ‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•åœ°å€ï¼š<a href="https://shardingsphere.apache.org/document/5.1.0/cn/user-manual/shardingsphere-jdbc/builtin-algorithm/load-balance/">https://shardingsphere.apache.org/document/5.1.0/cn/user-manual/shardingsphere-jdbc/builtin-algorithm/load-balance/</a></p>
<p>ç°åœ¨æˆ‘ä»¬å°±æ¥æµ‹è¯•ä¸€ä¸‹å§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShardingJdbcTestApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        mapper.addUser(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">10</span>, <span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;bbb&quot;</span>));</span><br><span class="line">        System.out.println(mapper.getUserById(<span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œçœ‹çœ‹SQLæ—¥å¿—ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h1ahjo682tj21je07udik.jpg" alt="image-20220415162741466"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œä¼šç›´æ¥å‘db0è¿›è¡Œæ“ä½œï¼Œè€Œè¯»å–æ“ä½œæ˜¯ä¼šæ ¹æ®æˆ‘ä»¬çš„é…ç½®ï¼Œé€‰æ‹©db1è¿›è¡Œæ“ä½œã€‚</p>
<p>è‡³æ­¤ï¼Œå¾®æœåŠ¡åº”ç”¨ç« èŠ‚åˆ°æ­¤ç»“æŸã€‚</p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>spring cloud</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringCloudç¬”è®°ï¼ˆäºŒï¼‰</title>
    <url>/2022/05/30/SpringCould%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    <content><![CDATA[<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ml18j1h6j21v40lkgob.jpg" alt="image-20220326001448808"></p>
<h1 id="å¾®æœåŠ¡è¿›é˜¶"><a href="#å¾®æœåŠ¡è¿›é˜¶" class="headerlink" title="å¾®æœåŠ¡è¿›é˜¶"></a>å¾®æœåŠ¡è¿›é˜¶</h1><p>å‰é¢æˆ‘ä»¬äº†è§£äº†å¾®æœåŠ¡çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å®ƒæ˜¯åŸºäºNetflixçš„è§£å†³æ–¹æ¡ˆï¼Œå®é™…ä¸Šæˆ‘ä»¬å‘ç°ï¼Œå¾ˆå¤šæ¡†æ¶éƒ½å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œæ¥çœ‹çœ‹ç›®å‰æˆ‘ä»¬æ‰€è®¤è¯†åˆ°çš„SpringCloudå„å¤§ç»„ä»¶çš„ç»´æŠ¤æƒ…å†µï¼š</p>
<ul>
<li><p><strong>æ³¨å†Œä¸­å¿ƒï¼š</strong>Eurekaï¼ˆå±äº<em>Netflix</em>ï¼Œ2.xç‰ˆæœ¬ä¸å†å¼€æºï¼Œ1.xç‰ˆæœ¬ä»åœ¨æ›´æ–°ï¼‰</p>
</li>
<li><p><strong>æœåŠ¡è°ƒç”¨ï¼š</strong>Ribbonï¼ˆå±äº<em>Netflix</em>ï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€SpringCloud Loadbalancerï¼ˆå±äº<em>SpringCloud</em>å®˜æ–¹ï¼Œç›®å‰çš„é»˜è®¤æ–¹æ¡ˆï¼‰</p>
<span id="more"></span></li>
<li><p><strong>æœåŠ¡é™çº§ï¼š</strong>Hystrixï¼ˆå±äº<em>Netflix</em>ï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰</p>
</li>
<li><p><strong>è·¯ç”±ç½‘å…³ï¼š</strong>Zuulï¼ˆå±äº<em>Netflix</em>ï¼Œåœæ­¢æ›´æ–°ï¼Œå·²ç»å½»åº•è¢«ç§»é™¤ï¼‰ã€Gatewayï¼ˆå±äº<em>SpringCloud</em>å®˜æ–¹ï¼Œæ¨èæ–¹æ¡ˆï¼‰</p>
</li>
<li><p><strong>é…ç½®ä¸­å¿ƒï¼š</strong>Configï¼ˆå±äº<em>SpringCloud</em>å®˜æ–¹ï¼‰</p>
</li>
</ul>
<p>å¯è§ï¼Œæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æ•´å¥—è§£å†³æ–¹æ¡ˆä¸­ï¼Œè¶…è¿‡åŠæ•°çš„ç»„ä»¶éƒ½å·²ç»å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œå¹¶ä¸”éƒ¨åˆ†ç»„ä»¶éƒ½æ˜¯SpringCloudå®˜æ–¹å‡ºæ‰‹æä¾›æ¡†æ¶è¿›è¡Œè§£å†³ï¼Œå› æ­¤ï¼Œå¯»æ‰¾ä¸€å¥—æ›´å¥½çš„è§£å†³æ–¹æ¡ˆåŠ¿åœ¨å¿…è¡Œï¼Œä¹Ÿå°±å¼•å‡ºäº†æˆ‘ä»¬æœ¬ç« çš„ä¸»è§’ï¼š<strong>SpringCloud Alibaba</strong></p>
<p>é˜¿é‡Œå·´å·´ä½œä¸ºä¸šç•Œçš„äº’è”ç½‘å¤§å‚ï¼Œç»™å‡ºäº†ä¸€å¥—å…¨æ–°çš„è§£å†³æ–¹æ¡ˆï¼Œå®˜æ–¹ç½‘ç«™ï¼ˆä¸­æ–‡ï¼‰ï¼š<a href="https://spring-cloud-alibaba-group.github.io/github-pages/2021/zh-cn/index.html">https://spring-cloud-alibaba-group.github.io/github-pages/2021/zh-cn/index.html</a></p>
<blockquote>
<p>Spring Cloud Alibaba è‡´åŠ›äºæä¾›å¾®æœåŠ¡å¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆã€‚æ­¤é¡¹ç›®åŒ…å«å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡çš„å¿…éœ€ç»„ä»¶ï¼Œæ–¹ä¾¿å¼€å‘è€…é€šè¿‡ Spring Cloud ç¼–ç¨‹æ¨¡å‹è½»æ¾ä½¿ç”¨è¿™äº›ç»„ä»¶æ¥å¼€å‘åˆ†å¸ƒå¼åº”ç”¨æœåŠ¡ã€‚</p>
<p>ä¾æ‰˜ Spring Cloud Alibabaï¼Œæ‚¨åªéœ€è¦æ·»åŠ ä¸€äº›æ³¨è§£å’Œå°‘é‡é…ç½®ï¼Œå°±å¯ä»¥å°† Spring Cloud åº”ç”¨æ¥å…¥é˜¿é‡Œåˆ†å¸ƒå¼åº”ç”¨è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡é˜¿é‡Œä¸­é—´ä»¶æ¥è¿…é€Ÿæ­å»ºåˆ†å¸ƒå¼åº”ç”¨ç³»ç»Ÿã€‚</p>
</blockquote>
<p>ç›®å‰ Spring Cloud Alibaba æä¾›äº†å¦‚ä¸‹åŠŸèƒ½:</p>
<ol>
<li><strong>æœåŠ¡é™æµé™çº§</strong>ï¼šæ”¯æŒ WebServletã€WebFlux, OpenFeignã€RestTemplateã€Dubbo é™æµé™çº§åŠŸèƒ½çš„æ¥å…¥ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡æ§åˆ¶å°å®æ—¶ä¿®æ”¹é™æµé™çº§è§„åˆ™ï¼Œè¿˜æ”¯æŒæŸ¥çœ‹é™æµé™çº§ Metrics ç›‘æ§ã€‚</li>
<li><strong>æœåŠ¡æ³¨å†Œä¸å‘ç°</strong>ï¼šé€‚é… Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æ ‡å‡†ï¼Œé»˜è®¤é›†æˆäº† Ribbon çš„æ”¯æŒã€‚</li>
<li><strong>åˆ†å¸ƒå¼é…ç½®ç®¡ç†</strong>ï¼šæ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤–éƒ¨åŒ–é…ç½®ï¼Œé…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ã€‚</li>
<li><strong>RpcæœåŠ¡</strong>ï¼šæ‰©å±• Spring Cloud å®¢æˆ·ç«¯ RestTemplate å’Œ OpenFeignï¼Œæ”¯æŒè°ƒç”¨ Dubbo RPC æœåŠ¡</li>
<li><strong>æ¶ˆæ¯é©±åŠ¨èƒ½åŠ›</strong>ï¼šåŸºäº Spring Cloud Stream ä¸ºå¾®æœåŠ¡åº”ç”¨æ„å»ºæ¶ˆæ¯é©±åŠ¨èƒ½åŠ›ã€‚</li>
<li><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼šä½¿ç”¨ @GlobalTransactional æ³¨è§£ï¼Œ é«˜æ•ˆå¹¶ä¸”å¯¹ä¸šåŠ¡é›¶ä¾µå…¥åœ°è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚</li>
<li><strong>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨</strong>ï¼šé˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ”¯æŒåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹å­˜å‚¨å’Œè®¿é—®ä»»æ„ç±»å‹çš„æ•°æ®ã€‚</li>
<li><strong>åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦</strong>ï¼šæä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ï¼ˆåŸºäº Cron è¡¨è¾¾å¼ï¼‰ä»»åŠ¡è°ƒåº¦æœåŠ¡ã€‚åŒæ—¶æä¾›åˆ†å¸ƒå¼çš„ä»»åŠ¡æ‰§è¡Œæ¨¡å‹ï¼Œå¦‚ç½‘æ ¼ä»»åŠ¡ã€‚ç½‘æ ¼ä»»åŠ¡æ”¯æŒæµ·é‡å­ä»»åŠ¡å‡åŒ€åˆ†é…åˆ°æ‰€æœ‰ Workerï¼ˆschedulerx-clientï¼‰ä¸Šæ‰§è¡Œã€‚</li>
<li><strong>é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡</strong>ï¼šè¦†ç›–å…¨çƒçš„çŸ­ä¿¡æœåŠ¡ï¼Œå‹å¥½ã€é«˜æ•ˆã€æ™ºèƒ½çš„äº’è”åŒ–é€šè®¯èƒ½åŠ›ï¼Œå¸®åŠ©ä¼ä¸šè¿…é€Ÿæ­å»ºå®¢æˆ·è§¦è¾¾é€šé“ã€‚</li>
</ol>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒSpringCloudAlibabaå®é™…ä¸Šæ˜¯å¯¹æˆ‘ä»¬çš„SpringCloudç»„ä»¶å¢å¼ºåŠŸèƒ½ï¼Œæ˜¯SpringCloudçš„å¢å¼ºæ¡†æ¶ï¼Œå¯ä»¥å…¼å®¹SpringCloudåŸç”Ÿç»„ä»¶å’ŒSpringCloudAlibabaçš„ç»„ä»¶ã€‚</p>
<p>å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼ŒæŠŠæˆ‘ä»¬ä¹‹å‰æ‰“åŒ…å¥½çš„æ‹†åˆ†é¡¹ç›®è§£å‹ï¼Œæˆ‘ä»¬å°†åŸºäºå®ƒè¿›è¡Œè®²è§£ã€‚</p>
<hr>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n3ym3j2sj20pg02qa9x.jpg" alt="image-20220326110940692"></p>
<h2 id="Nacos-æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ"><a href="#Nacos-æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="Nacos æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ"></a>Nacos æ›´åŠ å…¨èƒ½çš„æ³¨å†Œä¸­å¿ƒ</h2><p>Nacosï¼ˆ<strong>Na</strong>ming <strong>Co</strong>nfiguration <strong>S</strong>erviceï¼‰æ˜¯ä¸€æ¬¾é˜¿é‡Œå·´å·´å¼€æºçš„æœåŠ¡æ³¨å†Œä¸å‘ç°ã€é…ç½®ç®¡ç†çš„ç»„ä»¶ï¼Œç›¸å½“äºæ˜¯Eureka+Configçš„ç»„åˆå½¢æ€ã€‚</p>
<h3 id="å®‰è£…ä¸éƒ¨ç½²"><a href="#å®‰è£…ä¸éƒ¨ç½²" class="headerlink" title="å®‰è£…ä¸éƒ¨ç½²"></a>å®‰è£…ä¸éƒ¨ç½²</h3><p>NacosæœåŠ¡å™¨æ˜¯ç‹¬ç«‹å®‰è£…éƒ¨ç½²çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸‹è½½æœ€æ–°çš„NacosæœåŠ¡ç«¯ç¨‹åºï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://github.com/alibaba/nacos%EF%BC%8C%E8%BF%9E%E4%B8%8D%E4%B8%8A%E5%8F%AF%E4%BB%A5%E5%88%B0%E8%A7%86%E9%A2%91%E4%B8%8B%E6%96%B9%E4%BA%91%E7%9B%98%E4%B8%AD%E4%B8%8B%E8%BD%BD%E3%80%82">https://github.com/alibaba/nacosï¼Œè¿ä¸ä¸Šå¯ä»¥åˆ°è§†é¢‘ä¸‹æ–¹äº‘ç›˜ä¸­ä¸‹è½½ã€‚</a></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0n6x7gxp1j22qs0ms0x0.jpg" alt="image-20220326125206549"></p>
<p>å¯ä»¥çœ‹åˆ°ç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯<code>1.4.3</code>ç‰ˆæœ¬ï¼ˆ2022å¹´2æœˆ27æ—¥å‘å¸ƒçš„ï¼‰ï¼Œæˆ‘ä»¬ç›´æ¥ä¸‹è½½<code>zip</code>æ–‡ä»¶å³å¯ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬å°†æ–‡ä»¶è¿›è¡Œè§£å‹ï¼Œå¾—åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n749lottj215a08swfh.jpg" alt="image-20220326125854416"></p>
<p>æˆ‘ä»¬ç›´æ¥å°†å…¶æ‹–å…¥åˆ°é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ï¼Œä¾¿äºæˆ‘ä»¬ä¸€ä¼šåœ¨IDEAå†…éƒ¨å¯åŠ¨ï¼Œæ¥ç€æ·»åŠ è¿è¡Œé…ç½®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n798coaxj226a0i279d.jpg" alt="image-20220326130340573"></p>
<p>å…¶ä¸­<code>-m standalone</code>è¡¨ç¤ºå•èŠ‚ç‚¹æ¨¡å¼ï¼ŒMacå’ŒLinuxä¸‹è®°å¾—å°†è§£é‡Šå™¨è®¾å®šä¸º<code>/bin/bash</code>ï¼Œç”±äºNacosåœ¨Mac/Linuxé»˜è®¤æ˜¯åå°å¯åŠ¨æ¨¡å¼ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹å®ƒçš„bashæ–‡ä»¶ï¼Œè®©å®ƒå˜æˆå‰å°å¯åŠ¨ï¼Œè¿™æ ·IDEAå…³é—­äº†Nacoså°±è‡ªåŠ¨å…³é—­äº†ï¼Œå¦åˆ™å¼€å‘ç¯å¢ƒä¸‹å¾ˆå®¹æ˜“å¿˜è®°å…³ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ³¨é‡Šæ‰ nohup $JAVA $&#123;JAVA_OPT&#125; nacos.nacos &gt;&gt; $&#123;BASE_DIR&#125;/logs/start.out 2&gt;&amp;1 &amp;</span></span><br><span class="line"><span class="comment"># æ›¿æ¢æˆä¸‹é¢çš„</span></span><br><span class="line"><span class="variable">$JAVA</span> <span class="variable">$&#123;JAVA_OPT&#125;</span> nacos.nacos</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬ç‚¹å‡»å¯åŠ¨ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n7r3rhzqj22o80jw0wb.jpg" alt="image-20220326132051779"></p>
<p>OKï¼Œå¯åŠ¨æˆåŠŸï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„ç®¡ç†é¡µé¢åœ°å€ä¹Ÿæ˜¯ç»™æˆ‘ä»¬è´´å‡ºæ¥äº†ï¼š <a href="http://localhost:8848/nacos/index.html%EF%BC%8C%E8%AE%BF%E9%97%AE%E8%BF%99%E4%B8%AA%E5%9C%B0%E5%9D%80%EF%BC%9A">http://localhost:8848/nacos/index.htmlï¼Œè®¿é—®è¿™ä¸ªåœ°å€ï¼š</a></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n7s92e4jj21lh0u0whw.jpg" alt="image-20220326132157126"></p>
<p>é»˜è®¤çš„ç”¨æˆ·åå’Œç®¡ç†å‘˜å¯†ç éƒ½æ˜¯<code>nacos</code>ï¼Œç›´æ¥ç™»é™†å³å¯ï¼Œå¯ä»¥çœ‹åˆ°è¿›å…¥ç®¡ç†é¡µé¢ä¹‹ååŠŸèƒ½ä¹Ÿæ˜¯ç›¸å½“ä¸°å¯Œï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n7vcjn7oj22mg0p6dj0.jpg" alt="image-20220326132455674"></p>
<p>è‡³æ­¤ï¼ŒNacosçš„å®‰è£…ä¸éƒ¨ç½²å®Œæˆã€‚</p>
<h3 id="æœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#æœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="æœåŠ¡æ³¨å†Œä¸å‘ç°"></a>æœåŠ¡æ³¨å†Œä¸å‘ç°</h3><p>ç°åœ¨æˆ‘ä»¬è¦å®ç°åŸºäºNacosçš„æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¼å…¥SpringCloudAlibabaç›¸å…³çš„ä¾èµ–ï¼Œæˆ‘ä»¬åœ¨çˆ¶å·¥ç¨‹å°†ä¾èµ–è¿›è¡Œç®¡ç†ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      	<span class="comment">&lt;!-- è¿™é‡Œå¼•å…¥æœ€æ–°çš„SpringCloudä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">          	<span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     	  <span class="comment">&lt;!-- è¿™é‡Œå¼•å…¥æœ€æ–°çš„SpringCloudAlibabaä¾èµ–ï¼Œ2021.0.1.0ç‰ˆæœ¬æ”¯æŒSpringBoot2.6.X --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥åœ¨å­é¡¹ç›®ä¸­æ·»åŠ æœåŠ¡å‘ç°ä¾èµ–äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬ä»¥å›¾ä¹¦æœåŠ¡ä¸ºä¾‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å’Œæ³¨å†Œåˆ°Eurekaä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®Nacosæ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">	<span class="comment"># ä¹‹åæ‰€æœ‰çš„å›¾ä¹¦æœåŠ¡èŠ‚ç‚¹å°±81XXç«¯å£</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8101</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://cloudstudy.mysql.cn-chengdu.rds.aliyuncs.com:3306/cloudstudy</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">test</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="comment"># åº”ç”¨åç§° bookservice</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">bookservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="comment"># é…ç½®Nacosæ³¨å†Œä¸­å¿ƒåœ°å€</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€å¯åŠ¨æˆ‘ä»¬çš„å›¾ä¹¦æœåŠ¡ï¼Œå¯ä»¥åœ¨Nacosçš„æœåŠ¡åˆ—è¡¨ä¸­æ‰¾åˆ°ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0n8xfhqcaj22lw0egdih.jpg" alt="image-20220326140130226"></p>
<p>æŒ‰ç…§åŒæ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ç€å°†å¦å¤–ä¸¤ä¸ªæœåŠ¡ä¹Ÿæ³¨å†Œåˆ°Nacosä¸­ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0n92f2wthj22d00ckdi1.jpg" alt="image-20220326140618708"></p>
<p>æ¥ç€æˆ‘ä»¬ä½¿ç”¨OpenFeignï¼Œå®ç°æœåŠ¡å‘ç°è¿œç¨‹è°ƒç”¨ä»¥åŠè´Ÿè½½å‡è¡¡ï¼Œå¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è¿™é‡Œéœ€è¦å•ç‹¬å¯¼å…¥LoadBalancerä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç¼–å†™æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/&#123;uid&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;bookservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/&#123;bid&#125;&quot;)</span></span><br><span class="line">    Book <span class="title function_">getBookById</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> bid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BorrowService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserClient userClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BookClient bookClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getUserBorrowDetailByUid</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrow = mapper.getBorrowsByUid(uid);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userClient.getUserById(uid);</span><br><span class="line">        List&lt;Book&gt; bookList = borrow</span><br><span class="line">                .stream()</span><br><span class="line">                .map(b -&gt; bookClient.getBookById(b.getBid()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(user, bookList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BorrowApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬è¿›è¡Œæµ‹è¯•ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n9kaxje1j228c074q4h.jpg" alt="image-20220326142331199"></p>
<p>æµ‹è¯•æ­£å¸¸ï¼Œå¯ä»¥è‡ªåŠ¨å‘ç°æœåŠ¡ï¼Œæ¥ç€æˆ‘ä»¬æ¥å¤šé…ç½®å‡ ä¸ªå®ä¾‹ï¼Œå»æ‰å›¾ä¹¦æœåŠ¡å’Œç”¨æˆ·æœåŠ¡çš„ç«¯å£é…ç½®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n9otepuuj21lk0lin0g.jpg" alt="image-20220326142751398"></p>
<p>ç„¶åæˆ‘ä»¬åœ¨å›¾ä¹¦æœåŠ¡å’Œç”¨æˆ·æœåŠ¡ä¸­æ·»åŠ ä¸€å¥æ‰“å°æ–¹ä¾¿ä¹‹åæŸ¥çœ‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/user/&#123;uid&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;è°ƒç”¨ç”¨æˆ·æœåŠ¡&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> service.getUserById(uid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å°†å…¨éƒ¨æœåŠ¡å¯åŠ¨ï¼š<br><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n9qxup53j223g0eqaix.jpg" alt="image-20220326142953904"></p>
<p>å¯ä»¥çœ‹åˆ°Nacosä¸­çš„å®ä¾‹æ•°é‡å·²ç»æ˜¾ç¤ºä¸º<code>2</code>ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n9rc8v0wj22cg0g6goj.jpg" alt="image-20220326143017054"></p>
<p>æ¥ç€æˆ‘ä»¬è°ƒç”¨å€Ÿé˜…æœåŠ¡ï¼Œçœ‹çœ‹èƒ½å¦è´Ÿè½½å‡è¡¡è¿œç¨‹è°ƒç”¨ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n9s2ioeqj225o07ytaa.jpg" alt="image-20220326143058939"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0n9sh0wr0j21x20gswne.jpg" alt="image-20220326143122333"></p>
<p>OKï¼Œè´Ÿè½½å‡è¡¡è¿œç¨‹è°ƒç”¨æ²¡æœ‰é—®é¢˜ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®ç°äº†åŸºäºNacosçš„æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ï¼Œå®é™…ä¸Šå¤§è‡´æµç¨‹ä¸Eurekaä¸€è‡´ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒNacosåŒºåˆ†äº†ä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0nc2h4gy2j22ay072q44.jpg" alt="image-20220326155010841"></p>
<p>é‚£ä¹ˆä¸´æ—¶å’Œéä¸´æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<ul>
<li>ä¸´æ—¶å®ä¾‹ï¼šå’ŒEurekaä¸€æ ·ï¼Œé‡‡ç”¨å¿ƒè·³æœºåˆ¶å‘Nacoså‘é€è¯·æ±‚ä¿æŒåœ¨çº¿çŠ¶æ€ï¼Œä¸€æ—¦å¿ƒè·³åœæ­¢ï¼Œä»£è¡¨å®ä¾‹ä¸‹çº¿ï¼Œä¸ä¿ç•™å®ä¾‹ä¿¡æ¯ã€‚</li>
<li>éä¸´æ—¶å®ä¾‹ï¼šç”±Nacosä¸»åŠ¨è¿›è¡Œè”ç³»ï¼Œå¦‚æœè¿æ¥å¤±è´¥ï¼Œé‚£ä¹ˆä¸ä¼šç§»é™¤å®ä¾‹ä¿¡æ¯ï¼Œè€Œæ˜¯å°†å¥åº·çŠ¶æ€è®¾å®šä¸ºfalseï¼Œç›¸å½“äºä¼šå¯¹æŸä¸ªå®ä¾‹çŠ¶æ€æŒç»­åœ°è¿›è¡Œç›‘æ§ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ä¸´æ—¶å®ä¾‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">borrowservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="comment"># å°†ephemeralä¿®æ”¹ä¸ºfalseï¼Œè¡¨ç¤ºéä¸´æ—¶å®ä¾‹</span></span><br><span class="line">        <span class="attr">ephemeral:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åœ¨Nacosä¸­æŸ¥çœ‹ï¼Œå¯ä»¥å‘ç°å®ä¾‹å·²ç»ä¸æ˜¯ä¸´æ—¶çš„äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0nc8g1llrj22be06iq3y.jpg" alt="image-20220326155554821"></p>
<p>å¦‚æœè¿™æ—¶æˆ‘ä»¬å…³é—­æ­¤å®ä¾‹ï¼Œé‚£ä¹ˆä¼šå˜æˆè¿™æ ·ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0nc93w8zlj22bq06mmy5.jpg" alt="image-20220326155633190"></p>
<p>åªæ˜¯å°†å¥åº·çŠ¶æ€å˜ä¸ºfalseï¼Œè€Œä¸ä¼šåˆ é™¤å®ä¾‹çš„ä¿¡æ¯ã€‚</p>
<h3 id="é›†ç¾¤åˆ†åŒº"><a href="#é›†ç¾¤åˆ†åŒº" class="headerlink" title="é›†ç¾¤åˆ†åŒº"></a>é›†ç¾¤åˆ†åŒº</h3><p>å®é™…ä¸Šé›†ç¾¤åˆ†åŒºæ¦‚å¿µåœ¨ä¹‹å‰çš„Eurekaä¸­ä¹Ÿæœ‰å‡ºç°ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">		<span class="attr">fetch-registry:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8888/eureka</span></span><br><span class="line">      <span class="comment"># è¿™ä¸ªdefaultZoneæ˜¯ä¸ªå•¥ç©æ„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¸ªåç§°ï¼Ÿä¸ºä»€ä¹ˆè¦è¦ç”¨è¿™æ ·çš„å½¢å¼æ¥å£°æ˜æ³¨å†Œä¸­å¿ƒï¼Ÿ</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨ä¸­ï¼Œç›¸åŒæœåŠ¡çš„å®ä¾‹å¯èƒ½ä¼šåœ¨ä¸åŒçš„æœºå™¨ã€ä½ç½®ä¸Šå¯åŠ¨ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ç”¨æˆ·ç®¡ç†æœåŠ¡ï¼Œå¯èƒ½åœ¨æˆéƒ½æœ‰1å°æœåŠ¡å™¨éƒ¨ç½²ã€é‡åº†æœ‰ä¸€å°æœåŠ¡å™¨éƒ¨ç½²ï¼Œè€Œè¿™æ—¶ï¼Œæˆ‘ä»¬åœ¨æˆéƒ½çš„æœåŠ¡å™¨ä¸Šå¯åŠ¨äº†å€Ÿé˜…æœåŠ¡ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬çš„å€Ÿé˜…æœåŠ¡ç°åœ¨è¦è°ƒç”¨ç”¨æˆ·æœåŠ¡ï¼Œå°±åº”è¯¥ä¼˜å…ˆé€‰æ‹©åŒä¸€ä¸ªåŒºåŸŸçš„ç”¨æˆ·æœåŠ¡è¿›è¡Œè°ƒç”¨ï¼Œè¿™æ ·ä¼šä½¿å¾—å“åº”é€Ÿåº¦æ›´å¿«ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0namonso5j21em0bcgnr.jpg" alt="image-20220326150024118"></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹éƒ¨ç½²åœ¨ä¸åŒæœºæˆ¿çš„æœåŠ¡è¿›è¡Œåˆ†åŒºï¼Œå¯ä»¥çœ‹åˆ°å®ä¾‹çš„åˆ†åŒºæ˜¯é»˜è®¤ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0nanxl0kkj22cm0hawh5.jpg" alt="image-20220326150136538"></p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">borrowservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="comment"># ä¿®æ”¹ä¸ºé‡åº†åœ°åŒºçš„é›†ç¾¤</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">Chongqing</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ç”±äºæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸åŒçš„å¯åŠ¨é…ç½®ï¼Œç›´æ¥åœ¨å¯åŠ¨é…ç½®ä¸­æ·»åŠ ç¯å¢ƒå˜é‡<code>spring.cloud.nacos.discovery.cluster-name</code>ä¹Ÿè¡Œï¼Œè¿™é‡Œæˆ‘ä»¬å°†ç”¨æˆ·æœåŠ¡å’Œå›¾ä¹¦æœåŠ¡ä¸¤ä¸ªåŒºåŸŸéƒ½åˆ†é…ä¸€ä¸ªï¼Œå€Ÿé˜…æœåŠ¡å°±é…ç½®ä¸ºæˆéƒ½åœ°åŒºï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0nars805bj216c08ot9x.jpg" alt="image-20220326150518357"></p>
<p>ä¿®æ”¹å®Œæˆä¹‹åï¼Œæˆ‘ä»¬æ¥å°è¯•é‡æ–°å¯åŠ¨ä¸€ä¸‹ï¼ˆNacosä¹Ÿè¦é‡å¯ï¼‰ï¼Œè§‚å¯ŸNacosä¸­é›†ç¾¤åˆ†å¸ƒæƒ…å†µï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0nawm1jraj22ck0u0wij.jpg" alt="image-20220326150956937"></p>
<p>å¯ä»¥çœ‹åˆ°ç°åœ¨æœ‰ä¸¤ä¸ªé›†ç¾¤ï¼Œå¹¶ä¸”éƒ½æœ‰ä¸€ä¸ªå®ä¾‹æ­£åœ¨è¿è¡Œã€‚æˆ‘ä»¬æ¥ç€å»è°ƒç”¨å€Ÿé˜…æœåŠ¡ï¼Œä½†æ˜¯å‘ç°å¹¶æ²¡æœ‰æŒ‰ç…§åŒºåŸŸè¿›è¡Œä¼˜å…ˆè°ƒç”¨ï¼Œè€Œä¾ç„¶ä½¿ç”¨çš„æ˜¯è½®è¯¢æ¨¡å¼çš„è´Ÿè½½å‡è¡¡è°ƒç”¨ã€‚</p>
<p>æˆ‘ä»¬å¿…é¡»è¦æä¾›Nacosçš„è´Ÿè½½å‡è¡¡å®ç°æ‰èƒ½å¼€å¯åŒºåŸŸä¼˜å…ˆè°ƒç”¨æœºåˆ¶ï¼Œåªéœ€è¦åœ¨é…åˆ¶æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹å³å¯ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">borrowservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">Chengdu</span></span><br><span class="line">    <span class="comment"># å°†loadbalancerçš„nacosæ”¯æŒå¼€å¯ï¼Œé›†æˆNacosè´Ÿè½½å‡è¡¡</span></span><br><span class="line">    <span class="attr">loadbalancer:</span></span><br><span class="line">      <span class="attr">nacos:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬é‡å¯å€Ÿé˜…æœåŠ¡ï¼Œä¼šå‘ç°ä¼˜å…ˆè°ƒç”¨çš„æ˜¯åŒåŒºåŸŸçš„ç”¨æˆ·å’Œå›¾ä¹¦æœåŠ¡ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å°†æˆéƒ½åœ°åŒºçš„æœåŠ¡ä¸‹çº¿ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0nbhisubdj22d20ekjtk.jpg" alt="image-20220326153002500"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸‹çº¿ä¹‹åï¼Œç”±äºæœ¬åŒºåŸŸå†…æ²¡æœ‰å¯ç”¨æœåŠ¡äº†ï¼Œå€Ÿé˜…æœåŠ¡å°†ä¼šè°ƒç”¨é‡åº†åŒºåŸŸçš„ç”¨æˆ·æœåŠ¡ã€‚</p>
<p>é™¤äº†æ ¹æ®åŒºåŸŸä¼˜å…ˆè°ƒç”¨ä¹‹å¤–ï¼ŒåŒä¸€ä¸ªåŒºåŸŸå†…çš„å®ä¾‹ä¹Ÿå¯ä»¥å•ç‹¬è®¾ç½®æƒé‡ï¼ŒNacosä¼šä¼˜å…ˆé€‰æ‹©æƒé‡æ›´å¤§çš„å®ä¾‹è¿›è¡Œè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ç®¡ç†é¡µé¢ä¸­è¿›è¡Œé…ç½®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0nbecloluj22co0n841e.jpg" alt="image-20220326152659294"></p>
<p>æˆ–æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">borrowservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">Chengdu</span></span><br><span class="line">        <span class="comment"># æƒé‡å¤§å°ï¼Œè¶Šå¤§è¶Šä¼˜å…ˆè°ƒç”¨ï¼Œé»˜è®¤ä¸º1</span></span><br><span class="line">        <span class="attr">weight:</span> <span class="number">0.5</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡é…ç½®æƒé‡ï¼ŒæŸäº›æ€§èƒ½ä¸å¤ªå¥½çš„æœºå™¨å°±èƒ½å¤Ÿæ›´å°‘åœ°è¢«ä½¿ç”¨ï¼Œè€Œæ›´å¤šçš„ä½¿ç”¨é‚£äº›ç½‘ç»œè‰¯å¥½æ€§èƒ½æ›´é«˜çš„ä¸»æœºä¸Šçš„å®ä¾‹ã€‚</p>
<h3 id="é…ç½®ä¸­å¿ƒ"><a href="#é…ç½®ä¸­å¿ƒ" class="headerlink" title="é…ç½®ä¸­å¿ƒ"></a>é…ç½®ä¸­å¿ƒ</h3><p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº†SpringCloud Configï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®æœåŠ¡æ¥åŠ è½½è¿œç¨‹é…ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨è¿œç«¯é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶ã€‚</p>
<p>å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥åœ¨<code>bootstrap.yml</code>ä¸­é…ç½®è¿œç¨‹é…ç½®æ–‡ä»¶è·å–ï¼Œç„¶åå†è¿›å…¥åˆ°é…ç½®æ–‡ä»¶åŠ è½½ç¯èŠ‚ï¼Œè€ŒNacosä¹Ÿæ”¯æŒè¿™æ ·çš„æ“ä½œï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿæ¯”è¾ƒç±»ä¼¼ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨æƒ³è¦å°†å€Ÿé˜…æœåŠ¡çš„é…ç½®æ–‡ä»¶æ”¾åˆ°Nacosè¿›è¡Œç®¡ç†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦åœ¨Nacosä¸­åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ncoc8fwqj22mq0gidi8.jpg" alt="image-20220326161111523"></p>
<p>å°†å€Ÿé˜…æœåŠ¡çš„é…ç½®æ–‡ä»¶å…¨éƒ¨ï¼ˆå½“ç„¶æ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸ä¼šå…¨éƒ¨CVçš„ï¼Œåªä¼šå¤åˆ¶é‚£äº›éœ€è¦ç»å¸¸ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œè¿™é‡Œä¸ºäº†çœäº‹å°±ç›´æ¥å…¨éƒ¨CVäº†ï¼‰å¤åˆ¶è¿‡æ¥ï¼Œæ³¨æ„<strong>Data ID</strong>çš„æ ¼å¼è·Ÿæˆ‘ä»¬ä¹‹å‰ä¸€æ ·ï¼Œ<code>åº”ç”¨åç§°-ç¯å¢ƒ.yml</code>ï¼Œå¦‚æœåªç¼–å†™åº”ç”¨åç§°ï¼Œé‚£ä¹ˆä»£è¡¨æ­¤é…ç½®æ–‡ä»¶æ— è®ºåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹éƒ½ä¼šä½¿ç”¨ï¼Œç„¶åæ¯ä¸ªé…ç½®æ–‡ä»¶éƒ½å¯ä»¥è¿›è¡Œåˆ†ç»„ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§åˆ†ç±»æ–¹å¼ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ncyoyq7ij21sw0u0n0o.jpg" alt="image-20220326162108899"></p>
<p>å®Œæˆä¹‹åç‚¹å‡»å‘å¸ƒå³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ncyx3tjnj22cs0bedhs.jpg" alt="image-20220326162122134"></p>
<p>ç„¶ååœ¨é¡¹ç›®ä¸­å¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åœ¨å€Ÿé˜…æœåŠ¡ä¸­æ·»åŠ <code>bootstrap.yml</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">  	<span class="comment"># æœåŠ¡åç§°å’Œé…ç½®æ–‡ä»¶ä¿æŒä¸€è‡´</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">borrowservice</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">  	<span class="comment"># ç¯å¢ƒä¹Ÿæ˜¯å’Œé…ç½®æ–‡ä»¶ä¿æŒä¸€è‡´</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">      	<span class="comment"># é…ç½®æ–‡ä»¶åç¼€å</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span></span><br><span class="line">        <span class="comment"># é…ç½®ä¸­å¿ƒæœåŠ¡å™¨åœ°å€ï¼Œä¹Ÿå°±æ˜¯Nacosåœ°å€</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¯åŠ¨æœåŠ¡è¯•è¯•çœ‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ndcx7e8sj22lw0eiwlz.jpg" alt="image-20220326163449032"></p>
<p>å¯ä»¥çœ‹åˆ°æˆåŠŸè¯»å–é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨äº†ï¼Œå®é™…ä¸Šä½¿ç”¨ä¸Šæ¥è¯´è·Ÿä¹‹å‰çš„Configæ˜¯åŸºæœ¬ä¸€è‡´çš„ã€‚</p>
<p>Nacosè¿˜æ”¯æŒé…ç½®æ–‡ä»¶çš„çƒ­æ›´æ–°ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œè€Œè¿™ä¸ªæ—¶å€™å¯èƒ½éœ€è¦å®æ—¶ä¿®æ”¹ï¼Œå¹¶åœ¨åç«¯å®æ—¶æ›´æ–°ï¼Œé‚£ä¹ˆè¿™ç§è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„Controllerï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.txt&#125;&quot;)</span>  <span class="comment">//æˆ‘ä»¬ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–test.txtçš„å­—ç¬¦ä¸²å€¼ï¼Œä½œä¸ºtestæ¥å£çš„è¿”å›å€¼</span></span><br><span class="line">    String txt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> txt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œç„¶åé‡å¯æœåŠ¡å™¨ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ndkk16naj22bs0lstc8.jpg" alt="image-20220326164209154"></p>
<p>å¯ä»¥çœ‹åˆ°å·²ç»å¯ä»¥æ­£å¸¸è¯»å–äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ndljhdc8j217e06it93.jpg" alt="image-20220326164306032"></p>
<p>ç°åœ¨æˆ‘ä»¬å°†é…ç½®æ–‡ä»¶çš„å€¼è¿›è¡Œä¿®æ”¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ndo2g2ouj210e04mmxb.jpg" alt="image-20220326164531412"></p>
<p>å†æ¬¡è®¿é—®æ¥å£ï¼Œä¼šå‘ç°æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ndodjuhkj2126068jrq.jpg" alt="image-20220326164549862"></p>
<p>ä½†æ˜¯åå°æ˜¯æˆåŠŸæ£€æµ‹åˆ°å€¼æ›´æ–°äº†ï¼Œä½†æ˜¯å€¼å´æ²¡æ”¹å˜ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ndpco63fj222e03cq4n.jpg" alt="image-20220326164645791"></p>
<p>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½å®ç°é…ç½®çƒ­æ›´æ–°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span>   <span class="comment">//æ·»åŠ æ­¤æ³¨è§£å°±èƒ½å®ç°è‡ªåŠ¨åˆ·æ–°äº†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.txt&#125;&quot;)</span></span><br><span class="line">    String txt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> txt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡å¯æœåŠ¡å™¨ï¼Œå†æ¬¡é‡å¤ä¸Šè¿°å®éªŒï¼ŒæˆåŠŸã€‚</p>
<h3 id="å‘½åç©ºé—´"><a href="#å‘½åç©ºé—´" class="headerlink" title="å‘½åç©ºé—´"></a>å‘½åç©ºé—´</h3><p>æˆ‘ä»¬è¿˜å¯ä»¥å°†é…ç½®æ–‡ä»¶æˆ–æ˜¯æœåŠ¡å®ä¾‹åˆ’åˆ†åˆ°ä¸åŒçš„å‘½åç©ºé—´ä¸­ï¼Œå…¶å®å°±æ˜¯åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒæˆ–æ˜¯å¼•ç”¨å½’å±ä¹‹ç±»çš„ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0new72nlcj22ci0bat9o.jpg" alt="image-20220326172756819"></p>
<p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å‘½åç©ºé—´ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0nf6e5ml4j22aa0j875n.jpg" alt="image-20220326173744551"></p>
<p>å¯ä»¥çœ‹åˆ°åœ¨devå‘½åç©ºé—´ä¸‹ï¼Œæ²¡æœ‰ä»»ä½•é…ç½®æ–‡ä»¶å’ŒæœåŠ¡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0nfmz4j3gj22mq0j6gom.jpg" alt="image-20220326175340892"></p>
<p>æˆ‘ä»¬åœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸‹ï¼Œå®ä¾‹å’Œé…ç½®éƒ½æ˜¯ç›¸äº’ä¹‹é—´éš”ç¦»çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå½“å‰çš„å‘½åç©ºé—´ã€‚</p>
<h3 id="å®ç°é«˜å¯ç”¨"><a href="#å®ç°é«˜å¯ç”¨" class="headerlink" title="å®ç°é«˜å¯ç”¨"></a>å®ç°é«˜å¯ç”¨</h3><p>ç”±äºNacosæš‚ä¸æ”¯æŒArmæ¶æ„èŠ¯ç‰‡çš„Macé›†ç¾¤æ­å»ºï¼Œæœ¬å°èŠ‚ç”¨Linxuäº‘ä¸»æœºï¼ˆNacosæ¯”è¾ƒåƒå†…å­˜ï¼Œ2ä¸ªNacosæœåŠ¡å™¨é›†ç¾¤ï¼Œè‡³å°‘2Gå†…å­˜ï¼‰ç¯å¢ƒæ¼”ç¤ºã€‚</p>
<p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨Nacosä»¥åŠNacosçš„åŠŸèƒ½ç­‰ï¼Œæœ€åæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå¦‚æœåƒä¹‹å‰Eurekaä¸€æ ·ï¼Œæ­å»ºNacosé›†ç¾¤ï¼Œå®ç°é«˜å¯ç”¨ã€‚</p>
<p>å®˜æ–¹æ–¹æ¡ˆï¼š<a href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html">https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html</a></p>
<p><img src="https://nacos.io/img/deployDnsVipMode.jpg" alt="deployDnsVipMode.jpg"></p>
<blockquote>
<p><a href="http://ip1:port/openAPI">http://ip1:port/openAPI</a> ç›´è¿ipæ¨¡å¼ï¼Œæœºå™¨æŒ‚åˆ™éœ€è¦ä¿®æ”¹ipæ‰å¯ä»¥ä½¿ç”¨ã€‚</p>
<p><a href="http://SLB:port/openAPI">http://SLB:port/openAPI</a> æŒ‚è½½SLBæ¨¡å¼(å†…ç½‘SLBï¼Œä¸å¯æš´éœ²åˆ°å…¬ç½‘ï¼Œä»¥å…å¸¦æ¥å®‰å…¨é£é™©)ï¼Œç›´è¿SLBå³å¯ï¼Œä¸‹é¢æŒ‚serverçœŸå®ipï¼Œå¯è¯»æ€§ä¸å¥½ã€‚</p>
<p><a href="http://nacos.com:port/openAPI">http://nacos.com:port/openAPI</a> åŸŸå + SLBæ¨¡å¼(å†…ç½‘SLBï¼Œä¸å¯æš´éœ²åˆ°å…¬ç½‘ï¼Œä»¥å…å¸¦æ¥å®‰å…¨é£é™©)ï¼Œå¯è¯»æ€§å¥½ï¼Œè€Œä¸”æ¢ipæ–¹ä¾¿ï¼Œæ¨èæ¨¡å¼</p>
</blockquote>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„æ¶æ„è®¾è®¡ï¼Œå®ƒæ¨èæˆ‘ä»¬åœ¨æ‰€æœ‰çš„NacosæœåŠ¡ç«¯ä¹‹å‰å»ºç«‹ä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬é€šè¿‡è®¿é—®è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ¥é—´æ¥è®¿é—®åˆ°å„ä¸ªNacosæœåŠ¡å™¨ã€‚å®é™…ä¸Šå°±ï¼Œæ˜¯æ¯”å¦‚æœ‰ä¸‰ä¸ªNacosæœåŠ¡å™¨åšé›†ç¾¤ï¼Œä½†æ˜¯æ¯ä¸ªæœåŠ¡ä¸å¯èƒ½æŠŠæ¯ä¸ªNacoséƒ½å»è®¿é—®ä¸€æ¬¡è¿›è¡Œæ³¨å†Œï¼Œå®é™…ä¸Šåªéœ€è¦åœ¨ä»»æ„ä¸€å°NacosæœåŠ¡å™¨ä¸Šæ³¨å†Œå³å¯ï¼ŒNacosæœåŠ¡å™¨ä¹‹é—´ä¼šè‡ªåŠ¨åŒæ­¥ä¿¡æ¯ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éšä¾¿æŒ‡å®šä¸€å°NacosæœåŠ¡å™¨è¿›è¡Œæ³¨å†Œï¼Œå¦‚æœè¿™å°NacosæœåŠ¡å™¨æŒ‚äº†ï¼Œä½†æ˜¯å…¶ä»–NacosæœåŠ¡å™¨æ²¡æŒ‚ï¼Œè¿™æ ·å°±æ²¡åŠæ³•å®Œæˆæ³¨å†Œäº†ï¼Œä½†æ˜¯å®é™…ä¸Šæ•´ä¸ªé›†ç¾¤è¿˜æ˜¯å¯ç”¨çš„çŠ¶æ€ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œå°±éœ€è¦åœ¨æ‰€æœ‰NacosæœåŠ¡å™¨ä¹‹å‰æ­å»ºä¸€ä¸ªSLBï¼ˆæœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ä¸Šé¢çš„é—®é¢˜äº†ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœè¦å®ç°å¤–ç•Œå¯¹æœåŠ¡è®¿é—®çš„è´Ÿè½½å‡è¡¡ï¼Œæˆ‘ä»¬å°±å¾—ç”¨æ¯”å¦‚ä¹‹å‰è¯´åˆ°çš„Gatewayæ¥å®ç°ï¼Œè€Œè¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªæ›´åŠ æ–¹ä¾¿çš„å·¥å…·ï¼šNginxï¼Œæ¥å®ç°ï¼ˆä¹‹å‰æˆ‘ä»¬æ²¡è®²è¿‡ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œæ”¾å¿ƒåé¢ä¼šå¸¦ç€å¤§å®¶ä½¿ç”¨ï¼‰</p>
<p>å…³äºSLBæœ€ä¸Šæ–¹è¿˜æœ‰ä¸€ä¸ªDNSï¼ˆæˆ‘ä»¬åœ¨<code>è®¡ç®—æœºç½‘ç»œ</code>è¿™é—¨è¯¾ç¨‹ä¸­å­¦ä¹ è¿‡ï¼‰ï¼Œè¿™ä¸ªæ˜¯å› ä¸ºSLBæ˜¯è£¸IPï¼Œå¦‚æœSLBæœåŠ¡å™¨ä¿®æ”¹äº†åœ°å€ï¼Œé‚£ä¹ˆæ‰€æœ‰å¾®æœåŠ¡æ³¨å†Œçš„åœ°å€ä¹Ÿå¾—æ”¹ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯é€šè¿‡åŠ åŸŸåï¼Œé€šè¿‡åŸŸåæ¥è®¿é—®ï¼Œè®©DNSå»è§£æçœŸå®IPï¼Œè¿™æ ·å°±ç®—æ”¹å˜IPï¼Œåªéœ€è¦ä¿®æ”¹åŸŸåè§£æè®°å½•å³å¯ï¼ŒåŸŸååœ°å€æ˜¯ä¸ä¼šå˜åŒ–çš„ã€‚</p>
<p>æœ€åå°±æ˜¯Nacosçš„æ•°æ®å­˜å‚¨æ¨¡å¼ï¼Œåœ¨å•èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼ŒNacoså®é™…ä¸Šæ˜¯å°†æ•°æ®å­˜æ”¾åœ¨è‡ªå¸¦çš„ä¸€ä¸ªåµŒå…¥å¼æ•°æ®åº“ä¸­ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0nng0ithgj215i0b875m.jpg" alt="image-20220326222343802"></p>
<p>è€Œè¿™ç§æ¨¡å¼åªé€‚ç”¨äºå•èŠ‚ç‚¹ï¼Œåœ¨å¤šèŠ‚ç‚¹é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œè‚¯å®šæ˜¯ä¸èƒ½å„å­˜å„çš„ï¼Œæ‰€ä»¥ï¼ŒNacosæä¾›äº†MySQLç»Ÿä¸€å­˜å‚¨æ”¯æŒï¼Œæˆ‘ä»¬åªéœ€è¦è®©æ‰€æœ‰çš„NacosæœåŠ¡å™¨è¿æ¥MySQLè¿›è¡Œæ•°æ®å­˜å‚¨å³å¯ï¼Œå®˜æ–¹ä¹Ÿæä¾›å¥½äº†SQLæ–‡ä»¶ã€‚</p>
<p>ç°åœ¨å°±å¯ä»¥å¼€å§‹äº†ï¼Œç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬ç›´æ¥å¯¼å…¥æ•°æ®åº“å³å¯ï¼Œæ–‡ä»¶åœ¨confç›®å½•ä¸­ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0nnjw4980j2154090jtf.jpg" alt="image-20220326222728745"></p>
<p>æˆ‘ä»¬æ¥å°†å…¶å¯¼å…¥åˆ°æ•°æ®åº“ï¼Œå¯ä»¥çœ‹åˆ°ç”Ÿæˆäº†å¾ˆå¤šçš„è¡¨ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0nnmgm3g0j21580cqgod.jpg" alt="image-20220326222957239"></p>
<p>ç„¶åæˆ‘ä»¬æ¥åˆ›å»ºä¸¤ä¸ªNacosæœåŠ¡å™¨ï¼Œåšä¸€ä¸ªè¿·ä½ çš„é›†ç¾¤ï¼Œè¿™é‡Œä½¿ç”¨<code>scp</code>å‘½ä»¤å°†nacosæœåŠ¡ç«¯ä¸Šä¼ åˆ°LinuxæœåŠ¡å™¨ï¼ˆæ³¨æ„éœ€è¦æå‰å®‰è£…å¥½JRE 8æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç¯å¢ƒï¼‰ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ob09uny0j21880303z6.jpg" alt="image-20220327115901662"></p>
<p>è§£å‹ä¹‹åï¼Œæˆ‘ä»¬å¯¹å…¶é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œé¦–å…ˆæ˜¯<code>application.properties</code>é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼ŒåŒ…æ‹¬MySQLæœåŠ¡å™¨çš„ä¿¡æ¯ï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">### Default web server port:</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8801</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#*************** Config Module Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### If use MySQL as datasource:</span></span><br><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### Count of DB:</span></span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### Connect URL of DB:</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://cloudstudy.mysql.cn-chengdu.rds.aliyuncs.com:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user.0</span>=<span class="string">nacos</span></span><br><span class="line"><span class="attr">db.password.0</span>=<span class="string">nacos</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åä¿®æ”¹é›†ç¾¤é…ç½®ï¼Œè¿™é‡Œéœ€è¦é‡å‘½åä¸€ä¸‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ob3otjt5j20yc01iglw.jpg" alt="image-20220327120219022"></p>
<p>ç«¯å£è®°å¾—ä½¿ç”¨å†…ç½‘IPåœ°å€ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0of8v91lzj211y05mjrr.jpg" alt="image-20220327142541523"></p>
<p>æœ€åæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹Nacosçš„å†…å­˜åˆ†é…ä»¥åŠå‰å°å¯åŠ¨ï¼Œç›´æ¥ä¿®æ”¹<code>startup.sh</code>æ–‡ä»¶ï¼ˆå†…å­˜æœ‰é™ï¼Œç©ä¸èµ·é«˜çš„ï¼‰ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0oci5kyrzj218m0acn0i.jpg" alt="image-20220327125049013"></p>
<p>ä¿å­˜ä¹‹åï¼Œå°†nacoså¤åˆ¶ä¸€ä»½ï¼Œå¹¶å°†ç«¯å£ä¿®æ”¹ä¸º8802ï¼Œæ¥ç€å¯åŠ¨è¿™ä¸¤ä¸ªNacosæœåŠ¡å™¨ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ocjew7soj218408ktb8.jpg" alt="image-20220327125201913"></p>
<p>ç„¶åæˆ‘ä»¬æ‰“å¼€ç®¡ç†é¢æ¿ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªèŠ‚ç‚¹éƒ½å·²ç»å¯åŠ¨äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ocjy2a7dj22mo0j6jtq.jpg" alt="image-20220327125232238"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬ç¬¬äºŒæ­¥å°±å®Œæˆäº†ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªSLBï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨Nginxåšåå‘ä»£ç†ï¼š</p>
<blockquote>
<p><em>Nginx</em> (engine x) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<a href="https://baike.baidu.com/item/HTTP">HTTP</a>å’Œ<a href="https://baike.baidu.com/item/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/7793488">åå‘ä»£ç†</a>webæœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†IMAP/POP3/SMTPæœåŠ¡ã€‚å®ƒç›¸å½“äºåœ¨å†…ç½‘ä¸å¤–ç½‘ä¹‹é—´å½¢æˆä¸€ä¸ªç½‘å…³ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½å¯ä»¥ç”±NginxæœåŠ¡å™¨è½¬äº¤ç»™å†…ç½‘çš„å…¶ä»–æœåŠ¡å™¨ã€‚</p>
</blockquote>
<p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥å®‰è£…ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç›´æ¥è¯·æ±‚80ç«¯å£ä¹‹åå¾—åˆ°ï¼Œè¡¨ç¤ºå®‰è£…æˆåŠŸï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ocrv94q3j22mi0eidi8.jpg" alt="image-20220327130009391"></p>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦è®©å…¶ä»£ç†æˆ‘ä»¬åˆšåˆšå¯åŠ¨çš„ä¸¤ä¸ªNacosæœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œä¸€äº›é…ç½®ã€‚é…ç½®æ–‡ä»¶ä½äº<code>/etc/nginx/nginx.conf</code>ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#æ·»åŠ æˆ‘ä»¬åœ¨ä¸Šæ¸¸åˆšåˆšåˆ›å»ºå¥½çš„ä¸¤ä¸ªnacosæœåŠ¡å™¨</span><br><span class="line">upstream nacos-server &#123;</span><br><span class="line">        server 10.0.0.12:8801;</span><br><span class="line">        server 10.0.0.12:8802;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen   80;</span><br><span class="line">        server_name  1.14.121.107;</span><br><span class="line"></span><br><span class="line">        location /nacos &#123;</span><br><span class="line">                proxy_pass http://nacos-server;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡å¯NginxæœåŠ¡å™¨ï¼ŒæˆåŠŸè¿æ¥ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ofsnlufwj21wa0u0wis.jpg" alt="image-20220327144441878"></p>
<p>ç„¶åæˆ‘ä»¬å°†æ‰€æœ‰çš„æœåŠ¡å…¨éƒ¨ä¿®æ”¹ä¸ºäº‘æœåŠ¡å™¨ä¸ŠNacosçš„åœ°å€ï¼Œå¯åŠ¨è¯•è¯•çœ‹ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0og0j7z8dj22mg0l0gpk.jpg" alt="image-20220327145216771"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±æ­å»ºå¥½äº†Nacosé›†ç¾¤ã€‚</p>
<hr>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0oh42qki6j21ns0aw0th.jpg" alt="image-20220327153016414"></p>
<h2 id="Sentinel-æµé‡é˜²å«å…µ"><a href="#Sentinel-æµé‡é˜²å«å…µ" class="headerlink" title="Sentinel æµé‡é˜²å«å…µ"></a>Sentinel æµé‡é˜²å«å…µ</h2><p><strong>æ³¨æ„ï¼š</strong>è¿™ä¸€ç« æœ‰ç‚¹å°ç»•ï¼Œæ€è·¯ç†æ¸…ã€‚</p>
<p>ç»è¿‡ä¹‹å‰çš„å­¦ä¹ ï¼Œæˆ‘ä»¬äº†è§£äº†å¾®æœåŠ¡å­˜åœ¨çš„é›ªå´©é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå¾®æœåŠ¡å‡ºç°é—®é¢˜ï¼Œæœ‰å¯èƒ½å¯¼è‡´æ•´ä¸ªé“¾è·¯ç›´æ¥ä¸å¯ç”¨ï¼Œè¿™ç§æ—¶å€™æˆ‘ä»¬å°±éœ€è¦è¿›è¡ŒåŠæ—¶çš„ç†”æ–­å’Œé™çº§ï¼Œè¿™äº›ç­–ç•¥ï¼Œæˆ‘ä»¬ä¹‹å‰é€šè¿‡ä½¿ç”¨Hystrixæ¥å®ç°ã€‚</p>
<p>SpringCloud Alibabaä¹Ÿæœ‰è‡ªå·±çš„å¾®æœåŠ¡å®¹é”™ç»„ä»¶ï¼Œä½†æ˜¯å®ƒç›¸æ¯”Hystrixæ›´åŠ çš„å¼ºå¤§ã€‚</p>
<blockquote>
<p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>
</blockquote>
<p>Sentinel å…·æœ‰ä»¥ä¸‹ç‰¹å¾:</p>
<ul>
<li><strong>ä¸°å¯Œçš„åº”ç”¨åœºæ™¯</strong>ï¼šSentinel æ‰¿æ¥äº†é˜¿é‡Œå·´å·´è¿‘ 10 å¹´çš„åŒåä¸€å¤§ä¿ƒæµé‡çš„æ ¸å¿ƒåœºæ™¯ï¼Œä¾‹å¦‚ç§’æ€ï¼ˆå³çªå‘æµé‡æ§åˆ¶åœ¨ç³»ç»Ÿå®¹é‡å¯ä»¥æ‰¿å—çš„èŒƒå›´ï¼‰ã€æ¶ˆæ¯å‰Šå³°å¡«è°·ã€é›†ç¾¤æµé‡æ§åˆ¶ã€å®æ—¶ç†”æ–­ä¸‹æ¸¸ä¸å¯ç”¨åº”ç”¨ç­‰ã€‚</li>
<li><strong>å®Œå¤‡çš„å®æ—¶ç›‘æ§</strong>ï¼šSentinel åŒæ—¶æä¾›å®æ—¶çš„ç›‘æ§åŠŸèƒ½ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°æ¥å…¥åº”ç”¨çš„å•å°æœºå™¨ç§’çº§æ•°æ®ï¼Œç”šè‡³ 500 å°ä»¥ä¸‹è§„æ¨¡çš„é›†ç¾¤çš„æ±‡æ€»è¿è¡Œæƒ…å†µã€‚</li>
<li><strong>å¹¿æ³›çš„å¼€æºç”Ÿæ€</strong>ï¼šSentinel æä¾›å¼€ç®±å³ç”¨çš„ä¸å…¶å®ƒå¼€æºæ¡†æ¶/åº“çš„æ•´åˆæ¨¡å—ï¼Œä¾‹å¦‚ä¸ Spring Cloudã€Apache Dubboã€gRPCã€Quarkus çš„æ•´åˆã€‚æ‚¨åªéœ€è¦å¼•å…¥ç›¸åº”çš„ä¾èµ–å¹¶è¿›è¡Œç®€å•çš„é…ç½®å³å¯å¿«é€Ÿåœ°æ¥å…¥ Sentinelã€‚åŒæ—¶ Sentinel æä¾› Java/Go/C++ ç­‰å¤šè¯­è¨€çš„åŸç”Ÿå®ç°ã€‚</li>
<li><strong>å®Œå–„çš„ SPI æ‰©å±•æœºåˆ¶</strong>ï¼šSentinel æä¾›ç®€å•æ˜“ç”¨ã€å®Œå–„çš„ SPI æ‰©å±•æ¥å£ã€‚æ‚¨å¯ä»¥é€šè¿‡å®ç°æ‰©å±•æ¥å£æ¥å¿«é€Ÿåœ°å®šåˆ¶é€»è¾‘ã€‚ä¾‹å¦‚å®šåˆ¶è§„åˆ™ç®¡ç†ã€é€‚é…åŠ¨æ€æ•°æ®æºç­‰ã€‚</li>
</ul>
<h3 id="å®‰è£…ä¸éƒ¨ç½²-1"><a href="#å®‰è£…ä¸éƒ¨ç½²-1" class="headerlink" title="å®‰è£…ä¸éƒ¨ç½²"></a>å®‰è£…ä¸éƒ¨ç½²</h3><p>å’ŒNacosä¸€æ ·ï¼Œå®ƒæ˜¯ç‹¬ç«‹å®‰è£…å’Œéƒ¨ç½²çš„ï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://github.com/alibaba/Sentinel/releases">https://github.com/alibaba/Sentinel/releases</a></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ohkq2u65j22qy0nogpw.jpg" alt="image-20220327154616456"></p>
<p>æ³¨æ„ä¸‹è½½ä¸‹æ¥ä¹‹åæ˜¯ä¸€ä¸ª<code>jar</code>æ–‡ä»¶ï¼ˆå…¶å®å°±æ˜¯ä¸ªSpringBooté¡¹ç›®ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨IDEAä¸­æ·»åŠ ä¸€äº›è¿è¡Œé…ç½®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0oiu9a58tj22ae0dgdjy.jpg" alt="image-20220327163002399"></p>
<p>æ¥ç€å°±å¯ä»¥ç›´æ¥å¯åŠ¨å•¦ï¼Œå½“ç„¶é»˜è®¤ç«¯å£å ç”¨8080ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹ï¼Œå¯ä»¥æ·»åŠ ç¯å¢ƒå˜é‡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0oivfso85j218e04cmxt.jpg" alt="image-20220327163110733"></p>
<p>å¯åŠ¨ä¹‹åï¼Œå°±å¯ä»¥è®¿é—®åˆ°Sentinelçš„ç›‘æ§é¡µé¢äº†ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯<code>sentinel</code>ï¼Œåœ°å€ï¼š<a href="http://localhost:8858/#/dashboard">http://localhost:8858/#/dashboard</a></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0oiweerr4j22mg0dwwfm.jpg" alt="image-20220327163206117"></p>
<p>è¿™æ ·å°±æˆåŠŸå¼€å¯ç›‘æ§é¡µé¢äº†ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦è®©æˆ‘ä»¬çš„æœåŠ¡è¿æ¥åˆ°Sentinelæ§åˆ¶å°ï¼Œè€è§„çŸ©ï¼Œå¯¼å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ Sentinelç›¸å…³ä¿¡æ¯ï¼ˆå®é™…ä¸ŠSentinelæ˜¯æœ¬åœ°åœ¨è¿›è¡Œç®¡ç†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¿æ¥åˆ°ç›‘æ§é¡µé¢ï¼Œè¿™æ ·å°±å¯ä»¥å›¾å½¢åŒ–æ“ä½œäº†ï¼‰ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">      	<span class="comment"># æ·»åŠ ç›‘æ§é¡µé¢åœ°å€å³å¯</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8858</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡ï¼Œç„¶åè®¿é—®ä¸€æ¬¡æœåŠ¡ï¼Œè¿™æ ·Sentinelä¸­å°±ä¼šå­˜åœ¨ä¿¡æ¯äº†ï¼ˆæ‡’åŠ è½½æœºåˆ¶ï¼Œä¸ä¼šä¸€ä¸Šæ¥å°±åŠ è½½ï¼‰ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0oj5uuyfwj21ny074js0.jpg" alt="image-20220327164111325"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0oj8drp9hj223m0u00wi.jpg" alt="image-20220327164336877"></p>
<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥åœ¨Sentinelæ§åˆ¶å°ä¸­å¯¹æˆ‘ä»¬çš„æœåŠ¡è¿è¡Œæƒ…å†µè¿›è¡Œå®æ—¶ç›‘æ§äº†ï¼Œå¯ä»¥çœ‹åˆ°ç›‘æ§çš„å†…å®¹éå¸¸çš„å¤šï¼ŒåŒ…æ‹¬æ—¶é—´ç‚¹ã€QPS(æ¯ç§’æŸ¥è¯¢ç‡)ã€å“åº”æ—¶é—´ç­‰æ•°æ®ã€‚</p>
<p>æŒ‰ç…§ä¸Šé¢çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„æœåŠ¡å…¨éƒ¨è¿æ¥åˆ°Sentinelç®¡ç†é¢æ¿ä¸­ã€‚</p>
<h3 id="æµé‡æ§åˆ¶"><a href="#æµé‡æ§åˆ¶" class="headerlink" title="æµé‡æ§åˆ¶"></a>æµé‡æ§åˆ¶</h3><p>å‰é¢æˆ‘ä»¬å®Œæˆäº†å¯¹Sentinelçš„æ­å»ºä¸è¿æ¥ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹Sentinelçš„ç¬¬ä¸€ä¸ªåŠŸèƒ½ï¼Œæµé‡æ§åˆ¶ã€‚</p>
<p>æˆ‘ä»¬çš„æœºå™¨ä¸å¯èƒ½æ— é™åˆ¶çš„æ¥å—å’Œå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¦‚æœä¸åŠ ä»¥é™åˆ¶ï¼Œå½“å‘ç”Ÿé«˜å¹¶å‘æƒ…å†µæ—¶ï¼Œç³»ç»Ÿèµ„æºå°†å¾ˆå¿«è¢«è€—å°½ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±å¯ä»¥æ·»åŠ æµé‡æ§åˆ¶ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯é™æµï¼‰å½“ä¸€æ®µæ—¶é—´å†…çš„æµé‡åˆ°è¾¾ä¸€å®šçš„é˜ˆå€¼çš„æ—¶å€™ï¼Œæ–°çš„è¯·æ±‚å°†ä¸å†è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥åˆç†åœ°åº”å¯¹é«˜å¹¶å‘è¯·æ±‚ï¼ŒåŒæ—¶ä¹Ÿèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿æŠ¤æœåŠ¡å™¨ä¸å—åˆ°å¤–ç•Œçš„æ¶æ„æ”»å‡»ã€‚</p>
<p>é‚£ä¹ˆè¦å®ç°é™æµï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯¥é‡‡å–ä»€ä¹ˆæ ·çš„ç­–ç•¥å‘¢ï¼Ÿ</p>
<ul>
<li>æ–¹æ¡ˆä¸€ï¼š<strong>å¿«é€Ÿæ‹’ç»</strong>ï¼Œæ—¢ç„¶ä¸å†æ¥å—æ–°çš„è¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªæ‹’ç»ä¿¡æ¯ï¼Œå‘Šè¯‰ç”¨æˆ·è®¿é—®é¢‘ç‡è¿‡é«˜ã€‚</li>
<li>æ–¹æ¡ˆäºŒï¼š<strong>é¢„çƒ­</strong>ï¼Œä¾ç„¶åŸºäºæ–¹æ¡ˆä¸€ï¼Œä½†æ˜¯ç”±äºæŸäº›æƒ…å†µä¸‹é«˜å¹¶å‘è¯·æ±‚æ˜¯åœ¨æŸä¸€æ—¶åˆ»çªç„¶åˆ°æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç¼“æ…¢åœ°å°†é˜ˆå€¼æé«˜åˆ°æŒ‡å®šé˜ˆå€¼ï¼Œå½¢æˆä¸€ä¸ªç¼“å†²ä¿æŠ¤ã€‚</li>
<li>æ–¹æ¡ˆä¸‰ï¼š<strong>æ’é˜Ÿç­‰å¾…</strong>ï¼Œä¸æ¥å—æ–°çš„è¯·æ±‚ï¼Œä½†æ˜¯ä¹Ÿä¸ç›´æ¥æ‹’ç»ï¼Œè€Œæ˜¯è¿›é˜Ÿåˆ—å…ˆç­‰ä¸€ä¸‹ï¼Œå¦‚æœè§„å®šæ—¶é—´å†…èƒ½å¤Ÿæ‰§è¡Œï¼Œé‚£ä¹ˆå°±æ‰§è¡Œï¼Œè¦æ˜¯è¶…æ—¶å°±ç®—äº†ã€‚</li>
</ul>
<p>é’ˆå¯¹äºæ˜¯å¦è¶…è¿‡æµé‡é˜ˆå€¼çš„åˆ¤æ–­ï¼Œè¿™é‡Œæˆ‘ä»¬æ4ç§ç®—æ³•ï¼š</p>
<ol>
<li><p><strong>æ¼æ¡¶ç®—æ³•</strong></p>
<p>é¡¾åæ€ä¹‰ï¼Œå°±åƒä¸€ä¸ªæ¡¶å¼€äº†ä¸€ä¸ªå°å­”ï¼Œæ°´æµè¿›æ¡¶ä¸­çš„é€Ÿåº¦è‚¯å®šæ˜¯è¿œå¤§äºæ°´æµå‡ºæ¡¶çš„é€Ÿåº¦çš„ï¼Œè¿™ä¹Ÿæ˜¯æœ€ç®€å•çš„ä¸€ç§é™æµæ€è·¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0okai0crij21om08kgmz.jpg" alt="image-20220327172014949"></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œæ¡¶æ˜¯æœ‰å®¹é‡çš„ï¼Œæ‰€ä»¥å½“æ¡¶çš„å®¹é‡å·²æ»¡æ—¶ï¼Œå°±è£…ä¸ä¸‹æ°´äº†ï¼Œè¿™æ—¶å°±åªæœ‰ä¸¢å¼ƒè¯·æ±‚äº†ã€‚</p>
<p>åˆ©ç”¨è¿™ç§æ€æƒ³ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºä¸€ä¸ªç®€å•çš„é™æµç®—æ³•ã€‚</p>
</li>
<li><p><strong>ä»¤ç‰Œæ¡¶ç®—æ³•</strong></p>
<p>åªèƒ½è¯´æœ‰ç‚¹åƒä¿¡å·é‡æœºåˆ¶ã€‚ç°åœ¨æœ‰ä¸€ä¸ªä»¤ç‰Œæ¡¶ï¼Œè¿™ä¸ªæ¡¶æ˜¯ä¸“é—¨å­˜æ”¾ä»¤ç‰Œçš„ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å°±å‘æ¡¶ä¸­ä¸¢å…¥ä¸€ä¸ªä»¤ç‰Œï¼ˆé€Ÿåº¦ç”±æˆ‘ä»¬æŒ‡å®šï¼‰å½“æ–°çš„è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå°†ä»æ¡¶ä¸­åˆ é™¤ä»¤ç‰Œï¼Œæ¥ç€è¯·æ±‚å°±å¯ä»¥é€šè¿‡å¹¶ç»™åˆ°æœåŠ¡ï¼Œä½†æ˜¯å¦‚æœæ¡¶ä¸­çš„ä»¤ç‰Œæ•°é‡ä¸è¶³ï¼Œé‚£ä¹ˆä¸ä¼šåˆ é™¤ä»¤ç‰Œï¼Œè€Œæ˜¯è®©æ­¤æ•°æ®åŒ…ç­‰å¾…ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0okow2vd5j21lg0gkdid.jpg" alt="image-20220327173323339"></p>
<p>å¯ä»¥è¯•æƒ³ä¸€ä¸‹ï¼Œå½“æµé‡ä¸‹é™æ—¶ï¼Œä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œä¼šé€æ¸ç§¯ç´¯ï¼Œè¿™æ ·å¦‚æœçªç„¶å‡ºç°é«˜å¹¶å‘ï¼Œé‚£ä¹ˆå°±èƒ½åœ¨çŸ­æ—¶é—´å†…æ‹¿åˆ°å¤§é‡çš„ä»¤ç‰Œã€‚</p>
</li>
<li><p><strong>å›ºå®šæ—¶é—´çª—å£ç®—æ³•</strong></p>
<p>æˆ‘ä»¬å¯ä»¥å¯¹æŸä¸€ä¸ªæ—¶é—´æ®µå†…çš„è¯·æ±‚è¿›è¡Œç»Ÿè®¡å’Œè®¡æ•°ï¼Œæ¯”å¦‚åœ¨<code>14:15</code>åˆ°<code>14:16</code>è¿™ä¸€åˆ†é’Ÿå†…ï¼Œè¯·æ±‚é‡ä¸èƒ½è¶…è¿‡<code>100</code>ï¼Œä¹Ÿå°±æ˜¯ä¸€åˆ†é’Ÿä¹‹å†…ä¸èƒ½è¶…è¿‡<code>100</code>æ¬¡è¯·æ±‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·è¿›è¡Œåˆ’åˆ†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0okvim48fj219404274n.jpg" alt="image-20220327174027199"></p>
<p>è™½ç„¶è¿™ç§æ¨¡å¼çœ‹ä¼¼æ¯”è¾ƒåˆç†ï¼Œä½†æ˜¯è¯•æƒ³ä¸€ä¸‹è¿™ç§æƒ…å†µï¼š</p>
<ul>
<li>14:15:59çš„æ—¶å€™æ¥äº†100ä¸ªè¯·æ±‚</li>
<li>14:16:01çš„æ—¶å€™åˆæ¥äº†100ä¸ªè¯·æ±‚</li>
</ul>
<p>å‡ºç°ä¸Šé¢è¿™ç§æƒ…å†µï¼Œç¬¦åˆå›ºå®šæ—¶é—´çª—å£ç®—æ³•çš„è§„åˆ™ï¼Œæ‰€ä»¥è¿™200ä¸ªè¯·æ±‚éƒ½èƒ½æ­£å¸¸æ¥å—ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ ååº”æ¯”è¾ƒå¿«ï¼Œåº”è¯¥å‘ç°äº†ï¼Œæˆ‘ä»¬å…¶å®å¸Œæœ›çš„æ˜¯60ç§’å†…åªæœ‰100ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µå´æ˜¯åœ¨3ç§’å†…å‡ºç°äº†200ä¸ªè¯·æ±‚ï¼Œå¾ˆæ˜æ˜¾å·²ç»è¿èƒŒäº†æˆ‘ä»¬çš„åˆè¡·ã€‚</p>
<p>å› æ­¤ï¼Œå½“é‡åˆ°ä¸´ç•Œç‚¹æ—¶ï¼Œå›ºå®šæ—¶é—´çª—å£ç®—æ³•å­˜åœ¨å®‰å…¨éšæ‚£ã€‚</p>
</li>
<li><p><strong>æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•</strong></p>
<p>ç›¸å¯¹äºå›ºå®šçª—å£ç®—æ³•ï¼Œæ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•æ›´åŠ çµæ´»ï¼Œå®ƒä¼šåŠ¨æ€ç§»åŠ¨çª—å£ï¼Œé‡æ–°è¿›è¡Œè®¡ç®—ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ol4irdckj21fs0jggnr.jpg" alt="image-20220327174906227"></p>
<p>è™½ç„¶è¿™æ ·èƒ½å¤Ÿé¿å…å›ºå®šæ—¶é—´çª—å£çš„ä¸´ç•Œé—®é¢˜ï¼Œä½†æ˜¯è¿™æ ·æ˜¾ç„¶æ˜¯æ¯”å›ºå®šçª—å£æ›´åŠ è€—æ—¶çš„ã€‚</p>
</li>
</ol>
<p>å¥½äº†ï¼Œäº†è§£å®Œäº†æˆ‘ä»¬çš„é™æµç­–ç•¥å’Œåˆ¤å®šæ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬åœ¨Sentinelä¸­è¿›è¡Œå®é™…æµ‹è¯•ä¸€ä¸‹ï¼Œæ‰“å¼€ç®¡ç†é¡µé¢çš„ç°‡ç‚¹é“¾è·¯æ¨¡å—ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ol71o173j229j0u0444.jpg" alt="image-20220327175131519"></p>
<p>è¿™é‡Œæ¼”ç¤ºå¯¹æˆ‘ä»¬çš„å€Ÿé˜…æ¥å£è¿›è¡Œé™æµï¼Œç‚¹å‡»<code>æµæ§</code>ï¼Œä¼šçœ‹åˆ°è®©æˆ‘ä»¬æ·»åŠ æµæ§è§„åˆ™ï¼š</p>
<ul>
<li>é˜ˆå€¼ç±»å‹ï¼šQPSå°±æ˜¯æ¯ç§’é’Ÿçš„è¯·æ±‚æ•°é‡ï¼Œå¹¶å‘çº¿ç¨‹æ•°æ˜¯æŒ‰æœåŠ¡å½“å‰ä½¿ç”¨çš„çº¿ç¨‹æ•°æ®è¿›è¡Œç»Ÿè®¡çš„ã€‚</li>
<li>æµæ§æ¨¡å¼ï¼šå½“è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œæµæ§çš„å¯¹è±¡ï¼Œè¿™é‡Œæš‚æ—¶åªç”¨ç›´æ¥ã€‚</li>
<li>æµæ§æ•ˆæœï¼šå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„ä¸‰ç§æ–¹æ¡ˆã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©<code>QPS</code>ã€é˜ˆå€¼è®¾å®šä¸º<code>1</code>ï¼Œæµæ§æ¨¡å¼é€‰æ‹©<code>ç›´æ¥</code>ã€æµæ§æ•ˆæœé€‰æ‹©<code>å¿«é€Ÿå¤±è´¥</code>ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬å¿«é€Ÿåœ°è¿›è¡Œè¯·æ±‚æ—¶ï¼Œä¼šç›´æ¥è¿”å›å¤±è´¥ä¿¡æ¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ole5mz4jj21d406it9b.jpg" alt="image-20220327175821941"></p>
<p>è¿™é‡Œå„ä½æœ€å¥½è‡ªè¡Œå°è¯•ä¸€ä¸‹å…¶ä»–çš„æµæ§æ•ˆæœï¼Œç†Ÿæ‚‰å’ŒåŠ æ·±å°è±¡ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›æµæ§æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š</p>
<ul>
<li>ç›´æ¥ï¼šåªé’ˆå¯¹äºå½“å‰æ¥å£ã€‚</li>
<li>å…³è”ï¼šå½“å…¶ä»–æ¥å£è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šå¯¼è‡´å½“å‰æ¥å£è¢«é™æµã€‚</li>
<li>é“¾è·¯ï¼šæ›´ç»†ç²’åº¦çš„é™æµï¼Œèƒ½ç²¾ç¡®åˆ°å…·ä½“çš„æ–¹æ³•ã€‚</li>
</ul>
<p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å…³è”ï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬å¯¹è‡ªå¸¦çš„<code>/error</code>æ¥å£è¿›è¡Œé™æµï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0om9w2tq0j224r0u0gq3.jpg" alt="image-20220327182851278"></p>
<p>æ³¨æ„é™æµæ˜¯ä½œç”¨äºå…³è”èµ„æºçš„ï¼Œä¸€æ—¦å‘ç°å…³è”èµ„æºè¶…è¿‡é˜ˆå€¼ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹å½“å‰çš„èµ„æºè¿›è¡Œé™æµï¼Œæˆ‘ä»¬ç°åœ¨æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œè¿™é‡Œä½¿ç”¨PostMançš„Runnerè¿ç»­å¯¹å…³è”èµ„æºå‘èµ·è¯·æ±‚ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0omdvnxbxj21c00u0goi.jpg" alt="image-20220327183241316"></p>
<p>å¼€å¯Postmanï¼Œç„¶åæˆ‘ä»¬ä¼šå‘ç°å€Ÿé˜…æœåŠ¡å·²ç»å‡‰å‡‰ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0omeqzhpij215o06c3z3.jpg" alt="image-20220327183331595"></p>
<p>å½“æˆ‘ä»¬å…³é—­æ‰Postmançš„ä»»åŠ¡åï¼Œæ¢å¤æ­£å¸¸ã€‚</p>
<p>æœ€åæˆ‘ä»¬æ¥è®²è§£ä¸€ä¸‹é“¾è·¯æ¨¡å¼ï¼Œå®ƒèƒ½å¤Ÿæ›´åŠ ç²¾å‡†çš„è¿›è¡Œæµé‡æ§åˆ¶ï¼Œé“¾è·¯æµæ§æ¨¡å¼æŒ‡çš„æ˜¯ï¼Œå½“ä»æŒ‡å®šæ¥å£è¿‡æ¥çš„èµ„æºè¯·æ±‚è¾¾åˆ°é™æµæ¡ä»¶æ—¶ï¼Œå¼€å¯é™æµï¼Œè¿™é‡Œå¾—å…ˆè®²è§£ä¸€ä¸‹<code>@SentinelResource</code>çš„ä½¿ç”¨ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å¯¹æŸä¸€ä¸ªæ–¹æ³•è¿›è¡Œé™æµæ§åˆ¶ï¼Œæ— è®ºæ˜¯è°åœ¨ä½•å¤„è°ƒç”¨äº†å®ƒï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨åˆ°<code>@SentinelResource</code>ï¼Œä¸€æ—¦æ–¹æ³•è¢«æ ‡æ³¨ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œç›‘æ§ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œåˆ›å»ºä¸¤ä¸ªè¯·æ±‚æ˜ å°„ï¼Œéƒ½æ¥è°ƒç”¨Serviceçš„è¢«ç›‘æ§æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow/&#123;uid&#125;&quot;)</span></span><br><span class="line">    UserBorrowDetail <span class="title function_">findUserBorrows</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getUserBorrowDetailByUid(uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow2/&#123;uid&#125;&quot;)</span></span><br><span class="line">    UserBorrowDetail <span class="title function_">findUserBorrows2</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getUserBorrowDetailByUid(uid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BorrowService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserClient userClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BookClient bookClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@SentinelResource(&quot;getBorrow&quot;)</span>   <span class="comment">//ç›‘æ§æ­¤æ–¹æ³•ï¼Œæ— è®ºè¢«è°æ‰§è¡Œéƒ½åœ¨ç›‘æ§èŒƒå›´å†…ï¼Œè¿™é‡Œç»™çš„valueæ˜¯è‡ªå®šä¹‰åç§°ï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥åŠ åœ¨ä»»ä½•æ–¹æ³•ä¸Šï¼ŒåŒ…æ‹¬Controllerä¸­çš„è¯·æ±‚æ˜ å°„æ–¹æ³•ï¼Œè·ŸHystrixCommandè´¼åƒ</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getUserBorrowDetailByUid</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrow = mapper.getBorrowsByUid(uid);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userClient.getUserById(uid);</span><br><span class="line">        List&lt;Book&gt; bookList = borrow</span><br><span class="line">                .stream()</span><br><span class="line">                .map(b -&gt; bookClient.getBookById(b.getBid()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(user, bookList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æ·»åŠ é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">borrowservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8858</span></span><br><span class="line">      <span class="comment"># å…³é—­Contextæ”¶æ•›ï¼Œè¿™æ ·è¢«ç›‘æ§æ–¹æ³•å¯ä»¥è¿›è¡Œä¸åŒé“¾è·¯çš„å•ç‹¬æ§åˆ¶</span></span><br><span class="line">      <span class="attr">web-context-unify:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬åœ¨Sentinelæ§åˆ¶å°ä¸­æ·»åŠ æµæ§è§„åˆ™ï¼Œæ³¨æ„æ˜¯é’ˆå¯¹æ­¤æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»è‡ªåŠ¨è¯†åˆ«åˆ°borrowæ¥å£ä¸‹è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pfp1fhrcj22bh0u00yg.jpg" alt="image-20220328112645048"></p>
<p>æœ€åæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å¯¹è¿™ä¸¤ä¸ªæ¥å£éƒ½è¿›è¡Œæµ‹è¯•ï¼Œä¼šå‘ç°ï¼Œæ— è®ºè¯·æ±‚å“ªä¸ªæ¥å£ï¼Œåªè¦è°ƒç”¨äº†Serviceä¸­çš„<code>getUserBorrowDetailByUid</code>è¿™ä¸ªæ–¹æ³•ï¼Œéƒ½ä¼šè¢«é™æµã€‚æ³¨æ„é™æµçš„å½¢å¼æ˜¯åå°ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè‡³äºæ€ä¹ˆå¤„ç†æˆ‘ä»¬åé¢å†è¯´ã€‚</p>
<p>é‚£ä¹ˆè¿™ä¸ªé“¾è·¯é€‰é¡¹å®é™…ä¸Šå°±æ˜¯å†³å®šåªé™æµä»å“ªä¸ªæ–¹å‘æ¥çš„è°ƒç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬åªå¯¹<code>borrow2</code>è¿™ä¸ªæ¥å£å¯¹<code>getUserBorrowDetailByUid</code>æ–¹æ³•çš„è°ƒç”¨è¿›è¡Œé™æµï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¸ºå…¶æŒ‡å®šé“¾è·¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pfs7hqj4j224s0u0dkb.jpg" alt="image-20220328112949894"></p>
<p>ç„¶åæˆ‘ä»¬ä¼šå‘ç°ï¼Œé™æµæ•ˆæœåªå¯¹æˆ‘ä»¬é…ç½®çš„é“¾è·¯æ¥å£æœ‰æ•ˆï¼Œè€Œå…¶ä»–é“¾è·¯æ˜¯ä¸ä¼šè¢«é™æµçš„ã€‚</p>
<p>é™¤äº†ç›´æ¥å¯¹æ¥å£è¿›è¡Œé™æµè§„åˆ™æ§åˆ¶ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å½“å‰ç³»ç»Ÿçš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œå†³å®šæ˜¯å¦è¿›è¡Œé™æµï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0q18q6t5vj22dk0u0q72.jpg" alt="image-20220328235217680"></p>
<p>ç³»ç»Ÿè§„åˆ™æ”¯æŒä»¥ä¸‹çš„æ¨¡å¼ï¼š</p>
<ul>
<li><strong>Load è‡ªé€‚åº”</strong>ï¼ˆä»…å¯¹ Linux/Unix-like æœºå™¨ç”Ÿæ•ˆï¼‰ï¼šç³»ç»Ÿçš„ load1 ä½œä¸ºå¯å‘æŒ‡æ ‡ï¼Œè¿›è¡Œè‡ªé€‚åº”ç³»ç»Ÿä¿æŠ¤ã€‚å½“ç³»ç»Ÿ load1 è¶…è¿‡è®¾å®šçš„å¯å‘å€¼ï¼Œä¸”ç³»ç»Ÿå½“å‰çš„å¹¶å‘çº¿ç¨‹æ•°è¶…è¿‡ä¼°ç®—çš„ç³»ç»Ÿå®¹é‡æ—¶æ‰ä¼šè§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆBBR é˜¶æ®µï¼‰ã€‚ç³»ç»Ÿå®¹é‡ç”±ç³»ç»Ÿçš„ <code>maxQps * minRt</code> ä¼°ç®—å¾—å‡ºã€‚è®¾å®šå‚è€ƒå€¼ä¸€èˆ¬æ˜¯ <code>CPU cores * 2.5</code>ã€‚</li>
<li><strong>CPU usage</strong>ï¼ˆ1.5.0+ ç‰ˆæœ¬ï¼‰ï¼šå½“ç³»ç»Ÿ CPU ä½¿ç”¨ç‡è¶…è¿‡é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼ˆå–å€¼èŒƒå›´ 0.0-1.0ï¼‰ï¼Œæ¯”è¾ƒçµæ•ã€‚</li>
<li><strong>å¹³å‡ RT</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹³å‡ RT è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</li>
<li><strong>å¹¶å‘çº¿ç¨‹æ•°</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„å¹¶å‘çº¿ç¨‹æ•°è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li>
<li><strong>å…¥å£ QPS</strong>ï¼šå½“å•å°æœºå™¨ä¸Šæ‰€æœ‰å…¥å£æµé‡çš„ QPS è¾¾åˆ°é˜ˆå€¼å³è§¦å‘ç³»ç»Ÿä¿æŠ¤ã€‚</li>
</ul>
<p>è¿™é‡Œå°±ä¸è¿›è¡Œæ¼”ç¤ºäº†ã€‚</p>
<h3 id="é™æµå’Œå¼‚å¸¸å¤„ç†"><a href="#é™æµå’Œå¼‚å¸¸å¤„ç†" class="headerlink" title="é™æµå’Œå¼‚å¸¸å¤„ç†"></a>é™æµå’Œå¼‚å¸¸å¤„ç†</h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•è¿›è¡Œé™æµæ“ä½œï¼Œé‚£ä¹ˆé™æµçŠ¶æ€ä¸‹çš„è¿”å›ç»“æœè¯¥æ€ä¹ˆä¿®æ”¹å‘¢ï¼Œæˆ‘ä»¬çœ‹åˆ°è¢«é™æµä¹‹åè¿”å›çš„æ˜¯Sentinelé»˜è®¤çš„æ•°æ®ï¼Œç°åœ¨æˆ‘ä»¬å¸Œæœ›è‡ªå®šä¹‰æ”¹å¦‚ä½•æ“ä½œï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘ä»¬å…ˆåˆ›å»ºå¥½è¢«é™æµçŠ¶æ€ä¸‹éœ€è¦è¿”å›çš„å†…å®¹ï¼Œå®šä¹‰ä¸€ä¸ªè¯·æ±‚æ˜ å°„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/blocked&quot;)</span></span><br><span class="line">JSONObject <span class="title function_">blocked</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    object.put(<span class="string">&quot;code&quot;</span>, <span class="number">403</span>);</span><br><span class="line">    object.put(<span class="string">&quot;success&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">    object.put(<span class="string">&quot;massage&quot;</span>, <span class="string">&quot;æ‚¨çš„è¯·æ±‚é¢‘ç‡è¿‡å¿«ï¼Œè¯·ç¨åå†è¯•ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å°†æ­¤é¡µé¢è®¾å®šä¸ºé™æµé¡µé¢ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8858</span></span><br><span class="line">      <span class="comment"># å°†åˆšåˆšç¼–å†™çš„è¯·æ±‚æ˜ å°„è®¾å®šä¸ºé™æµé¡µé¢</span></span><br><span class="line">      <span class="attr">block-page:</span> <span class="string">/blocked</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œå½“è¢«é™æµæ—¶ï¼Œå°±ä¼šè¢«é‡å®šå‘åˆ°æŒ‡å®šé¡µé¢ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pmyc5o1uj21gi06m3zc.jpg" alt="image-20220328153755461"></p>
<p>é‚£ä¹ˆï¼Œå¯¹äºæ–¹æ³•çº§åˆ«çš„é™æµå‘¢ï¼Ÿç»è¿‡å‰é¢çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“ï¼Œå½“æŸä¸ªæ–¹æ³•è¢«é™æµæ—¶ï¼Œä¼šç›´æ¥åœ¨åå°æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µæˆ‘ä»¬è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¹‹å‰åœ¨Hystrixä¸­å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼Œè¿™æ ·å½“å‡ºç°å¼‚å¸¸æ—¶ä¼šç›´æ¥æ‰§è¡Œæˆ‘ä»¬çš„æ›¿ä»£æ–¹æ³•å¹¶è¿”å›ï¼ŒSentinelä¹Ÿå¯ä»¥ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬è¿˜æ˜¯åœ¨<code>getUserBorrowDetailByUid</code>æ–¹æ³•ä¸Šè¿›è¡Œé…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;getBorrow&quot;, blockHandler = &quot;blocked&quot;)</span>   <span class="comment">//æŒ‡å®šblockHandlerï¼Œä¹Ÿå°±æ˜¯è¢«é™æµä¹‹åçš„æ›¿ä»£è§£å†³æ–¹æ¡ˆï¼Œè¿™æ ·å°±ä¸ä¼šä½¿ç”¨é»˜è®¤çš„æŠ›å‡ºå¼‚å¸¸çš„å½¢å¼äº†</span></span><br><span class="line"><span class="keyword">public</span> UserBorrowDetail <span class="title function_">getUserBorrowDetailByUid</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">    List&lt;Borrow&gt; borrow = mapper.getBorrowsByUid(uid);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userClient.getUserById(uid);</span><br><span class="line">    List&lt;Book&gt; bookList = borrow</span><br><span class="line">            .stream()</span><br><span class="line">            .map(b -&gt; bookClient.getBookById(b.getBid()))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(user, bookList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ›¿ä»£æ–¹æ¡ˆï¼Œæ³¨æ„å‚æ•°å’Œè¿”å›å€¼éœ€è¦ä¿æŒä¸€è‡´ï¼Œå¹¶ä¸”å‚æ•°æœ€åè¿˜éœ€è¦é¢å¤–æ·»åŠ ä¸€ä¸ªBlockException</span></span><br><span class="line"><span class="keyword">public</span> UserBorrowDetail <span class="title function_">blocked</span><span class="params">(<span class="type">int</span> uid, BlockException e)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(<span class="literal">null</span>, Collections.emptyList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€æ—¦è¢«é™æµå°†æ‰§è¡Œæ›¿ä»£æ–¹æ¡ˆï¼Œæœ€åè¿”å›çš„ç»“æœå°±æ˜¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pn56vzirj217y06kaai.jpg" alt="image-20220328154430549"></p>
<p>æ³¨æ„<code>blockHandler</code>åªèƒ½å¤„ç†é™æµæƒ…å†µä¸‹æŠ›å‡ºçš„å¼‚å¸¸ï¼ŒåŒ…æ‹¬ä¸‹é¢å³å°†è¦ä»‹ç»çš„çƒ­ç‚¹å‚æ•°é™æµä¹Ÿæ˜¯åŒç†ï¼Œå¦‚æœæ˜¯æ–¹æ³•æœ¬èº«æŠ›å‡ºçš„å…¶ä»–ç±»å‹å¼‚å¸¸ï¼Œä¸åœ¨ç®¡æ§èŒƒå›´å†…ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å…¶ä»–å‚æ•°è¿›è¡Œå¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;test&quot;,</span></span><br><span class="line"><span class="meta">        fallback = &quot;except&quot;,    //fallbackæŒ‡å®šå‡ºç°å¼‚å¸¸æ—¶çš„æ›¿ä»£æ–¹æ¡ˆ</span></span><br><span class="line"><span class="meta">        exceptionsToIgnore = IOException.class)</span>  <span class="comment">//å¿½ç•¥é‚£äº›å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›å¼‚å¸¸å‡ºç°æ—¶ä¸ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ</span></span><br><span class="line">String <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;HelloWorldï¼&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ›¿ä»£æ–¹æ³•å¿…é¡»å’ŒåŸæ–¹æ³•è¿”å›å€¼å’Œå‚æ•°ä¸€è‡´ï¼Œæœ€åå¯ä»¥æ·»åŠ ä¸€ä¸ªThrowableä½œä¸ºå‚æ•°æ¥å—å¼‚å¸¸</span></span><br><span class="line">String <span class="title function_">except</span><span class="params">(Throwable t)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t.getMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œå…¶ä»–çš„å¼‚å¸¸ä¹Ÿå¯ä»¥æœ‰æ›¿ä»£æ–¹æ¡ˆäº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0po5s15rej218u06uwev.jpg" alt="image-20220328161940219"></p>
<p>ç‰¹åˆ«æ³¨æ„è¿™ç§æ–¹å¼ä¼šåœ¨æ²¡æœ‰é…ç½®<code>blockHandler</code>çš„æƒ…å†µä¸‹ï¼Œå°†Sentinelæœºåˆ¶å†…ï¼ˆä¹Ÿå°±æ˜¯é™æµçš„å¼‚å¸¸ï¼‰çš„å¼‚å¸¸ä¹Ÿä¸€å¹¶å¤„ç†äº†ï¼Œå¦‚æœé…ç½®äº†<code>blockHandler</code>ï¼Œé‚£ä¹ˆåœ¨å‡ºç°é™æµæ—¶ï¼Œä¾ç„¶åªä¼šæ‰§è¡Œ<code>blockHandler</code>æŒ‡å®šçš„æ›¿ä»£æ–¹æ¡ˆï¼ˆå› ä¸ºé™æµæ˜¯åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰è¿›è¡Œçš„ï¼‰</p>
<h3 id="çƒ­ç‚¹å‚æ•°é™æµ"><a href="#çƒ­ç‚¹å‚æ•°é™æµ" class="headerlink" title="çƒ­ç‚¹å‚æ•°é™æµ"></a>çƒ­ç‚¹å‚æ•°é™æµ</h3><p>æˆ‘ä»¬è¿˜å¯ä»¥å¯¹æŸä¸€çƒ­ç‚¹æ•°æ®è¿›è¡Œç²¾å‡†é™æµï¼Œæ¯”å¦‚åœ¨æŸä¸€æ—¶åˆ»ï¼Œä¸åŒå‚æ•°è¢«æºå¸¦è®¿é—®çš„é¢‘ç‡æ˜¯ä¸ä¸€æ ·çš„ï¼š</p>
<ul>
<li><a href="http://localhost:8301/test?a=10">http://localhost:8301/test?a=10</a>  è®¿é—®100æ¬¡</li>
<li><a href="http://localhost:8301/test?b=10">http://localhost:8301/test?b=10</a>  è®¿é—®0æ¬¡</li>
<li><a href="http://localhost:8301/test?c=10">http://localhost:8301/test?c=10</a>  è®¿é—®3æ¬¡</li>
</ul>
<p>ç”±äºæºå¸¦å‚æ•°<code>a</code>çš„è¯·æ±‚æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å°±å¯ä»¥åªå¯¹æºå¸¦å‚æ•°<code>a</code>çš„è¯·æ±‚è¿›è¡Œé™æµã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æµ‹è¯•è¯·æ±‚æ˜ å°„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(&quot;test&quot;)</span>   <span class="comment">//æ³¨æ„è¿™é‡Œéœ€è¦æ·»åŠ @SentinelResourceæ‰å¯ä»¥ï¼Œç”¨æˆ·èµ„æºåç§°å°±ä½¿ç”¨è¿™é‡Œå®šä¹‰çš„èµ„æºåç§°</span></span><br><span class="line">String <span class="title function_">findUserBorrows2</span><span class="params">(<span class="meta">@RequestParam(value = &quot;a&quot;, required = false)</span> <span class="type">int</span> a,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(value = &quot;b&quot;, required = false)</span> <span class="type">int</span> b,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(value = &quot;c&quot;,required = false)</span> <span class="type">int</span> c)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;è¯·æ±‚æˆåŠŸï¼a = &quot;</span>+a+<span class="string">&quot;, b = &quot;</span>+b+<span class="string">&quot;, c = &quot;</span>+c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬åœ¨Sentinelé‡Œé¢è¿›è¡Œçƒ­ç‚¹é…ç½®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0plrnnjlqj22fh0u0aec.jpg" alt="image-20220328145654180"></p>
<p>ç„¶åå¼€å§‹è®¿é—®æˆ‘ä»¬çš„æµ‹è¯•æ¥å£ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æºå¸¦å‚æ•°aæ—¶ï¼Œå½“è®¿é—®é¢‘ç‡è¶…è¿‡è®¾å®šå€¼ï¼Œå°±ä¼šç›´æ¥è¢«é™æµï¼Œè¿™é‡Œæ˜¯ç›´æ¥åœ¨åå°æŠ›å‡ºå¼‚å¸¸ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pls7lm97j21j20d6q4z.jpg" alt="image-20220328145726479"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0plto9gujj222e07imyn.jpg" alt="image-20220328145851133"></p>
<p>è€Œæˆ‘ä»¬ä½¿ç”¨å…¶ä»–å‚æ•°æˆ–æ˜¯ä¸å¸¦<code>a</code>å‚æ•°ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pltgil5hj214w07mwf3.jpg" alt="image-20220328145838378"></p>
<p>é™¤äº†ç›´æ¥å¯¹æŸä¸ªå‚æ•°ç²¾å‡†é™æµå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹å‚æ•°æºå¸¦çš„æŒ‡å®šå€¼å•ç‹¬è®¾å®šé˜ˆå€¼ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨ä¸ä»…å¸Œæœ›å¯¹å‚æ•°<code>a</code>é™æµï¼Œè€Œä¸”è¿˜å¸Œæœ›å½“å‚æ•°<code>a</code>çš„å€¼ä¸º10æ—¶ï¼ŒQPSè¾¾åˆ°5å†è¿›è¡Œé™æµï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¾å®šä¾‹å¤–ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0plwl48w0j220a0u0gp0.jpg" alt="image-20220328150138096"></p>
<p>è¿™æ ·ï¼Œå½“è¯·æ±‚æºå¸¦å‚æ•°<code>a</code>ï¼Œä¸”å‚æ•°<code>a</code>çš„å€¼ä¸º10æ—¶ï¼Œé˜ˆå€¼å°†æŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„ç‰¹ä¾‹è¿›è¡Œè®¡ç®—ã€‚</p>
<h3 id="æœåŠ¡ç†”æ–­å’Œé™çº§"><a href="#æœåŠ¡ç†”æ–­å’Œé™çº§" class="headerlink" title="æœåŠ¡ç†”æ–­å’Œé™çº§"></a>æœåŠ¡ç†”æ–­å’Œé™çº§</h3><p>è¿˜è®°å¾—æˆ‘ä»¬å‰æ‰€è¯´çš„æœåŠ¡é™çº§å—ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦åœ¨æ•´ä¸ªå¾®æœåŠ¡è°ƒç”¨é“¾è·¯å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼ŒåŠæ—¶å¯¹æœåŠ¡è¿›è¡Œé™çº§ï¼Œä»¥é˜²æ­¢é—®é¢˜è¿›ä¸€æ­¥æ¶åŒ–ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ky50sw4jj219s07yabg.jpg" alt="image-20220324141706946"></p>
<p>é‚£ä¹ˆï¼Œå„ä½æ˜¯å¦æœ‰æ€è€ƒè¿‡ï¼Œå¦‚æœåœ¨æŸä¸€æ—¶åˆ»ï¼ŒæœåŠ¡Bå‡ºç°æ•…éšœï¼ˆå¯èƒ½å°±å¡åœ¨é‚£é‡Œäº†ï¼‰ï¼Œè€Œè¿™æ—¶æœåŠ¡Aä¾ç„¶æœ‰å¤§é‡çš„è¯·æ±‚ï¼Œåœ¨è°ƒç”¨æœåŠ¡Bï¼Œé‚£ä¹ˆï¼Œç”±äºæœåŠ¡Aæ²¡åŠæ³•å†çŸ­æ—¶é—´å†…å®Œæˆå¤„ç†ï¼Œæ–°æ¥çš„è¯·æ±‚å°±ä¼šå¯¼è‡´çº¿ç¨‹æ•°ä¸æ–­åœ°å¢åŠ ï¼Œè¿™æ ·ï¼ŒCPUçš„èµ„æºå¾ˆå¿«å°±ä¼šè¢«è€—å°½ã€‚</p>
<p>é‚£ä¹ˆè¦é˜²æ­¢è¿™ç§æƒ…å†µï¼Œå°±åªèƒ½è¿›è¡Œéš”ç¦»äº†ï¼Œè¿™é‡Œæˆ‘ä»¬æä¸¤ç§éš”ç¦»æ–¹æ¡ˆï¼š</p>
<ol>
<li><p><strong>çº¿ç¨‹æ± éš”ç¦»</strong></p>
<p>çº¿ç¨‹æ± éš”ç¦»å®é™…ä¸Šå°±æ˜¯å¯¹æ¯ä¸ªæœåŠ¡çš„è¿œç¨‹è°ƒç”¨å•ç‹¬å¼€æ”¾çº¿ç¨‹æ± ï¼Œæ¯”å¦‚æœåŠ¡Aè¦è°ƒç”¨æœåŠ¡Bï¼Œé‚£ä¹ˆåªåŸºäºå›ºå®šæ•°é‡çš„çº¿ç¨‹æ± ï¼Œè¿™æ ·å³ä½¿åœ¨çŸ­æ—¶é—´å†…å‡ºç°å¤§é‡è¯·æ±‚ï¼Œç”±äºæ²¡æœ‰çº¿ç¨‹å¯ä»¥åˆ†é…ï¼Œæ‰€ä»¥å°±ä¸ä¼šå¯¼è‡´èµ„æºè€—å°½äº†ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0ph7xi5qbj21fo09y404.jpg" alt="image-20220328121932455"></p>
</li>
<li><p><strong>ä¿¡å·é‡éš”ç¦»</strong></p>
<p>ä¿¡å·é‡éš”ç¦»æ˜¯ä½¿ç”¨<code>Semaphore</code>ç±»å®ç°çš„ï¼ˆå¦‚æœä¸äº†è§£ï¼Œå¯ä»¥è§‚çœ‹æœ¬ç³»åˆ— å¹¶å‘ç¼–ç¨‹ç¯‡ è§†é¢‘æ•™ç¨‹ï¼‰ï¼Œæ€æƒ³åŸºæœ¬ä¸Šä¸ä¸Šé¢æ˜¯ç›¸åŒçš„ï¼Œä¹Ÿæ˜¯é™å®šæŒ‡å®šçš„çº¿ç¨‹æ•°é‡èƒ½å¤ŸåŒæ—¶è¿›è¡ŒæœåŠ¡è°ƒç”¨ï¼Œä½†æ˜¯å®ƒç›¸å¯¹äºçº¿ç¨‹æ± éš”ç¦»ï¼Œå¼€é”€ä¼šæ›´å°ä¸€äº›ï¼Œä½¿ç”¨æ•ˆæœåŒæ ·ä¼˜ç§€ï¼Œä¹Ÿæ”¯æŒè¶…æ—¶ç­‰ã€‚</p>
<p>Sentinelä¹Ÿæ­£æ˜¯é‡‡ç”¨çš„è¿™ç§æ–¹æ¡ˆå®ç°éš”ç¦»çš„ã€‚</p>
</li>
</ol>
<p>å¥½äº†ï¼Œè¯´å›æˆ‘ä»¬çš„ç†”æ–­å’Œé™çº§ï¼Œå½“ä¸‹æ¸¸æœåŠ¡å› ä¸ºæŸç§åŸå› å˜å¾—ä¸å¯ç”¨æˆ–å“åº”è¿‡æ…¢æ—¶ï¼Œä¸Šæ¸¸æœåŠ¡ä¸ºäº†ä¿è¯è‡ªå·±æ•´ä½“æœåŠ¡çš„å¯ç”¨æ€§ï¼Œä¸å†ç»§ç»­è°ƒç”¨ç›®æ ‡æœåŠ¡è€Œæ˜¯å¿«é€Ÿè¿”å›æˆ–æ˜¯æ‰§è¡Œè‡ªå·±çš„æ›¿ä»£æ–¹æ¡ˆï¼Œè¿™ä¾¿æ˜¯æœåŠ¡é™çº§ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0phzsecsij20ig0i274r.jpg" alt="image-20220328124619289"></p>
<p>æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªçŠ¶æ€ï¼š</p>
<ul>
<li>å…³é—­ï¼šç†”æ–­å™¨ä¸å·¥ä½œï¼Œæ‰€æœ‰è¯·æ±‚å…¨éƒ¨è¯¥å¹²å˜›å¹²å˜›ã€‚</li>
<li>æ‰“å¼€ï¼šç†”æ–­å™¨å·¥ä½œï¼Œæ‰€æœ‰è¯·æ±‚ä¸€å¾‹é™çº§å¤„ç†ã€‚</li>
<li>åŠå¼€ï¼šå°è¯•è¿›è¡Œä¸€ä¸‹ä¸‹æ­£å¸¸æµç¨‹ï¼Œè¦æ˜¯è¿˜ä¸è¡Œç»§ç»­ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œå¦åˆ™å…³é—­ã€‚</li>
</ul>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹Sentinelä¸­å¦‚ä½•è¿›è¡Œç†”æ–­å’Œé™çº§æ“ä½œï¼Œæ‰“å¼€ç®¡ç†é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±æ–°å¢ç†”æ–­è§„åˆ™ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pi4xii37j22mo0t4dku.jpg" alt="image-20220328125115760"></p>
<p>å…¶ä¸­ï¼Œç†”æ–­ç­–ç•¥æœ‰ä¸‰ç§æ¨¡å¼ï¼š</p>
<ol>
<li><p><strong>æ…¢è°ƒç”¨æ¯”ä¾‹ï¼š</strong>å¦‚æœå‡ºç°é‚£ç§åŠå¤©éƒ½å¤„ç†ä¸å®Œçš„è°ƒç”¨ï¼Œæœ‰å¯èƒ½å°±æ˜¯æœåŠ¡å‡ºç°æ•…éšœï¼Œå¯¼è‡´å¡é¡¿ï¼Œè¿™ä¸ªé€‰é¡¹æ˜¯æŒ‰ç…§æœ€å¤§å“åº”æ—¶é—´ï¼ˆRTï¼‰è¿›è¡Œåˆ¤å®šï¼Œå¦‚æœä¸€æ¬¡è¯·æ±‚çš„å¤„ç†æ—¶é—´è¶…è¿‡äº†æŒ‡å®šçš„RTï¼Œé‚£ä¹ˆå°±è¢«åˆ¤å®šä¸º<code>æ…¢è°ƒç”¨</code>ï¼Œåœ¨ä¸€ä¸ªç»Ÿè®¡æ—¶é•¿å†…ï¼Œå¦‚æœè¯·æ±‚æ•°ç›®å¤§äºæœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”è¢«åˆ¤å®šä¸º<code>æ…¢è°ƒç”¨</code>çš„è¯·æ±‚æ¯”ä¾‹å·²ç»è¶…è¿‡é˜ˆå€¼ï¼Œå°†è§¦å‘ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿ä¹‹åï¼Œå°†ä¼šè¿›å…¥åˆ°åŠå¼€çŠ¶æ€è¿›è¡Œè¯•æ¢ï¼ˆè¿™é‡Œå’ŒHystrixä¸€è‡´ï¼‰</p>
<p>ç„¶åä¿®æ”¹ä¸€ä¸‹æ¥å£çš„æ‰§è¡Œï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹æ…¢è°ƒç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/borrow2/&#123;uid&#125;&quot;)</span></span><br><span class="line">UserBorrowDetail <span class="title function_">findUserBorrows2</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡å¯ï¼Œç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç†”æ–­è§„åˆ™ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pipk23g6j227a0o0tbt.jpg" alt="image-20220328131105084"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¶…æ—¶ç›´æ¥è§¦å‘äº†ç†”æ–­ï¼Œè¿›å…¥åˆ°é˜»æ­¢é¡µé¢ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pior2olsj21nm088wf8.jpg" alt="image-20220328131018951"></p>
</li>
<li><p><strong>å¼‚å¸¸æ¯”ä¾‹ï¼š</strong>è¿™ä¸ªä¸æ…¢è°ƒç”¨æ¯”ä¾‹ç±»ä¼¼ï¼Œä¸è¿‡è¿™é‡Œåˆ¤æ–­çš„æ˜¯å‡ºç°å¼‚å¸¸çš„æ¬¡æ•°ï¼Œä¸ä¸Šé¢ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿæ¥è¿›è¡Œä¸€äº›å°æµ‹è¯•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/borrow2/&#123;uid&#125;&quot;)</span></span><br><span class="line">UserBorrowDetail <span class="title function_">findUserBorrows2</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æœåŠ¡å™¨ï¼Œæ¥ç€æ·»åŠ æˆ‘ä»¬çš„ç†”æ–­è§„åˆ™ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pj3qutgtj225o0noju9.jpg" alt="image-20220328132443315"></p>
<p>ç°åœ¨æˆ‘ä»¬è¿›è¡Œè®¿é—®ï¼Œä¼šå‘ç°åå°ç–¯ç‹‚æŠ¥é”™ï¼Œç„¶åå°±ç†”æ–­äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pj7f4fgbj22180cswjm.jpg" alt="image-20220328132815856"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pj78bdkgj21a606i3z5.jpg" alt="image-20220328132804164"></p>
</li>
<li><p><strong>å¼‚å¸¸æ•°ï¼š</strong>è¿™ä¸ªå’Œä¸Šé¢çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼Œåªè¦è¾¾åˆ°æŒ‡å®šçš„å¼‚å¸¸æ•°é‡ï¼Œå°±ç†”æ–­ï¼Œè¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ç†”æ–­è§„åˆ™ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pj8oajy0j221u0nk419.jpg" alt="image-20220328132927745"></p>
<p>ç°åœ¨æˆ‘ä»¬å†æ¬¡ä¸æ–­è®¿é—®æ­¤æ¥å£ï¼Œå¯ä»¥å‘ç°ï¼Œæ•ˆæœè·Ÿä¹‹å‰å…¶å®æ˜¯å·®ä¸å¤šçš„ï¼Œåªæ˜¯åˆ¤æ–­çš„ç­–ç•¥ç¨å¾®ä¸åŒç½¢äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pj78bdkgj21a606i3z5.jpg" alt="image-20220328132804164"></p>
</li>
</ol>
<p>é‚£ä¹ˆç†”æ–­è§„åˆ™å¦‚ä½•è®¾å®šæˆ‘ä»¬äº†è§£äº†ï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•è‡ªå®šä¹‰æœåŠ¡é™çº§å‘¢ï¼Ÿä¹‹å‰åœ¨ä½¿ç”¨Hystrixçš„æ—¶å€™ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œå¯ä»¥æ‰§è¡Œæˆ‘ä»¬çš„æ›¿ä»£æ–¹æ¡ˆï¼ŒSentinelä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>
<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨<code>@SentinelResource</code>ä¸­é…ç½®<code>blockHandler</code>å‚æ•°ï¼ˆé‚£è¿™é‡Œè·Ÿå‰é¢é‚£ä¸ªæ–¹æ³•é™æµçš„é…ç½®ä¸æ˜¯ä¸€æ¯›ä¸€æ ·å—ï¼Ÿæ²¡é”™ï¼Œå› ä¸ºå¦‚æœæ·»åŠ äº†<code>@SentinelResource</code>æ³¨è§£ï¼Œé‚£ä¹ˆè¿™é‡Œä¼šè¿›è¡Œæ–¹æ³•çº§åˆ«ç»†ç²’åº¦çš„é™åˆ¶ï¼Œå’Œä¹‹å‰æ–¹æ³•çº§åˆ«é™æµä¸€æ ·ï¼Œä¼šåœ¨é™çº§ä¹‹åç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœä¸æ·»åŠ åˆ™è¿”å›é»˜è®¤çš„é™æµé¡µé¢ï¼Œ<code>blockHandler</code>çš„ç›®çš„å°±æ˜¯å¤„ç†è¿™ç§Sentinelæœºåˆ¶ä¸Šçš„å¼‚å¸¸ï¼Œæ‰€ä»¥è¿™é‡Œå…¶å®å’Œä¹‹å‰çš„é™æµé…ç½®æ˜¯ä¸€ä¸ªé“ç†ï¼Œå› æ­¤ä¸‹é¢ç†”æ–­é…ç½®ä¹Ÿåº”è¯¥å¯¹<code>value</code>è‡ªå®šä¹‰åç§°çš„èµ„æºè¿›è¡Œé…ç½®ï¼Œæ‰èƒ½ä½œç”¨åˆ°æ­¤æ–¹æ³•ä¸Šï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/borrow2/&#123;uid&#125;&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;findUserBorrows2&quot;, blockHandler = &quot;test&quot;)</span></span><br><span class="line">UserBorrowDetail <span class="title function_">findUserBorrows2</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">UserBorrowDetail <span class="title function_">test</span><span class="params">(<span class="type">int</span> uid, BlockException e)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(<span class="keyword">new</span> <span class="title class_">User</span>(), Collections.emptyList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬å¯¹è¿›è¡Œç†”æ–­é…ç½®ï¼Œæ³¨æ„æ˜¯å¯¹æˆ‘ä»¬æ·»åŠ çš„<code>@SentinelResource</code>ä¸­æŒ‡å®šåç§°çš„<code>findUserBorrows2</code>è¿›è¡Œé…ç½®ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pno8hcvoj22le0nuafl.jpg" alt="image-20220328160248977"></p>
<p>OKï¼Œå¯ä»¥çœ‹åˆ°ç†”æ–­ä¹‹åï¼ŒæœåŠ¡é™çº§ä¹‹åçš„æ•ˆæœï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pnmjycafj21ci06o3z9.jpg" alt="image-20220328160112038"></p>
<p>æœ€åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•è®©Feignçš„ä¹Ÿæ”¯æŒSentinelï¼Œå‰é¢æˆ‘ä»¬ä½¿ç”¨Hystrixçš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥å¯¹Feignçš„æ¯ä¸ªæ¥å£è°ƒç”¨å•ç‹¬è¿›è¡ŒæœåŠ¡é™çº§ï¼Œè€Œä½¿ç”¨Sentinelï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯æ”¯æŒï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åçš„æ­¥éª¤å…¶å®å’Œä¹‹å‰æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œé¦–å…ˆåˆ›å»ºå®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserClientFallback</span> <span class="keyword">implements</span> <span class="title class_">UserClient</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;æˆ‘æ˜¯æ›¿ä»£æ–¹æ¡ˆ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åç›´æ¥å¯åŠ¨å°±å¯ä»¥äº†ï¼Œä¸­é€”çš„æ—¶å€™æˆ‘ä»¬å§ç”¨æˆ·æœåŠ¡å…¨éƒ¨ä¸‹æ‰ï¼Œå¯ä»¥çœ‹åˆ°æ­£å¸¸ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0pp7oe8yuj228k06iwfy.jpg" alt="image-20220328165606119"></p>
<p>è¿™æ ·Feignçš„é…ç½®å°±OKäº†ï¼Œé‚£ä¹ˆä¼ ç»Ÿçš„RestTemplateå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@SentinelRestTemplate</code>æ³¨è§£å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="meta">@SentinelRestTemplate(blockHandler = &quot;handleException&quot;, blockHandlerClass = ExceptionUtil.class,</span></span><br><span class="line"><span class="meta">    fallback = &quot;fallback&quot;, fallbackClass = ExceptionUtil.class)</span> <span class="comment">//è¿™é‡ŒåŒæ ·å¯ä»¥è®¾å®šfallbackç­‰å‚æ•°</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±ä¸å¤šåšèµ˜è¿°äº†ã€‚</p>
<hr>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0qla4zlihj21m0064glz.jpg" alt="image-20220329112537891"></p>
<h2 id="Seataä¸åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#Seataä¸åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="Seataä¸åˆ†å¸ƒå¼äº‹åŠ¡"></a>Seataä¸åˆ†å¸ƒå¼äº‹åŠ¡</h2><p>é‡éš¾ç‚¹å†…å®¹ï¼Œå‘ä¹Ÿå¤šå¾—ç¦»è°±ï¼Œæœ€å¥½ä¿æŒè·ŸUPä¸€æ ·çš„ç‰ˆæœ¬ï¼Œ<strong>å®˜æ–¹æ–‡æ¡£ï¼š</strong><a href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></p>
<p>åœ¨å‰é¢çš„é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ è¿‡äº‹åŠ¡ï¼Œè¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è°ˆåˆ°çš„æ•°æ®åº“äº‹åŠ¡çš„ç‰¹æ€§å—ï¼Ÿ</p>
<ul>
<li><strong>åŸå­æ€§ï¼š</strong>ä¸€ä¸ªäº‹åŠ¡ï¼ˆtransactionï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚</li>
<li><strong>ä¸€è‡´æ€§ï¼š</strong>åœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰å’Œäº‹åŠ¡ç»“æŸä»¥åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§æ²¡æœ‰è¢«ç ´åã€‚è¿™è¡¨ç¤ºå†™å…¥çš„èµ„æ–™å¿…é¡»å®Œå…¨ç¬¦åˆæ‰€æœ‰çš„é¢„è®¾è§„åˆ™ï¼Œè¿™åŒ…å«èµ„æ–™çš„ç²¾ç¡®åº¦ã€ä¸²è”æ€§ä»¥åŠåç»­æ•°æ®åº“å¯ä»¥è‡ªå‘æ€§åœ°å®Œæˆé¢„å®šçš„å·¥ä½œã€‚</li>
<li><strong>éš”ç¦»æ€§ï¼š</strong>æ•°æ®åº“å…è®¸å¤šä¸ªå¹¶å‘äº‹åŠ¡åŒæ—¶å¯¹å…¶æ•°æ®è¿›è¡Œè¯»å†™å’Œä¿®æ”¹çš„èƒ½åŠ›ï¼Œéš”ç¦»æ€§å¯ä»¥é˜²æ­¢å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ç”±äºäº¤å‰æ‰§è¡Œè€Œå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚äº‹åŠ¡éš”ç¦»åˆ†ä¸ºä¸åŒçº§åˆ«ï¼ŒåŒ…æ‹¬è¯»æœªæäº¤ï¼ˆRead uncommittedï¼‰ã€è¯»å·²æäº¤ï¼ˆread committedï¼‰ã€å¯é‡å¤è¯»ï¼ˆrepeatable readï¼‰å’Œä¸²è¡ŒåŒ–ï¼ˆSerializableï¼‰ã€‚</li>
<li><strong>æŒä¹…æ€§ï¼š</strong>äº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li>
</ul>
<p>é‚£ä¹ˆå„ä½è¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œæœ‰å¯èƒ½å‡ºç°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸‹å•è´­ç‰©ï¼Œé‚£ä¹ˆæ•´ä¸ªæµç¨‹å¯èƒ½æ˜¯è¿™æ ·çš„ï¼šå…ˆè°ƒç”¨åº“å­˜æœåŠ¡å¯¹åº“å­˜è¿›è¡Œå‡æ‰£ -&gt; ç„¶åè®¢å•æœåŠ¡å¼€å§‹ä¸‹å• -&gt; æœ€åç”¨æˆ·è´¦æˆ·æœåŠ¡è¿›è¡Œæ‰£æ¬¾ï¼Œè™½ç„¶çœ‹ä¼¼æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ä¸€ä¸ªæµç¨‹ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰äº‹åŠ¡çš„åŠ æŒï¼Œå¾ˆæœ‰å¯èƒ½ä¼šç”±äºä¸­é€”å‡ºé”™ï¼Œæ¯”å¦‚æ•´ä¸ªæµç¨‹ä¸­è®¢å•æœåŠ¡å‡ºç°é—®é¢˜ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´åº“å­˜æ‰£äº†ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªè®¢å•å¹¶æ²¡æœ‰ç”Ÿæˆï¼Œç”¨æˆ·ä¹Ÿæ²¡æœ‰ä»˜æ¬¾ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0qkx2w3olj21jo0763zr.jpg" alt="image-20220329111304542"></p>
<p>ä¸Šé¢è¿™ç§æƒ…å†µæ—¶é—´å°±æ˜¯ä¸€ç§å¤šæœåŠ¡å¤šæ•°æ®æºçš„åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å‹ï¼ˆæ¯”è¾ƒå¸¸è§ï¼‰ï¼Œå› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±å¾—å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œè®©è¿™æ•´ä¸ªæµç¨‹ä¿è¯åŸå­æ€§ã€‚</p>
<p>SpringCloud Alibabaä¸ºæˆ‘ä»¬æä¾›äº†ç”¨äºå¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„ç»„ä»¶Seataã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0qlfjws7cj21da0qkmzw.jpg" alt="image-20220329113049408"></p>
<p>Seata æ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚Seata å°†ä¸ºç”¨æˆ·æä¾›äº† ATã€TCCã€SAGA å’Œ XA äº‹åŠ¡æ¨¡å¼ï¼Œä¸ºç”¨æˆ·æ‰“é€ ä¸€ç«™å¼çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å®é™…ä¸Šï¼Œå°±æ˜¯å¤šäº†ä¸€ä¸ªä¸­é—´äººæ¥åè°ƒæ‰€æœ‰æœåŠ¡çš„äº‹åŠ¡ã€‚</p>
<h3 id="é¡¹ç›®ç¯å¢ƒæ­å»º"><a href="#é¡¹ç›®ç¯å¢ƒæ­å»º" class="headerlink" title="é¡¹ç›®ç¯å¢ƒæ­å»º"></a>é¡¹ç›®ç¯å¢ƒæ­å»º</h3><p>è¿™é‡Œæˆ‘ä»¬å¯¹æˆ‘ä»¬ä¹‹å‰çš„å›¾ä¹¦ç®¡ç†ç³»ç»Ÿè¿›è¡Œå‡çº§ï¼š</p>
<ul>
<li>æ¯ä¸ªç”¨æˆ·æœ€å¤šåªèƒ½åŒæ—¶å€Ÿé˜…2æœ¬ä¸åŒçš„ä¹¦ã€‚</li>
<li>å›¾ä¹¦é¦†ä¸­æ‰€æœ‰çš„ä¹¦éƒ½æœ‰3æœ¬ã€‚</li>
<li>ç”¨æˆ·å€Ÿä¹¦æµç¨‹ï¼šå…ˆè°ƒç”¨å›¾ä¹¦æœåŠ¡ä¹¦ç±æ•°é‡-1 -&gt;  æ·»åŠ å€Ÿé˜…è®°å½•  -&gt;  è°ƒç”¨ç”¨æˆ·æœåŠ¡ç”¨æˆ·å¯å€Ÿé˜…æ•°é‡-1</li>
</ul>
<p>é‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œä¸ºäº†ç®€ä¾¿ï¼Œå°±ç›´æ¥åœ¨ç”¨æˆ·è¡¨ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µç”¨äºå­˜å‚¨ç”¨æˆ·èƒ½å¤Ÿå€Ÿé˜…çš„ä¹¦ç±æ•°é‡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0qph7expaj21io07e0tt.jpg" alt="image-20220329135048063"></p>
<p>ç„¶åä¿®æ”¹ä¹¦ç±ä¿¡æ¯ï¼Œä¹Ÿæ˜¯ç›´æ¥æ·»åŠ ä¸€ä¸ªå­—æ®µç”¨äºè®°å½•å‰©ä½™æ•°é‡ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0qpjm6mlaj21i006k3ze.jpg" alt="image-20220329135307659"></p>
<p>æ¥ç€æˆ‘ä»¬å»ç¼–å†™ä¸€ä¸‹å¯¹åº”çš„æœåŠ¡å§ï¼Œé¦–å…ˆæ˜¯ç”¨æˆ·æœåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from DB_USER where uid = #&#123;uid&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="type">int</span> uid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select book_count from DB_USER where uid = #&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getUserBookRemain</span><span class="params">(<span class="type">int</span> uid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update DB_USER set book_count = #&#123;count&#125; where uid = #&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateBookCount</span><span class="params">(<span class="type">int</span> uid, <span class="type">int</span> count)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserById</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mapper.getUserById(uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getRemain</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mapper.getUserBookRemain(uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">setRemain</span><span class="params">(<span class="type">int</span> uid, <span class="type">int</span> count)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mapper.updateBookCount(uid, count) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getUserById(uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/remain/&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">userRemain</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getRemain(uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/borrow/&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">userBorrow</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">remain</span> <span class="operator">=</span> service.getRemain(uid);</span><br><span class="line">        <span class="keyword">return</span> service.setRemain(uid, remain - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ˜¯å›¾ä¹¦æœåŠ¡ï¼Œå…¶å®è·Ÿç”¨æˆ·æœåŠ¡å·®ä¸å¤šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from DB_BOOK where bid = #&#123;bid&#125;&quot;)</span></span><br><span class="line">    Book <span class="title function_">getBookById</span><span class="params">(<span class="type">int</span> bid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select count from DB_BOOK  where bid = #&#123;bid&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getRemain</span><span class="params">(<span class="type">int</span> bid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update DB_BOOK set count = #&#123;count&#125;  where bid = #&#123;bid&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">setRemain</span><span class="params">(<span class="type">int</span> bid, <span class="type">int</span> count)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BookMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getBookById</span><span class="params">(<span class="type">int</span> bid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mapper.getBookById(bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">setRemain</span><span class="params">(<span class="type">int</span> bid, <span class="type">int</span> count)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mapper.setRemain(bid, count) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getRemain</span><span class="params">(<span class="type">int</span> bid)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mapper.getRemain(bid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BookService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/&#123;bid&#125;&quot;)</span></span><br><span class="line">    Book <span class="title function_">findBookById</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> bid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getBookById(bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/remain/&#123;bid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">bookRemain</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getRemain(uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/borrow/&#123;bid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">bookBorrow</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">remain</span> <span class="operator">=</span> service.getRemain(uid);</span><br><span class="line">        <span class="keyword">return</span> service.setRemain(uid, remain - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åå®Œå–„æˆ‘ä»¬çš„å€Ÿé˜…æœåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/&#123;uid&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/borrow/&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">userBorrow</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/remain/&#123;uid&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">userRemain</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;bookservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/&#123;bid&#125;&quot;)</span></span><br><span class="line">    Book <span class="title function_">getBookById</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> bid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/borrow/&#123;bid&#125;&quot;)</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">bookBorrow</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> bid)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/remain/&#123;bid&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">bookRemain</span><span class="params">(<span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> bid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow/&#123;uid&#125;&quot;)</span></span><br><span class="line">    UserBorrowDetail <span class="title function_">findUserBorrows</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service.getUserBorrowDetailByUid(uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/borrow/take/&#123;uid&#125;/&#123;bid&#125;&quot;)</span></span><br><span class="line">    JSONObject <span class="title function_">borrow</span><span class="params">(<span class="meta">@PathVariable(&quot;uid&quot;)</span> <span class="type">int</span> uid,</span></span><br><span class="line"><span class="params">                      <span class="meta">@PathVariable(&quot;bid&quot;)</span> <span class="type">int</span> bid)</span>&#123;</span><br><span class="line">        service.doBorrow(uid, bid);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        object.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;200&quot;</span>);</span><br><span class="line">        object.put(<span class="string">&quot;success&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        object.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;å€Ÿé˜…æˆåŠŸï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BorrowServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BorrowService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BorrowMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserClient userClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    BookClient bookClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserBorrowDetail <span class="title function_">getUserBorrowDetailByUid</span><span class="params">(<span class="type">int</span> uid)</span> &#123;</span><br><span class="line">        List&lt;Borrow&gt; borrow = mapper.getBorrowsByUid(uid);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userClient.getUserById(uid);</span><br><span class="line">        List&lt;Book&gt; bookList = borrow</span><br><span class="line">                .stream()</span><br><span class="line">                .map(b -&gt; bookClient.getBookById(b.getBid()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserBorrowDetail</span>(user, bookList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doBorrow</span><span class="params">(<span class="type">int</span> uid, <span class="type">int</span> bid)</span> &#123;</span><br><span class="line">      	<span class="comment">//1. åˆ¤æ–­å›¾ä¹¦å’Œç”¨æˆ·æ˜¯å¦éƒ½æ”¯æŒå€Ÿé˜…</span></span><br><span class="line">        <span class="keyword">if</span>(bookClient.bookRemain(bid) &lt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å›¾ä¹¦æ•°é‡ä¸è¶³&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(userClient.userRemain(uid) &lt; <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·å€Ÿé˜…é‡ä¸è¶³&quot;</span>);</span><br><span class="line">      	<span class="comment">//2. é¦–å…ˆå°†å›¾ä¹¦çš„æ•°é‡-1</span></span><br><span class="line">        <span class="keyword">if</span>(!bookClient.bookBorrow(bid))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åœ¨å€Ÿé˜…å›¾ä¹¦æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">      	<span class="comment">//3. æ·»åŠ å€Ÿé˜…ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">if</span>(mapper.getBorrow(uid, bid) != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ­¤ä¹¦ç±å·²ç»è¢«æ­¤ç”¨æˆ·å€Ÿé˜…äº†ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(mapper.addBorrow(uid, bid) &lt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åœ¨å½•å…¥å€Ÿé˜…ä¿¡æ¯æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">      	<span class="comment">//4. ç”¨æˆ·å¯å€Ÿé˜…-1</span></span><br><span class="line">        <span class="keyword">if</span>(!userClient.userBorrow(uid))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åœ¨å€Ÿé˜…æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">      	<span class="comment">//å®Œæˆ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œåªè¦æˆ‘ä»¬çš„å›¾ä¹¦å€Ÿé˜…è¿‡ç¨‹ä¸­ä»»ä½•ä¸€æ­¥å‡ºç°é—®é¢˜ï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0qrwk3pc6j21fo070aav.jpg" alt="image-20220329151445740"></p>
<p>å†æ¬¡å°è¯•å€Ÿé˜…ï¼Œåå°ä¼šç›´æ¥æŠ¥é”™ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0qrx0lrghj21oi06umzv.jpg" alt="image-20220329151512871"></p>
<p>æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå€Ÿé˜…ä¿¡æ¯æ·»åŠ å¤±è´¥äº†ï¼Œä½†æ˜¯å›¾ä¹¦çš„æ•°é‡ä¾ç„¶è¢«-1ï¼Œä¹Ÿå°±æ˜¯è¯´æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯å¸Œæœ›ä¸­é€”å‡ºç°å¼‚å¸¸ä¹‹åï¼Œä¹‹å‰çš„æ“ä½œå…¨éƒ¨å›æ»šçš„ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0qry46lk7j214o05s3z9.jpg" alt="image-20220329151615894"></p>
<p>è€Œè¿™é‡Œç”±äºæ˜¯åœ¨å¦ä¸€ä¸ªæœåŠ¡ä¸­è¿›è¡Œçš„æ•°æ®åº“æ“ä½œï¼Œæ‰€ä»¥ä¼ ç»Ÿçš„<code>@Transactional</code>æ³¨è§£æ— æ•ˆï¼Œè¿™æ—¶å°±å¾—å€ŸåŠ©Seataæä¾›åˆ†å¸ƒå¼äº‹åŠ¡äº†ã€‚</p>
<h3 id="åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ"></a>åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ</h3><p>è¦å¼€å§‹å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæˆ‘ä»¬å¾—å…ˆä»ç†è®ºä¸Šå¼€å§‹ä¸‹æ‰‹ï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹å¸¸ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚</p>
<ol>
<li><p><strong>XAåˆ†å¸ƒå¼äº‹åŠ¡åè®® - 2PCï¼ˆä¸¤é˜¶æ®µæäº¤å®ç°ï¼‰</strong></p>
<p>è¿™é‡Œçš„PCå®é™…ä¸ŠæŒ‡çš„æ˜¯Prepareå’ŒCommitï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯å‡†å¤‡ä¸€ä¸ªæ˜¯æäº¤ï¼Œæ•´ä¸ªè¿‡ç¨‹çš„å‚ä¸è€…ä¸€å…±æœ‰ä¸¤ä¸ªè§’è‰²ï¼Œä¸€ä¸ªæ˜¯äº‹åŠ¡çš„æ‰§è¡Œè€…ï¼Œä¸€ä¸ªæ˜¯äº‹åŠ¡çš„åè°ƒè€…ï¼Œå®é™…ä¸Šæ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„è¿ä½œéƒ½éœ€è¦ä¾é åè°ƒè€…æ¥ç»´æŒï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0teawzsnnj21hc0duabp.jpg" alt="image-20220331214050440"></p>
<p>åœ¨å‡†å¤‡å’Œæäº¤é˜¶æ®µï¼Œä¼šè¿›è¡Œï¼š</p>
<ul>
<li><p><strong>å‡†å¤‡é˜¶æ®µï¼š</strong></p>
<p>ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ç”±åè°ƒè€…æ¥å¼€å¯çš„ï¼Œé¦–å…ˆåè°ƒè€…ä¼šå‘æ‰€æœ‰çš„äº‹åŠ¡æ‰§è¡Œè€…å‘é€äº‹åŠ¡å†…å®¹ï¼Œç­‰å¾…æ‰€æœ‰çš„äº‹åŠ¡æ‰§è¡Œè€…ç­”å¤ã€‚</p>
<p>å„ä¸ªäº‹åŠ¡æ‰§è¡Œè€…å¼€å§‹æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œä½†æ˜¯ä¸è¿›è¡Œæäº¤ï¼Œå¹¶å°†undoå’Œredoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚</p>
<p>å¦‚æœäº‹åŠ¡æ‰§è¡Œè€…æ‰§è¡Œäº‹åŠ¡æˆåŠŸï¼Œé‚£ä¹ˆå°±å‘Šè¯‰åè°ƒè€…æˆåŠŸYesï¼Œå¦åˆ™å‘Šè¯‰åè°ƒè€…å¤±è´¥Noï¼Œä¸èƒ½æäº¤äº‹åŠ¡ã€‚</p>
</li>
<li><p><strong>æäº¤é˜¶æ®µï¼š</strong></p>
<p>å½“æ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½åé¦ˆå®Œæˆä¹‹åï¼Œè¿›å…¥ç¬¬äºŒé˜¶æ®µã€‚</p>
<p>åè°ƒè€…ä¼šæ£€æŸ¥å„ä¸ªæ‰§è¡Œè€…çš„åé¦ˆå†…å®¹ï¼Œå¦‚æœæ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½è¿”å›æˆåŠŸï¼Œé‚£ä¹ˆå°±å‘Šè¯‰æ‰€æœ‰çš„æ‰§è¡Œè€…å¯ä»¥æäº¤äº‹åŠ¡äº†ï¼Œæœ€åå†é‡Šæ”¾é”èµ„æºã€‚</p>
<p>å¦‚æœæœ‰è‡³å°‘ä¸€ä¸ªæ‰§è¡Œè€…è¿”å›å¤±è´¥æˆ–æ˜¯è¶…æ—¶ï¼Œé‚£ä¹ˆå°±è®©æ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½å›æ»šï¼Œåˆ†å¸ƒå¼äº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚</p>
</li>
</ul>
<p>è™½ç„¶è¿™ç§æ–¹å¼çœ‹èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>äº‹åŠ¡åè°ƒè€…æ˜¯éå¸¸æ ¸å¿ƒçš„è§’è‰²ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ï¼Œå°†å¯¼è‡´æ•´ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚</li>
<li>å¦‚æœæäº¤é˜¶æ®µå‘ç”Ÿç½‘ç»œé—®é¢˜ï¼Œå¯¼è‡´æŸäº›äº‹åŠ¡æ‰§è¡Œè€…æ²¡æœ‰æ”¶åˆ°åè°ƒè€…å‘æ¥çš„æäº¤å‘½ä»¤ï¼Œå°†å¯¼è‡´æŸäº›æ‰§è¡Œè€…æäº¤æŸäº›æ‰§è¡Œè€…æ²¡æäº¤ï¼Œè¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</li>
</ul>
</li>
<li><p><strong>XAåˆ†å¸ƒå¼äº‹åŠ¡åè®® - 3PCï¼ˆä¸‰é˜¶æ®µæäº¤å®ç°ï¼‰</strong></p>
<p>ä¸‰é˜¶æ®µæäº¤æ˜¯åœ¨äºŒé˜¶æ®µæäº¤åŸºç¡€ä¸Šçš„æ”¹è¿›ç‰ˆæœ¬ï¼Œä¸»è¦æ˜¯åŠ å…¥äº†è¶…æ—¶æœºåˆ¶ï¼ŒåŒæ—¶åœ¨åè°ƒè€…å’Œæ‰§è¡Œè€…ä¸­éƒ½å¼•å…¥äº†è¶…æ—¶æœºåˆ¶ã€‚</p>
<p>ä¸‰ä¸ªé˜¶æ®µåˆ†åˆ«è¿›è¡Œï¼š</p>
<ul>
<li><p><strong>CanCommité˜¶æ®µï¼š</strong></p>
<p>åè°ƒè€…å‘æ‰§è¡Œè€…å‘é€CanCommitè¯·æ±‚ï¼Œè¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œï¼Œç„¶åå¼€å§‹ç­‰å¾…æ‰§è¡Œè€…çš„å“åº”ã€‚</p>
<p>æ‰§è¡Œè€…æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœå…¶è‡ªèº«è®¤ä¸ºå¯ä»¥é¡ºåˆ©æ‰§è¡Œäº‹åŠ¡ï¼Œåˆ™è¿”å›Yeså“åº”ï¼Œå¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ï¼Œå¦åˆ™è¿”å›No</p>
</li>
<li><p><strong>PreCommité˜¶æ®µï¼š</strong></p>
<p>åè°ƒè€…æ ¹æ®æ‰§è¡Œè€…çš„ååº”æƒ…å†µæ¥å†³å®šæ˜¯å¦å¯ä»¥è¿›å…¥ç¬¬äºŒé˜¶æ®µäº‹åŠ¡çš„PreCommitæ“ä½œã€‚</p>
<p>å¦‚æœæ‰€æœ‰çš„æ‰§è¡Œè€…éƒ½è¿”å›Yesï¼Œåˆ™åè°ƒè€…å‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€PreCommitè¯·æ±‚ï¼Œå¹¶è¿›å…¥Preparedé˜¶æ®µï¼Œæ‰§è¡Œè€…æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†undoå’Œredoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ï¼Œå¦‚æœæˆåŠŸæ‰§è¡Œï¼Œåˆ™è¿”å›æˆåŠŸå“åº”ã€‚</p>
<p>å¦‚æœæ‰€æœ‰çš„æ‰§è¡Œè€…è‡³å°‘æœ‰ä¸€ä¸ªè¿”å›Noï¼Œåˆ™åè°ƒè€…å‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€abortè¯·æ±‚ï¼Œæ‰€æœ‰çš„æ‰§è¡Œè€…åœ¨æ”¶åˆ°è¯·æ±‚æˆ–æ˜¯è¶…è¿‡ä¸€æ®µæ—¶é—´æ²¡æœ‰æ”¶åˆ°ä»»ä½•è¯·æ±‚æ—¶ï¼Œä¼šç›´æ¥ä¸­æ–­äº‹åŠ¡ã€‚</p>
</li>
<li><p><strong>DoCommité˜¶æ®µï¼š</strong></p>
<p>è¯¥é˜¶æ®µè¿›è¡ŒçœŸæ­£çš„äº‹åŠ¡æäº¤ã€‚</p>
<p>åè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰æ‰§è¡Œè€…å‘é€çš„æˆåŠŸå“åº”ï¼Œé‚£ä¹ˆä»–å°†ä»PreCommitçŠ¶æ€è¿›å…¥åˆ°DoCommitçŠ¶æ€ï¼Œå¹¶å‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€doCommitè¯·æ±‚ï¼Œæ‰§è¡Œè€…æ¥æ”¶åˆ°doCommitè¯·æ±‚ä¹‹åï¼Œå¼€å§‹æ‰§è¡Œäº‹åŠ¡æäº¤ï¼Œå¹¶åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åé‡Šæ”¾æ‰€æœ‰äº‹åŠ¡èµ„æºï¼Œå¹¶æœ€åå‘åè°ƒè€…å‘é€ç¡®è®¤å“åº”ï¼Œåè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰æ‰§è¡Œè€…çš„ç¡®è®¤å“åº”ä¹‹åï¼Œå®Œæˆäº‹åŠ¡ï¼ˆå¦‚æœå› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´æ‰§è¡Œè€…æ²¡æœ‰æ”¶åˆ°doCommitè¯·æ±‚ï¼Œæ‰§è¡Œè€…ä¼šåœ¨è¶…æ—¶ä¹‹åç›´æ¥æäº¤äº‹åŠ¡ï¼Œè™½ç„¶æ‰§è¡Œè€…åªæ˜¯çŒœæµ‹åè°ƒè€…è¿”å›çš„æ˜¯doCommitè¯·æ±‚ï¼Œä½†æ˜¯å› ä¸ºå‰é¢çš„ä¸¤ä¸ªæµç¨‹éƒ½æ­£å¸¸æ‰§è¡Œï¼Œæ‰€ä»¥èƒ½å¤Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šè®¤ä¸ºæœ¬æ¬¡äº‹åŠ¡æ˜¯æˆåŠŸçš„ï¼Œå› æ­¤ä¼šç›´æ¥æäº¤ï¼‰</p>
<p>åè°ƒè€…æ²¡æœ‰æ¥æ”¶è‡³å°‘ä¸€ä¸ªæ‰§è¡Œè€…å‘é€çš„æˆåŠŸå“åº”ï¼ˆä¹Ÿå¯èƒ½æ˜¯å“åº”è¶…æ—¶ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸­æ–­äº‹åŠ¡ï¼Œåè°ƒè€…ä¼šå‘æ‰€æœ‰æ‰§è¡Œè€…å‘é€abortè¯·æ±‚ï¼Œæ‰§è¡Œè€…æ¥æ”¶åˆ°abortè¯·æ±‚ä¹‹åï¼Œåˆ©ç”¨å…¶åœ¨PreCommité˜¶æ®µè®°å½•çš„undoä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡çš„å›æ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›æ»šä¹‹åé‡Šæ”¾æ‰€æœ‰çš„äº‹åŠ¡èµ„æºï¼Œæ‰§è¡Œè€…å®Œæˆäº‹åŠ¡å›æ»šä¹‹åï¼Œå‘åè°ƒè€…å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œ åè°ƒè€…æ¥æ”¶åˆ°å‚ä¸è€…åé¦ˆçš„ç¡®è®¤æ¶ˆæ¯ä¹‹åï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚</p>
</li>
</ul>
<p>ç›¸æ¯”ä¸¤é˜¶æ®µæäº¤ï¼Œä¸‰é˜¶æ®µæäº¤çš„ä¼˜åŠ¿æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰ç¼ºç‚¹ï¼š</p>
<ul>
<li>3PCåœ¨2PCçš„ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µä¸­æ’å…¥ä¸€ä¸ªå‡†å¤‡é˜¶æ®µï¼Œä¿è¯äº†åœ¨æœ€åæäº¤é˜¶æ®µä¹‹å‰å„å‚ä¸èŠ‚ç‚¹çš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚</li>
<li>ä¸€æ—¦å‚ä¸è€…æ— æ³•åŠæ—¶æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„ä¿¡æ¯ä¹‹åï¼Œä¼šé»˜è®¤æ‰§è¡ŒCommitï¼Œè¿™æ ·å°±ä¸ä¼šå› ä¸ºåè°ƒè€…å•æ–¹é¢çš„æ•…éšœå¯¼è‡´å…¨å±€å‡ºç°é—®é¢˜ã€‚</li>
<li>ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œå®é™…ä¸Šè¶…æ—¶ä¹‹åçš„Commitå†³ç­–æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªèµŒæ³¨ç½¢äº†ï¼Œå¦‚æœæ­¤æ—¶åè°ƒè€…å‘é€çš„æ˜¯abortè¯·æ±‚ä½†æ˜¯è¶…æ—¶æœªæ¥æ”¶ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥å¯¼è‡´æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</li>
</ul>
</li>
<li><p><strong>TCCï¼ˆè¡¥å¿äº‹åŠ¡ï¼‰</strong></p>
<p>è¡¥å¿äº‹åŠ¡TCCå°±æ˜¯Tryã€Confirmã€Cancelï¼Œå®ƒå¯¹ä¸šåŠ¡æœ‰ä¾µå…¥æ€§ï¼Œä¸€å…±åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¾æ¬¡æ¥è§£è¯»ä¸€ä¸‹ã€‚</p>
<ul>
<li><p><strong>Tryé˜¶æ®µï¼š</strong></p>
<p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦åœ¨å€Ÿä¹¦æ—¶ï¼Œå°†ä¹¦ç±çš„åº“å­˜<code>-1</code>ï¼Œå¹¶ä¸”ç”¨æˆ·çš„å€Ÿé˜…é‡ä¹Ÿ<code>-1</code>ï¼Œä½†æ˜¯è¿™ä¸ªæ“ä½œï¼Œé™¤äº†ç›´æ¥å¯¹åº“å­˜å’Œå€Ÿé˜…é‡è¿›è¡Œä¿®æ”¹ä¹‹å¤–ï¼Œè¿˜éœ€è¦å°†å‡å»çš„å€¼ï¼Œå•ç‹¬å­˜æ”¾åˆ°å†»ç»“è¡¨ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶ä¸ä¼šåˆ›å»ºå€Ÿé˜…ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´åªæ˜¯é¢„å…ˆæŠŠå…³é”®çš„ä¸œè¥¿ç»™å¤„ç†äº†ï¼Œé¢„ç•™ä¸šåŠ¡èµ„æºå‡ºæ¥ã€‚</p>
</li>
<li><p><strong>Confirmé˜¶æ®µï¼š</strong></p>
<p>å¦‚æœTryæ‰§è¡ŒæˆåŠŸæ— è¯¯ï¼Œé‚£ä¹ˆå°±è¿›å…¥åˆ°Confirmé˜¶æ®µï¼Œæ¥ç€ä¹‹å‰ï¼Œæˆ‘ä»¬å°±è¯¥åˆ›å»ºå€Ÿé˜…ä¿¡æ¯äº†ï¼Œåªèƒ½ä½¿ç”¨Tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼Œå¦‚æœåˆ›å»ºæˆåŠŸï¼Œé‚£ä¹ˆå°±å¯¹Tryé˜¶æ®µå†»ç»“çš„å€¼ï¼Œè¿›è¡Œè§£å†»ï¼Œæ•´ä¸ªæµç¨‹å°±å®Œæˆäº†ã€‚å½“ç„¶ï¼Œå¦‚æœå¤±è´¥äº†ï¼Œé‚£ä¹ˆè¿›å…¥åˆ°Cancelé˜¶æ®µã€‚</p>
</li>
<li><p><strong>Cancelé˜¶æ®µï¼š</strong></p>
<p>ä¸ç”¨çŒœäº†ï¼Œé‚£è‚¯å®šæ˜¯æŠŠå†»ç»“çš„ä¸œè¥¿è¿˜ç»™äººå®¶ï¼Œå› ä¸ºæ•´ä¸ªå€Ÿé˜…æ“ä½œå‹æ ¹å°±æ²¡æˆåŠŸã€‚å°±åƒä½ ä»˜äº†æ¬¾ä¹°äº†ä¸œè¥¿ä½†æ˜¯ç½‘ç»œé—®é¢˜ï¼Œå¯¼è‡´äº¤æ˜“å¤±è´¥ï¼Œé’±ä¸å¯èƒ½ä¸è¿˜ç»™ä½ å§ã€‚</p>
</li>
</ul>
<p>è·ŸXAåè®®ç›¸æ¯”ï¼ŒTCCå°±æ²¡æœ‰åè°ƒè€…è¿™ä¸€è§’è‰²çš„å‚ä¸äº†ï¼Œè€Œæ˜¯è‡ªä¸»é€šè¿‡ä¸Šä¸€é˜¶æ®µçš„æ‰§è¡Œæƒ…å†µæ¥ç¡®ä¿æ­£å¸¸ï¼Œå……åˆ†åˆ©ç”¨äº†é›†ç¾¤çš„ä¼˜åŠ¿ï¼Œæ€§èƒ½ä¹Ÿæ˜¯æœ‰å¾ˆå¤§çš„æå‡ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå®ƒä¸ä¸šåŠ¡å…·æœ‰ä¸€å®šçš„å…³è”æ€§ï¼Œéœ€è¦å¼€å‘è€…å»ç¼–å†™æ›´å¤šçš„è¡¥å¿ä»£ç ï¼ŒåŒæ—¶å¹¶ä¸ä¸€å®šæ‰€æœ‰çš„ä¸šåŠ¡æµç¨‹éƒ½é€‚ç”¨äºè¿™ç§å½¢å¼ã€‚</p>
</li>
</ol>
<h3 id="Seataæœºåˆ¶ç®€ä»‹"><a href="#Seataæœºåˆ¶ç®€ä»‹" class="headerlink" title="Seataæœºåˆ¶ç®€ä»‹"></a>Seataæœºåˆ¶ç®€ä»‹</h3><p>å‰é¢æˆ‘ä»¬äº†è§£äº†ä¸€äº›åˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Seataæ˜¯å¦‚ä½•è¿›è¡Œåˆ†å¸ƒå¼äº‹åŠ¡çš„å¤„ç†çš„ã€‚</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0u80yrhjkj21tq0ok77i.jpg" alt="image-20220401144916943"></p>
<p>å®˜ç½‘ç»™å‡ºçš„æ˜¯è¿™æ ·çš„ä¸€ä¸ªæ¶æ„å›¾ï¼Œé‚£ä¹ˆå›¾ä¸­çš„RMã€TMã€TCä»£è¡¨ç€ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p>
<ul>
<li>RMï¼ˆResource Managerï¼‰ï¼šç”¨äºç›´æ¥æ‰§è¡Œæœ¬åœ°äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚</li>
<li>TMï¼ˆTransaction Managerï¼‰ï¼šTMæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡çš„æ ¸å¿ƒç®¡ç†è€…ã€‚æ¯”å¦‚ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨å€Ÿé˜…æœåŠ¡ä¸­å¼€å¯å…¨å±€äº‹åŠ¡ï¼Œæ¥è®©å…¶è‡ªèº«ã€å›¾ä¹¦æœåŠ¡ã€ç”¨æˆ·æœåŠ¡éƒ½å‚ä¸è¿›æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€èˆ¬å…¨å±€äº‹åŠ¡å‘èµ·è€…å°±æ˜¯TMã€‚</li>
<li>TCï¼ˆTransaction Managerï¼‰è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„SeataæœåŠ¡å™¨ï¼Œç”¨äºå…¨å±€æ§åˆ¶ï¼Œæ¯”å¦‚åœ¨XAæ¨¡å¼ä¸‹å°±æ˜¯ä¸€ä¸ªåè°ƒè€…çš„è§’è‰²ï¼Œè€Œä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„å¯åŠ¨å°±æ˜¯ç”±TMå‘TCå‘èµ·è¯·æ±‚ï¼ŒTCå†æ¥ä¸å…¶ä»–çš„RMè¿›è¡Œåè°ƒæ“ä½œã€‚</li>
</ul>
<blockquote>
<p>TMè¯·æ±‚TCå¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼ŒTCä¼šç”Ÿæˆä¸€ä¸ªXIDä½œä¸ºè¯¥å…¨å±€äº‹åŠ¡çš„ç¼–å·ï¼ŒXIDä¼šåœ¨å¾®æœåŠ¡çš„è°ƒç”¨é“¾è·¯ä¸­ä¼ æ’­ï¼Œä¿è¯å°†å¤šä¸ªå¾®æœåŠ¡çš„å­äº‹åŠ¡å…³è”åœ¨ä¸€èµ·ï¼›RMè¯·æ±‚TCå°†æœ¬åœ°äº‹åŠ¡æ³¨å†Œä¸ºå…¨å±€äº‹åŠ¡çš„åˆ†æ”¯äº‹åŠ¡ï¼Œé€šè¿‡å…¨å±€äº‹åŠ¡çš„XIDè¿›è¡Œå…³è”ï¼›TMè¯·æ±‚TCå‘Šè¯‰XIDå¯¹åº”çš„å…¨å±€äº‹åŠ¡æ˜¯è¿›è¡Œæäº¤è¿˜æ˜¯å›æ»šï¼›TCé©±åŠ¨RMå°†XIDå¯¹åº”çš„è‡ªå·±çš„æœ¬åœ°äº‹åŠ¡è¿›è¡Œæäº¤è¿˜æ˜¯å›æ»šï¼›</p>
</blockquote>
<p>Seataæ”¯æŒ4ç§äº‹åŠ¡æ¨¡å¼ï¼Œå®˜ç½‘æ–‡æ¡£ï¼š<a href="https://seata.io/zh-cn/docs/overview/what-is-seata.html">https://seata.io/zh-cn/docs/overview/what-is-seata.html</a></p>
<ul>
<li><p>ATï¼šæœ¬è´¨ä¸Šå°±æ˜¯2PCçš„å‡çº§ç‰ˆï¼Œåœ¨ AT æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·åªéœ€å…³å¿ƒè‡ªå·±çš„ â€œä¸šåŠ¡SQLâ€</p>
<ol>
<li>ä¸€é˜¶æ®µï¼ŒSeata ä¼šæ‹¦æˆªâ€œä¸šåŠ¡ SQLâ€ï¼Œé¦–å…ˆè§£æ SQL è¯­ä¹‰ï¼Œæ‰¾åˆ°â€œä¸šåŠ¡ SQLâ€è¦æ›´æ–°çš„ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®è¢«æ›´æ–°å‰ï¼Œå°†å…¶ä¿å­˜æˆâ€œbefore imageâ€ï¼Œç„¶åæ‰§è¡Œâ€œä¸šåŠ¡ SQLâ€æ›´æ–°ä¸šåŠ¡æ•°æ®ï¼Œåœ¨ä¸šåŠ¡æ•°æ®æ›´æ–°ä¹‹åï¼Œå†å°†å…¶ä¿å­˜æˆâ€œafter imageâ€ï¼Œæœ€åç”Ÿæˆè¡Œé”ã€‚ä»¥ä¸Šæ“ä½œå…¨éƒ¨åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å†…å®Œæˆï¼Œè¿™æ ·ä¿è¯äº†ä¸€é˜¶æ®µæ“ä½œçš„åŸå­æ€§ã€‚</li>
<li>äºŒé˜¶æ®µå¦‚æœç¡®è®¤æäº¤çš„è¯ï¼Œå› ä¸ºâ€œä¸šåŠ¡ SQLâ€åœ¨ä¸€é˜¶æ®µå·²ç»æäº¤è‡³æ•°æ®åº“ï¼Œ æ‰€ä»¥ Seata æ¡†æ¶åªéœ€å°†ä¸€é˜¶æ®µä¿å­˜çš„å¿«ç…§æ•°æ®å’Œè¡Œé”åˆ æ‰ï¼Œå®Œæˆæ•°æ®æ¸…ç†å³å¯ï¼Œå½“ç„¶å¦‚æœéœ€è¦å›æ»šï¼Œé‚£ä¹ˆå°±ç”¨â€œbefore imageâ€è¿˜åŸä¸šåŠ¡æ•°æ®ï¼›ä½†åœ¨è¿˜åŸå‰è¦é¦–å…ˆè¦æ ¡éªŒè„å†™ï¼Œå¯¹æ¯”â€œæ•°æ®åº“å½“å‰ä¸šåŠ¡æ•°æ®â€å’Œ â€œafter imageâ€ï¼Œå¦‚æœä¸¤ä»½æ•°æ®å®Œå…¨ä¸€è‡´å°±è¯´æ˜æ²¡æœ‰è„å†™ï¼Œå¯ä»¥è¿˜åŸä¸šåŠ¡æ•°æ®ï¼Œå¦‚æœä¸ä¸€è‡´å°±è¯´æ˜æœ‰è„å†™ï¼Œå‡ºç°è„å†™å°±éœ€è¦è½¬äººå·¥å¤„ç†ã€‚</li>
</ol>
</li>
<li><p>TCCï¼šå’Œæˆ‘ä»¬ä¸Šé¢è®²è§£çš„æ€è·¯æ˜¯ä¸€æ ·çš„ã€‚</p>
</li>
<li><p>XAï¼šåŒä¸Šï¼Œä½†æ˜¯è¦æ±‚æ•°æ®åº“æœ¬èº«æ”¯æŒè¿™ç§æ¨¡å¼æ‰å¯ä»¥ã€‚</p>
</li>
<li><p>Sagaï¼šç”¨äºå¤„ç†é•¿äº‹åŠ¡ï¼Œæ¯ä¸ªæ‰§è¡Œè€…éœ€è¦å®ç°äº‹åŠ¡çš„æ­£å‘æ“ä½œå’Œè¡¥å¿æ“ä½œï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0u8i381g0j22au0p0gnt.jpg" alt="image-20220401150544921"></p>
</li>
</ul>
<p>é‚£ä¹ˆï¼Œä»¥ATæ¨¡å¼ä¸ºä¾‹ï¼Œæˆ‘ä»¬çš„ç¨‹åºå¦‚ä½•æ‰èƒ½åšåˆ°ä¸å¯¹ä¸šåŠ¡è¿›è¡Œä¾µå…¥çš„æƒ…å†µä¸‹å®ç°åˆ†å¸ƒå¼äº‹åŠ¡å‘¢ï¼Ÿå®é™…ä¸Šï¼ŒSeataå®¢æˆ·ç«¯ï¼Œæ˜¯é€šè¿‡å¯¹æ•°æ®æºè¿›è¡Œä»£ç†å®ç°çš„ï¼Œä½¿ç”¨çš„æ˜¯DataSourceProxyç±»ï¼Œæ‰€ä»¥åœ¨ç¨‹åºè¿™è¾¹ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å¯¹åº”çš„ä»£ç†ç±»æ³¨å†Œä¸ºBeanå³å¯ï¼ˆ0.9ç‰ˆæœ¬ä¹‹åæ”¯æŒè‡ªåŠ¨è¿›è¡Œä»£ç†ï¼Œä¸ç”¨æˆ‘ä»¬æ‰‹åŠ¨æ“ä½œï¼‰</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»¥ATæ¨¡å¼ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚</p>
<h3 id="ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²"><a href="#ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²" class="headerlink" title="ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²"></a>ä½¿ç”¨fileæ¨¡å¼éƒ¨ç½²</h3><p>Seataä¹Ÿæ˜¯ä»¥æœåŠ¡ç«¯å½¢å¼è¿›è¡Œéƒ¨ç½²çš„ï¼Œç„¶åæ¯ä¸ªæœåŠ¡éƒ½æ˜¯å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/seata/seata/releases/download/v1.4.2/seata-server-1.4.2.zip">https://github.com/seata/seata/releases/download/v1.4.2/seata-server-1.4.2.zip</a></p>
<p>æŠŠæºç ä¹Ÿä¸‹è½½ä¸€ä¸‹ï¼š<a href="https://github.com/seata/seata/archive/refs/heads/develop.zip">https://github.com/seata/seata/archive/refs/heads/develop.zip</a></p>
<p>ä¸‹è½½å®Œæˆä¹‹åï¼Œæ”¾å…¥åˆ°IDEAé¡¹ç›®ç›®å½•ä¸­ï¼Œæ·»åŠ å¯åŠ¨é…ç½®ï¼Œè¿™é‡Œç«¯å£ä½¿ç”¨8868ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t2uouvdmj227k0fu429.jpg" alt="image-20220331150441431"></p>
<p>SeataæœåŠ¡ç«¯æ”¯æŒæœ¬åœ°éƒ¨ç½²æˆ–æ˜¯åŸºäºæ³¨å†Œå‘ç°ä¸­å¿ƒéƒ¨ç½²ï¼ˆæ¯”å¦‚Nacosã€Eurekaç­‰ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬é¦–å…ˆæ¼”ç¤ºä¸€ä¸‹æœ€ç®€å•çš„æœ¬åœ°éƒ¨ç½²ï¼Œä¸éœ€è¦å¯¹Seataçš„é…ç½®æ–‡ä»¶åšä»»ä½•ä¿®æ”¹ã€‚</p>
<p>Seataå­˜åœ¨ç€äº‹åŠ¡åˆ†ç»„æœºåˆ¶ï¼š</p>
<ul>
<li>äº‹åŠ¡åˆ†ç»„ï¼šseataçš„èµ„æºé€»è¾‘ï¼Œå¯ä»¥æŒ‰å¾®æœåŠ¡çš„éœ€è¦ï¼Œåœ¨åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰å¯¹è‡ªè¡Œå®šä¹‰äº‹åŠ¡åˆ†ç»„ï¼Œæ¯ç»„å–ä¸€ä¸ªåå­—ã€‚</li>
<li>é›†ç¾¤ï¼šseata-serveræœåŠ¡ç«¯ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤clusterã€‚ åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ä½¿ç”¨æ—¶éœ€è¦æŒ‡å®šäº‹åŠ¡é€»è¾‘åˆ†ç»„ä¸SeataæœåŠ¡ç«¯é›†ç¾¤ï¼ˆé»˜è®¤ä¸ºdefaultï¼‰çš„æ˜ å°„å…³ç³»ã€‚</li>
</ul>
<p>ä¸ºå•¥è¦è®¾è®¡æˆé€šè¿‡äº‹åŠ¡åˆ†ç»„å†ç›´æ¥æ˜ å°„åˆ°é›†ç¾¤ï¼Ÿå¹²å˜›ä¸ç›´æ¥æŒ‡å®šé›†ç¾¤å‘¢ï¼Ÿè·å–äº‹åŠ¡åˆ†ç»„åˆ°æ˜ å°„é›†ç¾¤çš„é…ç½®ã€‚è¿™æ ·è®¾è®¡åï¼Œäº‹åŠ¡åˆ†ç»„å¯ä»¥ä½œä¸ºèµ„æºçš„é€»è¾‘éš”ç¦»å•ä½ï¼Œå‡ºç°æŸé›†ç¾¤æ•…éšœæ—¶å¯ä»¥å¿«é€Ÿfailoverï¼Œåªåˆ‡æ¢å¯¹åº”åˆ†ç»„ï¼Œå¯ä»¥æŠŠæ•…éšœç¼©å‡åˆ°æœåŠ¡çº§åˆ«ï¼Œä½†å‰æä¹Ÿæ˜¯ä½ æœ‰è¶³å¤Ÿserveré›†ç¾¤ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„å„ä¸ªæœåŠ¡ä½œä¸ºSeateçš„å®¢æˆ·ç«¯ï¼Œåªéœ€è¦å¯¼å…¥ä¾èµ–å³å¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-seata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åæ·»åŠ é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">vgroup-mapping:</span></span><br><span class="line">    	<span class="comment"># è¿™é‡Œéœ€è¦å¯¹äº‹åŠ¡ç»„åšæ˜ å°„ï¼Œé»˜è®¤çš„åˆ†ç»„åä¸º åº”ç”¨åç§°-seata-service-groupï¼Œå°†å…¶æ˜ å°„åˆ°defaulté›†ç¾¤</span></span><br><span class="line">    	<span class="comment"># è¿™ä¸ªå¾ˆå…³é”®ï¼Œä¸€å®šè¦é…ç½®å¯¹ï¼Œä¸ç„¶ä¼šæ‰¾ä¸åˆ°æœåŠ¡</span></span><br><span class="line">      <span class="attr">bookservice-seata-service-group:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">grouplist:</span></span><br><span class="line">      <span class="attr">default:</span> <span class="string">localhost:8868</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥ç›´æ¥å¯åŠ¨äº†ï¼Œä½†æ˜¯æ³¨æ„ç°åœ¨åªæ˜¯å•çº¯åœ°è¿æ¥ä¸Šï¼Œå¹¶æ²¡æœ‰å¼€å¯ä»»ä½•çš„åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥ç€æ¥é…ç½®å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œé¦–å…ˆåœ¨å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼Œæ­¤æ³¨è§£ä¼šæ·»åŠ ä¸€ä¸ªåç½®å¤„ç†å™¨å°†æ•°æ®æºå°è£…ä¸ºæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„ä»£ç†æ•°æ®æºï¼ˆè™½ç„¶å®˜æ–¹è¡¨ç¤ºé…ç½®æ–‡ä»¶ä¸­å·²ç»é»˜è®¤å¼€å¯äº†è‡ªåŠ¨ä»£ç†ï¼Œä½†æ˜¯UPä¸»å®æµ‹1.4.2ç‰ˆæœ¬ä¸‹åªèƒ½æ‰“æ³¨è§£çš„æ–¹å¼æ‰èƒ½ç”Ÿæ•ˆï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableAutoDataSourceProxy</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BookApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨å¼€å¯åˆ†å¸ƒå¼äº‹åŠ¡çš„æ–¹æ³•ä¸Šæ·»åŠ <code>@GlobalTransactional</code>æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GlobalTransactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doBorrow</span><span class="params">(<span class="type">int</span> uid, <span class="type">int</span> bid)</span> &#123;</span><br><span class="line">  	<span class="comment">//è¿™é‡Œæ‰“å°ä¸€ä¸‹XIDçœ‹çœ‹ï¼Œå…¶ä»–çš„æœåŠ¡ä¸šæ·»åŠ è¿™æ ·ä¸€ä¸ªæ‰“å°ï¼Œå¦‚æœä¸€ä¼šéƒ½æ‰“å°çš„æ˜¯åŒä¸€ä¸ªXIDï¼Œè¡¨ç¤ºä½¿ç”¨çš„å°±æ˜¯åŒä¸€ä¸ªäº‹åŠ¡</span></span><br><span class="line">    System.out.println(RootContext.getXID());</span><br><span class="line">    <span class="keyword">if</span>(bookClient.bookRemain(bid) &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å›¾ä¹¦æ•°é‡ä¸è¶³&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(userClient.userRemain(uid) &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·å€Ÿé˜…é‡ä¸è¶³&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!bookClient.bookBorrow(bid))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åœ¨å€Ÿé˜…å›¾ä¹¦æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(mapper.getBorrow(uid, bid) != <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ­¤ä¹¦ç±å·²ç»è¢«æ­¤ç”¨æˆ·å€Ÿé˜…äº†ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(mapper.addBorrow(uid, bid) &lt;= <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åœ¨å½•å…¥å€Ÿé˜…ä¿¡æ¯æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!userClient.userBorrow(uid))</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;åœ¨å€Ÿé˜…æ—¶å‡ºç°é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜æ²¡ç»“æŸï¼Œæˆ‘ä»¬å‰é¢è¯´äº†ï¼ŒSeataä¼šåˆ†æä¿®æ”¹æ•°æ®çš„sqlï¼ŒåŒæ—¶ç”Ÿæˆå¯¹åº”çš„åå‘å›æ»šSQLï¼Œè¿™ä¸ªå›æ»šè®°å½•ä¼šå­˜æ”¾åœ¨undo_log è¡¨ä¸­ã€‚æ‰€ä»¥è¦æ±‚æ¯ä¸€ä¸ªClient éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„undo_logè¡¨ï¼ˆä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªæœåŠ¡è¿æ¥çš„æ•°æ®åº“éƒ½éœ€è¦åˆ›å»ºè¿™æ ·ä¸€ä¸ªè¡¨ï¼Œè¿™é‡Œç”±äºæˆ‘ä»¬ä¸‰ä¸ªæœåŠ¡éƒ½ç”¨çš„åŒä¸€ä¸ªæ•°æ®åº“ï¼Œæ‰€ä»¥è¯´å°±åªç”¨åœ¨è¿™ä¸ªæ•°æ®åº“ä¸­åˆ›å»ºundo_logè¡¨å³å¯ï¼‰ï¼Œè¡¨SQLå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `undo_log`</span><br><span class="line">(</span><br><span class="line">  `id`            <span class="type">BIGINT</span>(<span class="number">20</span>)   <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `branch_id`     <span class="type">BIGINT</span>(<span class="number">20</span>)   <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `xid`           <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `context`       <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rollback_info` LONGBLOB     <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_status`    <span class="type">INT</span>(<span class="number">11</span>)      <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_created`   DATETIME     <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `log_modified`  DATETIME     <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `ext`           <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`, `branch_id`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç°åœ¨å°±å¯ä»¥å¯åŠ¨ä¸‰ä¸ªæœåŠ¡äº†ï¼Œæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹å½“å‡ºç°å¼‚å¸¸çš„æ—¶å€™æ˜¯ä¸æ˜¯ä¼šæ­£å¸¸å›æ»šï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t3rj1lyqj21kq06gwfc.jpg" alt="image-20220331153615187"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t3tr1a3ej214i05idgj.jpg" alt="image-20220331153823961"></p>
<p>é¦–å…ˆç¬¬ä¸€æ¬¡è‚¯å®šæ˜¯æ­£å¸¸å®Œæˆå€Ÿé˜…æ“ä½œçš„ï¼Œæ¥ç€æˆ‘ä»¬å†æ¬¡è¿›è¡Œè¯·æ±‚ï¼Œè‚¯å®šä¼šå‡ºç°å¼‚å¸¸ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t3s88j4oj21rm0cwmze.jpg" alt="image-20220331153655710"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t3stb2oaj221g0a6jwj.jpg" alt="image-20220331153729453"></p>
<p>å¦‚æœèƒ½åœ¨æ ˆè¿½è¸ªä¿¡æ¯ä¸­çœ‹åˆ°seataç›¸å…³çš„åŒ…ï¼Œé‚£ä¹ˆè¯´æ˜åˆ†å¸ƒå¼äº‹åŠ¡å·²ç»å¼€å§‹å·¥ä½œäº†ï¼Œé€šè¿‡æ—¥å¿—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‡ºç°äº†å›æ»šæ“ä½œï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t3ul16g8j222403c40z.jpg" alt="image-20220331153911759"></p>
<p>å¹¶ä¸”æ•°æ®åº“ä¸­ç¡®å®æ˜¯å›æ»šäº†æ‰£é™¤æ“ä½œï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t3u8rckaj214i05idgj.jpg" alt="image-20220331153852374"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±é€šè¿‡Seataç®€å•åœ°å®ç°äº†åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p>
<h3 id="ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²"><a href="#ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²" class="headerlink" title="ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²"></a>ä½¿ç”¨nacosæ¨¡å¼éƒ¨ç½²</h3><p>å‰é¢æˆ‘ä»¬å®ç°äº†æœ¬åœ°SeataæœåŠ¡çš„fileæ¨¡å¼éƒ¨ç½²ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•è®©å…¶é…åˆNacosè¿›è¡Œéƒ¨ç½²ï¼Œåˆ©ç”¨Nacosçš„é…ç½®ç®¡ç†å’ŒæœåŠ¡å‘ç°æœºåˆ¶ï¼ŒSeataèƒ½å¤Ÿæ›´å¥½åœ°å·¥ä½œã€‚</p>
<p>æˆ‘ä»¬å…ˆå•ç‹¬ä¸ºSeataé…ç½®ä¸€ä¸ªå‘½åç©ºé—´ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t4ejq5rlj22cu0ca3zx.jpg" alt="image-20220331155823306"></p>
<p>æˆ‘ä»¬æ‰“å¼€<code>conf</code>ç›®å½•ä¸­çš„<code>registry.conf</code>é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">registry</span> <span class="string">&#123;</span></span><br><span class="line"><span class="comment">	# æ³¨å†Œé…ç½®</span></span><br><span class="line"><span class="comment">	# å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯ä»¥é€‰æ‹©ç±»å‹ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯æ™®é€šçš„fileç±»å‹ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°æ–‡ä»¶çš„å½¢å¼è¿›è¡Œæ³¨å†Œé…ç½®</span></span><br><span class="line"><span class="comment">	# æ”¯æŒçš„ç±»å‹å¦‚ä¸‹ï¼Œå¯¹åº”çš„ç±»å‹åœ¨ä¸‹é¢éƒ½æœ‰å¯¹åº”çš„é…ç½®</span></span><br><span class="line"><span class="comment">  # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa</span></span><br><span class="line">  <span class="attr">type</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	# é‡‡ç”¨nacosæ–¹å¼ä¼šå°†seataæœåŠ¡ç«¯ä¹Ÿæ³¨å†Œåˆ°nacosä¸­ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥åˆ©ç”¨æœåŠ¡å‘ç°è‡ªåŠ¨æ‰¾åˆ°seataæœåŠ¡</span></span><br><span class="line"><span class="comment">	# å°±ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šIPå’Œç«¯å£äº†ï¼Œä¸è¿‡çœ‹ä¼¼æ–¹ä¾¿ï¼Œå‘å€’æ˜¯ä¸å°‘ï¼Œåé¢å†è¯´</span></span><br><span class="line">  <span class="attr">nacos</span> <span class="string">&#123;</span></span><br><span class="line"><span class="comment">  	# åº”ç”¨åç§°ï¼Œè¿™é‡Œé»˜è®¤å°±è¡Œ</span></span><br><span class="line">    <span class="attr">application</span> = <span class="string">&quot;seata-server&quot;</span></span><br><span class="line"><span class="comment">    # NacosæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">    <span class="attr">serverAddr</span> = <span class="string">&quot;localhost:8848&quot;</span></span><br><span class="line"><span class="comment">    # è¿™é‡Œä½¿ç”¨çš„æ˜¯SEATA_GROUPç»„ï¼Œä¸€ä¼šæ³¨å†Œåˆ°Nacosä¸­å°±æ˜¯è¿™ä¸ªç»„</span></span><br><span class="line">    <span class="attr">group</span> = <span class="string">&quot;SEATA_GROUP&quot;</span></span><br><span class="line"><span class="comment">    # è¿™é‡Œå°±ä½¿ç”¨æˆ‘ä»¬ä¸Šé¢å•ç‹¬ä¸ºseataé…ç½®çš„å‘½åç©ºé—´ï¼Œæ³¨æ„å¡«çš„æ˜¯ID</span></span><br><span class="line">    <span class="attr">namespace</span> = <span class="string">&quot;89fc2145-4676-48b8-9edd-29e867879bcb&quot;</span></span><br><span class="line"><span class="comment">    # é›†ç¾¤åç§°ï¼Œè¿™é‡Œè¿˜æ˜¯ä½¿ç”¨default</span></span><br><span class="line">    <span class="attr">cluster</span> = <span class="string">&quot;default&quot;</span></span><br><span class="line"><span class="comment">    # Nacosçš„ç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line">    <span class="attr">username</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">    <span class="attr">password</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">  <span class="attr">&#125;</span></span><br><span class="line"><span class="comment">  	#...</span></span><br></pre></td></tr></table></figure>

<p>æ³¨å†Œä¿¡æ¯é…ç½®å®Œæˆä¹‹åï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦å°†é…ç½®æ–‡ä»¶ä¹Ÿæ”¾åˆ°Nacosä¸­ï¼Œè®©Nacosç®¡ç†é…ç½®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¹é…ç½®è¿›è¡Œçƒ­æ›´æ–°äº†ï¼Œä¸€æ—¦ç¯å¢ƒéœ€è¦å˜åŒ–ï¼Œåªéœ€è¦ç›´æ¥åœ¨Nacosä¸­ä¿®æ”¹å³å¯ã€‚</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">config</span> <span class="string">&#123;</span></span><br><span class="line"><span class="comment">	# è¿™é‡Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨nacos</span></span><br><span class="line"><span class="comment">  # fileã€nacos ã€apolloã€zkã€consulã€etcd3</span></span><br><span class="line">  <span class="attr">type</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nacos</span> <span class="string">&#123;</span></span><br><span class="line"><span class="comment">  	# è·Ÿä¸Šé¢ä¸€æ ·çš„é…æ³•</span></span><br><span class="line">    <span class="attr">serverAddr</span> = <span class="string">&quot;127.0.0.1:8848&quot;</span></span><br><span class="line">    <span class="attr">namespace</span> = <span class="string">&quot;89fc2145-4676-48b8-9edd-29e867879bcb&quot;</span></span><br><span class="line">    <span class="attr">group</span> = <span class="string">&quot;SEATA_GROUP&quot;</span></span><br><span class="line">    <span class="attr">username</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line">    <span class="attr">password</span> = <span class="string">&quot;nacos&quot;</span></span><br><span class="line"><span class="comment">    # è¿™ä¸ªä¸ç”¨æ”¹ï¼Œé»˜è®¤å°±è¡Œ</span></span><br><span class="line">    <span class="attr">dataId</span> = <span class="string">&quot;seataServer.properties&quot;</span></span><br><span class="line">  <span class="attr">&#125;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦å°†é…ç½®å¯¼å…¥åˆ°Nacosä¸­ï¼Œæˆ‘ä»¬æ‰“å¼€ä¸€å¼€å§‹ä¸‹è½½çš„æºç <code>script/config-center/nacos</code>ç›®å½•ï¼Œè¿™æ˜¯å®˜æ–¹æä¾›çš„ä¸Šä¼ è„šæœ¬ï¼Œæˆ‘ä»¬ç›´æ¥è¿è¡Œå³å¯ï¼ˆwindowsä¸‹æ²¡å¯¹åº”çš„batå°±å¾ˆè›‹ç–¼ï¼Œå¯ä»¥ä½¿ç”¨gitå‘½ä»¤è¡Œæ¥è¿è¡Œä¸€ä¸‹ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå¯äº¤äº’çš„ç‰ˆæœ¬ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t4ocvxg8j218k0fi0uu.jpg" alt="image-20220331160748379"></p>
<p>æŒ‰ç…§æç¤ºè¾“å…¥å°±å¯ä»¥äº†ï¼Œä¸è¾“å…¥å°±ä½¿ç”¨çš„é»˜è®¤å€¼ï¼Œä¸çŸ¥é“ä¸ºå•¥æœ€æ–°ç‰ˆæœ¬æœ‰å››ä¸ªå› ä¸ºå‚æ•°è¿‡é•¿è¿˜å¯¼å…¥å¤±è´¥äº†ï¼Œå°±ç¦»è°±ï¼Œä¸è¿‡ä¸å½±å“ã€‚</p>
<p>å¯¼å…¥æˆåŠŸä¹‹åï¼Œå¯ä»¥åœ¨å¯¹åº”çš„å‘½åç©ºé—´ä¸‹çœ‹åˆ°å¯¹åº”çš„é…ç½®ï¼ˆä¸ºå•¥éè¦ä¸€ä¸ªä¸€ä¸ªé…ç½®é¡¹å•ç‹¬æï¼Œå°±ä¸èƒ½å†™ä¸€èµ·å—ï¼‰ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t4px1ddhj21ue0u0jwp.jpg" alt="image-20220331160918380"></p>
<p>æ³¨æ„ï¼Œè¿˜æ²¡å®Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å¯¹åº”çš„äº‹åŠ¡ç»„æ˜ å°„é…ç½®ä¹Ÿæ·»åŠ ä¸Šï¼ŒDataIdæ ¼å¼ä¸º<code>service.vgroupMapping.äº‹åŠ¡ç»„åç§°</code>ï¼Œæ¯”å¦‚æˆ‘ä»¬å°±ä½¿ç”¨é»˜è®¤çš„åç§°ï¼Œå€¼å…¨éƒ¨ä¾ç„¶ä½¿ç”¨defaultå³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t4s0ehpxj22cc0detbd.jpg" alt="image-20220331161119169"></p>
<p>ç°åœ¨æˆ‘ä»¬å°±å®Œæˆäº†æœåŠ¡ç«¯çš„Nacosé…ç½®ï¼Œæ¥ç€æˆ‘ä»¬éœ€è¦å¯¹å®¢æˆ·ç«¯ä¹Ÿè¿›è¡ŒNacosé…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">seata:</span></span><br><span class="line">	<span class="comment"># æ³¨å†Œ</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">  	<span class="comment"># ä½¿ç”¨Nacos</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">    	<span class="comment"># ä½¿ç”¨Seataçš„å‘½åç©ºé—´ï¼Œè¿™æ ·æ‰èƒ½æ­£ç¡®æ‰¾åˆ°SeataæœåŠ¡ï¼Œç”±äºç»„ä½¿ç”¨çš„æ˜¯SEATA_GROUPï¼Œé…ç½®é»˜è®¤å€¼å°±æ˜¯ï¼Œå°±ä¸ç”¨é…äº†</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">89fc2145-4676-48b8-9edd-29e867879bcb</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">  <span class="comment"># é…ç½®</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">nacos</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">89fc2145-4676-48b8-9edd-29e867879bcb</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">nacos</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨è¿™ä¸‰ä¸ªæœåŠ¡äº†ï¼Œå¯ä»¥åœ¨Nacosä¸­çœ‹åˆ°Seataä»¥åŠä¸‰ä¸ªæœåŠ¡éƒ½æ­£å¸¸æ³¨å†Œäº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t53eig40j22cq0asac4.jpg" alt="image-20220331162215864"></p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t53udw2dj22cm05mt9k.jpg" alt="image-20220331162241748"></p>
<p>æ¥ç€æˆ‘ä»¬å°±å¯ä»¥è®¿é—®ä¸€ä¸‹æœåŠ¡è¯•è¯•çœ‹äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t57awz7nj21kg06qt9j.jpg" alt="image-20220331162601073"></p>
<p>å¯ä»¥çœ‹åˆ°æ•ˆæœå’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡ç°åœ¨æˆ‘ä»¬çš„æ³¨å†Œå’Œé…ç½®éƒ½ç»§æ‰¿åœ¨Nacosä¸­è¿›è¡Œäº†ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é…ç½®ä¸€ä¸‹äº‹åŠ¡ä¼šè¯ä¿¡æ¯çš„å­˜å‚¨æ–¹å¼ï¼Œé»˜è®¤æ˜¯fileç±»å‹ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¿è¡Œç›®å½•ä¸‹åˆ›å»º<code>file_store</code>ç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ¬åˆ°æ•°æ®åº“ä¸­å­˜å‚¨ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®å³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t5a2q6itj22ca0aywgc.jpg" alt="image-20220331162840368"></p>
<p>å°†<code>store.session.mode</code>å’Œ<code>store.mode</code>çš„å€¼ä¿®æ”¹ä¸º<code>db</code></p>
<p>æ¥ç€æˆ‘ä»¬å¯¹æ•°æ®åº“ä¿¡æ¯è¿›è¡Œä¸€ä¸‹é…ç½®ï¼š</p>
<ul>
<li>æ•°æ®åº“é©±åŠ¨</li>
<li>æ•°æ®åº“URL</li>
<li>æ•°æ®åº“ç”¨æˆ·åå¯†ç </li>
</ul>
<p>å…¶ä»–çš„é»˜è®¤å³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t5chy3tmj226y0u00yl.jpg" alt="image-20220331163100436"></p>
<p>æ¥ç€æˆ‘ä»¬éœ€è¦å°†å¯¹åº”çš„æ•°æ®åº“è¿›è¡Œåˆ›å»ºï¼Œåˆ›å»ºseataæ•°æ®åº“ï¼Œç„¶åç›´æ¥CVä»¥ä¸‹è¯­å¥ï¼š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- -------------------------------- The script used when storeMode is &#x27;db&#x27; --------------------------------</span></span><br><span class="line"><span class="comment">-- the table to store GlobalSession data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `global_table`</span><br><span class="line">(</span><br><span class="line">    `xid`                       <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `transaction_id`            <span class="type">BIGINT</span>,</span><br><span class="line">    `status`                    TINYINT      <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `application_id`            <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `transaction_service_group` <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `transaction_name`          <span class="type">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">    `timeout`                   <span class="type">INT</span>,</span><br><span class="line">    `begin_time`                <span class="type">BIGINT</span>,</span><br><span class="line">    `application_data`          <span class="type">VARCHAR</span>(<span class="number">2000</span>),</span><br><span class="line">    `gmt_create`                DATETIME,</span><br><span class="line">    `gmt_modified`              DATETIME,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`xid`),</span><br><span class="line">    KEY `idx_status_gmt_modified` (`status` , `gmt_modified`),</span><br><span class="line">    KEY `idx_transaction_id` (`transaction_id`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- the table to store BranchSession data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `branch_table`</span><br><span class="line">(</span><br><span class="line">    `branch_id`         <span class="type">BIGINT</span>       <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `xid`               <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `transaction_id`    <span class="type">BIGINT</span>,</span><br><span class="line">    `resource_group_id` <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `resource_id`       <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">    `branch_type`       <span class="type">VARCHAR</span>(<span class="number">8</span>),</span><br><span class="line">    `status`            TINYINT,</span><br><span class="line">    `client_id`         <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">    `application_data`  <span class="type">VARCHAR</span>(<span class="number">2000</span>),</span><br><span class="line">    `gmt_create`        DATETIME(<span class="number">6</span>),</span><br><span class="line">    `gmt_modified`      DATETIME(<span class="number">6</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`branch_id`),</span><br><span class="line">    KEY `idx_xid` (`xid`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- the table to store lock data</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `lock_table`</span><br><span class="line">(</span><br><span class="line">    `row_key`        <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `xid`            <span class="type">VARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">    `transaction_id` <span class="type">BIGINT</span>,</span><br><span class="line">    `branch_id`      <span class="type">BIGINT</span>       <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `resource_id`    <span class="type">VARCHAR</span>(<span class="number">256</span>),</span><br><span class="line">    `table_name`     <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">    `pk`             <span class="type">VARCHAR</span>(<span class="number">36</span>),</span><br><span class="line">    `status`         TINYINT      <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;0:locked ,1:rollbacking&#x27;</span>,</span><br><span class="line">    `gmt_create`     DATETIME,</span><br><span class="line">    `gmt_modified`   DATETIME,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`row_key`),</span><br><span class="line">    KEY `idx_status` (`status`),</span><br><span class="line">    KEY `idx_branch_id` (`branch_id`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `distributed_lock`</span><br><span class="line">(</span><br><span class="line">    `lock_key`       <span class="type">CHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `lock_value`     <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `expire`         <span class="type">BIGINT</span>,</span><br><span class="line">    <span class="keyword">primary</span> key (`lock_key`)</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB</span><br><span class="line">  <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `distributed_lock` (lock_key, lock_value, expire) <span class="keyword">VALUES</span> (<span class="string">&#x27;HandleAllSession&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t5k6ifdbj21ga07yjro.jpg" alt="image-20220331163823920"></p>
<p>å®Œæˆä¹‹åï¼Œé‡å¯SeataæœåŠ¡ç«¯å³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t5qvps8pj21vi04kgo7.jpg" alt="image-20220331164449635"></p>
<p>çœ‹åˆ°äº†æ•°æ®æºåˆå§‹åŒ–æˆåŠŸï¼Œç°åœ¨å·²ç»åœ¨ä½¿ç”¨æ•°æ®åº“è¿›è¡Œä¼šè¯å­˜å‚¨äº†ã€‚</p>
<p>å¦‚æœSeataæœåŠ¡ç«¯å‡ºç°æŠ¥é”™ï¼Œå¯èƒ½æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰äº‹åŠ¡ç»„çš„åç§°å¤ªé•¿äº†ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t5wm6n02j22ee0bkagp.jpg" alt="image-20220331165020756"></p>
<p>å°†<code>globle_table</code>è¡¨çš„å­—æ®µ<code>transaction_server_group</code>é•¿åº¦é€‚å½“å¢åŠ ä¸€ä¸‹å³å¯ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1h0t5xcvn5kj214s0f4760.jpg" alt="image-20220331165103414"></p>
<p>åˆ°æ­¤ï¼Œå…³äºåŸºäºnacosæ¨¡å¼ä¸‹çš„Seataéƒ¨ç½²ï¼Œå°±å®Œæˆäº†ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬è¿™é‡Œå®ç°äº†åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†æ˜¯è¿˜æ˜¯ç»™å„ä½åŒå­¦æå‡ºä¸€ä¸ªé—®é¢˜ï¼ˆå¯ä»¥æŠŠè‡ªå·±æ‰€è®¤ä¸ºçš„ç»“æœæ‰“åœ¨å¼¹å¹•ä¸Šï¼‰ï¼Œå°±æˆ‘ä»¬ç›®å‰è¿™æ ·çš„ç¨‹åºè®¾è®¡ï¼Œåœ¨é«˜å¹¶å‘ä¸‹ï¼ŒçœŸçš„å®‰å…¨å—ï¼Ÿæ¯”å¦‚åŒä¸€æ—¶é—´100ä¸ªåŒå­¦æŠ¢åŒä¸€ä¸ªä¹¦ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“åŒä¸€ä¸ªä¹¦å°±åªæœ‰3æœ¬ï¼Œå¦‚æœè¿™æ—¶çœŸçš„åŒæ—¶æ¥äº†100ä¸ªè¯·æ±‚è¦å€Ÿä¹¦ï¼Œä¼šæ­£å¸¸åœ°åªå€Ÿå‡º3æœ¬ä¹¦å—ï¼Ÿå¦‚æœä¸æ­£å¸¸ï¼Œè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</p>
]]></content>
      <categories>
        <category>åç«¯æ¡†æ¶</category>
      </categories>
      <tags>
        <tag>spring cloud</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸è§å¯„å­˜å™¨åŠæŒ‡ä»¤</title>
    <url>/2022/04/18/%E5%B8%B8%E8%A7%81%E6%B1%87%E7%BC%96%E5%AF%84%E5%AD%98%E5%99%A8/</url>
    <content><![CDATA[<h2 id="æ±‡ç¼–ä¸­å¸¸è§çš„å¯„å­˜å™¨"><a href="#æ±‡ç¼–ä¸­å¸¸è§çš„å¯„å­˜å™¨" class="headerlink" title="æ±‡ç¼–ä¸­å¸¸è§çš„å¯„å­˜å™¨"></a>æ±‡ç¼–ä¸­å¸¸è§çš„å¯„å­˜å™¨</h2><ul>
<li><p>%rax ä¸€èˆ¬ç”¨ä½œç´¯åŠ å™¨(Accumulator)</p>
</li>
<li><p>%rbx ä¸€èˆ¬ç”¨ä½œåŸºå€å¯„å­˜å™¨( Base )</p>
</li>
<li><p>%rxc ä¸€èˆ¬ç”¨æ¥è®¡æ•°( Count )</p>
</li>
<li><p>%rdx ä¸€èˆ¬ç”¨æ¥å­˜æ”¾æ•°æ®( Data )</p>
</li>
<li><p>%rsiä¸€èˆ¬ç”¨ä½œæºå˜å€( Source Index )</p>
</li>
<li><p>%rdi ä¸€èˆ¬ç”¨ä½œç›®æ ‡å˜å€( DestinatinIndex )</p>
</li>
<li><p>%rbp ä¸€èˆ¬ç”¨ä½œåŸºå€æŒ‡é’ˆ( Base Pointer )</p>
</li>
<li><p>%rsp ä¸€èˆ¬ç”¨ä½œå †æ ˆæŒ‡é’ˆ( Stack Pointer )</p>
<span id="more"></span></li>
<li><p> %rip æ˜¯æŒ‡ä»¤æŒ‡é’ˆï¼Œä¹Ÿç§°ä¸º PC</p>
</li>
<li><p>CFã€ZFã€SF å’Œ OF æ¡ä»¶ç </p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// ji&#x27;ben</span><br><span class="line">0x8(%rdx) = 0xf000 + 0x8 = 0xf008</span><br><span class="line">(%rdx, %rcx) = 0xf000 + 0x100 = 0xf100</span><br><span class="line">(%rdx, %rcx, 4) = 0xf000 + 4*0x100 = 0xf400</span><br><span class="line">0x80(, %rdx, 2) = 2*0xf000 + 0x80 = 0x1e080</span><br></pre></td></tr></table></figure>

<h2 id="æ±‡ç¼–å¸¸è§æŒ‡ä»¤"><a href="#æ±‡ç¼–å¸¸è§æŒ‡ä»¤" class="headerlink" title="æ±‡ç¼–å¸¸è§æŒ‡ä»¤"></a>æ±‡ç¼–å¸¸è§æŒ‡ä»¤</h2><ul>
<li>jmpæ— æ¡ä»¶è·³è½¬</li>
<li>jleæ¡ä»¶è½¬ç§»æŒ‡ä»¤ï¼šæ¯”å¦‚ <code>cmp a ,b</code> ï¼Œåé¢å†æ¥JLEï¼Œå¦‚æœa&lt;=bçš„è¯ï¼Œå°±è·³è½¬åˆ°åˆ«çš„å‘½ä»¤ä¸Š</li>
<li>leaåŠ è½½æœ‰æ•ˆåœ°å€ï¼ˆload effective addressï¼‰æŒ‡ä»¤å°±æ˜¯lea,ä»–çš„æŒ‡ä»¤å½¢å¼å°±æ˜¯ä»å†…å­˜è¯»å–æ•°æ®åˆ°å¯„å­˜å™¨</li>
</ul>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç³»ç»ŸåŸºç¡€</category>
      </categories>
      <tags>
        <tag>æ±‡ç¼–</tag>
      </tags>
  </entry>
  <entry>
    <title>å‘ç°ä¸€ä¸ªé—®é¢˜</title>
    <url>/2022/02/05/%E5%8F%91%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p><strong>æƒ³èµ·æ¥ç½‘ç«™å·²ç»å¾ˆä¹…æ²¡æ›´æ–°äº†ï¼Œæ­å»ºè¿™ä¸ªä¸ªäººåšå®¢çš„åˆè¡·æ˜¯æƒ³è¦è®°å½•ä¸€ä¸‹è‡ªå·±çš„ç¼–ç¨‹å­¦ä¹ å†ç¨‹ï¼Œæ²¡æƒ³åˆ°æœ€å›°æ‰°æˆ‘çš„é—®é¢˜ä¸æ˜¯ç½‘ç«™æ€ä¹ˆæ­å»ºè¿è¥è€Œæ˜¯è‡ªå·±å†™ä¸ªäººåšå®¢åŠå¤©å†™ä¸å‡ºä¸€ä¸ªå­—æ¥</strong></p>
<ul>
<li>æœ€è¿‘åœ¨å­¦ä¹ å‰ç«¯çš„ä¸€äº›çŸ¥è¯†ï¼ŒåƒHTML CSS jsï¼Œæ„Ÿè§‰è¿™ç±»å‰ç«¯çš„çŸ¥è¯†ç‚¹å¤šä¸”æ‚ä¹±ï¼Œå¾ˆéš¾å½¢æˆä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„çŸ¥è¯†ä½“ç³»ï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘å¯¹HTML CSSä¸jsçš„é…åˆä½¿ç”¨è¿˜ä¸å¤ªç†Ÿç»ƒ</li>
<li>å¯èƒ½å¯¹MarkDownè¯­æ³•ä¸å¤ªç†Ÿç»ƒçš„ä½¿ç”¨ä¹Ÿè®©æˆ‘ä¸å¤ªæ„¿æ„å»å‘åšå®¢</li>
<li>è¿‡å®Œå¹´ç«‹äº†ä¸ªflagï¼šä»Šå¹´äº‰å–çœ‹å®Œ<strong>ç®—æ³•ç¬¬å››ç‰ˆ</strong>å’Œ<strong>æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ</strong>ï¼Œè¿™ä¸¤æœ¬ä¹¦è¿˜æŒºè´µçš„ğŸ™ƒ</li>
</ul>
]]></content>
      <categories>
        <category>æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>ä¸€äº›é—²è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>UMLå„ç§å›¾</title>
    <url>/2022/06/12/%E5%90%84%E7%A7%8D%E5%9B%BE/</url>
    <content><![CDATA[<h2 id="ç”¨ä¾‹å›¾"><a href="#ç”¨ä¾‹å›¾" class="headerlink" title="ç”¨ä¾‹å›¾"></a>ç”¨ä¾‹å›¾</h2><img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E7%94%A8%E4%BE%8B%E5%9B%BE%E5%85%B3%E7%B3%BB.png" alt="image-20220612182503545" style="zoom: 80%;" />

<h3 id="æ³›åŒ–å…³ç³»ï¼š"><a href="#æ³›åŒ–å…³ç³»ï¼š" class="headerlink" title="æ³›åŒ–å…³ç³»ï¼š"></a>æ³›åŒ–å…³ç³»ï¼š</h3><img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E6%B3%9B%E5%8C%96%E5%85%B3%E7%B3%BB.png" alt="image-20220612181435081" style="zoom:50%;" />

<span id="more"></span>

<h3 id="å®ç°å…³ç³»ï¼š"><a href="#å®ç°å…³ç³»ï¼š" class="headerlink" title="å®ç°å…³ç³»ï¼š"></a>å®ç°å…³ç³»ï¼š</h3><img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E5%AE%9E%E7%8E%B0%E5%85%B3%E7%B3%BB.png" alt="image-20220612181506020" style="zoom:50%;" />

<h3 id="å…³è”å…³ç³»ï¼š"><a href="#å…³è”å…³ç³»ï¼š" class="headerlink" title="å…³è”å…³ç³»ï¼š"></a>å…³è”å…³ç³»ï¼š</h3><img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB.png" alt="image-20220612181558777" style="zoom:50%;" />

<h3 id="èšåˆå…³ç³»ï¼š"><a href="#èšåˆå…³ç³»ï¼š" class="headerlink" title="èšåˆå…³ç³»ï¼š"></a>èšåˆå…³ç³»ï¼š</h3><img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E8%81%9A%E5%90%88%E5%85%B3%E7%B3%BB.png" alt="image-20220612181638697" style="zoom:50%;" />

<h3 id="ç»„åˆå…³ç³»ï¼š"><a href="#ç»„åˆå…³ç³»ï¼š" class="headerlink" title="ç»„åˆå…³ç³»ï¼š"></a>ç»„åˆå…³ç³»ï¼š</h3><img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E7%BB%84%E5%90%88%E5%85%B3%E7%B3%BB.png" alt="image-20220612181705134" style="zoom:50%;" />

<h3 id="ä¾èµ–å…³ç³»ï¼š"><a href="#ä¾èµ–å…³ç³»ï¼š" class="headerlink" title="ä¾èµ–å…³ç³»ï¼š"></a>ä¾èµ–å…³ç³»ï¼š</h3><img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB.png" alt="image-20220612181732800" style="zoom:50%;" />

<h2 id="æ´»åŠ¨å›¾"><a href="#æ´»åŠ¨å›¾" class="headerlink" title="æ´»åŠ¨å›¾"></a>æ´»åŠ¨å›¾</h2><p>æ´»åŠ¨å›¾æ˜¯UMLç”¨äºå¯¹ç³»ç»Ÿçš„åŠ¨æ€è¡Œä¸ºå»ºæ¨¡çš„å¦ä¸€ç§å¸¸ç”¨å·¥å…·,å®ƒæè¿°æ´»åŠ¨çš„é¡ºåºï¼Œå±•ç°ä»ä¸€ä¸ªæ´»åŠ¨åˆ°å¦ä¸€ä¸ªæ´»åŠ¨çš„æ§åˆ¶æµ,æ´»åŠ¨å›¾åœ¨æœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong>æµç¨‹å›¾</strong>ï¼›æ´»åŠ¨å›¾ç€é‡è¡¨ç°ä»ä¸€ä¸ªæ´»åŠ¨åˆ°å¦ä¸€ä¸ªæ´»åŠ¨çš„æ§åˆ¶æµ</p>
<p>æ´»åŠ¨å›¾çš„ä¸»è¦ç»„æˆå…ƒç´ ï¼š<strong>åŠ¨ä½œã€æ´»åŠ¨ã€åŠ¨ä½œæµã€åˆ†æ”¯ä¸åˆå¹¶ã€åˆ†å‰ä¸æ±‡åˆã€æ³³é“ã€å¯¹è±¡æµ</strong> </p>
<p><img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/image-20220612184727313.png" alt="image-20220612184727313"></p>
<img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E6%B4%BB%E5%8A%A8%E5%9B%BE.png" alt="image-20220612180132067" style="zoom: 67%;" />

<h2 id="çŠ¶æ€å›¾"><a href="#çŠ¶æ€å›¾" class="headerlink" title="çŠ¶æ€å›¾"></a>çŠ¶æ€å›¾</h2><p><strong>çŠ¶æ€å›¾æ˜¯ä¸€ç§è¡Œä¸ºå›¾</strong>ã€‚æè¿°ä¸€ä¸ªç‰¹å®šå¯¹è±¡çš„æ‰€æœ‰å¯èƒ½çš„çŠ¶æ€ä»¥åŠå¼•èµ·çŠ¶æ€è½¬æ¢çš„äº‹ä»¶ã€‚</p>
<p>çŠ¶æ€æœºç”±<strong>çŠ¶æ€ã€è½¬ç§»ã€äº‹ä»¶ã€æ´»åŠ¨å’ŒåŠ¨ä½œ</strong>äº”éƒ¨åˆ†ç»„æˆã€‚</p>
<img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E7%8A%B6%E6%80%81%E5%9B%BE.png" alt="image-20220612180553554" style="zoom:50%;" />

<h2 id="åºåˆ—å›¾-é¡ºåºå›¾"><a href="#åºåˆ—å›¾-é¡ºåºå›¾" class="headerlink" title="åºåˆ—å›¾(é¡ºåºå›¾)"></a>åºåˆ—å›¾(é¡ºåºå›¾)</h2><p>é¡ºåºå›¾ä¸åä½œå›¾ä¸ºå¯¹è±¡åŠ¨æ€äº¤äº’æ¨¡å‹</p>
<img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E5%BA%8F%E5%88%97%E5%9B%BE.png" alt="image-20220612180641168" style="zoom: 67%;" />

<h2 id="ç»„ä»¶å›¾"><a href="#ç»„ä»¶å›¾" class="headerlink" title="ç»„ä»¶å›¾"></a>ç»„ä»¶å›¾</h2><p>ç»„ä»¶å›¾ç”±ç»„ä»¶ï¼Œæ¥å£ï¼Œç»„ä»¶å›¾ä¸­çš„å…³ç³»ï¼Œç«¯å£ç»„æˆ</p>
<p>ç»„ä»¶å›¾æ˜¯ç”¨æ¥æè¿°ç»„ä»¶ä¸ç»„ä»¶ä¹‹é—´å…³ç³»çš„ä¸€ç§UMLå›¾ï¼Œç»„ä»¶å›¾åœ¨å®è§‚å±‚é¢ä¸Šæ˜¾ç¤ºäº†æ„æˆç³»ç»ŸæŸä¸€ç‰¹å®šæ–¹é¢çš„å®ç°ç»“æ„ã€‚å®ƒæ˜¯ä¸€ç§ç»“æ„å‹å›¾è¡¨ã€‚</p>
<img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E7%BB%84%E4%BB%B6%E5%9B%BE.png" alt="image-20220612180727673" style="zoom: 67%;" />

<h2 id="éƒ¨ç½²å›¾"><a href="#éƒ¨ç½²å›¾" class="headerlink" title="éƒ¨ç½²å›¾"></a>éƒ¨ç½²å›¾</h2><p>éƒ¨ç½²å›¾ç”¨æ¥å»ºæ¨¡ç³»ç»Ÿçš„ç‰©ç†éƒ¨ç½²ï¼Œå¦‚è®¡ç®—æœºå’Œè®¾å¤‡ï¼ŒåŠå®ƒä»¬ä¹‹é—´çš„å…³è”å…³ç³»</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>è§£é‡Š</th>
<th>å›¾ä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>èŠ‚ç‚¹</td>
<td>èŠ‚ç‚¹ç”¨ä¸€é•¿æ–¹å½¢è¡¨ç¤ºï¼ŒèŠ‚ç‚¹å®šä¹‰äº†è¿è¡Œæ—¶å¯¹è±¡å’Œæ„ä»¶å®ä¾‹é©»ç•™çš„ä½ç½®</td>
<td><img src="https://img-blog.csdnimg.cn/img_convert/08e060432894297a07704a97b4b5f82d.png" alt="img" style="zoom:50%;" /></td>
</tr>
<tr>
<td>æ„ä»¶</td>
<td>æŒ‡ç³»ç»Ÿä¸­å¯æ›¿æ¢çš„ç‰©ç†éƒ¨åˆ†ï¼Œæ„å»ºçš„åå­—æ ‡åœ¨çŸ©å½¢ä¸­ï¼Œæä¾›ä¸€ç»„æ¥å£å®ç°</td>
<td><img src="https://img-blog.csdnimg.cn/img_convert/9d78a42250c54313911043606e5f01c3.png" alt="img"></td>
</tr>
<tr>
<td>æ¥å£</td>
<td>å¤–éƒ¨å¯è®¿é—®åˆ°çš„æœåŠ¡</td>
<td><img src="https://img-blog.csdnimg.cn/img_convert/b5d3dd4bdf4391f441d00ecd97afb482.png" alt="img"></td>
</tr>
</tbody></table>
<img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/%E9%83%A8%E7%BD%B2%E5%9B%BE.png" alt="image-20220612180923398" style="zoom:50%;" />]]></content>
      <categories>
        <category>é¢å‘å¯¹è±¡åˆ†æä¸è®¾è®¡</category>
      </categories>
      <tags>
        <tag>æœŸæœ«å¤ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>æ–°çš„ä¸€å¹´</title>
    <url>/2023/01/02/%E6%96%B0%E7%9A%84%E4%B8%80%E5%B9%B4/</url>
    <content><![CDATA[<h2 id="2023-æ–°å¹´å¿«ä¹ğŸ˜Š"><a href="#2023-æ–°å¹´å¿«ä¹ğŸ˜Š" class="headerlink" title="2023 æ–°å¹´å¿«ä¹ğŸ˜Š"></a>2023 æ–°å¹´å¿«ä¹ğŸ˜Š</h2><h3 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h3><p>æ˜¨å¤©è·¨å®Œå¹´ç€å®æœ‰ç‚¹ç´¯ğŸ˜´ï¼Œæ‰€ä»¥ä»Šå¤©æ¥è¡¥è¿™ç¯‡æ–°å¹´åšæ–‡</p>
<h3 id="å›é¡¾-2022"><a href="#å›é¡¾-2022" class="headerlink" title="å›é¡¾ 2022"></a>å›é¡¾ 2022</h3><span id="more"></span>

<p>2022æœ‰è®¸å¤šç¬¬ä¸€æ¬¡ï¼Œç¬¬ä¸€æ¬¡å®ä¹ ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦Goå¼€å‘ï¼Œç¬¬ä¸€æ¬¡å‡†å¤‡è€ƒç ”ï¼Œç¬¬ä¸€æ¬¡Github Commitè¶…ä¸‰ç™¾æ¬¡â€¦</p>
<p>æœ€é‡è¦çš„å¤§æ¦‚å°±æ˜¯å®Œæˆäº†äººç”Ÿä¸­ç¬¬ä¸€æ¬¡å®ä¹ ï¼Œè™½ç„¶åšçš„å¹¶ä¸æ˜¯å¼€å‘ï¼Œä½†ä¹Ÿç®—æ¥è§¦äº†è½¯ä»¶ä¸“ä¸šç›¸å…³çš„å·¥ä½œï¼Œæœ‰äº†ç¬¬ä¸€ç¬”æ”¶å…¥ï¼Œè¿˜æœ‰å…¶ä»–æ›´é‡è¦çš„æ”¶è·ï¼š</p>
<p>ä¸€æ˜¯åšå®šäº†è‡ªå·±è€ƒç ”çš„å†³å¿ƒï¼Œå®ä¹ é‡åˆ°äº†å¾ˆå¤šä¼˜ç§€çš„å‰è¾ˆï¼Œè‡ªå·±çš„å­¦å†å¤§æ¦‚æ˜¯æœ€ä½çš„å§ï¼Œæ„Ÿæ…¨è‡ªå·±å­¦å†çš„ä¸è¶³ï¼Œå¸Œæœ›è‡ªå·±åœ¨2023èƒ½ä¸€æˆ˜æˆç¡•ğŸ’ªã€‚</p>
<p>äºŒæ˜¯å‘ç°è‡ªå·±æ›´åŠ å–œæ¬¢åšå¼€å‘ï¼Œæµ‹è¯•å·¥ä½œå¯¹æˆ‘æ¥è¯´å¯èƒ½å¤ªç¹çäº†ã€‚æœŸé—´æ¥è§¦äº†Goï¼Œæ„Ÿè§‰å¾ˆå¼ºå¤§ï¼Œå¸Œæœ›ä»¥åå¯ä»¥æˆä¸ºGoå¼€å‘è€…ã€‚</p>
<p>æƒ³èµ·<a href="/2022/02/05/%E5%8F%91%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%97%AE%E9%A2%98/" title="è¿™ç¯‡æ–‡ç« ">è¿™ç¯‡æ–‡ç« </a>äº†ï¼Œå»å¹´ç«‹çš„flagç°åœ¨å›å¤´çœ‹çœŸæ˜¯æƒ­æ„§ï¼Œè¿™ä¸ªflagå¯èƒ½åªå®Œæˆäº†1/5ğŸ¤£</p>
<p>æœ€åè¿˜æ˜¯å¾ˆé—æ†¾2022æ²¡èƒ½è°ˆæ‹çˆ±ï¼Œå¯¹2023ä¹Ÿä¸æŠ±æœŸæœ›äº†ï¼Œåªå¸Œæœ›è€ƒç ”å¯ä»¥é¡ºåˆ©ï¼</p>
]]></content>
      <categories>
        <category>æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>ä¸€äº›é—²è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>è‡ªå‹‰</title>
    <url>/2022/02/11/%E8%87%AA%E5%8B%89/</url>
    <content><![CDATA[<p>å¦‚æœä½ çƒ­è¡·äºå»å‚ä¸é‚£äº›åªè¦æœ‰ç”µè„‘æˆ–è€…æ‰‹æœºå°±å¯ä»¥å›å¤ï¼Œè€Œä¸éœ€è¦ä»»ä½•æŠ€æœ¯ç»éªŒçš„ä¸»é¢˜ï¼Œä½ å®é™…ä¸Šå°±æ˜¯åœ¨æµªè´¹å®è´µç”Ÿå‘½ã€‚ç„¶åä½ æµªè´¹å®Œä»Šå¤©æ¥ç€æµªè´¹æ˜å¤©ï¼Œä½ çš„äººç”Ÿçš„ä¸€ä¸ªåˆä¸€ä¸ªæœ¬æ¥å¯ä»¥å……æ»¡å¸Œæœ›çš„æ˜å¤©å°±åœ¨è¿™æ ·çš„æ¯«æ— æ„ä¹‰çš„çŒæ°´ä¸­ï¼Œç°é£çƒŸç­ã€‚ç„¶åç­‰ä½ è€äº†ï¼Œå†…å¿ƒåªæ˜¯å……æ»¡äº†å¯¹è¿™ä¸ªç¤¾ä¼šçš„â€œä¸å…¬å¹³â€çš„æ¨ï¼Œå´ä¸è®°å¾—è‡ªå·±åœ¨å¹´è½»çš„æ—¶å€™åšè¿‡ä»»ä½•æœ‰æ„ä¹‰çš„äº‹</p>
<p><strong>Talk is cheap,show me the code</strong></p>
]]></content>
      <categories>
        <category>æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>åˆ†äº«</tag>
      </tags>
  </entry>
  <entry>
    <title>çä¾ƒå‡ å¥</title>
    <url>/2022/05/12/%E7%9E%8E%E4%BE%83%E5%87%A0%E5%8F%A5/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨åšä¸€ä¸ªç¤¾åŒºè®ºå›çš„é¡¹ç›®ï¼Œè¿ç€ä¸‰å››å¤©å†™ä»£ç ï¼Œè¿›åº¦ç¼“æ…¢</p>
<p>å†™ä»£ç ï¼Œå†™ä»£ç ï¼Œè¶Šå†™è¶Šåƒé¢å£æ€è¿‡äº†</p>
<p>å¯¹ç€ç”µè„‘å±å¹•debug</p>
<p>ç»åŠ²è„‘æ±çš„æƒ³è‡ªå·±å“ªé”™äº†ğŸ˜­</p>
]]></content>
      <categories>
        <category>æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>ä¸€äº›é—²è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>è‹±è¯­å­¦ä¹ Tip</title>
    <url>/2022/02/10/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0Tip/</url>
    <content><![CDATA[<p><em><strong>è®°å½•ä¸€ä¸‹è‹±è¯­å­¦ä¹ tip</strong></em></p>
<ul>
<li>å­¦è‹±è¯­å•è¯çš„æ—¶å€™ä¸è¦è®©è‡ªå·±å˜æˆä¸€ä¸ªç¿»è¯‘å™¨ï¼Œåœ¨è„‘æµ·ä¸­æŠŠå…·ä½“çš„äº‹ç‰©ç›´æ¥è·Ÿå•è¯æŒ‚é’©ï¼Œè€Œä¸ç»è¿‡ä¸­æ–‡çš„åª’ä»‹</li>
<li>å› ä¸ºå‘¨å›´æ²¡æœ‰ä¸€ä¸ªå¥½çš„è‹±è¯­ç¯å¢ƒï¼Œæ‰€ä»¥æˆ‘å°½é‡è®©è‡ªå·±ç”¨è‹±æ–‡é‡æ–°è®¤è¯†è¿™ä¸ªä¸–ç•Œ</li>
<li>æ¯”å¦‚çœ‹åˆ°ç”µè„‘ï¼Œä¸æƒ³æˆç”µè„‘æŠŠå®ƒè·ŸcomputeræŒ‚é’©ï¼ŒæŠŠæ¡Œå­è·ŸdeskæŒ‚é’©ï¼Œä¸€äº›æŠ½è±¡çš„åŠ¨è¯å’Œå½¢å®¹è¯ä¹Ÿå°½å¯èƒ½è·ŸæŸäº›å…·ä½“ç”ŸåŠ¨çš„ä¸œè¥¿è”ç³»èµ·æ¥ï¼Œåƒhappyå¯ä»¥ä¸æŸäººå¼€å¿ƒçš„ç¬‘å®¹è”ç³»èµ·æ¥</li>
</ul>
]]></content>
      <categories>
        <category>å­¦ä¹ æ–¹æ³•</category>
      </categories>
      <tags>
        <tag>è‹±è¯­å­¦ä¹ Tip</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç½‘æœŸæœ«</title>
    <url>/2022/01/04/%E8%AE%A1%E7%BD%91/</url>
    <content><![CDATA[<p>è®¡ç®—æœºç½‘ç»œçŸ¥è¯†ç‚¹éšè®°<br>1.åˆ†ç»„äº¤æ¢çš„ä¸¤ç§æ–¹å¼</p>
<ul>
<li>æ•°æ®æŠ¥æ–¹å¼æ˜¯ä¸ºç½‘ç»œå±‚æä¾›æ— è¿æ¥æœåŠ¡<br>(æ— è¿æ¥çš„æœåŠ¡:å°±æ˜¯é€šä¿¡åŒæ–¹<strong>ä¸éœ€è¦</strong>äº‹å…ˆå»ºç«‹ä¸€æ¡é€šä¿¡çº¿è·¯ï¼Œè€Œæ˜¯æŠŠæ¯ä¸ªå¸¦æœ‰ç›®çš„åœ°å€çš„åŒ…ï¼ˆæŠ¥æ–‡åˆ†ç»„ï¼‰é€åˆ°çº¿è·¯ä¸Šï¼Œç”±ç³»ç»Ÿé€‰å®šè·¯çº¿è¿›è¡Œä¼ è¾“ã€‚å®ƒä¸è¦æ±‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´çš„ä¼šè¯è¿æ¥ï¼Œ<strong>ä¸ä¿è¯æ•°æ®ä»¥ç›¸åŒçš„é¡ºåºåˆ°è¾¾</strong>ã€‚)</li>
<li>è™šç”µè·¯æ–¹å¼æ˜¯ä¸ºç½‘ç»œå±‚æä¾›é¢å‘è¿æ¥æœåŠ¡<span id="more"></span>
(é¢å‘è¿æ¥æœåŠ¡:å°±æ˜¯é€šä¿¡åŒæ–¹åœ¨é€šä¿¡æ—¶ï¼Œ<strong>è¦äº‹å…ˆå»ºç«‹</strong>ä¸€æ¡é€šä¿¡çº¿è·¯ï¼Œå…¶è¿‡ç¨‹æœ‰å»ºç«‹è¿æ¥ï¼ˆé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹çš„æ–¹å¼å»ºç«‹ï¼Œå»ºç«‹è¿æ¥æ˜¯éœ€è¦åˆ†é…ç›¸åº”çš„èµ„æºå¦‚ç¼“å†²åŒºï¼Œä»¥ä¿è¯é€šä¿¡èƒ½æ­£å¸¸è¿›è¡Œï¼‰ã€ä½¿ç”¨è¿æ¥å’Œé‡Šæ”¾è¿æ¥ä¸‰ä¸ªè¿‡ç¨‹ã€‚<strong>å®ƒå¯ä»¥ä¿è¯æ•°æ®ä»¥ç›¸åŒçš„é¡ºåºåˆ°è¾¾</strong>ã€‚é¢å‘è¿æ¥çš„æœåŠ¡åœ¨ç«¯ç³»ç»Ÿä¹‹é—´å»ºç«‹é€šè¿‡ç½‘ç»œçš„è™šé“¾è·¯ã€‚ <strong>TCPåè®®</strong>å°±æ˜¯ä¸€ç§é¢å‘è¿æ¥æœåŠ¡çš„åè®®ï¼Œç”µè¯ç³»ç»Ÿæ˜¯ä¸€ä¸ªé¢å‘è¿æ¥çš„æ¨¡å¼ã€‚)</li>
</ul>
<p>2.åœ¨è®¡ç®—æœºç½‘ç»œä¸­é€šå¸¸ä»¥ä¸€ç§åŒ…å«äº”å±‚åè®®çš„ä½“ç³»ç»“æ„æ¥è®²è§£å„å±‚ä¹‹é—´çš„åŠŸèƒ½ä¸è”ç³»ï¼Œè¿™ç§ä½“ç³»ç»“æ„ç»“åˆOSIå’ŒTCP/IPçš„ä¼˜ç‚¹ï¼Œåˆ†ä¸º<strong>åº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ã€æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚</strong>ã€‚ </p>
<ul>
<li>ç‰©ç†å±‚ã€‚ç‰©ç†å±‚æ˜¯è®¡ç®—æœºä½“ç³»ç»“æ„çš„æœ€åº•å±‚ï¼Œå®ƒä¸ºè®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“æä¾›å¯é çš„ç¯å¢ƒ</li>
<li>æ•°æ®é“¾è·¯å±‚ã€‚æ•°æ®é“¾è·¯å±‚ç®€ç§°é“¾è·¯å±‚ï¼Œè¯¥å±‚å°†ä»ç½‘ç»œå±‚è·å–çš„æ•°æ®æŠ¥ç»„è£…æˆå¸§ï¼Œåœ¨ç½‘ç»œç»“ç‚¹ä¹‹é—´ä»¥å¸§ä¸ºå•ä½ä¼ è¾“æ•°æ®</li>
<li>ç½‘ç»œå±‚ã€‚ä¸ºåˆ†ç»„äº¤æ¢ç½‘ä¸Šçš„ä¸åŒä¸»æœºæä¾›é€šä¿¡æœåŠ¡ï¼Œåœ¨è¿›è¡Œé€šä¿¡æ—¶ï¼Œå°†ä»ä¼ è¾“å±‚è·å–çš„æŠ¥æ–‡æ®µæˆ–æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„æˆ–åŒ…ï¼Œæ•°æ®æˆ–åŒ…é€šå¸¸ç§°ä¸ºæ•°æ®æŠ¥</li>
<li>ä¼ è¾“å±‚ã€‚ä¸ºåº”ç”¨è¿›ç¨‹æä¾›è¿æ¥æœåŠ¡ï¼Œå®ç°è¿æ¥ä¸¤ç«¯è¿›ç¨‹çš„ä¼šè¯</li>
<li>åº”ç”¨å±‚ã€‚ä¸ºåº”ç”¨è¿›ç¨‹æä¾›æœåŠ¡ï¼Œå®šä¹‰äº†åº”ç”¨è¿›ç¨‹é—´é€šä¿¡å’Œäº¤äº’çš„è§„åˆ™</li>
</ul>
<p>3.TCP/IPå®é™…ä¸Šå¹¶ä¸æ˜¯åè®®ï¼Œè€Œæ˜¯<u>åè®®æ—</u>ï¼Œå®ƒç”±å¤šç§åè®®æ„æˆï¼ŒåŒ…æ‹¬TCPåè®®ã€UDPåè®®ã€IPåè®®ç­‰ç­‰ï¼Œå…¶ä¸­<strong>TCPã€UDPåè®®åº”ç”¨åœ¨<u>ä¼ è¾“å±‚</u></strong>;<strong>IPåè®®åº”ç”¨åœ¨<u>ç½‘ç»œå±‚</u></strong></p>
<p>4.ç´¯ç§¯ç¡®è®¤è¿™ä¸ªæ¦‚å¿µåº”è¯¥ä¸åªé€‚ç”¨äºTCPåè®®ï¼Œä¹Ÿé€‚ç”¨å…¶ä»–å±‚ï¼Œæ¯”å¦‚æ•°æ®é“¾è·¯å±‚ã€‚<br>ä¸€èˆ¬åœ°è®²ï¼Œå¦‚æœå‘é€æ–¹å‘äº†åŒ…1ï¼ŒåŒ…2ï¼ŒåŒ…3ï¼ŒåŒ…4ï¼›æ¥å—æ–¹æˆåŠŸæ”¶åˆ°åŒ…1ï¼ŒåŒ…2ï¼ŒåŒ…3ã€‚é‚£ä¹ˆæ¥å—æ–¹å¯ä»¥å‘å›ä¸€ä¸ªç¡®è®¤åŒ…ï¼Œåºå·ä¸º4(4è¡¨ç¤ºæœŸæœ›ä¸‹ä¸€ä¸ªæ”¶åˆ°çš„åŒ…çš„åºå·ï¼›å½“ç„¶ä½ çº¦å®šå¥½ç”¨3è¡¨ç¤ºä¹Ÿå¯ä»¥)ï¼Œé‚£ä¹ˆå‘é€æ–¹å°±çŸ¥é“åŒ…1åˆ°åŒ…3éƒ½å‘é€æ¥æ”¶æˆåŠŸï¼Œå¿…è¦æ—¶é‡å‘åŒ…4ã€‚ä¸€ä¸ªç¡®è®¤åŒ…ç¡®è®¤äº†ç´¯ç§¯åˆ°æŸä¸€åºå·çš„æ‰€æœ‰åŒ…ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªåºå·éƒ½å‘ç¡®è®¤åŒ…ã€‚<br>å…·ä½“åˆ°TCPï¼Œå®ƒå¯¹å­—èŠ‚ç¼–å·ã€‚æ¯”å¦‚å‘é€æ–¹å‘äº†åŒ…1ï¼ŒåŒ…2ï¼ŒåŒ…3ï¼›åŒ…1å«å­—èŠ‚0åˆ°10ï¼ŒåŒ…2å«å­—èŠ‚11åˆ°20ï¼ŒåŒ…3å«å­—èŠ‚21åˆ°30ã€‚æ¥å—æ–¹æˆåŠŸæ”¶åˆ°åŒ…1ï¼ŒåŒ…2ã€‚é‚£ä¹ˆæ¥å—æ–¹å‘å›ä¸€ä¸ªåŒ…å«ç¡®è®¤åºå·21çš„åŒ…ï¼Œå‘é€æ–¹å°±çŸ¥é“å­—èŠ‚0åˆ°20(åŒ…1ï¼ŒåŒ…2)éƒ½æˆåŠŸæ”¶åˆ°ï¼Œå¿…è¦æ—¶è¦é‡å‘çš„åªéœ€ä»å­—èŠ‚21å¼€å§‹ã€‚</p>
<p>5.å„ç±»åè®®ç®€è¿°</p>
<p>***ä¼ è¾“å±‚ï¼š         å¸¸è§çš„åè®®æœ‰  TCP,IP ,UDP åè®®</p>
<p>åº”ç”¨å±‚ï¼š         å¸¸è§çš„åè®®æœ‰ HTTPï¼ŒFTP åè®®</p>
<p>ç½‘ç»œå±‚ï¼š         å¸¸è§çš„åè®®æœ‰ IP åè®®ï¼ŒICMP åè®®ï¼ŒIGMP åè®®</p>
<p>ç½‘ç»œæ¥å£å±‚(å³ç‰©ç†å±‚å’Œæ•°æ®é“¾è·¯å±‚)ï¼š      å¸¸è§çš„åè®®æœ‰ ARP åè®®ï¼ŒRARP åè®®***</p>
<hr>
<ul>
<li><strong>TCPåè®®</strong>å³ä¼ è¾“æ§åˆ¶åè®®(Transmission Control Protocol)ï¼Œè¯¥åè®®æ˜¯ä¸€ç§<strong>é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“åè®®</strong>ã€‚<br>å› ä¸ºTCPè¿æ¥æ˜¯<strong>å…¨åŒå·¥</strong>çš„(å…¨åŒå·¥æŒ‡äº¤æ¢æœºåœ¨å‘é€æ•°æ®çš„åŒæ—¶ä¹Ÿèƒ½å¤Ÿæ¥æ”¶æ•°æ®ï¼Œä¸¤è€…åŒæ­¥è¿›è¡Œï¼Œç±»ä¼¼è¯­éŸ³é€šè¯ï¼ŒåŒæ–¹åœ¨è¯´è¯çš„åŒæ—¶ä¹Ÿèƒ½å¤Ÿå¬åˆ°å¯¹æ–¹çš„å£°éŸ³)</li>
<li><strong>UDPåè®®</strong>å³ç”¨æˆ·æ•°æ®æŠ¥åè®®(User Datagram Protocol)ï¼Œå®ƒæ˜¯ä¸€ç§<strong>æ— è¿æ¥çš„ä¼ è¾“å±‚åè®®</strong>ï¼Œ<u>UDPä¸å¯¹æ•°æ®æŠ¥è¿›è¡Œç¼–å·</U>ï¼Œå®ƒä¸ä¿è¯æ¥æ”¶æ–¹ä»¥æ­£ç¡®çš„é¡ºåºæ¥æ”¶åˆ°å®Œæ•´çš„æ•°æ®ï¼Œä½†ä¼šå°†æ•°æ®æŠ¥çš„é•¿åº¦éšæ•°æ®å‘é€ç»™æ¥æ”¶æ–¹ã€‚è™½ç„¶UDPé¢å‘æ— è¿æ¥çš„é€šä¿¡ï¼Œä¸èƒ½å¦‚TCPèˆ¬å¾ˆå¥½åœ°ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼Œä½†UDPå¤„ç†é€Ÿåº¦å¿«ï¼Œè€—è´¹èµ„æºå°‘ï¼Œå› æ­¤åœ¨å¯¹<strong>æ•°æ®å®Œæ•´æ€§è¦æ±‚ä½ã€å¯¹ä¼ è¾“æ•ˆç‡è¦æ±‚é«˜</strong>çš„åº”ç”¨ä¸­ä¸€èˆ¬ä½¿ç”¨UDPåè®®ä¼ è¾“æ•°æ®ã€‚</li>
<li><strong>IPåè®®</strong>æ˜¯TCP/IPä½“ç³»ä¸­çš„<strong>ç½‘ç»œå±‚åè®®</strong>ã€‚è®¾è®¡IPåè®®çš„ç›®çš„æ˜¯æé«˜ç½‘ç»œçš„å¯æ‰©å±•æ€§ï¼š<u>ä¸€æ˜¯è§£å†³äº’è”ç½‘é—®é¢˜ï¼Œå®ç°å¤§è§„æ¨¡ã€å¼‚æ„ç½‘ç»œçš„äº’è”äº’é€šï¼›äºŒæ˜¯åˆ†å‰²é¡¶å±‚ç½‘ç»œåº”ç”¨å’Œåº•å±‚ç½‘ç»œæŠ€æœ¯ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä»¥åˆ©äºä¸¤è€…çš„ç‹¬ç«‹å‘å±•</u>ã€‚æ ¹æ®ç«¯åˆ°ç«¯çš„è®¾è®¡åŸåˆ™ï¼ŒIPåè®®åªä¸ºä¸»æœºæä¾›ä¸€ç§<strong>æ— è¿æ¥ã€ä¸å¯é çš„ã€å°½åŠ›è€Œä¸ºçš„æ•°æ®åŒ…ä¼ è¾“æœåŠ¡</strong>ã€‚IPåè®®çš„ä¸¤ä¸ªåŸºæœ¬åŠŸèƒ½ä¸º<strong>å¯»å€å’Œåˆ†æ®µ</strong>ã€‚ä¼ è¾“å±‚çš„æ•°æ®å°è£…å®Œæˆåæ²¡æœ‰ç›´æ¥å‘é€åˆ°æ¥æ”¶æ–¹ï¼Œè€Œæ˜¯å…ˆé€’è¾¾ç½‘ç»œå±‚;ç½‘ç»œå±‚åˆåœ¨åŸæ•°æ®æŠ¥å‰æ·»åŠ IPé¦–éƒ¨ï¼Œå°è£…æˆIPæ•°æ®æŠ¥ï¼Œå¹¶è§£ææ•°æ®æŠ¥ä¸­çš„ç›®çš„åœ°å€ï¼Œä¸ºå…¶é€‰æ‹©ä¼ è¾“è·¯å¾„ï¼Œå°†æ•°æ®æŠ¥å‘é€åˆ°æ¥æ”¶æ–¹ï¼ŒIPåè®®ä¸­è¿™ç§é€‰æ‹©é“è·¯çš„åŠŸèƒ½ç§°ä¸ºè·¯ç”±åŠŸèƒ½ã€‚æ­¤å¤–ï¼ŒIPåè®®å¯é‡æ–°ç»„è£…æ•°æ®æŠ¥ï¼Œæ”¹å˜æ•°æ®æŠ¥çš„å¤§å°ï¼Œä»¥é€‚åº”ä¸åŒç½‘ç»œå¯¹åŒ…å¤§å°çš„è¦æ±‚ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ<u>IPåè®®ä¸æä¾›ç«¯åˆ°ç«¯æˆ–ç»“ç‚¹åˆ°ç»“ç‚¹çš„ç¡®è®¤ï¼Œåªæ£€æµ‹æŠ¥å¤´ä¸­çš„æ ¡éªŒç ï¼Œä¸æä¾›å¯é çš„ä¼ è¾“æœåŠ¡ã€‚</u></li>
<li><strong>ARPåè®®</strong>ï¼Œå³åœ°å€è§£æåè®®ï¼ˆAddress Resolution Protocolï¼‰ï¼Œæ˜¯æ ¹æ®IPåœ°å€è·å–ç‰©ç†åœ°å€çš„ä¸€ä¸ªTCP/IPåè®®ã€‚ä¸»æœºå‘é€ä¿¡æ¯æ—¶å°†åŒ…å«ç›®æ ‡IPåœ°å€çš„ARPè¯·æ±‚å¹¿æ’­åˆ°å±€åŸŸç½‘ç»œä¸Šçš„æ‰€æœ‰ä¸»æœºï¼Œå¹¶æ¥æ”¶è¿”å›æ¶ˆæ¯ï¼Œä»¥æ­¤ç¡®å®šç›®æ ‡çš„ç‰©ç†åœ°å€ï¼›æ”¶åˆ°è¿”å›æ¶ˆæ¯åå°†è¯¥IPåœ°å€å’Œç‰©ç†åœ°å€å­˜å…¥æœ¬æœºARPç¼“å­˜ä¸­å¹¶ä¿ç•™ä¸€å®šæ—¶é—´ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶ç›´æ¥æŸ¥è¯¢ARPç¼“å­˜ä»¥èŠ‚çº¦èµ„æºã€‚</li>
<li><strong>SRåè®®</strong>ï¼Œå³é€‰æ‹©é‡ä¼ åè®®ï¼ˆSegment Routingï¼‰ï¼Œ<strong>1.å¯¹æ•°æ®å¸§é€ä¸€ç¡®è®¤ï¼Œæ”¶ä¸€ä¸ªç¡®è®¤ä¸€ä¸ª 2.åªé‡ä¼ å‡ºé”™å¸§ 3.æ¥æ”¶æ–¹æœ‰ç¼“å­˜</strong></li>
<li><strong>è¿ç»­ARQåè®®</strong>ï¼ˆAutomatic Repeat reQuestï¼‰æŒ‡å‘é€æ–¹ç»´æŒç€ä¸€ä¸ªä¸€å®šå¤§å°çš„å‘é€çª—å£ï¼Œä½äºå‘é€çª—å£å†…çš„æ‰€æœ‰åˆ†ç»„éƒ½å¯è¿ç»­å‘é€å‡ºå»ï¼Œè€Œä¸­é€”ä¸éœ€è¦ç­‰å¾…å¯¹æ–¹çš„ç¡®è®¤ã€‚ï¼ˆ<u>æ¥æ”¶æ–¹ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨ç§¯ç´¯ç¡®è®¤çš„æ–¹å¼ã€‚è¿™å°±æ˜¯è¯´ï¼Œæ¥æ”¶æ–¹ä¸å¿…å¯¹æ”¶åˆ°çš„åˆ†ç»„é€ä¸ªå‘é€ç¡®è®¤ï¼Œè€Œæ˜¯åœ¨æ”¶åˆ°å‡ ä¸ªåˆ†ç»„åï¼Œå¯¹æŒ‰åºåˆ°è¾¾çš„æœ€åä¸€ä¸ªåˆ†ç»„å‘é€ç¡®è®¤ï¼Œè¿™å°±è¡¨ç¤ºï¼šåˆ°è¿™ä¸ªåˆ†ç»„ä¸ºæ­¢çš„æ‰€æœ‰åˆ†ç»„éƒ½å·²æ­£ç¡®æ”¶åˆ°äº†ã€‚</u>ï¼‰è¿™æ ·ä¿¡é“çš„åˆ©ç”¨ç‡å°±æé«˜äº†ã€‚è€Œå‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ªç¡®è®¤å°±æŠŠå‘é€çª—å£å‘å‰æ»‘åŠ¨ä¸€ä¸ªåˆ†ç»„çš„ä½ç½®ã€‚<strong>ARQä»£è¡¨çš„æ˜¯è‡ªåŠ¨é‡ä¼ è¯·æ±‚ï¼Œè€ŒGBNä¸é€‰æ‹©é‡ä¼ éƒ½å±äºå…¶ä¸­</strong><br>(ç§¯ç´¯ç¡®è®¤æœ‰ä¼˜ç‚¹ä¹Ÿæœ‰ç¼ºç‚¹ã€‚ä¼˜ç‚¹æ˜¯ï¼šå®¹æ˜“å®ç°ï¼Œå³ä½¿ç¡®è®¤ä¸¢å¤±ä¹Ÿä¸å¿…é‡ä¼ ã€‚ä½†ç¼ºç‚¹æ˜¯ä¸èƒ½å‘å‘é€æ–¹åæ˜ å‡ºæ¥æ”¶æ–¹å·²ç»æ­£ç¡®æ”¶åˆ°çš„æ‰€æœ‰åˆ†ç»„çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå‘é€æ–¹å‘é€äº†å‰5ä¸ªåˆ†ç»„ï¼Œè€Œä¸­é—´çš„ç¬¬3ä¸ªåˆ†ç»„ä¸¢å¤±äº†ã€‚è¿™æ—¶æ¥æ”¶æ–¹åªæ˜¯å¯¹å‰ä¸¤ä¸ªåˆ†ç»„å‘å‡ºç¡®è®¤ã€‚å‘é€æ–¹æ— æ³•çŸ¥é“åé¢ä¸‰ä¸ªåˆ†ç»„çš„ä¸‹è½ï¼Œè€Œåªå¥½æŠŠåé¢çš„ä¸‰ä¸ªåˆ†ç»„éƒ½å†é‡ä¼ ä¸€æ¬¡ã€‚è¿™å°±å«åšGo-back-Nï¼ˆå›é€€Nï¼‰ï¼Œè¡¨ç¤ºéœ€è¦å†é€€å›æ¥é‡ä¼ å·²å‘é€è¿‡çš„Nä¸ªåˆ†ç»„ã€‚å¯è§å½“é€šä¿¡çº¿è·¯è´¨é‡ä¸å¥½æ—¶ï¼Œè¿ç»­ARQåè®®ä¼šå¸¦æ¥è´Ÿé¢çš„å½±å“ã€‚)</li>
</ul>
]]></content>
      <categories>
        <category>è®¡ç®—æœºç½‘ç»œ</category>
      </categories>
      <tags>
        <tag>æœŸæœ«å¤ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>è®°å½•ä¸€ä¸‹</title>
    <url>/2022/09/18/%E8%AE%B0%E5%BD%95%E4%B8%80%E4%B8%8B/</url>
    <content><![CDATA[<p>ä»Šå¤©æŠ½ç©ºæŠŠåšå®¢ä¸»é¢˜æ›´æ¢æˆäº†Nextï¼Œæ¯”ä¹‹å‰çš„è¦æ›´åŠ ç®€çº¦ç¾è§‚ã€‚èŠ±é‡Œèƒ¡å“¨çš„ä¸œè¥¿çœ‹ä¹…äº†å°±ä¼šè…»å•Šã€‚</p>
<p>æƒ³èµ·ä¸€å¥è¯ ï¼šç¾åŒ–çš„å°½å¤´æ˜¯é»˜è®¤  ğŸ˜‚</p>
<hr>
<p>è´µå·è½¬è¿è½¦äº‹æ•…é‡éš¾çš„äººä»¬ R.I.P</p>
]]></content>
      <categories>
        <category>æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>ä¸€äº›é—²è¯</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿æ¥å®¹å™¨åŒ–Mongo</title>
    <url>/2023/02/05/%E8%BF%9E%E6%8E%A5%E5%AE%B9%E5%99%A8%E5%8C%96Mongo/</url>
    <content><![CDATA[<h2 id="å®¹å™¨åŒ–MongoDBâ€”è¸©å‘æ€»ç»“"><a href="#å®¹å™¨åŒ–MongoDBâ€”è¸©å‘æ€»ç»“" class="headerlink" title="å®¹å™¨åŒ–MongoDBâ€”è¸©å‘æ€»ç»“"></a>å®¹å™¨åŒ–MongoDBâ€”è¸©å‘æ€»ç»“</h2><h3 id="æ‹‰å–å¹¶å®ä¾‹åŒ–MongoDB"><a href="#æ‹‰å–å¹¶å®ä¾‹åŒ–MongoDB" class="headerlink" title="æ‹‰å–å¹¶å®ä¾‹åŒ–MongoDB"></a>æ‹‰å–å¹¶å®ä¾‹åŒ–MongoDB</h3><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">// æ‹‰å–MongoDBé•œåƒ</span><br><span class="line">docker pull mongo:latest</span><br><span class="line"></span><br><span class="line">// æŸ¥çœ‹æœ¬åœ°é•œåƒç›®å½•</span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line">// å®ä¾‹åŒ–MongoDBå®¹å™¨</span><br><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -p 27017:27017 -v <span class="variable">$PWD</span>/db:/data/db --name mongo -d mongo</span></span><br></pre></td></tr></table></figure>

<p><code>-p 27017:27017</code>æ˜ å°„ç«¯å£å·ã€‚æœ¬åœ°ç«¯å£ : å®¹å™¨ç«¯å£</p>
<p><code>-v $PWD/db:/data/db</code> å°†å®¹å™¨ç›®å½•æŒ‚è½½åˆ°æœ¬åœ°ï¼Œä¿å­˜å®¹å™¨å†…æ•°æ®åº“æ•°æ®ã€‚$PWD / (æœ¬åœ°ç›¸å¯¹è·¯å¾„) ï¼š(å®¹å™¨å†…è·¯å¾„)</p>
<p><code>--name mongo</code> å®¹å™¨å‘½åã€‚</p>
<p><code>-d</code> åå°å¯åŠ¨å®¹å™¨</p>
<h3 id="è¿›å…¥MongoDBå‘½ä»¤è¡Œ"><a href="#è¿›å…¥MongoDBå‘½ä»¤è¡Œ" class="headerlink" title="è¿›å…¥MongoDBå‘½ä»¤è¡Œ"></a>è¿›å…¥MongoDBå‘½ä»¤è¡Œ</h3><p>MongoDB 6.0 åŠä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line">docker exec -it mongo mongosh</span><br></pre></td></tr></table></figure>

<p>å…¶ä½™ç‰ˆæœ¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker exec -it mongo mongosh</span><br></pre></td></tr></table></figure>



<h3 id="åˆ›å»ºç”¨æˆ·å¹¶èµ‹äºˆæƒé™"><a href="#åˆ›å»ºç”¨æˆ·å¹¶èµ‹äºˆæƒé™" class="headerlink" title="åˆ›å»ºç”¨æˆ·å¹¶èµ‹äºˆæƒé™"></a>åˆ›å»ºç”¨æˆ·å¹¶èµ‹äºˆæƒé™</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// åˆ‡æ¢è‡³adminæ•°æ®åº“</span><br><span class="line">use admin</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºè§’è‰²</span><br><span class="line">db.createUser(&#123;user:&quot;root&quot;, pwd:&quot;password&quot;, roles:[</span><br><span class="line">        &#123;role:&quot;userAdminAnyDatabase&quot;,db:&quot;admin&quot;&#125;,</span><br><span class="line">        &#123;role:&quot;readWrite&quot;,db:&quot;admin&quot;&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>é‡å¯mongoå¹¶åŠ ä¸Šæƒé™å‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker start mongo --auth</span><br></pre></td></tr></table></figure>



<h3 id="Goæµ‹è¯•è¿æ¥ç¨‹åº"><a href="#Goæµ‹è¯•è¿æ¥ç¨‹åº" class="headerlink" title="Goæµ‹è¯•è¿æ¥ç¨‹åº"></a>Goæµ‹è¯•è¿æ¥ç¨‹åº</h3><p>è·å–åŒ…</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">go</span> get <span class="keyword">go</span>.mongodb.org/mongo-driver/mongo</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æœ¬åœ°Goç¨‹åºè¿æ¥dockerå®¹å™¨å†…çš„MongoDB</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/bson&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/mongo&quot;</span></span><br><span class="line">	<span class="string">&quot;go.mongodb.org/mongo-driver/mongo/options&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> client *mongo.Client</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–æ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initMongo</span><span class="params">()</span></span> &#123;</span><br><span class="line">	URI := <span class="string">&quot;mongodb://127.0.0.1:27017&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¾ç½®å®¢æˆ·ç«¯è¿æ¥é…ç½®</span></span><br><span class="line">	clientOptions := options.Client().ApplyURI(URI).SetAuth(options.Credential&#123;Username: <span class="string">&quot;root&quot;</span>, Password: <span class="string">&quot;password&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è¿æ¥åˆ°MongoDB</span></span><br><span class="line">	client, _ = mongo.Connect(context.TODO(), clientOptions)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ£€æŸ¥è¿æ¥</span></span><br><span class="line">	err := client.Ping(context.TODO(), <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Connected to MongoDB!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°è£… æ’å…¥å’ŒæŸ¥æ‰¾ æ•°æ®åº“æ“ä½œ</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ’å…¥å•æ¡æ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">insert</span><span class="params">()</span></span> &#123;</span><br><span class="line">	col := client.Database(<span class="string">&quot;admin&quot;</span>).Collection(<span class="string">&quot;word&quot;</span>)</span><br><span class="line"></span><br><span class="line">	ret, err := col.InsertOne(context.TODO(), &amp;Person&#123;Name: <span class="string">&quot;æå…°è¿ª&quot;</span>, Age: <span class="number">23</span>&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Insert:&quot;</span>, ret.InsertedID)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥æ‰¾å¤šæ¡æ¡æ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Find</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Find:&quot;</span>)</span><br><span class="line">	opt := options.Find()</span><br><span class="line">	opt.SetLimit(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">	col := client.Database(<span class="string">&quot;admin&quot;</span>).Collection(<span class="string">&quot;word&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥è¯¢ Name å€¼ä¸º æå…°è¿ª çš„æ•°æ®</span></span><br><span class="line">	<span class="comment">// FindæŸ¥è¯¢å¤šæ¡è®°å½•ï¼Œå°†ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œä½¿ç”¨å®Œè®°å¾—å…³é—­</span></span><br><span class="line">	cor, err := col.Find(context.TODO(), bson.D&#123;&#123;<span class="string">&quot;name&quot;</span>, <span class="string">&quot;æå…°è¿ª&quot;</span>&#125;&#125;, opt)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> cor.Close(context.TODO())</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> cor.Next(context.TODO()) &#123;</span><br><span class="line">		<span class="keyword">var</span> p Person</span><br><span class="line">		_ = cor.Decode(&amp;p)</span><br><span class="line">		fmt.Println(p)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œç¨‹åº</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	initMongo()</span><br><span class="line">	insert()</span><br><span class="line">	Find()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p>ç¨‹åºè¾“å‡ºï¼š</p>
<p><img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/image-20230205160033939.png" alt="image-20230205160033939"></p>
<p>MongoDBæ•°æ®åº“ï¼š</p>
<p><img src="https://community-1304870863.cos.ap-nanjing.myqcloud.com/%E6%97%A5%E7%94%A8/image-20230205160157975.png" alt="image-20230205160157975"></p>
]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>Mongo</tag>
      </tags>
  </entry>
</search>
